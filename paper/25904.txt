NBER WORKING PAPER SERIES

TWO-WAY FIXED EFFECTS ESTIMATORS WITH HETEROGENEOUS TREATMENT
EFFECTS
Clément de Chaisemartin
Xavier D'Haultfoeuille
Working Paper 25904
http://www.nber.org/papers/w25904

NATIONAL BUREAU OF ECONOMIC RESEARCH
1050 Massachusetts Avenue
Cambridge, MA 02138
May 2019

Xavier D’Haultfoeuille gratefully acknowledges financial support from the research grants Otelo
(ANR-17-CE26-0015-041) and the Labex Ecodec: Investissements d’Avenir (ANR-11IDEX-0003/Labex Ecodec/ANR-11-LABX-0047). The views expressed herein are those of the
authors and do not necessarily reflect the views of the National Bureau of Economic Research.
NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.
© 2019 by Clément de Chaisemartin and Xavier D'Haultfoeuille. All rights reserved. Short
sections of text, not to exceed two paragraphs, may be quoted without explicit permission
provided that full credit, including © notice, is given to the source.

Two-way Fixed Effects Estimators with Heterogeneous Treatment Effects
Clément de Chaisemartin and Xavier D'Haultfoeuille
NBER Working Paper No. 25904
May 2019
JEL No. C21,C23
ABSTRACT
Linear regressions with period and group fixed effects are widely used to estimate treatment
effects. We show that they identify weighted sums of the average treatment effects (ATE) in each
group and period, with weights that may be negative. Due to the negative weights, the linear
regression estimand may for instance be negative while all the ATEs are positive. In two articles
that have used those regressions, half of the weights are negative. We propose another estimator
that solves this issue. In one of the articles we revisit, it is of a different sign than the linear
regression estimator.

Clément de Chaisemartin
Department of Economics
University of California at Santa Barbara
Santa Barbara, CA 93106
and NBER
clementdechaisemartin@ucsb.edu
Xavier D'Haultfoeuille
CREST
5 avenue Henry Le Chatelier
91764 Palaiseau cedex
FRANCE
xavier.dhaultfoeuille@ensae.fr

A data appendix is available at http://www.nber.org/data-appendix/w25904

1

Introduction

A popular method to estimate the effect of a treatment on an outcome is to compare over time
groups experiencing different evolutions of their exposure to treatment. In practice, this idea is
implemented by estimating regressions that control for group and time fixed effects. Hereafter, we
refer to those as two-way fixed effects (FE) regressions. We conducted a survey, and found that
20% of all empirical articles published by the American Economic Review (AER) between 2010
and 2012 have used a two-way FE regression to estimate the effect of a treatment on an outcome.
When the treatment effect is constant across groups and over time, such regressions identify that
effect under the standard “common trends” assumption. However, it is often implausible that
the treatment effect is constant. For instance, the effect of the minimum wage on employment
may vary across US counties, and may change over time. The goal of this paper is to examine
the properties of two-way FE regressions when the constant effect assumption is violated.
We start by assuming that all observations in the same (g, t) cell have the same treatment, as
is for instance the case when the treatment is a county- or a state-level law. We consider the
regression of Yi,g,t , the outcome of unit i in group g at period t on group fixed effects, period
fixed effects, and Dg,t , the value of the treatment in group g at period t. Let βf e denote the
expectation of the coefficient of Dg,t . Then, under the common trends assumption, we show that
if the treatment is binary, βf e identifies a weighted sum of the treatment effect in each group
and at each period:
βf e =

X

Wg,t ∆g,t .

(1)

(g,t):Dg,t =1

∆g,t is the average treatment effect (ATE) in group g and period t and the weights Wg,t s sum
to one but may be negative. Negative weights arise because βf e is a weighted average of several
difference-in-differences (DID), which compare the evolution of the outcome between consecutive
time periods across pairs of groups. However, the “control group” in some of those comparisons
may be treated at both periods. Then, its treatment effect at the second period gets differenced
out by the DID, hence the negative weights.
The negative weights are an issue when the ATEs are heterogeneous across groups or periods.
Then, one could have that βf e is negative while all the ATEs are positive. For instance, 1.5 ×
1 − 0.5 × 4, a weighted sum of 1 and 4, is strictly negative. We revisit Enikolopov et al. (2011)
and Gentzkow et al. (2011), two articles that have estimated two-way FE regressions. In both
cases, negative weights are extremely prevalent: around 50% of the weights attached to βf e are
negative, so βf e is not robust to heterogeneous effects in those applications.
Researchers may want to know how serious that issue is in the application they consider. We
show that the absolute value of βf e divided by the standard deviation of the weights is equal
2

to the minimal value of the standard deviation of the ATEs across the treated (g, t) cells under
which the average treatment on the treated (ATT) may actually have the opposite sign than
βf e . One can estimate that ratio to assess the robustness of βf e . If that ratio is close to 0, βf e
and the ATT can be of opposite signs even under a small and plausible amount of treatment
effect heterogeneity. In that case, treatment effect heterogeneity would be a serious concern for
the validity of βf e . On the contrary, if that ratio is very large, βf e and the ATT can only be of
opposite signs under a very large and implausible amount of treatment effect heterogeneity.
Finally, we propose a new estimand that is valid even if the treatment effect is heterogeneous
over time or across groups. This estimand identifies the average treatment effect across all the
(g, t) cells whose treatment changes from t−1 to t. It relies on a variant of the standard common
trends assumption. That condition is partly testable, and we propose a test that amounts to
looking at pre-trends, as in a standard DID analysis. We propose a simple plug-in estimator
of our estimand, and we show that it is asymptotically normal. In Gentzkow et al. (2011), our
estimator is of a different sign than, and significantly different from, the estimator of βf e .1 Our
estimator can be used in applications where, for each pair of consecutive dates, there are groups
whose treatment does not change. We estimate that this condition is satisfied for around 80%
of the papers using two-way fixed effects regressions found in our survey of the AER.
Overall, our paper has implications for applied researchers estimating two-way fixed effects
regressions. First, we recommend that they estimate the weights attached to their regression
and the ratio of βf e divided by the standard deviation of the weights. To do so, they can use the
twowayfeweights Stata package that is available from the SSC repository. If many weights are
negative, and if the ratio is not very large, we recommend that they compute our new estimator,
using the fuzzydid and did_multipleGT Stata packages that can also be downloaded from the
SSC repository (for more explanations on how to use the former package, see de Chaisemartin
et al., 2019).
We extend our results in several important directions. First, another commonly-used regression
is the first-difference regression of Yg,t − Yg,t−1 , the change in the mean outcome in group g, on
period fixed effects and on Dg,t − Dg,t−1 , the change in the treatment. We let βf d denote the
expectation of the coefficient of Dg,t − Dg,t−1 . We show that under common trends, βf d also
identifies a weighted sum of treatment effects, with potentially some negative weights. Second,
we show that our results extend to fuzzy designs, where the treatment varies within (g, t) cells.
Finally, in our Web Appendix, we show that our results also extend to two-way fixed effects
regressions with a non-binary treatment and with covariates in the regression.
Our paper is related to the DID literature. Our main result generalizes Theorem 1 in de Chaisemartin and D’Haultfœuille (2018). When the data has two groups and two periods, the Wald1

Note that the authors do not estimate βf e , but βf d defined below. Our estimator is of the same sign as
theirs, but 66% larger and significantly different.

3

DID estimand considered therein is equal to βf e and βf d . Our results on βf e and βf d are thus
extensions of that theorem to the case with multiple periods and groups.2 Moreover, our WaldTC estimand is related to the Wald-TC estimand with many groups and periods proposed in
de Chaisemartin and D’Haultfœuille (2018), and to the multi-period DID estimand proposed by
Imai and Kim (2018). In Section 3.3, we explain the differences between those three estimands.
More recently, Borusyak and Jaravel (2017), Abraham and Sun (2018), Athey and Imbens (2018),
Callaway and Sant’Anna (2018), and Goodman-Bacon (2018) study the special case of staggered
adoption designs, where the treatment of a group is weakly increasing over time. Those papers
derive some important results specific to that design that we do not consider here. Still, some
of the results in those papers are related to ours, and we describe precisely those connections
later in the paper. The most important dimension on which our paper differs from those is
that our results apply to any two-way fixed effects regressions, not only to those with staggered
adoption. In our survey of the AER papers estimating two-way fixed effects regressions, less
than 10% have a staggered adoption design. This suggests that while staggered adoptions are
an important research design, they may account for a relatively small minority of the applications
where two-way fixed effects regressions have been used.
The paper is organized as follows. Section 2 introduces the set-up. Section 3 presents our results
in sharp designs where all observations in the same (g, t) cell have the same treatment. Section
4 extends those results to fuzzy designs. Section 5 presents some other extensions. Section 6
discusses inference. Section 7 presents our survey of the articles published in the AER, and our
two empirical applications.

2

Set up

One considers observations that can be divided into g + 1 groups and t + 1 periods. For every
(g, t) ∈ {0, ..., g} × {0, ..., t}, let Ng,t denote the number of observations in group g at period
P
t, and let N = g,t Ng,t be the total number of observations. The data may for instance be
an individual-level panel or repeated cross-section data set where groups are, say, individuals’
county of birth. The data could also be a cross-section data set where cohort of birth plays the
role of time. It is also possible that for all (g, t), Ng,t = 1, e.g. a group is one individual or firm.
All of the above are special cases of the data structure we consider.
One is interested in measuring the effect of a treatment on some outcome. Throughout the paper
we assume that treatment is binary, but our results apply to any ordered treatment, as we show in
Section 2.2 of the Web Appendix. Then, for every (i, g, t) ∈ {1, ..., Ng,t }×{0, ..., g}×{0, ..., t}, let
2

In fact, a preliminary version of our main result appeared in a working paper version of de Chaisemartin and
D’Haultfœuille (2018) (see Theorems S1 and S2 in de Chaisemartin and D’Haultfoeuille, 2015).

4

Di,g,t and (Yi,g,t (0), Yi,g,t (1)) respectively denote the treatment status and the potential outcomes
without and with treatment of observation i in group g at period t.
The outcome of observation i in group g and period t is Yi,g,t = Yi,g,t (Di,g,t ). For all (g, t), let
Dg,t

Ng,t
Ng,t
Ng,t
Ng,t
1 X
1 X
1 X
1 X
Di,g,t , Yg,t (0) =
Yi,g,t (0), Yg,t (1) =
Yi,g,t (1), and Yg,t =
Yi,g,t .
=
Ng,t i=1
Ng,t i=1
Ng,t i=1
Ng,t i=1

Dg,t denotes the average treatment in group g at period t, while Yg,t (0), Yg,t (1), and Yg,t respectively denote the average potential outcomes without and with treatment and the average
observed outcome in group g at period t.
We now define the FE regression described in the introduction.3
Regression 1 (Fixed-effects regression)
Let βbf e denote the coefficient of Dg,t in an
 OLS regression of Yi,g,t on group fixed effects, period
b
fixed effects, and Dg,t . Let βf e = E βf e .4
Throughout the paper, we maintain the following assumption.
Assumption 1 (Balanced panel of groups) For all (g, t) ∈ {0, ..., g} × {0, ..., t}, Ng,t > 0.
Assumption 1 requires that no group appears or disappears over time. This assumption is often
satisfied. Without it, our results still hold but the notation becomes more complicated as the
denominators of some of the fractions below may then be equal to zero.
P
Finally, for all g, let Ng,. = tt=0 Ng,t denote the total number of observations in group g. For
P
all t, let N.,t = gg=0 Ng,t denote the total number of observations in period t. For any variable
P
Xg,t defined in each (g, t) cell, let Xg,. = tt=0 (Ng,t /Ng,. )Xg,t denote the average value of Xg,t
P
in group g, let X.,t = gg=0 (Ng,t /N.,t )Xg,t denote the average value of Xg,t in period t, and let
P
X.,. = g,t (Ng,t /N )Xg,t denote the average value of Xg,t . For instance, D3,. and D.,2 respectively
denote the average treatment in group 3 across time and in period 2 across groups, whereas Y.,.
denotes the average value of the outcome across groups and time.
3

Throughout the paper, we assume that the regressors in Regression 1 and Regression 2 below are not
perfectly collinear, so the coefficients of these regressions are well-defined.
4
As the independent variables in Regression 1 are constant within each (g, t) cell, Regression 1 is equivalent to
a (g, t)-level regression of Yg,t on group and period fixed effects and Dg,t , weighted by Ng,t . In fuzzy designs, using
Dg,t rather than the individual treatment ensures that βf e is identified out of comparisons of groups experiencing
different evolutions of their mean treatment over time, and not out of comparisons of observations with different
treatments within the same (g, t) cell, as such comparisons may be plagued by selection bias.

5

3

Results in sharp designs

In this section, we focus on sharp designs with a non-stochastic treatment, as defined by the
following assumption:
Assumption 2 (Sharp designs with a non-stochastic treatment)
1. For all (g, t) ∈ {0, ..., g} × {0, ..., t}, Di,g,t = Dg,t for all i ∈ {1, ..., Ng,t }.
2. For all (g, t) ∈ {0, ..., g} × {0, ..., t}, Dg,t = E(Dg,t ).
Point 1 of Assumption 2 requires that units’ treatments do not vary within each (g, t) cell, a
situation we refer to as a sharp design. This is for instance satisfied when the treatment is a
group-level variable, for instance a county- or a state-law. This is also mechanically satisfied
when Ng,t = 1 for all (g, t). In our literature review in Section 7.1, we find that almost 80%
of the papers using two-way fixed effects regressions and published in the AER between 2010
and 2012 consider sharp designs. We first focus on this special case given its prevalence, before
turning to fuzzy designs in the next section.
Point 2 of Assumption 2 requires that the treatment status of each (g, t) cell be non-stochastic.
This assumption fails when the treatment is randomly assigned. However, two-way fixed effects
regressions are more often used in observational than in experimental studies, as in the latter
case one can use simpler regressions to estimate the treatment effect. In observational settings,
whether the treatment should be considered as fixed or stochastic is less clear. Point 2 of
Assumption 2 is in line with the modelling framework adopted in some articles studying DID,
see e.g. Abadie (2005). And most importantly, we relax that assumption in Section 4 and in
Section 3.1 of the Web Appendix. We just maintain it for now to ease the exposition.
3.1

A decomposition of βf e as a weighted sum of ATEs under common trends

In this section, we study βf e under the following common trends assumption.
Assumption 3 (Common trends) For t ≥ 1, E(Yg,t (0)) − E(Yg,t−1 (0)) does not vary across g.
The common trends assumption requires that the expectation of the outcome without the treatment follow the same evolution over time in every group. This assumption is sufficient for the
DID estimand to identify the ATT in designs with two groups and two periods, and where only
units in group 1 and period 1 get treated (see, e.g., Abadie, 2005).
For any (g, t) ∈ {0, ..., g} × {0, ..., t}, we denote the ATE in cell (g, t) as
!
Ng,t
1 X
∆g,t = E
(Yi,g,t (1) − Yi,g,t (0)) .
Ng,t i=1
6

Let ∆T R denote the ATT. ∆T R is a weighted average of the ATEs of the treated (g, t) cells:
X Ng,t
∆T R =
∆g,t ,
(2)
N1
(g,t):Dg,t =1

P
where N1 = i,g,t Di,g,t is the number of treated observations. We now show that under common
trends, βf e is also equal to a weighted sum of the ∆g,t s, with potentially some negative weights.
Let εg,t denote the residual of observations in cell (g, t) in the regression of Dg,t on group and
period fixed effects:5
Dg,t = α + γg + λt + εg,t .
One can show that if the regressors in Regression 1 are not collinear, the average value of εg,t
P
across all treated (g, t) cells differs from 0: (g,t):Dg,t =1 (Ng,t /N1 )εg,t 6= 0. Then we let wg,t denote
εg,t divided by that average:
εg,t
wg,t = P
.
Ng,t
(g,t):Dg,t =1 N1 εg,t
Theorem 1 Suppose that Assumptions 1-3 hold. Then,
X Ng,t
wg,t ∆g,t .
βf e =
N1
(g,t):Dg,t =1

To illustrate this theorem, we consider a simple example of a staggered adoption design with
two groups and three periods, and where group 0 is only treated at period 2, while group 1 is
treated both at periods 1 and 2. We also assume that Ng,t /Ng,t−1 does not vary across g: all
groups experience the same growth of their number of observations from t − 1 to t, a requirement
that is for instance satisfied when the data is a balanced panel. Then, one can show that
εg,t = Dg,t − Dg,. − D.,t + D.,. ,
thus implying that
ε0,2 = 1 − 1/3 − 1 + 1/2 = 1/6,
ε1,1 = 1 − 2/3 − 1/2 + 1/2 = 1/3,
ε1,2 = 1 − 2/3 − 1 + 1/2 = −1/6.
The residual is negative in group 1 and period 2, because the regression predicts a treatment
probability larger than one in that cell, a classic extrapolation problem with linear regressions.
Then, it follows from Theorem 1 and some algebra that under the common trends assumption,
βf e = 1/2∆0,2 + ∆1,1 − 1/2∆1,2 .
5

εg,t arises from a regression where the dependent and independent variables only vary at the (g, t) level.
Therefore, all the units in the same (g, t) cell have the same value of εg,t .

7

βf e is equal to a weighted sum of the ATEs in group 0 at period 2, group 1 at period 1, and
group 1 at period 2, the three treated (g, t) cells.
However, the weight assigned to each ATE differs from the proportion that the corresponding
cell accounts for in the population of treated observations. Therefore, βf e is not equal to ∆T R ,
the average treatment effect across all treated observations.
Perhaps more worryingly, not all the weights are positive: the weight assigned to the ATE in
group 1 period 2 is strictly negative. Consequently, βf e may be a very misleading measure of the
treatment effect. Assume for instance that ∆0,2 = ∆1,1 = 1 and ∆1,2 = 4. At the period when
they start receiving the treatment, both groups experience a modest positive ATE. But this
effect builds over time and in period 2, one period after it has started receiving the treatment,
group 1 now experiences a large ATE. Then,
βf e = 1/2 × 1 + 1 − 1/2 × 4 = −1/2.
βf e is strictly negative, while ∆0,2 , ∆1,1 , and ∆1,2 are all positive. More generally, the negative
weights are an issue if the ∆g,t s are heterogeneous, across groups or over time.6 if ∆0,2 = ∆1,1 =
∆1,2 = 1, then βf e = 1, the average treatment effect across all treated observations.
Here is some intuition as to why one weight is negative in this example. It follows from Equation
(8) in the proof of Theorem 1 (see also Theorem 1 in Goodman-Bacon, 2018) that in this simple
example, βf e = (DID1 + DID2 )/2, with
DID1 = E(Y1,1 ) − E(Y1,0 ) − (E(Y0,1 ) − E(Y0,0 )) ,
DID2 = E(Y0,2 ) − E(Y0,1 ) − (E(Y1,2 ) − E(Y1,1 )) .
The first DID compares the evolution of the mean outcome from period 0 to 1 in group 1 and
in group 0. The second one compares the evolution of the mean outcome from period 1 to 2 in
group 0 and in group 1. The control group in the second DID, group 1, is treated both in the
pre and in the post period. Therefore, under the common trends assumption, it follows from
Lemma 1 in Appendix A (a similar result appears in Lemma 1 of de Chaisemartin (2011), and
in Equation (13) of Goodman-Bacon (2018)) that DID1 = ∆1,1 , but
DID2 = ∆0,2 − (∆1,2 − ∆1,1 ).
DID2 is equal to the average treatment effect in group 0 period 2, minus the change in the
average treatment effect of group 1 between periods 2 and 1. Intuitively, the mean outcome of
groups 0 and 1 may follow different trends from period 1 to 2 either because group 0 becomes
treated, or because the treatment effect changes in group 1.
6

On the other hand, βf e does not rule out heterogeneous treatment effects within (g, t) cells, as it is identified
by variations across (g, t) cells, and does not leverage any within-cell variation.

8

We now generalize the previous illustration by characterizing the (g, t) cells whose ATEs are
weighted negatively by βf e .
Proposition 1 Suppose that Assumptions 1-2 hold and for all t ≥ 1 Ng,t /Ng,t−1 does not vary
across g. Then, for all (g, t) such that Dg,t = 1, wg,t is decreasing in D.,t and Dg,. .
Proposition 1 shows that βf e is more likely to assign a negative weight to periods where a large
fraction of groups are treated, and to groups treated for many periods. Then, negative weights
are a concern when treatment effects differ between periods with many versus few treated groups,
or between groups treated for many versus few periods.
Proposition 1 has interesting implications in staggered adoption designs, a special case of sharp
designs defined as follows.
Assumption 4 (Staggered adoption designs) For all g, Dg,t ≥ Dg,t−1 for all t ≥ 1.
Assumption 4 is satisfied in applications where groups adopt a treatment at heterogeneous dates
(see e.g. Athey and Stern, 2002). In that design, Borusyak and Jaravel (2017) show that βf e is
more likely to assign a negative weight to treatment effects at the last periods of the panel. This
result is a special case of Proposition 1. In staggered adoption designs, D.,t is increasing in t, so
Proposition 1 implies that wg,t is decreasing in t.7 Proposition 1 also implies that in that design,
groups that adopt the treatment earlier are more likely to receive some negative weights.
3.2

Assessing the robustness of βf e to heterogeneous treatment effects

Theorem 1 shows that in sharp designs with many groups and periods, βf e may be a misleading
measure of the treatment effect under the standard common trends assumption, if the ∆g,t s are
heterogeneous. In the corollary below, we propose two summary measures that can be used to
assess how serious that concern is. For any variable Xg,t defined in each (g, t) cell we let X
denote the vector (Xg,t )(g,t)∈{0,...,g}×{0,...,t} collecting the values of that variable in each (g, t) cell.
For instance, ∆ denotes the vector (∆g,t )(g,t)∈{0,...,g}×{0,...,t} collecting the ATE in each of the
(g, t) cells. Let

1/2
X Ng,t
2
σ(∆) = 
∆g,t − ∆T R  ,
N1
(g,t):Dg,t =1

1/2
X Ng,t
σ(w) = 
(wg,t − 1)2  .
N1
(g,t):Dg,t =1

7

Borusyak and Jaravel (2017) assume that the treatment effect of cell (g, t) only depends on the number of
periods since group g has started receiving the treatment, whereas Proposition 1 does not rely on that assumption.

9

σ(∆) is the standard deviation of the ATEs, and σ(w) is the standard deviation of the wweights,8 across the treated (g, t) cells. Let n = #{(g, t) : Dg,t = 1} denote the number of
treated cells. For every i ∈ {1, ..., n}, let w(i) denote the ith largest of the weights of the
treated cells: w(1) ≥ w(2) ≥ ... ≥ w(n) , and let N(i) and ∆(i) be the number of observations
P
and the ATE of the corresponding cell. Then, for any k ∈ {1, ..., n}, let Pk = i≥k N(i) /N1 ,
P
P
2
Sk = i≥k (N(i) /N1 )w(i) and Tk = i≥k (N(i) /N1 )w(i)
.
Corollary 1 Suppose that Assumptions 1-3 hold.
1. If σ(w) > 0, the minimal value of σ(∆) compatible with βf e and ∆T R = 0 is
σf e =

|βf e |
.
σ(w)

2. If βf e 6= 0 and at least one of the wg,t weights is strictly negative, the minimal value of
σ(∆) compatible with βf e and with ∆g,t of a different sign than βf e for all (g, t) is
σf e =

|βf e |
[Ts + Ss2 /(1 − Ps )]1/2

,

where s = min{i ∈ {1, ..., n} : w(i) < −S(i) /(1 − P(i) )}.
An estimator of σ f e can be used to assess the robustness of βf e to treatment effect heterogeneity
across groups and periods. If σ f e is close to 0, βf e and ∆T R can be of opposite signs even under
a small and plausible amount of treatment effect heterogeneity. In that case, treatment effect
heterogeneity would be a serious concern for the validity of βf e . On the contrary, if σ f e is very
large, βf e and ∆T R can only be of opposite signs under a very large and implausible amount of
treatment effect heterogeneity. Then, treatment effect heterogeneity is less of a concern.
Similarly, if σ f e is close to 0, one may have, say, βf e > 0, while ∆g,t ≤ 0 for all (g, t), even if the
dispersion of the ∆g,t s across (g, t) cells is relatively small. Notice that σ f e is only defined if at
least one of the weights is strictly negative: if all the weights are positive, then one cannot have
that βf e is of a different sign than all the ∆g,t s.
When some of the weights wg,t are negative, βf e may still be robust to heterogeneous treatment
effects across groups and periods, provided the assumption below is satisfied.
Assumption 5 (w uncorrelated with ∆)

P

(g,t):Dg,t =1 (Ng,t /N1 )(wg,t

Corollary 2 If Assumptions 1-3 and 5 hold, then βf e = ∆T R .
8

One can show that

P

(g,t):Dg,t =1 (Ng,t /N1 )wg,t

= 1.

10

− 1)(∆g,t − ∆T R ) = 0.

Assumption 5 requires that the weights attached to βf e be uncorrelated with the ∆g,t s. This
is often implausible. For instance, periods with the highest proportion of treated units are also
those with the lowest value of wg,t , as shown in Proposition 1. But those periods may also be
those with the largest treatment effect: more groups may choose to get treated at periods where
the treatment effect is the highest. This would then induce a negative correlation between w
and ∆. The plausibility of Assumption 5 can be assessed, by looking at whether w is correlated
with a predictor of the treatment effect in each (g, t) cell. In the two applications we revisit in
Section 7, this test is rejected.
3.3

An alternative estimand

In this section, we propose a new estimand that identifies a causal effect even if treatment effects
are heterogeneous, across groups or over time. That causal effect is
∆S =

X
(g,t):Dg,t 6=Dg,t−1 ,t≥1

Ng,t
∆g,t ,
NS

P
where NS = (g,t):t≥1,Dg,t 6=Dg,t−1 Ng,t . ∆S is the average ATE of all switching cells. In staggered
adoption designs, ∆S is the average of the instantaneous treatment effect at the time when a
group starts receiving the treatment, across all groups that become treated at some point.
We now show that ∆S is identified by a weighted average of DID estimands. This result holds
under Assumptions 6 and 7 below.
Assumption 6 (Common trends for groups with the same treatment at t − 1)
1. For all t ≥ 1 and g such that Dg,t−1 = 0, E(Yg,t (0)) − E(Yg,t−1 (0)) does not vary across g.
2. For all t ≥ 1 and g such that Dg,t−1 = 1, E(Yg,t (1)) − E(Yg,t−1 (1)) does not vary across g.
Assumption 6 requires that between each pair of consecutive periods, the expectation of the
outcome without treatment follow the same evolution over time in every group untreated at
t − 1, and that the expectation of the outcome with treatment follow the same evolution in every
group treated at t − 1. In staggered adoption designs, only Point 1 of Assumption 6 is necessary
for Theorem 2 below to hold, and Point 1 of Assumption 6 is weaker than Assumption 3, the
standard common trends assumption. Outside of staggered adoption designs, both Points 1 and
2 are necessary, so Assumptions 3 and 6 are non-nested. However, Points 1 and 2 are arguably
a natural generalization of the identifying assumption in standard two-groups two-periods sharp
DID designs (see Abadie, 2005): they require that groups sharing the same treatment at time
t − 1 would experience the same evolution of their mean outcome from t − 1 to t if they did not
change their treatment from t − 1 to t. Importantly, Points 1 and 2 do not restrict treatment
11

effect heterogeneity for any group or period, as they only put restriction on one of the two
potential outcomes.9
Assumption 7 (Existence of “stable” groups) For all t ∈ {1, ..., t}:
1. If there is at least one g ∈ {0, ..., g} such that Dg,t−1 = 0 and Dg,t = 1, then there exists at
least one g 0 6= g, g 0 ∈ {0, ..., g} such that Dg0 ,t−1 = Dg0 ,t = 0.
2. If there is at least one g ∈ {0, ..., g} such that Dg,t−1 = 1, Dg,t = 0, then there exists at
least one g 0 6= g, g 0 ∈ {0, ..., g} such that Dg0 ,t−1 = Dg0 ,t = 1.
The first point of the stable groups assumption requires that between each pair of consecutive
time periods, if there is a group that switches from being untreated to treated, then there should
be another group that remains untreated at both dates. The second point requires that between
each pair of consecutive time periods, if there is a group that switches from being treated to
untreated, then there should be another group that remains treated at both dates.
We can now define our estimand. For all t ∈ {1, ..., t} and for all (d, d0 ) ∈ {0, 1}2 , let
X

Nd,d0 ,t =

Ng,t

(3)

g:Dg,t =d,Dg,t−1 =d0

denote the number of observations with treatment d0 at period t − 1 and d at period t. Let
DID+,t =

X
g:Dg,t =1,Dg,t−1

DID−,t =

X
g:Dg,t =Dg,t−1

X
Ng,t
(E(Yg,t ) − E(Yg,t−1 )) −
N1,0,t
g:D =D
=0
g,t

Ng,t
(E(Yg,t ) − E(Yg,t−1 )) −
N1,1,t
=1
g:D

g,t−1

X

g,t =0,Dg,t−1

Ng,t
(E(Yg,t ) − E(Yg,t−1 )) ,
N
0,0,t
=0
Ng,t
(E(Yg,t ) − E(Yg,t−1 )) .
N0,1,t
=1

Note that DID+,t is not defined when there is no group such that Dg,t = 1, Dg,t−1 = 0. In
such instances, we let DID+,t = 0. Similarly, let DID−,t = 0 when there is no group such that
Dg,t = 0, Dg,t−1 = 1. Finally, let
WT C =

t 
X
N1,0,t
t=1

NS


N0,1,t
DID+,t +
DID−,t .
NS

Theorem 2 If Assumptions 1, 2, 6, and 7 hold, then WT C = ∆S .
Here is the intuition underlying our identification result. DID+,t compares the evolution of the
mean outcome in two sets of groups: those switching from no treatment to treatment between
9

Such restrictions would only arise if we imposed common trends on Y (0) and Y (1) for all groups and periods
of time. In such a case, ∆g,t would have to be additively separable in g and t, which still allows for heterogeneous
treatment effects across groups and over time.

12

t − 1 and t, and those remaining untreated. Because the groups in these two sets have the same
treatment in t−1, under Assumption 6 DID+,t identifies the treatment effect in groups switching
from no treatment to treatment. Similarly, DID−,t compares the evolution of the outcome in two
sets of groups: those remaining treated between t − 1 and t, and those switching from treatment
to no treatment. Under Assumption 6, it identifies the treatment effect in groups switching
from treatment to no treatment. Finally, WT C is a weighted average of those DID estimands.
Note that in staggered adoption designs, there are no groups whose treatment decreases over
time, so WT C is only a weighted average of the DID+,t estimands. The corresponding Wald-TC
estimator is computed by the fuzzydid and did_multipleGT Stata packages.
WT C is related to two other estimands. First, it is related to the Wald-TC estimand in point
2 of Theorem S1 in the Web Appendix of de Chaisemartin and D’Haultfœuille (2018), but
the weighting of the DID+,t and DID−,t estimands differ. As a result, WT C identifies ∆S
under weaker assumptions. WT C is also related to the multi-period DID estimand proposed by
Imai and Kim (2018). There are two differences between those estimands. First, the multiperiod DID estimand is a weighted average of the DID+,t estimands, so it does not identify
the treatment effect in the groups switching out of treatment. Second, Imai and Kim (2018)
do not generalize their estimand to fuzzy designs, something we do in the next section, and to
non-binary treatments, something we do in the Web Appendix (see Section 3.2 therein).
The Wald-TC uses groups whose treatment is stable to infer the trends that would have affected
the groups whose treatment changes if their treatment had not changed. This strategy could
fail, if groups whose treatment changes experience different trends than groups whose treatment
is stable. To assess if this is a serious concern, we propose to use the following placebo estimand,
that essentially compares the outcome’s evolution from t − 2 to t − 1, in groups that switch and
do not switch treatment between t − 1 and t. This placebo estimand is defined under a modified
version of Assumption 7.
Assumption 8 (Existence of “stable” groups for placebo tests) For all t ∈ {2, ..., t}:
1. If there is at least one g ∈ {0, ..., g} such that Dg,t−2 = Dg,t−1 = 0 and Dg,t = 1, then there
exists at least one g 0 6= g, g 0 ∈ {0, ..., g} such that Dg0 ,t−2 = Dg0 ,t−1 = Dg0 ,t = 0.
2. If there is at least one g ∈ {0, ..., g} such that Dg,t−2 = Dg,t−1 = 1, Dg,t = 0, then there
exists at least one g 0 6= g, g 0 ∈ {0, ..., g} such that Dg0 ,t−2 = Dg0 ,t−1 = Dg0 ,t = 1.
For all t ∈ {2, ..., t} and for all (d, d0 , d00 ) ∈ {0, 1}3 , let
X

Nd,d0 ,d00 ,t =

g:Dg,t =d,Dg,t−1

13

=d0 ,D

Ng,t
g,t−2

=d00

denote the number of observations with treatment status d00 at period t − 2, d0 at period t − 1,
and d at period t. Let
NSpl =

X

Ng,t ,

(g,t):t≥2,Dg,t 6=Dg,t−1 =Dg,t−2
pl
DID+,t
=

X
g:Dg,t =1,Dg,t−1 =Dg,t−2 =0

pl
DID−,t
=

X
g:Dg,t =Dg,t−1 =Dg,t−2 =1

Ng,t
(E(Yg,t−1 ) − E(Yg,t−2 )) −
N1,0,0,t

Ng,t
(E(Yg,t−1 ) − E(Yg,t−2 )) −
N1,1,1,t

X
g:Dg,t =Dg,t−1 =Dg,t−2 =0

X
g:Dg,t =0,Dg,t−1 =Dg,t−2 =1

Ng,t
(E(Yg,t−1 ) − E(Yg,t−2 )) ,
N0,0,0,t
Ng,t
(E(Yg,t−1 ) − E(Yg,t−2 )) .
N0,1,1,t

pl
Note that DID+,t
is not defined when there is no group such that Dg,t = 1, Dg,t−1 = Dg,t−2 = 0.
pl
pl
In such instances, we let DID+,t
= 0. Similarly, let DID−,t
= 0 when there is no group such
that Dg,t = 0, Dg,t−1 = Dg,t−2 = 1. Then, let

WTplC

=

t
X

N1,0,0,t

t=2

NSpl

pl
DID+,t

+

N0,1,1,t
NSpl

!
pl
DID−,t

.

Theorem 3 If Assumptions 1, 2, 6, and 8 hold, then WTplC = 0.
pl
DID+,t
compares the evolution of the mean outcome from t − 2 to t − 1 in two sets of groups:
those untreated at t − 2 and t − 1 but treated at t, and those untreated at t − 2, t − 1, and
pl
pl
t. If Assumption 6 holds, then DID+,t
= 0. Similarly, if Assumption 6 holds, DID−,t
= 0.
pl
pl
Then, WT C = 0 is a testable implication of Assumption 6, so finding WT C 6= 0 would imply that
Assumption 6 is violated: groups that switch treatment experience different trends before that
switch than the groups used to reconstruct their counterfactual trends when they switch.10

In staggered adoption designs, we have, for all t ≥ 2,
Dg,t > Dg,t−1 ⇔ Dg,t > Dg,t−1 = Dg,t−2 ,
Dg,t = Dg,t−1 = 0 ⇔ Dg,t = Dg,t−1 = Dg,t−2 = 0.
Groups whose treatment increases from t − 1 to t must have a stable treatment from t − 2 to
t − 1, and groups untreated at t and t − 1 must also be untreated at t − 2. Then, Assumptions
7 and 8 are equivalent, and WTplC closely mimicks WT C : WTplC is equal to WT C , after replacing
the mean outcome in group g and at period t by its lagged value. Outside of staggered adoption
designs, some of the (g, t) cells that are used in the computation of WT C are excluded from
that of WTplC , because their treatment changes from t − 2 to t − 1. Finally, WTplC compares the
trends of switching and stable groups one period before the switch. It is easy to define other
placebo estimands comparing those trends, say, two or three periods before the switch. The
corresponding placebo estimators are computed by the fuzzydid and did_multipleGT Stata
package.
10

See also Callaway and Sant’Anna (2018), who propose another placebo test in staggered adoption designs.

14

4

Results in fuzzy designs

In this section, the research design may be fuzzy: the treatment may vary within (g, t) cells.
For instance, Enikolopov et al. (2011) study the effect of having access to an independent TV
channel in Russia, and in each Russian region some people have access to that channel while
other people do not. The treatment may also be stochastic.
As the numbers 1,...,Ng,t assigned to the observations of a (g, t) cell play no role, one can
always assume that those numbers are randomly assigned. Therefore, we assume hereafter that
conditional on D, the vector stacking together all the Dg,t s, all the variables indexed by i (e.g.,
Di,g,t or Yi,g,t (0)) are identically distributed within each (g, t) cell.
4.1

Generalizing the decomposition of βf e to fuzzy designs

With a stochastic treatment, we study βf e under a modified common trends assumption.
Assumption 9 (Common trends when the treatment is stochastic) For all t ≥ 1, E(Yg,t (0)|D)−
E(Yg,t−1 (0)|D) almost surely does not vary across g.
Assumption 9 requires that conditional on any realization of D, the expectation of the outcome
without the treatment follow the same evolution over time in every group. Assuming common
trends conditional on the Dg,t s is necessary for identification due to the stochastic nature of the
treatment, as we explain in further detail in Section 3.1 of the Web Appendix. Other articles
that have studied DID with a stochastic treatment have also imposed conditional common trends
assumptions similar to Assumption 9, see e.g. Assumption 1 in Conley and Taber (2011). Finally,
note that under Assumption 2 (sharp designs with a non-stochastic treatment), Assumption 9
reduces to Assumption 3.
For any (g, t) ∈ {0, ..., g} × {0, ..., t}, let
∆Tg,tR (D)

Ng,t
1 X
=
E (Yi,g,t (1) − Yi,g,t (0)|Di,g,t = 1, D)
Ng,t i=1

denote the average treatment effect on the treated (ATT) in cell (g, t), conditional on D. Then
!
X Ng,t Dg,t
∆T R = E
∆Tg,tR (D) ,
N
1
g,t
which generalizes (2) when treatments are stochastic. Theorem 4 shows that βf e is also equal
to the expectation of a weighted sum of the ∆Tg,tR (D)s. Let
εg,t
.
Ng,t Dg,t
ε
g,t
g,t
N1

TR
wg,t
=P

15

Theorem 4 Suppose that Assumptions 1 and 9 hold. Then,
βf e = E

X Ng,t Dg,t
N1

g,t

!
TR TR
wg,t
∆g,t (D) .

Theorem 4 shows that in fuzzy designs, βf e is equal to the expectation of a weighted sum of the
ATTs in each (g, t) cell. Again, some of the weights may be strictly negative. Note that under
Assumption 2, Theorem 4 reduces to Theorem 1 in the previous section. One can also show
that in sharp designs with a stochastic treatment, Theorem 1 still holds, conditional on any
realization of D. Overall, Theorem 4 generalizes Theorem 1 to situations where Assumption 3
fails, either because the design is not sharp, or because the treatment is stochastic. In staggered
adoption designs, Athey and Imbens (2018) derive a decomposition of βf e that resembles to, but
differs from, that in Theorem 4. They derive their decomposition under the assumption that
the dates at which each group starts receiving the treatment are randomly assigned, while we
derive ours under a common trends assumption.
The weights have a simple expression in the following special case.
Assumption 10 (Heterogenous adoption) t = 1 and for all g ∈ {0, ..., g}, Dg,1 > Dg,0 = 0.
Assumption 10 is satisfied in applications with two time periods, and where all groups are fully
untreated at t = 0 and partly treated at t = 1. This type of design often arises in practice, for
instance when an innovation is heterogeneously adopted by various groups.
Proposition 2 If Assumptions 1, 9, and 10 hold and Ng,1 /Ng,0 does not vary across g, then11
Dg,1 − D.,1
Ng,1
g=0 N1 (Dg,1 −

TR
wg,1
= Pg

D.,1 )2

.

Proposition 2 shows that in the heterogeneous adoption design, βf e assigns negative weights to
the period-one ATT of groups with a mean treatment lower than the mean treatment in the
full population. The reason why negative weights arise is intuitive. With two periods, the FE
regression is equivalent to a regression of the first difference of the outcome on the period-one
treatment in each group. This regression compares the evolution of the outcome in more- and
less-treated groups. Doing so, it subtracts the treatment effect of the less-treated groups, hence
the negative weights. Negative weights are a concern if the ATTs of the less- and more-treated
groups systematically differ. This could be the case if treatment is determined by a Roy selection
model. Then, the groups with the highest proportion of treated units could also be those where
the ATT is the highest. On the other hand, if the proportion of treated units is randomly
assigned to each group, negative weights are not a concern.12
TR
Under Assumption 10, Dg,0 = 0, so wg,0
does not enter in the decomposition in Theorem 4.
Corollary 2 extends directly to fuzzy settings. Corollary 1 also extends to such cases, though the sensitivity
measure we propose is now a random variable, as it is a function of D. We discuss this issue in more details in
Section 4.1 of the Web Appendix.
11
12

16

4.2

Generalizing the Wald-TC estimand to fuzzy designs

In this section, we show that in fuzzy designs, a causal effect similar to the causal effect ∆S
defined above is identified by an estimand similar to the Wald-TC estimand defined above. In
other words, we generalize Theorem 2 to fuzzy designs.
We start by introducing some new notation. For all (i, g, t) ∈ {1, ..., Ng,t } × {0, ..., g} × {0, ..., t}
and for every t0 ∈ {0, ..., t}, let Di,g,t (t0 ) denote the period-t0 treatment of unit i in group
g and period t. When the data are an individual-level panel, those variables are observed:
Di,g,t (t0 ) = Di,g,t0 , Di,g,t (t0 ) is just the treatment of unit i in group g at time t0 . In sharp designs,
those variables are also observed. As the treatment is assigned at the (g, t)-level, the period-t0
treatment of unit i in group g and period t is the same as the treatment status of units in
group g at period t0 : Di,g,t (t0 ) = Dg,t0 . On the other hand, in fuzzy designs, and when the data
are repeated cross-sections or a cross-section where cohort of birth plays the role of time, only
Di,g,t (t) = Di,g,t is observed. In the latter case, the Di,g,t (t0 )s are potential treatments: Di,g,t (t0 )
is the treatment status of individual i in group g and cohort t if she had been born in cohort t0 .
As we assume that the random variables attached to each observation are identically distributed

within each (g, t) cell, (D1,g,t (t0 ))t0 ∈{0,...,t} , Y1,g,t (0), Y1,g,t (1) , the treatments and potential outcomes of the first observation in cell (g, t) have the same distribution as the treatments and
potential outcomes of all observations in the same cell. We make the following assumptions.
Assumption 11 (Treatment monotonicity) For all (g, t) ∈ {1, ..., g} × {1, ..., t},
1. P (D1,g,t (t − 1) = 1) = P (D1,g,t−1 (t − 1) = 1).
2. Either P (D1,g,t (t) ≥ D1,g,t (t − 1)) = 1, or P (D1,g,t (t) ≤ D1,g,t (t − 1)) = 1.
First, Point 1 requires that in each group, the probability of getting treated at time t − 1 is
the same among units observed at periods t and t − 1. If the data is a balanced panel, the
units observed at different periods are the same, so this requirement is automatically satisfied:
P (D1,g,t (t − 1) = 1) = P (D1,g,t−1 = 1). With cohort-of-birth data, this requirement could fail:
for instance, the treatment probability of units born in year t − 1 may differ from the treatment
probability of the cohort born in t if it had been born in t−1. This requirement is plausible when
consecutive cohorts have similar propensities for treatment. Then, Point 2 requires that in each
group, either the treatments of all units observed at period t weakly increase from period t − 1 to
t, or their treatments weakly decrease. This is similar in spirit to the monotonicity assumption in
Imbens and Angrist (1994), with time as the instrument. With panel data, one can assess from
the data whether Point 2 holds or not.13 With repeated-cross-sections or cohort-of-birth data,
13

This test may reveal that Point 2 fails, but our results still hold if the treatments satisfy the threshold crossing
Equation (3.2) in de Chaisemartin and D’Haultfœuille (2018), which is weaker than Point 2 of Assumption 11.

17

Point 2 is untestable. Note that Assumption 11 is automatically satisfied under Assumption 2
(sharp designs with a non-stochastic treatment).
Assumption 12 (Conditional common trends) For all t ≥ 1,
1. E (Y1,g,t (0)|D1,g,t (t − 1) = 0) − E (Y1,g,t−1 (0)|D1,g,t−1 (t − 1) = 0) does not vary across g.
2. E (Y1,g,t (1)|D1,g,t (t − 1) = 1) − E (Y1,g,t−1 (1)|D1,g,t−1 (t − 1) = 1) does not vary across g.
Point 1 requires that for all t ≥ 1, the evolution from t − 1 to t of the mean Y (0) among units
untreated at t − 1 be the same in every group. Similarly, Point 2 requires that for all t ≥ 1, the
evolution from t − 1 to t of the mean Y (1) of units treated at t − 1 be the same in every group.
Note that under Assumption 2, Assumption 12 reduces to Assumption 6.
Assumption 13 (Existence of “stable” groups) For all t ∈ {1, ..., t}:
1. If there is at least one g ∈ {0, ..., g} such that 0 < E(Dg,t−1 ) 6= E(Dg,t ), then there is at
least one g 0 6= g, g 0 ∈ {0, ..., g} such that 0 < E(Dg0 ,t−1 ) = E(Dg0 ,t ).
2. If there is at least one g ∈ {0, ..., g} such that 1 > E(Dg,t−1 ) 6= E(Dg,t ), then there is at
least one g 0 6= g, g 0 ∈ {0, ..., g} such that 1 > E(Dg0 ,t−1 ) = E(Dg0 ,t ).
Point 1 requires that between each pair of consecutive time periods, if there is a group with
some treated units at t − 1 whose mean treatment changes from t − 1 to t, then there should
be another group with some treated units at t − 1 whose mean treatment remains stable from
t − 1 to t. Similarly, Point 2 requires that if there is a group with some untreated units at t − 1
whose mean treatment changes from t − 1 to t, then there should be another group with some
untreated units at t − 1 whose mean treatment remains stable from t − 1 to t. Again, under
Assumption 2, Assumption 13 reduces to Assumption 7.
In fuzzy designs, the causal effect identified by our estimand is
˜S =
∆

X Ng,t (P (D1,g,t (t) 6= D1,g,t (t − 1))
E(Y1,g,t (1) − Y1,g,t (0)|D1,g,t (t) 6= D1,g,t (t − 1)),
PS

(g,t),t≥1

P
˜ S is a weighted average of the LATE of
where PS = (g,t),t≥1 Ng,t (P (D1,g,t (t) 6= D1,g,t (t − 1))). ∆
switchers in each (g, t) cell, where each (g, t) cell receives a weight proportional to its expected
number of switchers. It is also the probability limit of switchers’ LATE,
1
#{(i, g, t) : t ≥ 1, Di,g,t (t) 6= Di,g,t (t − 1)}

X
(i,g,t):Di,g,t (t)6=Di,g,t (t−1),t≥1

if all the (g, t) cells grow large and units are independent within cells.
18

(Yi,g,t (1) − Yi,g,t (0)),

We can now define our Wald-TC estimand in fuzzy designs. First, for any t ≥ 1, let
X

N+,t =

Ng,t ,

g:E(Dg,t )>E(Dg,t−1 )

X

N−,t =

Ng,t ,

g:E(Dg,t )<E(Dg,t−1 )

X

N=,t =

Ng,t

g:E(Dg,t )=E(Dg,t−1 )

denote the number of observations at period t in groups whose mean treatment respectively
increases, decreases, and remains stable between periods t − 1 and t. Let also
X
N1,=,t =
Ng,t E(Dg,t )
g:E(Dg,t )=E(Dg,t−1 )

denote the expected number of treated observations at period t in groups whose mean treatment
remains stable between periods t − 1 and t. Then, let
δ0,t =

X
g:E(Dg,t )=E(Dg,t−1 )

δ1,t =

X
g:E(Dg,t )=E(Dg,t−1 )

Ng,t (1 − E(Dg,t ))
(E(Y1,g,t |D1,g,t = 0) − E(Y1,g,t−1 |D1,g,t−1 = 0)) ,
N=,t − N1,=,t
Ng,t E(Dg,t )
(E(Y1,g,t |D1,g,t = 1) − E(Y1,g,t−1 |D1,g,t−1 = 1))
N1,=,t

respectively denote the change of the mean outcome of untreated and treated observations from
t − 1 to t, in groups whose mean treatment remains stable between t − 1 and t. Then, let
p+,t−1 =

X
g:E(Dg,t )>E(Dg,t−1 )

p−,t−1 =

X
g:E(Dg,t )<E(Dg,t−1 )

Ng,t E(Dg,t−1 )
,
N+,t
Ng,t E(Dg,t−1 )
.
N−,t

p+,t−1 (resp. p−,t−1 ) is the weighted average of the treatment probabilities at period t − 1 of
groups whose mean treatment increases (resp. decreases) between periods t − 1 and t, where
groups are weighted by their number of observations at period t.
Our estimand is a weighted average of the following estimands:
P
Ng,t
g:E(Dg,t )>E(Dg,t−1 ) N+,t (E(Yg,t ) − (E(Yg,t−1 ) + (1 − p+,t−1 )δ0,t + p+,t−1 δ1,t ))
WT C,+,t =
,
P
Ng,t
(E(D
)
−
E(D
))
g,t
g,t−1
g:E(Dg,t )>E(Dg,t−1 ) N+,t
P
Ng,t
g:E(Dg,t )<E(Dg,t−1 ) N−,t (E(Yg,t ) − (E(Yg,t−1 ) + (1 − p−,t−1 )δ0,t + p−,t−1 δ1,t ))
.
WT C,−,t =
P
Ng,t
g:E(Dg,t )<E(Dg,t−1 ) N−,t (E(Dg,t−1 ) − E(Dg,t ))

19

Under Assumption 2, WT C,+,t = DID+,t . Indeed, one then has p+,t−1 = 0, as all groups whose
treatment increases between t − 1 and t are fully untreated at period t − 1. Moreover,
X
Ng,t
δ0,t =
(E(Yg,t ) − E(Yg,t−1 )) ,
N
0,0,t
g:D =D
=0
g,t

g,t−1

as the groups whose mean treatment is stable from t − 1 to t are fully untreated or fully treated
at both dates, and the latter groups do not have untreated units. Likewise, WT C,−,t = DID−,t .
Finally, let
P
w+,t = Pt

g:E(Dg,t )>E(Dg,t−1 )

t=1

P
w−,t = Pt
WT C =

t
X

g:E(Dg,t )6=E(Dg,t−1 ) Ng,t |E(Dg,t ) − E(Dg,t−1 )|

g:E(Dg,t )<E(Dg,t−1 )

t=1

Ng,t (E(Dg,t ) − E(Dg,t−1 ))

P

Ng,t (E(Dg,t−1 ) − E(Dg,t ))

P

g:E(Dg,t )6=E(Dg,t−1 ) Ng,t |E(Dg,t ) − E(Dg,t−1 )|

,
,

(w+,t WT C,+,t + w−,t WT C,−,t ) .

(4)

t=1

Under Assumption 2, the Wald-TC estimand above is equal to that defined in Section 3.
˜ S.
Theorem 5 Suppose that Assumption 1 and Assumptions 11-13 hold, then WT C = ∆
Theorem 5 generalizes Theorem 2 to fuzzy designs. Here is the reasoning underlying that result.
First, in all the groups where the mean treatment is stable between t − 1 and t,
E(Y1,g,t |D1,g,t = 0) − E(Y1,g,t−1 |D1,g,t−1 = 0)
=E(Y1,g,t (0)|D1,g,t (t) = 0) − E(Y1,g,t−1 (0)|D1,g,t−1 (t − 1) = 0)
=E(Y1,g,t (0)|D1,g,t (t − 1) = 0) − E(Y1,g,t−1 (0)|D1,g,t−1 (t − 1) = 0).
Indeed, treatment monotonicity implies that in those groups, D1,g,t (t) = D1,g,t (t − 1). The
previous display and Assumption 12 then imply that δ0,t identifies the evolution of Y1,g,t that
units untreated at t − 1 would have experienced from t − 1 to t if they had remained untreated at
t. Similarly, δ1,t identifies the evolution of Y1,g,t that units treated at t−1 would have experienced
if they had remained treated. Then, in groups where the proportion of treated units increases,
E(Yg,t−1 ) + (1 − p+,t−1 )δ0,t + p+,t−1 δ1,t
identifies the mean outcome one would have observed at period t if the proportion of treated units
had not increased. Consequently, the numerator of WT C,+,t compares the period-t outcome in
those groups to what this outcome would have been if some switchers had not become treated.
The denominator of WT C,+,t identifies the proportion of switchers, so WT C,+,t identifies their
LATE. Similarly, WT C,−,t identifies the LATE of switchers in groups where the proportion of
treated units diminishes from t − 1 to t. Eventually, WT C averages those LATEs across periods.
Finally, Assumption 12 can be tested by computing a placebo estimand generalizing WTplC to
fuzzy designs, if for any t ≥ 2 there are groups whose mean treatment is stable from t − 2 to t.
20

5
5.1

Extensions
A decomposition of βf d as a weighted sum of ATEs under common trends

Instead of Regression 1, many articles have estimated the first-difference regression defined below:
Regression 2 (First-difference regression)
Let βbf d denote the coefficient of Dg,t − Dg,t−1 in an OLS regression of Yg,t − Yg,t−1on period fixed
effects and Dg,t − Dg,t−1 , among observations for which t ≥ 1. Let βf d = E βbf d .
When t = 1 and Ng,1 /Ng,0 does not vary across g, meaning that all groups experience the same
growth of their number of units from period 0 to 1, one can show that βf e = βf d . βf e differs
from βf d if t > 1 or Ng,1 /Ng,0 varies across g.
We start by showing that a result similar to Theorem 1 also applies to βf d . For any (g, t) ∈
{0, ..., g} × {1, ..., t}, let εf d,g,t denote the residual of observations in group g and at period t in
the regression of Dg,t − Dg,t−1 on a constant and period fixed effects, among observations for
which t ≥ 1. For any g ∈ {0, ..., g}, let εf d,g,0 = 0, εf d,g,t+1 = 0. One can show that if the
regressors in Regression 2 are not perfectly collinear,

X Ng,t 
Ng,t+1
εf d,g,t+1 6= 0.
εf d,g,t −
N1
Ng,t
(g,t):Dg,t =1

Then we define
wf d,g,t

εf d,g,t − NNg,t+1
εf d,g,t+1
 g,t
.
=P
Ng,t+1
Ng,t
ε
−
ε
f d,g,t
(g,t):Dg,t =1 N1
Ng,t f d,g,t+1

Theorem 6 Suppose that Assumptions 1-3 hold. Then,
X Ng,t
wf d,g,t ∆g,t .
βf d =
N1
(g,t):Dg,t =1

Theorem 6 shows that under Assumption 3, βf d is equal to a weighted sum of the ATEs in
each treated (g, t) cell with potentially some strictly negative weights, just as βf e . We now
characterize the (g, t) cells whose ATEs are weighted negatively by βf d . To do so, we focus
on staggered adoption designs, as outside of this case it is more difficult to characterize those
cells. Our characterization relies on the fact that for every t ∈ {1, ..., t}, εf d,g,t = Dg,t − Dg,t−1 −
(D.,t − D.,t−1 ). εf d,g,t is the difference between the change of the treatment in group g between
t − 1 and t, and the average change of the treatment across all groups.
Proposition 3 Suppose that Assumptions 1-2 and 4 hold and for all g, Ng,t does not depend on
t. Then, for all (g, t) such that Dg,t = 1, wf d,g,t < 0 if and only if Dg,t−1 = 1 and D.,t − D.,t−1 >
D.,t+1 − D.,t (with the convention that D.,t+1 = D.,t ).
21

Proposition 3 shows that for all t ∈ {1, ..., t − 1} such that the increase in the proportion of
treated units is larger from t − 1 to t than from t to t + 1, the period-t ATE of groups already
treated in t − 1 receives a negative weight. Moreover, if the proportion of treated units increases
from t − 1 to t, the period-t ATE of groups already treated in t − 1 also receives a negative
weight. Therefore, the treatment effect arising at the date when a group starts receiving the
treatment does not receive a negative weight, only long-run treatment effects do. Then, negative
weights are a concern when instantaneous and long-run treatment effects may differ. Proposition
3 also shows that the prevalence of negative weights depends on how the number of groups that
start receiving the treatment at date t evolves with t. Assume for instance that this number
decreases with t: many groups start receiving the treatment at date 1, a bit less start at date
2, etc., a case hereafter referred to as the “more early adopters” case. Then, if Ng,t is constant
across (g, t), D.,t −D.,t−1 is decreasing in t, and all the long-run treatment effects receive negative
weights, except maybe those of period t if D.,t = D.,t−1 . Conversely, assume that the number of
groups that start receiving the treatment at date t increases with t: few groups start receiving
the treatment at date 1, a bit more start at date 2, etc., a case hereafter referred to as the “more
late adopters” case. Then, if Ng,t is constant across (g, t), D.,t − D.,t−1 is increasing in t, and
only the period-t long-run treatment effects receive negative weights. Overall, negative weights
are much more prevalent in the “more early adopters” than in the “more late adopters” case.
Just as for βf e , one can show that the minimal value of σ(∆) compatible with βf d and ∆T R = 0
is σ f d = |βf d |/σ(wf d ), where
1/2


σ(wf d ) = 

X
(g,t):Dg,t =1

Ng,t
(wf d,g,t − 1)2 
N1

is the standard deviation of the weights attached to βf d . One can also show that σ f d , the minimal
value of σ(∆) compatible with βf d and ∆g,t of a different sign than βf d for all (g, t), has the same
expression as σ f e , except that one needs to replace the weights wg,t by the weights wf d,g,t in its
definition. Estimators of σ f e and σ f d (or σ f e and σ f d ) can then be used to determine which of
βf e or βf d is more robust to heterogeneous treatment effects.
Finally, and similarly to the result shown in Corollary 2 for βf e , βf d is equal to ∆T R under
common trends and the following assumption:
Assumption 14 (wf d uncorrelated with ∆)

TR
)
(g,t):Dg,t =1 (Ng,t /N1 )(wf d,g,t − 1)(∆g,t − ∆

P

= 0.

Note that under the common trends assumption, one can jointly test Assumption 14 and Assumption 5, the assumption that the weights attached to βf e are uncorrelated with the ∆g,t s: if
βbf e and βbf d are significantly different, at least one of these two assumptions must fail. In the
second application we revisit in Section 7, βbf e and βbf d are significantly different.
22

5.2

Dynamic treatment effects

With panel data, one may want to allow for the possibility that a unit’s contemporaneous outcome also depends on her past values of the treatment. To do so, one just needs to replace, in all of
the above, Yi,g,t (0) (resp. Yi,g,t (1))) by Yi,g,t (0, Di,t−1,g , ..., Di,0,g ) (resp. Yi,t,g (1, Di,t−1,g , ..., Di,0,g )),
the counterfactual outcome of unit i in group g at period t if she is untreated (resp. treated)
at that period, and her past treatments are equal to their actual values. Then, βf e and βf d still
identify uninterpretable parameters: unsurprisingly, allowing for dynamic treatment effects does
not make those estimands more robust to heterogeneous treatment effects. We do not use the
Yi,g,t (0, Di,t−1,g , ..., Di,0,g ) and Yi,t,g (1, Di,t−1,g , ..., Di,0,g ) notation throughout the paper because
it does not apply to cross-section data sets where cohort of birth plays the role of time.
On the other hand, allowing for dynamic treatment effects may alter the plausibility of the
common trends assumption underlying our Wald-TC estimand. To simplify the discussion,
let us focus on sharp designs and let us assume that the treatment is not stochastic. Then,
Assumption 6 can be rewritten as:
Assumption 15 (Common trends for groups with the same treatment at t − 1)
1. For all t ≥ 1 and g such that Dg,t−1 = 0, E(Yg,t (0, 0, Dg,t−2 , ..., Dg,0 ))−E(Yg,t−1 (0, Dg,t−2 , ..., Dg,0 ))
does not vary across g.
2. For all t ≥ 1 and g such that Dg,t−1 = 1, E(Yg,t (1, 1, Dg,t−2 , ..., Dg,0 ))−E(Yg,t−1 (1, Dg,t−2 , ..., Dg,0 ))
does not vary across g.
Assumption 15 may not be plausible if past treatments can affect the outcome at time t. For
instance, two groups g and g 0 that were both untreated at t−1 may have had different treatments
at t − 2, and then their outcome could follow different trends from t − 1 to t.
Note that this issue is absent in staggered adoption designs. Then, only Point 1 of Assumption
15 is necessary for Theorem 2 to hold. Moreover, Dg,t−1 = 0 implies Dg,t−2 = ... = Dg,0 = 0.
Therefore, Point 1 of Assumption 15 requires that E(Yg,t (0, 0, 0, ..., 0)) − E(Yg,t−1 (0, 0, ..., 0))
be independent of g for all untreated groups at t − 1. This requirement does not impose any
restriction on dynamic treatment effects. Therefore, our Wald-TC estimand is fully robust to
dynamic treatment effects in that design.
Outside of that special case, one can identify ∆S under assumptions that restrict dynamic
treatment effects less than Assumption 15. For instance, we consider the following assumption.
Assumption 16 (Common trends for groups with the same treatments at t − 1 and t − 2)
1. For all t ≥ 2, (d, d0 ) ∈ {0, 1}2 , and g, Yg,t (d, d0 , Dg,t−2 , ..., Dg,0 ) does not depend on
(Dg,t−2 , Dg,t−3 , ..., Dg,0 ) and is denoted Yg,t (d, d0 ).
23

2. For all t ≥ 2 and (d, d0 ) ∈ {0, 1}2 , for all g such that Dt−1,g = d, Dt−2,g = d0 , E(Yg,t (d, d))−
E(Yg,t−1 (d, d0 )) does not vary across g.
3. For t = 1, Assumption 15 holds.
Under Point 1 of Assumption 16, Dg,t−2 or earlier treatments cannot have an effect on the periodt outcome, but Dg,t−1 may have an effect. Point 2 requires that the mean outcome would have
followed the same evolution from period t−1 to t in all the groups sharing the same treatments at
periods t − 2 and t − 1, if those groups had kept the same treatment in period t as in period t − 1.
Under Assumption 16, ∆S is identified by an estimand that differs from, but is similar in spirit
to, our Wald-TC estimand. That estimand is a weighted average of four type of DID estimands:
DID estimands comparing groups with Dg,t = 1, Dg,t−1 = 0, Dg,t−2 = 0 to groups with Dg,t =
0, Dg,t−1 = 0, Dg,t−2 = 0, DID estimands comparing groups with Dg,t = 1, Dg,t−1 = 0, Dg,t−2 = 1
to groups with Dg,t = 0, Dg,t−1 = 0, Dg,t−2 = 1, etc. Finally, note that one can identify ∆S under
assumptions that restrict dynamic treatment effects even less than Assumption 16, for instance
by assuming that Dg,t−1 and Dg,t−2 may have an effect on the period-t outcome, and that groups
with the same treatments at t − 1, t − 2, and t − 3 experience the same trends.
Finally, one may also be interested in estimating dynamic treatment effects. Let us focus hereafter on staggered adoption designs. Abraham and Sun (2018) show that the event-study regression with groups and periods fixed effects and lags of the treatment is not robust to heterogeneous
treatment effects, just as the FE regression we study. On the other hand, the Wald-TC estimand
identifies the average instantaneous effect arising at the time when a group starts receiving the
treatment, across all groups that become treated at some point. It is easy to show that the
average dynamic effect arising, say, one period after those groups have started receiving the
treatment, is also identified, by an estimand closely related to the Wald-TC and under a modified version of Assumption 15. That estimand is a weighted average of DID estimands comparing
the evolution of the outcome from t − 1 to t + 1, between groups becoming treated at period
t, and groups that are still untreated at period t + 1. That estimand differs from other estimands of dynamic treatment effects that have been proposed in staggered adoption designs.
The estimand in Callaway and Sant’Anna (2018) uses groups that never become treated as their
control group, that in Abraham and Sun (2018) uses the groups that become treated at the last
period, while ours uses all groups not yet treated at period t + 1. Our control group is larger, so
the corresponding estimator may be more precise than those other estimators. The estimators
of dynamic treatment effects we propose in staggered adoption designs are computed by the
fuzzydid and did_multipleGT Stata packages. Outside of staggered adoption designs, estimating dynamic effects is still feasible but more challenging, and deserves more than an informal
discussion. This question is therefore left for future work.

24

5.3

Other extensions

In Section 2 of the Web Appendix, we consider some other important extensions. We sketch
the four most important here. First, in sharp designs, we show that under common trends
and the supplementary assumption that the treatment effect is stable over time, βf e and βf d
identify weighted sums of the ATEs of switching cells. All the weights attached to βf d are
positive. Some of the weights attached to βf e may still be negative, but in the special case
with staggered adoption and Ng,t /Ng,t−1 independent of g, all the weights are positive. Second,
our decompositions of βf e and βf d as weighted sums of the treatment effect in each (g, t) cell
extend to two-way fixed effects regressions with some controls, under a modified version of
the common trends assumption accounting for the controls. Importantly, the weights in the
decompositions remain the same. Third, our decompositions of βf e and βf d also extend to
two-way fixed effects regressions with a non-binary treatment. Here again, the weights remain
almost the same. Finally, the Wald-TC estimand can be extended to have some controls, or a
non-binary treatment.

6

Estimation and inference

In this section, we assume that Assumption 2 (sharp designs with a non-stochastic treatment)
holds. We discuss estimation and inference outside of that case in Section 4 of the Web Appendix.
First, we consider estimation of, and inference on, σ f e , σ f e , σ f d , and σ f d . Under Assumption 2,
the weights do not have to be estimated. Then, σ f e is simply estimated by:
σ
bf e =

|βbf e |
.
σ(w)

σ f e , σ f d , and σ f d are estimated similarly. To draw inference on σ f e , let sef e denote the standard
error of βbf e clustered at the group level. We then consider confidence intervals of the form



sef e
sef e
CI1−α (σ f e ) = σ
bf e − z1−α/2
,σ
b + z1−α/2
,
σ(w) f e
σ(w)
where zβ denotes the quantile of order β of a standard normal variable.
Second, we consider estimation of, and inference on, ∆S . Let
[ +,t =
DID

X
g:Dg,t =1,Dg,t−1

[ −,t =
DID

X
g:Dg,t =Dg,t−1

X
Ng,t
(Yg,t − Yg,t−1 ) −
N1,0,t
=0
g:D =D
g,t

Ng,t
(Yg,t − Yg,t−1 ) −
N
1,1,t
=1
g:D
25

g,t−1

X
g,t =0,Dg,t−1

Ng,t
(Yg,t − Yg,t−1 ) ,
N0,0,t
=0
Ng,t
(Yg,t − Yg,t−1 ) .
N
0,1,t
=1

Then the Wald-TC estimator is given by
cT C =
W

t 
X
N1,0,t
t=1

NS


N0,1,t [
[
DID+,t +
DID−,t .
NS

[ +,t = 0 if min(N1,0,t , N0,0,t ) = 0, and similarly for
Here, we take the convention that DID
[ −,t = 0. If Assumption 7 holds, let
DID
Zg,g



t
g+1X
N1,0,t
N0,1,t
=
Ng,t −
I1,g,t − I2,g,t + I3,g,t +
I4,g,t (Yg,t − Yg,t−1 ) ,
NS t=1
N0,0,t
N1,1,t

where Ik,g,t = 1{Dg,t−1 + 2Dg,t = k − 1}, with the convention that 0/0 = 0. Let us also define
Pg
Pg
2
Zg =
b2 =
g=0 Zg,g /(g + 1) and σ
g=0 (Zg,g − Z g ) /(g + 1). We then consider confidence
intervals of the form


σ
b
σ
b
S
cT C − z1−α/2 √ , W
cT C + z1−α/2 √ .
CI1−α (∆ ) = W
g
g
cT C and the corresponding confidence
We now establish the asymptotic properties of σ
bf e , W
intervals. We consider an asymptotic framework where the number of groups g tends to infinity.
P
Let Yeg,g = tt=0 Ng,t εg,t Yg,t .14 We make the following assumptions.
Assumption 17 The vectors (Yg,0 , ..., Yg,t )g≥0 are mutually independent.
P
Assumption 18 We have supg:0≤g≤g tt=0 Ng,t ε2g,t < +∞ and there exists δ > 0 such that
P P
2+δ
supg:0≤g≤g E(Yeg,g
) < +∞. Moreover, as g tends to infinity, gg=0 tt=0 Ng,t εg,t E[Yg,t ]/(g + 1),
Pg
Pg Pt
2
e
g=0
t=0 Ng,t εg,t /(g+1),
g=0 V (Yg,g )/(g+1) and σ(w) converge respectively to B 6= 0, J > 0,
H > 0 and σ∞ (w) > 0.

Assumption 19 There exists δ > 0 such that supg:0≤g≤g E |Zg,g |2+δ < +∞. Moreover, as g
P
tends to infinity, gg=0 V (Zg,g )/(g + 1) converges to σ 2 > 0.
Assumption 17 requires the outcome to be independent across groups, but it allows for serial
correlation within groups (see, e.g. Bertrand et al., 2004). Note that this assumption does not
require that the outcome be identically distributed across groups. This is important, to allow
the ∆g,t to vary across g. Assumptions 18 and 19 respectively impose the (uniform) existence of
moments of order 2 + δ of Yeg,g and Zg,g , and that some non-random averages converge as g tends
to infinity. These assumptions ensure that we can apply a law of large number and a central
limit theorem to (Yeg,g )g≥0 and (Zg,g )g≥0 , which are independent but not identically distributed.
14 e
Yg,g

depends on g because εg,t depends on g, though we have let this dependency implicit before.

26

Theorem 7 Suppose that Assumptions 1-3 and 17-18 hold. Then, as g tends to infinity,


p
 d
H
.
g σ
bf e − σ f e −→ N 0, 2 2
J σ∞ (w)

Moreover, lim supg→∞ Pr σ f e ∈ CI1−α (σ f e ) ≥ 1 − α.
Theorem 8 Suppose that Assumptions 1, 2, 6-7, 17 and 19 hold. Then, as g tends to infinity,

p 
d
cT C − ∆S −→
g W
N (0, σ 2 ).

Moreover, lim supg→∞ Pr ∆S ∈ CI1−α (∆S ) ≥ 1 − α.
cT C are asymptotically normal estimators of σ f e and
Theorems 7 and 8 show that σ
bf e and W
∆S when the number of groups tends to infinity, provided the outcome is independent across
groups. As is usually the case for estimators constructed using independent but not identically
distributed random variables (see e.g. Liu and Singh, 1995), the asymptotic variances of σ
bf e and
cT C can only be conservatively estimated. As a result, the confidence intervals we propose are
W
asymptotically conservative.

7
7.1

Applicability, and applications
Applicability

We conducted a review of all papers published in the American Economic Review (AER) between
2010 and 2012 to assess the importance of two-way fixed effects regressions in economics. Over
these three years, the AER published 337 papers. Out of these 337 papers, 33 or 9.8% of them
estimate the FE or FD Regression, or other regressions resembling closely those regressions.
When one withdraws from the denominator theory papers and lab experiments, the proportion
of papers using these regressions raises to 19.1%.
Table 1: Papers using two-way fixed effects regressions published in the AER

Papers using two-way fixed effects regressions
% of published papers
% of empirical papers, excluding lab experiments

2010
5
5.2%
12.8%

2011
2012 Total
14
14
33
12.2% 11.2% 9.8%
23.0% 19.2% 19.1%

Notes. This table reports the number of papers using two-way fixed effects regressions published in the AER
from 2010 to 2012.

27

Table 2 shows descriptive statistics about the 33 2010-2012 AER papers estimating two-way
fixed effects regressions. Panel A shows that 13 use the FE regression; six use the FD regression;
six use regressions the FE or FD regression with several treatment variables; three use the FE
or FD 2SLS regression discussed in Section 2.4 of the Web Appendix; five use other regressions
that we deemed sufficiently close to the FE or FD regression to include them in our count.15
Panel B shows that more than three fourths of those papers consider sharp designs, while less
than one fourth consider fuzzy designs. Finally, Panel C assesses whether there are groups
whose exposure to the treatment remains stable between each pair of consecutive time periods
in those applications, implying that the Wald-TC estimator can be computed. For about a half
of the papers, reading the paper was not enough to assess this with certainty. We then assessed
whether they presumably have stable groups or not. Overall, 12 papers have stable groups, 14
presumably have stable groups, five presumably do not have stable groups, and two do not have
stable groups.
In Section 5 of the Web Appendix, we review each of the 33 papers. We explain where two-way
fixed effects regressions are used in the paper, and we detail our assessment of whether the design
is a sharp or a fuzzy design, and of whether the stable groups assumption holds or not.
15

For instance, two papers use regressions with three-way fixed-effects instead of two-way fixed effects.

28

Table 2: Descriptive statistics on two-way fixed effects papers
# Papers
Panel A. Estimation method
Fixed-effects OLS regression
First-difference OLS regression
Fixed-effects or first-difference OLS regression, with several treatment variables
Fixed-effects or first-difference 2LS regression
Other regression

13
6
6
3
5

Panel B. Research design
Sharp design
Fuzzy design

26
7

Panel C. Are there stable groups?
Yes
Presumably yes
Presumably no
No

12
14
5
2

Notes. This table reports the estimation method and the research design used in the 33 papers using two-way
fixed effects regressions published in the AER from 2010 to 2012, and whether those papers have stable groups.

7.2

Applications

Enikolopov et al. (2011)
Enikolopov et al. (2011) study the effect of NTV, an independent TV channel introduced in
1996 in Russia, on the share of the electorate voting for opposition parties. NTV’s coverage
rate was heterogeneous across subregions: while a large fraction of the population received NTV
in urbanized subregions, a smaller fraction received it in more rural subregions. The authors
estimate the FE regression: they regress the share of votes for opposition parties in the 1995
and 1999 elections in Russian subregions on subregion fixed effects, an indicator for the 1999
election, and on the share of the population having access to NTV in each subregion at the time
of the election. In 1995, the share of the population having access to NTV was equal to 0 in
all subregions, while in 1999 it was strictly greater than 0 everywhere. Therefore, the authors’
research design corresponds exactly to the heterogenous adoption design discussed in Section
4. Enikolopov et al. (2011) find that βbf e = 6.65 (s.e.= 1.40). According to this regression,
increasing the share of the population having access to NTV from 0 to 100% increases the share
29

of votes for the opposition parties by 6.65 percentage points. Because there are only two time
periods in the data and the regression is not weighted by subregions’ populations, βbf e = βbf d .
We use the twowayfeweights Stata package, downloadable with its help file from the SSC
repository, to estimate the weights attached to βbf e . In 1995, all the weights are equal to zero
because NTV does not exist yet. In 1999, 918 weights (47.4%) are strictly positive, while
1,020 (52.6%) are strictly negative. The negative weights sum to -2.26. σ
bf e = 0.91 (95%
16
TR
level confidence interval=[0.49, 1.28]): βf e and ∆ may be of opposite signs if the standard
deviation of the effect of NTV across subregions is above 0.91 percentage point. σ
bf e = 1.23 (95%
R
s if the
level confidence interval=[0.67, 1.72]): βf e may be of a different sign than all the ∆Tg,1999
standard deviation of the effect of NTV across subregions is above 1.23 percentage point, which
does not seem to be an implausible amount of treatment effect heterogeneity.
Therefore, βf e can only receive a causal interpretation if the effect of NTV is constant across
subregions, or if the weights attached to it are uncorrelated with the intensity of that effect
in each subregion (Assumption 5). These assumptions are not warranted. First, we estimate
βbf e again, weighting the regression by subregions’ populations. We obtain βbf e = 14.89, more
than twice its value in the unweighted regression, and the difference between the coefficients is
significant (t-stat=2.46). Therefore, we can reject the null that the treatment effect is constant:
if the treatment effect was constant across subregions, the weighting would not matter so both
the unweighted and the weighted regressions would estimate the same parameter. Second, the
weights attached to βbf e are correlated with variables that are likely to be themselves associated
with the intensity of the effect in each subregion. For instance, the correlation between the
weights and subregions’ populations is equal to 0.35 (t-stat=14.01). The effect of NTV may be
higher in less populated subregions, as those regions are more rural and fewer other sources of
information may be available there. This would lead to a violation of Assumption 5.
Finally, note that the share of people having access to NTV is strictly positive in every subregion
in 1999, implying that there are no subregions where the mean treatment remains constant from
1995 to 1999. Hence, we cannot compute the Wald-TC estimator in this application.
Gentzkow et al. (2011)
Gentzkow et al. (2011) study the effect of newspapers on voters’ turnout in US presidential
elections between 1868 and 1928. They regress the first-difference of the turnout rate in county
g between election years t and t − 1 on state-year fixed effects and on the first difference of
the number of newspapers available in that county. This regression corresponds to the firstdifference regression, with state-year fixed effects as controls. As reproduced in Table 3 below,
Gentzkow et al. (2011) find that βbf d = 0.0026 (s.e.= 9 × 10−4 ). According to this regression,
16

The confidence intervals of σ f e and σ f e are computed using the bootstrap, clustered at the subregion level.

30

one more newspaper increased voters’ turnout by 0.26 percentage points. On the other hand,
βbf e = −0.0011 (s.e.= 0.0011). βbf e and βbf d are significantly different (t-stat=2.86).
We estimate the weights attached to βbf e . 6,180 are strictly positive, 4,198 are strictly negative. The negative weights sum to -0.47. σ
bf e = 4 × 10−4 (95% level confidence interval=[2 ×
10−5 , 0.0012]),17 meaning that βf e and the ATT may be of opposite signs if the standard deviation of the ATTs across groups and time periods is equal to 0.0004.18 σ
bf e = 7 × 10−4
(95% level confidence interval=[3 × 10−5 , 0.0026]), meaning that βf e may be of a different
sign than all the ATTs if the standard deviation of the ATTs across groups and time periods is equal to 0.0007. We also estimate the weights attached to βbf d . 4,790 are strictly positive, and 5,588 are strictly negative. The negative weights sum to -1.30. σ
bf d = 5 × 10−4
(95% level confidence interval=[1 × 10−4 , 8 × 10−4 ]), and σ
bf d = 7 × 10−4 (95% level confidence
interval=[1 × 10−4 , 0.0012]).
Therefore, βf e and βf d can only receive a causal interpretation if the weights attached to them
are uncorrelated with the intensity of the treatment effect in each county×election-year cell
(Assumptions 5 and 14, respectively). This is not warranted. First, as βbf e and βbf d significantly
differ, Assumptions 5 and 14 cannot jointly hold. Moreover, the weights attached to βbf e and
βbf d are correlated with variables that are likely to be themselves associated with the intensity
of the treatment effect in each cell. For instance, the correlation between the weights attached
to βbf d and t, the year variable, is equal to −0.07 (t-stat=-3.33). The effect of newspapers
may be different in the last than in the first years of the panel. For instance, new means of
communication, like the radio, appear in the end of the period under consideration, and may
diminish the effect of newspapers. This would lead to a violation of Assumption 14.
The stable groups assumption holds: between each pair of consecutive elections, there are counties where the number of newspapers does not change. We use the fuzzydid Stata package,
downloadable with its help file from the SSC repository, to estimate a modified version of our
Wald-TC estimand, that accounts for the fact that the number of newspapers is not binary (see
section 2.2 of our Web Appendix, where we define this modified estimand). We include statecT C = 0.0043, with a standard
year fixed effects as controls in our estimation. We find that W
cT C is 66% larger than βbf d , and the two estimators are significantly different
error of 0.0015. W
cT C is also of a different sign than βbf e .
at the 10% level (t-stat=1.69). W
Our Wald-TC estimand only relies on a common trends assumption. To assess its plausibility,
we estimate WTplC , the placebo estimand introduced in Section 3.3.19 As shown in Table 3 below,
our placebo estimator is small and not significantly different from 0, meaning that counties
17

The confidence intervals of σ f e , σ f e , σ f d , and σ f d are derived using a bootstrap clustered at the county level.
The number of newspapers is not binary, so strictly speaking, in this application the parameter of interest is
the average causal response parameter introduced in Section 2.2 of our Web Appendix, rather than the ATT.
19
Again, we need to slightly modify WTplC to account for the fact that the number of newspapers is not binary.
18

31

where the number of newspapers increased or decreased between t − 1 and t did not experience
significantly different trends in turnout from t − 2 to t − 1 than counties where that number was
stable. Our placebo estimator is estimated on a subset of the data: for each pair of consecutive
time periods t − 1 and t, we only keep counties where the number of newspapers did not change
between t − 2 and t − 1. Still, almost 80% of the county × election-year observations are used in
the computation of the placebo estimator. Moreover, when reestimated on this subsample, the
Wald-TC estimator is very close to the Wald-TC estimator in the full sample.
Table 3: Estimates of the effect of one additional newspaper on turnout

βbf d
βbf e
cT C
W
c pl
W
TC
cT C , on placebo subsample
W

Estimate
0.0026
-0.0011
0.0043
-0.0009
0.0045

Standard error
N
0.0009
15,627
0.0011
16,872
0.0015
16,872
0.0016
13,221
0.0019
13,221

Notes. This table reports estimates of the effect of one additional newspaper on turnout, as well as a placebo
estimate of the common trends assumption underlying WT C . Estimators are computed using the data of Gentzkow
et al. (2011), with state-year fixed effects as controls. Standard errors are clustered by county. To compute the
Wald-TC estimators, the number of newspapers is grouped into 4 categories: 0, 1, 2, and more than 3.

8

Conclusion

Almost 20% of empirical articles published in the AER between 2010 and 2012 use regressions
with groups and period fixed effects to estimate treatment effects. In this paper, we show that
under a common trends assumption, those regressions identify weighted sums of the treatment
effect in each group and at each period. The weights may be negative: in two empirical applications, we find that more than 50% of the weights are negative. The negative weights are
an issue when the treatment effect is heterogeneous, between groups or over time. Then, one
could have that the coefficient of the treatment variable in those regressions is negative while
the treatment effect is positive in every group and time period. We therefore propose a new
estimand to address this problem. This estimand identifies the effect of the treatment in the
groups that switch treatment, at the time when they switch. It does not rely on any treatment
effect homogeneity condition. It is computed by the fuzzydid Stata package, and can be used in
applications where there are groups whose exposure to the treatment does not change between
each pair of consecutive time periods. In one of the two applications we revisit, the corresponding
estimator is significantly and economically different from the two-way fixed effects estimators.

32

References
Abadie, A. (2005), ‘Semiparametric difference-in-differences estimators’, Review of Economic
Studies 72(1), 1–19.
Abraham, S. and Sun, L. (2018), Estimating dynamic treatment effects in event studies with
heterogeneous treatment effects. Working Paper.
Athey, S. and Imbens, G. W. (2018), Design-based analysis in difference-in-differences settings
with staggered adoption, Technical report, National Bureau of Economic Research.
Athey, S. and Stern, S. (2002), ‘The impact of information technology on emergency health care
outcomes’, The RAND Journal of Economics 33(3), 399–432.
Bertrand, M., Duflo, E. and Mullainathan, S. (2004), ‘How much should we trust differences-indifferences estimates?’, The Quarterly Journal of Economics 119(1), 249–275.
Billingsley, P. (1986), Probability and measure, 2nd edn, John Wiley & Sons.
Borusyak, K. and Jaravel, X. (2017), Revisiting event study designs. Working Paper.
Callaway, B. and Sant’Anna, P. H. (2018), Difference-in-differences with multiple time periods
and an application on the minimum wage and employment. arXiv e-print 1803.09015.
Conley, T. G. and Taber, C. R. (2011), ‘Inference with “difference in differences” with a small
number of policy changes’, The Review of Economics and Statistics 93(1), 113–125.
de Chaisemartin, C. (2011), Fuzzy differences in differences. Working Paper 2011-10, Center for
Research in Economics and Statistics.
de Chaisemartin, C. and D’Haultfoeuille, X. (2015), Fuzzy differences-in-differences. ArXiv
e-prints, eprint 1510.01757v2.
de Chaisemartin, C. and D’Haultfœuille, X. (2018), ‘Fuzzy differences-in-differences’, The Review
of Economic Studies 85(2), 999–1028.
de Chaisemartin, C., D’Haultfœuille, X. and Guyonvarch, Y. (2019), ‘Fuzzy differences-indifferences with Stata’, Stata Journal Forthcoming.
Enikolopov, R., Petrova, M. and Zhuravskaya, E. (2011), ‘Media and political persuasion: Evidence from russia’, American Economic Review 101(7), 3253–3285.
Frank, M. and Wolfe, P. (1956), ‘An algorithm for quadratic programming’, Naval research
logistics quarterly 3(1-2), 95–110.
33

Gentzkow, M., Shapiro, J. M. and Sinkinson, M. (2011), ‘The effect of newspaper entry and exit
on electoral politics’, American Economic Review 101(7), 2980–3018.
Goodman-Bacon, A. (2018), Difference-in-differences with variation in treatment timing. Working Paper.
Gut, A. (1992), ‘The weak law of large numbers for arrays’, Statistics & probability letters
14(1), 49–52.
Imai, K. and Kim, I. S. (2018), ‘On the use of two-way fixed effects regression models for causal
inference with panel data’.
Imbens, G. W. and Angrist, J. D. (1994), ‘Identification and estimation of local average treatment
effects’, Econometrica 62(2), 467–475.
Liu, R. Y. and Singh, K. (1995), ‘Using iid bootstrap inference for general non-iid models’,
Journal of statistical planning and inference 43(1-2), 67–75.
van der Vaart, A. (2000), Asymptotics Statistics, Cambridge University Press.

34

A

Proofs

Two useful lemmas
In the sharp designs considered in Section 3, our results rely on the following lemma.
Lemma 1 If Assumptions 1-3 hold, for all (g, g 0 , t, t0 ) ∈ {0, ..., g}2 × {0, ..., t}2 ,
E(Yg,t ) − E(Yg,t0 ) − (E(Yg0 ,t ) − E(Yg0 ,t0 )) = Dg,t ∆g,t − Dg,t0 ∆g,t0 − (Dg0 ,t ∆g0 ,t − Dg0 ,t0 ∆g0 ,t0 ) .
In the fuzzy designs considered in Section 4, our results rely on the following lemma.
Lemma 2 If Assumptions 1 and 9 hold, for all (g, g 0 , t, t0 ) ∈ {0, ..., g}2 × {0, ..., t}2 ,
E(Yg,t |D) − E(Yg,t0 |D) − (E(Yg0 ,t |D) − E(Yg0 ,t0 |D))

=Dg,t ∆Tg,tR (D) − Dg,t0 ∆Tg,tR0 (D) − Dg0 ,t ∆Tg0R,t (D) − Dg0 ,t0 ∆Tg0R,t0 (D) .
Proof of Lemma 1
For all (g, t) ∈ {0, ..., g} × {0, ..., t},
E(Yg,t ) =E

=E

Ng,t
1 X
Yi,g,t
Ng,t i=1

!

!
Ng,t
1 X
(Yi,g,t (0) + Di,g,t (Yi,g,t (1) − Yi,g,t (0)))
Ng,t i=1

=E (Yg,t (0)) + Dg,t ∆g,t ,
where the second equality follows from Assumption 2. Therefore,
E(Yg,t ) − E(Yg,t0 ) − (E(Yg0 ,t ) − E(Yg0 ,t0 ))
=E (Yg,t (0)) − E (Yg,t0 (0)) − (E (Yg0 ,t (0)) − E (Yg0 ,t0 (0)))
+Dg,t ∆g,t − Dg,t0 ∆g,t0 − (Dg0 ,t ∆g0 ,t − Dg0 ,t0 ∆g0 ,t0 )
=Dg,t ∆g,t − Dg,t0 ∆g,t0 − (Dg0 ,t ∆g0 ,t − Dg0 ,t0 ∆g0 ,t0 ) ,
where the second equality follows from Assumption 3.

35

Proof of Lemma 2
For all (g, t) ∈ {0, ..., g} × {0, ..., t},
E(Yg,t |D) =E

Ng,t
1 X
(Yi,g,t (0) + Di,g,t (Yi,g,t (1) − Yi,g,t (0))) D
Ng,t i=1

!

Ng,t
1 X
=E (Yg,t (0)|D) +
E (Yi,g,t (1) − Yi,g,t (0)|Di,g,t = 1, D) E(Di,g,t |D)
Ng,t i=1

=E (Yg,t (0)|D) + E(D1,g,t |D)∆Tg,tR (D)
=E (Yg,t (0)|D) + E(Dg,t |D)∆Tg,tR (D)
=E (Yg,t (0)|D) + Dg,t ∆Tg,tR (D),
where the second and third equalities follow from the fact that the treatment of observations in
the same cell are identically distributed. The end of the proof is very similar to that of Lemma
1, except that one needs to invoke Assumption 9 instead of Assumption 3.
Proof of Theorem 1
It follows from the Frisch-Waugh theorem, the definition of εg,t , and Assumption 2 that
P
g,t Ng,t εg,t E(Yg,t )
.
βf e = P
g,t Ng,t εg,t Dg,t

(5)

Now, by definition of εg,t again,
t
X

Ng,t εg,t = 0 for all g ∈ {0, ..., g},

(6)

Ng,t εg,t = 0 for all t ∈ {0, ..., t}.

(7)

t=0
g

X
g=0

Then,
X

Ng,t εg,t E(Yg,t )

g,t

=

X

=

X

=

X

Ng,t εg,t (E(Yg,t ) − E(Yg,0 ) − E(Y0,t ) + E(Y0,0 ))

(8)

g,t

Ng,t εg,t (Dg,t ∆g,t − Dg,0 ∆g,0 − D0,t ∆0,t + D0,0 ∆0,0 )

g,t

Ng,t εg,t Dg,t ∆g,t

g,t

=

X

Ng,t εg,t ∆g,t .

(9)

(g,t):Dg,t =1

36

The first and third equalities follow from Equations (6) and (7). The second equality follows
from Lemma 1. The fourth equality follows from Assumption 2. Finally, Assumption 2 implies
that
X
X
Ng,t εg,t Dg,t =
Ng,t εg,t .
(10)
g,t

(g,t):Dg,t =1

Combining (5), (9), and (10) yields the result.
Proof of Proposition 1
If for all t ≥ 1 Ng,t /Ng,t−1 does not depend on t, then it follows from the first order conditions
attached to Regression 1 and a few lines of algebra that εg,t = Dg,t − Dg,. − D.,t + D.,. . Therefore,
one has that for all (g, t) such that Dg,t = 1, wg,t is proportional to 1 − Dg,. − D.,t + D.,. . Using
the fact that
g
t
X
X
Ng,.
N.,t
D.,. =
Dg,. =
D.,t ,
N
N
g=0
t=0
it is easy to see that 1 − Dg,. − D.,t + D.,. is decreasing in Dg,. and D.,t for all (g, t).
Proof of Corollary 1
Proof of the first point
We start by proving the first point. If the assumptions of the corollary hold and ∆T R = 0, then

P
Ng,t
 βf e =
(g,t):Dg,t =1 N1 wg,t ∆g,t ,
Ng,t
 0 = P
(g,t):Dg,t =1 N1 ∆g,t .
These two conditions and the Cauchy-Schwarz inequality imply
X

|βf e | =

(g,t):Dg,t =1

Ng,t
(wg,t − 1)(∆g,t − ∆T R ) ≤ σ(w)σ(∆).
N1

Hence, σ(∆) ≥ σ f e .
Now, we prove that we can rationalize this lower bound. Let us define
∆Tg,tR =

βf e (wg,t − 1)
.
σ 2 (w)

Then,


∆T R =

X
(g,t):Dg,t =1

Ng,t βf e (wg,t − 1)
βf e 
= 2
2
N1
σ (w)
σ (w)
37


X
(g,t):Dg,t =1

Ng,t
wg,t − 1 = 0,
N1

as it follows from the definition of wg,t that

P

Ng,t
(g,t):Dg,t =1 N1 wg,t

= 1.

Similarly,
X
(g,t):Dg,t =1

Ng,t
βf e (wg,t − 1)
βf e
wg,t
=
N1
σ 2 (w)
σ 2 (w)
=

βf e
2
σ (w)

X
(g,t):Dg,t =1

X
(g,t):Dg,t =1

Ng,t
wg,t (wg,t − 1)
N1
Ng,t
(wg,t − 1)2
N1

= βf e ,
where the second equality follows again from the fact that

P

Ng,t
(g,t):Dg,t =1 N1 wg,t

= 1.

Proof of the second point
We first suppose that βf e > 0. We seek to solve:
min

∆(1) ,...,∆(n)

n
X
N(i)
i=1

N1


TR 2

∆(i) − ∆

s.t. βf e =

n
X
N(i)
i=1

N1

w(i) ∆(i) ,

∆(i) ≤ 0 for all i ∈ {1, ..., n}.
This is a quadratic programming problem, with a matrix that is symmetric positive but not
definite. Hence, by Frank and Wolfe (1956) and the fact that the linear term in the quadratic
problem is 0, the solution exists if and only if the set of constraints is not empty. If w(n) ≥ 0, the
P N
w(i) ∆(i) ≤ 0 < βf e . On the other hand, if w(n) < 0,
set of constraints is empty because ni=1 N(i)
1
this set is non-empty since it includes (0, ..., 0, βf e /(P(n) w(n) )).
We now derive the corresponding bound. For that purpose, remark that
!2
!2
n
n
n
n
X
X
X
X
N(i)
N(i)
N(i) 2
N(i)
∆(i)
=
∆(i) −
∆(i) .
∆(i) −
N
N
N
N
1
1
1
1
i=1
i=1
i=1
i=1
The Karush–Kuhn–Tucker necessary conditions for optimality are that for all i:
∆(i) = ∆T R + λw(i) − γ(i) ,
n
X
N(i)
w(i) ∆(i) = βf e ,
N1
i=1
γ(i) ≥ 0,
γ(i) ∆(i) = 0,
where ∆T R =
βf e and

N(i)
i=1 N1 ∆(i) ,

Pn

N
2 N(i)
γ(i)
1

2λ is the Lagrange multiplier of the constraint

is the Lagrange multiplier of the constraint ∆(i) ≤ 0.
38

N(i)
i=1 N1 w(i) ∆(i)

Pn

=

These constraints imply that ∆(i) = 0 if and only if ∆T R +λw(i) ≥ 0. Therefore, if ∆T R +λw(i) <
0, ∆(i) 6= 0 so γ(i) = 0, and ∆(i) = ∆T R + λw(i) . Therefore,
∆(i) = min(∆T R + λw(i) , 0).

(11)

This equation implies that ∆(i) ≤ ∆T R + λw(i) , which in turn implies that ∆T R ≤ ∆T R + λ, so
λ ≥ 0.
As a result, ∆T R + λw(i) is decreasing in i, and because x 7→ min(x, 0) is increasing, ∆(i) is also
decreasing in i. Then ∆(n) < 0: otherwise one would have ∆(i) = 0 for all i which would imply
βf e = 0, a contradiction. Let s = min{i ∈ {1, ..., n} : ∆(i) < 0}. Using again (11), we get
∆T R =

X N(i)
N1

i≥s

∆(i) = Ps ∆T R + λSs .

Therefore,
∆T R =

λSs
.
1 − Ps

(12)

Hence, plugging ∆ in (11), we obtain that for all i ≥ s,


Ss
∆(i) = λ
+ w(i) .
1 − Ps
Finally, using again (11), we obtain
βf e =

X N(i)
i≥s

N1


w(i) ∆(i) = λ


Ss2
+ Ts .
1 − Ps

Thus,
λ=

Ts +

βf e
2
Ss /(1

− Ps )

.

Then, using what precedes,
σ 2f e =

X N(i)
i≥s

N1

λw(i)

2

+

X N(i)
i<s



λSs
=λ Ts + (1 − Ps )
1 − Ps


2
Ss
=λ2 Ts +
1 − Ps
2
βf e
=
.
2
Ts + Ss /(1 − Ps )
2

N1
2

∆T R

2

The result follows, once noted that Equations (11) and (12) imply that s = min{i ∈ {1, ..., n} :
w(i) < −S(i) /(1 − P(i) )}.
39

Finally, consider the case βf e < 0. By letting ∆0(i) = −∆(i) and βf0 e = −βf e , we have
σf e =

min

n
X
N(i)

∆0(1) ≤0,...,∆0(n) ≤0

i=1

N1

∆0(i) 2

−

n
X
N(i)
i=1

N1

!2
∆0(i)

s.t.

n
X
N(i)
i=1

N1

w(i) ∆0(i) = βf0 e .

This is the same program as before, with βf0 e instead of βf e . Therefore, by the same reasoning
as before, we obtain
σ 2f e

βf2e
(βf0 e )2
=
.
=
Ts + Ss2 /(1 − Ps )
Ts + Ss2 /(1 − Ps )

Proof of Corollary 2
We have
Ng,t
wg,t ∆g,t
N1
(g,t):Dg,t =1


X Ng,t
=
wg,t  ∆T R
N1

βf e =

X

(g,t):Dg,t =1

= ∆T R .
Under the assumptions of the corollary, Theorem 1 holds, hence the first equality. The second
P
wg,t = 1, hence
equality follows from Assumption 5. By the definition of wg,t , (g,t):Dg,t =1 NNg,t
1
the third equality.
Proof of Theorem 2
Let t be greater than 1, and let us assume for now that there exists at least one g1 such that
Dg1 ,t−1 = 0 and Dg1 ,t = 1. Then Assumption 7 ensures that there is a least another group g2
such that Dg2 ,t−1 = Dg2 ,t = 0. For every g such that Dg,t−1 = 0 and Dg,t = 1, we have
E[Yg,t − Yg,t−1 ] =E[Yg,t (1) − Yg,t (0)] + E[Yg,t (0) − Yg,t−1 (0)]
=∆g,t + E[Yg,t (0) − Yg,t−1 (0)].

40

(13)

Under Assumption 6, for all t ≥ 1 there exists a real number ψ0,t such that for all g such that
Dg,t−1 = 0, E(Yg,t (0) − Yg,t−1 (0)) = ψ0,t . Then,
X

N1,0,t DID+,t =

g:Dg,t =1,Dg,t−1 =0

−
=

X

Ng,t ∆g,t +

g:Dg,t =1,Dg,t−1 =0

N1,0,t
Ng,t E[Yg,t (0) − Yg,t−1 (0)]
N0,0,t g:D =D
g,t
g,t−1 =0
X
X
Ng,t ∆g,t + ψ0,t
Ng,t
X

g:Dg,t =1,Dg,t−1 =0

=

Ng,t E[Yg,t (0) − Yg,t−1 (0)]

N1,0,t
− ψ0,t
N0,0,t
X

g:Dg,t =1,Dg,t−1 =0

X

Ng,t

g:Dg,t =Dg,t−1 =0

Ng,t ∆g,t ,

(14)

g:Dg,t =1,Dg,t−1 =0

where the first equality follows by (13), the second by Assumption 6 and the third by the fact
that
X
X
N1,0,t
Ng,t = N1,0,t .
Ng,t =
N0,0,t g:D =D
g:D =1,D
=0
=0
g,t

g,t

g,t−1

g,t−1

If there exists no g such that Dg,t−1 = 0 and Dg,t = 1, (14) still holds, as we have let DID+,t = 0
in this case.
A similar reasoning yields
X

N0,1,t DID−,t =

Ng,t ∆g,t .

g:Dg,t =0,Dg,t−1 =1

As a result,
WT C


t
X
1

=
NS t=1 g:D


X

Ng,t ∆g,t +

g,t =1,Dg,t−1 =0

X

Ng,t ∆g,t 

g:Dg,t =0,Dg,t−1 =1

=∆S .
Proof of Theorem 3
Let t be greater than 2, and let us assume for now that there exists at least one g1 such that
Dg1 ,t−2 = Dg1 ,t−1 = 0 and Dg1 ,t = 1. Then Assumption 8 ensures that there is a least another

41

group g2 such that Dg2 ,t−2 = Dg2 ,t−1 = Dg2 ,t = 0. Then,
X
pl
N1,0,0,t DID+,t
=
Ng,t E[Yg,t−1 (0) − Yg,t−2 (0)]
g:Dg,t =1,Dg,t−1 =Dg,t−2 =0

−

N1,0,0,t
N0,0,0,t

X

Ng,t E[Yg,t−1 (0) − Yg,t−2 (0)]

g:Dg,t =Dg,t−1 =Dg,t−2 =0

X

=ψ0,t−1

Ng,t − ψ0,t−1

g:Dg,t =1,Dg,t−1 =Dg,t−2 =0

N1,0,0,t
N0,0,0,t

X

Ng,t

g:Dg,t =Dg,t−1 =Dg,t−2 =0

=0.

(15)

The second equality follows by Assumption 6, where ψ0,t−1 is defined in the proof of Theorem
2. The third equality follows from the fact that
X
g:Dg,t =1,Dg,t−1 =Dg,t−2 =0

Ng,t =

N1,0,0,t
N0,0,0,t

X

Ng,t = N1,0,0,t .

g:Dg,t =Dg,t−1 =Dg,t−2 =0

If there exists no g such that Dg,t−2 = Dg,t−1 = 0 and Dg,t = 1, (15) still holds, as we have let
pl
DID+,t
= 0 in this case.
A similar reasoning yields N0,1,1,t DID−,t = 0. As a result, WTplC = 0.
Proof of Theorem 4
The proof of that result is very similar to the proof of Theorem 1.
!
P
g,t Ng,t εg,t Yg,t
βf e = E P
g,t Ng,t εg,t Dg,t
!
P
g,t Ng,t εg,t E(Yg,t |D)
P
=E
g,t Ng,t εg,t Dg,t
!
P
g,t Ng,t εg,t (E(Yg,t |D) − E(Yg,0 |D) − E(Y0,t |D) + E(Y0,0 |D))
P
=E
g,t Ng,t εg,t Dg,t
!
P
TR
TR
TR
TR
g,t Ng,t εg,t Dg,t ∆g,t (D) − Dg,0 ∆g,0 (D) − D0,t ∆0,t (D) + D0,0 ∆0,0 (D)
P
=E
g,t Ng,t εg,t Dg,t
!
P
TR
g,t Ng,t εg,t Dg,t ∆g,t (D)
P
=E
.
g,t Ng,t εg,t Dg,t
The second equality follows from the law of iterated expectations. The third and fifth equalities
follow from Equations (6) and (7). The fourth equality follows from Lemma 2.

42

Proof of Proposition 2
Assuming that Ng,1 /Ng,0 does not vary across g ensures that there exists a strictly positive real
number φ such that Ng,1 /Ng,0 = φ. Then,
εg,1 =Dg,1 − Dg,. − D.,1 + D.,.




Ng,0
Ng,1
N.,0
N.,1
=Dg,1 −
Dg,0 +
Dg,1 − D.,1 +
D.,0 +
D.,1
Ng,.
Ng,.
N
N




φ
1
φ
1
Dg,0 +
Dg,1 − D.,1 +
D.,0 +
D.,1
=Dg,1 −
1+φ
1+φ
1+φ
1+φ
1
=
(Dg,1 − Dg,0 − D.,1 + D.,0 ) ,
1+φ

(16)

where the first and third equalities follow from the fact Ng,1 /Ng,0 does not vary across g.
TR
, Equation (16) and Assumption 10 imply that
Then, the definition of wg,1

(Dg,1 − D.,1 )
Ng,1
g=0 N1 (Dg,1 − D.,1 )Dg,1

TR
wg,1
= Pg

= Pg

(Dg,1 − D.,1 )

Ng,1
g=0 N1 (Dg,1

− D.,1 )2

.

Proof of Theorem 5
In what follows, we consider a t greater than 1.
We first show that for all (g, t) such that E(Dg,t ) > E(Dg,t−1 ), P (D1,g,t (t) ≥ D1,g,t (t−1)) = 1. We
prove the result by contradiction. If P (D1,g,t (t) ≥ D1,g,t (t − 1)) 6= 1 then Point 2 of Assumption
11 implies that P (D1,g,t (t) ≤ D1,g,t (t−1)) = 1, which implies that E(D1,g,t (t)) ≤ E(D1,g,t (t−1)).
Point 1 of Assumption 11 then implies that E(D1,g,t (t)) ≤ E(D1,g,t−1 (t − 1)), which is equivalent
to having E(Dg,t ) ≤ E(Dg,t−1 ), a contradiction. Similarly, one can show that for all (g, t) such
that E(Dg,t ) = E(Dg,t−1 ), P (D1,g,t (t) = D1,g,t (t − 1)) = 1.
Then, for all (g, t) such that E(Dg,t ) > E(Dg,t−1 ),
E(Dg,t ) − E(Dg,t−1 ) =P (D1,g,t (t) = 1) − P (D1,g,t−1 (t − 1) = 1)
=P (D1,g,t (t) = 1) − P (D1,g,t (t − 1) = 1)
=P (D1,g,t (t) = 1, D1,g,t (t − 1) = 0).

(17)

The second equality follows from Point 1 of Assumption 11. The third follows from the fact that
as shown above, E(Dg,t ) > E(Dg,t−1 ) implies that P (D1,g,t (t) ≥ D1,g,t (t − 1)) = 1.

43

Then, under Assumption 12, for all t ≥ 1 and d ∈ {0, 1}, there exist real numbers αd,t such that
E(Y1,g,t (d)|D1,g,t (t − 1) = d) − E(Y1,g,t−1 (d)|D1,g,t−1 (t − 1) = d) = αd,t

(18)

Now, for all (g, t) such that E(Dg,t ) > E(Dg,t−1 ),
E(Yg,t ) − E(Yg,t−1 )
=E(Y1,g,t ) − E(Y1,g,t−1 )
=E(Y1,g,t (1)|D1,g,t (t − 1) = 1)P (D1,g,t (t − 1) = 1) + E(Y1,g,t (0)|D1,g,t (t) = 0)P (D1,g,t (t) = 0)
+E(Y1,g,t (1)|D1,g,t (t − 1) = 0, D1,g,t (t) = 1)P (D1,g,t (t − 1) = 0, D1,g,t (t) = 1)
−E(Y1,g,t−1 (1)|D1,g,t−1 (t − 1) = 1)P (D1,g,t−1 (t − 1) = 1) − E(Y1,g,t−1 (0)|D1,g,t−1 (t − 1) = 0)P (D1,g,t−1 (t − 1) = 0)
=E(Y1,g,t (1)|D1,g,t (t − 1) = 1)P (D1,g,t (t − 1) = 1) + E(Y1,g,t (0)|D1,g,t (t − 1) = 0)P (D1,g,t (t − 1) = 0)
−E(Y1,g,t−1 (1)|D1,g,t−1 (t − 1) = 1)P (D1,g,t−1 (t − 1) = 1) − E(Y1,g,t−1 (0)|D1,g,t−1 (t − 1) = 0)P (D1,g,t−1 (t − 1) = 0)
+E(Y1,g,t (1) − Y1,g,t (0)|D1,g,t (t − 1) = 0, D1,g,t (t) = 1)P (D1,g,t (t − 1) = 0, D1,g,t (t) = 1)
=E(Y1,g,t (1)|D1,g,t (t − 1) = 1)P (D1,g,t−1 (t − 1) = 1) + E(Y1,g,t (0)|D1,g,t (t − 1) = 0)P (D1,g,t−1 (t − 1) = 0)
−E(Y1,g,t−1 (1)|D1,g,t−1 (t − 1) = 1)P (D1,g,t−1 (t − 1) = 1) − E(Y1,g,t−1 (0)|D1,g,t−1 (t − 1) = 0)P (D1,g,t−1 (t − 1) = 0)
+E(Y1,g,t (1) − Y1,g,t (0)|D1,g,t (t − 1) = 0, D1,g,t (t) = 1)P (D1,g,t (t − 1) = 0, D1,g,t (t) = 1)
=α1,t E(Dg,t−1 ) + α0,t (1 − E(Dg,t−1 ))
+E(Y1,g,t (1) − Y1,g,t (0)|D1,g,t (t − 1) = 0, D1,g,t (t) = 1)P (D1,g,t (t − 1) = 0, D1,g,t (t) = 1).

(19)

The first equality follows from the fact that observations are identically distributed within each
(g, t) cell. The second equality follows from the law of iterated expectations, and from the
fact that as shown above, E(Dg,t ) > E(Dg,t−1 ) implies that P (D1,g,t (t) ≥ D1,g,t (t − 1)) = 1.
The third equality follows after adding and subtracting E(Y1,g,t (0)|D1,g,t (t − 1) = 0, D1,g,t (t) =
1)P (D1,g,t (t − 1) = 0, D1,g,t (t) = 1), and using again the fact that P (D1,g,t (t) ≥ D1,g,t (t − 1)) = 1.
The fourth equality follows from Point 1 of Assumption 11. The fifth equality follows from (18).
Then,
δ0,t
X

=

g:E(Dg,t )=E(Dg,t−1 )

X

=

g:E(Dg,t )=E(Dg,t−1 )

Ng,t (1 − E(Dg,t ))
(E(Y1,g,t (0)|D1,g,t (t) = 0) − E(Y1,g,t−1 (0)|D1,g,t−1 (t − 1) = 0))
N=,t − N1,=,t
Ng,t (1 − E(Dg,t ))
(E(Y1,g,t (0)|D1,g,t (t − 1) = 0) − E(Y1,g,t−1 (0)|D1,g,t−1 (t − 1) = 0))
N=,t − N1,=,t

=α0,t .

(20)

The second equality follows from the fact that E(Dg,t ) = E(Dg,t−1 ) implies that P (D1,g,t (t) =
D1,g,t (t − 1)) = 1. The third equality follows from (18) and the definitions of N=,t and N1,=,t .
Similarly,
δ1,t =α1,t .

44

(21)

Therefore,
X
g:E(Dg,t )>E(Dg,t−1 )

X

=

g:E(Dg,t )>E(Dg,t−1 )

X

+

g:E(Dg,t )>E(Dg,t−1 )

X

=

g:E(Dg,t )>E(Dg,t−1 )

Ng,t
(E(Yg,t ) − (E(Yg,t−1 ) + (1 − p+,t−1 )δ0,t + p+,t−1 δ1,t ))
N+,t
Ng,t
(α1,t E(Dg,t−1 ) + α0,t (1 − E(Dg,t−1 ))) − p+,t−1 α1,t − (1 − p+,t−1 )α0,t
N+,t
Ng,t
E(Y1,g,t (1) − Y1,g,t (0)|D1,g,t (t − 1) = 0, D1,g,t (t) = 1)P (D1,g,t (t − 1) = 0, D1,g,t (t) = 1)
N+,t
Ng,t
E(Y1,g,t (1) − Y1,g,t (0)|D1,g,t (t − 1) = 0, D1,g,t (t) = 1)P (D1,g,t (t − 1) = 0, D1,g,t (t) = 1).
N+,t

(22)

The first equality follows from (19), (20), and (21). The second equality follows from the
definition of p+,t−1 .
Then, it follows from (22), (17) and the definition of WT C,+,t that
WT C,+,t
X

=

g:E(Dg,t )>E(Dg,t−1 )

where PS,+,t =

P

Ng,t P (D1,g,t (t − 1) = 0, D1,g,t (t) = 1)
E(Y1,g,t (1) − Y1,g,t (0)|D1,g,t (t − 1) = 0, D1,g,t (t) = 1),
PS,+,t

g:E(Dg,t )>E(Dg,t−1 )

(23)

Ng,t P (D1,g,t (t − 1) = 0, D1,g,t (t) = 1).

Similarly, one can show that
WT C,−,t
=

X
g:E(Dg,t )<E(Dg,t−1 )

where PS,−,t =

P

Ng,t P (D1,g,t (t − 1) = 1, D1,g,t (t) = 0)
E(Y1,g,t (1) − Y1,g,t (0)|D1,g,t (t − 1) = 0, D1,g,t (t) = 1),
PS,−,t

g:E(Dg,t )<E(Dg,t−1 )

(24)

Ng,t P (D1,g,t (t − 1) = 1, D1,g,t (t) = 0).

Finally, the result follows after summing (23) and (24) over t ≥ 1, once noted that
t
X

X

Ng,t |E(Dg,t ) − E(Dg,t−1 )| = PS .

t=1 g:E(Dg,t )6=E(Dg,t−1 )

Proof of Theorem 6
It follows from the Frisch-Waugh theorem, the definition of εf d,g,t , and Assumption 2 that
P
(g,t):t≥1 Ng,t εf d,g,t (E(Yg,t ) − E(Yg,t−1 ))
P
βf d =
.
(25)
(g,t):t≥1 Ng,t εf d,g,t (Dg,t − Dg,t−1 )
Now, by definition of εf d,g,t again,
g
X

Ng,t εf d,g,t = 0 for all t ∈ {1, ..., t}.

g=0

45

(26)

Then,
X

Ng,t εf d,g,t (E(Yg,t ) − E(Yg,t−1 ))

(g,t):t≥1

=

X

Ng,t εf d,g,t (E(Yg,t ) − E(Yg,t−1 ) − E(Y0,t ) + E(Y0,t−1 ))

(g,t):t≥1

=

X

Ng,t εf d,g,t (Dg,t ∆g,t − Dg,t−1 ∆g,t−1 − D0,t ∆0,t + D0,t−1 ∆0,t−1 )

(g,t):t≥1

=

X

Ng,t εf d,g,t (Dg,t ∆g,t − Dg,t−1 ∆g,t−1 )

(g,t):t≥1

=

X

(Ng,t εf d,g,t − Ng,t+1 εf d,g,t+1 ) Dg,t ∆g,t

g,t

X

=


Ng,t

(g,t):Dg,t =1


Ng,t+1
εf d,g,t+1 ∆g,t .
εf d,g,t −
Ng,t

(27)

The first and third equalities follow from (26). The second equality follows from Lemma 1. The
fourth equality follows from a summation by part, and from the fact εf d,g,0 = εf d,g,t+1 = 0. The
fifth equality follows from Assumption 2.
A similar reasoning yields
X
Ng,t εf d,g,t (Dg,t − Dg,t−1 ) =
(g,t):t≥1

X
(g,t):Dg,t =1



Ng,t+1
εf d,g,t+1 .
Ng,t εf d,g,t −
Ng,t

(28)

Combining (25), (27), and (28) yields the result.
Proof of Proposition 3
It follows from the first order conditions attached to Regression 2 and a few lines of algebra that
εf d,g,t = Dg,t − Dg,t−1 − D.,t + D.,t−1 . Therefore, under Assumption 4 and if Ng,t does not vary
across t, one has that for all (g, t) such that Dg,t = 1, 1 ≤ t ≤ t − 1, wf d,g,t is proportional to
1 − Dg,t−1 − (2D.,t − D.,t−1 − D.,t+1 ). D.,t − D.,t−1 ≤ 1, and under Assumption 4 D.,t − D.,t+1 ≤ 0,
so 1 − Dg,t−1 − (2D.,t − D.,t−1 − D.,t+1 ) can only be strictly negative if Dg,t−1 = 1. Then, for all
(g, t) such that Dg,t = 1, 1 ≤ t ≤ t − 1, wf d,g,t is strictly negative if and only if Dg,t−1 = 1 and
2D.,t − D.,t−1 − D.,t+1 > 0.
Similarly, when t = t, under the same assumptions as above, one has that for all g such that
Dg,t = 1, wf d,g,t is proportional to 1 − Dg,t−1 − (D.,t − D.,t−1 ). D.,t − D.,t−1 ≤ 1, so 1 − Dg,t−1 −
(D.,t − D.,t−1 ) can only be strictly negative if Dg,t−1 = 1. Then, wf d,g,t is strictly negative if and
only if Dg,t−1 = 1 and D.,t − D.,t−1 > 0.
Finally, when t = 0, one has that for all g such that Dg,0 = 1, wf d,g,0 is proportional to D.,1 −D.,0 ,
which is greater than 0 under Assumption 4.
46

Proof of Theorem 7
Remark, as in the proof of Theorem 1, that
P
g,t Ng,t εg,t (Yg,t − E(Yg,t ))
P
βbf e − βf e =
g,t Ng,t εg,t Dg,t
P
g
1
e
e
g=0 (Yg,g − E(Yg,g ))
g+1
P
.
=
1
2
g,t Ng,t εg,t
g+1

(29)

By Assumption 18, the denominator tends to J. Now, by the triangular inequality, convexity of
x 7→ x2+δ on R+ and Jensen’s inequality,


|Yeg,g − E(Yeg,g )|2+δ ≤ 21+δ |Yeg,g |2+δ + E(|Yeg,g |2+δ ) .
(30)
Thus,
g
X

E[|Yeg,g − E(Yeg,g )|2+δ ]/(g + 1)2+δ ≤

g=0

22+δ
sup E(|Yeg,g |2+δ ).
(g + 1)1+δ g:0≤g≤g

P
Therefore, letting Veg = (1/(g + 1)) gg=0 V (Yeg,g ),
Pg
2+δ
e
e
]/(g + 1)2+δ
22+δ supg:0≤g≤g E(|Yeg,g |2+δ )
g=0 E[|Yg,g − E(Yg,g )|
.
≤
P
1+δ/2
e 1+δ/2
(g + 1)δ/2
g
V
e
g
V
g=0 Yg,g /(g + 1)
By Assumption 18, the last term on the right-hand side converges to a finite value. Thus, the
right-hand side tends to zero as g tends to infinity, and by the Lyapunov central limit theorem
for triangular arrays (see,e.g. Billingsley, 1986, Theorem 27.3),
Pg e
√
e
d
g=0 (Yg,g − E(Yg,g )/ g + 1)
−→ N (0, 1).
1/2
Ve
g

By Assumption 18, Veg tends to H. Then, using (29), we obtain


p
d
g + 1 βbf e − βf e −→ N (0, H/J 2 ).

(31)

Moreover, by Assumption 18 and in view of (5), βf e → B/J 6= 0. Then, by the uniform delta
method (see, e.g. van der Vaart, 2000, Theorem 3.8), (31) still holds if we replace βbf e − βf e by
|βbf e | − |βf e |. The first result follows by definition of σ
bf e and σ f e and the convergence of σ(w)
to σ∞ (w) > 0.
To prove the result on the confidence interval, first remark that (g + 1)se2f e = Hg /Jg2 , with
" t
#2
g
1 X X
Hg =
Ng,t (Yg,t − βbf e εg,t )εg,t ,
g + 1 g=0 t=0
1 X
Jg =
Ng,t ε2g,t .
g + 1 g,t
47

Moreover, letting ug,g =

Pt

t=0

Ng,t ε2g,t , we have

g

i2
1 X he
Hg =
Yg,g − βbf e ug,g
g + 1 g=0
g

=

g

2 X e
1 X e
(Yg,g − E(Yeg,g ))2 +
(Yg,g − E(Yeg,g ))(E(Yeg,g ) − βbf e ug,g )
g + 1 g=0
g + 1 g=0
g

1 X
(E(Yeg,g ) − βbf e ug,g )2
+
g + 1 g=0
=T1g + T2g + T3g .

(32)

This implies that
p
σ
bf e − σ f e
σ
bf e − σ f e
≤ g+1 √
.
T1g +T2g
sef e /σ(w)

(33)

Jg σ(w)

By Assumption 18, we have

2
h
i
2  
2
e
e
e
e
sup E Yg,g < +∞
sup E Yg,g E(Yg,g )
≤
sup |E(Yg,g )|
g:0≤g≤g

g:0≤g≤g

g:0≤g≤g

Then, by the weak law of large numbers for triangular arrays (see, e.g. Gut, 1992),
g

2 X e
P
(Yg,g − E(Yeg,g ))E(Yeg,g ) −→ 0.
g + 1 g=0
By the same law of large numbers, and since supg:0≤g≤g |ug,g | < +∞, by Assumption 18,
P
P
2 gg=0 (Yeg,g − E(Yeg,g ))ug,g /(g + 1) −→ 0 Then, by definition of T2g and because βbf e = Op (1),
P

T2g −→ 0.
Next, using (30) and Assumption 18,
2+δ

sup E Yeg,g − E(Yeg,g )

< +∞.

g:0≤g≤g

P
Again, this implies by the weak law of large numbers for triangular arrays that T1g − Veg −→ 0.
P
Moreover, by Assumption 18, Veg → H. Next, Jg is equal to g,t Ng,t Dg,t εg,t /(g + 1) and thus
converges to J. Combining all the previous results, we obtain
p
T1g + T2g P
H 1/2
−→
.
Jg σ(w)
Jσ∞ (w)

Thus, by the first result of the theorem and Slutsky’s theorem,


bf e − σ f e
 σ

lim Pr  √
≤ z1−α/2  = 1 − α.

g→∞

T1g +T2g
Jg σ(w)

The result follows by (33).
48

Proof of Theorem 8
cT C show that
Some algebra and the definition of W
g

cT C − ∆
˜S =
W

1 X
(Zg,g − E(Zg,g )).
g + 1 g=0

(34)

Using the same reasoning as in Theorem 7 and Assumption 19, we obtain
Pg
√
d
g=0 (Zg,g − E(Zg,g ))/ g + 1
−→ N (0, 1),
1/2
Vg
where Vg = (1/(g + 1))

Pg

g=0

V (Zg,g ). The first result then follows by (34) and Assumption 19.

To prove the second part, let us first define
g

σg2

1 X
2
=
E(Zg,g
) − E(Z g )2 .
g + 1 g=0




 2
2
− E(Zg,g
)|1+δ/2 ≤ 21+δ/2 E |Zg,g |2+δ . Hence,
By the same reasoning as in Theorem 7, E |Zg,g
by Assumption 19 and the weak law of large numbers for triangular arrays,
g

1 X 2
P
2
(Z − E(Zg,g
)) −→ 0.
g + 1 g=0 g,g

(35)

2
Reasoning similarly on Zg,g instead of Zg,g
, we also get that Z g − E(Z g ) → 0 in probability.
Furthermore, by Assumption 19 again, |E(Z g )| ≤ supg E(|Zg,g |) < +∞. This and Z g −E(Z g ) →
2
0 imply that Z g + E(Z g ) = Op (1). Hence, Z g − E(Z g )2 = op (1). Together with (35), this implies
P

σ
b2 − σg2 −→ 0.

(36)

Moreover, by convexity,
g

1 X
E(Zg,g )
g + 1 g=0

!2

g

1 X
≤
E(Zg,g )2 ,
g + 1 g=0


and thus σg2 ≥ Vg . Hence, σ
b2 ≥ Vg 1 + (b
σ 2 − σg2 )/σg2 , which implies that
cT C − ∆S
W
≤
σ
b

Pg

√
− E(Zg,g ))/ g + 1
r 
.

σ
b2 −σg2
Vg 1 + σ 2

g=0 (Zg,g

g

49

(37)

Because Vg → σ 2 > 0, σg2 ≥ Vg implies that lim inf σg2 > 0. Combined with (36), we obtain
(b
σ 2 − σg2 )/σg2 = op (1). Hence, by Sluski’s lemma, the right-hand side of (37) tends to a standard
normal variable. As a result,


cT C − ∆S



W
 = 1 − α.
r
lim sup Pr ∆S ∈ CI1−α ≥ lim sup Pr 
≤
z
1−α/2




σ
b2 −σg2
g
g
Vg 1 + σ 2
g

50

