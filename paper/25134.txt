NBER WORKING PAPER SERIES

LINEAR IV REGRESSION ESTIMATORS FOR
STRUCTURAL DYNAMIC DISCRETE CHOICE MODELS
Myrto Kalouptsidi
Paul T. Scott
Eduardo Souza-Rodrigues
Working Paper 25134
http://www.nber.org/papers/w25134

NATIONAL BUREAU OF ECONOMIC RESEARCH
1050 Massachusetts Avenue
Cambridge, MA 02138
October 2018, Revised February 2020

We are grateful to Victor Aguirregabiria, Chris Conlon, Øystein Daljord, Mike Dickstein, Bo
Honoré, Rob McMillan, Magne Mogstad, Matthew Osborne, Lucas Lima, Marc-Antoine
Schmidt, Yuanyuan Wan, Stan Zin, and seminar participants at various universities for many
helpful comments. We also thank the Editor, the Associate Editor, and the anonymous referees.
Jan Dee and Walter Zhang provided outstanding research assistance. Much of the material of this
paper was formerly part of our paper “Identification of Counterfactuals in Dynamic Discrete
Choice Models”, NBER Working Paper 21527. All remaining errors are our own. The views
expressed herein are those of the authors and do not necessarily reflect the views of the National
Bureau of Economic Research.
NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.
© 2018 by Myrto Kalouptsidi, Paul T. Scott, and Eduardo Souza-Rodrigues. All rights reserved.
Short sections of text, not to exceed two paragraphs, may be quoted without explicit permission
provided that full credit, including © notice, is given to the source.

Linear IV Regression Estimators for Structural Dynamic Discrete Choice Models
Myrto Kalouptsidi, Paul T. Scott, and Eduardo Souza-Rodrigues
NBER Working Paper No. 25134
October 2018, Revised February 2020
JEL No. C13,C35,C36,C51,C61
ABSTRACT
In structural dynamic discrete choice models, unobserved and mis-measured state variables may
lead to biased parameter estimates and misleading inference. In this paper, we show that
instrumental variables can address such measurement problems when they relate to state variables
that evolve exogenously from the perspective of individual agents (i.e., market-level states). We
define a class of linear instrumental variables estimators that rely on Euler equations expressed in
terms of conditional choice probabilities (ECCP estimators). These estimators do not require
observing or modeling the agent's entire information set, nor solving or simulating a dynamic
program. As such, they are simple to implement and computation-ally light. We provide
constructive arguments for the identification of model primitives, and establish the estimator's
consistency and asymptotic normality. Four applied examples serve to illustrate the ECCP
approach's implementation, advantages, and limitations: dynamic demand for durable goods,
agricultural land use change, technology adoption, and dynamic labor supply. We illustrate the
estimator's good finite-sample performance in a Monte Carlo study, and we estimate a labor
supply model empirically for taxi drivers in New York City.
Myrto Kalouptsidi
Department of Economics
Harvard University
Littauer 124
Cambridge, MA 02138
and NBER
myrto@fas.harvard.edu
Paul T. Scott
NYU Stern School of Business
Kaufman Management Center, 7-77
New York University
New York, NY 10012
ptscott@gmail.com

Eduardo Souza-Rodrigues
Department of Economics
University of Toronto
Max Gluskin House,
150 St. George Street, room 324
Toronto, ON, Canada
edusouzarod@gmail.com

1

Introduction

Instrumental variables methods are widely used to address omitted variables and measurement
error problems in reduced-form models. In this paper, we show that instrumental variables can
play the same role in structural dynamic discrete choice (DDC) models, as long as the measurement
problems involve market-level state variables (also known as forcing variables), i.e., variables that
evolve exogenously from the perspective of individual agents. To that end, we define a class
of linear IV regression estimators for structural dynamic discrete choice models, which we call
Euler Equations in Conditional Choice Probabilities (ECCP) estimators. ECCP estimators are a
discrete-choice analog to the Euler equation approach for models with continuous choice variables
developed by Hall (1978), Hansen and Sargent (1980, 1982), and Hansen and Singleton (1982).1
Structural DDC models have proven useful in a variety of important fields – for example, in the
study of firm dynamics, consumer demand, labor markets, and environmental problems. Standard
methods for estimating DDC models require the computation of continuation value functions,
by either solving the full dynamic problem (Rust, 1987) or measuring the continuation values
by forward-solving (Hotz and Miller, 1993; Pesendorfer and Schmidt-Dengler, 2008) or forwardsimulating (Hotz, Miller, Sanders, and Smith, 1994; Bajari, Benkard, and Levin, 2007). In this
context, Arcidiacono and Miller (2011) and Aguirregabiria and Magesan (2013) represent two
major departures from prior work, providing strategies for estimating model parameters without
calculating continuation values, thereby reducing the computational burden of estimating DDC
models substantially. Arcidiacono and Miller (2011) define the finite dependence property and
show how it allows the econometrician to construct conditions from an agent’s optimization problem in which the continuation values cancel out.2 Aguirregabiria and Magesan (2013) propose a
representation of the discrete choice problem as a continuous decision problem in which the decision
variables are choice probabilities. Based on this representation, they derive first-order conditions
for optimization that are expressed in terms of choice probabilities, and that are similar to Euler
equations for continuous decision problems.
We build on these methodological contributions to allow for measurement problems in marketlevel state variables, including serially correlated unobserved states, endogeneity problems, and
measurement error. It is widely acknowledged that the presence of such unobservables is an
important concern in empirical applications, and that ignoring them may lead to biased estimates
and misleading inference. Empirical work exploring finite dependence in structural DDC models
that allows for such measurement problems has appeared in the recent applied literature (Scott,
1

Euler equation estimators rely on agents’ behavior in adjacent time periods, drawing on restrictions that are
necessary for dynamic optimization.
2
Finite dependence requires that, starting from any two different states, there exist two finite sequences of actions
that will lead to the same distribution over states. See Altug and Miller (1998) for an early application exploiting
finite dependence, and Arcidiacono and Ellickson (2011) for further discussion of the role of finite dependence in
DDC models.

2

2013; Diamond, McQuade, and Qian, 2018; De Groote and Verboven, 2019; Traiberman, 2019).3
However, the underlying class of models has yet to receive a comprehensive econometric treatment.
This paper aims to fill that gap.
To that end, we provide sufficient conditions for both parametric and nonparametric identification of DDC model primitives. The identification arguments are constructive and lead naturally
to an estimator, the ECCP estimator. Like other conditional-choice-probability-based estimators
(Hotz and Miller, 1993; Aguirregabiria and Mira, 2002; Pesendorfer and Schmidt-Dengler, 2008),
the ECCP estimator involves two steps: first estimating conditional choice probabilities, and then
estimating parameters of the model. Unlike other CCP estimators, the second step amounts to
estimating a linear regression equation, making it easy to implement and computationally light.4
Both steps can be implemented using standard tools available in econometrics software packages
such as STATA and R. We establish the consistency and asymptotic normality of the estimator,
and we illustrate the finite-sample performance of the ECCP estimator in a Monte Carlo study
of dynamic demand for durable goods. We find that it performs well in finite samples while estimation techniques ignoring measurement problems in state variables can be substantially biased.
We also illustrate the performance of the ECCP estimator empirically, in the context of dynamic
labor supply for taxi drivers in New York City. Here, we find that ignoring endogeneity issues
leads to the underestimation of labor supply responses to earnings – consistent with usual biases
in simultaneity problems – while the ECCP estimates provide plausible response patterns.
To identify and estimate structural parameters, the ECCP approach exploits moment restrictions implied by dynamic optimization. These moment restrictions can be constructed as long
as (a) the state variables can be decomposed into agent-specific state variables and market-level
states, and (b) there is finite dependence in the agent-specific state variables. Under these conditions, ECCP equations (like Euler equations in general) involve relationships between current
behavior and expected future behavior. By using observed (realized ) rather than expected behavior
in successive time periods, the ECCP equation can serve as a valid estimating equation. Furthermore, unobservable variables and measurement error can be represented in ECCP equations in
the same way that they are represented in standard regression equations, and handled similarly
through the use of instrumental variables.5
The ECCP approach allows researchers to deal with endogeneity problems using standard linear instrumental variables techniques. No assumptions are needed regarding the evolution of the
unobservable shocks, except that they satisfy exclusion restrictions (i.e., they are uncorrelated with
3
Scott (2013) studies how US agricultural policies affect farmers’ land use choices; Diamond, McQuade, and
Qian (2018) study the welfare impacts of rent control on tenants and landlords; De Groote and Verboven (2019)
investigate the adoption of solar photovoltaic systems for electricity production; Traiberman (2019) focuses on
workers’ occupational reallocations from trade liberalization.
4
As long as agents’ payoffs are linear-in-parameters, the resulting ECCP equation will also be linear-inparameters.
5
The estimating equations involve CCPs in successive time periods, and so require sufficiently rich panel data
so that CCPs can be estimated separately for each cross section.

3

instrumental variables). For example, cost shifters may be used as instruments for unobserved demand shocks (De Groote and Verboven, 2019); lagged observed states form another possible source
of instruments available to researchers; quasi-experiments form yet another source of exogenous
variation.
Unlike other approaches to estimating DDC models, the ECCP approach does not require a
full model of the agent’s information set. This is a significant advantage, as modeling market-level
state variables can be both conceptually and computationally demanding in many applications. For
instance, it may be difficult for the econometrician to model the evolution of certain state variables
(e.g., when government policy is in flux as in De Groote and Verboven (2019)); observed market
states may be insufficient to capture the true extent of market heterogeneity (e.g., unobserved local
price variation as in Scott (2013)); or it may be difficult to reliably estimate how market-level state
variables evolve, as when the dimensionality of the state space is large relative to the length of the
panel data (e.g., when the state-space involves industry-level productivity shocks for a variety of
industries as in Traiberman (2019)).
Related Literature. This paper relates to several important prior studies examining the identification and estimation of structural DDC models. In addition to the previously mentioned contributions (which focused mostly on estimation), there exists a growing literature on identification
that builds on the seminal work of Rust (1994) and Magnac and Thesmar (2002). Arcidiacono and
Miller (2019a) investigate the nonparametric identification of DDC models for both stationary and
nonstationary environments in the presence of long and short panel data, relying on single-action
finite dependence to eliminate continuation values.6 Our results build on those of Arcidiacono
and Miller (2019a) by (a) allowing for endogeneity problems in market-level state variables, and
(b) showing that parametric restrictions commonly imposed in applied work allow researchers to
relax the single-action requirement and identify model parameters under general patterns of finite
dependence. Blevins (2014) shows how models with discrete and continuous choice variables can
be identified in the presence of (observed) continuous states under the conditional independence
assumption on the unobservables. Our results can be combined with those of Blevins (2014) to generate an augmented set of moment restrictions that incorporates both the ECCP and the standard
Euler equations for continuous variables.
Serially correlated unobserved state variables in structural dynamic models are a widespread
problem without a standard econometric solution. Kasahara and Shimotsu (2009), Hu and Shum
(2012), Blevins, Khwaja, and Yang (2018), Aguirregabiria, Gu, and Luo (2019), and Berry and
Compiani (2019) represent other approaches to estimating DDC models with unobserved state
variables. Kasahara and Shimotsu (2009) restrict individual unobserved heterogeneity to have a
6

Single-action finite dependence requires that the same action must be chosen repeatedly finitely many times in
order to reset the distribution of the state variables. The empirical papers cited above (Scott, 2013; Diamond, McQuade, and Qian, 2018; De Groote and Verboven, 2019; Traiberman, 2019) make use of one-period finite dependence
(specifically, terminal or renewal actions), which is a special case of single-action finite dependence.

4

discrete distribution that is invariant over time (see also Arcidiacono and Miller, 2011). Hu and
Shum (2012) allow the unobserved state to follow a Markovian process, but require it to be a scalar,
to have the same cardinality as the action space, and to be realized before the realization of the
observed states. Blevins, Khwaja, and Yang (2018) use particle filtering methods to allow for an
unobservable state that follows a first-order autoregressive process. Aguirregabiria, Gu, and Luo
(2019) extend the conditional likelihood approach (in which the likelihood function conditional on
a sufficient statistic does not depend on individual fixed-effects) to estimate structural dynamic
logit models with fixed-effects and two endogenous state variables: the lagged decision variable
and the time duration in the last choice. Berry and Compiani (2019) allow for serially correlated
unobserved states and propose the use of lagged exogenous state variables as instrumental variables
for (econometrically) endogenous states, for models with both continuous and discrete actions, and
obtain partial identification of payoff function parameters in a discrete choice setting.7 Whereas
the ECCP approach allows for market-level unobserved heterogeneity very flexibly, these papers
allow for individual-level unobserved heterogeneity with stronger restrictions on the nature of that
heterogeneity. As such, the ECCP approach complements, and can be combined with, these other
contributions.
Models of dynamic demand is one area where dynamic discrete choice models have been estimated while allowing for endogeneity concerns with market-level variables (i.e., prices being correlated with market demand shocks). Existing studies impose strong functional form restrictions on
how observed and unobserved state variables evolve (Hendel and Nevo, 2006; Gowrisankaran and
Rysman, 2012; Melnikov, 2013). Such restrictions – in particular, inclusive value sufficiency – limit
the dimensionality of the state space to render the problem tractable, facilitating an estimation
approach that relies on solving agents’ dynamic problem. However, such restrictions effectively
impose that in two different states (e.g., high price with low unobserved product quality versus low
price with high unobserved product quality), consumers must have the same expectations. The
ECCP approach avoids both the need to solve the dynamic problem and the need to specify a
restrictive process for how state variables evolve in the estimation procedure.8
Morales, Sheu, and Zahler (2019) and Dickstein and Morales (2018) pioneered the use of Eulerequation-like estimators for DDC models using moment inequalities. The ECCP approach, like
most estimation approaches for DDC models since Rust (1987), relies on the existence of conditionally independent individual payoff shocks with a distribution that is known ex-ante (e.g.,
7
Berry and Compiani (2019) assume the evolution of observed uncontrolled states (i.e., state variables whose
evolutions are not affected by individuals’ choices) is fully independent of the evolution of unobserved states, so
that they can be used as instruments for the observed controlled state variables. The ECCP method, in contrast,
does not require such full independence. Berry and Compiani’s approach and ours are therefore non-nested.
8
Recently, and independently, Chou, Derdenger, and Kumar (2019) considered a special case of the ECCP
method for demand models, requiring two terminal actions for identification. Although the ECCP approach can
accommodate finitely many unobserved types, as in Scott’s (2013) use of Arcidiacono and Miller’s (2011) strategy,
it does not, on its own, accommodate richer unobserved consumer heterogeneity (e.g., continuously distributed
random coefficients on flow utilities). We regard extensions of the ECCP approach that incorporate richer forms of
consumer heterogeneity as an important avenue for future work.

5

logit). In contrast, the moment inequalities approach allows researchers to impose less structure
on payoff shocks, requiring minimal distributional assuptions on the error term. However, the
moment inequalities approach yields only partially identified parameter estimates, and it has only
been shown to be robust to a limited set of endogeneity concerns (e.g., when the error terms are
fixed effects that can be differenced out; see Pakes (2010)).
The remainder of the paper is organized as follows. Section 2 describes the framework, and
introduces four applied examples (dynamic demand for durable goods, land use change, technology
adoption, and dynamic labor supply). Section 3 derives the ECCP equations, and illustrates them
in the context of the applied examples. Section 4 discusses the identification results, as well as
several possible extensions. Section 5 presents the ECCP estimator and establishes its asymptotic
properties. Section 6 shows the Monte Carlo evidence, and Section 7 presents the empirical exercise.
Section 8 concludes. (All proofs can be found in the Online Appendix.)

2

Model

In the model, time is discrete and indexed by t = 1, ..., T , where the time horizon T can be either
finite or infinite. There are N agents operating independently in M independent markets, such as
geographical locations. Every period t, agent i in market m chooses an action aimt ∈ A = {0, ..., A},
A < ∞, with the goal of maximizing her expected discounted sum of payoffs
E

" T
X

#
β τ −t Πimτ |Iimt ,

τ =t

where Πimt denotes per-period payoffs, β ∈ [0, 1) is the discount factor, and E [·|Iimt ] denotes the
expectation operator conditioned on the information set Iimt available to agent i in market m at
time t.
The payoff function Πimt depends on the state variables simt = (kimt , wmt , ηmt , εimt ), where
(kimt , wmt ) are observed by the econometrician, while (ηmt , εimt ) are not. The observed states
kimt ∈ K are “controlled”: their evolution can be affected by the agent’s actions; such states may
include a firm’s capital stock, size or type of product, lagged decisions, and duration in the last
choice. The market-level observed and unobserved states, wmt and ηmt , cannot be affected by
the agent’s actions; such states may include market demand variables, aggregate input prices, or
the government policy environment. We collect these market-level states into the vector ωmt =
(wmt , ηmt ) ∈ Ω. We assume K is finite, as usually done in the literature, but we allow ωmt to be
continuous. Neither assumption is important and our results apply to both discrete and continuous
states. Our results do not require us to specify the dimension of ηmt , so there may be many
unobserved market-level state variables. Finally, the unobservable state εimt = (ε0imt , ..., εAimt ) is

6

i.i.d. across agents and time with a distribution function that is absolutely continuous with respect
to the Lebesgue measure in RA+1 .
As usual, in each period t agents observe the state variables simt , make choices aimt , flow payoffs
are then realized, and states evolve. Agent’s information set Iimt therefore includes all current and
past state variables simt , as well as all past actions.
Assumption 1. (State Transitions) The state variables simt follow a controlled first-order Markov
process with transition distribution function that factors as,
F (simt+1 |a, simt ) = F k (kimt+1 |a, kimt , wmt ) F ω (ωmt+1 |ωmt ) F ε (εimt+1 ) ,

(1)

where ωmt = (wmt , ηmt ). The distribution F ε (εimt+1 ) is known by the econometrician.
Equation (1) limits our focus to settings with small decision makers, as opposed to dynamic
games. It says that market-level state variables ωmt are perceived as exogenous by individual
agents, ruling out settings where an individual agent’s decision can have aggregate impacts (i.e.,
F ω does not depend on individual action a). It also rules out settings where there are externalities
acting through the agent-level state variables k, such as when one agent’s state depends on a
neighbor’s decision (i.e., F k for agent i does not depend on actions of agent j). Further, while
equation (1) accomodates impacts of observable states wmt on the evolution of individual-level
states kimt , it does not allow for impacts of aggregate unobserved states ηmt on kimt . Examples in
which the agent-level states kimt do not depend on aggregate states include capital stocks, time
duration since last action, lagged choices, among others. It is worth mentioning that Assumption
1 does not require that observable and unobservable states, wmt and ηmt , evolve independently
to each other; this allows for (econometric) endogeneity issues, as we discuss below. Finally,
the assumption that F ε is known by the econometrician is standard in the literature; typically,
researchers assume εimt follows a type 1 extreme value distribution or a multivariate normal.
Note that we do not allow for individual-level unobserved states other than εimt ; extensions to
unobserved heterogeneity are possible and discussed in Remark 2 in Section 3.
Assumption 2. (Discount Factor and Payoff ) The discount factor β ∈ [0, 1) is known by the
econometrician. The per period payoff function is given by,
Π (a, simt ) = π (a, kimt , wmt ) + ξ (a, kimt , ωmt ) + εaimt .

(2)

Assuming a known discount factor is also common in the applied literature. In principle, one
can relax this assumption by combining our approach with that of Abbring and Daljord (2019) to
point-identify β.
The payoff function is assumed additively separable in the unobservables ξ and ε. While it
is standard practice to include additively separable idiosyncratic shocks ε in dynamic discrete
7

choice models (Rust, 1994), the other unobserved term of the payoff function, ξ, deserves some
discussion. The function π (a, k, w) depends on observed market-level state variables, w, and so
ξ (a, k, ω) captures the impact of unobserved market-level state variables η on the flow payoff. For
example, in dynamic demand models, this term may capture unobservable product characteristics
(Gowrisankaran and Rysman, 2012). In migration decision models, it may capture location-specific
unobservable amenities (Bishop, 2012; Diamond, McQuade, and Qian, 2018). The term ξ may also
reflect mis-measured profits or unobservable costs (Scott, 2013). In all these applied examples, ξ
enters the payoff function additively. Although this is not without loss of generality (as it restricts
marginal rates of substitutions between observable and unobservable states), relaxing additivity
in payoffs is challenging for point-identification, as we discuss in Remark 3 in Section 3.
It is important to stress that ξ is a function of state variables k and ω = (w, η), and it need
not be a state variable itself. That is, the value of ξ at time t may not be a sufficient statistic for
the distribution of future values of ξ at time t + 1. In the background, there are some (potentially)
more informative state variables ω that agents use to form their expectations about the future.
Consequently, ξ need not evolve according to a first-order Markov process, while ω does.
In addition, π and ξ may be correlated because they may depend on the same state variables w,
or because w and η may not be independent to each other (see Assumption 1). These are reasons
to consider the use of instrumental variables to identify and estimate the model. Without loss of
generality, we assume that ξ is mean zero, and, to simplify notation, define
π ≡ π + ξ.
Next, we introduce four applied examples to illustrate what the ξ term can capture in practice,
and we preview the advantages of the ECCP approach in the context of each example.
Example 1. Durable Demand. In our Monte Carlo study, we consider a model of dynamic
demand for a durable good. Each period t, consumer i in market m decides whether or not to
purchase a unit of a durable good, in turn discarding the old version of the good if she already
owns a unit. The choice set is A = {b, nb}, where b means buying the good, and nb means not
buying the good.
Consumer i controls state kimt ∈ {0, 1} where kimt = 0 if the consumer does not have a unit of
the good at the beginning of time period t, and kimt = 1 when she already owns it. If the consumer
chooses not to buy a new unit of the good (aimt = nb) when she already owns it (kimt = 1), then
there is probability φ of product failure, resulting in kimt+1 = 0. Formally, state k evolves as
follows:



1
if aimt = b


P r (kimt+1 = 1|kimt , aimt , wmt ) = 0
if aimt = nb, kimt = 0



1 − φ if a = nb, k = 1.
imt

8

imt

We consider one observed exogenous state, the price of the product wmt , and one unobserved
exogenous state, a quality shock ηmt . They evolve independently of individual consumers’ decisions
(i.e., consumers are price-takers), but they are not independent to each other: As usual in demand
estimation, prices and unobserved quality shocks correlate. State transitions therefore satisfy
Assumption 1.9
The consumer enjoys the following flow utility when purchasing the product:
π (b, kimt , ωmt ) = θ0 + θ1 wmt + ξ(b, kimt , ωmt ),
where ξ(b, kimt , ωmt ) = ηmt , i.e., the term ξ equals the product unobserved quality. We impose
θ1 < 0 so that demand slopes down. When not purchasing the product, the consumer enjoys utility

π (nb, kimt , ωmt ) =


θ

if kimt = 1

0

if kimt = 0.

0

Notice that the θ0 term appears in the utility function when the good is being consumed, either
through purchase or because the consumer already owns the good. The parameter θ0 can be
interpreted as the flow value of consumption. Note also that we assume ξ(nb, kimt , ωmt ) = 0. Since
the demand shock η enters into consumption only conditional on purchase, we can interpret η as
a quality shock that the consumer only cares about when the product is newly purchased, such
as the quality of the in-store experience or some non-durable services associated with the durable
good. Finally, the utility of not consuming the good is set to zero.
Our Monte Carlo example is a simplified version of more general dynamic demand models; extensions to the general case are straightforward. Other approaches to estimating dynamic demand
systems (e.g. Hendel and Nevo (2006); Gowrisankaran and Rysman (2012)) rely on solving a consumer’s dynamic problem and imposing strong functional form restrictions on how observed and
unobserved state variables evolve. Such restrictions – the so-called “inclusive value sufficiency” –
limit the dimensionality of the state space to render the problem tractable. However, they effectively impose that in two different states (e.g., high price with low quality versus low price with
high quality), consumers must have the same expectations. The ECCP approach avoids both the
need to solve the dynamic problem and the need to specify a restrictive process for how state
variables evolve.
Example 2. Land Use Change. Scott (2013) adopts this framework to model farmers’ land
use choices. In every period t, farmer i in county m chooses whether to plant crops or not,
A = {crops, other}. The farmer’s controlled state variable is the number of years since the field
was last in crops (up to some limit K), so that kimt ∈ {0, 1, . . . , K}. This field state reflects vegetal
9

Note that if the probability of product failure φ were a function of the unobserved quality η, then the transition
F would depend on η, violating Assumption 1.
k

9

cover and the state of the terrain. Formally, k follows a deterministic process: Let k 0 (a, k) denote
the next period state given a and k, then k 0 (a, k) = 0 if a = crops, and k 0 (a, k) = min {k + 1, K}
if a = other.
Market-level state variables include agricultural prices, input costs, government taxes and subsidies, among other relevant variables. Scott assumes farmers are price takers and cannot influence
government policies, which implies that F ω does not depend on individual actions a nor individual
states k. The farmer’s payoff consists of expected returns from the chosen land use and involve
both observed (e.g. crop prices and yields), represented by R, and unobserved returns and costs,
represented by ξ. The payoff function can be written as
π (a, k, ωmt ) = θ0 (a, k) + θ1 R (a, wmt ) + ξ (a, k, ωmt ) ,
where θ0 (a, k) are switching costs parameters. The land-use switching costs create dynamic incentives for landowners
Expected returns R may be calculated based on input and output prices, but price data may
be available only at a regional level, leading to measurement error in returns coming from the
unobserved local price variation. The ξ term captures this measurement error in expected returns.
Measurement error can plausibly render ξ serially correlated. High-priced localities in one year
are likely to be high-priced localities the next year. The ECCP approach can be implemented in
the presence of such serially correlated unobserved local price variation.
Furthermore, in the context of agricultural markets, it is difficult to model the evolution of
observed market-level state variables, given the large set of variables that can influence farmers’
expected returns (e.g., technological conditions, uncertain government policies, crop stocks, etc.).10
As mentioned previously, the ECCP approach does not require specifying what all the relevant
market-level state variables are in the decision making process, nor specifying (and estimating)
how all such variables evolve.
Example 3. Technology Adoption. De Groote and Verboven (2019) study the adoption of
renewable energy technologies for electricity production: the solar photovoltaic (PV) systems. In
every period t, a household i in region m may either choose to not adopt a photovoltaic system,
a = 0, or it may choose to adopt one of the available PV alternatives, so that A = {0, 1, ..., A}.
They assume the controlled state kimt is a dummy variable equal to zero when no solar panel
has been installed, and equal to the type of solar panel when one is already installed, so that
kimt+1 = aimt . They also assume the household no longer makes a PV adoption decision when
10

For example, see Wright (2014) for a discussion of how traditional models of competitive storage fail to explain
recent grain price movements. Wright argues that changes in government policy are crucial in explaining recent grain
market behavior. Modelling and estimating beliefs on policy changes, however, are difficult in practice. Further,
Scott’s measure of crop returns incorporate the prices of eleven different crops: estimating price evolution using an
unrestricted vector autoregression model would then involve 121 parameters, many of which would be difficult to
estimate accurately given that crop prices movements tend to be highly correlated across crops over time.

10

kimt ≥ 1. The adoption decision is therefore a terminating state; not adopting provides the option
of waiting for when the prices may have decreased or when the subsidies for adoption (or the PV
quality) may have increased.
Each alternative a 6= 0 is characterized by observable attributes wamt (including capacity sizes,
upfront investment prices, electricity cost savings, benefits from subsidies for adoption), and by
the unobserved quality (which can be captured by η). The vector of observed state variables is
given by wmt = (w1mt , . . . , wAmt ), and the vector of unobserved quality is ηmt = (η1mt , ..., ηAmt ).11
Individual households are price-takers and not able to influence the evolution of product attributes.
De Groote and Verboven specify a linear-in-parameters flow payoff. Specifically, if no PV has
been adopted (i.e., k = 0), the payoff from adopting option a 6= 0 is
π (a, 0, ωmt ) = wamt θ + ξ(a, 0, ωmt ),
where ξ(a, 0, ωmt ) = ηamt . The payoff of the outside option is set to zero: π (0, k, ωmt ) = 0 for all k
and ωmt .
Given that the adoption subsidies are large (and that their levels change substantially over
time), government policy is an important observable state variable. The ECCP approach allows
for the estimation of the dynamic model without requiring an explicit specification of the law
of motion for government policy. Traditional approaches would either assume that changes in
government policy are either fully anticipated or complete surprises (Ryan, 2012; Kalouptsidi,
2018); the ECCP approach can accomodate these assumptions but does not require them for
identification and estimation.
Example 4. Dynamic Labor Supply. A primary goal of labor economics is to understand how
agents make labor supply decisions. Recent studies have used the DDC framework to investigate
the daily labor supply decisions of taxi drivers, taking advantage of available rich data on taxi
trips in New York City (Buchholz, 2019; Fréchette, Lizzeri, and Review, 2019; Schmidt, 2019).
In our empirical application, we make use of this data to estimate taxi drivers’ optimal stopping
decisions.
At the beginning of each hour t of day m, taxi driver i decides whether to continue working
(a = 1) or to stop (a = 0), so that A = {0, 1}. The decision to stop is a terminal choice that
ends the decision making process for the day. The controlled state variable kimt is the number of
hours the driver has been working during the shift, k ∈ K = {0, 1, ..., K}. It captures the disutility
from fatigue as the shift progresses. This state variable evolves deterministically: k 0 (k, a) =
min{k + a, K}.
Following the previous studies, we take the market-level observed state, wmt , to be the total
earnings the driver expects to make during hour t. It depends on the the probability of finding a
11

In principle, one can consider additional unobserved states. I.e., the unobserved product qualities can be just
a subvector of ηmt .

11

customer, the basic fare (earnings per minute of driving), the trip length, and the customers’ tips.
The unobserved state ηmt captures costs and disutility the driver experiences from factors such
as congestions, weather shocks, construction sites, city events, etc., that are not observed by the
econometrician and are common to all drivers. These shocks may correlate with observed earnings
wmt leading to potential (econometric) endogeneity issues.
Given state k, the driver’s flow payoff when he decides to continue working (a = 1) during hour
t is
π (1, k, ωmt ) = θ0 + θ1 wmt + θ2 k + ξ(1, k, ωmt ),
where ξ(1, k, ωmt ) = ηmt for all k. We expect θ1 > 0 (so that supply slopes up) and θ2 < 0
(reflecting the disutility from fatigue). The payoff when the driver decides to stop is set to zero:
π (0, k, ωmt ) = 0 for all k and ωmt .
The ECCP approach allows for serially correlated unobservable factors affecting the working
decisions while not requiring explicit specification for how the unobserved shocks evolve, extending
therefore the scope of structural estimation for labor supply models.

2.1

Value Functions and Choice Probabilities

To simplify exposition, we now focus on stationary infinite horizon models. Our results apply
however to both non-stationary and finite-horizon specifications, with the usual proper adjustments
to the framework; see Remark 1 in Section 3.
Let V (simt ) be the value function of the dynamic programming problem, i.e., the expected
discounted stream of payoffs under optimal behavior. By Bellman’s principle of optimality,
V (simt ) = max {Π (a, simt ) + βE [V (simt+1 ) |a, simt ]} .
a∈A

Following the literature, we define the ex ante value function:
Z
V (kimt , ωmt ) ≡

V (kimt , ωmt , εimt ) dF ε (εimt ) ,

and the conditional value function:
va (kimt , ωmt ) ≡ π (a, kimt , ωmt ) + βE [V (kimt+1 , ωmt+1 ) |a, kimt , ωmt ] .

(3)

The agent’s optimal policy is given by the conditional choice probability (CCP) function:
Z
pa (k, ω) =

1 {va (k, ω) + εa ≥ vj (k, ω) + εj , for all j ∈ A} dF ε (ε) ,

(4)

where 1 {·} is the indicator function. Define the (A + 1)×1 vector of conditional choice probabilities

12

p (k, ω) = {pa (k, ω) : a ∈ A}.12
Finally, it is worth noting that for any (a, k, ω), there exists a real-valued function ψa (.) derived
only from F ε that satisfies the following equality (Arcidiacono and Miller, 2011, Lemma 1):
V (k, ω) = va (k, ω) + ψa (p (k, ω)) .

(5)

Equation (5) states that the ex ante value function V equals the value obtained by choosing
a today and optimally thereafter (va ) plus a correction term (ψa ), because choosing action a
today is not necessarily optimal. When εimt follows the type 1 extreme value distribution, then
ψa (p (k, ω)) = γ − ln pa (k, ω), where γ is the Euler constant.13

3

ECCP Equations

In this section, we derive the ECCP equation in a simple case and discuss the main identification ideas. To that end, we first consider the available data and relevant objects that can be
estimated directly from the data. Then, we present two important concepts that we rely on in
our identification arguments: expectational errors and the finite dependence property. Based on
these concepts, we then derive the ECCP equations, and illustrate them in the context of the four
examples discussed above. The objective here is to identify the per-period payoff function π. In
Section 4, we present a general ECCP equation and our main identification results; see also Online
Appendix ??.
Data. Assume the available data set is {yimt = (aimt , kimt , wmt , zmt ) : i = 1, ..., N ; m = 1, ..., M ; t =
1, ..., T }, where the vector zmt consists of instrumental variables, as explained below. For our
identification arguments, we assume the joint distribution of yimt is known.
Even though the market state ωmt is not fully observed, the conditional choice probabilities
pa (k, ωmt ) for a particular market m and time period t can be estimated given a sufficiently rich
cross section of agents within market m. That is, if we observe many agents with each value of the
individual state within each market and time period, then pa (k, ωmt ) can be estimated using a simple frequency estimator. The law of motion for the agent-controlled states, F k (kimt+1 |a, kimt , wmt ),
can also be estimated using a simple frequency estimator (when it is not known in advance). For
our identification results, we treat pa (.) and F k (.) as known objects (which implies ψa (.), for all
a, are known as well).14 In contrast, the law of motion for market-level states F ω (ωmt+1 |ωmt )
12

Choice probabilities are invariant to scale normalizations; here we normalize the scale parameter to one. I.e.,
we take Πa = π a + ξa + σεa , with σ = 1.
13
The Arcidiacono-Miller Lemma can be derived from the Hotz-Miller inversion (Proposition 1 of Hotz and
Miller, 1993). Chiong, Galichon, and Shum (2016) propose a novel approach that can calculate ψa for a broad set
of distributions F ε (see also Dearing, 2019).
14
See Online Appendix ?? for a formal justification. In practice, some smoothing across markets or individual
states may be needed.

13

cannot be estimated without strong assumptions. (As state ωmt is not fully observed, F ω cannot
be estimated directly from the data.)
Expectational Errors. We now define expectational errors (also known as forecast or prediction
errors). As will be clear below, expectational errors are useful as they allow us to “dispose” of the
actual expectations when identifying and estimating the model.
Definition 1. (Expectational errors) For any function h (k, ω) and particular realization ω ∗ ∈ Ω,
eh (k 0 , ω, ω ∗ ) ≡ Eω0 |ω [h (k 0 , ω 0 ) |ω] − h (k 0 , ω ∗ ) ,
eh (a, k, ω, ω ∗ ) ≡

X

eh (k 0 , ω, ω ∗ ) F k (k 0 |a, k, w) ,

k0

where k 0 and ω 0 denote next period values for k and ω.
The expectational error eh (k 0 , ω, ω ∗ ) is the prediction error of h (k 0 , ω 0 ) for a particular realized
value of the individual state k 0 ; and eh (a, k, ω, ω ∗ ) is the corresponding prediction error conditioned
on k, w, and a, integrating over the realizations of the individual state k 0 . An important property
of forecast errors is that, under rational expectations, they are mean independent of variables that
belong to the agent’s information set Iimt (see Lemma 1 in Section 4).15
Finite Dependence. Next, we discuss the finite dependence property, proposed by Arcidiacono
k
be the K × K transition
and Miller (2011). To do so, we introduce the following notation: let Famt
matrix for market m at time period t with (n, l) element equal to Pr (kimt+1 = kl |a, kimt = kn , wmt ).
We focus our definition on F k because, as explained below, our approach requires that just the
individual-level transition process must satisfy finite dependence. Importantly, note that finite
dependence is not a behavioral assumption, but a property that the state transition process may
or may not satisfy in the data.
Definition 2. (Finite Dependence) A pair of choices a and j satisfies τ -period finite dependence
if there exists two sequences of actions (a, a1 , . . . , aτ ) and (j, j1 , . . . , jτ ) such that, for all t,
k
k
Fak1 mt+1 . . . Fakτ mt+τ = Fjmt
Fjk1 mt+1 . . . Fjkτ mt+τ .
Famt

(6)

We say that τ -period finite dependence holds for the model if all pairs of actions satisfy τ -period
finite dependence.16

15

In models in which agents have perfect foresight with respect to ω, there is no prediction error and so eh (·) = 0.
In contrast, when agents have biased beliefs, their conditional expectations
do not necessarily


 coincide with the
∗
|Iimt 6= 0 .
true (data generating) conditional expectations, which implies E eh a, kimt , ωmt , ωmt+1
16
The terms in the sequences (a, a1 , . . . , aτ ) and (j, j1 , . . . , jτ ) depend on the particular initial pair of actions
(a, j) chosen; for ease of exposition, we do not incorporate this dependence on the initial pairs into our notation.

14

The τ -period finite dependence property holds if, starting from any two distributions of individual states at the beginning of time period t, there are sequences of actions (not necessarily
optimal) that result in the same distribution of state variables at t+τ . Single-action τ -period finite
dependence is a special case that requires the sequences of actions to be of the type (a, J, . . . , J)
and (j, J, . . . , J), for any actions a and j, and some action J. Exchangeable τ -period finite dependence is another special case requiring two sequences composed of the same set of choices taken in
different time periods (but not necessarily with the same total number of times); e.g., (a, J) and
(J, a), for a one-period dependence, and (a, J, a) and (J, a, J), for a two-period dependence.
Common special cases of one-period dependence are renewal and terminal actions. Action J
is a renewal action if, taking action J in period t + 1 leads to the same distribution of states
at the beginning of time period t + 2, regardless of which state the agent was in during period t.
Examples of renewal actions are replacing the bus engine (Rust, 1987), planting crops (Scott, 2013),
and choosing occupations (Traiberman, 2019). A terminal action ends the decision making process.
Examples of terminal actions include a worker retiring (Rust and Phelan, 1997), a mortgage owner
defaulting (Bajari, Chu, Nekipelov, and Park, 2016), and a household adopting a PV system
(De Groote and Verboven, 2019). For both renewal and terminal actions, (6) simplifies to
k
k
k
k
Famt
FJmt+1
= Fjmt
FJmt+1
.

(7)

for all t and all a, j.
Other models require more than one period to eliminate dependence in state variables. For
example, Bishop (2012), Coate (2016), and Ma (2019) consider different models of migration
decisions with relocation costs and limited memory, so that the utility a household derives from
living at some location at time t + 2 depends on where it was located at the previous period t + 1,
but not on where it was located before that. I.e., dependence on initial choice at t can be broken
after two periods, resulting in two-period finite dependence.
Altug and Miller (1998) consider female labor supply with human capital appreciation and depreciation in which full depreciation of human capital occurs if a woman stays out of the workforce
for τ periods, leading to a single-action finite dependence. Khorunzhina and Miller (2019) also
rely on single-action finite dependence to study housing choices and fertility decisions.
Applications taking advantage of τ -period exchangeable finite dependence include work on
consumers’ stock market participation (Khorunzhina, 2013), schooling and work decisions with information frictions (Arcidiacono, Aucejo, Maurel, and Ransom, 2016), smoking with rational addiction and learning (Matsumoto, 2016), and self-employment decisions (Humphries, 2018; GendronCarrier, 2018).
Arcidiacono and Miller (2011, 2019b) define finite dependence in terms of stochastic sequences
of actions, which is more general than the deterministic sequences presented in Definition 2. We
extend our results to incorporate stochastic sequences in Online Appendix ??, at the cost of
15

more burdensome notation. Allowing for stochastic sequences enlarges the set of models that
can be analyzed and estimated. For example, Ransom (2019) exploits a two-period stochastic
finite dependence property (using employment probabilities as mixing weights) to study the role of
labor market frictions and moving costs in migration behavior of workers. Importantly, (stochastic)
finite dependence can be learned from data based on a finite number of steps; see the algorithm
proposed by Arcidiacono and Miller (2019b). Learning whether finite dependence holds in the
data is important because, while it is conceivable that finite dependence may be satisfied when
one takes sufficiently long sequences of stochastic choices to (eventually) reset the distribution of
states, this property is not guaranteed to be satisfied in short panels; i.e., finite dependence may
hold in the model but not in the data when τ > T . Evidently, our identification arguments assume
that finite dependence is satisfied with τ < T .17
ECCP equation with one-period finite dependence. We now start the derivation of the
ECCP equation. For the sake of exposition, we first focus on deriving it for models with renewal
and terminal actions (and so, satisfying one-period finite dependence). In Section 4, we show that
the ECCP approach extends to models with τ -period finite dependence more generally.
First, note that by combining the conditional value function (3) with equation (5), we obtain:
π (a, kimt , ωmt ) = V (kimt , ωmt ) − βE [V (kimt+1 , ωmt+1 ) |a, kimt , ωmt ] − ψa (kimt , ωmt ) ,

(8)

where ψa (k, ω) is a short-cut notation for ψa (p (k, ω)). Next, note that the expectation of continuation values E [V (kimt+1 , ωmt+1 ) |a, kimt , ωmt ] is given by:
XZ
k0

=

X

=

X

V (k 0 , ω 0 ) dF ω (ω 0 |ωmt ) F k (k 0 |a, kimt , wmt )

ω0


Eω0 |ωmt [V (k 0 , ω 0 ) |ωmt ] F k (k 0 |a, kimt , wmt )

k0

V (k 0 , ωmt+1 ) F k (k 0 |a, kimt , wmt ) + eV (a, kimt , ωmt , ωmt+1 ) ,

(9)

k0

where eV (·) is the expectational error of the value function V (·). Substituting (9) in (8), we obtain
the following equation:
π (a, kimt , ωmt ) + βeV (a, kimt , ωmt , ωmt+1 )
X
V (k 0 , ωmt+1 ) F k (k 0 |a, kimt , wmt ) − ψa (kimt , ωmt ) .
= V (kimt , ωmt ) − β

(10)

k0
17

There are important classes of models in which finite dependence is not valid. For instance, in discrete
choice models in which k depreciates at a constant rate, kimt+1 = δkimt + aimt , where δ < 1 is the depreciation
rate. Examples include capital stock, human capital, and learning-by-doing (as in Benkard, 2000). Yet, finite
dependence can be restored in the absence of depreciation rate, δ = 1, or when the depreciation is stochastic,
kimt+1 = kimt + aimt − fimt , where fimt is a random shock, as in Besanko, Doraszelski, Kryukov, and Satterthwaite
(2010).

16

Here, we make use of realized values of agents’ future expected payoffs V (k 0 , ωmt+1 ) as a noisy
measure of agents’ expected future payoffs. The use of realized values allows us to relax typical
assumptions about how agents form beliefs about the evolution of the (market-level) state variables.
Next, we simplify the notation and use (m, t) subscripts to denote functions that depend on
ωmt . We rewrite payoffs as πmt (a, k) ≡ π (a, k, ωmt ), while π mt (a, k), ξmt (a, k), Vmt (k), pamt (k) and
ψamt (k) are similarly defined. We also make use of matrix notation, so that πamt is a K × 1 vector
that stacks πmt (a, k) for all k ∈ K (and similarly for the vectors Vmt , pamt and ψamt ). Therefore,
(10) in matrix form becomes:
k
πamt + βeVam,t,t+1 = Vmt − βFamt
Vmt+1 − ψamt

(11)

for all a, where eVam,t,t+1 stacks eVmt,t+1 (a, k) ≡ eV (a, k, ωmt , ωmt+1 ) for all k ∈ K, and recall that
k
Famt
is the K × K transition matrix for k in market m at time period t.
We now eliminate the continuation values Vmt and Vmt+1 from (11) to obtain our regression
equation. First, note that the time-t value function term, Vmt , can be removed by simply differencing equation (11) across two different actions, a and j:


k
k
ψjmt − ψamt = πamt − πjmt + β eVam,t,t+1 − eVjm,t,t+1 − β Fjmt
− Famt
Vmt+1 .

(12)

Equation (12) states that the difference in utilities the agent obtains by choosing a today and
optimally thereafter versus choosing j today and optimally in the future equals the difference
between ψjmt and ψamt . This can be viewed as an indifference condition: when the realized
idiosyncratic shock εjimt − εaimt is smaller than the difference in utilities on the right-hand side
of (12), the agent prefers choosing a today and optimally afterwards than j today and optimally
later (see equation (4)); when the realization of εjimt − εaimt is greater than the right-hand side of
(12), she prefers action j over a (and then optimally in the future); and when the realization of
εjimt − εaimt equals ψjmt − ψamt , the agent is indifferent between the two sequences of choices. The
term ψjmt − ψamt can therefore be viewed as providing the agent’s “indifferent” type.
Next, we rewrite (12) by separating payoffs into the observable and unobservable components:
ψjmt − ψamt = π amt − π jmt + ξamt − ξjmt + β eVam,t,t+1 − eVjm,t,t+1

k
k
− β Fjmt
− Famt
Vmt+1 .


(13)

Note that in the static case where β = 0, equation (13) simplifies to
ψjmt − ψamt = π amt − π jmt + ξamt − ξjmt .

(14)

This is a standard logistic regression when ε has a type 1 extreme value distribution (Berry,
1994). In the static logit model, the left hand side of (14) is the log odds ratio of the choice
17



probabilities, ψjmt − ψamt = ln ppamt
. The right-hand side includes the payoff function π and
jmt
the unobservables ξ. If the payoffs for one reference action were known or pre-specified (e.g.,
set π jmt = 0, which is common practice), then π amt can be estimated using standard methods for
regression models. When the unobservables ξ correlate with w (which is an argument of π amt ), then
we need instruments for w, and we can estimate the model parameters using standard instrumental
variables techniques.
In the dynamic model, we still need to handle the time-(t + 1) value function term, Vmt+1 ,
before (13) can be used for identification and estimation. As shown by Arcidiacono and Miller
(2011), continuation values can be eliminated when the finite dependence property holds.
Let J be a renewal or terminal action. If we recursively substitute Vmt+1 , in equation (13), we
obtain
ψjmt − ψamt = π amt − π jmt + ξamt − ξjmt + β eVam,t,t+1 − eVjm,t,t+1

k
k
− β Fjmt
− Famt
(π Jmt+1 + ξJmt+1 + ψJmt+1 ) ,


(15)

because the Vt+2 portions of the value function cancel conditional on action J being chosen in
period t + 1.18
One can view (15) as an Euler equation. Intuitively, much like in equation (12), the equality
in (15) reflects an indifference condition: When the realization of εjimt − εaimt equals ψjmt −
ψamt , the agent is indifferent between choosing a today, J tomorrow and optimally in the future
versus choosing j today, J tomorrow and optimally thereafter. This is similar to traditional Euler
equations, in which perturbations on choices in adjacent time periods followed by optimal choices
in the future in ways that keep the agent indifferent express intertemporal first-order conditions
implied by optimal dynamic behavior. Even though it is not immediately obvious that (15) can be
viewed as a first-order condition, Aguirregabiria and Magesan (2013) has shown that if we treat
the choice probabilities as choice variables themselves, we could derive equation (15) as a firstorder condition, formalizing the analogy between (15) and traditional Euler equations for dynamic
problems with continuous choice variables.19
Finally, by rearranging (15) we obtain


k
k
k
k
− Famt
− Famt
ψJmt+1 = π amt − π jmt − β Fjmt
π Jmt+1 + uajmt ,
ψjmt − ψamt + β Fjmt

18

(16)

Formally, use (11) for J in t + 1 to solve for Vmt+1 and replace the latter in (11) for any a in t:
πamt + βeVam,t,t+1

= Vmt − ψamt


k
k
−βFamt
πJmt+1 + βFJmt+1
Et+1 [Vmt+2 ] + ψJmt+1 .

Next, evaluate the above at a and j and subtract to obtain (15) using property (7).
19
Aguirregabiria and Magesan (2013) do not allow for unobserved state variables as we do, but their approach
to deriving Euler equations by treating choice probabilities as choice variables could be applied in our setting.

18

where the econometric error term is uajmt = e
ξ ajmt + eeVajmt , with
k
k
e
ξ ajmt = (ξamt − ξjmt ) + β(Famt
− Fjmt
)ξJmt+1 ,

(17)

eeVajmt = β(eVam,t,t+1 − eVjm,t,t+1 ).

(18)

The Euler equation (16) can be used to construct moment restrictions that are well-suited
for identification and estimation of the payoff function π. Compared to the static model (see
the logistic regression in equation (14)), equation (16) adds some terms that “correct” for agents’
dynamic behavior. Once the adjustment terms are incorporated into the equation, we can estimate
a regression function that is similar to the static logistic model to recover the parameters of interest.
To summarize, in addition to Assumptions 1 and 2, the main ingredients of the ECCP approach
to identify and estimate the payoff function are: (a) the finite dependence property on individuallevel states k to derive the Euler equation itself, (b) valid instruments to identify the regression
function on the right-hand-side of (16), and (c) pre-specifying the payoff function for some reference
action, as usual in discrete choice models, in order to disentangle the individual flow payoffs in the
regression function.
Next, we return to each of our applied examples, illustrating the regression equations from the
ECCP equation (16) in each context. For the first example, we also outline the steps involved in
the derivation of the ECCP equation, as the derivation for the special case is considerably simpler
than the general derivation above.
Example 1 (continued). Durable Demand. Recall that the choice set is A = {b, nb}, where b
means buying the good, and nb means not buying the good, and that the consumer controls state
kimt ∈ {0, 1} where kimt = 0 if the consumer does not have a unit of the good at the beginning of
time period t, and kimt = 1 when she already owns it. This means that the action of buying the
product, aimt = b, is a renewal action, and so F k satisfies one-period finite dependence.
Assume logit errors. We begin with the Hotz-Miller inversion, or equation (5) differenced across
the two actions:


pb (kimt , ωmt )
= vb (kimt , ωmt ) − vnb (kimt , ωmt ) .
ln
pnb (kimt , ωmt )
In estimating this model, it suffices to focus on kimt = 0. Notice that when kimt = 0 (when the
agent does not own a unit of a good), the state variable kimt is a deterministic function of aimt .
(This simplifies the derivation of the Euler equation substantially.) We expand the conditional
value function given kimt = 0, and introduce expectational errors, as follows:

ln

pb (0, ωmt )
pnb (0, ωmt )


= θ0 + θ1 wmt + ξmt + β (V (1, ωmt+1 ) − V (0, ωmt+1 ))

+β eV (1, ωmt , ωmt+1 ) − eV (0, ωmt , ωmt+1 ) .

(19)

We now exploit the fact that purchasing the good is a renewal action, resulting in the state
19

k 0 = 1 regardless of what the initial state k is. As a result, when we substitute for V (1, ωmt+1 ) and
V (0, ωmt+1 ) in equation (19) using equation (5), the time-(t + 2) value functions cancel, leaving

ln

pb (0, ωmt )
pnb (0, ωmt )


= θ0 + θ1 wmt + ξmt + β [− ln pb (1, ωmt+1 ) + ln pb (0, ωmt+1 )]

+β eV (1, ωmt , ωmt+1 ) − eV (0, ωmt , ωmt+1 ) .

(20)

Equation (20) is the Euler equation for this model, and we can construct a regression equation by
rearranging it to have all the choice probabilities on the left-hand side:
Ymt = θ0 + θ1 wmt + umt ,
where


Ymt = ln

pb (0, ωmt )
pnb (0, ωmt )




+ β ln

pb (1, ωmt+1 )
pb (0, ωmt+1 )

(21)


,

(22)

and

umt = ξmt + β eV (1, ωmt , ωmt+1 ) − eV (0, ωmt , ωmt+1 ) .

(23)

Note that, compared to a static logistic regression, we just need to add an adjustment term to
the dependent variable involving the probability of buying the product at t + 1, and incorporate
the expectational errors to the econometric error term. Given an instrumental variable that is
correlated with the price wmt but not with the error term umt , we can estimate equation (21) using
a linear instrumental variables regression.
Example 2 (continued). Land Use Change. Farmers decide whether to plant crops or not,
A = {crops, other}, and the controlled state variable k equals the number of years since the field
was last in crops. This implies that a = crops is a renewal action, resetting k to zero.
Assuming logit errors, equation (16) can be rewritten for each k as
θ0 (k) + θ1 [R (crops, wmt ) − R (other, wmt )] + umt ,
Ymt (k) = e
where
Ymt (k) = ln
e
θ0 (k)

umt



pcrops,mt (k)
pother,mt (k)



+ β ln



pcrops,mt+1 (0)
pcrops,mt+1 (k0 (other,k))



,

= θ0 (crops, k) − θ0 (other, k)
+β (θ0 (crops, 0) − θ0 (crops, k 0 (other, k))) ,
= ξmt (crops, k) − ξmt (other, k)
+β (ξmt+1 (crops, 0) − ξmt+1 (crops, k 0 (other, k)))

+β eVm,t,t+1 (0) − eVm,t,t+1 (k 0 (other, k)) .

20

Again, given estimates of CCPs, one can construct Ymt (k) and estimate e
θ0 (k) and θ1 using
linear IV regressions. Under the assumption that θ0 (other, k) = 0 for all k, we can recover the
switching costs parameters θ0 (crops, k) from the regression equation intercepts e
θ0 (k).
Example 3 (continued). Technology Adoption. Households choose to adopt one of the
available PV alternatives, or to not adopt any. Given that all adoption choices a > 0 are terminal
actions, (16) can be established for any a > 0 given k = 0. Here we take j = 0 and use J = 1 as
the terminal action in period t + 1 to obtain for any a ≥ 2,
Yamt = (wamt − βw1mt+1 ) θ + ua0mt ,
where


Yamt = ln

pamt (0)
p0mt (0)


− β ln p1mt+1 (0) ,

and

ua0mt = ξamt − βξ1mt+1 + β eVm,t,t+1 (a) − eVm,t,t+1 (0) ,
noting that there is no time-t + 1 choice probability term corresponding to kimt+1 = a in the
definition of Yamt because no decision is made once a PV system has been installed; i.e., p1mt+1 (k) =
0 for k ≥ 1.20
As usual, prices may correlate with unobserved quality ξamt (which are part of the error term
ua0mt ); one needs therefore to instrument for prices to estimate the model parameters. De Groote
and Verboven (2019) use the prices of Chinese modules as instruments, arguing that these prices
are plausibly exogenous to demand shocks in the Belgian market (and therefore a valid instrument)
and that the modules are an important component of solar PV installation costs (therefore, making
module prices a strong instrument).
Example 4 (continued). Dynamic Labor Supply. Taxi drivers decide when to stop working,
implying that action a = 0 is a terminal choice. Focusing on drivers who have been working for at
least one hour (recall that we are not modeling the decision to start the shift), and assuming logit
errors, equation (16) can be written for each k ≥ 1 as
Ymt (k) = θ0 + θ1 wmt + θ2 k + umt ,
where


Ymt (k) = ln

p1mt (k)
p0mt (k)

(24)



20

+ β ln p0mt+1 (k + 1) ,

(25)

In deriving the regression equation with terminal actions, it is convenient to assume that the idiosyncratic
errors have a mean-zero distribution, e.g., the standard type-1 extreme value distribution demeaned by Euler’s
constant. As a result, the expected flow payoffs in the terminal state do not depend on whether or not the agent
still receives an idiosyncratic shock in that state.

21

and
umt = ξmt + β eVm,t,t+1 (k + 1) ,

(26)

noting that, in contrast to the technology adoption case, the t + 1 terms drop from the regression
equation because the agent’s continuation value equals zero once the terminal action is chosen. In
addition, in the last decision period, the future CCP drops from the definition of Ymt (k) given that
there is no more decision to make in the terminal period.
As mentioned previously, the expected hourly earnings wmt can be correlated with the unobservable factors ξmt . In our application, we consider two instruments for wmt . The first instrument
is the (within-day) lagged earnings, wmt−1 . Using lagged regressors as instruments is standard
practice in panel data models; validity of this instrument requires restrictions on the serial correlation of the econometric error term. The second is a “Hausman-type” of instrument: the hourly
earnings in the same hour of the day t but in the previous day m − 1; i.e., wm−1,t . This instrument,
which takes the price of the same service in a different market, is valid when the unobservables are
independent across markets (even when they are serially correlated within markets) – see Hausman
(1996) and Nevo (2000).
Before proceeding to the general case, three remarks are in order.
Remark 1. (Finite-horizon and Nonstationary Models.) Note that the Euler equation (16) holds
regardless of the agents’ time horizons. The ECCP method can therefore be implemented in models
with finite-horizons (as in our taxi drivers example above). Further, by noting that the time index t
can also be a component of the observed state wmt , our approach can be extended to nonstationary
models in which payoffs and observed state transitions can depend directly on the time index t.
Remark 2. (Unobserved Heterogeneity.) The ECCP approach can incorporate individual-level
unobserved heterogeneity by following the strategies proposed by Kasahara and Shimotsu (2009)
and Hu and Shum (2012). They provide conditions to identify type-specific conditional choice
probabilities and transition functions for finitely-many unobserved types in a first step. After typespecific CCPs and (agent-level) transition functions are identified in each market m and time period
t, equation (16) can be used to identify and estimate the payoffs of each individual-level unobserved
type, complementing therefore the ECCP approach.
Remark 3. (Additive Separability in Payoffs.) Assumption 2 requires additive separability in flow
payoffs, π = π + ξ, which severely restricts marginal rates of substitutions between observable and
unobservable states. One reasonable alternative is to assume monotonicity in payoffs, i.e., assume
π(a, k, w, ξ) is strictly increasing in ξ (in the same manner as in the static nonseparable model
of Matzkin, 2003). However, this monotonicity condition implies that the regression function in
(16) would then include too many unobservables in a nonlinear way (ξamt , ξjmt , ξJmt+1 , and the
expectational error eV ). Given that the unobservables cannot be combined into a single-index term,
22

we cannot exploit the strategies proposed by Matzkin (2003) or Chernozhukov and Hansen (2005)
to identify the payoff function. (The same difficulties arise if we drop Assumption 1 and allow F k
to depend on unobservable states.) Identifying the structural parameters π in such settings remains
an open question.

4

Identification

We now discuss the identification of the payoff function π under more general forms of finite dependence. We start the discussion presenting our main propositions, then we turn to the conditions
to obtain valid instruments (Section 4.1), and we close the section with three relevant extensions
to the ECCP framework (Section 4.2).
Take two sequences of actions (a, a1 , . . . , aτ ) and (j, j1 , . . . , jτ ) satisfying τ -period finite dependence (see Definition 2).21 Extending equation (16) to τ -period dependence, we obtain the
following equation (see Online Appendix ?? for a detailed derivation):
k
ψjmt − ψamt + Fjmt

τ
X

k
β d Λjmtd ψjd mt+d − Famt

d=1

= π amt − π jmt +

k
Famt

τ
X

β d Λamtd ψad mt+d

d=1

τ
X

d

β Λamtd πad mt+d −

k
Fjmt

d=1

τ
X

β d Λjmtd πjd mt+d

d=1

+ uajmt

(27)

where the K × K matrix Λamtd is observed (estimable), and is defined recursively
Λamtd =
I,
for d = 1,
k
Λamtd = Λamt,d−1 Fad−1 mt+d−1 , for d ≥ 2,
and the econometric error term is now uajmt = e
ξ ajmt + eeVajmt , with
k
e
ξ ajmt = ξamt + Famt

k
− ξjmt − Fjmt

τ
X
d=1
τ
X

β d Λamtd ξad mt+d
β d Λjmtd ξjd mt+d ,

(28)

d=1

eeVajmt

=

βeVam,t,t+1

+

τ
X

k
Famt

k
− βeVjm,t,t+1 − Fjmt

d=1
τ
X

β d+1 Λamtd eVad ,m,t+d,t+d+1
β d+1 Λjmtd eVjd ,m,t+d,t+d+1 .

(29)

d=1
21

Recall that the sequences depend on the particular initial pair of actions (a, j) chosen. That is, we use ad to
denote the d−th action following the initial action a when the alternative initial action is j.

23

As discussed in the context of the applied examples, to identify and estimate the model parameters based on the regression equation (27), it is key to access valid and relevant instrumental
variables. We therefore assume the researcher has access to such instruments.
Assumption 3. (Instrumental Variables) There exist instruments zmt such that:
(i) For all functions q (wmt ) with finite expectation, if E [q (wmt ) |zmt ] = 0 almost surely, then
q (wmt ) = 0 almost surely,
(ii) E[e
ξ ajmt |zmt ] = 0, for all a and j, and
(iii) E[e
eVajmt |zmt ] = 0, for all a and j.
Assumption 3.(i) is the well-known “completeness condition,” which is the nonparametric analog of the standard rank condition for linear models (Newey and Powell, 2003). Assumptions 3.(ii)
and 3.(iii) are usual exclusion restrictions, requiring mean independence between the instruments
and both the structural errors ξ and the expectational errors eV . We discuss instrument validity
in the next subsection, after presenting our main propositions.
Proposition 1. Suppose Assumptions 1, 2, and 3 hold. Assume that:
(i) For all pair of actions a and j, the single-action τ -period finite dependence property, with
τ < T , holds for the agent-level transition F k and for action J.
(ii) The payoff π (J, k, w) is known for all (k, w).
Then, given the joint distribution of observables yimt = (aimt , kimt , wmt , zmt ), the flow payoff
π (a, k, w) is identified for all (a, k) and almost all w.
Proposition 1 states that the primitive of interest π is nonparametrically identified provided
that single-action finite dependence holds for some action J and that the flow payoff is known
for that same action. Arcidiacono and Miller (2019a) have obtained identification results under
similar conditions for nonstationary models with short panels, but ignoring serially correlated
unobservables and endogeneity problems.
Intuitively, the regression function on the right-hand-side of (27) is nonparametrically identified
in the presence of valid instruments. When action J is choosen repeatedly (τ times) to reset the
distribution of states, the regression function in (27) becomes a function of the payoffs πamt , πjmt ,
and πJmt+d , for d = 1, ..., τ . By taking j = J and assuming πJmt is known for all states, one can
recover the only remaining unknow in the regression function: the flow payoff πamt , for all a 6= J.
Proposition 1 has two limitations. In general, structural dynamic discrete choice models require
restrictions on the payoff function for identification (Rust, 1994; Magnac and Thesmar, 2002). In
the literature, identification typically relies on a restriction of the form π (J, s) = 0 for all states

24

s and an arbitrary action J.22 Proposition 1, however, requires such a restriction on a specific
action J; this is an unusually strong requirement in the dynamic discrete choice literature. For
instance, in a setting with a renewal or terminal action, Proposition 1 requires that the renewal
or terminal action’s payoffs to be known (i.e., restricted ex-ante). While this is satisfied in our
taxi labor supply example (as the flow utility obtained when stop working – a terminal choice –
is set to zero), the other three applied examples presented above do not impose this restriction on
payoffs: In the durable demand example, we do not impose known flow utility when consumers buy
the durable good (noting that buying the good is a renewal action); likewise, the switching costs
parameters of the land use model are set to zero for the “noncrops” action (while the “crops”
choice is renewal); and none of the payoffs obtained from installing a PV system are assumed
known by De Groote and Verboven (even though all such choices are terminal actions). This
means that, while sufficient for identification, assuming π (J, k, w) is known for the specific action
J is not necessary for identification.
Similarly, while single-action finite dependence is part of the sufficient conditions for identification in Proposition 1, it is not necessary. The next proposition shows that, at the cost of
imposing parametric restrictions on payoffs, identification can be obtained under a more general
notion of finite dependence, and it does not require the payoff of a specific action J to be known.
There exists therefore a clear trade-off between the identification of parametric and nonparametric
models in the present context.
Proposition 2. Suppose Assumptions 1 and 2 hold. Assume τ -period finite dependence holds for
the agent-level transition process F k , with τ < T . Assume also a linear-in-parameters flow payoff:
π (a, k, w) = x (a, k, w) θ, where θ ∈ RP , and x (a, k, w) is a known (vector) function. Let Xamt be
a K × P matrix with elements given by x (a, k, wmt ), so that π amt = Xamt θ, and define
eajmt ≡
X

Xamt +

k
Famt

k
− Xjmt − Fjmt

τ
X
d=1
τ
X

β d Λamtd Xad mt+d
β d Λjmtd Xjd mt+d .

(30)

d=1

Denote the K × 1 vector on the left hand side of (27) by Yajmt . Stack equation (27) for all feasible
combinations of actions (a, j) ∈ A to obtain the following equation
emt θ + umt ,
Ymt = X

(31)

emt , and umt stack the vectors Yajmt , X
eajmt and uajmt , respectively. Let Zmt be an
where Ymt , X
L × K matrix of instrumental variables with L ≥ P . The parameter θ is identified provided
22

Such identifying restrictions matter for some, but not all counterfactuals; see Aguirregabiria (2010), Norets
and Tang (2014), Arcidiacono and Miller (2019a), and Kalouptsidi, Scott, and Souza-Rodrigues (2019) for more
details.

25

emt ]) = P .
E [Zmt umt ] = 0 and rank(E[Zmt X
Compared to Proposition 1, Proposition 2 imposes a linear-in-parameter payoff function, but
does not require the single-action finite dependence property for some J, nor pre-specifying the
payoff of that same action J. General patterns of finite dependence, including exchangeable sequences, can be accommodated because the regression function in (31) is a linear function of the
parameters θ for any such sequences of choices. Proposition 2 can therefore be used to extend
previous empirical applications exploring more than one-period (and not just single-action) finite
dependence to incorporate serially correlated unobservable states and endogeneity (e.g., Coate,
2016; Matsumoto, 2016; Ma, 2019). The extension of Proposition 2 to stochastic finite dependence
is shown in the Online Appendix (see Proposition ?? in Online Appendix ??).
It is important to notice that while Proposition 2 does not require the payoff parameters of
emt ]) = P still implicitly limits
a particular action to be known, the rank condition rank(E[Zmt X
the number of parameters than can be identified. See, e.g., the dynamic land use change model
discussed in Example 2. However, the condition is straightforward to check for a given data set
and parametric specification.

4.1

Discussion: Instrument Validity

In this subsection, we discuss conditions for instrument validity. We consider the two components
of the econometric error term, umt = e
ξ mt + eeVmt . We start the discussion with the structural
unobservable term e
ξ mt , and then we move to the expectational error eeVmt . To simplify, we ignore
endogeneity issues related to one component when discussing the other one, but one should keep
in mind that instrumental variables must be uncorrelated with both components. We close this
subsection by focusing on the specifics of our four examples.
Structural Errors ξ. Recall that ξmt is a function of observed and unobserved market-level
states ωmt = (wmt , ηmt ). If (a) ξmt is a function of ηmt but not of wmt , and (b) the observed and
unobserved market-level states, wmt and ηmt , evolve independently to each other, then wmt and
ξmt are fully independent and wmt can be taken as exogenous in the regression equation (27). In
contrast, if ξmt depends on wmt (e.g., when ξ captures measurement errors), or if wmt and ηmt
do not evolve independently (e.g., when w are observed prices and η captures quality shocks in
demand models), then wmt and ξmt are correlated, in which case the use of excluded instruments
becomes necessary for identification.
One possible source of instruments comes from the structure of simultaneity problems, as
the identification of demand models using supply shifters as instruments; see, e.g., De Groote
and Verboven (2019). Another possibility is to use Hausman-type of instruments by exploring
independence across markets m and using observable states in other markets, as we do in our taxi
drivers’ empirical illustration.

26

A third possible source of instruments in panel data settings is lagged regressors. Requiring
lagged state variables to be uncorrelated with e
ξ mt demands restrictions on the evolution of ξmt .
For instance, suppose wmt is serially correlated but e
ξ mt is not, as when e
ξ mt = ξmt captures i.i.d.
measurement error in w. Then, any lagged regressor, wmt−d with d ≥ 1, may serve as valid
instrument. Lagged covariates may also serve as instruments when e
ξ mt = ξmt , but ξmt is itself
serially correlated (as in Example 1; see the Monte Carlo study in Section 6). More generally,
when e
ξ mt incorporates both ξmt and future values ξmt+1 (as in Examples 2 and 3 above), then e
ξ mt
will be serially correlated by construction (even when ξmt is i.i.d.), which means that further lags
of wmt may be needed to obtain valid instruments.23
The use of lagged states as instrumental variables in dynamic models is also explored by
Berry and Compiani (2019). Similar to the ECCP approach, they allow for serially correlated
unobservable states that also correlate with observable states, resulting in econometric endogeneity
problems. However, in contrast to the ECCP approach, they assume that the unobservable states
are correlated with the controlled states, but are fully independent of the uncontrolled states. In
our notation, they assume that ξ (or η) correlate with k, but ξ (or η) evolves independently of w,
rendering lagged w valid instruments for k. The ECCP approach addresses a different endogeneity
problem: it does not require full independence between ξ and w, but it does require that the
transition process for k does not depend on unobserved states.24
Expectational Errors eV . We now discuss the expectational error term, eeVmt . It is clear that, to
obtain variables that are uncorrelated with prediction errors, we need to make (minimal) assumptions on agents’ information sets and beliefs. One common assumption in the applied literature is
rational expectations.
Assumption 4. (Rational expectations) Agent’s expectations conditional on the information set
Iimt correspond to the conditional expectations of the true data generating process given Iimt .
Rational expectations is useful for the ECCP approach because it offers sources of instrumental
variables. Intuitively, when agents have rational expectations, forecast errors are mean independent
of variables that belong to the agent’s information set Iimt (Hansen and Sargent, 1980; Hansen
and Singleton, 1982). The next lemma formalizes this intuition in the present context:
Lemma 1. Suppose Assumption 4 holds. Then,
23
The unobservable e
ξ mt may also correlate over time when it involves an additive market-level fixed-effect. In
this case, it is possible to difference the fixed-effect out as usually done in linear panel data settings.
24
Berry and Compiani (2019) estimate the policy function in the first step by regressing actions on states, and
then estimate model parameters in the second step in a spirit similar to Bajari, Benkard, and Levin (2007). They
make use of the generalized instrumental variable (GIV) approach proposed by Chesher and Rosen (2017) in the first
step. When actions are discrete, the policy function is partially identified, implying set-identified model parameters
in the second step. Importantly from a practical point of view, while the GIV approach allows for a large number
of unobservables in theory, it is computationally difficult to calculate the identified sets in the presence of many
unobservables. The ECCP approach does not suffer from this difficulty.

27


∗
(i) For any action a and individual state k, the expectational error term eh a, k, ωmt , ωmt+1
is
 h


∗
mean zero given the information set available to the agent: E e a, k, ωmt , ωmt+1 |Iimt = 0.

∗
(ii) For zmt ∈ Iimt , E[eh a, k, ωmt , ωmt+1
|zmt ] = 0, for all a and k.
(iii) Expectational errors are serially uncorrelated.
Lemma 1 shows that, when agents have rational expectations, and when instruments belong
to agents’ information sets, expectational errors eV are mean independent of zmt . Assumption 4
therefore implies Assumption 3.(iii).25 Furthermore, because lagged values of wmt are in agent’s
contemporaneous information set, they can serve as instruments under the rational expectations
assumption.
Future values of the state variables, in contrast, cannot be used as instruments because they
correlate with forecast errors. Specifically, recall that the expectational error term at t captures
the difference between realized value functions at t + 1, Vmt+1 , and their time-t expectations,
E[Vmt+1 |Iimt ], and note that the realization of the value function at t + 1 will be correlated with
realized covariates at t + 1, wmt+1 . Put differently, wmt is not strictly exogenous in the regression
equation (27), making lead covariates invalid instruments.
Another important and related aspect of the problem is that in some (but not all) models,
the regression function in (27) includes future values of the covariates. In parametric models,
emt in equation (31) may include covariates observed at t + 1 or
the right-hand-side variable X
subsequent periods, as specified in (30) (see, e.g., Example 3). As explained in the previous
paragraph, future values of wmt correlate with forecast errors; this creates a mechanical endogeneity
problem in the ECCP equation. For such cases, the researcher needs appropriate instruments in
the contemporaneous information set for those future values of covariates.26
To be more concrete, we now close this section by focusing the discussion of instrument validity
exclusively in the context of our examples. In the durable demand model (Example 1), the econometric error term is umt = ξmt + eeVmt , with ξmt capturing serially correlated unobserved product
quality shocks. In our Monte Carlo excercise (Section 6), we use supply shifters as instruments
for product prices, assuming supply shifters are uncorrelated with demand shocks ξ, and assuming
25
Strictly speaking, Lemma 1 implies that E[eVajmt |zmt ] = 0 while condition (iii) of Assumption 3 requires
 V

E eeajmt |zmt = 0, where eeVajmt includes eVajmt as well as potentially eVajm,t+d terms with d ≥ 1. As discussed
in the proof of Lemma 1, an instrument zmt in the time-t information set will also be uncorrelated with future
expectational error terms.
26
Endogeneity problems due to expectational errors are also a central concern in Dickstein and Morales (2018)
and Morales, Sheu, and Zahler (2019). They construct discrete-choice analogues of Euler equations by comparing
observed choice paths and paths involving one-period deviation in models with one-period finite dependence. Given
that observed paths should be preferred to deviations, revealed-preference arguments provide the basis to construct
moment inequalities, featuring forecast errors at the t + 1 time period. While their approach allows for large choice
sets (which is difficult to accomodate in the ECCP approach), it rules out unobserved heterogeneity, including
serially correlated unobserved states, implying that observationally equivalent agents always prefer the same path
of choices than the constructed alternative deviations.

28

consumers do not make systematic mistakes in predicting future values Vmt , so that consumers’
forecast errors eeV do not correlate with supply shocks. In the dynamic land use change model
(Example 2), Scott (2013) uses lagged observed returns as instruments for contemporaneous returns, R(crops, wmt ) − R(other, wmt ), therefore imposing restrictions on the serial correlation of
the econometric error term. Scott also assumes farmers have rational expectations, so that lagged
returns do not correlate with expectational errors by construction.27 In the technology adoption
problem (Example 3), the econometric error term includes both present and future demand shocks,
ξmt and ξmt+1 , in addition to the prediction error. De Groote and Verboven (2019) use time-t cost
shifters as instruments for PV prices (as mentioned previously), assume these shifters are part of
households’ information sets, and impose rational expectations. Under these assumptions, cost
shifters are uncorrelated with both demand shocks and forecast errors. In our taxi drivers’ labor
supply application (Example 4), we take each working day as a market and use hourly earnings in
previous days (i.e., in other markets) as instruments for today’s earnings. We assume unobservable factors are independent across markets, and assume rational expectations (so that earnings
in previous days are part of agents’ information sets).

4.2

Extensions

We now briefly discuss three relevant extensions to the ECCP framework: the potential use of
quasi-experiments as plausible sources of exogenous variation, models with biased beliefs or perfect
foresight as alternatives to the standard rational expectations framework, and models with learning.
Quasi-Experiments. The ECCP approach can be combined with randomized control trials or
quasi-experiments to identify the model parameters. For instance, Diamond, McQuade, and Qian
(2018) extend the linear IV approach to a set of difference-in-differences regressions that explore
variation in the assignment of rent control due to a 1994 ballot initiative in San Francisco. The
idea is that equation (27) holds for both (randomly assigned) treatment and control groups. Given
that families in both groups can live in the same neighborhood m, it is possible to difference (27)
across groups to eliminate local unobservable amenities ξmt that correlate with observable variables
wmt and estimate the model parameters. In this way, they avoid the need to find instrumental
variables to handle the correlation between ξ and w.
Biased Beliefs and Perfect Foresight. Although rational expectations is a useful assumption
that helps find plausible instrumental variables, it is clear that Propositions 1 and 2 do not require
such assumption. Identification of model primitives can therefore be obtained under biased beliefs.
The challenge in this case is to find plausible instruments that do not correlate with systematic
errors eV .
27

In addition, Scott (2013) differences out county-level fixed-effects in the ECCP regression.

29

The main difficulty under biased beliefs is not just that expectational errors are not mean zero, it
is that the errors may also be serially correlated. Given that systematic prediction errors correlate
with serially correlated covariates wmt , they then also correlate with lagged covariates wmt−d ,
turning lagged regressors invalid instruments. Unless the researcher imposes more restrictions on
agents’ beliefs (such as imposing some learning process combined with limited memory so that
systematic mistakes do not extend for more than a limited number of time periods), the researcher
cannot make use of lagged regressors as instrumental variables.
An alternative is to construct other moment restrictions based on (27) or (30) that do not
require rational expectations. That is indeed the solution proposed by Diamond, McQuade, and
Qian (2018). While they exploit the difference in treatment and control groups to eliminate local
unobserved amenities ξmt , as mentioned previously, they still need to handle endogeneity problems
related to the expectational error terms – composed of the difference between the forecast errors of
treatment and control groups. In their differenced Euler equations, there is a mechanical correlation
betweeen future covariates in the regression function and forecast errors. They use lagged states
in agents’ information sets as instruments. While lagged states may correlate with forecast errors
under biased beliefs, they assume that the difference in expectations between treatment and control
households in the same year are zero on average. I.e., agents may have biased beliefs, but cannot
have beliefs that differ systematically across groups. That is a plausible assumption given the
random assignment of households to treatment and control groups. They therefore combine their
difference-in-differences approach with instrumental variables to estimate their model.
At the other extreme, the same Euler equation (27) can be derived from the assumption that
agents have perfect foresight about the market state ωmt . Recall that our regression equations
have residuals of the form umt = e
ξ mt + eeVmt . When agents have perfect foresight about ωmt ,
the unobservable component of the payoff becomes the entire residual, i.e., umt = e
ξ mt . This
reinterpretation of the residual is of no consequence for the method-of-moments estimators we
propose, since the moments depend only on the value of the entire residual umt .28
Learning Models. The ECCP approach can be used to study learning models in which learning
depends on individuals’ choices and experiences. For Bayesian learning processes, the same number
(and intensity) of signals along two exchangeable sequences of choices result in the same expected
distribution of a future period’s beliefs. I.e., the timing of the signals (obtained from individual
choices) that reveal information to agents about an underlying parameter does not matter, while
the number of signals do; this is a mechanical result from Bayesian updating. In this way, one can
take advantage of exchangeable finite dependence to study decisions under information frictions
(see, e.g., Arcidiacono, Aucejo, Maurel, and Ransom, 2016; Matsumoto, 2016). Similarly, learning28

Note however that a misspecified perfect foresight model would ignore the mechanical endogeneity problem
coming from the expectational error terms (as discussed above, expectational error terms are generally correlated
with realized values of future variables). This would give the wrong impression that future covariates could be used
as instruments, which in turn would produce biased parameter estimates.

30

by-doing models with (stochastic) organizational forgetting, as in Besanko, Doraszelski, Kryukov,
and Satterthwaite (2010), can exploit exchangeable finite dependence to identify and estimate
the model primitives. For both types of learning models, the ECCP approach can allow for
unobservable states and be flexible with respect to how these states evolve over time.

5

Two-stage Estimation

In this section, we present the ECCP estimator and establish its asymptotic properties. We follow
the tradition of Hotz and Miller (1993) and estimate conditional choice probabilities and transition
probabilities in the first step, and estimate the model parameters in the second step. To simplify
exposition, we assume a large number of individuals N and markets M , but we hold the number
of time periods T fixed. Asymptotic results can be extended to large T by imposing stationarity
and ergodicity assumptions.
Although it is possible to nonparametrically estimate payoff functions π (following Proposition
1), here we consider a parametric model π (a, k, w; θ0 ), where θ0 ∈ Θ ⊂ RP is the parameter of
interest. Parametric models estimated using panel data involving large number of cross-sectional
observations and small number of time periods is common in applied work.29

5.1

First Stage

k
In the first stage, we estimate pamt (.) and Famt
(.) in all markets m and all available time periods
k
t. Denote the estimators for the CCPs and transition probabilities by pbamt and Fbamt
. Because K
30
is finite, we consider the frequency estimators:

PN
pbamt (k) =
k
Fbamt
(k 0 |k) =

1 {aimt = a, kimt = k}
,
PN
i=1 1 {kimt = k}

i=1

PN

i=1

1 {aimt = a, kimt = k, kimt+1 = k 0 }
.
PN
i=1 1 {aimt = a, kimt = k}

We impose the following condition for each market m and each time period t.

29
Nonparametric payoff functions π can be estimated in the second step using estimators proposed by Newey
and Powell (2003) or by Escanciano, Hoderlein, Lewbel, Linton, and Srisuma (2018). While the former involves
ill-posed inverse issues, the latter combines standard kernel estimation with the computation of a matrix eigenvector
problem in a way that avoids the ill-posed inverse problem. Aradillas-Lopez (2015) investigates the semiparametric
efficiency properties of estimators of parametric models with rational expectations in which agents’ beliefs are treated
nonparametrically as “generated regressors.” This approach may be useful in our context when k is a continuous
variable.
30
Recall that results can be adapted to more complicated estimators of CCP and transitions. For instance, we
can incorporate time-invariant observables that affect individuals’ choices, as well as unobservable heterogeneity as
in Kasahara and Shimotsu (2009) and Arcidiacono and Miller (2011) (see also Scott, 2013).

31

Condition 1. The observations {aimt , kimt : i = 1, ..., N } are i.i.d. conditional on the market level
state ωmt .
Condition 1 formalizes the idea that ωmt is a common shock affecting all agents i in market
m at time period t. As shown in Andrews (2005), this assumption is valid when the sample of
individuals are drawn randomly from the population. (Sources of spatial dependence among agents
within markets other than the common shock ω can be accommodated in our framework, but is
beyond the scope of the paper.)
The probability limits of pbamt and Fbamt can be determined following the Law of Large Numbers
for exchangeable random variables (see Hall and Heyde, 1980). In addition, the result can be
strengthened to a law of iterated logarithm, which is an important input to derive the asymptotic

k
k
results for the second step. To simplify notation, stack the vectors (b
pamt , Fbamt
) and pamt , Famt
for
all actions and states, and denote them, respectively, by b
δ mt and δmt . Note that δmt is itself random

k
depends on the realization of ωmt . In what follows, we use the Euclidean norm
because pamt , Famt
31
k.k.
Lemma 2. Suppose Condition 1 holds. Then,
b
δ mt → δmt a.s.,

(32)

as N → ∞. Moreover,
r
b
δ mt − δmt = Oa.s.

5.2

log log N
N

!
.

(33)

Second Stage

Recall that, for each combination of a and j, the unobservable uajmt is the K × 1 vector satisfying
(27). Define the vector umt (θ, δmt ) that stacks uajmt for all feasible combinations of (a, j), and
define the function gmt (θ) = h (zmt ) umt (θ, δmt ), where h (zmt ) is a conformable function of the
instrumental variables. The unconditional moment restriction (implied by Assumption 3) is then
E [h (zmt ) umt (θ0 , δmt )] = 0.

(34)

Define the function g (θ) ≡ E [gmt (θ)]; the GMM population criterion function is given by
Q (θ) = g (θ)0 Wg (θ) ,

31

(35)

Although we do not exploit the asymptotic distribution of b
δ mt in this paper, note that it can be obtained
following
the
arguments
in
Andrews
(2005).
Specifically,
under
the
regularity conditions stated in Andrews (2005),
√
N (b
δ mt − δmt ) converges in distribution to a mixture of normal distributions that depend on the common shock
ωmt .

32

where W is a (non-stochastic) positive-definite weighting matrix. By the identification results, θ0
is the unique minimizer of Q (θ).
Next, consider the sample analogue of (35). Define the functions
gbmt (θ) = h (zmt ) umt (θ, b
δ mt ), and

(36)

M,(T −τ )

gbM (θ) =

X
1
gbmt (θ) ,
M (T − τ ) m=1,t=1

(37)

where τ reflects the τ -finite dependence assumption (see Definition 2). The GMM criterion function
is then given by
bM (θ) = gbM (θ)0 WM gbM (θ) ,
Q
(38)
where WM is a positive-definite weighting matrix that may depend on data. The estimator b
θM
bM (θ) over Θ.
minimizes Q
The next set of conditions suffices for consistency of b
θM .
Condition 2. Conditions for consistency:
(i) The vector (wmt , zmt ) is i.i.d. across markets m.
p
(ii) WM → W as M → ∞.
(iii) Θ is compact.
(iv) θ0 uniquely minimizes Q (θ) over Θ.
(v) π amt (θ) is continuous at each θ ∈ Θ for all a ∈ A.
(vi) E [supθ∈Θ kh (zmt ) umt (θ, δmt )k] < ∞.


(vii) E supθ∈Θ kh (zmt ) ∇δ umt (θ, δmt )k2 ≤ B < ∞, where B is a finite constant.
Condition 2 establishes standard regularity conditions that guarantee the problem is wellbehaved. The assumption that market-level variables are independent across markets simplifies
the derivation of the asymptotic results (Condition 2(i)), but results can be extended to allow for
spatial dependence across markets (Conley, 1999; Andrews, 2005; Kuersteiner and Prucha, 2013).
Condition 2(ii)–(vi) are standard. Condition 2(vii) is used in conjunction with equation (32) in
Lemma 2 of Section 5.1, to guarantee uniform convergence in probability of the criterion function
to its population version. The term ∇δ umt is the derivative of the vector umt with respect to δ,
which in turn, depends on the derivative of ψa with respect to the CCPs (see equation (27)). As
shown in Kalouptsidi, Scott, and Souza-Rodrigues (2019), ψa is indeed a differentiable function
of p (k, ω), provided p (k, ω) lies strictly between zero and one (which is satisfied when payoffs are
bounded and εimt has full support on RA+1 ).
p
Proposition 3. Under Conditions 1 and 2, b
θM → θ0 as (M, N ) → ∞.

To obtain the asymptotic distribution of b
θM , we impose the following:

33

Condition 3. Conditions for asymptotic distribution:
(i) θ0 ∈ interior (Θ).
(ii) π amt (θ) is continuously differentiable in a neighborhood N of θ0 with probability approaching
one for all a ∈ A.
(iii) E[kh (zmt ) umt (θ0 , δmt )k2 ] < ∞, and
θ∈N kh (zmt ) ∇θ umt (θ, δmti)k] < ∞.
h E [sup
PT −τ
1
0
(iv) G WG is nonsingular for G = E T −τ t=1 h (zmt ) ∇θ umt (θ0 , δmt ) .
Similar to Condition 2, Condition 3 imposes standard regularity conditions to make the problem
well-behaved. The next proposition follows.
Proposition 4. Suppose Conditions 1, 2 and 3 hold. Assume (M log log N )/N → 0, as (M, N ) →
∞. Then,

√ 
p
b
M θM − θ0 → N (0, V) ,
where
−1

V = (G0 WG)

−1

G0 WΣWG (G0 WG)

and
"
Σ=E

!
T −τ
1 X
gmt (θ0 )
T − τ t=1

,

!0 #
T −τ
1 X
gmt (θ0 )
.
T − τ t=1

The asymptotic distribution of b
θM in Proposition 4 is the same as the distribution of an
unfeasible estimator in which δmt is observed instead of estimated in the first step. The first step
estimators b
δ mt , for all markets and time periods, do not affect the asymptotic variance of b
θM
when the number of observations within markets N is sufficiently large compared to the number
of markets M . The rate at which N must increase to eliminate the influence of the first step on
the variance of the second step is M logNlog N → 0 as (M, N ) → ∞. This rate is a direct result of
the Law of Iterated Logarithm obtained in Lemma 2.32
Consistent estimators for V and optimal weighting matrices for W can be obtained using
standard arguments and are omitted here (see, e.g., Theorem 4.5 in Newey and McFadden (1994)).
We close the section with a discussion of two practical concerns regarding asymptotic inference.
Remark 4. (Macroeconomic Shocks.) The presence of aggregate shocks can pose difficulties to
estimation and inference in nonlinear panel data models in general (see, e.g., Hahn, Kuersteiner,
and Mazzocco, 2019). In the present case, the difficulty may depend on whether the researcher
has a short or long panel. Recall that when the instruments belong to the agent’s contemporaneous
information set, and when agents have rational expectations, the instruments are uncorrelated with
eeVmt . Yet, it is important to note that, while the expectational error terms are mean-zero given Iimt ,
there is a distinction between the way eV averages out in the cross-sectional dimension M and the
32

When N is not sufficiently large relative to M , the first step may affect the distribution of the estimator in the
second step. See Chernozhukov, Escanciano, Ichimura, Newey, and Robins (2018) and Dearing (2019) for strategies
to orthogonalize the influence of the first step on the distribution of b
θM .

34

way it averages out in the time-series dimension T . For instance, if in a given time period t, a
macro shock affects all agents in all markets, then the prediction errors eV do not average out to
zero asymptotically when M → ∞. For this averaging out to happen as the cross-section becomes
large, we do need to make a substantive assumption about the correlation across markets. Such type
of assumption may be appropriate for some applications, but it may not be appropriate when, for
example, markets are geographically defined and state variables include prices whose movements
over time are strongly correlated around the world (e.g., transportable commodities).
In contrast, in a large-T setting, asymptotic convergence involving eV terms does not require a
substantive assumption about how markets are correlated. Instead, rational expectations guarantees
that expectational error terms are serially uncorrelated (see Lemma 1). Intuitively, when T → ∞,
macro shocks wash out in the limit. We investigate this possibility in our Monte Carlo exercise by
exploring the finite sample performance of the ECCP estimator with different sample sizes M and
T , both in the presence and absence of macro shocks.
Remark 5. (Observation Weights.) The efficiency of the ECCP approach can potentially be
improved by considering observation weights in the second stage. In general, in the presence of
heteroskcedastic errors, optimal regression weights are inversely proportional to the variance of each
observation’s error term umt . The variance of the error term depends on the (first-stage) choice
probabilities and can therefore be inferred from the choice probability estimates and the sample
size used to estimate them. From this, the variance of the dependent variable in equation (16)
can be computed, yielding appropriate observation weights. Note that these weights can reduce the
influence of imprecisely estimated first stage CCP’s, since, in practice, even large data sets can
have small sample sizes after conditioning on certain state variables.

6

Monte Carlo

In this section, we present a Monte Carlo experiment to illustrate the performance of the ECCP
estimator, focusing on the dynamic demand model for a durable good discussed in Example 1.
Recall that the choice set is A = {b, nb}, where a = b if the consumer buys the good, and
a = nb if she does not buy it. The individual-level state kimt reflects whether she already owns the
product or not at the beginning of time period t. We consider two market-level state variables:
observed price wmt and unobservable quality ξmt .33 We also consider an observed supply (cost)
shifter zmt (that will play the role of an instrumental variable). The price is a function of zmt and
ξmt , determined as follows:
wmt = γ0 + γ1 zmt + γ2 ξmt + εw
(39)
mt ,
33

Recall that, formally, we can define ηmt as the state variable, while the function ξ(a, k, ωmt ) equals ηmt when
a = b, and equals zero when a = nb. I.e., the unobserved quality enters into the utility of purchasing the good and
not into the utility of not purchasing (whether the good is already owned or not). To simplify notation, we take
ξmt as the state variable.

35

2
where εw
mt is a mean-zero normally distributed i.i.d. price shock with variance σw . Note that γ1
represents how variation in the observed cost shifter zmt passes through to prices. ξmt is included
in the price equation to capture the idea that demand shocks may influence the price.
The supply shifter zmt and unobserved quality ξmt follow independent AR(1) processes:

ξmt+1 = ρ1 + ρ2 ξmt + εξmt ,
zmt+1 = ρ3 + ρ4 zmt + εzmt ,
where εξmt and εzmt are normally distributed zero-mean i.i.d. shocks with variances σξ2 and σz2 ,
respectively. Recall that ξmt has mean zero by assumption, so we take ρ1 = 0.
We consider two settings in our simulations, depending on whether the unobservable state ξ is
present in the data generating process or not. When there is no unobserved states, we set ξmt = 0
for all m and t (or, equivalently, we set σξ2 = 0).
As many applications may feature aggregate shocks, we also consider two scenarios: with and
without macro shocks. In the scenario with aggregated shocks, we incorporate them into the term
εzmt . Specifically, we simulate εzmt = εzm,t,1 + εzt,2 , where the (mean-zero) macro shock εzt,2 accounts
for a fraction λz of the variance in εzmt . (Recall that macro shocks wash out in the limit when
the number of time periods goes to infinity, but they may not wash out in the limit when the
asymptotics is in the number of markets.)
We consider several possible sample sizes with different combinations of M and T . For each
sample structure, we generate 5,000 Monte Carlo replications. For the first sample period, we
generate the value of the state variables from their steady-state distributions. The supports of the
market-level state variables are discretized to take integer values. We solve the individual dynamic
optimization problem by value function iteration on the discretized state space.34 The parameters
of the data generating process in our Monte Carlo study is summarized in Table 1.
The main parameters of interest are the payoff parameters θ = (θ0 , θ1 ), which are estimated
based on the regression equation (21). We estimate θ using two ECCP estimators: the first
estimator is based on the Ordinary Least Squares (OLS) estimator, while the second one is based
on instrumental variables – specifically, the Two-Stage Least Squares (2SLS) estimator.
We also estimate θ using a standard CCP estimator similar to Hotz and Miller (1993). This
procedure relies on a full specification of what the state variables are and how they evolve. To
implement this procedure, we assume that the price wmt is the only market-level state variable and
model its evolution as a first-order Markov process. So, when the unobserved quality is a relevant
state (i.e., when σξ2 > 0), this strategy is based on a mis-specified model. See Online Appendix ??
for details.
34

We simulate conditional choice probabilities for each market-period and assume these CCPs are observed by
the econometrician. Thus, we abstract away from any first-stage sampling uncertainty in the estimation of choice
probabilities and effectively assume a (sufficiently) large number of agents N within each market-year.

36

Table 2 presents results for a model with no unobservable demand shocks (i.e., σξ2 = 0). For
each model parameter, each sample structure, and each estimator, we report the average estimate,
the relative mean bias (as a percentage of the true parameter), the standard deviation, and the
root-mean squared error (RMSE) of the estimator. On the left panel, we present results for the
scenario with no macro shocks (i.e., λz = 0), and on the right panel, we present the estimated
results with aggregated shocks (λz 6= 0).
In the absence of macro shocks, all estimation strategies appear to be consistent, as expected.
Not surprisingly, the standard CCP approach exhibits smaller standard deviations and RMSE
when compared to the ECCP OLS and IV estimators.
Table 2 also illustrates that there can be a difference between the number of markets and
time periods for the asymptotic properties of ECCP estimators in the scenario with macro shocks
(λz = .7). We have several columns with the same sample size M × T = 1600, and within these
columns, there is non-trivial bias in the OLS and IV estimates for short panels when the aggregate
shocks are present. However, the bias is reduced when the time dimension increases, and for long
panels, the ECCP estimators have little or no bias.35
Table 3 presents the results for the main specification, where the unobserved demand shock
ξmt is present. Because price wmt and the unobserved quality ξmt are correlated by construction
(since γ2 6= 0), we expect OLS to be biased. Indeed, the OLS estimator is now highly biased for
both the intercept θ0 and price coefficient θ1 .
The supply shifter zmt provides a valid instrument given that it correlates with prices wmt and
is independent of ξmt , and mean-independent of the expectational errors. When using the cost
shifter as an instrument for price, we see that the ECCP IV estimator has little-to-no bias, either
in the absence of aggregate shocks or when T is large (aggregate shocks still pose problems for
short panels, as expected).
The standard CCP estimator is now severely biased, for it treats the market state space as
including only the observable price wmt while the unobservable demand shock ξmt also plays a
role. The mis-specification is important regardless of the presence or absence of macro shocks. In
particular, the relative bias of the standard CCP estimator is larger than the bias of the ECCP
IV estimator in the presence of aggregated shocks in short panels.
Counterfactuals. While the ECCP approach avoids the need for a full model of how state
variables evolve, counterfactual analysis typically requires a full model to solve and simulate a
counterfactual dynamic problem. Thus, while the ECCP approach has an advantage in requiring
weaker modeling assumptions for estimation, stronger assumptions are still needed to compute
counterfactuals. Here we note that, when possible, it may be desirable to estimate model param35

In our simulations, aggregate shocks only affect the evolution of the observable variables (zmt directly, and wmt
indirectly). However, these aggregate shocks in the observables lead to aggregate shocks in the expectational error
terms. In turn, aggregate shocks in the expectational error terms implies that our regression equation’s residual
features aggregate shocks.

37

eters with as few assumptions (and potential sources of bias) as possible, and impose additional
assumptions needed for counterfactuals simulations only after estimating those parameters.
In the context of dynamic demand, the computation of a long-run elasticity represents a counterfactual of interest. Computing long-run elasticities requires an explicit model of how prices
and demand shocks jointly evolve, even when ECCP estimation does not. We find that using the
ECCP approach for estimation and then imposing restrictive assumptions on unobservable shocks
only for counterfactuals outperforms an approach that imposes the same restrictive assumptions
in both estimation and counterfactual simulation.36 Online Appendix ?? presents these results in
detail.

7

Empirical Application

We now illustrate the ECCP approach in the context of an empirical labor supply model for taxi
drivers in New York City (NYC) in 2013.37
As in many studies of labor supply, our goal is to estimate how labor supply responds to
wages. The taxi driver data allows us to see how labor supply decisions respond to wages at
the hourly level, but one might worry that the variation in taxi driver wages might be correlated
with unobserved factors that shift taxi drivers’ labor supply. Indeed, such correlations should be
expected from the simultaneous determination of labor supply and wages. Fortunately, the ECCP
framework allows us to easily incorporate instrumental variables in the estimation of a dynamic
model of taxi driver labor supply.
Institutional Background. Operating a taxicab in NYC requires a medallion and a NYC Taxi
and Limousine Commission (TLC) driver’s license. Most drivers rent medallions from the owners
or intermediaries and must return the car by the end of the shift (the daily lease rate in 2013 was
between $115 and $139). The cap for the total number of medallions was set at 13,437 in 2013.
A common feature in NYC is the ‘2-shift rule’: almost all rental agreements between drivers and
taxi fleets start or end at 5 AM or 5 PM; the day shift starts at 5 AM and ends at 5 PM, while
the night shift starts at 5 PM and ends at 5 AM. Fares are regulated by TLC and did not change
during the sample period. For more details, see Schmidt (2019).
Data. The transaction-level data is based on the Taxicab Passenger Enhancement Project
(TPEP), organized by TLC. The data contain information about every yellow cab trip, including
drivers’ identifier; information regarding the length, distance, and duration of the trip; the fare,
surcharges, tolls, and tips paid by costumers; as well as the geo-spatial start and endpoint of the
36

Specifically, we set the unobserved demand shock at its long-run mean when calculating the long-run demand
elasticity. The unobserved demand shock has zero mean with no loss of generality, given that a non-zero mean term
is absorbed by the constant term in the regression.
37
We are grateful to Øystein Daljord and Walter Zhang, who generously shared the data with us.

38

trip. We focus on data from January 1st to December 31st of 2013. We use a sample of 10,500
licensed drivers that have been active in that year. The transaction-level data is aggregated to
the driver-hour level (indexed by i and t, respectively), so that the unit of time t is an hour of
the day. Expected market hourly earnings wmt is defined as the total earnings (including fare and
tips) averaged across drivers in that hour t of that day m. We restrict our sample to consider only
drivers who were working during the day shifts, and that worked for at least one hour and at most
12 hours. Following the literature, we also restrict the sample to the weekdays Monday–Thursday
because supply patterns across these days are very similar (Buchholz, 2019; Fréchette, Lizzeri, and
Review, 2019). The final data set used for estimation is an unbalanced panel with N = 3, 937
drivers observed in M = 209 days during the T = 12 hours between 5 AM and 5PM.38 The taxi
data was merged to data on hourly weather conditions from Open Weather Map data and the National Weather Service (NWS) of the National Oceanic and Atmospheric Administration (NOA).
These data contain information on temperature, atmospheric pressure and humidity, rainfall, and
wind speed, among other weather conditions.
Table 4 shows the summary statistics by hour of the day, averaged across drivers and days.
The table indicates that the share of drivers who decide to continue working in the morning hours
is high (above 95%). The share of working drivers then declines slowly in the afternoon, and drops
substantially to 51% by 4 PM because they start to return to the garages before the end of shift
by 5 PM. Average hourly earnings is $32, with higher returns between 6 AM and 9 AM, when
demand is higher. The average number of hours working is approximately 7.5 hours per day.
Model and Estimation. We consider the model presented in Example 4, extended to incorporate three additional types of observed market-level states: (i) dummy variables for important
holidays (namely, Memorial Day, the Fourth of July, United Nations week, and New Year’s Eve),
(ii) dummy variables for weather conditions, as they may affect the disutility of driving,39 and
(iii) the hour of the day t, which may reflect the fact that driving during some hours may be less
pleasant (e.g., during lunch time or rush hours). We assume all these variables enter the flow
payoffs additively. The discount factor is set at β = 0.999999 (implying an annual interest rate of
approximately 0.87%).
To obtain the CCPs in the first stage, we estimate flexible logit regressions separately for each
hour of the day. These regressions include a fourth-order polynomial on k and dummies for the
day of the month, the month in the year, the holidays, and the weather conditions – in doing
so, we effectively smooth the CCPs across markets m to improve accuracy given the sample size.
38

Because the transaction-level data does not provide direct information of the contractual shifts, we follow the
previous studies and define any time period of more than 6 hours between trips as time ‘off work,’ separating the
time shifts. We consider day shifts starting any time between 5 AM and 2 PM, and ending at any hour between 8
AM and 5 PM. To simplify, we ignore breaks during the shift and we do not model the spatial distribution of all
trips – allowing for such extensions are possible, but beyond the scope of our paper.
39
The weather dummies include the following classifications: Clear, Clouds, Drizzle, Fog, Haze, Mist, Rain,
Snow, and Thunderstorm.

39

The estimated results are not very sensitive to the parametric specification.40 In the second stage,
we estimate equation (24) as explained in Example 4, and augmented to include the additional
variables mentioned above.
Results. Table 5 presents the results. In the first column, we show the OLS estimates; in the second column, the 2SLS estimates using the within-day lagged earnings (wmt−1 ) as the instrumental
variable for hourly earnings (wmt ); and in the third column, the 2SLS estimates using the earnings
in the same hour of the day but in the previous day (wm−1,t ) as the instrument – a “Hausman-IV’.
For ease of exposition, we omit from the table the coefficients on all state variables other than w
and k.
The estimated coefficients on hourly earnings (θ1 ) are positive in all specifications, as expected,
and the value of the OLS estimate is substantially smaller than the 2SLS estimates. This is
consistent with the standard bias of OLS in demand and supply models: labor supply parameters
are underestimated when simultaneity problems are ignored. Instrumenting for wmt increases the
supply response to earnings. The 2SLS estimate for θ1 when using the within-day lagged earnings
as the instrument is almost twice as large as the OLS estimate; and the 2SLS estimate based
on the previous day earnings as the instrument is approximately six times larger than the OLS
estimate (and it is statistically significant at the 5% level). Both instruments are strong, with the
first-stage F-statistics well above usual critical values for weak-IV tests (Montiel Olea and Pflueger,
2013; Andrews, Stock, and Sun, 2019). Still, one might worry that the unobservables ξmt might
be highly persistent within the day, casting doubts on whether the within-day lagged earnings
is a valid IV. (The fact that the first-stage F-statistic is extremely large for that instrument is
consistent with that suspicion.) In that sense, our second IV (the previous day earnings) seems to
be more plausibly exogenous.41
The estimated coefficients on the individual states k (θ2 ) – corresponding to the fatigue cost of
driving – are all negative as expected, and stable across specifications. Yet, the implied monetary
values for the fatigue costs (i.e., the estimated ratio θ2 /θ1 ) differ substantially: the implied value for
the OLS estimates is approximately $81 per hour of driving, which is much higher than the average
hourly earnings: $32/hour. The implied fatigue cost based on the within-day lagged IV estimates
is smaller than the corresponding OLS costs but still greater than the average earnings: $43/hour.
Finally, the previous day IV results in estimates that are more plausible, around $13/hour.

40

We have also estimated flexible logits with polynomials of the 2nd up to the 6th order on k, and interaction
terms between k and the day of the month dummies, as well as between k and the month of the year dummies,
with qualitatively similar (but more noisy) results. The second stage estimates are not sensitive to changes in the
definition of the shifts, to the inclusion of all days of the week, nor to the value of the discount factor β.
41
We have also used the earnings in the same hour of the day and the same day of the week but in the previous
week (wm−7,t ) as the instrumental variable. This instrument is strong (F = 43.4) and delivers a similar point
estimate as the “previous day” IV (θ̂1 = 0.0198), but the coefficient is less precisely estimated.

40

8

Conclusion

In this paper we provide a comprehensive econometric treatment of a new class of linear instrumental variables estimators for structural dynamic discrete choice models: the ECCP estimators.
This class of estimators shares many of the advantages of the continuous-choice Euler equation
approach originally developed by Hall (1978), Hansen and Sargent (1980, 1982), and Hansen and
Singleton (1982).
We provide constructive identification results that lead naturally to estimators, we establish
the consistency and asymptotic normality of the estimators, we provide evidence that they perform
well in finite-samples based on a Monte Carlo study of a dynamic demand for durable goods, and
we illustrate the method empirically in the context of dynamic labor supply of taxi drivers in NYC.

References
Abbring, J. H., and O. Daljord (2019): “Identifying the Discount Factor in Dynamic Discrete
Choice Models,” Quantitative Economics, forthcoming.
Aguirregabiria, V. (2010): “Another look at the identification of dynamic discrete decision
processes: An application to retirement behavior,” Journal of Business & Economic Statistics,
28(2), 201–218.
Aguirregabiria, V., J. Gu, and Y. Luo (2019): “Sufficient Statistics for Unobserved Heterogeneity in Structural Dynamic Logit Models,” Journal of Econometrics, forthcoming.
Aguirregabiria, V., and A. Magesan (2013): “Euler equations for the estimation of dynamic
discrete choice structural models,” in Structural Econometric Models, pp. 3–44. Emerald Group
Publishing Limited.
Aguirregabiria, V., and P. Mira (2002): “Swapping the Nested Fixed Point Algorithm: A
Class of Estimators for Discrete Markov Decision Models,” Econometrica, 70(4), 1519–1543.
Altug, S., and R. A. Miller (1998): “The Effect of Work Experience on Female Wages and
Labour Supply,” The Review of Economic Studies, 65(1), 45–85.
Andrews, D. W. (2005): “Cross-Section Regression with Common Shocks,” Econometrica,
73(5), 1551–1585.
Andrews, I., J. Stock, and L. Sun (2019): “Weak Instruments in IV Regression: Theory and
Practice,” Annual Review of Economics, 11, 727–753.
Aradillas-Lopez, A. (2015): “Semiparametric Efficiency in Models with Rational Expectations,” Discussion paper, Pennsylvania State University.
41

Arcidiacono, P., E. Aucejo, A. Maurel, and T. Ransom (2016): “College Attrition and
the Dynamics of Information Revelation,” Discussion Paper 22325, NBER.
Arcidiacono, P., and P. B. Ellickson (2011): “Practical Methods for Estimation of Dynamic
Discrete Choice Models,” Annual Review of Economics, 3(1), 363–394.
Arcidiacono, P., and R. A. Miller (2011): “Conditional Choice Probability Estimation of
Dynamic Discrete Choice Models With Unobserved Heterogeneity,” Econometrica, 79(6), 1823–
1867.
(2019a): “Identifying Dynamic Discrete Choice Models off Short Panels,” Journal of
Econometrics, forthcoming.
(2019b): “Nonstationary Dynamic Models with Finite Dependence,” Quantitative Economics, 10, 853–890.
Bajari, P., C. L. Benkard, and J. Levin (2007): “Estimating Dynamic Models of Imperfect
Competition,” Econometrica, 75(5), 1331–1370.
Bajari, P., C. S. Chu, D. Nekipelov, and M. Park (2016): “Identification and semiparametric estimation of a finite horizon dynamic discrete choice model with a terminating action,”
Quantitative Marketing and Economics, 14(4), 271–323.
Benkard, C. L. (2000): “Learning and Forgetting: The Dynamics of Aircraft Production,”
American Economic Review, 90(4), 1034–1054.
Berry, S., and G. Compiani (2019): “An Instrumental Variables Approach to Dynamic Models,” Discussion paper, Yale University.
Berry, S. T. (1994): “Estimating Discrete-Choice Models of Product Differentiation,” RAND
Journal of Economics, 25(2), 242–262.
Besanko, D., U. Doraszelski, Y. Kryukov, and M. Satterthwaite (2010): “Learningby-Doing, Organizational Forgetting, and Industry Dynamics,” Econometrica, 78(2), 453–508.
Bishop, K. C. (2012): “A dynamic model of location choice and hedonic valuation,” Discussion
paper, Arizona State University.
Blevins, J. R. (2014): “Nonparametric identification of dynamic decision processes with discrete
and continuous choices,” Quantitative Economics, 5(3), 531–554.
Blevins, J. R., A. Khwaja, and N. Yang (2018): “Firm Expansion, Size Spillovers, and
Market Dominance in Retail Chain Dynamics,” Management Science, 64(9), 4070–4093.

42

Buchholz, N. (2019): “Spatial Equilibrium, Search Frictions and Dynamic Efficiency in the Taxi
Industry,” Discussion paper, Princeton University.
Chernozhukov, V., J. Escanciano, H. Ichimura, W. Newey, and J. Robins (2018):
“Locally Robust Semiparametric Estimation,” Discussion paper, arXiv:1608.00033v2.
Chernozhukov, V., and C. Hansen (2005): “An IV Model of Quantile Treatment Effects,”
Econometrica, 73(1), 245–261.
Chesher, A., and A. M. Rosen (2017): “Generalized Instrumental Variable Models,” Econometrica, 85(3), 959–989.
Chiong, K. X., A. Galichon, and M. Shum (2016): “Duality in dynamic discrete-choice
models,” Quantitative Economics, 7(1), 83–115.
Chou, C., T. Derdenger, and V. Kumar (2019): “Linear Estimation of Aggregate Dynamic
Discrete Demand for Durable Goods without the Curse of Dimensionality,” Marketing Science,
38(5), 888–909.
Coate, P. (2016): “Parental influence on labor market outcomes and location decisions of young
workers,” Discussion paper, American Institute for Economic Research.
Conley, T. G. (1999): “GMM estimation with cross sectional dependence,” Journal of Econometrics, 92(1), 1–45.
De Groote, O., and F. Verboven (2019): “Subsidies and Time Discounting in New Technology Adoption: Evidence from Solar Photovoltaic Systems,” American Economic Review, 109(6),
2137–72.
Dearing, A. (2019): “Pseudo-Value Functions and Closed-Form CCP Estimation of Dynamic
Discrete Choice Models,” Discussion paper, Ohio State University.
Diamond, R., T. McQuade, and F. Qian (2018): “The effects of rent control expansion on
tenants, landlords, and inequality: Evidence from san francisco,” Discussion paper, Stanford
University.
Dickstein, M. J., and E. Morales (2018): “What Do Exporters Know?,” The Quarterly
Journal of Economics, 133(4), 1753–1801.
Escanciano, J. C., S. Hoderlein, A. Lewbel, O. Linton, and S. Srisuma (2018): “Nonparametric Euler Equation Identification and Estimation,” Discussion paper, Boston College.
Fréchette, G. R., A. Lizzeri, and T. S. A. E. Review (2019): “Frictions in a Competitive,
Regulated Market: Evidence from Taxis,” American Eonomic Review, forthcoming.
43

Gendron-Carrier, N. (2018): “Understanding the Careers of Young Entrepreneurs,” Discussion
paper, McGill University.
Gowrisankaran, G., and M. Rysman (2012): “Dynamics of consumer demand for new durable
goods,” Journal of Political Economy, 120(6), 1173–1219.
Hahn, J., G. Kuersteiner, and M. Mazzocco (2019): “Estimation with Aggregate Shocks,”
The Review of Economic Studies, forthcoming.
Hall, P., and C. C. Heyde (1980): Martingale limit theory and its application. Academic press.
Hall, R. E. (1978): “Stochastic Implications of the Life Cycle-Permanent Income Hypothesis:
Theory and Evidence,” Journal of Political Economy, 86(6), 971–87.
Hansen, L. P., and T. J. Sargent (1980): “Formulating and estimating dynamic linear rational
expectations models,” Journal of Economic Dynamics and Control, 2, 7–46.
(1982): “Instrumental variables procedures for estimating linear rational expectations
models,” Journal of Monetary Economics, 9(3), 263–296.
Hansen, L. P., and K. J. Singleton (1982): “Generalized instrumental variables estimation
of nonlinear rational expectations models,” Econometrica: Journal of the Econometric Society,
pp. 1269–1286.
Hausman, J. A. (1996): Valuation of new goods under perfect and imperfect competitionchap. 5,
pp. 209–248. University of Chicago Press.
Hendel, I., and A. Nevo (2006): “Measuring the Implications of Sales and Consumer Inventory
Behavior,” Econometrica, 74(6), 1637–1673.
Hotz, V. J., and R. A. Miller (1993): “Conditional Choice Probabilities and the Estimation
of Dynamic Models,” Review of Economic Studies, 60(3), 497–529.
Hotz, V. J., R. A. Miller, S. Sanders, and J. Smith (1994): “A Simulation Estimator for
Dynamic Models of Discrete Choice,” Review of Economic Studies, 61(2), 265–89.
Hu, Y., and M. Shum (2012): “Nonparametric identification of dynamic models with unobserved
state variables,” Journal of Econometrics, 171(1), 32–44.
Humphries, J. E. (2018): “The Causes and Consequences of Self-Employment over the Life
Cycle,” Discussion paper, Yale University.
Kalouptsidi, M. (2018): “Detection and Impact of Industrial Subsidies: The Case of Chinese
Shipbuilding,” Review of Economic Studies, 85(2), 1111–1158.
44

Kalouptsidi, M., P. T. Scott, and E. A. Souza-Rodrigues (2019): “Identification of
Counterfactuals in Dynamic Discrete Choice Models,” Quantitative Economics, forthcoming.
Kasahara, H., and K. Shimotsu (2009): “Nonparametric Identification of Finite Mixture
Models of Dynamic Discrete Choices,” Econometrica, 77(1), pp. 135–175.
Khorunzhina, N. (2013): “Structural estimation of stock market participation costs,” Journal
of Economic Dynamics and Control, 37(12), 2928–2942.
Khorunzhina, N., and R. A. Miller (2019): “American dream delayed: shifting determinants
of home ownership,” Discussion paper, Copenhagen Business School.
Kuersteiner, G. M., and I. R. Prucha (2013): “Limit theory for panel data models with cross
sectional dependence and sequential exogeneity,” Journal of Econometrics, 174(2), 107–126.
Ma, L. (2019): “Learning in a hedonic framework: Valuing Brownfield remediation,” International
Economic Review, 60(3), 1355–1387.
Magnac, T., and D. Thesmar (2002): “Identifying Dynamic Discrete Decision Processes,”
Econometrica, 70(2), 801–816.
Matsumoto, B. (2016): “Lighting the fires: Explaining youth smoking initiation and experimentation in the context of a rational addiction model with learning,” Discussion paper, U.S.
Bureau of Labor Statistics.
Matzkin, R. L. (2003): “Nonparametric Estimation of Nonadditive Random Functions,” Econometrica, 71(5), 1339–1375.
Melnikov, O. (2013): “Demand for differentiated durable products: The case of the us computer
printer market,” Economic Inquiry, 51(2), 1277–1298.
Montiel Olea, J., and C. Pflueger (2013): “A robust test for weak instruments,” Journal
of Business and Economic Statistics, 31, 358–369.
Morales, E., G. Sheu, and A. Zahler (2019): “Extended gravity,” The Review of Economic
Studies, 86(6), 2668–2712.
Nevo, A. (2000): “Mergers with differentiated products: The case of the ready-to-eat cereal
industry,” RAND Journal of Economics, 31, 395–421.
Newey, W. K., and J. L. Powell (2003): “Instrumental variable estimation of nonparametric
models,” Econometrica, 71(5), 1565–1578.
Norets, A., and X. Tang (2014): “Semiparametric Inference in dynamic binary choice models,”
The Review of Economic Studies, 81(3), 1229–1262.
45

Pakes, A. (2010): “Alternative models for moment inequalities,” Econometrica, 78(6), 1783–1822.
Pesendorfer, M., and P. Schmidt-Dengler (2008): “Asymptotic Least Squares Estimators
for Dynamic Games,” The Review of Economic Studies, 75(3), 901–928.
Ransom, T. (2019): “Labor Market Frictions and Moving Costs of the Employed and Unemployed,” Discussion Paper 12139, IZA Institute of Labor Economics.
Rust, J. (1987): “Optimal Replacement of GMC Bus Engines: an Empirical Model of Harold
Zurcher,” Econometrica, 55(5), 999–1033.
(1994): “Structural estimation of Markov decision processes,” Handbook of Econometrics,
4(4), 3081–3143.
Rust, J., and C. Phelan (1997): “How social security and medicare affect retirement behavior
in a world of incomplete markets,” Econometrica, 65(4), 781–831.
Ryan, S. P. (2012): “The Costs of Environmental Regulation in a Concentrated Industry,”
Econometrica, 80(3), 1019–1061.
Schmidt, M.-A. (2019): “Valuing Flexibility: A Model of Discretionary Rest Breaks,” Discussion
paper, University of Toronto.
Scott, P. T. (2013): “Dynamic Discrete Choice Estimation of Agricultural Land Use,” Discussion paper, New York University.
Traiberman, S. (2019): “Occupations and Import Competition: Evidence from Denmark,”
American Economic Review, (109), 4260–4301.
Wright, B. (2014): “Global biofuels: key to the puzzle of grain market behavior,” Journal of
Economic Perspectives, 28(1), 73–98.

46

Table 1: Parameters of the Monte Carlo Data Generating Process
Payoff Parameters:

θ0
θ1

1
−.1

Prob. of Product Failure:

φ

.1

Discount Factor:

β

.95

Process for price wmt :

γ0
γ1
γ2
σw2

40
1
1
4

47

ξ ∼ Normal AR(1)

ρ1
ρ2
σξ2

0
.2
0 or 16

z ∼ Normal AR(1)

ρ3
ρ4
σz2

0
.7
25

Aggregate Shocks

λz

0 or .7

Table 2: Monte Carlo Experiments without Unobserved Demand Shock
σξ2 = 0
True Parameters: θ0 = 1, θ1 = −.1
λz = 0
Estimator

ECCP:
OLS

ECCP:
IV (2SLS)

Standard
CCP

T
M

λz = .7

40
40

160
10

10
160

40
40

160
10

10
160

160
160

1.01
0.64%
0.04
0.04

1.01
0.74%
0.04
0.04

1.01
0.81%
0.04
0.04

0.92
-8.05%
0.17
0.19

0.99
-1.49%
0.09
0.10

0.75
-24.6%
0.29
0.38

0.99
-1.38%
0.09
0.09

θ0

Mean Est.
Rel. Bias
SD
RMSE

θ1

Mean Est.
-0.10
-0.10
-0.10
-0.10
-0.10
-0.09
-0.10
Rel. Bias
0.16% 0.18% 0.20% -1.98% -0.38% -6.20% -0.33%
SD
1.01e-3 1.04e-3 9.97e-4 4.05e-3 2.22e-3 6.78e-3 2.05e-3
RMSE
1.02e-3 1.06e-3 1.02e-3 4.50e-3 2.26e-3 9.19e-3 2.07e-3

θ0

Mean Est.
Rel. Bias
SD
RMSE

θ1

Mean Est.
-0.10
-0.10
-0.10
-0.10
-0.10
-0.09
-0.10
Rel. Bias
0.18% 0.19% 0.22% -2.22% -0.42% -7.08% -0.38%
SD
1.06e-3 1.08e-3 1.03e-3 4.46e-3 2.40e-3 7.67e-3 2.23e-3
RMSE
1.07e-3 1.10e-3 1.06e-3 4.98e-3 2.44e-3
0.01 2.26e-3

θ0

Mean Est.
1.00
1.00
Rel. Bias
-0.29% -0.27%
SD
9.22e-3 8.45e-3
RMSE
9.66e-3 8.87e-3

θ1

Mean Est.
-0.10
-0.10
-0.10
-0.10
-0.10
-0.10
-0.10
Rel. Bias
-0.48% -0.51% -0.30% -0.70% -0.60% -0.64% -0.25%
SD
4.40e-4 3.88e-4 6.41e-4 7.96e-4 5.27e-4 1.33e-3 5.18e-4
RMSE
6.48e-4 6.42e-4 7.08e-4 1.06e-3 7.95e-4 1.48e-3 5.73e-4

1.01
0.70%
0.04
0.04

1.01
0.79%
0.04
0.05

1.01
0.87%
0.04
0.04

1.00
-0.11%
0.01
0.01

0.91
-9.0%
0.19
0.21

1.00
-0.49%
0.04
0.04

0.98
-1.66%
0.10
0.10

1.00
-0.31%
0.02
0.02

0.72
-28.2%
0.33
0.43

1.00
-0.02%
0.07
0.07

Notes: 5000 Monte Carlo replications for each sample structure. SD is the
standard deviation of the estimators across replications. RMSE is root-mean
squared error. Relative Bias is bias as percentage of the true parameter.

48

0.98
-1.57%
0.09
0.10

1.00
-0.19%
0.02
0.02

Table 3: Monte Carlo Experiments with Unobserved Demand Shock
σξ2 = 16
True Parameters: θ0 = 1, θ1 = −.1
λz = 0
Estimator

ECCP:
OLS

ECCP:
IV (2SLS)

Standard
CCP

T
M

λz = .7

40
40

160
10

10
160

40
40

160
10

10
160

160
160

θ0

Mean Est.
Rel. Bias
SD
RMSE

-8.62
-962%
0.59
9.64

-8.63
-963%
0.58
9.64

-8.61
-9.54
-961% -1050%
0.57
1.79
9.62
10.70

-8.81
-11.60
-981% -1260%
1.03
2.77
9.86
12.90

-8.85
-985%
0.89
9.89

θ1

Mean Est.
Rel. Bias
SD
RMSE

0.14
-240%
0.01
0.24

0.14
-241%
0.01
0.24

0.14
-240%
0.01
0.24

0.16
-264%
0.04
0.27

0.15
-245%
0.02
0.25

0.22
-315%
0.06
0.32

0.15
-246%
0.02
0.25

θ0

Mean Est.
Rel. Bias
SD
RMSE

1.02
1.62%
0.77
0.77

1.00
-0.20%
0.77
0.77

1.02
1.82%
0.75
0.75

0.97
-3.49%
0.83
0.83

1.02
1.97%
0.78
0.78

0.87
-12.8%
0.90
0.91

0.99
-0.76%
0.20
0.20

θ1

Mean Est.
Rel. Bias
SD
RMSE

-0.10
0.50%
0.02
0.02

-0.10
-0.05%
0.02
0.02

-0.10
0.42%
0.02
0.02

-0.10
-1.00%
0.02
0.02

-0.10
0.44%
0.02
0.02

-0.10
-0.10
-3.25% -0.19%
0.02 4.96e-3
0.02 4.96e-3

θ0

Mean Est.
Rel. Bias
SD
RMSE

0.26
-74.4%
0.03
0.75

0.26
-74.4%
0.03
0.75

0.25
-74.7%
0.03
0.75

0.26
-74.3%
0.04
0.74

0.26
-74.3%
0.03
0.74

θ1

Mean Est.
Rel. Bias
SD
RMSE

-0.01
-88.1%
5.38e-3
0.09

-0.01
-0.01
-87.8% -89.2%
5.12e-3 5.74e-3
0.09
0.09

-0.01
-0.01
-88.4% -87.8%
6.33e-3 5.41e-3
0.09
0.09

0.26
-73.5%
0.05
0.74

-0.01 2.12e-3
-89.9% -102%
9.24e-3 3.66e-3
0.09
0.10

Notes: 5000 Monte Carlo replications for each sample structure. SD is the
standard deviation of the estimators across replications. RMSE is root-mean
squared error. Relative Bias is bias as percentage of the true parameter.

49

0.17
-83.3%
0.02
0.83

Hour of the Day

6:00 AM
7:00 AM
8:00 AM
9:00 AM
10:00 AM
11:00 AM
12:00 PM
1:00 PM
2:00 PM
3:00 PM
4:00 PM
5:00 PM

Table 4: Summary Statistics
Share of Drivers that Hourly Earnings ($)
Continue Working (%) Mean
Std Dev
100
100
98.12
97.60
96.45
95.04
94.88
94.28
91.49
79.39
51.37
0

Number of Drivers
Number of Days

32.68
35.14
37.20
34.70
29.97
29.21
30.96
30.80
33.83
34.98
24.84
-

3.14
3.01
3.10
2.44
2.19
2.27
2.23
2.24
2.21
1.98
2.09
-

3937
209

Notes: The unit of observation is a taxi driver working in a given hour
of a week day (Monday–Thursday) in 2013. The sample is restricted to
day shifts and drivers working for at least one hour and at most twelve
hours. The numbers in the cells are sample averages (and standard
deviations) across drivers and days for each hour of the day.
Source: authors’ calculations.

50

Table 5: Parameter Estimates
(1)
(2)
OLS
IV – Within Day Lagged

(3)
IV – Previous Day

Hourly Earnings (θ1 )

0.00358
(0.00201)

0.00672
(0.00346)

0.0223
(0.00621)

Hours Driving (θ2 )

-0.291
(0.00462)

-0.291
(0.00461)

-0.291
(0.00462)

F-statistic
Number of Days
Number of Hours
Observations

209
12
2508

3066
209
11
2299

105.4
208
12
2496

Notes: The unit of observation is an hour (t) of a day (m) in 2013. The dependent variable is the
log odds ratio of the conditional choice probabilities of continue working versus stopping at t plus
the discounted choice probability of stop working at t + 1. The first column presents the OLS
estimates. The second column, the 2SLS estimates using the within-day lagged earnings (wmt−1 )
as an instrument for hourly earnings (wmt ). And the third column, the 2SLS estimates using
the earnings in the same hour of the day but in the previous day (wm−1,t ) as the instrument.
All specifications include dummy variables for (i) important holidays, (ii) hourly weather
conditions, and (iii) the hour of the day, as explained in the main text (omitted from the table).
Robust Standard errors in parentheses are clustered at the ‘market’ level m (correponding to
a day in 2013).

51

Supplement to “Linear IV Regression Estimators
for Structural Dynamic Discrete Choice Models
Myrto Kalouptsidi∗, Paul T. Scott†, Eduardo Souza-Rodrigues‡
Harvard University, CEPR and NBER; NYU Stern; University of Toronto

February 2020

This supplemental material consists of the following sections: Section A presents general derivations of Euler equations for both deterministic and stochastic finite dependence. It also extends
Proposition 2 to allow for stochastic sequences of choices (see Proposition A1). Sections B and C
present all proofs of the lemmas and propositions presented in the main paper; Section B focuses
on the identification results, while Section C shows the proofs of the asymptotic properties of
the ECCP estimator. Section D explains the standard CCP approach implemented in the Monte
Carlo experiment to estimate the model parameters. Finally, Section E extends the Monte Carlo
study presented in Section 6 of the main paper by investigating how the biases in the parameter
estimates pass through to biases in the countefactuals calculations.

A

General ECCP Equation Derivation

In this section, we offer a general derivation of Euler equations in conditional choice probabilities
relying first on deterministic finite dependence as defined in Section 3, and then exploring stochastic
sequences of choices. We also present Proposition A1, which extends the identification result in
Proposition 2 (presented in the main text) to allow for stochastic finite dependence. Recall that
finite dependence is not a behavioral assumption (whether based on deterministic or stochastic
sequences); it is rather a property that the state transition process may or may not satisfy in the
data.

∗

Harvard University, Department of Economics, Littauer Center 124, Cambridge, MA 02138. email:
myrto@fas.harvard.edu
†
Stern School of Business, New York University, Kaufman Management Center, 44 W. 4th St., New York, NY
10012. email: pscott@stern.nyu.edu.
‡
Department of Economics, University of Toronto, Max Gluskin House, 150 St. George St., Toronto, Ontario
M5S 3G7, Canada. email: e.souzarodrigues@utoronto.ca

1

A.1

ECCP Equation Under Deterministic Finite Dependence

Arcidiacono and Miller (2011) show that the conditional value functions, va , can be represented
by functions of flow payoffs and conditional choice probabilities for any sequence of future choices,
optimal or not. To derive such a representation, begin with an arbitrary initial state ωmt . Consider
a sequence of actions from t to t + τ (where τ ≥ 1). Suppose the initial choice at time period t is
a, and let j denote another element of the choice set A. Let ad ∈ A denote the d−th choice in the
sequence following a, and define jd ∈ A similarly.
Recall equation (11), which is a vector across rows of the individual state k and absorbs the
aggregate state ωmt into mt subscripts:
k
πamt + βeVam,t,t+1 = Vmt − βFamt
Vmt+1 − ψamt .

We then substitute for Vmt+1 using equation (11) again, using a1 as the action instead of a:
k
πamt + βeVam,t,t+1 = Vmt − ψamt − βFamt
πa1 mt+1 + βeVa1 ,m,t+1,t+2 + ψa1 mt+1



k
−β 2 Famt
Fak1 mt+1 Vmt+2 .

Repeated substitution of Vmt+d above leads to:
πamt + βeVam,t,t+1 = Vmt − ψamt
" τ
#
X

k
−Famt
β d Λamtd πad mt+d + βeVad ,m,t+d,t+d+1 + ψad mt+d
d=1
k
−β τ +1 Famt
Λamt,τ +1 Vmt+τ +1

(A1)

where the matrices Λamtd are defined recursively:
Λamtd =
I,
for d = 1,
Λamtd = Λamt,d−1 Fakd−1 mt+d−1 , for d ≥ 2,
Next, finite dependence allows us to eliminate the Vmt+τ +1 , resulting in an ECCP equation
that forms the basis of our identification arguments. Recall Definition 2 in Section 3: Given τ period finite dependence, for a pair of actions (a, j), we can construct sequences (a, a1 , . . . , aτ ) and
(j, j1 , . . . , jτ ) such that1
k
k
Famt
Fak1 mt+1 . . . Fakτ mt+τ = Fjmt
Fjk1 mt+1 . . . Fjkτ mt+τ ,

i.e.,
k
k
Famt
Λamt,τ +1 = Fjmt
Λjmt,τ +1 .
1

Recall that the terms in the sequences depend on the particular initial pair of actions (a, j) chosen.

2

(A2)

We then difference equation (A1) across the two sequences of actions. Because of (A2), the
last term cancels, and the result is equation (27).

A.2

ECCP Equation Under Stochastic Finite Dependence

Consider now a known mixing sequence of actions from t to t + τ (where τ ≥ 1). Suppose the
a
initial choice at t is action a. For the next period, t + 1, let αt+1
(kimt+1 , ωmt+1 ) be a vector on RA+1
P
a
a
with elements αlt+1
(kimt+1 , ωmt+1 ), l ∈ A, such that A
l=0 αlt+1 (kimt+1 , ωmt+1 ) = 1. Each element
a
a
can be interpreted as the weight given to action l ∈ A in
(kimt+1 , ωmt+1 ) of the vector αt+1
αlt+1
period t + 1 at state (kimt , ωmt ) after the initial choice a at t. For deterministic sequences, one
a
element of the vector αt+1
equals one and the others equal zero. For probabilistic sequences, all
a
elements of αt+1 are positive an add up to one. More generally, the mixing may involve negative
weights, provided that they sum up to one (Arcidiacono and Miller, 2019). For the other time
a
periods, d = 2, ..., τ , take the sequence of weight choices in a similar way, αt+d
(kimt+d , ωmt+d ). In
this section, we abuse terminology and use the terms “mixing” and “stochastic” interchangeably.
It is useful to represent the weight choices in matrix notation. Define the diagonal matrix
a
a
αlmt
= diag {αlta (k, ωmt ) ; k ∈ K}, for l ∈ A and any time period t. In words, αlmt
is a K × K
a
matrix that collects the individual terms αlt (kimt , ωmt ) for all possible values of k. Note that
αlta (kimt , ωmt ) is one element of the vector αta (kimt , ωmt ), as defined in the previous paragraph.
PA a
P
a
Clearly, because the mixing requires A
l=0 αlmt = IK , where
l=0 αlt (kimt , ωmt ) = 1, we have that
IK is the K × K identity matrix.
a
Now, recall equation (11). For any initial choice a, take a mixing αt+1
(kimt+1 , ωmt+1 ) over
choices in A at t + 1, and replace Vmt+1 in (11) to get
"
k
πamt + βeVam,t,t+1 = Vmt − ψamt − βFamt

A
X

#
a
αlmt+1
πlmt+1 + βeVlm,t+1,t+2 + ψlmt+1



l=0
k
−β 2 Famt

" A
X

#
a
k
Vmt+2 .
αlmt+1
Flmt+1

l=0

Next, we follow the steps outlined in Section A.1 of this Appendix. Repeated substitution of
Vmt+d above leads to:
πamt + βeVam,t,t+1 = Vmt − ψamt
" τ
#
A
X
X

k
a
−βFamt
β d−1 Λam,t,d
αlmt+d
πlmt+d + βeVlm,t+d,t+d+1 + ψlmt+d
−β

τ +1

d=1
l=0
k
Famt Λam,t,τ +1 Vmt+τ +1 ,

3

(A3)

where the observed (estimable) matrices Λam,t,d are defined recursively:
Λam,t,d =

I,

Λam,t,d = Λam,t,d−1

hP
A

a
k
l=0 αlmt+d−1 Flmt+d−1

for d = 1
i

, for d ≥ 2.

(A4)

As before, we make use of finite dependence to eliminate the Vmt+τ +1 . First, we extend Definition 2 in Section 3 to stochastic sequences of choices:
Definition 1. (Stochastic Finite Dependence) A pair of choices a and j satisfies stochastic τ -period
finite dependence if there exists two sequences of mixings starting at a and j such that, for all t,
k
k
Famt
Λam,t,τ +1 = Fjmt
Λjm,t,τ +1 ,

(A5)

where Λam,t,τ +1 is defined in (A4).
Under this condition, Vmt+τ +1 is eliminated when we difference the equation above across two
mixing sequences of actions, starting respectively at a and j. Recalling that π = π + ξ, we then
obtain the ECCP regression equation:
ψjmt − ψamt + β

A
τ X
X

 k

j
k
a
β d−1 Fjmt
Λjm,t,d αlmt+d
− Famt
Λam,t,d αlmt+d
ψlmt+d

d=1 l=0
A
τ X
X

= π amt − π jmt + β

 k

j
a
k
β d−1 Famt
Λam,t,d αlmt+d
− Fjmt
Λjm,t,d αlmt+d
π lmt+d

d=1 l=0

+ uajmt ,

(A6)

where the econometric error term is uajmt = e
ξ ajmt + eeVajmt , with
e
ξ ajmt = ξamt − ξjmt + β

τ X
A
X

 k

j
a
k
β d−1 Famt
Λam,t,d αlmt+d
− Fjmt
Λjm,t,d αlmt+d
ξlmt+d ,

d=1 l=0

and
eeVajmt

=β

eVam,t,t+1

−

eVjm,t,t+1



+β

τ X
A
X

 k
 V
j
a
k
β d Famt
Λam,t,d αlmt+d
− Fjmt
Λjm,t,d αlmt+d
elm,t+d,t+d+1 .

d=1 l=0

We can now extend Proposition 2 to identify payoff parameters under the assumption of general
stochastic finite dependence.
Proposition A1. Suppose Assumptions 1 and 2 hold. Assume τ -period stochastic finite dependence holds for the agent-level transition process F k , with τ < T . Assume also a linear-inparameters flow payoff: π (a, k, w) = x (a, k, w) θ, where θ ∈ RP , and x (a, k, w) is a known (vector)
4

function. Let Xamt be a K × P matrix with elements given by x (a, k, wmt ), so that π amt = Xamt θ,
and define
eajmt ≡ Xamt − Xjmt + β
X

τ X
A
X


 k
j
a
k
Xlmt+d .
Λam,t,d αlmt+d
− Fjmt
Λjm,t,d αlmt+d
β d−1 Famt

(A7)

d=1 l=0

Denote the K × 1 vector on the left hand side of (A6) by Yajmt . Stack equation (A6) for all feasible
combinations of actions (a, j) ∈ A to obtain the following equation
emt θ + umt ,
Ymt = X

(A8)

emt , and umt stack the vectors Yajmt , X
eajmt and uajmt , respectively. Let Zmt be an
where Ymt , X
L × K matrix of instrumental variables with L ≥ P . The parameter θ is identified provided
emt ]) = P .
E [Zmt umt ] = 0 and rank(E[Zmt X
The proof of Proposition A1 is identical to the proof of Proposition 2 and is therefore omitted.
In fact, Proposition 2 is a special case of Proposition A1, when finite dependence is restricted to
satisfy deterministic sequences of actions.
Proposition A1 can be used to extend previous empirical applications exploring stochastic finite
dependence (e.g., Ransom, 2019) to incorporate serially correlated unobservable states, measurement error, and endogeneity problems. It can also serve as the basis for identification arguments
in future applications featuring all these attributes. Evidently, the same set of issues discussed
extensively in Section 4 involving deterministic finite dependence (regarding instrument validity,
limitations of and extensions to the ECCP approach) applies here as well.

B
B.1

Proofs: Identification
Proof of Proposition 1

Assume single-action τ -period dependence holds for action J. Then, equation (27) simplifies to
(ψjmt − ψamt ) +

k
Fjmt

−

k
Famt

τ
X

k
k
− Famt
= π amt − π jmt − Fjmt

β d ΛJmtd ψJmt+d

d=1
τ
X



β d ΛJmtd π Jmt+d + uajmt ,

d=1

where the matrix ΛJmtd is defined recursively
ΛJmtd =
I,
for d = 1
k
ΛJmtd = ΛJmt,d−1 FJmt+d−1 , for d ≥ 2,
5

(B1)

and the unobservable term is uajmt = e
ξ ajmt + eeVajmt , with
k
k
e
ξ ajmt = (ξamt − ξjmt ) − (Fjmt
− Famt
)

τ
X

β d ΛJmtd ξJmt+d ,

(B2)

d=1
τ

X
k
k
eeVajmt = β eVam,t,t+1 − eVjm,t,t+1 − Fjmt
− Famt
β d ΛJmtd eVJm,t+d,t+d+1 .

(B3)

d=1

For any known (and comformable) function h (zmt ), multiply both sides of (B1) and take the
expectation. We eliminate the error terms e
ξ ajmt and eeVajmt by Assumption 3.(ii)–(iii). Then,
"
k
k
E h (zmt ) (ψjmt − ψamt ) + Fjmt
− Famt

τ
X

!#
β d ΛJmtd ψJmt+d

d=1

"
k
k
− Famt
= E h (zmt ) π amt − π jmt − Fjmt

τ
X

!#
β d ΛJmtd π Jmt+d

,

(B4)

d=1

where the expectations are taken over (zmt , wmt , ..., wmt+τ ).
The LHS of (B4) can be recovered from the data (using the results of Lemma C1, in Appendix
C.4). Then, for any two primitives π and π 0 ,
"
k
k
E h (zmt ) π amt − π jmt − Fjmt
− Famt

τ
X

"
k
k
= E h (zmt ) π 0amt − π 0jmt − Fjmt
− Famt



d=1
τ
X

!#
β d ΛJmtd π Jmt+d
!#
β d ΛJmtd π 0Jmt+d

.

d=1

By the completeness condition (Assumption 3.(i)),
π amt − π jmt −

k
Fjmt

−

k
Famt

τ
X

β d ΛJmtd π Jmt+d

d=1

=

π 0amt

−

π 0jmt

−

k
Fjmt

−

k
Famt

τ
X

β d ΛJmtd π 0Jmt+d ,

(B5)

d=1

for almost all (wmt , . . . , wmt+τ ). Consider (B5) for j = J. Because π J (k, w) is known for all
observed states (k, w), we conclude that π amt = π 0amt almost surely.

B.2

Proof of Proposition 2

eajmt ]) = P
Equation (31) is a linear regression equation, and E [Zmt uajmt ] = 0 and rank(E[Zmt X
are the standard orthogonality and rank conditions, respectively, for parameter identification.

6

B.3

Proof of Lemma 1

We omit the subscripts i and m to simplify notation. Suppose Assumption 4 holds.

∗
,
(i) From the definition of eh a, k, ωt , ωt+1
"
#
X
 h



∗
∗
E e a, k, ωt , ωt+1
|It = E
eh k 0 , ωt , ωt+1
F k (k 0 |a, k, wt ) |It
k0

"
= E

X Z
ω0

k0

=

XZ



#
F k (k 0 |a, k, wt ) |It

h (k 0 , ω 0 ) dF ω (ω 0 |ωt ) F k (k 0 |a, k, wt )

ω0

k0

−

∗
h (k 0 , ω 0 ) dF ω (ω 0 |ωt ) − h k 0 , ωt+1



XZ
k0

∗
ωt+1


 ω ∗
∗
h k 0 , ωt+1
dF ωt+1 |ωt F k (k 0 |a, k, wt )

= 0.
(ii) By the law of iterated expectations,

 
 
  
∗
∗
E eh a, k, ωt , ωt+1
|zt = E E eh a, k, ωt , ωt+1
|It |zt = 0,
where the second equality follows from (i).
Note also that, given that the time-t information set It includes current and past variables,



∗
Lemma 1 also implies that E eh a, k, ωt , ωt+1
|zt−d , for all a, k and any d ≥ 1. In particular,
 

∗
|zt .
E eh a, k, ωt+d , ωt+d+1

∗
(iii) Next, fix a and k, and simplify notation further by defining eh a, kt , ωt , ωt+1
= eht+1 . Note
that not only current and past states (k, ω) belong to the information set available to agents It ,

but also past prediction errors. I.e., eht , eht−1 , ..., eh1 ∈ It . We can then let zt = eht−d for d ≥ 1


and use result (ii) above to establish that E eht−d eht = 0. Thus, expectational errors are serially
uncorrelated.

C
C.1

Proofs: Estimation and Inference
Proof of Lemma 2

Given that {aimt , kimt : i = 1, ..., N } are i.i.d. conditional on ωmt , the first part of the Lemma (the
almost sure convergence) follows by an immediate application of the Law of Large Numbers for
exchangeable random variables (see Hall and Heyde (1980), p. 202, (7.1)).
The second part is obtained in three steps. First, Horvath and Yandell (1988) presents a Law
of Iterated Logarithm (LIL) applied to both kernel and nearest neighbor estimators for conditional
probabilities (see their Corollary 5.1). The i.i.d. sample in Horvath and Yandell (1988) can be
7

replaced by the assumption that the sample is i.i.d. conditional on the common shocks following
the arguments in Souza-Rodrigues (2016).2 The LIL then holds for almost all ωmt . Finally, it
is straightforward to adapt the kernel regression results to simple frequency estimators (i.e., use
simple indicator functions as kernel functions).

C.2

Proof of Proposition 3

Recall that gmt (θ) = h (zmt ) umt (θ, δmt ). Define the following functions:
M,(T −τ )
X
1
gmt (θ) ,
geM (θ) =
M (T − τ ) m=1,t=1

(C1)

eM (θ) = geM (θ)0 WM geM (θ) .
Q

(C2)

and

eM (θ) is similar to Q
bM (θ) but makes use of δmt instead of the estimator
The criterion function Q
b
eM (θ) is an unfeasible GMM criterion function, while Q
bM (θ) is feasible. The unfeasible
δ mt . I.e., Q
eM (θ) over Θ.
estimator e
θM (approximately) minimizes Q
A straightforward application of Theorem 2.6 in Newey and McFadden (1994) proves that the
unfeasible estimator e
θM is a consistent estimator of θ0 . To show that the feasible estimator b
θM
bM (θ) converges in probability to Q
eM (θ) uniformly
is consistent as well, it suffices to show that Q
over Θ. To do so, define the difference vmt = gbmt (θ) − gmt (θ), and
M,(T −τ )
X
1
vmt (θ) .
vM (θ) =
M (T − τ ) m=1,t=1

Then,
bM (θ) = [e
Q
gM (θ) + vM (θ)]0 WM [e
gM (θ) + vM (θ)]
0
eM (θ) + vM (θ) WM vM (θ) + 2e
= Q
gM (θ)0 WM vM (θ) .
Given Condition 2(ii), it suffices to show that both geM (θ) and vM (θ) converge to zero in probability
uniformly over Θ.
By Conditions 2(i),(iii),(v), and (vi), geM (θ) satisfies the uniform Weak Law of Large Numbers,
and therefore converges in probability to zero uniformly over Θ as M → ∞. Now consider vM (θ).
Note that


vmt = h (zmt ) umt (θ, b
δ mt ) − umt (θ, δmt ) ,

2

Souza-Rodrigues (2016) establishes the asymptotic properties of the kernel regression estimator for crosssectional data in the presence of common shocks.

8

and take a mean-value expansion of umt (θ, b
δ mt ) about δmt :


∗
) b
δ mt − δmt ,
umt (θ, b
δ mt ) − umt (θ, δmt ) = ∇δ umt (θ, δmt
∗
where δmt
lies between b
δ mt and δmt . Next, note that



E sup kvM (θ)k ≤
θ∈Θ



M,(T −τ )
X
1
∗
b
E sup kh (zmt ) ∇δ umt (θ, δmt )k δ mt − δmt
M (T − τ ) m=1,t=1
θ∈Θ



M,(T −τ )
X
2
B
b
≤
E δ mt − δmt
M (T − τ ) m=1,t=1

(C3)

where the second inequality follows from the Cauchy–Schwarz inequality
and Condition
2(vii).


2
p
= o (1), and,
Because b
δ mt − δmt → 0, as N → ∞, by Lemma 2, we have that E b
δ mt − δmt
so, the right-hand-side of (C3) converges to zero as N → ∞ for all M and T . We conclude that
p
bM (θ) − Q
eM (θ) →
0, as (M, N ) → ∞.
sup Q
θ∈Θ

C.3

Proof of Proposition 4.

By standard arguments (see Theorem 3.2 in Newey and McFadden (1994), the unfeasible estimator
e
θM satisfies
 √ 
−1
e
θM − θ0 = − [G0 WG] G0 Wg(θ0 ) + op 1/ M ,
(C4)
and is asymptotically normal,

√



p
M e
θM − θ0 → N (0, V) ,

under Conditions 3(i)-(iv). The asymptotic distribution of the feasible estimator b
θM is the same
e
as the asymptotic distribution of the unfeasible θM provided

b
θM − e
θ M = op

1
√
M


.

From (C4), it is clear that
 √ 
−1
e
θM − b
θM = [G0 WG] G0 WvM (θ0 ) + op 1/ M .
So,

 √ 
−1
b
θM − e
θM ≤ [G0 WG]
kGk kWk kvM (θ0 )k + op 1/ M .

9

Note that

1/2
M,(T −τ )  
X
2
B
E b
δ mt − δmt
E [kvM (θ0 )k] ≤
M (T − τ ) m=1,t=1


2

log N
= O log N
δ mt − δmt
by Condition 2(vii). Because E b
, by Lemma 2, we have that kvM (θ0 )k =
q

log log N
Op
, which implies
N
√
M b
θM − e
θ M = Op
provided

C.4

M log log N
N

r

M log log N
N

!
= op (1)

→ 0.

Additional Result

The next lemma provides a result that is used in Proposition 1. Proposition 1 claims that, for a
τ
τ
)] can be recovered
= (δmt , ..., δmt+τ ), quantities of the type E [h (zmt ) f (δmt
known function f of δmt
τ
from the data. (More specifically, f (δmt ) in the proof of Proposition 1 corresponds to the term in
parenthesis on the LHS of equation (B4).)
Lemma C1. Suppose the vector (wmt , zmt ) is i.i.d. across markets m. Assume


τ
E kh (zmt ) ∇δ f (δmt
)k2 ≤ C < ∞.
Then

M
τ
1 X
p
τ
h (zmt ) f (b
δ mt ) → E [h (zmt ) f (δmt
)] ,
M m=1

as (M, N ) → ∞.3
Proof. First, note that
M
M
M
h τ
i
τ
1 X
1 X
1 X
τ
τ
b
h (zmt ) f (δ mt ) =
h (zmt ) f (δmt ) +
h (zmt ) f (b
δ mt ) − f (δmt
) .
M m=1
M m=1
M m=1

The first term on the right-hand-side converges in probability to E [h (zmt ) f (δm )] as M → ∞ by
the Weak Law of Large Numbers. Applying a mean-value expansion on the second term, we get
M
M
h τ
i
h τ
i
1 X
1 X
τ
τ
τ∗
h (zmt ) f (b
δ mt ) − f (δmt
) =
h (zmt ) ∇δ f (δmt
) b
δ mt − δmt
M m=1
M m=1
τ

3

The same result applies if (wmt , zmt ) is stationary and ergodic, if we average the term [h (zmt ) f (b
δ mt )] over
T − τ time periods, and if we take (T, N ) → ∞.

10

τ

τ
τ∗
. Next, note that
lies between b
δ mt and δmt
where δmt

E

h

τ∗
)
h (zmt ) ∇δ f (δmt

1/2


i i
h τ
2


τ
2
τ
τ
∗
τ
b
δ mt − δmt
≤
E kh (zmt ) ∇δ f (δmt )k E b
δ mt − δmt
 
1/2
2
τ
τ
≤ C E b
δ mt − δmt
,

where the first inequality follows from the Cauchy–Schwarz inequality, and the second
inequality


2


τ
2
τ
τ
δ mt − δmt
from the regularity condition E kh (zmt ) ∇δ f (δmt )k ≤ C < ∞. By Lemma 2, E b
converges to zero as N → ∞, which implies
M
h τ
i
1 X
p
τ
h (zmt ) f (b
δ mt ) − f (δmt
) → 0, as N → ∞, for all M .
M m=1

D

The Standard CCP Estimator

Here we explain the standard CCP approach implemented in the Monte Carlo experiment to
estimate the model parameters. By “standard,” we mean involving a full specification of how
all state variables evolve, and not relying on Euler equations. Following Hotz and Miller (1993),
this CCP approach avoids the computational burden of solving the dynamic problem within the
estimation algorithm associated with Rust’s (1987) nested fixed point approach.
The estimation here follows Section 2 of Kalouptsidi, Scott, and Souza-Rodrigues (2019) and
we refer readers to it for details. Estimation begins by estimating choice probabilities conditional
on individual states and the modeled exogenous state variable, i.e., p (k, w). Let Fb represent the
stochastic matrix for observable state variables (k, w) conditional on buying the product, and let
Fnb represent the stochastic matrix when the action is not buying the product. Kalouptsidi, Scott,
and Souza-Rodrigues (2019) shows that
πb = Aπnb + b,
where A = (I − βFb ) (I − βFnb )−1 and b = Aψnb − ψb , where ψa stacks ψa (p (k, w)) across all
values of (k, w).
We estimate the payoff parameters θ using a Minimum Distance estimator, i.e., by minimizing
the L2 norm of
πb (θ) − Aπnb (θ) − b.

11

Given the parameterization, this is achieved by a linear regression of the vector b on the matrix
h

(1 − Ak) , w

i

,

where 1 is a vector of ones, k is a dummy vector equal to one in states where the good is owned,
and w is the vector of prices.4

E

Monte Carlo: Counterfactual

In the Monte Carlo presented in Section 6, we consider only the estimation of the parameters of
agents’ utility function. Typically, applied researchers are also interested in the outcomes of policy
simulations or counterfactuals. In this section, we extend the Monte Carlo experiment in Section
6 to study counterfactual simulations. Specifically, we consider how the biases in the parameter
estimates pass through to biases in countefactuals, but first, we must consider the question of how
to do counterfactuals within the ECCP framework.
Much of the ECCP approach’s appeal comes from the fact that it takes seriously the possibility
that the econometrician might be facing important measurement issues; e.g., some market-level
state variables might not be observed, and/or it might be difficult to specify how they evolve.
However, when doing counterfactuals, researchers typically solve for a new equilibrium of the
model, which normally involves fully specifying all the relevant state variables and how they evolve.
Thus, prima facie, ECCP estimation seems to be at odds with doing counterfactual simulations.
A counterfactual is a function of the model parameters, and sometimes that function does not
depend (or depends only minimally) on the presence of unobservable variables or on the precise
specification of how state variables evolve. Therefore, the modeling issues that motivate the
ECCP approach need not undermine the use of parameter estimates for counterfactual analysis.
De Groote and Verboven (2019) provide a clear example. They use an ECCP estimator to estimate
the rate of time discounting of Belgian households in deciding whether to install solar photovoltaic
systems (the ECCP estimator allows them to flexibly include demand shocks and avoid specifying
a process for how government policy evolved). They find that households’ estimated discount rate
is considerably lower than the interest rate that the Belgian government can borrow at. As they
argue, this disparity means that it would be more cost effective for the government to support solar
PV installations with up-front payments, rather than the ongoing payments that the government
actually used. This conclusion follows intuitively from the disparity in discount rates and plausibly
is not affected in an important way by how government policy and unobservable states evolve. The
conclusion, however, may be highly sensitive to biases in the estimation of the discount factor. In
4

Note that one can estimate the model parameters either by minimizing the distance between b and πb (θ) −
Aπnb (θ), or by minimizing the distance between the (nonparametrically) estimated CCP, p, and the CCP generated
by the model, p(θ). See Pesendorfer and Schmidt-Dengler (2008).

12

other words, the estimation of a mis-specified model may crucially affect policy recommendations.
In what follows, we show that some counterfactuals – specifically, long-run demand elasticities
from our durable good demand model – are robust to the omission of unobservable state variables
that are present in the data generating process. Or more specifically, long-run demand elasticities
are well approximated by a model in which we set ξ at its long-run mean (i.e., ξ = 0). Furthermore,
we show that the biases that result from leaving the unobservable shocks out of the counterfactual
simulations can be smaller than the biases that result from using an estimation approach that is
not robust to their presence.
We perform both a real and feasible counterfactuals for the durable good demand model. Our
real counterfactuals take the parameter estimates from various estimations presented in Section 6
and plug them into a counterfactual that uses the true data generating process (notably including
the true law of motion for the unobservable demand shock ξmt ). That is, the real counterfactuals
rely on our understanding of an unobservable that an econometrician who was not simulating the
data would not have access to. Our feasible counterfactuals, in contrast, simulate a simple model
that an econometrician could easily implement: a model that sets ξ = 0.5
The counterfactual we consider is an increase in the mean price level (formally, we increase
γ0 by .01; see Table 1 in Section 6), and we calculate the long-run change in the demand level.
That is, we calculate the unconditional probability of purchase P r (a = b) in the steady state after
solving the consumer’s dynamic problem. We present this counterfactual in the form of a long-run
demand elasticity, i.e., the ratio of the percentage change in the probability of purchase to the
percentage change in the long-run price.
Table E1 shows the counterfactuals from the ECCP (OLS and IV) and standard CCP estimators
based on the parameter estimates from the above simulations with M = 160 and T = 160. A first
observation is that the real and feasible counterfactuals at the true parameters differ by a factor
of about 10%. Second, consistent with the biases in the underlying parameter estimates, we find
that the ECCP IV estimates yield very little bias in the counterfactuals relative to the true values
while the other estimators result in substantially biased counterfactuals. Furthermore, the biases
in the long-run elasticities from the OLS and standard CCP estimators (whether we consider the
real or feasible versions) are larger than the gap between the real and feasible estimators.
Evidently, counterfactuals are not always robust to setting ξ at its unconditional mean. The
broader point we make in this section is that robustness to the presence of unobserved shocks
can be assessed through a procedure similar to what we do here. That is, when researchers are
concerned about the presence of unobservables, they might adopt a robust estimation approach
that delivers consistent estimates of important parameters despite the unobservables. Then, when
it comes to counterfactual simulations, they can perform the simulation in several ways to assess
5

To solve the feasible counterfactual, we need to specify how the exogenous state variable wmt evolves. We
consider the residual from the pricing equation (39) as the econometrician can measure it. I.e., w = γ0 + γ1 z + ν,
where ν = γ2 ξ + εw . So, we calculate the true evolution of ν given the underlying processes and assume the
econometrician is able to estimate it.

13

whether and how the results of interest might be sensitive to the presence of unobservables and
how they evolve.
Table E1: Sample size, structure and bias
ECCP
True value
OLS
IV

Standard
CCP

Real LRE

-1.106

Mean Estimate
Relative Bias
SD
RMSE

60.15
-5540%
16.62
63.48

-1.104
-0.1561%
0.04227
0.04231

0.01471
-101.3%
0.02545
1.121

Feasible LRE

-1.022

Mean Estimate
Relative Bias
SD
RMSE

-1.187e4
1.162e6%
1.382e6
1.382e6

-1.064
4.114%
0.1184
0.1256

0.03888
-103.8%
0.06774
1.063

Notes: 5000 replications with sample structure M = T = 160. SD is the standard
deviation across replications. RMSE is root-mean squared error.
Relative Bias is bias as percentage of the true parameter.

References
Arcidiacono, P., and R. A. Miller (2019): “Nonstationary dynamic models with finite
dependence,” Quantitative Economics, 10, 853–890.
De Groote, O., and F. Verboven (2019): “Subsidies and Time Discounting in New Technology Adoption: Evidence from Solar Photovoltaic Systems,” American Economic Review, 109(6),
2137–72.
Hall, P., and C. C. Heyde (1980): Martingale limit theory and its application. Academic press.
Horvath, L., and B. S. Yandell (1988): “Asymptotics of conditional empirical processes,”
Journal of Multivariate Analysis, 26(2), 184–206.
Hotz, V. J., and R. A. Miller (1993): “Conditional Choice Probabilities and the Estimation
of Dynamic Models,” Review of Economic Studies, 60(3), 497–529.
Kalouptsidi, M., P. T. Scott, and E. A. Souza-Rodrigues (2019): “Identification of
Counterfactuals in Dynamic Discrete Choice Models,” Quantitative Economics, forthcoming.
Newey, W. K., and D. McFadden (1994): “Large Sample Estimation and Hypothesis Testing,”
Handbook of Econometrics, 4, 2111–2245.
14

Pesendorfer, M., and P. Schmidt-Dengler (2008): “Asymptotic Least Squares Estimators
for Dynamic Games,” The Review of Economic Studies, 75(3), 901–928.
Ransom, T. (2019): “Labor Market Frictions and Moving Costs of the Employed and Unemployed,” Discussion Paper 12139, IZA Institute of Labor Economics.
Rust, J. (1987): “Optimal Replacement of GMC Bus Engines: an Empirical Model of Harold
Zurcher,” Econometrica, 55(5), 999–1033.
Souza-Rodrigues, E. A. (2016): “Nonparametric Regression with Common Shocks,” Econometrics, 4(3), 36.

15

