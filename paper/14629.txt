NBER WORKING PAPER SERIES

INCOMPLETE-MARKET EQUILIBRIA SOLVED RECURSIVELY ON AN EVENT
TREE
Bernard Dumas
Andrew Lyasoff
Working Paper 14629
http://www.nber.org/papers/w14629

NATIONAL BUREAU OF ECONOMIC RESEARCH
1050 Massachusetts Avenue
Cambridge, MA 02138
December 2008

We are grateful to colleagues and students for providing valuable comments: Julien Cujean, Darrell
Duffie, Julien Hugonnier, Bjarne Astrup Jensen, Felix Kubler, Pascal Maenhout, Raman Uppal and
Tan Wang, as well as participants in workshops at Handelshøyskolen BI (Oslo), the Copenhagen School
of Economics, the Collegio Carlo Alberto (Torino), the University of Southern Denmark, ESSEC and
the Free University of Brussels (ECARES). Dumas' research is supported by the Swiss National Center
for Competence in Research "FinRisk". The views expressed herein are those of the author(s) and
do not necessarily reflect the views of the National Bureau of Economic Research.
NBER working papers are circulated for discussion and comment purposes. They have not been peerreviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.
© 2008 by Bernard Dumas and Andrew Lyasoff. All rights reserved. Short sections of text, not to
exceed two paragraphs, may be quoted without explicit permission provided that full credit, including
© notice, is given to the source.

Incomplete-Market Equilibria Solved Recursively on an Event Tree
Bernard Dumas and Andrew Lyasoff
NBER Working Paper No. 14629
December 2008
JEL No. C63,C68,D52,D58,D91,G11,G12
ABSTRACT
We develop a method that allows one to compute incomplete-market equilibria routinely for Markovian
equilibria (when they exist). The main difficulty to be overcome arises from the set of state variables.
There are, of course, exogenous state variables driving the economy but, in an incomplete market,
there are also endogenous state variables, which introduce path dependence. We write on an event
tree the system of all first-order conditions of all times and states and solve recursively for state prices,
which are dual variables. We illustrate this "dual" method and show its many practical advantages
by means of several examples.

Bernard Dumas
Université de Lausanne
Institut de Banque et Finance
Bâtiment Extranef
1015 Lausanne
Switzerland
and NBER
bernard.dumas@unil.ch
Andrew Lyasoff
Boston University
143 Bay State Road
Boston, MA 02215
alyasoff@bu.edu

Because of the large size of non-traded human capital, causing some idiosyncratic risks not to
be traded, financial markets in the real world are massively incomplete. For this reason, it is quite
possible that the investigation of incomplete-market equilibria will eventually deliver a solution
to some of the well-known “puzzles” encountered in financial-market data. Missing-market risks
should “rock the boat” of traded markets, increasing risk premia and volatility and causing the
distribution of wealth in the investor population to act as a dimension of risk that is separate from
aggregate wealth.1 At least four contributions have thrown some light on the issue. Krusell and
Smith (1998) consider a continuum of identical individuals with independent idiosyncratic risks
and a financial market where only a one-period riskless security is traded. They conclude that
the incomplete-market equilibrium is very close to the complete-market equilibrium. Heaton and
Lucas (1996) consider an equilibrium with two classes of agents, market incompleteness, trading
costs and borrowing constraint. They conclude that the borrowing constraint is what makes a
diﬀerence, more so than the incompleteness. Basak and Cuoco (1998), however, propose a model
with limited participation,2 which shows that, when some people are prevented from accessing a
market, the market Sharpe ratio is vastly increased. And Gomes and Michaelides (2006) attribute
the large risk premia in their model mainly to imperfect risk sharing among stockholders rather than
to limited participation. Other general discussions of this issue include Guvenen (2004), Guvenen
and Kuruscu (2006) and Krueger and Lustig (2007).
The matter will not be fully settled until the day we have at our disposal a tool to investigate
many diﬀerent case situations. Our goal in the present paper is to develop a method that allows
one to compute incomplete-market equilibria routinely for Markovian equilibria (when they exist).
“Routinely” means that there would be no need to develop a new trick every time one considers
a diﬀerent economic model. Thirty years after Cox, Ross and Rubinstein (1979) taught us how to
calculate the prices of derivatives on an event tree by simple backward induction, we aim to show
how a similar formulation can be utilized in computing financial-market equilibria.
When considering incomplete-market equilibria of pure-exchange economies, the main diﬃculty
to be overcome arises from the set of state variables. There are, of course, exogenous state variables
driving the economy (for instance, output) but, in an incomplete market, there are also endogenous state variables (say, to fix ideas temporarily, “the distribution of wealth” in the population).
Mathematicians say that the system is “forward-backward” in time: exogenous state variables are
subject to an initial condition while wealth is subject to both an initial and a terminal condition.
We start from the standard formulation based on dynamic programming but we introduce
several changes. First, we use for endogenous state variables not the acquired wealths of the agents
but their individual state prices or, equivalently their current consumptions relative to each other.3
Second, we regroup the agents’ first-order conditions so that, at any given time and in any given
node, we do not solve simultaneously for current portfolios and current consumption but solve,
instead, simultaneously for the current portfolio and the agents’ consumptions in all nodes that
succeed the current one. Since today’s portfolio directly finances tomorrow’s consumption, the
technique allows some amount of decoupling between time periods and states of nature. The result
will be a recursive construction of tomorrow’s individual agents’ state prices or consumptions as
functions of today’s state prices or consumptions. Third, we do not carry backward and interpolate
the value functions of agents’ dynamic programs. Instead, we carry backwards agents’ wealths and
1

The pioneering paper on this question is Marcet and Singleton (1991).
The situation that they call “limited participation” is very close to an incomplete-market situation. See the
discussion in Subsection IV-A below.
3
This is akin to the “dual approach” developed at the level of the individual investor by He and Pearson (1991).
For an application to decisions on a tree, see Detemple and Sundaresan (1999).
2

2

securities’ prices as functions of the endogenous state variables. The wealths in question are not the
wealths carried forward by agents; they are, instead, the present values of future net expenditures,
or the wealths needed so that agents can continue with their optimal program at the current and
future prices of securities. When time 0 is reached, this gives us the incomplete-market analog of
a Negishi map.
The technique brings several key benefits over the traditional dynamic-program with tatonnement approach: (i) Wealth in this construction is not a state variable, a property which brings
the major advantage that we never have to limit the positions taken by agents and we do not have
to limit endogenously the domain of agents’ wealth state variables, to guarantee that each of them
has enough wealth remaining to continue trading, (ii) For this reason, the system, which was originally forward-backward becomes entirely backward all the way to time 0, which is the only point
at which we have to make sure, by adjusting the initial value of the endogenous state variables,
that the present value of future net expenditures jibes with the initial claims of each agent, which
are givens of the problem, (iii) In contrast to the traditional dynamic programming approach, the
algorithm is not limited to a relatively small number of assets. That number only increases the
size of the equation system to be solved at each node. The main dimensional limitation of the
algorithm, as would be true anyway in the traditional approach, is actually the number of agents
in the economy, (iv) While, in traditional dynamic programing, derivatives of the value function
appear in first-order condition, here we never have to take a derivative of a function that has been
interpolated. As is well-known in numerical analysis, the derivative of an approximate function is
typically not a good approximation of the derivative of that function.
A related approach has been proposed in two previous contributions by Domenico Cuoco and
Hua He.4 Cuoco and He (1994) propose a recursive method in a continuous-time setting. In the
present paper, we prefer to stay away from continuous time for two reasons. First, the infinite
dimension of spaces opens possibilities for non existence of equilibria and for the presence of a type
of “bubbles” that do not arise in a finite-dimensional space.5 Secondly, continuous-time models
require the solution of partial diﬀerential equations, approximated by means of finite-diﬀerences,
over an artificially bounded domain. These involve boundary conditions on the edges of the domain
that are diﬃcult to establish a priori.
Cuoco and He (2001) propose to write on a binomial tree the system of all first-order conditions
of all times and states, and to solve this “global” system simultaneously. We prefer a recursive
approach working by backward induction, as being less likely to go haywire numerically than a
global approach.6 Solving simultaneously a nonlinear system involving thousands of equations is
a numerical impossibility. The present paper aims to apply an approach derived from Cuoco and
He (1994) to obtain recursively the solution of the equilibrium on a tree. One side benefit of the
recursive solution method, which is of great practical importance, will be that the tree can be made
to be recombining when the exogenous variables have Markovian behavior.
The approach draws on two sets of contributions from the field of Mathematical Economics.
Papers of the first set are those that demonstrated the generic existence of equilibrium in an
4

Bizid and Jouin (2001, 2005) have established bounds on equilibrium prices of securities in an incomplete market,
using a similar “martingale” approach.
5
See Heston, Lowenstein and Willard (2007) and Hugonnier (2007). Here, we only consider finite-horizon economies
in discrete time so that both the state space and the time space are finite. For that reason, we have no need to place
constraints on wealth and/or borrowing to avoid Ponzii schemes.
6
Ljungqvist and Sargent (2000), Chapter 17, propose recursive methods to solve for infinite-horizon stationary
incomplete-market equilibria.

3

incomplete-market stochastic finance economy in which long-lived real assets are traded. 7 They
relied on a concept variously called “pseudo-equilibrium” or “no-arbitrage equilibrium”, which
involved state prices as unknowns. We use a definition of equilibrium that is somewhat similar.
The second set of papers pertains to the existence of a recursive formulation of the equilibrium
when the exogenous state variables are Markovian. They discuss the choice of the endogenous state
variables that permit recursivity. Kubler and Schmedders (2002), in particular, provide examples
showing that the distribution of wealth in the population, and even the equilibrium asset holdings
of investors do not constitute a suﬃcient state space. Here, we shall illustrate that the distribution
of individual-specific state prices or, equivalently, the distribution of consumption can be used to
define the endogenous component of the state space.
The balance of the paper is organized as follows. In Section I, we write the first-order conditions that must prevail at each node of the tree. In Section II, we explain how the solution of the
intertemporal system can be obtained recursively. In Section III, we exploit an homogeneity property to reduce the system of equations and we explain how the grid of points for the endogenous
state variables is selected. Section IV contains three canonical examples of the application of our
method and Section V two additional, increasingly realistic examples, one of which is calibrated to
the U.S. economy. In Section VI, we discuss two problematic examples, one for which there does
not exist an equilibrium at a point of the state space and one for which there does not exist a
recursive equilibrium based on acquired wealth. The final section concludes with some prospective
developments.

I. The first-order conditions at a node
A. The economy
Time is discrete, t ∈ N, from 0 to T. We start with an event tree (Σ, F) where Σ is a sample
set and F ≡ {Ft }Tt=0 a filtration, represented as a chain of successive partitions of the set Σ, so
that F0 = {Σ}, F1 is a partition of Σ, F2 is a subdivision of F1 , and so on. We will interpret the
filtration F as a tree structure in the usual way, i.e., by identifying the sets from each partition Ft
as the “time-t nodes” on the tree. A given information set or “node” ξ at time t is followed by
Kt,ξ nodes at time t + 1. Given any information set ξ ∈ Ft , we denote by Fξ the chain of partitions
of the set ξ that is induced by F. This chain of partitions is defined by Fξ,τ , {η ∈ Ft+τ ; η ⊆ ξ},
τ = 0, 1, . . . , T − t. The unique predecessor of node ξ is denoted ξ − .8
The financial market is populated with L + 1 investors indexed by l n
= 1, . . . , L + 1 who reo
ceive a set of exogenous time×state sequences of individual endowments et ∈ RL+1
;
0
≤
t
≤
T
++

adapted to (Σ, F) .9 Investors may also be endowed with initial claims on each other: W0 ∈ RL+1 ,
P
L+1
l=1 Wl,0 = 0. For our purposes, it is suﬃcient for the filtration of the event tree to be generated
by the exogenous state variables e. Because the tree only involves the exogenous endowments, it can
be chosen to be recombining when the endowments are Markovian, which is a great computational
advantage compared to the global-solution approach (see Subsection A below for a comparison).
7

See Cass (1984), Duﬃe and Shafer (1985, 1986), Magill and Shafer (1990), Husseini, Lasry and Magill (1990),
Hirsch, Magill and Shafer (1990), Magill and Shafer (1991) and the textbook Magill and Quinzii (1996).
8
For the standard definition of an event tree, see Magill-Quinzii (1996, Section 4.18). More detail is provided in
Appendix 1.
9
Without further notice, all stochastic processes in this article are assumed to be adapted to F.

4

Two nodes “recombine” when they refer to two identical events and require identical calculations
but, in the event tree, they remain conceptually distinct.
At each point in time, the agents must consume some strictly positive amounts cl,t > 0 of a
single perishable good, which we use as the numeraire in the economy. As in Debreu (1970, 1972)
and Duﬃe and Shafer (1986), we make the smooth-preference assumption, i.e., the consumption
preferences of the agents are expressed in terms of the utility functions Ul,t,ξ : R++ 7→ R which are
assumed increasing, twice continuously diﬀerentiable and strictly concave. The goal of agent l at
time t in node ξ ∈ Ft is to maximize the quantity
Jl,t,ξ (cl ) , Ul,t,ξ (cl,t,ξ ) +

T
−t
X

Et,ξ [Ul,t+τ (cl,t+τ )] ,

τ =1

Rather than impose as a constraint that cl,t,ξ > 0, we make an assumption on utility such that the
agents choose strictly positive consumption, if that is at all feasible (i.e., as long as their budget
0
(x) = +∞.
set is not empty). That is an Inada assumption: limx→0 Ul,t,ξ
ª financial market, there are N ≥ 1 securities defined by their payoﬀs or “dividends”
© In the
δ t ∈ RN . The market is incomplete in the sense that N < Kt,ξ for at least some t and ξ. In
some examples, investors hold the securities long and some other investors hold them short as they
are “in zero net supply”. In some other examples, the securities’ payoﬀs may include some of the
endowments, in which case we say that the securities are in positive net supply. One is just an
accounting transformation of the other. We develop the equation system under the first instance
but we remain free to present later some examples under the second instance. The prices of the
securities are denoted: {St,ξ,n ; 1 ≤ n ≤ N ; 0 ≤ t ≤ T ; ξ ∈ Ft } . We impose: ST ≡ 0.
Any portion of the investor’s wealth that is not consumed at any time t + τ is invested in
a portfolio of securities described by the vector θl,t+τ ,η ∈ RN , η ∈ Ft+τ , which represents the
numbers of shares held. The entering wealth for time t + τ , not including the endowment el,t+τ ,η
to be received, is defined thus:
Wl,t+τ ,η , θl,t+τ −1,η− · (St+τ ,η + δ t+τ ,η ).
Investor l’s budget set for the entering wealth w at time t in State ξ is:
⎧
¯
¯ cl,t+τ ,η + θl,t+τ ,η · St+τ ,η = el,t+τ ,η + Wl,t+τ ,η ,
⎪
¯
⎪
⎪
¯
⎪
τ = 0, . . . , T − t; η ∈ Fξ,t+τ
⎨
¯
Wl,t,ξ = w
Bl,t,ξ (w) , cl adapted to F ¯¯
⎪
¯
⎪
θl,T ≡ 0
⎪
¯
⎪
⎩
¯
θl adapted to F

⎫
⎪
⎪
⎪
⎪
⎬
⎪
⎪
⎪
⎪
⎭

(1)

When cl starting at t is in this budget set with some choice of the trading strategy θl , we say that
cl is a feasible consumption plan for the entering wealth Wl,t,ξ and the pair (Wl,t,ξ , θl ) is said to
finance cl . Investor l’s value function for time t is, therefore, given by:10
Vl,t,ξ (w) , sup {Jl,t,ξ (cl ); cl ∈ Bl,t,ξ (w)} ,
It is verified in Appendix 2, that the Principle of Dynamic Programming applies, i.e., the goal
of Investor l at time t = 0 is maximized if and only if his goal at all times and in all possible states
10

We set Vti (Wti ) = −∞ if the budget set is empty.

5

of the economy is maximized. Hence, if the consumption plan cl and the trading strategy θl attain
agent-l’s objective, then one can claim that x∗ = cl,t and y ∗ = θl,t solve the “primal” optimization
problem:
maxx,y Gl,t,ξ (x, y) , Ul,t,ξ (x) + Et,ξ [Vl,t+1 [y · (St+1 + δ t+1 )]]
subject to : x + y · St = el,t,ξ + Wl,t,ξ ,

x ∈ R++ , y ∈ RN .

(2)

Since x > 0, i.e. consumption is strictly positive, the Lagrangian for this problem is given by
Ll,t,ξ (x, y, λ) = Gl,t,ξ (x, y) + λ× (el,t,ξ + Wl,t,ξ − x − y · St ) ,
x ∈ R++ , y ∈ RN , λ ∈ R .

[Figure 1 about here.]
Consequently, as illustrated in Figure 1, when investor l is faced (in state ξ ∈ Ft ) with entering
wealth Wl,t,ξ , local price vector St , and new endowment el,t,ξ , he computes his immediate consumption cl,t,ξ , his immediate trading strategy θl,t,ξ and his local (in time and state of the economy)
Arrow-Debreu shadow prices φl,t,ξ ∈ R in such a way that
Ll,t,ξ (cl,t,ξ , θl,t,ξ , φl,t,ξ ) = inf

sup

λ∈R x∈R++ , y∈RM

Ll,t,ξ (x, y, λ).

In particular, (cl,t,ξ , θl,t,ξ , φl,t,ξ ) must satisfy the following first-order conditions, with the exception
of the third one when t = T :
0
(cl,t,ξ ) = φl,t,ξ ,
Ul,t,ξ
cl,t,ξ + θl,t,ξ · St = el,t,ξ + Wl,t,ξ ,
¤
£ 0
Et,ξ Vl,t+1 [θl,t,ξ · (St+1 + δ t+1 )] × (Sn,t+1 + δ n,t+1 ) = φl,t,ξ Sn,t,ξ , 1 ≤ n ≤ N.

(3)

B. The dual first-order conditions
A straightforward application of the envelope theorem gives
0
(Wl,t,ξ ) = φl,t,ξ (Wl,t,ξ ).
Vl,t,ξ

(4)

We substitute Equation (4) into (3) and show that the resulting first-order conditions are necessary
and suﬃcient for optimality, which is the main result on which our method rests:
Theorem 1: Given a price process S and initial wealths Wl,0 , the choice of consumption plans cl ,
trading strategies θl and state prices φl maximizes investor l’s goal at all times and in all possible
states of the economy if and only if the following three conditions, except for the third one when
t = T , are satisfied for any 0 ≤ t ≤ T and in any state ξ ∈ Ft :
0
Ul,t,ξ
(cl,t,ξ ) = φl,t,ξ ,

cl,t,ξ + θl,t,ξ · St,ξ = el,t,ξ + Wl,t,ξ ,
¤
£
Et,ξ φl,t+1 × (Sn,t+1 + δ n,t+1 ) = φl,t,ξ Sn,t,ξ , 1 ≤ n ≤ N .

(5)

Furthermore, the value functions Vl,t,ξ , treated as functions of the entering wealths Wl,t for time
t, are concave in any state ξ ∈ Ft , for any 0 ≤ t ≤ T , and, if it exists, the solution (cl , φl ) is
necessarily unique.
The proof (in Appendix 3) amounts to showing by backward induction that the function Vl,t,ξ
is concave.
6

C. The equilibrium
A financial-market equilibrium is defined in, e.g., Magill-Quinzii (1996), Page 228 as a set of
securities prices,Pportfolios and consumption allocations in the population such that the securities’
L+1
markets clear:
l=1 θ l,t,ξ ≡ 0. The issue of the existence of a financial-market equilibrium in an
incomplete financial market, when securities are long lived (which means that they are not just
next—time payoﬀ securities) has been the subject of several papers.11 They have found that, under
the set of assumptions that we make in the present paper, equilibrium can fail to exist in the
economy described by:
Σ, F, π, Wl,0 = 0, el , δ n , Ul,t,ξ ;

1 ≤ l ≤ L + 1,

1≤n≤N

(6)

only at isolated points of the dataset {el , δ n ; 1 ≤ l ≤ L + 1, 1 ≤ n ≤ N }. This result was
established for the case Wl,0 = 0 only.12 This is called “generic existence”. Equilibrium fails to exist
if it so happens that the matrix of one-period payoﬀs inclusive of capital gains, in some state of the
economy, fails to be of full rank N. In Section VI below, we consider the example of an economy
in which the equilibrium fails to exist at a specific point and we test the ability of our algorithm
to find the equilibrium at all other points of the economy.
Many of the papers addressing the issue of existence have found it useful to utilize a concept
of equilibrium called variously “pseudo-equilibrium” or “no-arbitrage equilibrium”13 and then to
show that such an equilibrium is also a financial-market equilibrium. In a no-arbitrage equilibrium,
the unknowns are not the prices of the existing securities and the market-clearing conditions do
not involve securities. Instead, they involve clearing of the goods markets, while the prices to be
solved for are the state prices of one economic agent, say Agent #1. Under these state prices,
Agent #1 chooses his consumption stream to maximize his goal without constraint while all other
agents choose their consumption stream under the constraint that their consumption is feasible
under Agent #1’s state prices, given the existing set of securities. This simplification reflects the
fact that, when all agents but one, are prevented from trading in some dimensions, then, by goods
market clearing, prices will cause even the unconstrained agent to not trade in those dimensions.
From the point of view of agents that are constrained, the eﬀective agent-specific state prices deviate
from those of Agent #1 by the shadow prices of the feasibility constraint that is imposed on them.
Our definition of equilibrium goes in the same direction in that it also does not include a condition of financial-market clearing. Instead, it includes an “aggregate-resource” restriction, Equation
(7) below, which is similar to the constraint imposed on a central planner in a welfare maximization
problem. However, unlike the no-arbitrage equilibrium, the unknowns are not the state prices of one
agent; they are the state prices of all agents. Below, we show under the assumption that the matrix
of one-period payoﬀs inclusive of capital gains remains of full rank N, that securities markets clear
so that our equilibrium is also a financial-market equilibrium.
Definition 1: The choice of a price process S, consumption plans cl , trading strategies θl and
state prices φl , for 1 ≤ l ≤ L + 1, is an equilibrium for the economy (6), if all conditions in (5)
are satisfied — i.e., with this choice all agents maximize their goals under the price process S at all
11

See the references already mentioned in the introduction: Cass (1984), Duﬃe and Shafer (1985, 1986), Magill and
Shafer (1990), Husseini, Lasry and Magill (1990), Hirsch, Magill and Shafer (1990), Magill and Shafer (1991) and the
textbook Magill and Quinzii (1996).
12
In applications where initial claims at time 0 are not zero (but, of course, sum to zero across the population), the
sizes of the claims must be below some upper bound, above which no equilibrium would exist, only because a person,
given his/her anticipated endowment stream, could not repay his/her initial debt.
13
See, for instance, Magill and Quinzii (1996), Page 247.

7

times and in all states of the economy — and, in addition, the following aggregate resource condition
holds for any 0 ≤ t ≤ T and in any state ξ ∈ Ft
L+1
X

cl,t,ξ =

l=1

L+1
X

el,t .

(7)

l=1

Thus, in order to obtain an equilibrium, one must solve the system (5 for 1 ≤ l ≤ L + 1) and
(7) — for all times and all states of the economy.

II. Recursivity
We can treat (5) and (7) as a system of conditions grouped by points in time for t = 0, 1, . . . , T .
At time t, one must be able to compute the time-t consumption levels for all agents and the prices
at which securities are to be traded. However, this cannot be achieved by solving the system point
in time by point in time because the consumptions cl,t,ξ appear in the equations for time t, in which
they are endogenous, and also in the equations for time t − 1 in which they are exogenous. In other
words, it would be hard to solve the system recursively in the backward way because the unknowns
at time t include consumptions at time t, cl,t , whereas the third component of Equations (5) if
rewritten as:
¤
£ 0
(cl,t+1 ) × (Sn,t+1 + δ n,t+1 ) = φl,t,ξ Sn,t,ξ
Et,ξ Ul,t+1
can be seen to be a restriction on consumptions at time t + 1, which at time t would already be
solved for. In this form, the system is simultaneously forward and backward at each point in time.

Furthermore, when wealth is an endogenous state variable, as is the case so far, it is hard
to decide a priori what should be its domain, over which the various policy functions would be
defined and interpolated. The domain is endogenous. If an investor has excessively negative wealth,
calculated at the endogenous securities prices, no equilibrium exists as it becomes impossible for
him/her later to repay. One would be able to determine the domain at each point in time only
after the algorithm has reached time 0, which is the point at which the initial wealth conditions
are specified.
In order to make a recursive solution possible, we must re-formulate the system so that it can
be solved backward all the way from time T to time 0. The reformulation involves two separate
modifications.
First, we re-cast the flow-budget condition (the second condition in (5)) in terms of agent l’s
wealth exiting time t, which is simply Fl,t , θl,t · St . As the wealth entering time t is Wl,t =
θl,t−1 · (St + δ t ) , the flow-budget constraint can be written equivalently as
cl,t,ξ + Fl,t,ξ = el,t,ξ + θl,t−1,ξ− · (St + δ t )
[Figure 2 about here.]
Secondly, we introduce a crucial time-shift, or regrouping, which makes the solution by backward
induction possible. To be precise, we combine the first two equations of (5) and equation (7) for time
t + 1 with the third equation of (5) for time t and, consequently, associate with time 0 ≤ t ≤ T − 1
and with State ξ ∈ Ft the following set of conditions:
8

0
Ul,t+1,η
(cl,t+1,η ) = φl,t+1,η ,

1 ≤ l ≤ L + 1, η ∈ Fξ,1 ,

cl,t+1,η + Fl,t+1,η = el,t+1,η + θl,t,ξ · (St+1,η + δ t+1,η ) ,

1 ≤ l ≤ L + 1, η ∈ Fξ,1
¤
¤
£
£
Et,ξ φl,t+1 × (Sn,t+1 + δ n,t+1 )
Et,ξ φL+1,t+1 × (Sn,t+1 + δ n,t+1 )
=
,
φl,t,ξ
φL+1,t,ξ
L+1
X
l=1

cl,t+1,η =

L+1
X
l=1

(8)

1 ≤ n ≤ N, 1 ≤ l ≤ L ,
el,t+1,η ,

η ∈ Fξ,1 .

For any given node ξ ∈ Ft , these conditions must hold simultaneously across its immediate successors η ∈ Fξ,1 . In other words, as illustrated in Figure 2, we consider artificially that the decisions
to be made at time t are the portfolio decision at time t and the consumption decisions at time
t + 1, instead of time t.
Equation system (8) contains 2 × (L + 1) × Kt,ξ + L × N + Kt,ξ equations in four subsets:
The first subset provides the link between consumption and state prices. The second subset is
the flow budget constraint for the states of time t + 1. It could also be called “the marketability
condition” because it imposes that, in this incomplete market, there exist a portfolio θt chosen at
time t that makes the consumption-wealth plan of time t + 1 feasible. The third subset says that
all investors must agree on the prices of traded assets. We call it “the kernel condition” because
it restricts the state prices φl,t+1,η to lie in some linear subspace. Finally, the fourth subset is the
aggregate-resource constraint.
The unknowns are {cl,t+1,η , φl,t+1,η ; 1 ≤ l ≤ L + 1, 1 ≤ η ≤ Kt,ξ } and
{θl,t,ξ ; 1 ≤ l ≤ L + 1, 1 ≤ n ≤ N }.
ª endowments el,t+1,j , the “givens” are the
© Besides the exogenous
individual state prices of time t, φl,t,ξ ; 1 ≤ l ≤ L + 1 , which must be treated as state variables,14
the future securities’ prices St+1,n,j , which are obtained by the backward induction formula:
¤
£
Et+1,η φl,t+2 × (Sn,t+2 + δ n,t+2 )
, Sn,T ≡ 0 , 1 ≤ n ≤ N , 1 ≤ l ≤ L + 1 ,
(9)
Sn,t+1,η =
φl,t+1,η
and finally the future investors’ wealths Fl,t+1,j , which are also obtained by backward induction:
¤
£
Et+1,η φl,t+2 × (Fl,t+2 + cl,t+2 − el,t+2 )
, Fl,T ≡ 0 , 1 ≤ l ≤ L + 1 ,
(10)
Fl,t+1,η =
φl,t+1,η
where the last equation follows from (9) by dot multiplying by θl,t+1,η and invoking the second
equation of (5).
If we recall that (5) contains only the first two equations when t = T , it is clear that (8) exhausts
all conditions defining equilibrium, i.e., (5) and (7), except for the first two conditions in (5) and
condition (7) at t = 0, which are the only “forward” conditions remaining and which we can write
14

The population distribution of φl,t,ξ is our endogenous state variable, rather than the distribution of wealth,
although one is in part a reflection of the other.

9

as:
0
Ul,0
(cl,0 ) = φl,0 ,

cl,0 + θl,0 · S0 = el,0 + Wl,0 ,
L+1
X

cl,0 =

l=1

L+1
X

1 ≤ l ≤ L + 1,

1 ≤ l ≤ L + 1,

(11)

el,0 .

l=1

Up until time 0, exiting wealth is calculated backward as the present value of future net expenditures
(see (10)). It should be interpreted as the wealth needed by each investor in order for him or her
to be able to carry on his/her consumption program. The wealth actually owned (entering wealth)
enters the algorithm only at the very end, once time 0 is reached. At that time, we have available
a “Negishi map” mapping the allocation of consumption into required wealth.15 The map is a very
useful tool. For the given level of initial wealth, we use the Negishi map to solve for the initial
allocation of consumption, which will then by forward propagation provide all the values of the
variables at all the nodes. If the Negishi map is monotonic, the equilibrium is unique. Otherwise,
we can tell from the map how many equilibria exist depending on the level of initial wealth. The
image of the Negishi mapping is typically a bounded set of values of wealth. If so and if the initial
wealth falls within the image of the mapping, there exists an equilibrium. Otherwise not.
Two interim results must be noted at this point. First, because all investors agree on traded
securities prices (the kernel restrictions), the recursions (9) can equivalently be written on the basis
of a single investor’s state prices:
¤
£
Et+1,η φL+1,t+2 × (Sn,t+2 + δ n,t+2 )
;
(12)
Sn,t+1,η =
φL+1,t+1,η
Sn,T ≡ 0 , 1 ≤ n ≤ N , 1 ≤ l ≤ L + 1
and the recursion (10) can equivalently be written:
¤
£
Et+1,η φL+1,t+2 × (Fl,t+2 + cl,t+2 − el,t+2 )
, Fl,T ≡ 0 , 1 ≤ l ≤ L + 1 .
Fl,t+1,η =
φL+1,t+1,η

(13)

Then, summing this last equation over 1 ≤ l ≤ L + 1 yields:
#
"
L+1
L+1
L+1
X
X
X
φL+1,t+1,η
Fl,t+1,η = Et+1,η φL+1,t+2 × (
Fl,t+2 +
(cl,t+2 − el,t+2 )) ,
l=1

l=1

l=1

which, because of the aggregate resource restrictions holding at all future times t + 2, . . . , T , implies
by backward induction:
L+1
X
Fl,t+1,η = 0 .
(14)
l=1

A second result will resolve a diﬃculty with the system written so far. It contains more equations
(2 × (L + 1) × Kt,ξ + L × N + Kt,ξ ) than unknowns (2 × (L + 1) × Kt,ξ + (L + 1) × N ), which is a
diﬀerence of Kt,ξ − N . However, we can show that:
Lemma 1: Kt,ξ − N equations of the second group of (8) are redundant.
15

An example of a Negishi map is provided below as Figure 4, bottom panel.

10

To prove this, let us separate the states of nature η = 1, . . . , Kt,ξ into two subsets: one subset of
N states on the one hand and the remaining Kt,ξ − N on the other. Summing over l the equations
of the second group of (8) written for the first subset of states only, we get:
L+1
X

cl,t+1,η +

l=1

L+1
X

Fl,t+1,η =

l=1

L+1
X

el,t+1,η +

l=1

L+1
X
l=1

θl,t,ξ · (St+1,η + δ t+1,η ),

η ∈ a subset of N states .

By virtue of the aggregate-resource equations of (8), the first term of the left-hand side is equal
to the first term in the right-hand side. Invoking (14) the second term in the right-hand side must
vanish. We have made all the assumptions that guarantee that an equilibrium exists generically.
Under the same assumptions, there exists a choice of subset of states such that the N × N matrix
{(St+1,η + δ t+1,η ) ; η ∈ a subset of N states} is of full-rank generically. Therefore, except at most
at isolated points of the dataset {Wl,0 , el , δ n ; 1 ≤ l ≤ L + 1 , 1 ≤ n ≤ N }, one must have:
L+1
X

θl,t,n = 0 ,

1 ≤ n ≤ N,

l=1

which means that:

(15)

Theorem 2: When the equilibrium defined as in Definition 1 exists and there exists a choice of
subset of states such that the N × N matrix
{(St+1,η + δ t+1,η ) , η ∈ a subset of N states}
is of full-rank, financial markets clear.
If so, the second subset of equations in (8), summed over l, gives:
L+1
X
l=1

cl,t+1,η +

L+1
X

Fl,t+1,η =

l=1

L+1
X

el,t+1,η ,

l=1

(16)

η ∈ complement subset of Kt,ξ − N states .

Again, however, because of the aggregate-resource equations and (14), the above Kt,ξ −N equations
are automatically satisfied and are therefore redundant, which completes the abbreviated proof of
Lemma 1.16
In what follows, we remove the Kt,ξ − N redundant equations from the set of equations (8).
The most straightforward way to do that is to remove from it Kt,ξ flow budget constraints, keeping
only the equations written for investors 1 ≤ l ≤ L, which automatically causes the N unknowns
θL+1,t,n to disappear entirely from the system, since they appeared only in the equations pertaining
to l = L + 1. In fact, if the flow budget constraints for investors 1 ≤ l ≤ L are satisfied for some
choice of the portfolios θl,t,n , 1 ≤ n ≤ N , then, as a consequence of the relation (16), the flow
budget constraints for investor L + 1 are automatically satisfied with
θL+1,t,n = −

L
X

θl,t,n ,

l=1

16

1≤n≤N.

If the N × N matrix {(St+1,η + δ t+1,η ); η ∈ a subset of N states} were singular, we could not prove that marketclearing result (15) holds, because the markets for fully substitutable assets could spill into each other. But we could
still prove that there are N − Kt,ξ redundant equations in the overall system. See a more detailed proof in Appendix
4.

11

On net, we have reduced the number of equations by Kt,ξ and the number of unknowns by N,
thereby reestablishing balance.
Removing the redundant equations, we conclude that:
Theorem 3: A price process S, consumption plans cl , trading strategies θl and state prices φl , for
1 ≤ l ≤ L + 1 constitute an equilibrium if and only if they solve the system
Consumption choice:
0
Ul,t+1,η
(cl,t+1,η ) = φl,t+1,η , 1 ≤ l ≤ L + 1 , η ∈ Fξ,1 ,

Flow budget constraint or “marketability” condition:
cl,t+1,η + Fl,t+1,η = el,t+1,η + θl,t,ξ · (St+1,η + δ t+1,η ) , 1 ≤ l ≤ L , η ∈ Fξ,1 ,
“Kernel ”condition:
£
£
¤
¤
Et,ξ φl,t+1 × (Sn,t+1 + δ n,t+1 )
Et,ξ φL+1,t+1 × (Sn,t+1 + δ n,t+1 )
=
,
φl,t
φL+1,t

(17)

1 ≤ n ≤ N , 1 ≤ l ≤ L,
Aggregate-resource constraint:
L+1
L+1
X
X
cl,t+1,η =
el,t+1,η , η ∈ Fξ,1 ,
l=1

l=1

at all t and all ξ.
Since wealth in our approach is not a state variable, there has been no need to limit the positions
taken by agents to guarantee that each of them will have enough wealth to continue trading.17 Since
the equation system is linear in the portfolio choice θl and since that choice is unconstrained, θl
can be eliminated from the equation system, reducing the number of unknowns and the number
of equations by N × (L + 1) . If the market were complete, i.e., N = Kt,ξ for all t and ξ, this
elimination would be suﬃcient for all flow budget constraints in (17) to disappear, leading to a
well-known separation between consumption decisions and portfolio decisions. Such is not the case
in an incomplete market.

III. A homogeneity property, a change of state variables and the interpolation
The system has a useful homogeneity property involving the current values of the endogenous
state variables φl,t,ξ , 1 ≤ l ≤ L + 1. These appear only in the kernel condition and it is obvious by
inspection that only the ratios φl,t,ξ /φL+1,t,ξ , 1 ≤ l ≤ L matter
© and not the levels ªof these variables.
The solution of the system is homogeneous of degree 0 in φl,t,ξ ; 1 ≤ l ≤ L + 1 . To carry out a
n
o
P
calculation, therefore, we can use for endogenous state variables φl,t,ξ / L+1
φ
;
1
≤
l
≤
L
0
l0 =1 l ,t,ξ
or, in fact, any other one-to-one function of these ratios.
We now choose one such function that will simplify the numerics. Define total endowment:
et,ξ ,

L+1
X
l=1

17

Compare with Schmedders, Judd and Kubler (2002).

12

el,t,ξ

and the current share of consumption of Agent l:
ωl,t,ξ ,

cl,t,ξ
,
et,ξ

1 ≤ l ≤ L.

P
Given the monotonicity of marginal utility, at any given node (t, ξ) the ratios φl,t,ξ / L+1
l0 =1 φl0 ,t,ξ ,
PL+1 0
0
which can be written equivalently as Ul,t,ξ (cl,t,ξ ) / l0 =1 Ul,t,ξ (cl,t,ξ ), are in a one-to-one relation
with the quantities ω l,t,ξ . Hence, we can use {ω l,t,ξ , 1 ≤ l ≤ L} as our endogenous state variables.
In the system (17), substitute out the state prices by means of the first-order conditions for consumption choice and introduce thereby the current shares of consumption ω:
Flow budget constraint or “marketability” condition:
cl,t+1,η + Fl,t+1,η = el,t+1,η + θl,t,ξ · (St+1,η + δ t+1,η ) , 1 ≤ l ≤ L , η ∈ Fξ,1 ,
“Kernel”condition:
h
i
0
Et,ξ Ul,t+1
(cl,t+1 ) × (Sn,t+1 + δ n,t+1 )
0
Ul,t,ξ
(ω l,t,ξ × et,ξ )

=

h
i
0
Et,ξ UL+1,t+1
(cL+1,t+1 ) × (Sn,t+1 + δ n,t+1 )
0
UL+1,t,ξ
((1 − ω l,t,ξ ) × et,ξ )

,

(18)

1 ≤ n ≤ N , 1 ≤ l ≤ L,
Aggregate-resource constraint:
L+1
X
l=1

cl,t+1,η = et+1,η , η ∈ Fξ,1 .

In this final form, at any given current node, the solution amounts to calculating future consumptions {cl,t+1,η ; 1 ≤ l ≤ L + 1, η ∈ Fξ,1 } simultaneously in all the successor nodes, for each value
of the distribution of consumption at the current node {ωl,t,ξ ; 1 ≤ l ≤ L}. The distribution of consumption in the population is our choice of endogenous state variable, which achieves recursivity.
We conjecture that the solution of this system always exists but we have no proof as yet. Below
(Subsection A), we illustrate on an example the geometry of this system.
©The functions Sn,t,ξªand Fl,t,ξ to be carried backward are themselves homogeneous of degree 0
in φl,t,ξ ; 1 ≤ l ≤ L + 1 and can be expressed as functions of the variables {ω l,t,ξ ; 1 ≤ l ≤ L}. The
great numerical benefit of this choice of variables is that all variables and function values remain
bounded and continuous over the entire closed interval [0, 1]L . Intuitively, this follows from the
fact that the distribution of consumption at date t + 1 is not very far from the distribution of
consumption at date t.
After the system (18) is solved at time t at node ξ, the functions corresponding to that node
are calculated point by point by the formulae (obtained from (12) and (13)):
Sn,t,ξ =

0
Et,ξ [UL+1,t+1
(cL+1,t+1 )×(Sn,t+1 +δn,t+1 )]
φL+1,t,ξ

Sn,T ≡ 0 ,
Fl,t,ξ =

,

(19)

1 ≤ l ≤ L + 1,

1≤n≤N,

0
Et,ξ [UL+1,t+1
(cL+1,t+1 )×(Fl,t+1 +cl,t+1 −el,t+1 )]
φL+1,t,ξ

Fl,T ≡ 0 ,

0 ≤ t ≤ T − 1, 1 ≤ n ≤ N ,

1 ≤ l ≤ L +1,
13

,

0 ≤ t ≤ T − 1, 1 ≤ l ≤ L + 1,

(20)

and interpolated over {ωl,t,ξ ∈ [0, 1]; 1 ≤ l ≤ L}.
We have now formulated the system in a consumption-recursive way, in the following sense of
the term:
Definition 2: A consumption-recursive equilibrium for an economy is a set of functions Sn,t,ξ (ω)
and Fl,t,ξ (ω) defined over ω ∈ [0, 1]L such that Equations (18), (19) and (20) are satisfied
Interpolations of the functions are implemented using the Interpolation command of Mathematica. The command generates InterpolatingFunctions in which divided diﬀerences are used
to construct local Lagrange interpolating polynomials of order 3. Given boundedness, these work
well when there are just two agents in the economy.18
InterpolatingFunctions provide approximate values that are valid over a Domain. In our
codes, we take measures to extend the domain to the entire interval [0, 1]. Since we have assumed
that endowment streams only take strictly positive values, so that each agent could live alone, it is
in principle possible to obtain the solution at ω = 0, 1 simply by considering the cases where they
live in autarky. In the more general case in which endowments can take zero values, a population
may not be able to live alone.19 In order to handle these more general cases, we use limits. As
ω l → 0 or 1, we estimate the limit of the set of functions that are carried backward by fitting a
third-degree polynomials to the last four points of a grid of values of ω l and refining the end part
of the grid until the estimate no longer changes.
More specifically, we consider the solution of the equation system of all nodes of time T − 1 (at
which point the equations contain zero values for Fl,t+1,η and Sn,t+1,η ). We start with an evenly
spaced grid for ωl of one hundred points covering [0, 1] , obtaining the solution of the system for
each of the hundred points.20 Then we gradually add points by successively subdividing the last
two segments of the grid near the edges and solving the system again over these points, until the
estimates of the limits for all nodes for all functions to be iterated remain within bounds set by
a PrecisionGoal and an AccuracyGoal. When these goals are set at 10−20 , the grid typically
accumulates ten to twenty additional points above 99/100 and below 1/100.
The same grid is then used repeatedly at all points in time. Once the grid is set up, calculation
time is then proportional to the number of nodes.

IV. Examples of the Basak-and-Cuoco variety
A. The Basak-and-Cuoco (1998) equilibrium
Our first example21 application is the simplest one, because it requires only the backward
induction of one function Fl,t,ξ . No functions Sn,t,ξ for asset prices need to be carried backward.
We consider an economy in which there are two groups of agents.22 Agents of Group 1 receive an
endowment stream e which follows a geometric Brownian motion. We capture that endowment with
18
If there were more agents and, therefore, more endogenous state variables to interpolate over, one would use the
methods of Lyasoﬀ (2008).
19
See Subsection IV-A below.
20
In calculating the solution at each point, we use a “predictor” based on the four previously calculated points, to
provide the root-finding routine with an excellent initial solution.
21
The Mathematica code for this example is available to the referee and to the reader.
22
L = 1.

14

a re-combining binomial tree with fixed drift and volatility as is done in Cox, Ross and Rubinstein
(1979).23 We set the transition probabilities π at 12 . Agents of Group 2 receive no endowment stream
but they are able to consume because they start their lives with some initial financial claims on
Agents of Category 1:

W2,0 = β > 0
W1,0 = −β
The market is incomplete; the only traded security is a one-period riskless one.
This economy is formally identical to the limited-participation economy of Basak and Cuoco
(1998), except for a small diﬀerence in interpretation. In their interpretation, Group 1 is endowed
with the risky security called “equity” with dividend e. Group 1 has access to both securities,
whereas Group 2 has access to the riskless security only.
In their setup, however, the risky security is eﬀectively redundant since a group of identical
agents (those of Group 1) are the only ones having access to it. No trading of it actually takes place
at any time. In Basak and Cuoco, the security is nonetheless “held”, but only because agents of
Group 1 are endowed with it.24 We can just as well consider this economy as an example of an
incomplete-market economy.
Basak and Cuoco (1998) calculate analytically the equilibrium market prices of risk for the
special case in which Group 2 has logarithmic utility and receives no endowment. We show below the
generalization by our binomial method to any pair of power utility functions. The utility function
of Agent l (l = 1, 2) for time t is: ρt (cl,t )γ l /γ l . In the tradition of Cox, Ross and Rubinstein (1979),
we call η = u, d (for “up” and “down”) the two successor nodes of a given node ξ of time t, with
increments in e that mimick the geometric Brownian motion.
In this example, the equations system (18) particularizes to the following:25
Flow budget constraint or “marketability” condition:
c2,t+1,u + F2,t+1,u = θ2,t,ξ ; c2,t+1,d + F2,t+1,d = θ2,t,ξ ,
“Kernel”condition:
γ 1 −1
1
+ 12 (c1,t+1,d )γ 1 −1
2 (c1,t+1,u )
(ω × et,ξ )γ 1 −1

=

1
2

(c2,t+1,u )γ 2 −1 + 12 (c2,t+1,d )γ 2 −1
((1 − ω) × et,ξ )γ 2 −1

,

(21)

Aggregate-resource constraint:
c1,t+1,u + c2,t+1,u = et+1,u , c1,t+1,d + c2,t+1,d = et+1,d ,
where the future wealths F2,t+1,u and F2,t+1,d are interpolated from the recursive financial-wealth
formula (13) for Group 2. The geometry of this equation system is illustrated in Figure 3. It
indicates strongly that the solution of the system exists and is unique. Once the solution for
23

Or more precisely in Jarrow and Rudd (1983).
The initial distribution of wealth determines whether an equilibrium exists: β must be positive, but not so large
that agents of Group 1 could never repay their initial short position in the bond.
25
As in (18), we have considered the flow budget constraints of one agent (in this case, Agent 1) on the grounds
that they are redundant.
24

15

{θ2,t,ξ , c2,t+1,u , c2,t+1,d } is found for a value of ω, the financial-wealth is calculated:
½ h
i
1
ρ
γ 2 −1
(c
F2,t,ξ =
)
×
(c
+
F
)
2,t+1,u
2,t+1,u
2,t+1,u
((1 − ω) × et,ξ )γ 2 −1 2
i¾
1h
γ 2 −1
× (c2,t+1,d + F2,t+1,d )
.
+ (c2,t+1,d )
2

(22)

The values of F2,t,ξ are interpolated over ω as a preparation for the next time-step.
[Figure 3 about here.]
Figure 4, the top panel of which is analogous to Figure 2 in Basak and Cuoco (1998), shows the
price of risk or Sharpe ratio on the equity market against the time-0 distribution of consumption,26
Group 1 having a risk aversion of 2 and Group 2 (Non Stockholders) a risk aversion of 6 and other
parameters corresponding to the calibration of Mehra and Prescott (1985) as cited by Basak and
Cuoco (1998). With these risk aversions, the target empirical level of 0.4 is not easily attained.
The bottom panel of the figure shows the Negishi map, the relationship between time-0 wealth and
the time-0 distribution of consumption.
[Figure 4 about here.]
For a calculation over seven points in time (T = 6; t = 0, 1, 2, . . . , 6), setting up the grid and the
time-(T − 1) calculation requires 67 seconds and for the remaining periods the calculation requires
64 seconds in total on the Intel Centrino dual processor of a Lenovo 3000V200 laptop computer. It
would be beyond the scope of the present paper to compare for speed and eﬃcacy our algorithm
with procedures proposed by previous authors.

B. The “reverse” Basak-Cuoco equilibrium
Our second example application is slightly more involved than the first one because it requires
the simultaneous backward induction of both functions F and S. For purposes of illustration, we
reverse the example of the previous subsection and consider an incomplete market in which there is
no riskless asset available for trade. Instead, the risky equity alone, which pays δ = e, is available
for trade. Equity has a price S. The equations system (18) for that case is:
Flow budget constraint or “marketability” condition:
c2,t+1,u + F2,t+1,u = θ2,t,ξ × (et+1,u + St+1,u ) ,
c2,t+1,d + F2,t+1,d = θ2,t,ξ × (et+1,d + St+1,d ) ;

“Kernel ”condition:
26

S being the quoted price for equity, the market price of risk on the equity market is:
µ

¶

µ

1 φ2,t+1,u + 1 φ2,t+1,d × 1 δt+1,u +St+1,u + 1 δt+1,d +St+1,d
2 φ2,t,ξ
2 φ2,t,ξ
2
Ft,ξ
2
Ft,ξ
µ
¶
1 δt+1,u +St+1,u − δt+1,d +St+1,d
2
Ft,ξ
Ft,ξ

=

hφ

1,t+1,d

φ1,t,ξ

−

³

¶

−1

=−

1 φ2,t+1,u
2 φ2,t,ξ

16

+

hφ

1,t+1,u

φ1,t,ξ

1 φ2,t+1,d
2 φ2,t,ξ

−

´i

³

1 φ2,t+1,u
2 φ2,t,ξ

+

1 φ2,t+1,d
2 φ2,t,ξ

´i

1
2

(c2,t+1,u )γ 2 −1 × (et+1,u + St+1,u ) + 12 (c2,t+1,d )γ 2 −1 × (et+1,d + St+1,d )
=

1
2

((1 − ω t ) × et )γ 2 −1

(c1,t+1,u )γ 1 −1 × (et+1,u + St+1,u ) + 12 (c1,t+1,d )γ 1 −1 × (et+1,d + St+1,d )
(ωt × et )γ 1 −1

Aggregate-resource constraint:
c1,t+1,u + c2,t+1,u = et+1,u , c1,t+1,d + c2,t+1,d = et+1,d ,
where the future wealths F2,t+1,u and F2,t+1,d are obtained again from the interpolated recursive
financial-wealth formula for Group 2 applied at time τ = t + 1 and the future prices of equity St+1,u
and St+1,d are obtained from the interpolated recursive price formula (19).
As an illustration of the solution, we display in Figure 5 the Sharpe ratio (market price of risk
in the equity market) as a function of Group 2’s (the constrained group) share of consumption.
The result is a “negative-equity premium” configuration.
[Figure 5 about here.]

C. Wu’s example of buy-and-hold investors
Next, we examine an example that involves two endogenous state variables. Tao Wu (2006)
has constructed an equilibrium in an economy that is similar to that of our first Basak-Cuoco
example with the diﬀerence that agents of Group 2 are no longer prevented from accessing the
equity market. Instead, they access it in a mechanical way, making each period a contribution (to
their pension fund) with which equity is bought and held till the last period where they consume
the payoﬀ. The additional endogenous state variable, θ, is the fraction of equity held by the people
of Group 2. Parameter values are as in the Basak-Cuoco examples. The periodic contribution made
by Group 2 is 12% of output. We show in Figure 6 the resulting market price of risk in the equity
market (where only Group 1 trades freely and sets prices) against Group 2’s share of aggregate
consumption, at a time when their fraction of equity shares held is equal to 20%.27
[Figure 6 about here.]
In this example, the financial wealth of Group 2 and the market price of equity are interpolated
in two dimensions over the two endogenous state variables. Even though equity is not traded freely
between the two groups, the function giving its price as set by Group 1 is needed at each stage of
the backward induction to determine, for a given amount of contribution, how many new shares
Group 2 acquires. As before, we have taken great care to interpolate with precision the functions
over the entire domain [0, 1] of the endogenous variable ω, which we had so far. However, we have
allowed extrapolations over the new endogenous state variable θ; extrapolation occurs when Group
2 holds more than 100% of the equity market (with short selling by Group 1). The graphs (not
shown) of the functions against θ justify to some extent this treatment: they are practically linear
in the neighborhood of θ = 1 and beyond.
The example demonstrates that the procedure can handle more than one endogenous state
variable, although the computing burden is, of course, greatly increased.
27

Figure 6 is very similar to Figure 14 in Wu’s article, which is, however, drawn for T = 50. Wu works out an
approximation to a system of two continuous-time partial diﬀerential equations. He does not spell out the boundary
conditions he uses at the edges of the numerical domain used for his functions.

17

V. Other examples
A. Example #2 in Cuoco and He (2001) and a comment on the method
As has been mentioned in the introduction, it is possible to stack all the first-order conditions
(18) of all the nodes into one large system, add the time-0 equations (11) and then to substitute
into this system the recursions (20, 19). This huge system can conceivably be solved simultaneously
in one fell swoop. We call this approach the “global method”, as opposed to the recursive method,
for the solution of the forward-backward system.
In their paper of 2001, Cuoco and He write and solve a large system of that type.28 In their
numerical Example #6.2 (Page 289), they consider a two-period (t = 0, 1, 2; T = 2) economy with
two securities: a long-term bond (maturing at time 2) and the equity claim. The node of time 0
has three spokes. At time 1, one node has two spokes and the other two have three spokes. The
initial condition imposed is that the net financial wealth of both groups be equal to zero.
In Figure 7, we plot the solution we obtain by the recursive method for the points of our grid
that lie in a neighborhood of zero initial financial wealth. We can read from the diagram that, at
zero wealth of Group 2, the time-0 equilibrium price for the bond is 0.946, while a similar picture
for the price of equity would produce the number 2.070 and for the level of consumption of Group
2 the number 1.172, exactly as in the article (Page 291).
[Figure 7 about here.]
Admittedly, the global method, when it converges to a solution, provides a solution for a single
value of initial wealth much faster than does the recursive method. It should be pointed out,
however, that the recursive method delivers a whole set of points as in the figures above. A proper
horse race between the two methods is meaningful only in the case where a wide range of points is
required. For instance, in this example, the global solution delivered one point in 0.89 seconds. For
the full grid of 127 points, 113 seconds would be required while the recursive method delivers them
in 65 seconds. Of course, these comparisons are only indicative, as times needed to get a solution
are very dependent on starting values provided to the root-finding routine.
For the case in which the tree is binomial, we emphasize very strongly that, even when the
exogenous state variables are Markovian, the global approach does not permit the use of a recombining tree. This is because a recombining node would have a unique value of the exogenous state
variables but would correspond to two diﬀerent values of the endogenous state variables, depending
on which node the process is coming from. There is path-dependence. For this reason, the recursive
method works with great advantage compared to the global method. Because of the possibility of
recombination, there always exists a large enough number of periods T such that the number of
nodes T + 1 under recombination, multiplied by the number of grid points is less than the number
of nodes 2T under no recombination, thus allowing the recursive method to compute faster than
the global one.

B. The Heaton and Lucas (1996) example
The aim of our final illustration is to demonstrate that our technique can handle life-size applications of incomplete-market theory. For that, we use the model put together by Heaton and Lucas
28

The system in question is Equation (33) on Page 285 of Cuoco and He (2001).

18

(1996). This is an equilibrium with two classes of agents, an incomplete market, trading costs and
borrowing constraints. Here, we consider only the incomplete-market aspect. The only two assets
available are the short-term (one-period) riskless security and the equity.
Heaton and Lucas (1996) calculate the equilibrium numerically, by means of a tatonnement
algorithm described in Lucas (1994) and based on the primal program (2) of each investor and the
condition that supply equals demand in the financial market. The state variables are the portfolios
of households. It would be diﬃcult to extend their method beyond two assets. By contrast, the
complexity of our approximations depends on the number L + 1 of agents and not on the number of
securities N . Adding more securities to the economy only increases the number of “kernel-condition”
equations in the system that must be solved at each node.29
Their model is calibrated to match the U.S. economy, including idiosyncratic labor shocks
observed on panel data. The two groups of households receive dividends in accordance with their
shareholding and diﬀer only in the allocation of output to their respective labor income. Otherwise,
the households have identical, constant relative risk aversions 1− γ and discount rates ρ.
For that reason, wealth and price functions satisfy a second homogeneity property with respect
to total output, in addition to the homogeneity with respect to current state prices that we pointed
out in Section III. Total output et is then a scale variable, which can be factored out and need not
be explicitly included as an exogenous state variable. That leaves three exogenous state variables
that describe the exogenous aspects of the economy at any given time: (i) the realized rate of
growth of output, (ii) the share of output paid out as dividend, vs. wage, (iii) the share of wage bill
that is paid to Group 1, vs. Group 2. These follow an eight-state (K = 8) Markov chain, whose
transition probabilities π t,ξ,t+1,η are calibrated to U.S. data. Dividends are called δ t+1,η . Wages
paid to Group l are called el,t+1,η . We introduce one endogenous state variable ω defined as the
share of Group 1’s current (time-t) consumption in current output, as in the previous examples.
Redefining all time-(t + 1) variables to have their previous meaning except that they refer to
amounts per unit of time-t output, and calling gt,ξ,t+1,η the gross rate of growth of total output
between time t and time t + 1 (which, with previous notation, would have been et+1,η /et,ξ ), the
system can be written as follows:
Flow budget constraint or “marketability” condition:
c2,t+1,η − e2,t+1,η + gt+1,η × F2,t+1,η = θ2,t,ξ,1 + θ2,t,ξ,2 · (St+1,η + δ t+1,η ) ,

1 ≤ η ≤ 8,

“Kernel ”condition for short-lived riskless asset:
8
8
X
X
1
1
γ−1
π
×
(c
)
=
π t,ξ,t+1,η × (c2,t+1,η )γ−1
1,t+1,η
t,ξ,t+1,η
γ−1
γ−1
(ω t,ξ )
(1 − ω t,ξ )
η=1
η=1
“Kernel ”condition for equity:
8
X
1
π t,ξ,t+1,η × (c1,t+1,η )γ−1 × (δ t+1,η + gt+1,η × St+1,η )
(ωt,ξ )γ−1 η=1
=

8
X
1
π t,ξ,t+1,η × (c2,t+1,η )γ−1 × (δ t+1,η + gt+1,η × St+1,η )
(1 − ω t,ξ )γ−1 η=1

Aggregate-resource constraint:
29
Since we provide our root-finding routine with excellent predictors of the solution (see Footnote 20), the computing
time remains very short even with an increased number of unknowns.

19

L+1
X

cl,t+1,η = gt+1,η ,

l=1

1 ≤ η ≤ 8.

As usual, the undiscounted financial wealth of Group 2 and the equity price are defined recursively:
F2,t,ξ =
F2,T

≡ 0

St,ξ =
ST

8
X
ρ
π t,ξ,t+1,η × (c2,t+1,η )γ−1 × (c2,t+1,η − e2,t+1,η + gt+1,η × F2,t+1,η )
(1 − ω t,ξ )γ−1 η=1
8
X
ρ
π t,ξ,t+1,η × (c2,t+1,η )γ−1 × (δ t+1,η + gt+1,η × St+1,η )
(1 − ω t,ξ )γ−1 η=1

≡ 0

We solve the problem over four points in time (T = 3; t = 0, 1, 2, 3). The time required is 678
second to set up the grid and calculate for one period and 400 seconds for each additional period
of time.
[Figure 8 about here.]
[Figure 9 about here.]
We show in Figure 8 the equilibrium Sharpe ratios on the equity security as functions of the
share (1 − ω) of consumption of Agent 2 in Heaton and Lucas’s four “low-realized growth” states
and in Figure 9 the same in the four “high-realized growth” states. Even though, in this model,
dividends are positively correlated with output, the Sharpe ratios on equity can be negative. Here,
the specification of the behavior of state variables is such as to be able to overcome, for middleof-the-range values of the consumption share, the eﬀect of the static risk premia, which would be
positive. The eﬀect of the non-traded assets is the opposite of what would be needed to solve the
equity-premium puzzle. Although the Sharpe ratios are quite sizable, they are the ratios of two
quantities that are very small. The equity premium is minute but so is the volatility of stock returns.
Neither the “equity-premium” nor the “excess-volatiliy” puzzle is solved by this specification. That
is the reason for which Heaton and Lucas claim that debt constraints and frictions are needed to
match the moments observed in the data.

VI. Problematic examples and issues of existence
In this section, we discuss the validity of the algorithm in pathological cases. We tackle two
such cases. In the first subsection, we process an example constructed by Magill and Quinzii (1996,
Page 248) in which there is generic existence but existence fails at one isolated point of the dataset
{Wl,0 , el , δ n ; 1 ≤ l ≤ L + 1, 1 ≤ n ≤ N ). In the second subsection, we process an example
constructed by Kubler and Schmedders (2003) in which equilibrium exists but cannot be formulated
as a recursive equilibrium using wealth or existing portfolios as endogenous state variables.

20

A. Non existence of equilibrium at isolated point
The example constructed by Magill and Quinzii involves a utility function that is not time
separable: utility at one point in time depends on consumption at that point in time but also
on consumption at the previous point in time. The example, therefore, does not satisfy the set of
assumptions we have made. Nonetheless, it can be processed with our algorithm because, as we
solve for future consumption, the current period’s consumption is a state variable that we have
introduced already for other purposes, namely as an endogenous state variable of the incompletemarket equilibrium.
In this example, time belongs to {0, 1, 2}, the event tree is:
¡
¢ª
©
ξ 0 , (ξ 1 , ξ 2 ) , ξ 1,1 , ξ 1,2 , ξ 2,1 , ξ 2,2

and there are two groups of agents. The endowments eξ are:

(0, (1 + , 1 − ) , (1, 1, 1, 1)) ,
(0, (1 − , 1 + ) , (1, 1, 1, 1))
The payoﬀs δ n,ξ on the assets are:
(0, (0, 0) , (1, 0, 1, 0))

,

(0, (0, 0) , (0, 1, 0, a)) , a > 0
The utility of Group 1 is U1 (xξ ) = (xξ )α at all nodes except at node ξ 1,1 where it is equal to
(x1 )β (x1,1 )α and at node ξ 2,1 where it is equal to (x2 )β (x2,1 )α . The utility of Group 2 is U2 (xξ ) =
(xξ )α at time 2 and U2 (xξ ) = (xξ )α+β at time 1. The parameters satisfy α > 0, β > 0, α + β < 1,
−1 ≤ ≤ 1. All probabilities are set equal to 1 and utility is not discounted. Initial wealth of both
groups is equal to 0.
Magill and Quinzii show that, if a 6= 1, there exists a financial-market equilibrium whereas,
if a = 1, there exists ∗ > 0 such that if, 0 < | | < ∗ , the economy has no equilibrium. This
non-existence result applies at the point of zero initial wealth only. For all values of initial wealth
not equal to 0, equilibrium exists again by virtue of the generic existence result. The equilibrium
does not exist at that point because, at time 1, the rank of the payoﬀ matrix drops.
Figure 10 is one way to portray the output from our algorithm. It exhibits the prices of the two
securities as functions of the initial wealth of one group. Plainly, the algorithm is undeterred by
the isolated point of zero initial wealth, simply because the interpolation we perform at each node
implies that each point of a curve is obtained together with its neighboring points. Despite the non
existence of equilibrium at a specific point, our algorithm finds the equilibrium at all other points
of the economy. By contrast, a global solution in the sense of Subsection A with exactly zero initial
wealth would have found no solution at that point.30
[Figure 10 about here.]
30

DeMarzo and Eaves (1996) and Brown et al. (1996) have used a homotopy method to guarantee that the global
method will steer around the point at which the payoﬀ matrix drops rank at time 1.

21

B. Non existence of recursive equilibrium
The equilibria we have constructed are recursive in the sense that there exist state variables
(namely time, the exogenous node of the tree as exogenous variables and current consumptions or
current state prices as endogenous variables) such that all prices and decisions can be expressed time
after time as functions of these state variables. A more restrictive concept of recursive equilibrium
has been defined by Kubler and Schmedders (2002) in the context of stationary equilibria. There,
agents have an infinite horizon and the decision and price functions in a recursive equilibrium are
required to be independent of time.31
Kubler and Schmedders (Section 5.1, Page 299) construct a counter-example that shows that a
recursive equilibrium based on entering wealth as endogenous state variable may not exist. Entering
wealth in their example cannot be a suﬃcient statistic because there exist two circumstances within
one exogenous state in which wealth takes equal values but which must be distinguished from each
other because consumptions and prices diﬀer. We would like to be able to say that, under our
assumptions, it is always possible to make the equilibrium consumption-recursive, or at the very
least state-price recursive, but we are not in a position to prove that this is true. In this short
subsection, we only show that, even though the Kubler-Schmedders example equilibrium is not
wealth-recursive, it is nonetheless consumption-recursive, so that it does not constitute in any
way, shape or form a counter-example to the validity of our method, which relies on consumption
recursivity.
The counter-example involves two agents with state-dependent utility functions. At each point
in time, there are five exogenous states of nature with diﬀerent levels of endowments for each of
the two agents. There are three short-lived securities which are three elementary securities for the
first three states, each paying one unit of consumption in each of the first three states and nothing
in the other four states. The authors cleverly select the numbers for the endowments and for the
probabilities in such a way that it is optimal for the two agents in equilibrium to choose one of
two reference portfolios. Depending on whether an agent enters a point in time and a state with
Portfolio 1 or with Portfolio 2, he or she generally chooses diﬀerent values of current consumption
and assets prices are diﬀerent. When the entering portfolios are used as endogenous state variables,
the equilibrium is recursive. One of the states, namely State 1, is peculiar: if one calculates the
entering wealths of the two households based on the entering portfolios and the equilibrium prices,
one finds that the wealths are identical whether the entering portfolio is Portfolio 1 or 2. Hence,
the equilibrium is not wealth-recursive.
However, the equilibrium is consumption-recursive as well as state-price recursive: in State 1,
both agents consume 4 units of goods when the entering portfolio is Portfolio 1 (and the individualspecific state prices are 0.000977 for both agents), which is a share of consumption of 50-50 (and
a ratio of state prices equal to 1) whereas, when agents enter State 1 with Portfolio 2, Agent 1
consumes 4.712541 units and Agent 2 consumes 3.287459 units, which is a share of consumption of
58.9% for Agent 1 (state prices being 0.00043 and 0.002604 respectively, which is a ratio between
them of 0.165). The two circumstances that can occur in exogenous State 1 are, indeed, separated
using consumption shares or state price ratios as endogenous state variables, as we have suggested.
31

A stationary equilibria may or may not be the limit of a finite-horizon equilibrium as one takes the horizon date
to infinity. Our algorithm is not meant to calculate stationary equilibria and we make no claim that, even after a
large number of periods, it would find the stationary equilibria discussed in Kubler and Schmedders.

22

VII. Conclusion
The equilibrium calculation method developed here opens at least three potential avenues of
research.
The first and most immediate application will be to use the algorithms we have developed to
answer the question we raised in the introduction. It is important to find out whether incompletemarket equilibria can deliver a match between model and financial-market data. Missing-market
risks should increase risk premia and volatility and cause the distribution of wealth in the investor
population to act as a dimension of risk, separate from aggregate wealth. We are now equipped to
determine what are likely orders of magnitude of these eﬀects.
The second order of business will be to deal with equilibrium in the presence of transactions
costs. In such an equilibrium, there will be periods of time during which, and states of nature in
which no trade will take place and thus no price will prevail. It would be, therefore, impossible
to embark on a direct calculation of equilibrium by tatonnement since the form of the process for
prices, being of the intermittent kind (it is a “point process”), would be hard to specify ab initio.
Cvitanic and Karatzas (1996), Cvitanic (1997) and Kallsen and Muhle-Karbe (2007) have shown
how the dual approach can be applied to portfolio optimization under transactions costs. It can be
extended to equilibrium, because, when information arrives at each node, the dual variables, unlike
actual prices on trades, can be postulated to take values at all times and all nodes.32 As we apply
the binomial tree technique and as we progressively subdivide the time interval between nodes, it
will be fascinating to see the manner in which the intermittent process for asset prices approaches
a continuous process.
Default risk is the third application to be considered. In a complete market, all risks being
hedgeable, default can occur only when an economic agent chooses not to pay what he owes and to
suﬀer the consequences.33 In such a setting, agents default in states of nature in which they have
a lot of debt but have received a large cash flow (the “take-the-money and run” kind of default).
It is clear that reality does not fit that model: people are sometimes in situations where they
“cannot” pay, because they must maintain a survival level of consumption. These can occur only
in incomplete markets.
In the approach we have proposed, one has to recognize a number of endogenous state variable
equal to the number of agents in the economy (minus one, because of homogeneity of the value
functions). The extension to produce an approximation valid for large populations is a very serious
challenge. Krusell and Smith (1998) have provided such an approximation for the case of independent idiosyncratic risk across a totally homogeneous population: the mean of the distribution of
wealth is then a suﬃcient state variable. In more general cases, the matter will be more complex.
Within a decade, mankind will want to devote as much computing power to the large-scale
modelling of financial markets as is devoted today to the analysis of the earth’s weather and
atmosphere. We hope that our method will facilitate that undertaking.
32
33

Jouini and Kallal (2001) have already established some properties of the dual variable process.
In Alvarez and Jermann (2000), agents are constrained not to default but the idea is similar.

23

VIII. Bibliography
Alvarez, Fernando and Urban Jermann, 2000, Eﬃciency, Equilibrium and Asset Pricing with
Risk of Default,Econometrica, 68, 775-798.
Basak, Suleyman and Domenico Cuoco, 1998, An Equilibrium Model with Restricted Stock
Market Participation,Review of Financial Studies, 11, 309-341.
Bizid, Abdelhamid and Elyès Jouini, 2001, Incomplete Markets and Short-Sales Constraints:
An Equilibrium Approach,International Journal of Theoretical and Applied Finance, 4, 211-243.
Bizid, Abdelhamid and Elyès Jouini, 2005, Equilibrium Pricing in Incomplete Markets,Journal
of Financial and Quantitative Analysis, 40.
Brown, Donald J., Peter M. DeMarzo and B. Curtis Eaves, 1996, Computing Zeros of Sections
of Vector Bundles Using Homotopies and Relocalization,Mathematics of Operations Research, 21,
26-43.
Cass, David, 1984, Competitive Equilibrium with Incomplete Markets,CARESS working paper
#84-09.
Cox, John C., Stephen A. Ross, and Mark Rubinstein, 1979, Option Pricing: A Simplified
Approach,Journal of Financial Economics, 7, 229-263
Cuoco, Domenico and Hua He, 1994, Dynamic Equilibrium in Infinite-Dimensional Economies
with Incomplete Financial Markets,unpublished manuscript, University of Pennsylvania.
Cuoco, Domenico and Hua He, 2001, Dynamic Aggregation and Computation of Equilibria
in Finite-Dimensional Economies with Incomplete Financial Markets,Annals of Economics and
Finance, 2, 265-296.
Cvitanic, Jaksa, 1997, Optimal Trading under Constraints,in Financial Mathematics: Lectures
given at the 3rd session of the Centro Internationale Matematico Estudio, Runggaldier, W. and B.
Biais editors, Springer Verlag.
Cvitanic, Jaksa and Ioanis Karatzas, 1996, Hedging and Portfolio Optimization under Transactions Costs: A Martingale Approach,Mathematical Finance, 6, 133-165.
Debreu, Gérard, 1970, Economies with a Finite Set of Equilibria,Econometrica, 38, 387-392.
Debreu, Gérard, 1972, Smooth Preferences,Econometrica, 40, 603-615.
DeMarzo, Peter M. and B. Curtis Eaves, 1996, Computing Equilibria of GEI by Relocalization
on a Grassmann Manifold,Journal of Mathematical Economics, 26, 479-497.
Detemple, Jérôme and Mahadevan Sundaresan, 1999, Non Traded Asset Valuation with Portfolio Constraints: a Binomial Approach,The Review of Financial Studies, 12, 835-872.
Duﬃe, Darrell and Wayne J. Shafer, 1985, Equilibrium in Incomplete Markets: I, A Basic Model
of Generic Existence,Journal of Mathematical Economics, 14, 285-300.
Duﬃe, Darrell and Wayne J. Shafer, 1986, Equilibrium in Incomplete Markets: II, Generic
Existence in Stochastic Economies,Journal of Mathematical Economics, 15, 199-216.
Gomes, Francisco and Alexander Michaelides, 2006, Asset Pricing with Limited Risk Sharing
and Heterogeneous Agents,Review of Financial Studies, forthcoming.

24

Guvenen, Fatih, 2004, A Parsimonious Macroeconomic Model for Asset Pricing,working paper,
University of Minnesota.
Guvenen, Fatih and Burhatnettin Kuruscu, 2006, Does Market Incompleteness Matter for Asset
Prices?Journal of European Economic Association, papers and proceedings, 484-492.
He, Hua and Neil Pearson, 1991, Consumption and Portfolio Policies with Incomplete Markets
and Short-Sale Constraints: The Infinite Dimensional Case,Journal of Economic Theory, 54, 259304.
Heaton, John and Deborah Lucas, 1996, Evaluating the Eﬀects of Incomplete Markets on Risk
Sharing and Asset Pricing,Journal of Political Economy, 104, 443-487.
Heston, Stephen, Mark Lowenstein and Greg Willard, 2007, Options and Bubbles,” Review of
Financial Studies, 20, 359 - 390.
Hirsch, M. D., Michael Magill and Andreu Mas-Colell, 1990, A Geometric Approach to a Class
of Equilibrium Existence Theorems,Journal of Mathematical Economics, 19, 95-106.
Hugonnier, Julien, 2007, Bubbles and multiplicity of equilibria under portfolio constraints,working
paper, University of Lausanne.
Husseini, S. Y., Jean-Michel Lasry and Michael Magill, 1990, Existence of Equilibrium with
Incomplete Markets,Journal of Mathematical Economics, 19, 39-67.
Jarrow, Robert A. and Andrew Rudd, 1983, Option Pricing, Homewood, Ill.: Irwin.
Jouini, Elyès and Heidi Kallal, 2001, Eﬃcient Trading Strategies in the Presence of Market
Frictions,The Review of Financial Studies, 14, 343-370.
Kallsen, Jan and Johannes Muhle-Karbe, 2007, On Shadow Prices in Portfolio Optimization
with Transaction Costs,working paper, Christian-Albrecht Universität zu Kiel.
Krebs, Tom, 2004,. Non-existence of Recursive Equilibria on Compact State Spaces when
Markets are Incomplete,” Journal of Economic Theory, 115(1), 134-150.
Krueger, Dirk and Hanno Lustig, 2006, When is Market Incompleteness Irrelevant for the Price
of Aggregate Risk (and when is it not)?NBER working paper 12634.
Krusell, Per and Anthony A. Smith, 1998, Income and Wealth Heterogeneity in the Macroeconomy,Journal of Political Economy, 106, 867-896.
Kubler, Felix and Karl Schmedders, 2002, Recusrive Equilibria in Economies with Incomplete
Markets,Macroeconomic Dynamics, 6, 284-306.
Kubler, Felix and Karl Schmedders, 2003, Stationary Equilibria in Asset-Pricing Models with
Incomplete Markets and Collateral,Econometrica, 71, 1767-1795.
Ljungqvist, Lars and Thomas J. Sargent, 2000, Recursive Macroeconomic Theory, MIT Press,
Cambridge, Mass..
Lucas, Deborah, 1994, Asset Pricing with Undiversifiable Income Risk and Short Sales Constraints: Deepening the Equity Premium Puzzle,Journal of Monetary Economics, 34, 325-341.
Luenberger, David G., 1969, Optimization by Vector Space Methods, John Wiley and Sons, New
York, NY.

25

Lyasoﬀ, Andrew, 2008, Spline Cubatures for Expectations of Diﬀusion Processes and Optimal
Stopping in Higher Dimensions (with Computational Finance in View), in Mathematical Control
Theory and Finance, Springer, 265-291.
Magill, Michael and Martine Quinzii, 1996, Theory of Incomplete Markets, vol. 1,. MIT Press,
Cambridge, MA.
Magill, Michael and Wayne Shafer, 1990, Characterization of Generically Complete Real Asset
Structures,Journal of Mathematical Economics, 19, 167-194.
Magill, Michael and Wayne Shafer, 1991, Incomplete Markets,in Handbook of Mathematical
Economics, Volume IV, W. Hildenbrand and H. Sonnenschein, editors, Elsevier Science Publishers.
Marcet, Albert and Kenneth J. Singleton, 1991, Equilibrium Asset Prices and Savings of Heterogeneous Agents in the Presence of Incomplete Markets and Portfolio Constraints,working paper,
Universitat Pompeu Fabra.
Mehra, Rajnish and Edward C.. Prescott, 1985, The Equity Premium: A Puzzle,. Journal of
Monetary Economics, 15, 145-161.
Karl Schmedders, Kenneth L. Judd and Felix Kubler, 2002, A Solution Method for Incomplete
Asset Markets with Heterogeneous Agents,working paper, Universität Zürich.
Wu, Tao, 2006, An Equilibrium Model with Buy and Hold Investors,working paper, State
University of New York at Buﬀalo.

26

Appendix 1: The event tree
There is a finite time-horizon T > 0 and a finite set Σ which comprises all uncertain states of
the economy. The process of revealing the true state of the economy is modeled by a tree-structure,
defined as a finite chain of successive partitions of the set Σ:
F = {Ft ; t = 0, 1, . . . , T } ,
so that F0 = {Σ}, FT = {{σ}; σ ∈ Σ} and Ft+1 is a subdivision of Ft , 0 6 t < T , in the sense
that for every ξ ∈ Ft+1 there is a (necessarily unique) η ∈ Ft , called the “predecessor” of ξ and
denoted by ξ − , which has the property η ⊇ ξ. We set formally Σ− = ∅. With a slight abuse of
the terminology we refer to the information sets ξ ∈ Ft as “states of the economy” observed during
time t. The information sets ξ ∈ Ft will be identified with the time-t nodes on the tree in the
obvious way. A random sequence or a process is any time-dependent sequence of maps
ft : Σ 7→ E ⊆ Rn , t = 0, 1, . . . , T.
The process f is said to be consistent with (or adapted to) the tree (Σ, F) if the map ft (·) is constant
on every set ξ ∈ Ft , for any 0 6 t 6 T . When this property holds it makes sense to write ft (ξ),
ξ ∈ Ft , instead of ft (σ), σ ∈ Σ.
Given any information set ξ ∈ Ft , we denote by Fξ the chain of partitions of the set ξ which is
induced by F. This chain of partitions is defined by Ft,ξ,τ , {η ∈ Ft+τ ; η ⊆ ξ}, τ = 0, 1, . . . , T − t.
Plainly, (ξ, Fξ ) denotes the event sub-tree (of (Σ, F)) which starts from the node ξ. We have by
definition F0,ξ = {ξ} and FΣ,t = Ft , 0 6 t 6 T . The elements of F1,ξ are known as the “successors”
of the node ξ and we set Fσ,1 = ∅ for any σ ∈ Σ, i.e., the successors of the nodes at the last time
point in time form an empty set. The number of immediate successors of the node ξ ∈ Ft we
denote by Kt,ξ , #(Fξ,1 ), 0 ≤ t < T . The (discrete) state-space Σ is endowed with an objective
probability measure
X
π(σ) = 1
π(σ) ∈]0, 1], σ ∈ Σ,
σ∈Σ

Since the set σ is finite and any non-empty set has a strictly positive π-measure, “almost everywhere” is the same as “everywhere”.

The space of random sequences ft+τ : ξ 7→ E, 0 6 τ 6 T − τ which are defined on ξ, take values
in the set E ⊆ Rn and are adapted to the tree (ξ, Fξ ) (in the sense that ft+τ is constant on every
set η ∈ Fξ,t+τ ) is denoted by t (ξ, Fξ ; E).
Appendix 2: The dynamic programming principle holds
Theorem 4: Suppose that agent l, 1 ≤ l ≤ L + 1, can choose a feasible consumption plan
cl ∈ 0 (Σ, F; R++ ), financed by his initial wealth Wl,0 and by his choice of a trading strategy
θl ∈ 0 (Σ, F; RN ), so that cl attains agent-l’s objective, i.e., one has Vl,0 (Wl,0 ) = Jl,0 (cl ). Then, for
any 0 < t 6 T , the consumption plan {cl,t , cl,t+1 , . . . , cl,T } can be financed (starting from time t) by
the trading strategy {θl,t , θl,t+1 , . . . , θl,T } and the entering wealth (for time t)
Wl,t,ξ = θl,t−1,ξ− · (St,ξ + δ t,ξ )
and one has
Vl,t,ξ (Wl,t,ξ ) = Ul,t (cl,t ) + Et,ξ [Vl,t+1 [θl,t · (St+1 + δ t+1 )]] .
27

Proof. The very definition of the function Vl,t,ξ implies that for every consumption plan cl that is
feasible for the entering wealth w, one must have
Vl,t,ξ (w) ≥ Jl,t,ξ (cl ) ,

cl ∈ Bl,t,ξ (w) .

Suppose now that there is a consumption plan c̄l ∈ t (ξ, Fξ ; R++ ) that is feasible for the entering
wealth w = Wl,t,ξ and maximizes investor l’s goal at time t < T (in state ξ) in the sense that
Vl,t,ξ (Wl,t,ξ ) = Jl,t,ξ (c̄l ) .

(23)

Assuming that the trading strategy θ̄l ∈ t (ξ, Fξ ; RN
+ ) can finance c̄l (together with Wl,t,ξ ), setting
W̄l,t+1 , θ̄l,t,ξ · (St+1 + δ t+1 ), and taking into account our assumption that π(σ) > 0 for every
σ ∈ Σ, it is easy to see that (23) is possible only if {c̄l,t+1 , . . . , c̄l,T } can be financed with W̄l,t+1
and {θ̄l,t+1 , . . . , θ̄l,T }, and, furthermore,
Vl,t+1,η (W̄l,t+1 ) = Jl,t+1,η ({c̄l,t+1 , . . . , c̄l,T }) ,

∀ η ∈ Fξ,1 .

In particular, one must have
¤
£
Vl,t,ξ (Wl,t,ξ ) = Ul,t,ξ (c̄l,t,ξ ) + Et,ξ Vl,t+1 (W̄l,t+1 ) ,
where W̄l,t+1 = θ̄l,t,ξ · (St+1 + δ t+1 ) .

(24)

Notice that the above relations become trivial when t = T because at the last point in time investor
l maximizes his utility only if he consumes his entire endowment and entering wealth, so that one
must have c̄l,T = el,T + W̄l,T and
Vl,T (W̄l,t ) = Ul,t (c̄l,T ) ≡ Ul,t (el,T + W̄l,T ).

(25)

Appendix 3: Proof of Theorem 1
Proof. Since the left side of the only constraint in (2) is a linear function of (x, y) ∈ R++ × RN with
gradient (treated as a vector column) ∇(x + y · St ) = {1, St } ∈ R1+N , the first order conditions (3)
imply the following relation
(26)
∇Gl,t (cl,t , θl,t ) = φl,t × {1, St }.
Consider next the quantities cl,t , θl,t and φl,t as functions of the entering wealth Wl,t , which are
defined implicitly from (3) (we assume that θl,T = 0). After diﬀerentiating both sides in (26) we
get
∇2 Gl,t [cl,t (Wl,t ), θl,t (Wl,t )] · {cl,t (Wl,t ), θl,t (Wl,t )} = φl,t (Wl,t ) × {1, St },
and this implies that
© 0
ª|
©
ª
cl,t (Wl,t ), θ0l,t (Wl,t ) · ∇2 Gl,t [cl,t (Wl,t ), θl,t (Wl,t )] · c0l,t (Wl,t ), θ0l,t (Wl,t )
¡
¢
= φ0l,t (Wl,t ) × c0l,t (Wl,t ) + St · θ0l,t (Wl,t ) = φl,t (Wl,t ),

(27)

where we have used the identity

c0l,t (Wl,t ) + θ0l,t (Wl,t ) · St = 1 ,
28

(28)

which is obtained by diﬀerentiating both sides of the constraint
cl,t (Wl,t ) + θl,t (Wl,t ) · St = el,t + Wl,t .
For some fixed 1 ≤ l ≤ L + 1, consider the entire system of first order conditions (5) at all nodes
ξ ∈ Ft , 0 ≤ t ≤ T . It is clear from (25) that the value function Vl,T (·) is strictly concave in any state
σ ∈ Σ, i.e., all value functions Vl,T,σ (·), σ ∈ Σ, are strictly concave. Now suppose that for some
0 ≤ t < T one can claim that the value functions Vl,t+1,η (·) are strictly concave, for all possible
choices of η ∈ Fξ,1 and ξ ∈ Ft . Then the function
R++ × RM 3 (x, y) −→ Gl,t (x, y) ∈ R,
which was defined in (2), also must be strictly concave in state ξ ∈ Ft . Since the security prices are
non-negative, (28) implies that the vector
© 0
ª
cl,t (Wt ), θ0l,t (Wt ) ∈ R1+N ,

cannot vanish. In conjunction with the strict concavity of Gl,t (·, ·), (27) and (4) imply that in state
ξ ∈ Ft one must have
00
(Wt ) = φl,t (Wt ) < 0.
Vl,t
The fact that the value functions Vl,t,ξ (·), ξ ∈ Ft , are strictly concave for any 0 ≤ t ≤ T now
follows by induction. As a result, we can claim that all functions Gl,t,ξ (·, ·) are strictly concave and
that, therefore, the first-order conditions in (3) are both necessary and suﬃcient and, furthermore,
cannot be satisfied with more than one choice for (cl , θl , φl ), 1 ≤ l ≤ L + 1. Finally, taking into
account (4), these first-order conditions can be written in the form (5).

Appendix 4: Detailed Proof of Lemma 1.
Proof. Let N < Kξ,t and suppose that the flow budget constraint (second set of equations in (8))
cl,t+1,η + Fl,t+1,η = el,t+1,η + θl,t,ξ · (St+1,η + δ t+1,η ) ,

1 ≤ l ≤ L + 1 , η ∈ Fξ,1 ,

(29)

which are linear, can be solved with respect to θl,t ∈ RN for every 1 ≤ l ≤ L + 1. As a linear
system, Equations (29) depend on l only through the right-hand sides
bl,t,η , Fl,t+1 + cl,t+1,η − el,t+1,η , η ∈ Fξ,1 , 1 ≤ l ≤ L + 1 .
If (29) has a solution θl,t ∈ RN for a fixed 1 ≤ l ≤ L + 1, the nodes in the set Fξ,1 (which are also
the equation numbers in (29)) can be labeled
o
n
Fξ,1 = η 1 , . . . , η m , η m+1 , . . . , η Kξ,t , m , Kξ,t − N ,

so that each of the quantities bl,t,ηk , 1 ≤ k ≤ m, can be expressed as a linear combination of
o
n
bl,t,ηm+j ; 1 ≤ j ≤ N

These linear combinations, and the split of the right sides of (29), depend only on the coeﬃcient
matrix, which is the same for all l (there is one vector column associated with every η ∈ Fξ,1 ):
{(St+1 + δ t+1,η ) ; η ∈ Fξ,1 }
29

Thus, one can find a matrix
{ak,j ; 1 ≤ k ≤ m , 1 ≤ j ≤ N }
such that one can write for all 1 ≤ l ≤ L + 1:
bl,t,ηk =

N
X
j=1

ak,j bj,t,ηm+j , 1 ≤ k ≤ m .

(30)

In conjunction with the aggregate resource constraint, the relation (14) implies that at every node
η ∈ Fξ,1 one must have
L+1
L
X
X
bl,t,η = 0 ⇐⇒ bL+1,t,η = −
bl,t,η ,
l=1

l=1

which implies that if (30) holds for every 1 ≤ l ≤ L, then it must hold also for l = L + 1, since
bL+1,t,ηk = −

L
X
l=1

bl,t,ηk = −

N
X
j=1

ak,j

L
X

bl,t,ηm+j =

N
X
j=1

l=1

ak,l bL+1,t,ηm+j , 1 ≤ k ≤ m .

If we now eliminate θl,t , 1 ≤ l ≤ L+1, from (8) and accordingly remove the flow budget constraints,
then we will be left with
N L + Kξ,t + (Kξ,t − N )L = Kξ,t (L + 1)
equations for precisely the same number of unknowns: cl,t+1,η , η ∈ Fξ,1 , 1 ≤ l ≤ L + 1.

30

endogenous state
variable:
Wl,t,Ξ , Sn,t,Ξ
Ξ
decisions:
cl,t,Ξ , Θl,t,Ξ , Φl,t,Ξ

Figure 1.

In the primal dynamic-programming formulation, when investor l is faced at

time t (in state ξ ∈ Ft ) with entering wealth Wl,t,ξ , local price vector St , and new endowment el,t,ξ ,
he computes his immediate consumption cl,t,ξ , his immediate trading strategy θl,t,ξ and his local
(in time and state of the economy) Arrow-Debreu shadow prices φl,t,ξ .

31

Ηu
endogenous state
variable:
Φl,t,Ξ

Fl,t1,u
Sn,t1,u

decisions:
Φl,t1,u , cl,t1,u

Ξ
decisions:
Θl,t,Ξ

decisions:
Φl,t1,d , cl,t1,d
Ηd

Fl,t1,d
Sn,t1,d

Figure 2. In the dual formulation, after a time shift of one equation, we now associate
with the time-t node, the choice of consumption in the successor nodes of time t + 1, given state
prices at time t. This picture should be contrasted with Figure 1.

32

co
nd
iti

on

100

M
ar

ke
t

ab
ili

ty

80

c2d

60

Equilibrium

40

Kern

el co

nditi

on

20

0
0

20

40

60

80

100

c2u

Figure 3.

The geometry of the equations system (21) is displayed here. After sub-

stituting out c1,t+1,u and c1,t+1,d from the aggregate-resource constraint: c1,t+1,u = −c2,t+1,u +
et+1,u ; c1,t+1,d = −c2,t+1,d + et+1,d , the system has two remaining equations: the marketability
condition and the kernel condition. The picture displays the loci of points at which each of these
equations holds. The picture is calculated for parameter values: T = 6, γ 2 = −5, γ 1 = −1, β =
0.999, σδ = .0357, μδ = 0.0183.and for the particular point ω =

29
50 .

The kernel condition alone is

aﬀected by the particular choice of ω (the locus shifts down as ω increases). The axes of the picture
cover the entire ranges c2,t+1,u ∈ [0, et+1,u ] , c2,t+1,d ∈ [0, et+1,d ] .

33

Market Price of Risk




1.0




Incomplete     
Complete     

0.8






0.6



0.4

0.2


             
 





0.0












































0.2












































0.4



































































0.6

















































0.8









































 

1.0

Non Stockholders' Share of Aggregate Consumption at time 0
Non Stockholders' Wealth at time 0
600

500

400

300

200

100

0
0.0

0.2

0.4

0.6

0.8

1.0

Non Stockholders' Share of Aggregate Consumption at time 0

Figure 4. Basak-Cuoco equilibrium. The top panel of this figure shows the market price of risk
applicable in the equity market where Group 1 alone “trades”. Parameter values are: T = 6, γ 2 =
−5, γ 1 = −1, β = 0.999, σδ = .0357, μδ = 0.0183. The lower of the two curves, which corresponds to
the complete-market case, is provided for comparison. The bottom panel of the figure is a Negishi
map: it shows the relationship between time-0 wealth and the time-0 distribution of consumption,
which is endogenous to wealth.

34









Market Price of Risk

0.18




Incomplete     
Complete     








0.16











0.14















0.12



0.10

0.08
























































































































                                                             
 





0.0

0.2

0.4









0.6

          

0.8

1.0

Non Stockholders' Share of Aggregate Consumption at time 0

Figure 5.

Reverse Basak-Cuoco equilibrium. This figure shows the market price of risk

applicable in the equity market where both groups trade. Parameter values are: T = 6, γ 2 =
−5, γ 1 = −1, β = 0.999, σδ = .0357, μδ = 0.0183. The higher of the two curves, which corresponds
to the complete-market case, is provided for comparison.

35


















Market Price of Risk

1.0
Incomplete     
Complete     

0.8






0.6







0.4







0.2
    
       

















          
















0.0

0.0



0.2



















 


 


 




 
 


 
 
   













0.4

0.6





































   

0.8

1.0

Group 2's Share of Aggregate Consumption at time 0

Figure 6. Wu’s buy-and-hold investors: This figure shows the market price of risk applicable
in the equity market where Group 1 only trades freely, while Group 2 invests there mechanically
in a buy and hold fashion. On the x -axis is Group 2 share of aggregate consumption. Parameter
values are: T = 3, γ 2 = −5, γ 1 = −1, β = 0.999, σδ = .0357, μδ = 0.0183. The period contribution
made by Group 2 is equal to 12% of output. The top line corresponds to a fraction of equity held by
Group 2 that is equal to 20% and the bottom line to the optimal holdings in the complete-market
situation.

36

0.956

Price of bond

0.954
0.952
0.950
0.948
0.946
0.944
0.942
0.15

0.10

0.05

0.00

0.05

Financial wealth
of investor 2

Figure 7.

Cuoco-He (2001) Example #2: The intersection of the line of points with the

y-axis gives the price of the bond corresponding to the solution of Cuoco and He (2001), Page 291.

37

Sharpe Ratio

2.0
1.5
1.0
0.5
0.0
0.5

0.0

0.2

0.4

0.6

0.8

1.0

Group 2's Share of Aggregate Consumption at time 0

Figure 8. Low-growth states: This figure shows the Sharpe ratio on the equity security when
the two groups of agents only trade the Bill and the equity, depending on the state of nature the
economy is in. This figure contains the four states of nature in which the realized growth rate is
low. On the x-axis is the fraction of output consumed by Group 2. Parameter values are as in
Heaton and Lucas (1996), Table 2, page 455.

38

2.0

Sharpe Ratio

1.5
1.0
0.5
0.0

0.0

0.2

0.4

0.6

0.8

1.0

Group 2's Share of Aggregate Consumption at time 0

Figure 9. High-growth states: This figure shows the Sharpe ratio on the equity security when
the two groups of agents only trade the Bill and the equity, depending on the state of nature the
economy is in. This figure contains the four states of nature in which the realized growth rate is
high. On the x-axis is the fraction of output consumed by Group 2. Parameter values are as in
Heaton and Lucas (1996), Table 2, page 455.

39

Prices of securities

3.0
2.5
2.0
1.5
1.0
10

5

0

Group 2's initial wealth

Figure 10. Magill’s and Quinzii’s non existence example: This figure plots the prices of the
two securites of the Magill-Quinzii non-existence example against the time-0 wealth of one group of
agents. The point at which equilibrium does not exist is the point of zero wealth. Parameter values
are a = 1, = 1/1000, α = 1/2, β = 1/3.

40

