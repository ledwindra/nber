NBER WORKING PAPER SERIES

IMPACT EVALUATION IN MATCHING MARKETS WITH GENERAL TIE-BREAKING
Atila Abdulkadiroglu
Joshua D. Angrist
Yusuke Narita
Parag A. Pathak
Working Paper 24172
http://www.nber.org/papers/w24172

NATIONAL BUREAU OF ECONOMIC RESEARCH
1050 Massachusetts Avenue
Cambridge, MA 02138
December 2017

We thank Nadiya Chadha, Sonali Murarka, Lianna Wright, and the staff of the New York City
Department of Education for answering our questions and facilitating access to data. Tim
Armstrong, Eduardo Azevedo and Whitney Newey provided helpful feedback. We‚Äôre especially
indebted to Adrian Blattner and Ignacio Rodriguez for expert research assistance and to MIT SEII
program manager Eryn Heying for invaluable administrative support. We gratefully acknowledge
funding from the Laura and John Arnold Foundation, the National Science Foundation (under
awards SES-1056325 and SES-1426541), and the WT Grant Foundation. Abdulkadiroglu and
Pathak are Scientific Advisory Board members of the Institute for Innovation in Public School
Choice. Angrist‚Äôs daughter teaches at a Boston charter school. The views expressed herein are
those of the authors and do not necessarily reflect the views of the National Bureau of Economic
Research.
NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.
¬© 2017 by Atila Abdulkadiroglu, Joshua D. Angrist, Yusuke Narita, and Parag A. Pathak. All
rights reserved. Short sections of text, not to exceed two paragraphs, may be quoted without
explicit permission provided that full credit, including ¬© notice, is given to the source.

Impact Evaluation in Matching Markets with General Tie-Breaking
Atila Abdulkadiroglu, Joshua D. Angrist, Yusuke Narita, and Parag A. Pathak
NBER Working Paper No. 24172
December 2017
JEL No. C26,D47,I20
ABSTRACT
Many centralized matching schemes incorporate a mix of random lottery and non-lottery tiebreaking. A leading example is the New York City public school district, which uses criteria like
test scores and interviews to generate applicant rankings for some schools, combined with lottery
tie-breaking at other schools. We develop methods that identify causal effects of assignment in
such settings. Our approach generalizes the standard regression discontinuity design to allow for
many running variables and treatments, some of which are randomly assigned. We show that
lottery variation generates assignment risk at non-lottery programs for applicants away from nonlottery cutoffs, while non-lottery variation randomizes applicants near cutoffs regardless of
lottery risk. These methods are applied to evaluate New York City‚Äôs school progress assessments,
which give schools letter grades as a summary measure of quality. Our estimates reveal that
although Grade A schools boost achievement, these gains emerge only for students who attend
lottery schools. Attendance at a coveted Grade A screened school, including some of the highest
performing in the district, generates no measurable effects. Evaluation methods that fail to take
advantage of both lottery and non-lottery variation miss this difference in impact.
Atila Abdulkadiroglu
Department of Economics
Duke University
213 Social Sciences Building
Durham, NC 27708
and NBER
atila.abdulkadiroglu@duke.edu
Joshua D. Angrist
Department of Economics, E52-436
MIT
77 Massachusetts Avenue
Cambridge, MA 02139
and IZA
and also NBER
angrist@mit.edu

Yusuke Narita
Yale University
37 Hillhouse Avenue
Room 38
New Haven, CT 06511
yusuke.narita@yale.edu
Parag A. Pathak
Department of Economics, E52-426
MIT
77 Massachusetts Avenue
Cambridge, MA 02139
and NBER
ppathak@mit.edu

1

Introduction

Large school districts are increasingly turning to sophisticated matching mechanisms to allocate
their seats (see, e.g., Pathak (2017)). In addition to producing fair and transparent admissions
decisions, these mechanisms offer a unique resource for research and accountability: the data they
generate can be used to construct unbiased estimates of school and sector value-added. This research dividend arises from the tie-breaking embedded in centralized matching. A commonly
used school matching scheme, deferred acceptance (DA), takes as input information on applicant
preferences and school priorities. In settings where slots are scarce, tie-breaking variables distinguish between applicants who have the same preferences and are subject to the same priorities.
Holding preferences and priorities fixed, the tie-breaker becomes a source of quasi-experimental
variation in school assignment.
Many districts break ties with a single random ‚Äúlottery number.‚Äù As we‚Äôve shown in Abdulkadiroƒülu et al. (2017a), lottery tie-breaking assigns students to schools as if in a stratified
randomized trial. That is, conditional on preferences and priorities, admission offers generated
by such systems are randomly assigned and therefore independent of potential outcomes. In
practice, however, preferences and priorities, which we call applicant type, are too high dimensional for full non-parametric conditioning to be useful. The key to a feasible DA-based research
design is the DA propensity score, defined as the probability school seats are offered to applicants
conditional on their preferences and priorities. In a match with lottery tie-breaking, conditioning
on the scalar DA propensity score is sufficient to make assignment ignorable, that is, independent of potential outcomes (Rosenbaum and Rubin, 1983). Because the DA propensity score for
a market with lottery tie-breaking depends on only a few school-level cutoffs, the score has a
distribution much coarser than the distribution of applicant types that it conditions on.
We turn here to the problem of crafting research designs from a broader class of centralized mechanisms in which the tie-breaking variable is non-random and potentially correlated
with unobserved potential outcomes. Such non-random tie-breaking fails to satisfy the equaltreatment-of-equals (ETE) property that‚Äôs key to the lottery-based research design detailed in
Abdulkadiroƒülu et al. (2017a).1 Non-random tie-breaking‚Äìsuch as used for school assignment in
Boston, Chicago, and New York City‚Äìraises important challenges for causal inference in matching
markets. Most importantly, seat assignment under non-random tie-breaking is no longer ignorable conditional on type. Exam schools, for instance, select students with higher test scores, and
these high-scoring students can be expected to do well no matter where they go to school. In regression discontinuity (RD) parlance, the running variable used to distinguish between applicants
of the same type is a source of omitted variables bias (OVB).
Other hurdles to causal inference in this setting are raised by the fact that the propensity
score in a general tie-breaking scenario depends on the unknown distribution of tie-breakers for
Non-lottery tie-breaking embedded in centralized assignment schemes has been used in studies of schools in
Chile (Hastings et al., 2013; Zimmerman, 2016), Italy (Fort et al., 2016), Ghana (Ajayi, 2014), Kenya (Lucas and
Mbiti, 2014), Norway (Kirkeboen et al., 2016), Romania (Pop-Eleches and Urquiola, 2013), Trinidad and Tobago
(Jackson, 2010, 2012; Beuermann et al., 2016), and the U.S. (Abdulkadiroƒülu et al., 2014; Dobbie and Fryer, 2014;
Barrow et al., 2016). This earlier work fails to exploit the full extent of quasi-experimental variation induced by
centralized assignment.
1

2

each applicant type. This means that the propensity score under general tie-breaking may be
no coarser than the underlying type distribution. Moreover, with the distribution of tie-breakers
unknown, we cannot easily estimate the propensity score by simulation. We solve these problems
by integrating the non-parametric RD model introduced by Hahn et al. (2001) with the largemarket model of matching markets used to study random tie-breaking in Abdulkadiroƒülu et al.
(2017a).2 Local RD strategies are shown here as driving the propensity score to a constant value
of one-half at cutoffs. This framework extends the domain of non-parametric RD identification
strategies to assignment schemes with multiple running variables, some of which may be randomly
assigned, and multiple cutoffs.
The utility of impact evaluation in matching markets with general tie-breaking is illustrated
here through an investigation of school value-added in New York City (NYC) public schools.
Specifically, we exploit school assignment variation generated by the NYC high school match,
which assigns students to seats in a DA match that integrates distinct screened school tiebreaking with a common lottery tie-breaker. Screened schools are schools that use an entrance
exam or other criteria to rank applicants instead of a lottery. The quasi-experimental assignment
variation generated by this system is used to answer questions about school quality. Our results
show that attendance at one of New York City‚Äôs ‚ÄúGrade A schools,‚Äù whether screened or lottery,
has a modest effect on achievement, though not on graduation or other outcomes. Perhaps
surprisingly, achievement gains emerge only for students who attend lottery schools; attendance
at a coveted Grade A screened school, including some of the highest performing in the district,
generates no measurable effects. Evaluation methods that fail to take advantage of both lottery
and non-lottery variation miss this important difference in impact.
The next section introduces notation for DA and explains the large market sequence used
here to derive an analytic propensity score. Section 3 presents results for markets with a single
non-random tie-breaker, generalizing the formula for the DA propensity score derived in Abdulkadiroƒülu et al. (2017a). Section 4 extends these results to markets using multiple non-identically
distributed tie-breakers. This section also introduces the idea of a local or limiting propensity
score defined in a neighborhood of school cutoffs and develops a theoretical framework that covers the mix of lottery and non-lottery tie-breakers used in the NYC school match. Section 5
applies these results to NYC‚Äôs school progress assessments. We conclude with a brief summary
and an agenda for further work.

2

DA with General Tie-breaking

A school choice problem is defined by a set of applicants, schools, and school capacities. Applicants have strict preferences over schools while schools have priorities over applicants. For
example, schools may prioritize applicants who live nearby or with currently enrolled siblings.
Let s = 0, 1, ..., S index schools, where s = 0 represents an outside option. The letter I denotes
a set of applicants, indexed by i. I may be finite or, in our large market model, a unit continuum, with applicants indexed by values in the unit interval. Seating is constrained by a capacity
Large-market results for the special case of serial dictatorship with a single non-random tie-breaker are
sketched in Abdulkadiroƒülu et al. (2017b). See Lee and Lemieux (2010) for a survey of RD methods.
2

3

vector, q = (q0 , q1 , q2 , ..., qS ), where qs is defined as the proportion of I that can be seated at
school s. We assume q0 = 1.
Applicant i‚Äôs preferences over schools constitute a partial ordering of schools, i , where a i b
means that i prefers school a to school b. Each applicant is also granted a priority at every school.
Let œÅis ‚àà {1, ..., K, ‚àû} denote applicant i‚Äôs priority at school s, where œÅis < œÅjs means school
s prioritizes i over j. For instance, œÅis = 1 might encode the fact that applicant i has sibling
priority at school s, while œÅis = 2 encodes neighborhood priority, and œÅis = 3 for everyone else.
We use œÅis = ‚àû to indicate that i is ineligible for school s. Many applicants share priorities at
a given school, in which case œÅis = œÅjs for some i 6= j. The vector œÅi = (œÅi1 , ..., œÅiS ) records
applicant i‚Äôs priorities at each school.
Applicant type is defined as Œ∏i = (i , œÅi ), that is, the combination of an applicant‚Äôs preferences
and priorities at all schools. We say that an applicant of type Œ∏ has preferences Œ∏ and priorities
œÅŒ∏ . Œò denotes the set of possible types. An assignment ¬µ = {¬µi |i ‚àà I} specifies each applicant‚Äôs
assigned school or assignment to the outside option. The proportion of applicants assigned to
school s is at most qs .
A mechanism is a set of rules determining ¬µ as a function of preferences, priorities, and
a set of tie-breaking variables. Tie-breakers can be random lottery numbers, in which case
they‚Äôre distributed independently of type, or variables like entrance exam scores, that depend on
type. The distribution of tie-breakers, which we also refer to as running variables because they
play a role like that of running variables in RD-style research designs, induces a distribution of
assignments.
The mechanisms of interest to us are stochastic, generating a probability or ‚Äúrisk‚Äù of assignment for each applicant to each school. In practice, a match is executed by a computer
program that can be run repeatedly (though may in practice be run only once). Assignment risk
is produced by repeatedly drawing tie-breakers from the running variable distributions for each
applicant and re-running the match program, fixing everything else. Randomness in a match is
therefore induced by randomness in running variables in these repeated executions.
Consider first a market with a single running variable common to all schools, denoted Ri
for applicant i. Although Ri is not necessarily a lottery number, we assume (without loss of
generality) that it‚Äôs distributed over [0, 1], with cumulative distribution function FRi . Imagine,
for example, a non-lottery tie-breaker such as a test score; this can be seen as scaled ‚Äúpercent
right.‚Äù This common support notwithstanding, running variables may be correlated with type,
so that Ri and Rj for applicants i and j are not necessarily identically or uniformly distributed,
though they‚Äôre assumed to be independent of one another.
By the law of iterated expectations, the probability a type Œ∏ applicant has a running variable
below any value r is FR (r|Œ∏) = E[FRi (r)|Œ∏i = Œ∏], where FRi (r) is FRi evaluated at r. To be concrete,
imagine again that the running variable is a test score. Suppose also that type Œ∏0 applicants do
exceptionally well on tests and therefore have running variable values drawn from a distribution
with higher mean than the score distribution for type Œ∏1 . This yields FR (r|Œ∏0 ) 6= FR (r|Œ∏1 ).
A widely-seen special case is when Ri is a lottery number drawn independently from the same
known distribution for all applicants, typically, a uniform distribution over [0,1]. In this case,
FR (r|Œ∏) = FRi (r) = r for any r ‚àà [0, 1] and for all i and Œ∏.
4

Defining DA
Most school districts and college admissions using centralized assignment employ a version of
the DA mechanism introduced by Gale and Shapley (1962). In school choice markets with a
common tie-breaker, DA works like this:
Each applicant applies to his most preferred school. Each school ranks these applicants, first by priority then by tie-breaker within priority groups, provisionally
admitting the highest-ranked applicants in this order up to its capacity. Other applicants are rejected.
Each rejected applicant applies to his next most preferred school. Each school ranks
these new applicants together with applicants admitted provisionally in the previous
round, first by priority and then by tie-breaker. From this pool, the school again
provisionally admits those ranked highest up to capacity, rejecting the rest.
The algorithm terminates when there are no new applications (some applicants may
remain unassigned).
A large body of theoretical work establishes the attractive properties of this mechanism, showing
that it‚Äôs sure to converge and is strategy-proof, and that the resulting allocations are stable in a
sense detailed in Roth and Sotomayor (1990).
Let ri be the realization of single tie-breaker Ri in a particular match. For any set of applicant
types Œò0 ‚äÇ Œò and for any number r0 ‚àà [0, 1], define the set of applicants in Œò0 with tie-breaking
numbers less than r0 to be
I(Œò0 , r0 ) = {i ‚àà I | Œ∏i ‚àà Œò0 , ri ‚â§ r0 }.
We use the shorthand notation I0 = I(Œò0 , r0 ) to denote this set and denote the fraction of
applicants in I0 by G(I0 ).
We define DA using the notation above, nesting the finite-market and continuum cases. First,
combine applicants‚Äô priority status and realized tie-breaking variable into a single number for
each school, called applicant rank at school s:
œÄis = œÅis + ri .
Since the difference between any two priorities is at least 1 and tie-breaking variables are between
0 and 1, rank is lexicographic in priority and the running variable.
DA can be described by a vector of admissions cutoffs that evolves through ‚Äúrounds‚Äù (Abdulkadiroƒülu et al., 2015; Azevedo and Leshno, 2016). We index these rounds by t and write
the vector of admissions cutoffs in round t as ct = (ct1 , ..., ctS ). Eligible applicants with rank œÄis
smaller than cts qualify for provisional admission at s in round t. Since no applicant is seated
initially, cutoffs begin as the largest possible value of an eligible applicant‚Äôs rank, K + 1, that
is, c1s = K + 1 for all s. In each round, each applicant demands his most preferred school from
among those at which he qualifies for provisional seating. Formally, the demand for seats at
school s conditional on ct is defined as:
Qs (ct ) = {i ‚àà I | œÄis ‚â§ cts and s i sÃÉ for all sÃÉ ‚àà S such that œÄisÃÉ ‚â§ ctsÃÉ }.
5

In other words, school s is demanded by applicants with rank below the cutoff at s, who prefer
s to any other school at which they‚Äôre also below the relevant cutoff.
Cutoffs evolve according to demand in each round as follows:
(
K +1
if G(Qs (ct )) < qs ,

ct+1
=
s
max x ‚àà [0, K + 1] | G({i ‚àà Qs (ct ) such that œÄis ‚â§ x}) ‚â§ qs
otherwise;
This expresses the idea that in each DA round, seats at s are provisionally offered to all who
demand a seat, including applicants provisionally offered a seat in the previous round and applicants rejected from higher ranked choices, up to school capacity. The cutoff at s in round t is
defined as the highest rank that can be provisionally seated at s in round t. If demand falls below
capacity, everyone who demands a seat gets one and the cutoff is set to the highest possible rank.
The vector of cutoffs determining a DA allocation is defined as the limit
cs = lim cts ; s = 1, ..., S.
t‚Üí‚àû

The set of applicants that are assigned school s under DA is the demand for seats at these
limiting cutoffs, that is, the set {i ‚àà Qs (c)} where c = (c1 , ..., cS ). Since cs ‚â§ K + 1, an ineligible
applicant is never assigned to school s. Azevedo and Leshno (2016) and Abdulkadiroƒülu et al.
(2017a) show that the cutoff definition of DA is valid in the sense that: (a) the necessary limits
exist for every economy, finite or continuum; (b) for every finite economy, the allocation upon
convergence matches that produced by DA as described by Gale and Shapley (1962) and the
many studies building on their work. In finite markets, cutoffs converge in a finite number of
rounds but depend on realizations of the running variable. As a result, cutoffs in finite markets
are stochastic. In our theoretical continuum market, however, cutoffs are fixed.

3

DA with a Single Non-lottery Tie-breaker

Suppose we‚Äôd like to estimate the causal effect of attendance at a particular school or group
of schools relative to alternative schools. This task is complicated by the fact that school assignments reflect applicant preferences, school priorities, and running variables, all of which are
likely to be correlated with outcomes like achievement or high school graduation. Conditional on
applicant type, however, we need only worry about OVB from the running variable. We therefore
start by exploiting the fact that OVB induced by correlation between type and the offer of a seat
at school s is controlled by conditioning on a scalar function of type, the propensity score.

3.1

Characterizing the DA Propensity Score

The propensity score is the conditional probability of assignment to s, written
ps (Œ∏) = E[Di (s)|Œ∏i = Œ∏],
where Di (s) indicates the offer of a seat at school s to applicant i.
Our characterization of ps (Œ∏) uses the notion of a marginal priority group at school s. The
marginal priority group consists of applicants for whom seats are rationed by running variables
6

when a school is over-subscribed. Formally, marginal priority, œÅs , is the integer part of the cutoff,
cs . Conditional on being rejected by all more preferred schools and on applying to school s, an
applicant is assigned s with certainty if œÅis < œÅs , that is, if he clears marginal priority. Applicants
with œÅis > œÅs have no chance of finding a seat at s. Applicants for whom œÅis = œÅs are marginal:
these applicants are seated at s when their running variable values fall below a school-specific
randomization cutoff. The randomization cutoff at school s, denoted œÑs , is the decimal part of
the cutoff at s, that is, œÑs = cs ‚àí œÅs .
These observations motivate a partition of the set of applicant types according to marginal
priorities at s. Let Œòs denote the set of applicant types who rank s and divide Œòs according to:
i) Œòns = {Œ∏ ‚àà Œòs | œÅŒ∏s > œÅs },

(never seated )

ii) Œòas = {Œ∏ ‚àà Œòs | œÅŒ∏s < œÅs },

(always seated )

iii) Œòcs = {Œ∏ ‚àà Œòs | œÅŒ∏s = œÅs }.

(conditionally seated )

The set Œòns contains applicant types who have worse-than-marginal priority at s. No one in this
group is assigned to s. Œòas contains applicant types that clear marginal priority at s. Some of
these applicants may end up seated at a school they prefer to s, but they‚Äôre assigned s for sure
if they fail to find a seat at any school they‚Äôve ranked more highly. Finally, Œòcs is the subset of
Œòs that is marginal at s, that is, the marginal priority group at s. These conditionally seated
applicants are assigned s when they‚Äôre not assigned a higher choice and have a running variable
value that clears the randomization cutoff at s.
A second key component of our score formulation captures the fact that failure to qualify at
schools other than s may truncate the distribution of running variables in the marginal priority
group for school s. To characterize the distribution of running variables among those at risk of
assignment to s, we introduce notation for the set of schools ranked above s. Applicants of type
Œ∏ view the following set of schools as better than s:
BŒ∏s = {s0 ‚àà S | s0 Œ∏ s}.
Type Œ∏‚Äôs most informative disqualification (MID) tells us how the running variable distribution among applicants to s is truncated by offers at the schools these applicants prefer to s. For
each type and school, M IDŒ∏s is defined as a function of cutoffs at schools in BŒ∏s :

M IDŒ∏s

Ô£±
Ô£¥
Ô£≤ 0
‚â°
1
Ô£¥
Ô£≥ max{œÑ | b ‚àà B and œÅ = œÅ }
b
Œ∏s
Œ∏b
b

if Œ∏ ‚àà Œònb for all b ‚àà BŒ∏s or if BŒ∏s = ‚àÖ
if Œ∏ ‚àà Œòab for some b ‚àà BŒ∏s
if Œ∏ ‚àà Œòcb for some b ‚àà BŒ∏s and Œ∏ ‚àà
/ ‚à™b‚ààBŒ∏s Œòab

M IDŒ∏s is zero when type Œ∏ applicants have worse-than-marginal priority at all higher ranked
schools: when no applicants for s can be seated at a more preferred school, there‚Äôs no running
variable truncation among those at risk of assignment to s. On the other hand, when type Œ∏
applicants are always seat in at least one school in BŒ∏s truncation is complete, and M IDŒ∏s = 1.
The third line in the definition of M IDŒ∏s reflects the fact that, among applicants for whom
œÅŒ∏b = œÅb for some b ‚àà BŒ∏s , anyone who fails to clear œÑb is surely disqualified at schools with lower
7

(less forgiving) cutoffs. For example, applicants who fail to qualify at a school with a cutoff of
0.5 fail to qualify at schools with cutoffs below 0.5. Consequently, to keep track of the truncation
induced by disqualification at all schools an applicant of type Œ∏ prefers to s, we need to record
only the most forgiving cutoff that such applicants fail to clear.
This machinery allows us to describe offers of a seat at s as determined by bounds on the
running variable. Applicant i in Œòas is seated at s provided ri > M IDŒ∏s , that is, when the
applicant fails to clear the relevant MID. Applicant i in Œòcs is seated at s if and only if œÑs > ri >
M IDŒ∏s , that is, when his lottery number clears the randomization cutoff at s but not his MID.
The DA propensity score is determined by the probability of these events.
In real-world matching markets, evaluation of cutoff-clearing probabilities is complicated by
the fact that cutoffs are stochastic and correlated with individual running variables. We therefore
turn to a large market model that expands the number of applicants and capacities to infinity
while keeping the set of types fixed. Abdulkadiroƒülu et al. (2017a) presents evidence on the
performance of this large-market approximation, showing that estimates of large market scores
effectively balance conditioning variables. In the large market model, DA cutoffs, and hence
marginal priority groups and M IDŒ∏s , are fixed. The probability of events like œÑs > ri > M IDŒ∏s
then depends only on the distribution FR (r|Œ∏) evaluated at M IDŒ∏s and œÑs . Abdulkadiroƒülu et
al. (2017a) uses this property to derive the DA score for markets with a single lottery tie-breaker,
that is, for markets in which FR (r|Œ∏) = r.
Theorem 1, below, extends this result to produce a score formula for DA using a common
running variable with an unspecified tie-breaker distribution.
Theorem 1. Consider a continuum economy populated by applicants of type Œ∏ ‚àà Œò to be assigned
to schools indexed by s ‚àà S. These schools use a single tie-breaker, Ri , distributed according to
FR (r|Œ∏) for type Œ∏. For all s and Œ∏ in this economy, we have:
Ô£±
0
if Œ∏ ‚àà Œòns
Ô£¥
Ô£¥
Ô£≤
a
1 ‚àí FR (M IDŒ∏s |Œ∏)

 if Œ∏ ‚àà Œòs
ps (Œ∏) =
Ô£¥
F (œÑ |Œ∏) ‚àí FR (M IDŒ∏s |Œ∏)
Ô£¥
Ô£≥ (1 ‚àí FR (M IDŒ∏s |Œ∏)) √ó max 0, R s
if Œ∏ ‚àà Œòcs
1 ‚àí FR (M IDŒ∏s |Œ∏)
where ps (Œ∏) = 0 when M IDŒ∏s = 1 and Œ∏ ‚àà Œòcs .
Theorem 1 is a special case of Theorem 2, discussed below and proved in Appendix A.2.2.
Because cutoffs in the large market are fixed, the risk of finding a seat at s for applicants in
Œòas is determined solely by the probability of drawing ri above the relevant MID, while risk for
applicants in Œòcs is determined by the probability of drawing ri below the cutoff at s, conditional
on failing to clear the relevant MID. The max function in the third line of the score arises from
the fact that when M IDŒ∏s exceeds the cutoff at s, failure to clear MID implies disqualification
at s.
Some school districts use a version of DA without priorities; Boston and Chicago exam
schools are leading examples. Without priorities, DA simplifies to a mechanism known as serial
dictatorship (SD), where the serial order comes from an exam score. Abdulkadiroƒülu et al.
(2017b) gives the large market score for SD with single non-lottery tie-breaker. This result is a
special case of Theorem 1, stated here as a corollary:
8

Corollary 1 (Abdulkadiroƒülu et al. (2017b)). Consider a continuum economy with no priorities,
populated by applicants of type Œ∏ ‚àà Œò, to be assigned to schools indexed by s ‚àà S. These schools
use a single tie-breaker, Ri , distributed according to FR (r|Œ∏) for type Œ∏. For all s and Œ∏ in this
economy, we have:


FR (œÑs |Œ∏) ‚àí FR (M IDŒ∏s |Œ∏)
.
ps (Œ∏) = (1 ‚àí FR (M IDŒ∏s |Œ∏)) √ó max 0,
1 ‚àí FR (M IDŒ∏s |Œ∏)
Without priorities, Œòns and Œòas are empty. The probability of assignment at s is therefore determined solely by draws from the truncated distribution of running variables remaining after
eliminating applicants seated at schools they‚Äôve ranked more highly. This is the probability on
the third line of Theorem 1.
Many applications of DA use a single uniformly distributed tie-breaker. This produces the
special case of Theorem 1 derived in Abdulkadiroƒülu et al. (2017a). Uniform tie-breaking implies
FR (r) = r, yielding the following result as an additional corollary:
Corollary 2 (Abdulkadiroƒülu et al. (2017a)). Consider a continuum economy populated by applicants of type Œ∏ ‚àà Œò, to be assigned to schools indexed by s ‚àà S. These schools use a single
tie-breaker distributed uniformly for all types, Œ∏. For all s and Œ∏ in this economy, we have:
Ô£±
if Œ∏ ‚àà Œòns
Ô£¥
Ô£¥ 0
Ô£≤
a
1 ‚àí M IDŒ∏s

 if Œ∏ ‚àà Œòs
ps (Œ∏) =
Ô£¥
œÑ ‚àí M IDŒ∏s
Ô£¥
Ô£≥ (1 ‚àí M IDŒ∏s ) √ó max 0, s
if Œ∏ ‚àà Œòcs
1 ‚àí M IDŒ∏s
where ps (Œ∏) = 0 when M IDŒ∏s = 1 and Œ∏ ‚àà Œòcs .
Estimates of the DA propensity score in this case require only an estimate of M IDŒ∏s and a
partition of types into those that are never, always, and conditionally seated. This scenario
contrasts with the scores in Theorem 1 and Corollary 1, which depend on distributions FR (œÑs |Œ∏)
and FR (M IDŒ∏s |Œ∏). We tackle the problem of estimating these unknown distributions below.

4

Mixed Multiple Tie-Breaking

Many urban school districts incorporate an assortment of tie-breaking rules in a partially or
completely centralized DA match. Some districts centralize particular sectors. For example,
selective exam schools in Boston, Chicago, and NYC use test scores to rank their applicants
in an exam-sector match. In addition to test-based tie-breaking at exam schools, NYC runs a
centralized traditional-sector match that incorporates a variety of tie-breakers for its other diverse
‚Äúscreened schools‚Äù (Abdulkadiroƒülu et al., 2005, 2009). These schools rank their applicants using
tie-breakers derived from interviews, auditions, or GPA in earlier grades, as well as test scores.
The NYC match also includes many schools that use a common lottery tie-breaker. NYC‚Äôs
combination of screened and lottery tie-breaking motivates our interest in the DA propensity
score for markets with mixed multiple tie-breakers. We show here how a complex menu of tiebreaking rules generates research designs that compare a wide range of schools. These results
9

are then applied to assess the NYC Department of Education (DOE) school assessment system,
which grades schools A-F as a measure of their quality. Our analysis estimates causal effects
of attending a Grade A school on achievement and high school graduation, thereby revealing
whether highly rated schools indeed improve outcomes for their students.
Formal analysis of multiple tie-breaking requires additional notation to keep track of different
tie-breakers. Let v ‚àà {0, 1, ..., V } index running variables and let {Sv : v ‚àà {0, 1, ..., V }} be a
partition of schools such that Sv is the set of schools using tie-breaker v. As a result, schools s
and s0 use the same tie-breaker if and only if s, s0 ‚àà Sv for some v. The random variable Riv
denotes applicant i‚Äôs running variable at schools in Sv . For any v and students i 6= j, Riv and
Rjv are assumed to be independent, though not necessarily identically distributed. Likewise, for
v 6= v 0 , running variables Riv and Riv0 are initially assumed to be independent (an assumption
relaxed shortly, below). Define function v(s) such that s ‚àà Sv(s) ; that is, v(s) is the index of
the running variable used at school s. We adopt the convention that v = 0 identifies the lottery
tie-breaker and therefore S0 constitutes the set of lottery schools. The algorithm that implements
DA in this multiple tie-breaker setting is described in Appendix A.1.3
Write Fvi (r) for the CDF of Riv evaluated at r and define
Fv (r|Œ∏) = E[Fvi (r)|Œ∏i = Œ∏].

(1)

This is the fraction of type Œ∏ applicants whose running variable for the set of schools in Sv is less
than or equal to r. We again assume running variables have support on [0, 1]. This allows us to
work with randomization cutoffs in [0, 1]. Importantly, however, the distribution of normalized
Riv remains dependent on type. In other words, normalization to the unit interval does not
simplify the conditional distribution defined in (1) to a distribution common to all types Œ∏.
With multiple tie-breakers, any truncation of running variable distributions by qualification
at higher-ranked choices is specific to Riv . We therefore define running-variable-specific MIDs
for schools in set Sv , denoted M IDv for v ‚â• 0. To this end, partition BŒ∏s into disjoint sets
denoted by
v
BŒ∏s
= BŒ∏s ‚à© Sv
for each v. This partition is used to construct tie-breaker-specific MIDs:
Ô£±
v or if B v = ‚àÖ
Ô£¥
if Œ∏ ‚àà Œònb for all b ‚àà BŒ∏s
Ô£≤ 0
Œ∏s
v
a
v
M IDŒ∏s =
1
if Œ∏ ‚àà Œòb for some b ‚àà BŒ∏s
Ô£¥
Ô£≥ max{œÑ | b ‚àà B v and œÅ = œÅ } if Œ∏ ‚àà Œòc for some b ‚àà B v and Œ∏ ‚àà
a
v Œò
/ ‚à™b‚ààBŒ∏s
b
Œ∏b
b
Œ∏s
b
Œ∏s
b
v is a key determinant of the propensity score in large markets with mixed multiple
M IDŒ∏s
tie-breakers:

Theorem 2. Consider a continuum economy populated by applicants of type Œ∏ ‚àà Œò, to be assigned
to schools indexed by s ‚àà S. These schools use a set of tie-breakers distributed independently of
Real-world tie-breakers, including those in New York City, often take the form of ranks that may be correlated
across applicants, even when the underlying criteria being ranked are independent. For example, in a sample of
two, only one can be first. This dependence vanishes as the number of applicants being ranked grows.
3

10

one another according to Fv (r|Œ∏) for type Œ∏ and v ‚àà {0, 1, ..., V }. For all s and Œ∏ in this economy,
ps (Œ∏) =
Ô£±
Ô£¥
Ô£≤ 0Q
Ô£¥
Ô£≥

v
v (1 ‚àí Fv (M IDŒ∏s |Œ∏))
Q
v
v6=v(s) (1 ‚àí Fv (M IDŒ∏s |Œ∏))

if Œ∏ ‚àà Œòns
if Œ∏ ‚àà Œòas
n
o
v(s)
√ó max 0, Fv(s) (œÑs |Œ∏) ‚àí Fv(s) (M IDŒ∏s |Œ∏)

if Œ∏ ‚àà Œòcs

v(s)

0 when v(s) = 0.
where Fv(s) (œÑs |Œ∏) = œÑs and Fv(s) (M IDŒ∏s |Œ∏) = M IDŒ∏s

Theorem 2 says that the risk of being seated at s for applicants in the always-seated set is
given by the risk of failing to find a seat at any more preferred school. Since running variables are
Q
v |Œ∏)).
assumed independent, this probability is described by a product term, v (1 ‚àí Fv (M IDŒ∏s
c
For applicants in Œòs , assignment risk multiplies the probability of not being seated at a more
preferred school by the conditional probability of drawing a school s running variable that clears
v(s)
the cutoff at s, conditional on failing to clear the relevant MID at s, denoted M IDŒ∏s . Because
running variables are assumed to be independent, it‚Äôs only Riv(s) that is truncated by failing to
win a seat at more preferred schools.4
This result generalizes Theorem 1 to cover a market with multiple tie-breakers, not all uniformly distributed or independent of type. Theorem 2 covers mixed multiple tie-breaking because
one or more of the tie-breakers indexed by v might be uniformly distributed, as in Denver‚Äôs unified district-charter school match analyzed by Abdulkadiroƒülu et al. (2017a), while allowing for
a mix of lottery and screened schools employing a variety of non-random tie-breakers, as in the
NYC match.

4.1

Local-to-cutoff Propensity Scores

The propensity score identifies the largest sample of applicants and schools for which there is
within-type variation in treatment assignment (these applicants have a score strictly between 0
and 1). Moreover, as first shown by Rosenbaum and Rubin (1983), control for the propensity
score as a function of covariates, X, eliminates X as a source of OVB. In evaluation research
using the propensity score to control for applicant type, score conditioning therefore eliminates
bias from correlation between type and potential outcomes. Score conditioning accomplishes this
while also solving a dimensionality problem: since applicants can rank many schools, there are
almost as many types as applicants. In markets with a single random tie-breaker, however, the
score given by Corollary 2 takes on far fewer values. Propensity score control therefore yields a
practical empirical research design.
Theorem 2 leaves us with three empirical challenges not encountered in earlier work using
the score to eliminate OVB in school research. First, with non-random tie-breakers like test
scores, the conditional running variable distributions, Fv (.|Œ∏), are likely to depend on Œ∏, so the
score in Theorem 2 need not have coarser support than does Œ∏. This is in spite of the fact
v . Second, F (.|Œ∏) is typically
many applicants with different values of Œ∏ share the same M IDŒ∏s
v
The cross-running variable independence assumption is relaxed in the derivation of a local propensity score,
which defines large-market risk for applicants near cutoffs.
4

11

unknown. This precludes straightforward computation of the propensity score by repeatedly
sampling from Fv (.|Œ∏) (i.e., we cannot easily compute what Abdulkadiroƒülu et al. (2017a) call a
‚Äúsimulated score‚Äù.)
Finally, while control for the propensity score eliminates confounding from type, assignments
are a function of running variables as well as type, and screened-school running variables are
likely to be correlated with potential outcomes. In other words, centralized assignment with
screened schools fails to satisfy the ETE property satisfied by lottery tie-breaking (ETE says
applicants i and j are equally likely to be offered a seat at school s when Œ∏i = Œ∏j ).
Our solution to these problems builds on Hahn et al. (2001) and a host of related work developing non-parametric RD identification strategies. These strategies eliminate running variable
confounding by looking at applicants with running variable values near cutoffs. This also turns
out to solve the problem of unknown and high-dimensional Fv (.|Œ∏). Specifically, our analysis of
the assignment risk generated by applications to screened schools focuses on subsets of applicants
with running variable values near these schools‚Äô cutoffs. This yields a local propensity score. By
contrast, assignment risk at lottery schools is global and not limited to variation near cutoffs.
Perhaps surprisingly, however, assignment risk at screened schools also generates assignment risk
at lottery schools, even for applicants who clear marginal priority at the latter.
Understanding Screened School Risk
We illustrate these ideas in a simple market with three schools, A, B, and C. A is a screened
school, while B and C are lottery schools. Applicants differ in their preferences over B and C,
but all rank A first, a prestigious selective school. Suppose applicants who prefer B over C tend
to have better outcomes. We‚Äôd like to eliminate this difference in preferences as a source of OVB
in comparisons meant to reveal causal effects of attendance at A. Likewise, students with higher
test scores are more likely to get into school A, another source of OVB in any analysis of the
effects of being offered a seat at A.
The running variable for applicant i at A is Ri . Since school A is ranked first, M IDŒ∏A = 0
for all Œ∏ (there is no truncation by qualification at higher-ranked schools). The SD propensity
score in Corollary 1 then simplifies to
pA (Œ∏) = E[1(Ri ‚â§ œÑA )|Œ∏] = FR (œÑA |Œ∏).
Although elementary, this score depends on the unknown distribution FR (œÑA |Œ∏) and is therefore
an unrestricted function of Œ∏. This global dependence on type notwithstanding, the following
proposition shows that for sets of applicants in a Œ¥-neighborhood of a fixed running variable
value, the score in this case converges to either 0, 0.5, or 1 as Œ¥ goes to zero. This result opens
the door to a non-parametric RD-style analysis of offer variation around screened school cutoffs.
The fact that the score can be simplified in this way solves two problems raised by an evaluation of school attendance. First, for any school s, conditioning on a local score makes assignment
risk locally independent of applicant type. Second, and perhaps less obviously, conditioning on
the score eliminates OVB from running variables that are correlated with potential outcomes.
To make this conditional independence statement precise, let Wi denote any applicant characteristic other than type and let W0i be the potential value of Wi that is revealed when Di (s) = 0,
12

while W1i is the potential value revealed when Di (s) = 1. These two potential values might
be the same, as for covariates (race is unchanged by school assignment) or for test scores when
assignment has no effect on achievement. In cases where they differ, as for outcomes affected by
treatment, only one is seen in a given assignment realization. We say that Wi is fixed under rerandomization if W0i = W1i for all i. Proposition 1 below shows that local-to-cutoff comparisons
make assignment risk independent of any re-randomization-invariant Wi as well as of type.
Proposition 1. Let FR (¬∑|Œ∏, w) = E[FRi (¬∑)|Œ∏i = Œ∏, Wi = w] and assume that FR (¬∑|Œ∏, w) is differentiable at œÑs with FR0 (œÑs |Œ∏, w) 6= 0 for every Œ∏ and any w. Also, define
Œªs (Œ∏, w; r, Œ¥) = E[1(Ri ‚â§ œÑs )|Œ∏i = Œ∏, Wi = w, Ri ‚àà (r ‚àí Œ¥, r + Œ¥)].
Then, for every Œ∏ and any w,
Ô£±
Ô£¥
Ô£≤ 1
ps (Œ∏, w; r) ‚â° lim Œªs (Œ∏, w; r, Œ¥) =
0.5
Ô£¥
Œ¥‚Üí0
Ô£≥ 0

if r < œÑs
if r = œÑs
if r > œÑs .

(2)

Proof. If r < œÑs , then for any Œ¥ ‚àà (0, œÑs ‚àí r) and for all Œ∏ and w, we have
Ri ‚àà (r ‚àí Œ¥, r + Œ¥) ‚áí Ri < œÑs ,
which implies
ps (Œ∏, w; r) = lim Œªs (Œ∏, w; r, Œ¥) = 1.
Œ¥‚Üí0

Similarly, if r > œÑs , then for any Œ¥ ‚àà (0, r ‚àí œÑs ), we have
Ri ‚àà (r ‚àí Œ¥, r + Œ¥) ‚áí Ri > œÑs ,
which implies
ps (Œ∏, r) = 0.
Finally, suppose r = œÑs . We have
P (r ‚àí Œ¥ < Ri ‚â§ œÑs |Œ∏i = Œ∏, Wi = w)
Œ¥‚Üí0 P (r ‚àí Œ¥ < Ri < r + Œ¥|Œ∏i = Œ∏, Wi = w)
FR (œÑs |Œ∏, w) ‚àí FR (œÑs ‚àí Œ¥|Œ∏, w)
= lim
Œ¥‚Üí0 FR (œÑs + Œ¥|Œ∏, w) ‚àí FR (œÑs ‚àí Œ¥|Œ∏, w)
{FR (œÑs |Œ∏, w) ‚àí FR (œÑs ‚àí Œ¥|Œ∏, w)}/Œ¥
= lim
Œ¥‚Üí0 {FR (œÑs + Œ¥|Œ∏, w) ‚àí FR (œÑs |Œ∏, w)}/Œ¥ + {FR (œÑs |Œ∏, w) ‚àí FR (œÑs ‚àí Œ¥|Œ∏, w)}/Œ¥
F 0 (œÑs |Œ∏, w)
= R0
= 0.5,
2FR (œÑs |Œ∏, w)

ps (Œ∏, w; r) = lim

where the last line uses FR0 (œÑs |Œ∏, w) 6= 0. This completes the proof.
Although we‚Äôve used the shorthand ps (Œ∏, w; r) for the limiting score, the right hand side of
equation (2) is unrelated to an applicant‚Äôs type or running variable (though it varies with the
choice of r). Proposition 1 therefore generates a local conditional independence relation, a result
formalized below:
13

Corollary 3 (Local Conditional Independence). Let Di (s) = 1 if and only if 1(Ri ‚â§ œÑs ). Then
lim P [Di (s) = 1|Œ∏i = Œ∏, Wi = w, Ri ‚àà (r ‚àí Œ¥, r + Œ¥), ps (Œ∏, w; r) = p] = p.

Œ¥‚Üí0

Proof. Write Œªs (Œ∏i , Wi ; r, Œ¥) and ps (Œ∏i , Wi ; r) for Œªs (Œ∏, w; r, Œ¥) and ps (Œ∏, w; r) with unspecified
conditioning arguments. For any realized ps (Œ∏i , Wi ; r), we have that
lim E[Di (s)|Œ∏i , Wi , Ri ‚àà (r ‚àí Œ¥, r + Œ¥); ps (Œ∏i , Wi ; r)]

Œ¥‚Üí0

= lim Œªs (Œ∏i , Wi ; r, Œ¥)
Œ¥‚Üí0

= ps (Œ∏i , Wi ; r).
The first equality follows from the fact that ps (Œ∏, w; r) is written as a function of Œ∏, w, and the
event Ri ‚àà (r ‚àí Œ¥, r + Œ¥), which are also in the conditioning argument. The second uses the
definition of ps (Œ∏i , Wi ; r) = p.
Proposition 1 and Corollary 3 imply that in this simple market, comparisons of applicants
just above and just below the cutoff at s identify an average causal effect of being seated at s.
This is a version of an identification result presented as Theorem 2 in Hahn et al. (2001). Here,
identification follows from the conditional independence of assignments and potential outcomes
implied by the corollary. Intuitively, this is because conditional independence means that applicants who are and are not treated have the same average counterfactual outcomes (see Rubin
(1977) for a formal statement). The Hahn et al. (2001) identification proof relies on continuity
of conditional expectations, which can be shown to be implied by our regularity conditions. As
in Hahn et al. (2001) and related theoretical work, this a limiting result, which holds only for
observations right at the cutoff. Even so, a growing body of empirical work suggests we can eliminate OVB using empirical strategies that look at data close to cutoffs. In practice, closeness can
be determined using the data-driven bandwidths derived in Imbens and Kalyanaraman (2012).

4.2

Assignment Risk with General Tie-Breaking

An analysis of general multiple tie-breaker markets requires additional notation. For any vector
of screened-school running variable values r = (rv )v=1,...,V ‚àà RV , let
N (r, Œ¥) = {y ‚àà RV : yv ‚àà (rv ‚àí Œ¥, rv + Œ¥) for all v = 1, ..., V }
denote a Œ¥-neighborhood of r for Œ¥ > 0. The probability of an offer from school s for applicants
with screened school running variables in N (r, Œ¥) is
ps (Œ∏, r, Œ¥) = E[Di (s)|Œ∏i = Œ∏, Ri ‚àà N (r, Œ¥)],
where Ri ‚â° (Riv )v=1,...,V . Note that s may be a lottery school or a screened school. Let
ps (Œ∏, r) = lim ps (Œ∏, r, Œ¥)
Œ¥‚Üí0

be the local propensity score for assignment to school s. The notation ps (Œ∏, r) reflects the fact
that this general limit score depends (coarsely) on type as well as on r.
With multiple running variables, we invoke the following regularity condition, which says that
conditional running variable distributions are differentiable and that DA cutoffs are distinct:
14

Assumption 1. (a) Fv (¬∑|Œ∏i = Œ∏, Ri ‚àà N (r, Œ¥)) is differentiable and strictly increasing for every
v, r, and Œ¥ > 0, and (b) œÑs 6= œÑs0 for any s 6= s0 .
In this setting, the local propensity score for assignment of type Œ∏ applicants to school s is
determined in part by the number of screened schools preferred to s at which these applicants
are in the marginal priority group with a tie-breaker close to randomization cutoffs. As in the
simple market described above, ‚Äúclose‚Äù in the limit means running variables right at cutoffs.
With multiple tie-breakers, we must count the number of such close encounters using runningvariable-specific ranks. For any r ‚àà RV , let
v
mŒ∏s (r) = |{b ‚àà ‚à™v‚â•1 BŒ∏s
: œÅŒ∏b = œÅb and rv(b) = œÑb }|

be the number of preferred-to-s screened schools b at which Œ∏ is marginal and where rv(b) equals
the cutoff for b. mŒ∏s (r) is the number of schools where type Œ∏ applicants with running variables
equal to the vector r face non-degenerate RD risk in the limit. As expressed in equation (2) for
the single-school case, applicants are offered seats at each such school with probability one-half.
The local propensity score depends on the position of applicants‚Äô screened-school tie-breakers
relative to screened-school cutoffs, as well as on applicant type. We therefore extend the partition
of Œòs as follows. Never seated applicants are classified in this case according to:
n
o
Œòns = (Œ∏, r) | œÅŒ∏s > œÅs or, if v(s) 6= 0, (œÅŒ∏s = œÅs and rv(s) > œÑs ) ,
(3)
where the first condition refers to applicants to lottery and screened schools whose priority œÅŒ∏s
is worse than marginal priority œÅs , and the second refers to screened-s applicants who (i) have
marginal priority at s, and (ii) whose running variable rv(s) exceeds the relevant cutoff. Always
seated applicants are classified according to:
n
o
Œòas = (Œ∏, r) | œÅŒ∏s < œÅs or, if v(s) 6= 0, (œÅŒ∏s = œÅs and rv(s) < œÑs ) ,
(4)
where the first condition refers to applicants to lottery and screened schools who clear marginal
priority œÅs , and the second refers to screened-s applicants who (i) have marginal priority at s,
and (ii) whose running variable rv(s) is below the relevant cutoff. Finally, conditionally seated
applicants are classified according to:
n
o
Œòcs = (Œ∏, r) | œÅŒ∏s = œÅs and, if v(s) 6= 0 then rv(s) = œÑs ,
(5)
where the first condition, which holds for both lottery and screened schools, refers to applicants
with marginal priority at s, and the second, which is only relevant when s is screened, identifies
cases where the running variable equals the relevant cutoff.
These preliminaries lead to a general theorem characterizing local assignment risk in markets
with mixed multiple tie-breakers. Note also that, as in the single-school example, risk is determined by the choice of evaluation point, r. Applicants in the general case are ‚Äúlocal‚Äù to a vector
of hypothesized cutoff values, r, which includes, but is not limited to, a value for the school-s
tie-breaker, rv(s) .

15

Theorem 3. Consider a continuum economy populated by applicants of type Œ∏ ‚àà Œò to be assigned to schools indexed by s ‚àà S and suppose Assumption 1 holds. If (Œ∏, r) ‚àà Œòns or (Œ∏, r) ‚àà
Œòab for some b ‚àà BŒ∏s , the local propensity score is
ps (Œ∏, r) = 0.
Otherwise,
Ô£±
m (r)
0 )
Ô£¥
IDŒ∏s
Ô£≤ 0.5 Œ∏s (1 ‚àí M

0
ps (Œ∏, r) =
0.5mŒ∏s (r) max 0, œÑs ‚àí M IDŒ∏s
Ô£¥
Ô£≥ 0.51+mŒ∏s (r) (1 ‚àí M ID0 )
Œ∏s

if (Œ∏, r) ‚àà Œòas
if (Œ∏, r) ‚àà Œòcs and v(s) = 0
if (Œ∏, r) ‚àà Œòcs and v(s) 6= 0.

(6)

This theorem starts with a scenario where applicants to s are either sure to do better or are
never seated at s and therefore face zero risk at s. In this case, we need not worry about whether
s is a screened or lottery school. In other scenarios, where applicants do not do better than
s, risk at any lottery s is determined in part by truncation of the lottery tie-breaker at more
preferred lottery schools and by possible qualification at more preferred screened schools (each
screened school qualification occurs with probability 0.5 for marginal applicants). These sources
of risk combine to produce the first line of (6). Similarly, risk at any screened s is determined
by possible qualification at more preferred schools (lottery and screened) plus an additional 0.5
risk term for those marginal at s. This produces the addition of 1 to the exponent in the third
line of equation (6).
Theorem 3 also yields a general conditional independence relation, which can be written like
that in Corollary 3, with the modification that the assignment variable, Di (s), is generated by
the general market structure covered by the theorem and
lim P [Di (s) = 1|Œ∏i = Œ∏, Wi = w, Ri ‚àà N (r, Œ¥), ps (Œ∏, w; r) = p] = ps (Œ∏, r).

Œ¥‚Üí0

(7)

The limiting score in this case depends on applicant type, though in a restricted manner. Conditional independence of school assignment and potential outcomes in turn allows us to eliminate
OVB by conditioning on ps (Œ∏, r) for applicants in a neighborhood of r.
Isolating Lottery Risk
An important implication of Theorem 3 is that application to lottery schools creates assignment
risk at screened schools. This risk is revealed by the formula for screened school propensity
scores computed for values of r away from cutoffs. In this case, mŒ∏s (r) = 0, and applicants
at all screened schools are in either Œòas or Œòns for any s that is screened. In other words, this
scenario turns screened-school tie-breakers into priorities. Consequently, the risk of assignment
to a screened school s can be simplified to
(
0
if (Œ∏, r) ‚àà Œòns or (Œ∏, r) ‚àà Œòas for some b ‚àà BŒ∏s
(8)
ps (Œ∏, r) =
0 )
v .
(1 ‚àí M IDŒ∏s
if (Œ∏, r) ‚àà Œòas and (Œ∏, r) ‚àà Œòns for all b ‚àà ‚à™v‚â•1 BŒ∏s
Lottery risk creates risk at screened schools because students who rank lottery schools ahead
0 . In
of screened schools need not qualify for lottery-based admission; this risk is 1 ‚àí M IDŒ∏s
16

this same no-screened-risk scenario, the risk of assignment to any lottery school simplifies to the
0 ,
expression in Corollary 2 of Theorem 1, with the proviso that the relevant M IDŒ∏s is M IDŒ∏s
as determined by the common lottery tie-breaker in the more general market. Thus, lottery risk
is enough to evaluate screened and unscreened schools in a market where many applicants rank
schools of both types. We explore this idea in the empirical application detailed in the next
section, while also documenting the efficiency and school-coverage gains generated by adding
screened school risk to the econometric mix.
Table 1 illustrates Theorem 3 for three applicants, highlighting the distinction between lottery
and general risk, that is, the risk created by the combination of lottery and screened school tiebreaking. The first example shows how lotteries create risk at both lottery and screened schools.
Example 1 concerns an applicant who ranks three schools, only the first of which is a lottery
school. At first choice school A, 80% of those in the marginal priority group are admitted, so
œÑA = 0.8 (lottery school cutoffs are shown in the first column). School A is ranked first, so this
0 = 0 (reported in column 3), and the propensity score characterizing lottery
applicant‚Äôs M IDŒ∏A
risk (reported in column 4) is also 0.8. There is no other source of risk at A for this applicant.
0 = 0.8 because œÑ = 0.8. But this applicant faces no risk
At second choice school B, M IDŒ∏B
A
at B because her priority places her among the never seated, that is, her type is such that she‚Äôs
in ŒònB (type classifications for lottery risk appear in column 2). Finally, at third choice school C,
0 is determined
this applicant is always seated, that is, she is in ŒòaC . Since the applicant‚Äôs M IDŒ∏C
0 = 0.2. Here too, lottery risk
by the cutoff at A, the probability of being assigned C is 1 ‚àí M IDŒ∏C
captures all the action. This example shows how lotteries create screened school risk even for
applicants with screened running variable values far from cutoffs. This presents an interesting
contrast with the RD scenarios considered by Hahn et al. (2001) and related work, where RD
methods identify treatment effects local to cutoffs.
The second example shows how non-lottery tie-breaking creates risk for applicants who face
no lottery risk. At first choice school D, a screened school, the applicant is in the marginal priority
group, and near the school D cutoff. This places the applicant in ŒòcD and generates a propensity
score of 0.5 (type classification for the general risk scenario appears in column 5). In this case,
however, the applicant faces no lottery risk because in the lottery-only scenario, he‚Äôs in ŒònD (seen
in column 2) with a running variable value assumed to be above the cutoff. Consequently, the
lottery risk propensity score for assignment to school D is zero. This applicant‚Äôs second choice,
school E, is a lottery school, but the applicant is never seated there since his priority is too
low, placing him in ŒònE . The school E propensity score is therefore zero no matter how risk is
calculated. The applicant‚Äôs third choice, school F, is also a lottery school, where the applicant
has high enough priority to be in ŒòaE . The applicant‚Äôs lottery risk at this school therefore reflects
his certainty of finding a seat at F.
When the risk generated by screening at school D is taken into account, we see that the
0 = 0 because the set of more
second applicant‚Äôs mŒ∏F (r) = |{D}| = 1. Note also that M IDŒ∏F
preferred schools contains one screened school that uses a tie-breaker other than v(s) and one
lottery school, at which the applicant was not competitive. As can be seen in column 7, the
propensity score for general risk of assignment to F is therefore:
0
pF (Œ∏, r) = 0.5mŒ∏F (r) (1 ‚àí M IDŒ∏F
) = 0.5 √ó (1 ‚àí 0) = 0.5.

17

Importantly, assignment risk at schools D and F emerge from screening in spite of the fact that
lottery risk is degenerate at each of this applicant‚Äôs three choices.
The third example shows how screening and lottery risk interact. First choice school G is
a screened school at which Applicant 3 is in ŒòcG (in the classification scheme for general risk).
Allowing for screened school risk, the school G propensity score is therefore 0.5. To isolate
lottery risk at G, we‚Äôve placed the applicant in ŒòaG , assuming his running variable at this school
is below the school G cutoff (as can be seen in column 2). When screening variables are treated
as priorities, this applicant is surely seated at G, creating a propensity score for lottery risk at
school G equal to 1.
Second choice school H is a lottery school. Looking only at lottery risk, the applicant‚Äôs
0 = 1, since he‚Äôs always seated at his first choice. The applicant‚Äôs lottery propensity score
M IDŒ∏H
is therefore zero at H and all lower-ranked choices. The propensity score for overall risk at H is
also zero because we‚Äôve assumed the applicant fails to clear marginal priority at this school. By
contrast, this applicant is in the marginal priority group at his third choice, lottery school I. The
0 = 0. The
school I lottery cutoff is 0.6. At school I, we have mŒ∏I (r) = |{G}| = 1, and M IDŒ∏I
propensity score for assignment to I is therefore:
0
) = 0.5 √ó (0.6 ‚àí 0) = 0.3.
pI (Œ∏, r) = 0.5mŒ∏I (r) (œÑI ‚àí M IDŒ∏I
0 = 0.6
Fourth choice school J is a lottery school with cutoff œÑJ = 0.8. Note that M IDŒ∏J
because œÑI = 0.6 and because I, a lottery school where the applicant is conditionally seated, is
ranked ahead of J. Screening risk at G also implies mŒ∏J (r) = |{G}| = 1. The propensity score
for general risk is therefore:
0
) = 0.5 √ó (0.8 ‚àí 0.6) = 0.1.
pJ (Œ∏, r) = 0.5mŒ∏J (r) (œÑJ ‚àí M IDŒ∏J

Finally, last-ranked school K is screened. The applicant is assumed to clear marginal priority
at K, so any risk there must be generated by rejection at higher ranked choices. Note that
0 = 0.8 because œÑ = 0.8 is the most forgiving cutoff at lottery schools ranked ahead of
M IDŒ∏K
J
K. Since mŒ∏K (r) = |{G}| = 1, the propensity score for general risk at K is therefore
0
pK (Œ∏, r) = 0.5mŒ∏K (r) (1 ‚àí M IDŒ∏K
) = 0.5 √ó (1 ‚àí 0.8) = 0.1.

This example shows how the interaction between screened and lottery risk takes an applicant
with no lottery risk and exposes him to risk at four out of the five schools he‚Äôs ranked.5
Screening in Serial Dictatorship
Some districts assign seats at some schools in a DA match with no priorities and a common
tie-breaker with an unknown distribution. We call this match screened serial dictatorship (SSD).
Abdulkadiroƒülu et al. (2017b) show that the Chicago assignment mechanism for the district‚Äôs
exam schools can be implemented as a SSD. Other SSD settings are discussed in Kirkeboen et
The examples in Table 1 have the feature that risk sums to one, because everyone is seated somewhere. This
need not be the case in real markets, where some applicants, typically those who rank few schools or rank only
schools with very limited capacity, may remain unassigned.
5

18

al. (2016); Hastings et al. (2013); Lucas and Mbiti (2014); Pop-Eleches and Urquiola (2013);
Abdulkadiroƒülu et al. (2014); Dobbie and Fryer (2014).
Under SSD, we can drop superscript v in M IDŒ∏s and write the single running variable
placeholder as the scalar r, as in Section 3. The SSD propensity score, originally presented as
Proposition 2 in Abdulkadiroƒülu et al. (2017b) as part of an analysis of CPS exam schools, can
be derived as an implication of Theorem 3.
Corollary 4. Suppose Assumption 1 holds for a continuum market assigning seats by SSD. For
all s and Œ∏ in this market,
(
0
if œÑs < M IDŒ∏s ,
ps (Œ∏, r) =
0.5 if M IDŒ∏s < œÑs ,
for r = M IDŒ∏s , œÑs , and

(
ps (Œ∏, r) =

1
0

if r ‚àà (M IDŒ∏s , œÑs ),
otherwise

for other values of r.

4.3

Estimating the Local Propensity Score

We‚Äôre interested in the asymptotic behavior of propensity score estimates based on Theorem
3. A sample analog of the local score is shown here to converge (almost surely) in market
size to the propensity score defined in Theorem 3. This explains in part why we expect the
sample analog of the local score to produce ignorable offers in real finite markets. Our empirical
application validates this conjectured good performance by showing that applicant characteristics
are balanced by offer status conditional on estimates of the local propensity score.
The asymptotic sequence for the estimated score works as follows: draw a random sample
of n applicants, i1 , i2 , ..., in , from a continuum economy with a unit mass of applicants [0, 1],
augmented with school capacities {qs }, type distribution G, and running variable distributions
(Fvi )i‚àà[0,1],v=0,1,...,V with F0i = U [0, 1] for every i. We think of i1 , i2 , ..., in as a set of applicant
identity numbers drawn from U [0, 1]. These are renumbered below, labeling i = i1 , i2 , ..., in by i =
1, 2, ..., n. For each sampled applicant i = 1, 2, ..., n and each running variable v ‚àà {0, 1, ..., V },
draw a realization from Fvi . This sampling scheme produces an empirical distribution of types
and running variables, denoted Gn . That is, Gn is the sample analog of G.
Fix the proportion of seats at school s in the sampled economy to be qs and run DA with
v , œÑ , and partition Œò by observing cutoffs cÃÇ and
these applicants and schools. Compute M IDŒ∏s
s
s
n
school assignments in this single realization. Our estimator uses these quantities to construct a
sample analogue of ps (Œ∏, r) in Theorem 3. Specifically, we partition Œòs , the set of applicants who
rank s, into sets of never, always, and conditionally seated applicants. The empirical partition
looks at bandwidths as well as cutoffs. The never seated are:

Œòns (Œ¥) = (Œ∏, r) | œÅŒ∏s > œÅs or, if v(s) 6= 0, (œÅŒ∏s = œÅs and rv(s) > œÑs + Œ¥) ,

19

which is the same as (3) except that the second condition refers to applicants who (i) are in
the marginal priority group, and (ii) whose running variable rv(s) at screened s exceeds righthand window boundary œÑs + Œ¥. A data-determined bandwidth is computed using the methods
in Imbens and Kalyanaraman (2012).
Likewise, construct the empirical set of always seated applicants by

Œòas (Œ¥) = (Œ∏, r) | œÅŒ∏s < œÅs or, if v(s) 6= 0, (œÅŒ∏s = œÅs and rv(s) ‚â§ œÑs + Œ¥) ,
which is the same as (4) except that the second condition refers to applicants who (i) are in the
marginal priority group, and (ii) whose running variable at screened s fails to clear left-hand
window boundary œÑs ‚àí Œ¥.
Finally, the empirical set of conditionally seated applicants is

Œòcs (Œ¥) = (Œ∏, r) | œÅŒ∏s = œÅs and, if v(s) 6= 0 then rv(s) ‚àà (œÑs ‚àí Œ¥, œÑs + Œ¥] ,
which is the same as (5) except that the second condition refers to applicants to screened schools
who (i) are in the marginal priority group, and (ii) whose running variable is in window (œÑs ‚àí
Œ¥, œÑs + Œ¥], that is, these applicants are near the school-s cutoff.
Our propensity score estimator is computed as follows. If (Œ∏, r) ‚àà Œòns (Œ¥n ) or (Œ∏, r) ‚àà Œòas (Œ¥n )
for some b ‚àà BŒ∏s , then
pÃÇns (Œ∏, r, Œ¥n ) = 0.
Otherwise,
Ô£±
m (r)
0 )
Ô£¥
IDŒ∏s
Ô£≤ 0.5 Œ∏s (1 ‚àí M

0
pÃÇns (Œ∏, r, Œ¥n ) =
0.5mŒ∏s (r) max 0, œÑs ‚àí M IDŒ∏s
Ô£¥
Ô£≥ 0.51+mŒ∏s (r) (1 ‚àí M ID0 )
Œ∏s

if (Œ∏, r) ‚àà Œòas (Œ¥n )
if (Œ∏, r) ‚àà Œòcs (Œ¥n ), v(s) = 0
if (Œ∏, r) ‚àà Œòcs (Œ¥n ), v(s) =
6 0

where Œ¥n is the bandwidth for a sampled economy of size n.
We consider the gap between estimator pÃÇns (Œ∏, r, Œ¥n ) and theoretical local propensity score
ps (Œ∏, r) as n grows and Œ¥n shrinks. This convergence result uses a regularity condition:
Assumption 2. (Rich support) For any s ‚àà S and priority œÅ ‚àà {1, ..., K, ‚àû} with G({i ‚àà I :
œÅis = œÅ}) > 0, we have G({i ‚àà I : œÅis = œÅ, i ranks s first}) > 0.
This assumption says that in the continuum economy, every school is ranked first by at least
some applicants in every non-empty priority group defined for that school.
In this setup, propensity scores estimated with data-dependent bandwidth converge almost
surely to the limiting local score described in Theorem 3, a result formalized below:
Theorem 4. In the asymptotic sequence described above and maintaining Assumptions 1 and 2,
the estimated local propensity score pÃÇns (Œ∏, r, Œ¥n ) is a consistent estimator of the local propensity
score ps (Œ∏, r) in the following sense: For all Œ∏ ‚àà Œò, s ‚àà S, r ‚àà [0, 1]V and Œ¥n such that Œ¥n ‚Üí 0 as
n ‚Üí ‚àû,
a.s.
|pÃÇns (Œ∏, r, Œ¥n ) ‚àí ps (Œ∏, r)| ‚àí‚Üí 0,
as n ‚Üí ‚àû. Moreover, since Œ∏ has finite support, this convergence is uniform in Œ∏.
Theorem 4 justifies our use of the formula in Theorem 3 to eliminate OVB in empirical work
estimating school attendance effects.
20

5

A Brief Report on NYC Report Cards

Since the 2003-04 school year, the NYC DOE has used DA to assign rising ninth graders to high
schools. Each applicant for a ninth grade seat can rank up to twelve programs. All traditional
public high schools participate in the match, but charter schools and New York City‚Äôs exam
schools have a separate admissions process.6
The NYC assignment mechanism uses mixed multiple tie-breakers in a setup like that described in Section 4.3: lottery schools use a common randomly assigned tie-breaker, while
screened schools use a variety of tie-breaking variables. Our empirical analysis treats non-lottery
tie-breakers as distinct, one for each screened school, though the theoretical discussion above
allows screened schools to share tie-breakers.
Schools may host multiple programs and each program sets its own priorities, such as preference for applicants from the same borough. Within priority groups, programs ration seats in one
of two ways. Three types of programs rank applicants systematically. These include screened
programs, which rank students based on academics and previous attendance records, audition
programs that use interviews or other qualitative assessments, and educational option programs
that screen for half their seats using middle school test scores. Our analysis refers to programs
and schools of all three types as ‚Äúscreened‚Äù since all use some sort of non-lottery tie-breaker.
Programs that are not screened break ties using a common lottery tie-breaker. The group of
lottery programs includes unscreened programs that admit students randomly, limited unscreened
programs that admit randomly but give priority to students who attend information sessions,
and the unscreened half of capacity at educational option programs. Our analysis computes
propensity scores for programs rather than schools since programs are the unit of assignment.
But we aggregate program propensity scores to produce a school-level score when evaluating
causal effects such as the effect of attendance at a Grade A School. For our purposes, a ‚Äúscreened
school‚Äù is a school hosting any screened program.7
In 2007, the NYC DOE launched a school accountability system that graded schools from A
to F. This mirrored similar accountability systems in Florida and other states. New York City‚Äôs
school grades were determined by achievement levels and, especially, achievement growth, as well
as by survey- and attendance-based measures of school environment. Growth looked at credit
accumulation, Regents completion and pass rates; performance measures were derived mostly
from four- and six-year graduation rates. Some schools were ungraded.8
The 2007 grading system was controversial. Proponents applauded the integration of multiple
measures of quality while opponents objected to high-stakes consequences of low grades, such as
school closure. Rockoff and Turner (2011) provide a partial validation of the system by showing
that low grades appeared to spark school improvement. In 2014, a newly elected mayor had the
The centralized NYC high school match is detailed in Abdulkadiroƒülu et al. (2005, 2009). Abdulkadiroƒülu et
al. (2014) describe NYC exam school admissions.
7
Because applicants receive at most one offer, the propensity score for a school is the sum of the scores for
programs hosted by the school. Some NYC high schools sort applicants on a screening tie-breaker, breaking
screened-running-variable ties using the common lottery number. Schools of this type are treated as lottery
schools, after allowing for additional priority groups defined by the screened running variable.
8
Walcott (2012) details the NYC grading methodology of this period.
6

21

2007 system replaced with school quality measures that place less weight on test scores and more
on curriculum characteristics and subjective assessments of teaching quality. The relative merits
of the old and new systems continue to be debated.
We showcase the use of mixed multiple tie-breakers for impact evaluation by estimating the
effects of being assigned to a Grade A school on student achievement and graduation rates.
This analysis uses application data from the 2012-13 and 2013-14 school years. Our sample
includes first-time applicants to ninth grade, who submit a rank order list of programs in the
main round of the NYC high school match. The available data include the inputs producing
the match: school capacities and priorities, lottery numbers, and screened school tie-breakers.
Our replication of the match is nevertheless imperfect. This may be due to clerical errors in the
recording of tie-breakers. Among other problems, we see occasional gaps in the lists showing how
schools rank their applicants and some applicants share a rank. Our online appendix details the
manner in which these problems are addressed.
Students at Grade A schools have higher average Regents, PSAT, and SAT scores than do
students at other schools. These school average characteristics are documented in Table 2, which
also shows that Grade A schools have higher graduation rates than other schools in the district.
This difference in graduation rates features in media accounts of socioeconomic characteristics
of NYC match outcomes (see, e.g., Harris and Fessenden (2017) and Disare (2017)).
Screened Grade A schools are also somewhat larger than the district average size, but Grade
A lottery schools are much smaller. Consistent with this, class sizes at screened Grade A schools
tend to exceed those at other schools while lottery Grade A schools have classes that are smaller
than those at screened Grade A schools. Students enrolled at Grade A schools are about as
likely to be nonwhite as students who go elsewhere, and qualify for a free lunch and special
education services at about the same rate. On the other hand, Grade A lottery schools have
more minority students than both Grade A screened schools and the district as a whole. We
also see an impressive gap in peer mean achievement between screened and lottery Grade A
schools. Finally, teachers at Grade A lottery schools are, on average, about as experienced as
those teaching elsewhere but are less likely to have an advanced degree (Master or higher).
In the two application cohorts described in Table 3, nearly 110,000 eighth graders applied in
the high school match, and roughly 93,000 ranked a Grade A school. Grade A applicants mostly
look like typical NYC eighth graders. On the other hand, while applicants subject to lottery
risk of Grade A assignment have baseline (seventh grade) test scores around the district mean,
applicants subject to general risk tend to have scored considerably higher than the district
average. This reflects the fact that the group subject to general risk includes many screened
school applicants, and most screened schools screen using test scores.
Figure 1 compares the number of applicants subject to lottery and general risk at each school
with any Grade A risk. Specifically, Panel A shows numbers of applicants subject to lottery risk
for each lottery school, where schools are ordered by capacity. Red arrows indicate the sample
size gains yielded by moving from lottery to general risk among applicants to lottery schools.
Perhaps not surprisingly, in the sample of lottery school applicants, the gains from exploiting
general risk are mostly small. By contrast, the sample size gains yielded by moving from lottery
to general risk at screened schools, documented in Panel B, are both broad (that is, appearing
22

for many schools) and large. Importantly, however, many screened schools also have applicants
subject to lottery risk, reflecting scenarios like those described in Table 1.
The balancing property of propensity score conditioning is documented in Table 4, which
reports Grade A school offer gaps in covariate means. Specifically, Table 4 reports estimates
generated by the following setup. Let Wi be an applicant characteristic, drawn from a set that
includes Œ∏i . Let D1i be a dummy for a Grade A school offer with corresponding propensity score,
pÃÇ1 . Likewise, let D2i indicate offers at an ungraded school with corresponding propensity score
pÃÇ2 . We control for ungraded school offers to ensure that Grade A effects compare sets of schools
with high and low grades.
Using x1 and x2 to index values in the support of pÃÇ1 and pÃÇ2 , balance tests are estimates of
parameter Œ≥1 in
X
X
Œ±2 (x2 )pÃÇ2 (x2 ) + h(ri ) + ŒΩi ,
(9)
Œ±1 (x1 )pÃÇ1 (x1 ) +
Wi = Œ≥1 D1i + Œ≥2 D2i +
x2

x1

with local linear control for the running variable according to
X
h(ri ) =
œâ1s ais + œâ2s bis + œâ3s bis √ó (ri ‚àí œÑs ) + œâ4s bis √ó 1(ri > œÑs ) √ó (ri ‚àí œÑs ),

(10)

s‚ààS\S0

where S\S0 is the set of screened programs, bis is a bandwidth indicator defined as bis = 1(cs ‚àí
Œ¥s < ri < cs + Œ¥s ), and ais indicates whether applicant i applied to program s. Parameters
(œâ1s -œâ4s ) in (10) vary by application cohort. Bandwidths are estimated as suggested by Imbens
and Kalyanaraman (2012), separately for each program, for the set of applicants who are in
the relevant marginal priority group.9 Our theoretical results suggest that estimates of Œ≥1 in
equation (9) should be close to zero. This is borne out by the results reported in columns 3
and 4 of Table 4, which show small, mostly insignificant differences in covariates by offer status.
These can be compared with the large and often significant uncontrolled gaps reported in the first
column. Moreover, as can be seen in the last two columns of the table, applicant and application
characteristics are also balanced for assignment offers at lottery Grade A schools and screened
Grade A schools.10
Causal effects of school attendance on test scores are measured as the effect of years of
exposure to schools of a particular type. Exposure variables are denoted C1i and C2i for Grade
A and ungraded schools, respectively. Effects on graduation outcomes are estimated by replacing
years of exposure with dummies for ninth grade enrollment. The causal effects of interest are
2SLS estimates of parameter Œ≤1 in
X
X
Yi = Œ≤1 C1i + Œ≤2 C2i + œÜ00 Xi +
Œ±01 (x1 )pÃÇ1 (x1 ) +
Œ±02 (x2 )pÃÇ2 (x2 ) + g(ri ) + Œ∑i ,
(11)
x1

x2

Bandwidths are also computed separately for each outcome variable; the minimum across outcomes is used
for all.
10
Table A1 reports follow up differentials for each of our outcomes.
9

23

with associated first stage equations,
C1i = Œ≥11 D1i + Œ≥12 D2i + œÜ01 Xi +
C2i = Œ≥21 D1i + Œ≥22 D2i +

œÜ02 Xi

+

Œ±11 (x1 )pÃÇ1 (x1 ) +

X

x1

x2

X

Œ±21 (x1 )pÃÇ1 (x1 ) +

X

X

Œ±12 (x2 )pÃÇ2 (x2 ) + h1 (ri ) + ŒΩ1i
Œ±22 (x2 )pÃÇ2 (x2 ) + h2 (ri ) + ŒΩ2i .

x2

x1

Running variable controls in these equations, denoted h1 (ri ), h2 (ri ), and g(ri ), are analogous to
those in equation (10). The vector of baseline and demographic controls, Xi , includes baseline
math and English scores; free lunch, special education, English language learner indicators; and
gender and race dummies.
As a benchmark, the OLS estimates reported in the second column of Table 5, suggest Grade
A attendance boost achievement and graduation rates. These estimates are constructed by fitting
equation (11), without propensity score controls or instrumenting, in a sample that includes all
participants in the high school match without regard to offer risk. By contrast, the 2SLS estimates
reported in columns 3 and 4 suggest that any gains associated with Grade A attendance reflect
selection bias. Compare, for example, the positive OLS estimate indicating a 0.13 increase in
graduation rates to the negative 2SLS estimate of about ‚àí0.01 in column 4 of Table 5. This
finding is noteworthy since graduation levels are a major determinant of school report card
grades. Our results suggest that although Grade A schools indeed have higher graduation rates,
they do not in and of themselves boost graduation. Higher English scores appear to be the only
clear gains from Grade A school attendance; these are increased by 0.03 when estimated with
covariates using general risk. This result is reasonably precise, with a standard error of 0.01.
Looking across columns, however, the estimated gain in English achievement becomes smaller
and less conclusively positive when estimated without covariates.
Estimates that exploit quasi-experimental variation around screened school cutoffs as well as
lottery risk, reported in columns headed ‚Äúgeneral risk‚Äù in Table 5, have the advantage of adding
applicants and schools to the analysis sample. The move from lottery risk to general risk yields
a valuable precision gain, as can be seen by comparing results reported in columns 3 and 4 or
columns 5 and 6. This increase in precision is driven both by larger sample sizes and larger first
stages in the older cohort.11 For instance, the associated standard error falls from 0.062 when
the graduation effect is estimated using only lottery risk to 0.031 when estimated by exploiting
general risk in Grade A assignment.
Because much of the policy discussion revolving around New York City‚Äôs school evaluation and
assignment systems has focused on access to screened schools, we‚Äôre interested in distinguishing
screened Grade A from lottery Grade A effects. The multi-sector estimates reported in Table 6 are
from models that include separate endogenous variables for each type of Grade A school, along
with a dummy for a single ungraded sector. Multi-sector models include separate propensity
score controls for both sectors, as well as for the single ungraded sector. The results in column
3 distinguish the two types of school effects while using only lottery variation, that is, treating
screened-school running variables as priorities. Perhaps surprisingly, lottery variation alone is
Table A2 reports first stage estimates by year. The first stages are larger for 2012-2013 than 2011-12 because
our match rates are higher. The first stage is larger under general risk than lottery risk in 2012-13, and is similar
in 2013-14.
11

24

sufficient to capture a reasonably precise screened school effect, with an estimated standard
error for the graduation estimate of 0.053 (the estimate itself is a virtual zero at ‚àí0.011). The
corresponding lottery school effect (reported in column 4 of Table 6) is 0.066, also not significantly
different from zero. On the other hand, the estimates in column 4 show small but marginally
significant gains from exposure to a lottery Grade A school. Again, it‚Äôs worth emphasizing that
this result is obtained while exploiting only lottery risk.
The research value of screened school tie-breaking emerges clearly in an analysis that distinguishes screened Grade A effects from lottery Grade A school effects. This value is apparent in a
comparison of the estimates in columns 5 and 6 of Table 6, which were computing using general
risk, with those in columns 3 and 4, using only lottery risk. Precision gains for estimates of the
effects of lottery school exposure are modest, but not trivial for graduation outcomes (compare,
for example, standard errors of 0.074 in column 6 with a standard error of 0.094 in column 4).
The payoff to analyses exploiting general risk is most dramatic for estimates of the effects of
screened school attendance. The standard error associated with Regents English, for example,
falls from 0.016 in column 3 to 0.010 in column 5. As can be seen in column 7, this precision
gain would otherwise require increasing the sample 2.5 times. The precision gain for estimates of
screened school graduation effects are equally impressive, equivalent to a near tripling in sample
size. The ratios in columns 7 and 8 show that in sample size terms, the gains from moving from
lottery to general risk range from 1.5 to 2.9, depending on sector and outcome.

6

Summary and Next Steps

The spread of centralized matching markets opens new horizons for impact evaluation. The
research potential of such markets is realized here by marrying the large-market DA propensity
score generated by lottery tie-breaking with RD designs at screened schools. A by-product of
our analysis is a novel view of RD as inducing a limiting propensity score that‚Äôs constant at
one-half. Our analysis also shows how markets with mixed multiple tie-breakers can be used
to study treatment effects at screened schools for applicants away from screening cutoffs. This
addresses a long-standing critique of traditional non-parametric RD estimates, which argues that
effects local to cutoffs are potentially misleading for the general population. Mixed multiple tiebreaking produces variation away from cutoffs through the process of disqualification at more
highly ranked choices.
Our analysis of NYC school progress report cards shows modest improvements on Regents
exams for students attending a Grade A school. Importantly, however, the gains from attending
a highly graded school appear only for schools that select applicants by lottery. While NYC‚Äôs
Grade A screened schools enroll some of the city‚Äôs highest achievers, attendance at a Grade A
screened school does not appear to boost student performance. Concerns about access to such
schools (as expressed, for example, in Harris and Fessenden (2017)) would therefore seem to be
misplaced. It‚Äôs also noteworthy that attendance at a Grade A school fails to increase high school
graduation rates or performance on PSAT and SAT tests.
Further afield, our theoretical framework may be applicable to the US National Residency
Matching Program, which matches medical school graduates to hospitals using a version of DA
25

with non-lottery tie-breakers (Roth and Peranson, 1999). This match can be leveraged to answer questions about the value of alternative medical training programs. As we‚Äôve discussed
elsewhere, important non-DA mechanisms can also be brought under the DA umbrella with suitable modifications to the inputs. This includes the Boston or immediate acceptance mechanism
or mechanisms used for exam school assignment systems used in major US cities and abroad (see,
e.g., Abdulkadiroƒülu et al. (2014), Balinski and S√∂nmez (1999), Dobbie and Fryer (2014), and
Kirkeboen et al. (2016)). In ongoing work, Angrist et al. (2017) deploy the methods developed
here in a study of Chicago‚Äôs exam schools. Our framework may also be useful for the evaluation
of resources allocated in auction markets. Some auctions can be seen as a version of DA with
non-lottery tie-breakers, where applicants are bidders and running variables are bids.12
Our provisional agenda for further research also includes work on econometric implementation
strategies, such as bandwidth selection. More refined procedures may have better properties than
our one-size-fits-all approach. The relative statistical performance of 2SLS and semiparametric
estimators likewise warrants investigation, as does the development of propensity score estimators
that compute the score by simulation. In addition to development of a strategy to compute the
mixed multiple tie-breaker score by simulation, an open question is how to use a simulated score
to eliminate OVB in a match that does not satisfy ETE.

Existing impact evaluations using RD in auctions include Narayanan and Kalyanam (2015) and Kawai and
Nakabayashi (2014).
12

26

References
Abdulkadiroƒülu, Atila, Josh Angrist, and Parag Pathak, ‚ÄúThe Elite Illusion: Achievement
Effects at Boston and New York Exam Schools,‚Äù Econometrica, 2014, 82(1), 137‚Äì196.
, Joshua D. Angrist, Yusuke Narita, and Parag A. Pathak, ‚ÄúResearch Design Meets
Market Design: Using Centralized Assignment for Impact Evaluation,‚Äù Econometrica, 2017,
85(5), 1373‚Äì1432.
,
,
,
, , and Roman A. Zarate, ‚ÄúRegression Discontinuity in Serial Dictatorship:
Achievement Effects at Chicago‚Äôs Exam Schools,‚Äù American Economic Review, Papers and
Proceedings, 2017.
, Parag A. Pathak, and Alvin E. Roth, ‚ÄúThe New York City High School Match,‚Äù American Economic Review, Papers and Proceedings, 2005, 95, 364‚Äì367.
, , and , ‚ÄúStrategy-proofness versus Efficiency in Matching with Indifferences: Redesigning
the New York City High School Match,‚Äù American Economic Review, 2009, 99(5), 1954‚Äì1978.
, Yeon-Koo Che, and Yosuke Yasuda, ‚ÄúExpanding ‚ÄúChoice" in School Choice,‚Äù American
Economic Journal: Microeconomics, 2015, 7(1), 1‚Äì42.
Ajayi, Kehinde, ‚ÄúDoes School Quality Improve Student Performance? New Evidence from
Ghana,‚Äù 2014. Working paper, Boston University.
Angrist, Joshua D., Parag A. Pathak, Miikka Rokkanen, and Roman Zarate, ‚ÄúChoice
and Consequence: Understanding Mismatch at Chicago‚Äôs Exam Schools,‚Äù 2017. Working
paper, MIT.
Azevedo, Eduardo and Jacob Leshno, ‚ÄúA Supply and Demand Framework for Two-Sided
Matching Markets,‚Äù Journal of Political Economy, 2016, 124(5), 1235‚Äì1268.
Balinski, Michel and Tayfun S√∂nmez, ‚ÄúA Tale of Two Mechanisms: Student Placement,‚Äù
Journal of Economic Theory, 1999, 84, 73‚Äì94.
Barrow, Lisa, Lauren Sartain, and Marisa de la Torre, ‚ÄúThe Role of Selective High Schools
in Equalizing Educational Outcomes: Heterogeneous Effects by Neighborhood Socioeconomic
Status,‚Äù 2016. FRB of Chicago Working Paper No. WP-2016-17.
Beuermann, Diether, C Kirabo Jackson, and Ricardo Sierra, ‚ÄúPrivately Managed Public
Secondary Schools and Academic Achievement in Trinidad and Tobago: Evidence from RuleBased Student Assignments,‚Äù 2016. Working Paper.
Disare, Monica, ‚ÄúCity to eliminate high school admissions method that favored families with
time and resources,‚Äù 2017. Chalkbeat, June 6.
Dobbie, Will and Roland G. Fryer, ‚ÄúExam High Schools and Academic Achievement: Evidence from New York City,‚Äù American Economic Journal: Applied Economics, 2014, 6(3),
58‚Äì75.
27

Fort, Margherita, Andrea Ichino, and Giulio Zanella, ‚ÄúCognitive and Non-cognitive Costs
of Daycare 0-2 for Girls,‚Äù 2016. Working Paper.
Gale, David and Lloyd S. Shapley, ‚ÄúCollege Admissions and the Stability of Marriage,‚Äù
American Mathematical Monthly, 1962, 69, 9‚Äì15.
Hahn, Jinyong, Petra Todd, and Wilbert Van der Klaauw, ‚ÄúIdentification and estimation
of treatment effects with a regression-discontinuity design,‚Äù Econometrica, 2001, 69 (1), 201‚Äì
209.
Harris, Elizabeth and Ford Fessenden, ‚ÄúThe Broken Promises of Choice in New York City
Schools,‚Äù 2017. New York Times, May 5.
Hastings, Justine, Christopher Neilson, and Seth Zimmerman, ‚ÄúAre Some Degrees
Worth More than Others? Evidence from College Admission Cutoffs in Chile,‚Äù 2013. NBER
Working paper 19241.
Imbens, Guido and Karthik Kalyanaraman, ‚ÄúOptimal Bandwidth Choice for the Regression
Discontinuity Estimator,‚Äù Review of Economic Studies, 2012, 79(3), 933‚Äì959.
Jackson, Kirabo, ‚ÄúDo Students Benefit from Attending Better Schools? Evidence from Rulebased Student Assignments in Trinidad and Tobago,‚Äù Economic Journal, 2010, 120(549),
1399‚Äì1429.
, ‚ÄúSingle-sex Schools, Student Achievement, and Course Selection: Evidence from Rule-based
Student Assignments in Trinidad and Tobago,‚Äù Journal of Public Economics, 2012, 96(1-2),
173‚Äì187.
Kawai, Kei and Jun Nakabayashi, ‚ÄúDetecting large-scale collusion in procurement auctions,‚Äù
Available at SSRN 2467175, 2014.
Kirkeboen, Lars, Edwin Leuven, and Magne Mogstad, ‚ÄúField of Study, Earnings, and
Self-Selection,‚Äù Quarterly Journal of Economics, 2016, 131, 1057‚Äì1111.
Lee, David S. and Thomas Lemieux, ‚ÄúRegression Discontinuity Designs in Economics,‚Äù
Journal of Economic Literature, 2010, 48, 281‚Äì355.
Lucas, Adrienne and Isaac Mbiti, ‚ÄúEffects of School Quality on Student Achievement: Discontinuity Evidence from Kenya,‚Äù American Economic Journal: Applied Economics, 2014,
6(3), 234‚Äì263.
Narayanan, Sridhar and Kirthi Kalyanam, ‚ÄúPosition effects in search advertising and their
moderators: A regression discontinuity approach,‚Äù Marketing Science, 2015, 34 (3), 388‚Äì407.
Pathak, Parag A., ‚ÄúWhat Really Matters in Designing School Choice Mechanisms,‚Äù in Bo Honore, Monika Piazessi, Ariel Pakes, and Larry Samuelson, eds., Advances in Economics and
Econometrics, 11th World Congress of the Econometric Society, Cambridge University Press,
2017.
28

Pop-Eleches, Cristian and Miguel Urquiola, ‚ÄúGoing to a Better School: Effects and Behavioral Responses,‚Äù American Economic Review, 2013, 103(4), 1289‚Äì1324.
Rockoff, Jonah and Lesley Turner, ‚ÄúShort Run Impacts of Accountability of School Quality,‚Äù
American Economic Journal: Economic Policy, 2011, 2(4), 119‚Äì147.
Rosenbaum, Paul R. and Donald B. Rubin, ‚ÄúThe Central Role of the Propensity Score in
Observational Studies for Causal Effects,‚Äù Biometrica, 1983, pp. 41‚Äì55.
Roth, Alvin E. and Elliott Peranson, ‚ÄúThe Redesign of the Matching Market for American
Physicians: Some Engineering Aspects of Economic Design,‚Äù American Economic Review,
1999, 89, 748‚Äì780.
and Marilda A. O. Sotomayor, Two-sided Matching: a Study in Game-theoretic Modeling
and Analysis, Cambridge University Press: Econometric Society monographs, 1990.
Rubin, Donald B., ‚ÄúAssignment to Treatment Group on the Basis of a Covariate,‚Äù Journal of
Educational Statistics, 1977, 2(1), 1‚Äì26.
van der Vaart, A. W., Asymptotic Statistics, Cambridge University Press, 2000.
Walcott, Dennis, ‚ÄúNYC Department of Education: Progress Reports for New York City Public
Schools,‚Äù 2012. January.
Wellner, Jon A, ‚ÄúA Glivenko-Cantelli theorem for empirical measures of independent but nonidentically distributed random variables,‚Äù Stochastic Processes and Their Applications, 1981,
11 (3), 309‚Äì312.
Zimmerman, Seth D, ‚ÄúMaking the One Percent: The Role of Elite Universities and Elite
Peers,‚Äù Technical Report, National Bureau of Economic Research 2016.

29

Figure 1: Sample size gains relative to lottery risk

0

10

100

500

2000

(a) Lottery Grade A Schools

30

100
300
School Capacity (log scale)

1000

0

10

100

500

2000

(b) Screened Grade A Schools

30

100
300
School Capacity (log scale)

1000

# of Additional Applicants Subject to General Risk (Log Scale)
# of Applicants Subject to Lottery Risk (Log Scale)
Notes: This figure plots increases in the number of applicants with non-degenerate risk of assignment at individual
schools, ordered by their capacity. Dots plot the number of students who have risk when screened school admission
is treated as determined solely by priorities. Arrow length measures the number of additional students at risk
when risk is determined by running variable variation in a bandwidth around screened school cutoÔ¨Äs as well as
by lottery risk. The plot shows only schools with a capacity of at least 30 seats. Declines in risk of 2 or fewer
students are not shown.

2

Table 1. Propensity Score Anatomy
Schools
Determinants of lottery risk
Propensity
0
Œò
score
Name Tie-breaker
œÑ
MID
(1)
(2)
(3)
(4)
Example 1: Lotteries Create Risk at Lottery and Screened Schools
A
Lottery
0.8
c
0
0.8
B
Screened
n
0.8
0
C
Screened
a
0.8
0.2
Example 2: Screening Creates Risk at Lottery and Screened Schools
D
Screened
n
0
0
E
Lottery
0.8
n
0
0
F
Lottery
0.6
a
0
1

Determinants of general risk
Propensity
0
Œò
score
MID
(5)
(6)
(7)
c
n
a

0
0.8
0.8

0.8
0
0.2

c
n
a

0
0
0

0.5
0
0.5

Example 3: Lotteries and Screening Interact to Create Risk
G
Screened
a
0
1
c
0
0.5
H
Lottery
0.8
n
1
0
n
0
0
I
Lottery
0.6
c
1
0
c
0
0.3
J
Lottery
0.8
c
1
0
c
0.6
0.1
K
Screened
a
1
0
a
0.8
0.1
Notes. This table shows how the propensity score is determined in three examples. Each example
describes the risk faced by a single applicant at each of the schools ranked: the applicant in example 1
ranks schools A, B, and C in that order. Lottery risk is determined by taking screened school tiebreakers as priorities. Applicants to screened schools therefore have status a or n at these schools
according to whether they clear the relevant screened tie-breaker cutoff. Column 1 reports
randomization cutoffs for schools that use a lottery tie-breaker. Columns 2 and 5 reports applicant status
(always seated [a ], never seated [ n ], and conditionally seated [ c ]) in lottery-only and general risk
scenarios. Columns 3 and 6 report the most informative disqualification for the lottery tie-breaker.
MID 0 in column 3 is computed treating screened-school tie-breakers as priorities. MID 0 in column 6
looks at screened as well as lottery risk.

Table 2. New York School Characteristics
Grade A schools
All
Screened
Lottery
(1)
(2)
(3)

Other schools
(4)

Regents Math (standardized)
Regents English (standardized)
PSAT NMSQT (60-240)
SAT Reasoning (400-1600)
Graduation
Graduation with advanced regents

Panel A: Average Performance Levels
0.12
0.25
0.22
0.32
113
118
929
958
0.74
0.76
0.18
0.21

-0.18
-0.03
103
851
0.69
0.09

-0.13
-0.03
108
896
0.63
0.13

Total per student expenditures
Expenditure on classroom instruction
Number of grade 9 students
Number of grade 12 students
Number of grade 9 to 12 students
Average class size grade 9

Panel B: School Characteristics
17423
17033
7689
7522
1214
1529
1052
1336
4581
5793
24.2
25.5

18362
8091
455
369
1661
21.1

17579
7946
1540
1280
5565
21.1

Fraction minority
Fraction female
Fraction special education
Seventh grade Math
Seventh grade English

Panel C: Peer Attributes
0.68
0.52
0.13
0.15
0.13

0.88
0.51
0.18
-0.19
-0.17

0.71
0.50
0.14
-0.03
-0.04

0.60
0.53
0.12
0.29
0.26

Panel D: Teacher Attributes
Inexperienced teachers
0.10
0.09
0.13
0.14
Advanced degree teachers
0.50
0.54
0.39
0.47
Teacher turnover rate
0.14
0.13
0.17
0.18
Notes. This table reports weighted average characteristics of school-year pairs as observed in data on school
average Regents, SAT, and graduation outcomes (Panel A) and data from New York City school report cards
(Panels B, C, and D), for 2011-12 and 2012-13. Grade A schools are defined based on the year before application.
A screened school is any school with at least one screened program. A lottery school is any school without
screened programs. School-year pairs are weighted by the number of students enrolled at each school, separately
for each year. Inexperienced teachers have 3 or fewer years of experience. Advanced degree teachers have a
Masters or higher degree.

Asian
Black
Hispanic
White
Female
Special education
English language learners
Free lunch
Year 2012/13
Brooklyn
The Bronx
Manhattan
Queens
Staten Island
Baseline scores
Seventh grade Math
Seventh grade English

Table 3. Applicant Characteristics
Eighth grade
Grade A
students
applicants
Applicants
(1)
(2)
(3)
0.154
0.170
0.163
0.309
0.286
0.297
0.405
0.390
0.406
0.125
0.147
0.127
0.487
0.512
0.525
0.186
0.068
0.067
0.123
0.107
0.103
0.861
0.839
0.850
0.497
0.492
0.491
0.316
0.312
0.301
0.215
0.210
0.228
0.134
0.130
0.139
0.277
0.287
0.281
0.059
0.061
0.051

0.021
0.016

0.187
0.187

0.180
0.190

Score in (0,1)
Lottery risk
General risk
(4)
(5)
0.110
0.189
0.297
0.257
0.493
0.424
0.095
0.123
0.503
0.521
0.077
0.061
0.112
0.091
0.892
0.855
0.478
0.500
0.304
0.290
0.321
0.244
0.086
0.098
0.236
0.322
0.052
0.046

-0.016
0.003

0.258
0.254

Students
123687
109244
92630
17,353
25,052
111
134
Schools
School-year pairs
156
202
Notes. This table describes the population of New York City eighth graders in the 2011-12 and 2012-13
school years. Column 1 shows statistics for enrolled eighth graders. Column 2 shows statistics for first-time
high school applicants who applied in the main round of the NYC high school match in 2012 or 2013.
Column 3 reports statistics for applicants who ranked a Grade A school. Column 4 shows statistics for
applicants with lottery risk of Grade A assignment; column 5 shows statistics for applicants with general risk
of Grade A assignment. Students are said to have risk when they have a propensity score strictly between
zero and one and they're in a score cell with variation in Grade A school offers. New York had 142 Grade A
schools in our analysis period. Counts of schools and school-year pairs in this table include only schools
with at least 10 applicants at risk of Grade A assignment. Baseline seventh grade Math and English test
scores are standardized by year to the population of test-takers. Boroughs refer to the applicants' borough of
residence.

Table 4. Statistical Tests for Balance
Non-offered
mean
(1)
# of schools ranked

6.656

# of Grade A schools ranked

3.087

Grade A ranked first

0.605

# of screened Grade A
schools ranked
# of lottery Grade A
schools ranked
F-test (mvreg)
p-val

1.008

Asian

0.177

Black

0.272

Hispanic

0.426

White

0.117

Female

0.529

Special education

0.060

English language learners

0.085

Free lunch

0.862

Baseline scores
Seventh grade Math

0.209

Seventh grade English

2.079

0.221

No controls
Lottery risk
Grade A
Grade A
school
school
(2)
(3)
Panel A: Application Covariates
-0.303***
0.028
(0.021)
(0.048)
0.799***
0.033
(0.013)
(0.031)
0.439***
-0.002
(0.003)
(0.006)
0.240***
-0.007
(0.009)
(0.019)
0.558***
0.040
(0.011)
(0.024)
0.822
(0.511)
Panel B: Baseline Covariates
0.003
-0.002
(0.006)
(0.003)
-0.079***
-0.011
(0.008)
(0.003)

General risk
Grade A
school
(4)

Lottery Grade A Screened Grade A
school
school
(5)

(6)

-0.022
(0.035)
0.006
(0.021)
0.007
(0.005)
-0.014
(0.015)
0.020
(0.015)
1.177
(0.319)

-0.057
(0.062)
-0.035
(0.040)
-0.005
(0.008)
-0.033
(0.032)
-0.002
(0.025)
0.694
(0.596)

0.028
(0.041)
0.038
(0.025)
0.014**
(0.006)
0.008
(0.016)
0.028
(0.020)
2.058
(0.068)

0.003
(0.006)
-0.015**
(0.007)

0.010
(0.006)
-0.010
(0.012)

0.002
(0.008)
-0.006
(0.008)

0.008**
(0.003)
0.066***
(0.002)
0.010**
(0.003)
-0.004**
(0.002)
0.004**
(0.002)
-0.058***
(0.003)

0.012
(0.009)
0.002
(0.006)
-0.000
(0.009)
0.012**
(0.005)
0.005
(0.006)
-0.009
(0.006)

0.011
(0.008)
0.001
(0.005)
-0.001
(0.008)
0.010**
(0.004)
0.004
(0.005)
-0.008
(0.005)

0.004
(0.013)
-0.005
(0.006)
-0.002
(0.013)
0.006
(0.007)
-0.009
(0.008)
-0.008
(0.007)

0.002
(0.010)
0.001
(0.007)
0.003
(0.010)
0.008
(0.005)
0.003
(0.006)
-0.008
(0.007)

0.192***
(0.006)
0.167***
(0.006)

-0.003
(0.013)

0.011
(0.011)

0.028
(0.018)

0.003
(0.012)

0.003
(0.013)

-0.000
(0.011)

0.026
(0.019)

-0.008
(0.011)

F-test (mvreg)
1.366
1.701
1.571
0.721
p-val
(0.189)
(0.074)
(0.109)
(0.690)
N
90914
16505
23778
9614
18243
Points of support (Grade A)
607
986
509
746
Notes. This table reports balance statistics, computed by regressing covariates on dummies indicating a Grade A offer and an ungraded school offer.
The sample includes applicants for ninth grade seats in 2011-12 and 2012-13. Columns 3 and 4 report estimates that condition on saturated controls
for Grade A and ungraded school propensity scores. The sample for columns 3-6 includes students who are at risk of Grade A assignment. Lottery
risk in column 3 is computed by treating screened-school tie-breakers as priorities. Column 5 reports balance for students at risk of an offer at lottery
schools; column 6 reports balance statistics for students at risk of an offer at screened schools. Both sets of estimates control for the relevant
propensity score. Estimates in columns 4-6 are from models that include running variable controls. Robust standard errors are in parenthesis. *
significant at 10%; ** significant at 5%; *** significant at 1%

Table 5. Grade A School Effects
Non-offered
mean
(1)
0.211

Regents Math
(standardized)
N
Regents English
(standardized)

0.065***
(0.002)
87633

0.006
(0.016)
14745

0.017
(0.012)
21684

0.027**
(0.014)
13169

0.032**
(0.010)
19690

117

0.013
(0.093)
54143

-1.186
(0.912)
8156

-0.063
(0.714)
12725

0.015
(0.685)
7678

0.168
(0.563)
12139

961

-0.826**
(0.353)
58270

-3.937
(3.593)
9218

3.202
(2.752)
14594

2.342
(2.621)
8197

3.700*
(2.176)
13225

0.701

0.129***
(0.004)
51086

0.017
(0.056)
9608

-0.013
(0.035)
13012

0.031
(0.062)
7964

-0.001
(0.031)
8791

N
SAT Reasoning
(400-1600)
N
Graduation
N
Graduation with
Advanced Regents

2SLS
Baseline/demographic controls
Lottery risk
General risk
(5)
(6)
0.026
0.043
(0.037)
(0.033)
14440
21331

0.303
N

PSAT NMSQT
(60-240)

OLS
(2)
0.075***
(0.005)
95352

No covariate controls
Lottery risk General risk
(3)
(4)
-0.018
0.039
(0.043)
(0.037)
16161
23491

0.169

-0.000
-0.037
-0.009
-0.030
0.023
(0.003)
(0.038)
(0.027)
(0.040)
(0.025)
N
51086
9608
13012
7964
8791
Notes. This table reports OLS and 2SLS estimates of the effects of Grade A high school enrollment on Regents Math,
Regents English, SAT, PSAT, and graduation outcomes. Estimates in columns 3-6 are from models with dummies for
Grade A and ungraded schools treated as endogenous. OLS estimates are from models that omit propensity score controls
and include all students in the two match cohorts, though not limited to those in the match. The 2SLS sample is limited to
students with Grade A assignment risk. Regents Math and English scores are standardized to the population of test takers
in the year and semester tested. SAT Reasoning is the sum of SAT Math and Reading. PSAT NMSQT is the sum of PSAT
Math, Critical Reading and Writing. SAT and PSAT are scores from the first time the test is taken. The estimates in
columns 2, 5, and 6 include controls for seventh grade Math and English scores, free lunch status, SPED and ELL status,
gender, and race/ethnicity indicators. Estimates in columns 4 and 6 are from models that include running variable controls.
Robust standard errors are in parenthesis. * significant at 10%; ** significant at 5%; *** significant at 1%

Table 6. Multi-Sector 2SLS Estimates
Non-offered mean

Regents Math
(Standardized)

Lottery risk

Lottery

Screened

Lottery

Screened

Lottery

Screened

Lottery

(1)

(2)

(3)

(4)

(5)

(6)

(7)

(8)

0.319

0.012

-0.043
(0.041)

0.099**
(0.046)
15960

0.009
(0.034)

0.099**
(0.045)
23704

1.454

1.045

0.007
(0.016)

0.048**
(0.016)
14653

0.026**
0.044**
(0.010)
(0.015)
21994

2.560

1.138

0.424
(0.699)

-0.628
(0.867)

-0.912
(0.811)

1.886

1.143

3.094
(2.832)

1.977

1.123

0.032
(0.074)

2.923

1.614

0.384

0.164

N
119

PSAT NMSQT
(60-240)

111

981

904

0.570
(2.913)

0.749

0.682

3.436
(3.001)

-0.011
(0.053)

2.241
(2.072)
15008

0.066
(0.094)

-0.040
(0.031)

8655

N
Graduated with
Advanced Regents

13865

9299

N
Graduated

0.270
(0.509)

8744

N
SAT Reasoning
(400-1600)

Equivalent
sample size gain

Screened

N
Regents English
(Standardized)

General risk

0.226

0.109

-0.031
(0.036)

12183
-0.031
(0.061)

-0.019
(0.026)

-0.045
(0.048)

1.917
1.615
8655
12183
N
Notes. This table reports 2SLS estimates of models that separately identify Grade A effects at screened and lottery schools, treating
both as endogenous. These models also include an endogenous dummy for ungraded schools. The sample is limited to students with
either Grade A lottery or Grade A screened assignment risk. All models include controls for seventh grade Math and English scores,
free lunch status, SPED and ELL status, gender, and race/ethnicity indicators. Estimates in columns 5 and 6 are from models that
include running variable controls. Robust standard errors in parenthesis. * significant at 10%; ** significant at 5%; *** significant
at 1%

Table A1. Differential Attrition
No controls
Lottery risk

General risk
Grade A
Grade A
Grade A
Grade A
Grade A
lottery
screened
(1)
(2)
(3)
(4)
(5)
Has Regents Math score
0.019***
0.008
0.003
0.001
-0.001
(0.003)
(0.006)
(0.005)
(0.009)
(0.006)
Has Regents English score
0.051***
-0.013*
-0.010
-0.013
-0.011
(0.003)
(0.008)
(0.007)
(0.011)
(0.008)
Has PSAT NMSQT score
0.048***
0.012
0.004
0.031**
-0.025**
(0.003)
(0.009)
(0.008)
(0.012)
(0.009)
Has SAT Reasoning score
0.089***
0.017*
0.007
0.028**
-0.014
(0.003)
(0.009)
(0.009)
(0.013)
(0.010)
Notes. This table reports estimates of differential attrition for test score outcomes, computed by regressing
the variables at left on dummies indicating Grade A and ungraded school offers using models similar to
those used to assess balance. Samples include applicants in 2011-12 and 2012-13 who were enrolled in NYC
in eighth grade (the grade before high school). The samples for columns 2-5 are limited to students who were
at risk of Grade A assignment. Differential attrition estimates condition on saturated controls for Grade A
and ungraded school propensity scores. Column 4 reports estimates for students at risk of an offer at lottery
schools; column 5 reports estimates for students at risk at screened schools. Lottery risk is computed by
treating screened-school tie-breakers as priorities. All models include controls for seventh grade Math and
English scores, free lunch status, SPED and ELL status, gender, and race/ethnicity indicators. Estimates in
columns 3-5 are from models that include running variable controls. Robust standard errors are in
parenthesis. * significant at 10%; ** significant at 5%; *** significant at 1%

Regents Math
(years of exposure)

Table A2. First Stage Estimates for Grade A Schools
2012/2013
2013/2014
Lottery risk
General risk
Lottery risk
General risk
(1)
(2)
(3)
(4)
0.280***
0.295***
0.565***
0.490***
(0.018)
(0.016)
(0.013)
(0.012)
N
6963
9849
7515
11521

Regents English
(years of exposure)
N

0.713***
(0.039)
6454

0.884***
(0.035)
9205

1.477***
(0.031)
6746

1.457***
(0.027)
10518

N

0.464***
(0.028)
5932

0.565***
(0.024)
8560

1.042***
(0.026)
6421

1.040***
(0.024)
9901

N

0.784***
(0.042)
7964

0.999***
(0.038)
10986

1.591***
(0.032)
8580

1.573***
(0.028)
12829

PSAT NMSQT
(years of exposure)

SAT Reasoning
(years of exposure)

Ever enrolled
(dummy)

0.295***
0.363***
0.615***
0.602***
(0.014)
(0.013)
(0.011)
(0.010)
N
7964
10986
8580
12829
Notes. This table reports first stage estimates of the effect of Grade A offers on Grade A enrollment,
separately by application cohort and type of risk. First stage estimates differ across outcomes and years
because different outcomes are seen in follow-up windows that differ by test and grade. The sample
includes applicants for eighth grade seats in 2011-12 and 2012-13 facing the indicated type of risk.
Estimates condition on saturated controls for Grade A and ungraded school propensity scores. The estimates
in columns 1 and 3 control for propensity scores that treat screened-school tie-breakers as priorities. All
models include controls for seventh grade Math and English scores, free lunch status, SPED and ELL status,
gender, and race/ethnicity indicators. Estimates in columns 2 and 4 are from models that include running
variable controls. Robust standard errors are in parenthesis. * significant at 10%; ** significant at 5%; ***
significant at 1%

A

Theoretical Appendix

To simplify notation, we define the applicant rank for any (r0 , r) ‚àà RV +1 as follows:
œÄŒ∏s (r0 , r) = œÅŒ∏s + rv(s) .
When œÄŒ∏s (r0 , r) < cs , either applicant of type Œ∏ has priority below the marginal priority (œÅŒ∏s < œÅs )
or she has priority equal to the marginal priority and her running variable value is less than the
randomization cutoff (œÅŒ∏s = œÅs and rv(s) < œÑs ).

A.1

Defining DA: Generalization

The definition of DA extends to the case with multiple mixed tie-breaking. For any set of
applicant types Œò0 ‚äÇ Œò and for any number (r0 , r) ‚àà [0, 1]V +1 , define the set of applicants in Œò0
with tie-breaking numbers less than (r0 , r) to be
I(Œò0 , r0 , r) = {i ‚àà I | Œ∏i ‚àà Œò0 , riv ‚â§ rv for all v}.
We use the shorthand notation I0 = I(Œò0 , r0 , r) to denote this set and let the fraction of applicants in I0 be denoted by G(I0 ). As in the case with single tie-breaking combine applicants‚Äô
priority status and tie-breaking variable realization into applicant rank at school s, œÄŒ∏i s (ri ). The
remaining notation and definition of DA is the same as in the case with single tie-breaking
(Section 2).
Let us confirm that DA always converges for the general tie-breaking case. Our general
formulation defines the DA match as determined by cutoffs found in the limit of a sequence.
Recall that these cutoffs evolve according to
(
K +1
if F (Qs (ct )) < qs ,

ct+1
=
s
max x ‚àà [0, K + 1] | F ({i ‚àà Qs (ct ) such that œÄŒ∏i s (ri ) ‚â§ x}) ‚â§ qs
otherwise,
where Qs (ct ) is the demand for seats at school s for a given vector of cutoffs ct and is defined as
Qs (ct ) = {i ‚àà I | œÄŒ∏i s (ri ) ‚â§ cts and s i sÃÉ for all sÃÉ ‚àà S such that œÄisÃÉ ‚â§ ctsÃÉ }.

(12)

The following result confirms that these limiting cutoffs exist, i.e., that the sequence ct converges.
Lemma 1. Consider any economy with general tie-breaking as defined in Section 4. Construct
a sequence of cutoffs, cts , for this economy as described above. Then, limt‚Üí‚àû cts exists.
Proof. See the proof of Lemma 2 in Abdulkadiroƒülu et al. (2017a).
Note that this result applies to the cutoffs for both finite and continuum economies. In finite
markets, at convergence, these cutoffs produce the allocation we get from the usual definition of
DA (e.g., as in Gale and Shapley (1962)). This can be seen by noting that
max{x ‚àà [0, K + 1] | F ({i ‚àà Qs (ct ) such that œÄŒ∏i s (ri ) ‚â§ x}) ‚â§ qs }
39

= max{x ‚àà [0, K + 1] | |{j ‚àà Qs (ct ) : œÄjs ‚â§ x}| ‚â§ ks },
implying that the tentative cutoff at school s in step t in our DA formulation, which is determined
by the left hand side of this equality, is the same as that in Gale and Shapley (1962)‚Äôs DA
formulation, which is determined by the right hand side of the equality. Our DA formulation
and the Gale and Shapley (1962) formulation therefore produce the same cutoff at each step.
This also implies that, in finite markets, our DA cutoffs are found in a finite number of iterations,
since DA as described by Gale and Shapley (1962) converges in a finite number of steps.

A.2

Proofs

A.2.1

Preliminaries

Our proofs use a lemma that describes the bandwidth-specific propensity score in a continuum
economy under the assumptions in Section 4. For a profile r = (rv )v‚àà{1,...,V } ‚àà [0, 1]V of reference
values of tie-breaking variables and each v = 1, ..., V , let e(v) denote the event that Œ∏i = Œ∏, Riu >
u for u = 1, ..., v ‚àí 1, and R ‚àà N (r, Œ¥). Also, let
M IDŒ∏s
i
Œ¶Œ¥ (v) ‚â°

v
Fv (rv + Œ¥|e(v)) ‚àí max{Fv (M IDŒ∏s
|e(v)), Fv (rv ‚àí Œ¥|e(v))}
for v ‚â• 1
Fv (rv + Œ¥|e(v)) ‚àí Fv (rv ‚àí Œ¥|e(v))

0
Œ¶Œ¥ ‚â° (1 ‚àí M IDŒ∏s
)Œ†v Œ¶Œ¥ (v)
)
(
v(s)
min{F
(œÑ
|e(v)),
F
(r
+
Œ¥|e(v))}
‚àí
max{F
(M
ID
|e(v)),
F
(r
‚àí
Œ¥|e(v))}
s
v(s)
v(s)
v(s)
v(s)
v(s)
v(s)
Œ∏s
.
Œ¶0Œ¥ ‚â° max 0,
v(s)
Fv(s) (rv(s) + Œ¥|e(v)) ‚àí max{Fv(s) (M IDŒ∏s |e(v)), Fv(s) (rv(s) ‚àí Œ¥|e(v))}

Lemma 2. In the mixed tie-breaking setting of Section 4, consider a continuum economy populated by applicants of type Œ∏ ‚àà Œò to be assigned to schools indexed by s ‚àà S. For any fixed Œ¥ > 0,
we have:
Ô£±
v = 1 or r + Œ¥ ‚â§ M ID v for some v),
Ô£¥
if Œ∏ ‚àà Œòns or (M IDŒ∏s
v
Ô£≤ 0
Œ∏s
a
v
v for all v,
ps (Œ∏, r, Œ¥) =
Œ¶Œ¥
if Œ∏ ‚àà Œòs , M IDŒ∏s 6= 1 and rv + Œ¥ ‚â• M IDŒ∏s
Ô£¥
Ô£≥ Œ¶ √ó Œ¶0 if Œ∏ ‚àà Œòc , M IDv 6= 1, and r + Œ¥ ‚â• M IDv for all v.
v
Œ¥
s
Œ∏s
Œ∏s
Œ¥
Proof. Note first that admissions cutoffs c in a continuum economy are invariant to tie-breaking
outcomes Ri , reference tie-breaking number r, and bandwidth Œ¥: DA in the continuum depends
on (Ri ) only through F (I0 ) for sets I0 = {i ‚àà I | Œ∏i ‚àà Œò0 , riv ‚â§ rv for all v} with various
choices of Œò0 and r. In particular, F (I0 ) doesn‚Äôt depend on running variable realizations in the
continuum economy since for the empirical CDF of each running variable conditional on each
type, FÃÇv (¬∑|Œ∏), we always have FÃÇv (¬∑|Œ∏) = Fv (¬∑|Œ∏) for any v and Œ∏ by Wellner (1981)‚Äôs GlivenkoCantelli theorem for independent but non-identically distributed random variables. F (I0 ) doesn‚Äôt
depend on reference tie-breaking number r and bandwidth Œ¥ either since r and Œ¥ affect only the
distribution of a single student i‚Äôs tie-breaking number Ri , which has no effect on F (I0 ) or cutoffs.
Likewise, marginal priority œÅs is constant for every school s.
Now, consider the bandwidth-specific propensity score ps (Œ∏, r, Œ¥) ‚â° E[Di (s)|Œ∏i = Œ∏, Ri ‚àà
N (r, Œ¥)]. We start with verifying the first line in the above characterization of ps (Œ∏, r, Œ¥). Applicants who don‚Äôt rank s have ps (Œ∏, r, Œ¥) = 0. Among those who do rank s, those of type Œ∏ ‚àà Œòns
40

v = 1 or r +Œ¥ ‚â§ M ID v for some v,
have œÅŒ∏s > œÅs so that ps (Œ∏, r, Œ¥) = 0. Even if Œ∏ 6‚àà Œòns , if M IDŒ∏s
v
Œ∏s
student i with Œ∏i = Œ∏ and Ri ‚àà N (r, Œ¥) is always assigned some b ‚àà BŒ∏s so that ps (Œ∏, r, Œ¥) = 0.
v 6= 1
To show the remaining cases, first note that applicants of type Œ∏ ‚àà Œòas ‚à™ Œòcs with M IDŒ∏s
v for all v may be assigned b ‚àà B , where œÅ
and rv + Œ¥ ‚â• M IDŒ∏s
Œ∏s
Œ∏b = œÅb . Since the (aggregate)
distribution of tie-breaking variables for type Œ∏ students is FÃÇv (¬∑|Œ∏) = Fv (¬∑|Œ∏), conditional on
Ri ‚àà N (r, Œ¥), the proportion of type Œ∏ applicants not being assigned any b ‚àà BŒ∏s where œÅŒ∏b = œÅb
0 )Œ† Œ¶ (v) since each Œ¶ (v) is the probability of not being assigned to b ‚àà B v .
is Œ¶Œ¥ = (1 ‚àí M IDŒ∏s
v Œ¥
Œ¥
Œ∏s
To see the second line, note that every applicant of type Œ∏ ‚àà Œòas who is not assigned a higher
v 6= 1 and r + Œ¥ ‚â• M ID v for all
choice is assigned s because œÅŒ∏s < œÅs , and so if Œ∏ ‚àà Œòas , M IDŒ∏s
v
Œ∏s
v, we have
ps (Œ∏, r, Œ¥) = Œ¶Œ¥ .
v 6= 1, and r + Œ¥ ‚â• M ID v for all v.
Finally, consider applicants of type Œ∏ ‚àà Œòcs with M IDŒ∏s
v
Œ∏s
The fraction of applicants Œ∏ ‚àà Œòcs who are not assigned a higher choice is Œ¶Œ¥ , as explained above.
Also, for tie-breaker v(s), the tie-breaking numbers of these applicants are larger (worse) than
v(s)
v(s)
v(s)
M IDŒ∏s . If œÑs < M IDŒ∏s , then no such applicant is assigned s. If œÑs ‚â• M IDŒ∏s , then the ratio
of applicants that are assigned s within this set is given by
v(s)

min{Fv(s) (œÑs |e(v)), Fv(s) (rv(s) + Œ¥|e(v))} ‚àí max{Fv(s) (M IDŒ∏s |e(v)), Fv(s) (rv(s) ‚àí Œ¥|e(v))}
v(s)

.

Fv(s) (rv(s) + Œ¥|e(v)) ‚àí max{Fv(s) (M IDŒ∏s |e(v)), Fv(s) (rv(s) ‚àí Œ¥|e(v))}
Hence, conditional on Œ∏ ‚àà Œòcs and not being assigned a choice higher than s, the probability
v 6= 1 and r + Œ¥ ‚â•
of being assigned s is given by Œ¶0Œ¥ . Therefore, for all Œ∏ ‚àà Œòcs with M IDŒ∏s
v
0
v
M IDŒ∏s for all v, we have ps (Œ∏, r, Œ¥) = Œ¶Œ¥ √ó Œ¶Œ¥ .
A.2.2

Theorem 2

With Œ¥ = 1, the conditioning event Ri ‚àà N (r, Œ¥) becomes vacuous for any r so that ps (Œ∏, r, Œ¥) =
ps (Œ∏). Note
Œ¶1 (v) =

v
Fv (rv + 1|Œ∏) ‚àí max{Fv (M IDŒ∏s
|Œ∏), Fv (rv ‚àí 1|Œ∏)}
Fv (rv + 1|Œ∏) ‚àí Fv (rv ‚àí 1|Œ∏)

v
= 1 ‚àí Fv (M IDŒ∏s
|Œ∏)
v(s)

Œ¶01

= max{0,

min{Fv(s) (œÑs |e(v)), Fv(s) (rv(s) + 1|e(v))} ‚àí max{Fv(s) (M IDŒ∏s |e(v)), Fv(s) (rv(s) ‚àí 1|e(v))}
v(s)

Fv(s) (rv(s) + 1|e(v)) ‚àí max{Fv(s) (M IDŒ∏s |e(v)), Fv(s) (rv(s) ‚àí 1|e(v))}
v(s)

= max{0,

Fv(s) (œÑs |Œ∏) ‚àí Fv(s) (M IDŒ∏s |Œ∏)
v(s)

1 ‚àí Fv(s) (M IDŒ∏s |Œ∏)

},

where the equalities for Œ¶1 (v) and Œ¶01 are by Fv (r + 1|e(v)) = 1 and Fv (r ‚àí 1|e(v)) = 0 for all
r ‚àà [0, 1] and v.
Lemma 2 then implies Theorem 2 by the following reasoning:
ps (Œ∏)
= ps (Œ∏, r, 1)
41

}

=

Ô£±
0
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Q
Ô£¥
v
Ô£¥
Ô£¥
Ô£≤ v (1 ‚àí Fv (M IDŒ∏s |Œ∏))

v = 1 or r + 1 ‚â§ M ID v for some v)
if Œ∏ ‚àà Œòns or (M IDŒ∏s
v
Œ∏s
v 6= 1 and r + 1 > M ID v for all v,
if Œ∏ ‚àà Œòas , M IDŒ∏s
v
Œ∏s

)
(
Ô£¥
v(s)
Ô£¥
Ô£¥
Fv(s) (œÑs |Œ∏) ‚àí Fv(s) (M IDŒ∏s |Œ∏)
Q
Ô£¥
v
Ô£¥
Ô£¥
v (1 ‚àí Fv (M IDŒ∏s |Œ∏)) √ó max 0,
Ô£¥
v(s)
Ô£¥
1 ‚àí Fv(s) (M IDŒ∏s |Œ∏)
Ô£¥
Ô£¥
Ô£≥
v 6= 1, and r + 1 > M ID v for all v,
if Œ∏ ‚àà Œòcs , M IDŒ∏s
v
Œ∏s
Ô£±
Ô£¥
0
if Œ∏ ‚àà Œòns ,
Ô£¥
Ô£¥
Q
Ô£¥
v
Ô£≤
if Œ∏ ‚àà Œòas ,
v (1 ‚àí Fv (M IDŒ∏s |Œ∏))
)
(
=
v(s)
Ô£¥
Ô£¥ Q (1 ‚àí F (M IDv |Œ∏)) √ó max 0, Fv(s) (œÑs |Œ∏) ‚àí Fv(s) (M IDŒ∏s |Œ∏)
Ô£¥
if Œ∏ ‚àà Œòcs ,
v
Ô£¥
Œ∏s
v(s)
Ô£≥ v
1 ‚àí Fv(s) (M IDŒ∏s |Œ∏)
Ô£±
0
if Œ∏ ‚àà Œòns
Ô£¥
Ô£¥
Ô£¥
Q
Ô£¥
v
Ô£¥
if Œ∏ ‚àà Œòas
Ô£¥
Ô£≤ Qv (1 ‚àí Fv (M IDŒ∏s |Œ∏))

0
v
if Œ∏ ‚àà Œòcs and v(s) = 0
0, œÑs ‚àí M IDŒ∏s
=
v6=0 (1 ‚àí Fv (M IDŒ∏s |Œ∏)) √ó max
)
(
Ô£¥
v(s)
Ô£¥
Ô£¥
Fv(s) (œÑs |Œ∏) ‚àí Fv(s) (M IDŒ∏s |Œ∏)
Ô£¥ Q
v
Ô£¥
6 0
if Œ∏ ‚àà Œòcs and v(s) =
Ô£¥
Ô£≥ v (1 ‚àí Fv (M IDŒ∏s |Œ∏)) √ó max 0,
v(s)
1 ‚àí Fv(s) (M IDŒ∏s |Œ∏)
where the second equality is by the expressions for Œ¶1 (v) and Œ¶01 established above. The second
v = 1, we have F (M ID v |Œ∏) = 1 and so
last equality is by the following reason: If M IDŒ∏s
v
Œ∏s
v 6= 1, it is true for sure that
ps (Œ∏) = 0, which is nested by the other two cases. Assuming M IDŒ∏s
v < r + 1 for all v (since M ID v < 1 < r + 1). The last equality is because the lottery
M IDŒ∏s
v
v
Œ∏s
number v = 0 uses the known distribution of U [0, 1] and so F0 (r|Œ∏) = r for all r and Œ∏.
A.2.3

Theorem 3

Lemma 3. In the mixed tie-breaking setting of Section 4, consider a continuum economy populated by applicants of type Œ∏ ‚àà Œò to be assigned to schools indexed by s ‚àà S. For all s and Œ∏, for
sufficiently small Œ¥ > 0:
Ô£±
v = 1 or r < M ID v for some v)
0
if Œ∏ ‚àà Œòns or (M IDŒ∏s
v
Ô£¥
Œ∏s
Ô£¥
Ô£¥
v for all v
‚àó
a
v
Ô£¥
Ô£¥
Œ¶
if Œ∏ ‚àà Œòs , M IDŒ∏s 6= 1, and rv ‚â• M IDŒ∏s
Ô£¥
Ô£¥
0
Ô£¥
Ô£¥
œÑ ‚àí M IDŒ∏s
Ô£¥
Ô£¥ Œ¶‚àó √ó max{0, s
Ô£≤
0 }
1 ‚àí M IDŒ∏s
ps (Œ∏, r, Œ¥) =
(13)
v 6= 1, and r ‚â• M ID v for all v
Ô£¥
if v(s) = 0, Œ∏ ‚àà Œòcs , M IDŒ∏s
v
Ô£¥
Œ∏s
Ô£¥
Ô£¥
Fv(s) (œÑs |e(v)) ‚àí Fv(s) (œÑs ‚àí Œ¥|e(v))
Ô£¥
Ô£¥
Ô£¥
Œ¶‚àó √ó
Ô£¥
Ô£¥
Fv(s) (œÑs + Œ¥|e(v)) ‚àí Fv(s) (œÑs ‚àí Œ¥|e(v))
Ô£¥
Ô£¥
Ô£≥
v 6= 1, and r ‚â• M ID v for all v
if v(s) 6= 0, Œ∏ ‚àà Œòcs , M IDŒ∏s
v
Œ∏s
where
‚àó

Œ¶ (v) ‚â°



v + Œ¥|e(v)) ‚àí F (M ID v |e(v))
Fv (M IDŒ∏s
v
Œ∏s
v
v ‚àí Œ¥|e(v))
Fv (M IDŒ∏s + Œ¥|e(v)) ‚àí Fv (M IDŒ∏s
0
Œ¶‚àó ‚â° (1 ‚àí M IDŒ∏s
)Œ†Vv=1 Œ¶‚àó (v)

42

1{M IDv

Œ∏s =rv }

v is equivalent to r + Œ¥ < M ID v for
Proof. The first line follows from the fact that rv < M IDŒ∏s
v
Œ∏s
sufficiently small Œ¥ > 0.
v 6= 1 and r ‚â• M ID v for all v,
To get the remaining lines, note that conditional on M IDŒ∏s
v
Œ∏s
‚àó
v
Œ¶Œ¥ is the same as Œ¶ by the following reason: When M IDŒ∏s = rv , Œ¶Œ¥ (v) is the same as Œ¶‚àó (v)
v = r into the definition of Œ¶ (v); this is true for any fixed Œ¥. Otherwise,
by substituting M IDŒ∏s
v
Œ¥
v < r and so for sufficiently small Œ¥,
M IDŒ∏s
v

Œ¶Œ¥ (v) ‚â°

v |Œ∏), F (r ‚àí Œ¥|Œ∏)}
Fv (rv + Œ¥|Œ∏) ‚àí max{Fv (M IDŒ∏s
Fv (rv + Œ¥|Œ∏) ‚àí Fv (rv ‚àí Œ¥|Œ∏)
v v
=
= 1.
Fv (rv + Œ¥|Œ∏) ‚àí Fv (rv ‚àí Œ¥|Œ∏)
Fv (rv + Œ¥|Œ∏) ‚àí Fv (rv ‚àí Œ¥|Œ∏)

Œ¶‚àó = Œ¶Œ¥ therefore holds and Œ¶‚àó provides the probability of not being assigned to a school
preferred to s.
v and r + Œ¥ > M ID v for
The second line is then by the equivalence between rv > M IDŒ∏s
v
Œ∏s
small enough Œ¥ > 0.
v and r + Œ¥ > M ID v
To see the third line, use the same equivalence between rv > M IDŒ∏s
v
Œ∏s
for small enough Œ¥ > 0 and the fact that if v(s) = 0, then


0 
0 |e(v)) 
œÑs ‚àí M IDŒ∏s
F0 (œÑs |e(v)) ‚àí F0 (M IDŒ∏s
=
max
0,
,
Œ¶0Œ¥ = max 0,
0 |e(v))
0
1 ‚àí F0 (M IDŒ∏s
1 ‚àí M IDŒ∏s
where we use the fact that the lottery number v = 0 uses the known distribution of U [0, 1] and
so F0 (r|Œ∏) = r for all r and Œ∏.
v and
Finally, to see the last line, again note the same equivalence between rv > M IDŒ∏s
v for small enough Œ¥ > 0. Also, if v(s) 6= 0, then for sufficiently small Œ¥ > 0 and
rv + Œ¥ > M IDŒ∏s
any Œ∏ ‚àà Œòcs , which implies œÅŒ∏s = œÅs and rv(s) = œÑs , we have


Fv(s) (œÑs |e(v)) ‚àí Fv(s) (œÑs ‚àí Œ¥|e(v))
Fv(s) (œÑs |e(v)) ‚àí Fv(s) (œÑs ‚àí Œ¥|e(v))
0
Œ¶Œ¥ = max 0,
=
,
Fv(s) (œÑs + Œ¥|e(v)) ‚àí Fv(s) (œÑs ‚àí Œ¥|e(v))
Fv(s) (œÑs + Œ¥|e(v)) ‚àí Fv(s) (œÑs ‚àí Œ¥|e(v))
v 6= œÑ .
where we invoke Assumption 1 (b), which implies M IDŒ∏s
s

In Lemma 3, in the first case, ps (Œ∏, r, Œ¥) is constant (0) for any small enough Œ¥. The constant
value is also the limit ps (Œ∏, r) in this case.
To characterize ps (Œ∏, r) in the remaining cases, note that by the differentiability of Fv (¬∑|e(v))
(recall Assumption 1), L‚ÄôHopital‚Äôs rule implies:
0 (œÑ |e(v))
Fv(s)
Fv(s) (œÑs |e(v)) ‚àí Fv(s) (œÑs ‚àí Œ¥|e(v))
s
= 0.5.
=
lim
0
Œ¥‚Üí0 Fv(s) (œÑs + Œ¥|e(v)) ‚àí Fv(s) (œÑs ‚àí Œ¥|e(v))
2Fv(s) (œÑs |e(v))
v + Œ¥|e(v)) ‚àí F (M ID v |e(v))
v |e(v))
Fv (M IDŒ∏s
Fv0 (M IDŒ∏s
v
Œ∏s
=
v + Œ¥|e(v)) ‚àí F (M ID v ‚àí Œ¥|e(v))
v |e(v)) = 0.5,
Œ¥‚Üí0 Fv (M IDŒ∏s
2Fv0 (M IDŒ∏s
v
Œ∏s

lim

v

which implies limŒ¥‚Üí0 Œ¶‚àó (v) = 0.51{rv =M IDŒ∏s } and so
P

0
lim Œ¶‚àó = (1 ‚àí M IDŒ∏s
)0.5

v

v }
1{rv =M IDŒ∏s

Œ¥‚Üí0

0
= (1 ‚àí M IDŒ∏s
)0.5nŒ∏s (r) .

Combining these limiting facts with Lemma 3 and the fact that the limit of a product of
functions equals the product of the limits, we obtain the following limit propensity score for the
remaining cases:
43

ps (Œ∏, r) =
Ô£±
0
Ô£¥
Ô£¥
Ô£≤
0
0.5mŒ∏s (r) (1 ‚àí M IDŒ∏s
)

m
(r)
0
Œ∏s
Ô£¥
0.5
max
0,
œÑ
‚àí
M IDŒ∏s
s
Ô£¥
Ô£≥
0
0.51+mŒ∏s (r) (1 ‚àí M IDŒ∏s
)

A.2.4

if
if
if
if

(Œ∏, r) ‚àà Œòns
(Œ∏, r) ‚àà Œòas
(Œ∏, r) ‚àà Œòcs
(Œ∏, r) ‚àà Œòcs

or rv
and
and
and

v
v
< M IDŒ∏s
or M IDŒ∏s
= 1 for some v ‚â• 1
v
rv ‚â• M IDŒ∏s 6= 1 for all v ‚â• 1
v
rv ‚â• M IDŒ∏s
6= 1 for all v ‚â• 1 and v(s) = 0
v
rv ‚â• M IDŒ∏s 6= 1 for all v ‚â• 1 and v(s) 6= 0
(14)

Theorem 4

The proof uses a lemma proven below. This lemma shows that the vector of cutoffs computed
for the sampled economy, cÃÇn , converges to the vector of cutoffs in the continuum economy.
a.s.

Lemma 4. (Cutoff almost sure convergence) cÃÇn ‚àí‚Üí c where c denotes the vector of continuum
economy cutoffs.
This result implies Theorem 4. Note first that pÃÇns (Œ∏, r, Œ¥n ) is almost everywhere continuous in
v ), and bandwidth Œ¥ . Since every M ID v
finite sample cutoffs cÃÇn , finite sample MIDs (M IDŒ∏s
n
Œ∏s
is almost everywhere continuous in finite sample cutoffs cÃÇn , pÃÇns (Œ∏, r, Œ¥n ) is almost everywhere
continuous in finite sample cutoffs cÃÇn and bandwidth Œ¥n . Recall Œ¥n ‚Üí 0 by assumption while
a.s.
cÃÇn ‚àí‚Üí c by Lemma 4. Therefore, by the continuous mapping theorem, as n ‚Üí ‚àû, pÃÇns (Œ∏, r, Œ¥n )
almost surely converges to pÃÇns (Œ∏, r, 0) with c replacing cÃÇn , which is ps (Œ∏, r).
Proof of Lemma 4
Lemma 4 is proved using a strategy similar to that used to prove Lemma 3 in Abdulkadiroƒülu et
al. (2017a). Usimg the Extended Continuous Mapping Theorem (Theorem 19.1 in van der Vaart
(2000)), we first show deterministic convergence of cutoffs to ensure the continuous mapping
result is applicable.
Modify the definition of G to describe the distribution of running variables as well as types:
For any set of applicant types Œò0 ‚äÇ Œò and for any numbers r0 , r1 ‚àà [0, 1]V with r0v < r1v for
all v, define the set of applicants of types in Œò0 with random numbers worse than r0 and better
than r1 as
I(Œò0 , r0 , r1 ) = {i ‚àà I | Œ∏i ‚àà Œò0 , rv0 < riv ‚â§ rv1 for all v}.
In a continuum economy,
G(I(Œò0 , r0 , r1 )) = E[1{i ‚àà I(Œò0 , r0 , r1 )}],
where the expectation is assumed to exist. In a finite economy with n applicants,
G(I(Œò0 , r0 , r1 )) =

|I(Œò0 , r0 , r1 )|
.
n

Let G be the set of possible G‚Äôs defined above. For any two distributions G and G0 , the supnorm
metric is defined by
d(G, G0 ) =

sup
Œò0 ‚äÇŒò,r0 ,r1

|G(I(Œò0 , r0 , r1 )) ‚àí G0 (I(Œò0 , r0 , r1 ))|.

‚àà[0,1]V +1

44

The notation is otherwise as in the text.
Consider a deterministic sequence of economies described by a sequence of distributions {gn }
over applicants, together with associated school capacities, so that for all n, gn ‚àà G is a potential
realization produced by randomly drawing n applicants and their running variables from G.
Assume that gn ‚Üí G in metric space (G, d). Let cn denote the admissions cutoffs in gn . Note
the cn is constant because this is the cutoff for a particular realized economy gn .
The proof first shows deterministic convergence of cutoffs for any convergent subsequence
of gn . Let {gÃÉn } be any subsequence of realized economies {gn }. The corresponding cutoffs are
denoted by {cÃÉn }. Let cÃÉ ‚â° (cÃÉs ) be the limit of cÃÉn . The following two claims establish that cÃÉn ‚Üí c,
the cutoff associated with G.
Claim 1. cÃÉs ‚â• cs for every s ‚àà S.
Proof of Claim 1. This is proved by contradiction in three steps. Suppose to the contrary that
cÃÉs < cs for some s. Let S 0 ‚äÇ S be the set of schools the cutoffs of which are strictly lower under
cÃÉ. For any s ‚àà S 0 , define Ins = {i ‚àà I|cÃÉns < œÄŒ∏i s (ri ) ‚â§ cs and i ranks s first} where I is the set of
applicants in G, which contains the set of applicants in gn for all n. In other words, Ins are the
set of applicants ranking school s first who have an applicant rank in between cÃÉns and cs .
Step (a): We first show that for our subsequence, when the market is large enough, there
must be some applicants who are in Ins . That is, there exists N such that for any n > N , we
have gÃÉn (Ins ) > 0 for all s ‚àà S 0 .
To see this, we begin by showing that for all s ‚àà S 0 , there exists N such that for any n > N ,
we have G(Ins ) > 0. Suppose, to the contrary, that there exists s ‚àà S 0 such that for all N ,
there exists n > N such that G(Ins ) = 0. When we consider the subsequence of realized
economies {gÃÉn }, we find that
gÃÉn ({i ‚àà Qs (cn ) such that œÄŒ∏i s (ri ) ‚â§ cs })
= gÃÉn ({i ‚àà Qs (cn ) such that œÄŒ∏i s (ri ) ‚â§ cÃÉns })

(15)

+ gÃÉn ({i ‚àà Qs (cn ) such that cÃÉns < œÄŒ∏i s (ri ) ‚â§ cs })
= gÃÉn ({i ‚àà Qs (cn ) such that œÄŒ∏i s (ri ) ‚â§ cÃÉns })

(16)

‚â§ qs .

(17)

Expression (16) follows from Assumptions 1 and 2 by the following reason. (16) does not
hold, i.e., gÃÉn ({i ‚àà Qs (cn ) such that cÃÉns < œÄŒ∏i s (ri ) ‚â§ cs }) > 0 only if G({i ‚àà I|cÃÉns <
œÄŒ∏i s (ri ) ‚â§ cs }) > 0. This and Assumptions 1 and 2 imply G({i ‚àà I|cÃÉns < œÄŒ∏i s (ri ) ‚â§
cs and i ranks s first}) ‚â° G(Ins ) > 0, a contradiction to G(Ins ) = 0.
Since gÃÉn is realized as n iid samples from G, gÃÉn ({i ‚àà I|cÃÉns < œÄŒ∏i s (ri ) ‚â§ cs }) = 0. Expression
(17) follows by our definition of DA, which can never assign more applicants to a school than
its capacity for each of the n samples. We obtain our contradiction since cÃÉns violates the
definition of DA cutoffs at s in gÃÉn since expression (17) means it is possible to increase the
cutoff cÃÉns to cs without violating the capacity constraint.

45

Given that we‚Äôve just shown that for each s ‚àà S 0 , G(Ins ) > 0 for some n, it is possible to find
an n such that G(Ins ) >  > 0 for some  > 0. Since gn ‚Üí G and so gÃÉn ‚Üí G, there exists N
such that for all n > N , we have gÃÉn (Ins ) > G(Ins ) ‚àí  > 0. Since the number of schools is finite, such N can be taken uniformly over all s ‚àà S. This completes the argument for Step (a).
Step (a) allows us to find some N such that for any n > N , gÃÉn (Ins ) > 0 for all s0 ‚àà S 0 . Let
t
sÃÉn ‚àà S and t be such that cÃÉt‚àí1
ns ‚â• cs for all s ‚àà S and cÃÉnsÃÉn < csÃÉn . That is, sÃÉn is one of the
first schools the cutoff of which falls strictly below csÃÉn under the DA algorithm in gÃÉn , which
happens in round t of the DA algorithm. Such sÃÉn and t exist since the choice of n guarantees
gÃÉn (Ins ) > 0 and so cÃÉns < cs for all s ‚àà S 0 .
Step (b): We next show that there exist infinitely many values of n such that the associated
sÃÉn is in S 0 and gÃÉn (Ins ) > 0 for all s ‚àà S 0 . It is because otherwise, by Step (a), there exists N
such that for all n > N , we have sÃÉn 6‚àà S 0 . Since there are only finitely many schools, {sÃÉn }
has a subsequence {sÃÉm } such that sÃÉm is the same school outside S 0 for all m. By definition
of sÃÉn , cÃÉmsÃÉm ‚â§ cÃÉtmsÃÉm < csÃÉm for all m and so cÃÉsÃÉm < csÃÉm , a contradiction to sÃÉm 6‚àà S 0 . Therefore,
we have our desired conclusion of Step (b).
Fix some n such that the associated sÃÉn is in S 0 and gÃÉn (Ins ) > 0 for all s ‚àà S 0 . Step (b)
guarantees that such n exists. Let AÃÉnsÃÉn and AsÃÉn be the sets of applicants assigned sÃÉn under
gÃÉn and G, respectively. All applicants in InsÃÉn are assigned sÃÉn in G and rejected by sÃÉn in gÃÉn .
Since these applicants rank sÃÉn first, there must exist a positive measure (with respect to gÃÉn )
of applicants outside InsÃÉn who are assigned sÃÉn in gÃÉn and some other school in G; denote the set
of them by AÃÉnsÃÉn \AsÃÉn . gÃÉn (AÃÉnsÃÉn \AsÃÉn ) > 0 since otherwise, for any n such that Step (b) applies,
gÃÉn (AÃÉnsÃÉn ) ‚â§ gÃÉn (AsÃÉn \ InsÃÉn ) = gÃÉn (AsÃÉn ) ‚àí gÃÉn (InsÃÉn ),
which by Step (a) converges to something strictly smaller than G(AsÃÉn ) since
gÃÉn (AsÃÉn ) ‚Üí G(AsÃÉn ) and gÃÉn (InsÃÉn ) > 0 for all large enough n by Step (a). Note that
G(AsÃÉn ) is weakly smaller than qsÃÉn . This implies that for large enough n, gÃÉn (AÃÉnsÃÉn ) < qsÃÉn , a
contradiction to AÃÉnsÃÉn ‚Äôs being the set of applicants assigned sÃÉn at a cutoff strictly smaller
than the largest possible value K + 1. For each i ‚àà AÃÉnsÃÉn \ AsÃÉn , let si be the school to which
i is assigned under G.
Step (c): To complete the argument for Claim 1, we show that some i ‚àà AÃÉnsÃÉn \ AsÃÉn must
have been rejected by si in some step tÃÉ ‚â§ t ‚àí 1 of the DA algorithm in gÃÉn . That is, there
exists i ‚àà AÃÉnsÃÉn \ AsÃÉn and tÃÉ ‚â§ t ‚àí 1 such that œÄisi > cÃÉtÃÉnsi . Suppose to the contrary that for all
i ‚àà AÃÉnsÃÉn \ AsÃÉn and tÃÉ ‚â§ t ‚àí 1, we have œÄisi ‚â§ cÃÉtÃÉnsi . Each such applicant i must prefer si to sÃÉn
because i is assigned si 6= sÃÉn under G though œÄisÃÉn ‚â§ cÃÉnsÃÉn < csÃÉn , where the first inequality
holds because i is assigned sÃÉn in GÃÉn while the second inequality does because sÃÉn ‚àà S 0 . This
implies none of AÃÉnsÃÉn \ AsÃÉn is rejected by si , applies for sÃÉ, and contributes to decreasing cÃÉtnsÃÉn
at least until step t and so cÃÉtnsÃÉn < csÃÉn cannot be the case, a contradiction. Therefore, we
have our desired conclusion of Step (c).

46

Claim 1 can now be established by showing that Step (c) implies there are i ‚àà AÃÉnsÃÉn \ AsÃÉn
and tÃÉ ‚â§ t ‚àí 1 such that œÄisi > cÃÉtÃÉnsi ‚â• cÃÉnsi , where the last inequality is implies by the fact
that in every economy, for all s ‚àà S and t ‚â• 0, we have ct+1
‚â§ cts . Also, they are assigned si
s
in G so that œÄisi ‚â§ csi . These imply csi > cÃÉtÃÉnsi ‚â• cÃÉnsi . That is, the cutoff of si falls below csi
in step tÃÉ ‚â§ t ‚àí 1 < t of the DA algorithm in gÃÉn . This contradicts the definition of sÃÉn and t.
Therefore cÃÉs ‚â• cs for all s ‚àà S, as desired.
Claim 2. By a similar argument, cÃÉs ‚â§ cs for every s ‚àà S.
Since cÃÉs ‚â• cs and cÃÉs ‚â§ cs for all s, it must be the case that cÃÉn ‚Üí c. The following claim uses
this to show that cn ‚Üí c.
Claim 3. If cÃÉn ‚Üí c for every convergent subsequence {cÃÉn } of {cn }, then cn ‚Üí c.
Proof of Claim 3. Since {cn } is bounded in [0, K + 1]|S| , it has a convergent subsequence
by the Bolzano-Weierstrass theorem. Suppose to the contrary that for every convergent
subsequence {cÃÉn }, we have cÃÉn ‚Üí c, but cn 6‚Üí c. Then there exists  > 0 such that for all
k > 0, there exists nk > k such that ||cnk ‚àí c|| ‚â• . Then the subsequence {cnk }k ‚äÇ {cn }
has a convergent subsequence that does not converge to c (since ||cnk ‚àí c|| ‚â•  for all k),
which contradicts the supposition that every convergent subsequence of {cn } converges to
c.
The last step in the proof of Lemma 4 relates this fact to stochastic convergence.
a.s.

Claim 4. cn ‚Üí c implies cÃÇn ‚àí‚Üí c
Proof of Claim 4. This proof is based on two off-the-shelf asymptotic results from mathematical statics. First, let Gn be the distribution over I(Œò0 , r0 , r1 )‚Äôs generated by randomly
drawing n applicants from G. Note that Gn is random since it involves randomly drawing
a.s.
n applicants. Gn ‚Üí G by the Glivenko-Cantelli theorem (Theorem 19.1 in van der Vaart
a.s.
(2000)). Next, since Gn ‚Üí G and cn ‚Üí c, the Extended Continuous Mapping Theorem
a.s.
(Theorem 18.11 in van der Vaart (2000)) implies that cÃÇn ‚àí‚Üí c, completing the proof of
Lemma 4.

47

