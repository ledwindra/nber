NBER WORKING PAPER SERIES

ESTIMATION AND EVALUATION OF CONDITIONAL ASSET PRICING MODELS
Stefan Nagel
Kenneth J. Singleton
Working Paper 16457
http://www.nber.org/papers/w16457

NATIONAL BUREAU OF ECONOMIC RESEARCH
1050 Massachusetts Avenue
Cambridge, MA 02138
October 2010

We are grateful to seminar participants at Baruch College, the Berkeley-Stanford joint nance seminar,
London Business School, Northwestern University, Princeton University, UC San Diego, the National
Bureau of Economic Research, and the Western Finance Association Meetings, as well as to Fousseni
Chabi-Yo, Wayne Ferson, Lars Hansen, the Editor, and two anonymous referees, for helpful comments.
The views expressed herein are those of the authors and do not necessarily reflect the views of the
National Bureau of Economic Research.
NBER working papers are circulated for discussion and comment purposes. They have not been peerreviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.
© 2010 by Stefan Nagel and Kenneth J. Singleton. All rights reserved. Short sections of text, not to
exceed two paragraphs, may be quoted without explicit permission provided that full credit, including
© notice, is given to the source.

Estimation and Evaluation of Conditional Asset Pricing Models
Stefan Nagel and Kenneth J. Singleton
NBER Working Paper No. 16457
October 2010
JEL No. G12
ABSTRACT
We find that several recently proposed consumption-based models of stock returns, when evaluated
using an optimal set of managed portfolios and the associated model-implied conditional moment
restrictions, fail to capture key features of risk premiums in equity markets. To arrive at these conclusions,
we construct an optimal GMM estimator for models in which the stochastic discount factor (SDF)
is a conditionally affine function of a set of priced risk factors. Further, for the (often relevant) case
where a researcher is proposing a generalized SDF relative to some null model, we show that there
is an optimal choice of managed portfolios to use in testing the null against the proposed alternative.

Stefan Nagel
Stanford University
Graduate School of Business
518 Memorial Way
Stanford, CA 94305
and NBER
nagel_stefan@gsb.stanford.edu
Kenneth J. Singleton
Graduate School of Business
Stanford University
Stanford, CA 94305
and NBER
ken@future.stanford.edu

There is a large and growing literature that explores the goodness-of-fit of dynamic asset
pricing models in which the stochastic discount factor (SDF) takes the conditionally
!

affine form mt+1 (θ0 ) = φ0t (θ0 ) + φft (θ0 )ft+1 , where f is the vector of observed “priced”
risk factors, the factor weights (φ0t , φft ! ) are in the modeler’s information set Jt , and
θ0 is an unknown vector of parameters. SDFs of this form are implicit in conditional
versions of the classical CAPM and its multifactor extensions (as posited, for example,
in Fama and French (1996), Jagannathan and Wang (1996), and explored empirically
in Hodrick and Zhang (2001)). They also arise from linearized consumption-based asset
pricing models in which mt+1 is a representative agent’s marginal rate of substitution
(e.g., Lettau and Ludvigson (2001b), and Santos and Veronesi (2006)).
To evaluate the fits of their candidate SDFs, researchers typically posit an Rvector of “test-asset” returns rt+1 , construct GMM estimators θT of θ0 , and then
examine whether the test asset payoffs are correctly priced by the candidate SDF;
!
that is, whether T −1 Tt=1 (mt+1 (θT )rt+1 − p) is close to zero, where p is an R-vector

of prices. Based on these assessments, several candidate SDF s have been found to

adequately describe the unconditional expected returns on common stocks. This lack
of discrimination between models, some with very different economic underpinnings,
is why Daniel and Titman (2006) and Lewellen, Nagel, and Shanken (2010), among
others, have questioned the statistical power of extant tests.
A key premise of this paper is that considerable latitude remains for enhanced
model discrimination by more efficiently exploiting the economic content of the dynamic
pricing relation1
E[mt+1 (θ0 )rt+1 |Jt ] = p.

(1)

Any model satisfying (1) must not only fit the cross-section of average returns, but also

2

the potentially more informative and demanding implied restrictions on the conditional
moments of (mt+1 , rt+1 ). We explore the fit of (1) by examining whether mt+1 (θ0 ),
evaluated at a GMM estimator θT of θ0 , reliably prices managed portfolio payoffs of
the form Bt rt+1 , where Bt ∈ Jt is a state-dependent matrix of portfolio weights.
Heuristically, assessments of whether a candidate SDF accurately prices the payoffs
Bt rt+1 will be more reliable the more precise are the estimates of θ0 . Yet in practice
instrument selection for GMM estimation has not been tied to the specific formulation
of the SDF , other than to include lagged values of returns, consumption growth,
and other variables in Jt that enter mt+1 . In this paper we draw upon the work
of Hansen (1985) and Chamberlain (1987) to show that there is an optimal choice of
instruments in the sense that the resulting GMM estimator has the smallest asymptotic
covariance matrix among all admissible GMM estimators based on the conditional
moment restrictions (1). Importantly, the optimal instruments are not lagged values
of returns or of the variables comprising the SDF . Rather, we will show that they
are nonlinear functions of the conditioning information Jt that are related to the first
!
and second moments of products of returns and factors, rt+1 ft+1
, as suggested by the

restrictions (1) on the conditional distribution of mt+1 (θ0 )rt+1 .
Equipped with the efficient GMM estimator θT∗ , we proceed to construct chi-square
goodness-of-fit tests based on the implication of (1) that a candidate SDF should price
any pre-specified M-vector of managed payoffs Bt rt+1 :

E [mt+1 (θ0 )Bt rt+1 − Bt p] = 0.

(2)

This approach enhances the GMM-based inference strategies used by Hodrick and
Zhang (2001), Lettau and Ludvigson (2001b), and Roussanov (2009), among many

3

others, by using the asymptotically efficient estimator θT∗ of θ0 .
Specializing further, we formalize the connection between maximal efficiency of the
GMM estimator and maximal power of goodness-of-fit tests for the situation where a
researcher is proposing a generalized SDF
mGt+1 (θ0 ) = φ0 (zt ; β0 , γ0) + φf (zt ; β0 , γ0 )ft+1 ,
!

(3)

where zt ∈ Jt , ft+1 is a vector of risk factors, and the null specification mN
t+1 (β0 ) is the
G
nested special case with γ0 = 0; mN
t+1 (β0 ) = mt+1 (β0 , 0). Examples include the condi-

tional consumption CAP M examined by Lettau and Ludvigson (2001b) (zt = CAYt )
where mN
t+1 is the pricing kernel induced by constant relative risk averse preferences.
Also included are the conditional CAPMs of Santos and Veronesi (2006) (zt = the
ratio of labor income to total income) and Jagannathan and Wang (1996) (zt = the
spread on high-yield bonds) where mN
t+1 is the SDF induced by a classical CAPM in
which expected returns are affine functions of their associated unconditional betas.
Similarly, we subsume explorations of the economic significance of expanding the set
of risk factors that are priced. This includes extensions of the conditional CAPM [e.g.,
the inclusion of returns to human capital in Jagannathan and Wang (1996)] or of the
three-factor Fama and French (1992) model [e.g., the inclusion of momentum (Carhart
(1997)) or liquidity (Pastor and Stambaugh (2003)) factors], as well as a linearized
version of the model in Lustig and Van Nieuwerburgh (2006) with preferences defined
over aggregate consumption and housing services.
We show that the W ald and Lagrange-multiplier (LM) tests of the null γ0 = 0 based
on the optimal GMM estimator θ0∗ are the (locally) most powerful chi-square tests
against the alternative hypothesis that the pricing kernel is mGt+1 . Moreover, these op-

4

timal tests can be reinterpreted as tests of the null hypothesis E[Bt∗ (mN
t+1 (β0 )rt+1 −p)] =
0, for suitably chosen Bt∗ ∈ Jt . In this manner we derive an optimal set of managed
portfolios Bt∗ that maximize the power of our proposed chi-square tests of mN
t+1 against
the alternative mGt+1 . The portfolio weights Bt∗ take an economically intuitive form:
letting ht+1 (θ0 ) = (mGt+1 (θ0 )rt+1 − p) denote the population pricing errors for the test
asset returns rt+1 , Bt∗ is proportional to the component of E[∂ht+1 (θ0 )/∂γ|Jt ]—the
expected sensitivity of pricing errors to changes in the parameters governing the extended mGt+1 —that is conditionally orthogonal to its counterpart for the parameters β
of the null specification, E[∂ht+1 (θ0 )/∂β|Jt ]. Thus, the test statistics effectively check
whether the pricing errors in the null model are forecastable using the incremental
information contained in the additional factors of the generalized alternative model.
Maximal power is achieved by using the optimal portfolio weights Bt∗ and evaluating
mt+1 at the efficient GMM estimator θT∗ .
The remainder of this paper is organized as follows. Section I reviews some of the
key properties of conditional affine pricing models that will be needed in subsequent
discussions. In Section II we outline the standard inference strategy of evaluating
dynamic asset pricing models based on the pricing of managed portfolios as in (2).
Then we construct optimal GMM estimators for conditionally affine SDF s. The
characterization of the optimal choice of managed-portfolio weights Bt∗ for maximizing
G
the power of tests of mN
t+1 against the alternative mt+1 is developed in Section III.

We then turn to empirical implementations of our proposed methods in Sections IV
and V. Two different constructions of the optimal instruments and portfolio weights
are explored. One is a nonparametric estimation strategy in which we use local polynomial regressions to approximate conditional moments as a function of the source zt
of the state-dependence of the SDF weights φf (zt , θ0 ). The other is a sieve method in
5

which we approximate conditional moments with a (global) polynomial function of zt ,
consumption growth, and rt . The results suggest that there are substantial gains in efficiency from using the optimal GMM estimator over other standard GMM estimators
that have been used in previous studies. Additionally none of the models examined
pass standard diagnostic chi-square tests when the test assets are portfolios sorted by
firm size and book-to-market and conditional moment restrictions are used in estimation. While these models seemingly do quite well in fitting unconditional moments,
the SDF parameter estimates at which the models produce these small average pricing
errors imply counterfactual variation in conditional moments, which manifests itself as
large and volatile conditional pricing errors. Model estimation and evaluation with
conditional moment restrictions reveals that the models are unable to simultaneously
fit the cross section and time series of asset returns.
Proofs as well as some Monte-Carlo evidence on the small-sample properties of the
optimal GMM estimator are provided in the Internet Appendix.

I

Conditional Factor Models

A now standard approach to testing the cross-sectional implications of (1) is to assume
that the pricing kernel has the conditionally affine structure (3), often with the factor
weights φ̃!t = (φ0t , φft ! ) ∈ Jt also being affine functions of an underlying vector of
conditioning variables zt . Letting f˜t! = (1, ft! ) and “conditioning down” to the modeler’s
information set Jt leads to the following conditional “beta” representation of returns,2
i
J! J
E[rt+1
|Jt ] − rtf = βi,t
λt ,

rtf = 1/E [mt+1 (θ0 )|Jt] ,

6

(4)
(5)

J
!
i
!
where βi,t
= Cov (ft+1 , ft+1
|Jt)−1 Cov (ft+1 , rt+1
|Jt ) and λJt = −rtf Cov (ft+1 , f˜t+1
|Jt )φ̃t .
J
Both βi,t
and λJt are in general state-dependent, and λJt depends on the factor weights

φt when not all of the factors are returns or excess returns on traded portfolios. Therefore, many have followed Cochrane (1996) and imposed special structure on the pricing
kernel that leads to a convenient unconditional factor model for returns.
Specifically, supposing that φ̃t is an affine function of zt , mt+1 can be expressed as
#
mt+1 (θ0 ) = θ! ft+1
.

(6)

#
The K × 1 vector of risk factors ft+1
is built up from zt and ft+1 and products of the

elements of these vectors. Thus the pricing kernel can be thought of as arising from
a K-factor model with constant factor weights (with factors that are dated both at
dates t and t + 1) and where K is larger (potentially much larger) than the number of
factors in the underlying conditional model, F .
Furthermore, substituting (6) into E[ht+1 (θ0 )] = 0 gives the moment equations
# i
E[θ! ft+1
rt+1 ] = 1,

i = 1, . . . , R.

(7)

By the same reasoning leading to (4), but with J = ∅, there exists a scalar µ0 and
constant K × 1 vectors βi# and λ# such that
i
E[rt+1
] − µ0 = βi#! λ# ,

i = 1, . . . , R,

(8)

#
where βi# = Cov( ft# , ft#! )−1 Cov( ft# , rti), and λ# = −µ0 Cov( ft+1
, mt+1 ). Expression

(8) imposes (relatively) easily testable restrictions on the cross-section of expected
excess returns on the R test assets.
7

Tests based on the unconditional moment restriction (8) are omitting two potentially important sources of information about the validity of the underlying conditional
asset pricing models. First the conditional moment restriction (1) leads to the expression (4) for conditional expected excess returns, with potentially state-dependent factor
betas and market prices of risk. That is, potentially informative restrictions across the
conditional first and second moments of the returns and risk factors are being omitted from assessments of goodness-of-fit. Second, implicit in (1) are the links between
rtf and the conditional mean of mt+1 (θ0 )3 (see (5)) and between λJt , the conditional
second moments of ft+1 , and the factor weights φt that determine the pricing kernel.
When ft+1 is a vector of returns or excess returns on traded portfolios, then the latter
restrictions imply a direct link between λJt and the excess returns on these portfolios.
A key premise of our analysis is that examination of the conditional pricing relations
(4) and (5) jointly is potentially more revealing about the strengths and weaknesses
of SDF s as descriptions of history, and about the features of SDF s that are needed
to better match the historical, conditional distribution of returns. Examination of the
joint restriction (4)-(5) is equivalent to examination of the conditional moment restriction (1). Thus, optimal tests based on (1) will be (asymptotically) at least as powerful
as those based on (4), because the former incorporates more of the economic content of
the conditional pricing model. Moreover, (1) embodies substantially more information
than does the orthogonality of mt+1 and excess returns, E[mt+1 (θ0 )(rt+1 − ırtf )|Jt ] = 0.
The latter expression implicitly relaxes the constraint (5) on the conditional mean of
the pricing kernel and, hence, the scale of the pricing kernel cannot be identified.

8

II

Efficient GM M Estimation of Factor Models

Model assessment has frequently focused on whether a candidate SDF mt+1 (θ0 ) accurately prices the portfolio payoffs Bt rt+1 —that is, whether H0 : E[Bt ht+1 (θ0 )] = 0 is
satisfied—for a pre-specified set of managed portfolio weights Bt ∈ Jt . This null hypothesis cannot be examined directly, because θ0 (and hence Bt ht+1 (θ0 )) is unknown.
Standard practice is to first construct a GMM estimator θT of θ0 , and then use the
sample mean of {Bt ht+1 (θT )} to construct a chi-square test of H0 . Owing to the
first-stage estimation of θ0 , this inference strategy involves the joint hypothesis that
Bt rt+1 is accurately priced by mt+1 (θ0 ) and that the moment conditions underlying
the construction of the GMM estimator of θ0 are satisfied. Accordingly, we begin our
discussion of the estimation of θ0 by briefly reviewing the large-samples properties of
chi-square tests constructed in this manner.
Suppose that a GMM estimator of the K-dimensional vector of unknown parameters θ0 governing the SDF is constructed from the moment condition4

E[At ht+1 (θ0 )] = 0,

(9)

for some K × R matrix At with entries in Jt . Since (9) constitutes K equations in the
K unknowns θ0 , we can define the GMM estimator θTA of θ0 , indexed by the modeler’s
choice of instrument process {At }, as the value of θ that solves
T
T
1"
1"
A
At (mt+1 (θT )rt+1 − p) =
At ht+1 (θTA ) = 0.
T t=1
T t=1

9

(10)

Under regularity, the asymptotic covariance matrix of θTA is (Hansen (1982))
#
$−1
#
$−1
∂ht+1 (θ0 )
∂ht+1 (θ0 )! !
A
ΩA
=
E
A
Σ
E
A
,
t
0
0
t
∂θ
∂θ

(11)

! !
ΣA
0 = E[At ht+1 (θ0 )ht+1 (θ0 ) At ].

(12)

where5

With the GMM estimator in hand, assessment of whether a candidate SDF accurately prices the payoffs Bt rt+1 typically involves the computation of a chi-square
statistic based on the sample pricing errors
T
T
1"
1"
A
Bt (mt+1 (θT )rt+1 − p) =
Bt ht+1 (θTA ).
T t=1
T t=1

(13)

In the Internet Appendix A we show that
T
1 "
D
√
Bt ht+1 (θTA ) → N(0, ΓA
0 ),
T t=1

A
A!
ΓA
0 = E[Ct Σt Ct ],

(14)

D

where → denotes convergence in distribution, Σt = E[ht+1 (θ0 )ht+1 (θ0 )! |Jt], and
CtA

& %
&−1
∂ht+1 (θ0 )
∂ht+1 (θ0 )
E At
= Bt − E Bt
At .
∂θ
∂θ
%

(15)

The form of CtA reflects the fact that pre-estimation of θ0 using the instruments At
affects the asymptotic distribution of the sample mean (13). It follows that
(
'
(
T
T
"
1
1 "
−1
√
√
ht+1 (θTA )! Bt! (ΓA
Bt ht+1 (θTA )
τT (B, A) ≡
T)
T t=1
T t=1
'
(
'
(
"
"
1
1
a
−1
√
√
=
ht+1 (θ0 )! CtA! (ΓA
CtA ht+1 (θ0 ) ,
T)
T t
T t
'

10

(16)
(17)

D

a

where = means “asymptotically equivalent to.” By standard arguments τT (B, A) →
χ2 (M), where the degrees of freedom M is determined by the row dimension of the
test matrix Bt .
The joint nature of the null hypothesis that is effectively being tested with the
statistic τ (B, A) is immediately apparent from (17). For τ (B, A) to have an asymptotic
chi-square distribution, it must be the case that

H0 : E

)'

*
& %
&−1 (
∂ht+1 (θ0 )
∂ht+1 (θ0 )
E At
At ht+1 (θ0 ) = 0.
Bt − E Bt
∂θ
∂θ
%

(18)

The first part of this joint null is accurate pricing: E[Bt ht+1 (θ0 )] = 0. The second
piece, E[At ht+1 (θ0 )] = 0, ensures that θTA is a consistent estimator of θ0 . The sample
counterpart of the left-hand side of (18) is (13), because θTA satisfies the first-order
conditions (10). We subsequently exploit the dependence of the power function of this
chi-square test on the choice of (At , Bt ) to derive optimal choices of these matrices.

A

The Optimal GMM Estimator

If we index each estimator θTA by its associated instrument matrix At , then we can
define the admissible class of GMM estimators as6
+
%
&
,
∂ht+1 (θ0 )
A = At ∈ Jt , such that E At
has full rank .
∂θ

(19)

Researchers have considerable latitude in selecting the sequence of matrices {At } to
construct a consistent estimator of θ0 . Elements of At are typically built up from linear
combinations of lagged returns, consumption growth rates, or other macroeconomic
constructs underlying the pricing kernel. We seek the choice of At ∈ A that gives
11

rise to the asymptotically most efficient estimator of θ0 . In so doing, we ensure that
our estimator is at least as efficient as any GMM estimator based on a given set of
instruments wt of any dimension L and the associated L × R orthogonality conditions
E[ht+1 (θ0 ) ⊗ wt ] = 0. This is because the sample moment conditions for any such
“fixed-instrument” GMM estimator (Hansen and Singleton (1982)) can be written in
the form of (10) for an appropriate choice of At ∈ A.7
The most efficient GMM estimator is the one that produces the smallest ΩA
0 by
choice of {At } ∈ A. Fortunately, the solution to this minimization problem has been
characterized (for our case of errors that follow a martingale difference sequence) by
Hansen (1985), Chamberlain (1987), and Hansen, Heaton, and Ogaki (1988). Specifically, the optimal choice is
A∗t

=

−1
Ψθ!
t Σt ,

where

Ψθt

&
∂ht+1 (θ0 ) -≡E
-Jt ,
∂θ
%

(20)

and the associated asymptotic covariance matrix is

. /
01
−1 θ −1
Ω∗0 = E Ψθ!
.
t Σt Ψt

(21)

The first term in the definition of A∗ , Ψθ!
t , captures the sensitivity of ht+1 (θ0 ) to changes
in the parameters. Since, in general, ∂ht+1 (θ0 )/∂θ ∈
/ Jt , the role of the conditional
expectation is to project these partial derivatives onto the econometrician’s information
set (thereby giving admissible instruments).8 The post-multiplication by Σ−1
t serves to
adjust for conditional heteroskedasticity, in a manner exactly analogous to the scaling
of both regressors and errors in the implementation of GLS estimators.
Though at first glance the structure of A∗t may appear to be intractable,9 for models
with conditionally affine pricing kernels of the form (3), the building blocks of A∗t take
12

tractable forms. Specifically, writing mt+1 (θ0 ) = φ̃(zt , θ0 )! f˜t+1 , a typical element of the
first term in (20) takes the form
%

&
- $
∂ φ̃(zt , θ0 )! # ˜
∂hi,t+1 (θ0 ) -Jt =
E
E ft+1 ri,t+1 -Jt .
∂θ0j
∂θ0j

(22)

The functional form of φ̃(zt , θ0 ) is known from the specification of the pricing kernel and,
hence, so are its partial derivatives. Therefore computation of (22) involves computing
the conditional moments of cross-products of asset returns ri,t+1 and the elements of
f˜t+1 . When the factors themselves are excess returns, we are computing conditional
first and second moments of returns. Otherwise we are computing the conditional first
moment of returns, risk factors, and their cross-products. Similarly,
$
#
- 0
/
!
|Jt φ̃(zt , θ0 )
E hi,t+1 (θ0 )hj,t+1 (θ0 )-Jt = φ̃(zt , θ0 )! E ri,t+1 rj,t+1 f˜t+1 f˜t+1
#
$
#
$
− φ̃(zt , θ0 )! E f˜t+1 ri,t+1 |Jt − φ̃(zt , θ0 )! E f˜t+1 rj,t+1 |Jt + 1.

(23)

The first term on the right-hand side of (23) requires the computation of conditional
second moments of returns and cross fourth moments of returns and factors (conditional
means of terms like ri,t+1 rj,t+1 fk,t+1 f#,t+1 ).
The tractability of implementing the optimal GMM estimator for conditionally
affine pricing models warrants special emphasis. There is substantial evidence that
fixed-instrument GMM estimators based on the orthogonality conditions E[ht+1 (θ0 ) ⊗
wt ] = 0 exhibit asymptotic bias as the number of moment conditions grows.10 Intuitively, the sources of this bias are two-fold: (i) the need to pre-estimate the optimal
distance matrix for two-step GMM estimation, and (ii) the fact that the implied matrix At (θT# ) of instruments, evaluated at the first-stage estimator θT# , may be correlated
with the pricing errors ht+1 (θTA ) evaluated at the second-stage GMM estimator (see,
13

e.g., Newey and Smith (2004)).
Our optimal GMM estimator avoids these sources of bias, because there is no firststage estimation of a (potentially large) distance matrix. Moreover, once we have
estimated the conditional moments of the data underlying the components of A∗ , we
proceed to find the θT∗ that solves the sample moment equations (10) with At = A∗t .
That is, we implement what is effectively a continuously-updated GMM estimator
(Hansen, Heaton, and Yaron (1996)). It follows that, by construction, A∗t (θT∗ ) is orthogonal to ht+1 (θT∗ ), thereby removing a key source of bias in GMM estimation.
The conditionally affine structure of the pricing kernel also means that we have
considerable latitude in specifying the functional form for the factor weight φ̃(zt , θ0 ).
Typically linearized versions of consumption-based pricing models assume that φ̃(zt )
is an affine function of zt . More generally, our approach to model evaluation applies
without modification to cases where φ̃(zt ) is a flexible function of zt , represented for
example using Hermite polynomials or Fourier approximations.
The dependence of A∗ on conditional moments does raise the practical question of
whether, in deriving the large-sample distribution of θT∗ , it is presumed that (a) the
components of A∗t (see (20)) are correctly specified, or (b) they are approximated with
a scheme that becomes increasingly accurate as the sample size increases. The first
case arises when a researcher adopts parametric models of Ψθt and Σt . In this case, the
asymptotic covariance matrix of θT∗ is (21).
The second case arises when either nonparametric or semi-nonparametric methods
are used to estimate conditional moments. For a given degree of flexibility in the approximating scheme for the optimal instrument matrix A∗t , our GMM estimators are
consistent and asymptotically normal. Valid inference is possible even if our approximation scheme is not exact by relying on the robust version of the asymptotic covariance
14

in (11) (which is valid for a generic instrument matrix) instead of (21) (which presumes
that the instrument matrix is equal to A∗t ). To investigate the sensitivity of our empirical findings we consider two approximation schemes: local polynomial regression and
a sieve method that uses a global polynomial approximation.
Evaluating τ (B, A) in (16) at the optimal GMM estimator θT∗ gives
τT (B, A∗ ) =

'

T
1 "
√
ht+1 (θT∗ )! Bt!
T t=1

(

. A∗ 1−1
ΓT

'

(
T
1 "
√
Bt ht+1 (θT∗ ) ,
T t=1

(24)

A
where ΓA
= E[CtA Σt CtA ! ]. The robust version of
T is a consistent estimator of Γ0
∗

∗

∗

∗

A
! A!
this chi-square statistic uses a consistent estimator of ΓA
0 = E[Ct ht+1 (θ0 )ht+1 (θ0 ) Ct ]

without presuming that ht+1 (θ0 )ht+1 (θ0 )! can be replaced by Σt .

B

The Wald Test with Maximal Power

Consider again the case where the goal is an evaluation of the improvement in fit of
mGt+1 (β0 , γ0 ), as given by (3), relative to the null specification mN
t+1 (β0 ) obtained as the
special case with γ0 = 0. Suppose that θ0 is estimated by GMM by solving the sample
moment equations (10), for some sequence of K × R instrument matrices {At } with
At ∈ Jt . Under regularity, the asymptotic covariance matrix of θTA is given by (11).
A
Letting ΩA
γγ denote the lower-diagonal G × G block of Ω0 , where G is the dimension

of γ0 , it follows under H0 : γ0 = 0 that
.
1−1
D
ςTW (A) ≡ T γT! ΩA
γT → χ2 (G).
γγ

(25)

The power of the W ald test based on ςTW (A) depends on the choice of instrument
matrix A, consistent with our motivating heuristic that precision in estimation of θ0

15

affects the power of tests of fit. In order to explore this dependence we focus on the local
alternative H1T : mGt+1 (β0 , γ = γTL ), for which the parameter sequence γTL converges to
√
√
the null of γ0 = 0 at the rate T : γTL = δ/ T , for some nonzero G × 1 vector δ of
√ .
1D .
1
proportionality constants.11 Under this local alternative,12 T γTA − γ0 →N δ, ΩA
γγ .
It follows that the asymptotic distribution of ςTW (A) is that of a non-central chi-square
distribution with G degrees of freedom and non-centrality parameter
.
1−1
N C(A) = δ ! ΩA
δ.
γγ

(26)

The power of a chi-square test against a specific alternative is governed by the
magnitude of the non-centrality parameter: the larger the value of N C(A), the more
powerful is the test. An implication of (11) is that N C(A) depends on the choice
of instrument matrix A through the asymptotic covariance matrix of γTA . The more
econometrically efficient is the estimator γTA of γ0 , the smaller is this covariance matrix
and the higher is the power of the associated test based on ςTW (A). Thus, we are led
immediately to the conclusion that GMM estimation using the optimal instruments
A∗t gives the asymptotically (locally) most powerful W ald test of the null specification
G
mN
t+1 against the alternative specification mt+1 .

III

Portfolio Selection for Maximal (Local) Power

Though the construction of the W ald statistic ςTW (A∗ ) might seem far removed from
the discussion in the literature about how to best construct test portfolios in order to
have power against alternative formulations of the pricing kernel, there is in fact an
intimate connection to this issue. Indeed, tests based on ςtW (A∗ ) can be reinterpreted
as tests based on an optimal set of test portfolios.
16

Specifically, using the superscript G to indicate constructs evaluated at the unconstrained θ0 governing mGt+1 , the Wald statistic ςTW (A∗ ) can be expressed in the
asymptotically equivalent form (see Internet Appendix B)
a

ςTW (A∗ ) =

'

T
1 "
√
ht+1 (θ0 )! ΣG−1
HtG
t
T t=1

where

Ω∗γγ

'

(
T
1 " G ! G−1
√
Ht Σt ht+1 (θ0 ) ,
T t=1

(27)

&
&
%
∂ht+1 (β0 , γ0) -∂ht+1 (β0 , γ0 ) -β
J t , Ψt ≡ E
Jt ,
≡E
∂γ
∂β
#
$
.
1−1 βγ
β! −1 γ
≡ E Ψt Σt Ψt , and Ht ≡ Ψγt − Ψβt Kββ
K . Asymptotic equivalence holds
Ψγt

Kβγ

(

%

not only under H0 but under local alternatives as well.

An immediate implication of (27) is that the (locally) most powerful Wald test of
H0 : γ0 = 0 (against the alternative γ0 *= 0) can be viewed as a test of
/
0
E HtG ! ΣG−1
ht+1 (θ0 ) = 0;
t

(28)

that is, the Wald test evaluates whether the managed portfolio returns HtG ! ΣG−1
rt+1 are
t
−1/2!

priced by mGt+1 . Factoring Σ−1
t as Dt

−1/2

weights represents the part of Dt

−1/2

Dt

, the component D −1/2 HtG of the portfolio
−1/2

Ψγt that is orthogonal to Dt

Ψβt . Thus, it is as if

G−1
E[D −1/2 Ψβ!
ht+1 (θ0 )] = 0 captures the economic content of the null specification
t Σt
−1/2

mN
t+1 , and the Wald test uses the part of Dt

Ψγt that is orthogonal to this null

information to evaluate whether mGt+1 adds incrementally to pricing performance.
As an illustration of this optimality result, consider an extended consumption-based
pricing kernel in which ct denotes the logarithm of consumption and
mGt+1 (θ0 ) = (β1 + γ1 zt ) + (β2 + γ2 zt ) ∆ct+1 .

17

(29)

The model in Lettau and Ludvigson (2001b), for example, is the special case with zt
equal to cay. These extensions add no explanatory power to the (linearized) consumptionbased model with constant relative risk aversion if (γ1 , γ2 ) = 0. For this setup,
%

&
%
&
∂ht+1
∂ht+1
E
(θ0 ) Jt = E [rt+1 | Jt ] , E
(θ0 ) Jt = E [∆ct+1 rt+1 | Jt ] , (30)
∂β1
∂β2
%
&
%
&
∂ht+1
∂ht+1
E
(θ0 ) Jt = E[rt+1 zt | Jt ], E
(θ0 ) Jt = E [∆ct+1 rt+1 zt | Jt ] ,(31)
∂γ1
∂γ2
where rt+1 is the vector of test assets used to estimate and evaluate the fit of the
pricing model. Thus the optimal dynamic trading strategies are constructed using the
components of the E[rt+1 zt | Jt ] and E[∆ct+1 rt+1 zt | Jt ] that are orthogonal (in a linear
projection sense) to the information contained in E[rt+1 | Jt ] and E[∆ct+1 rt+1 | Jt ].13
Our construction of optimal test portfolios differs from strategies typically employed in testing unconditional factor models based on the vector of pseudo-factors
(zt , ∆ct+1 , ∆ct+1 zt ) (see Section I) in several important respects. The construction of
portfolio weights Ht is explicitly linked to the contribution of new (pseudo) factors zt
and ∆ct+1 zt to the reduction in the model’s pricing errors. In the sense made precise by
the form of Ht only the new information in these factors over and above what is already
captured by the extant factor ∆ct+1 is examined. Equally importantly, it is not the
projection of the factors themselves onto Jt that is relevant for portfolio construction,
but rather the return-augmented projections E[rt+1 zt | Jt ] and E[∆ct+1 rt+1 zt | Jt ] are
used. Among other considerations, this observation leads us to examine the conditional
second moment E[∆ct+1 rt+1 | Jt ] when constructing Ht . It is these interaction effects
that tie Ht to the model’s pricing errors and lead to the dynamic test portfolios that
maximize power against the proposed alternative model with (γ1 , γ2 ) *= 0.
As a second illustration, suppose that a researcher is interested in evaluating the
18

incremental contribution of a new risk factor f to the pricing of the test assets with
returns rt+1 . A very simple version of this scenario has

mt+1 (θ0 ) = β1 + β2 ∆ct+1 + γ1 ft+1 .

(32)

For this example, the relevant expressions related to β0 are identical to (30) and
&
∂ht+1
(θ0 ) Jt = E[rt+1 ft+1 | Jt ].
E
∂γ1
%

(33)

Thus, the optimal dynamic test portfolio is constructed by examining the component
of E[rt+1 ft+1 | Jt ] that is orthogonal to E[rt+1 | Jt ] and E[∆ct+1 rt+1 | Jt ]. Again this
construction calls for an exploration of the conditional second-moment properties of
the returns and risk factors (both ∆ct+1 and the new factor ft+1 ).

A

Optimal Test Portfolios as Lagrange Multipliers

An alternative approach to deriving the optimal test portfolios starts with constrained
estimates using mt+1 = mN
t+1 , and then inquires whether adding additional risk factors
or conditioning information in the factor weights improves pricing. This question can
be addressed with the LM test.
In Internet Appendix C we show that the Lagrange multiplier for the constraints
γT = 0 can be expressed as

λT =

"
1 " γ! N −1 N
a 1
−1 N
Ψt Σt ht+1 (βT ) =
HtN ! ΣN
ht+1 (β0 ),
t
T t
T t

(34)

where HtN is the matrix Ht evaluated at the constrained (β0 , γ0 = 0). Therefore, under
H0 , the asymptotic distribution of λT is normal with mean zero and covariance matrix
19

−1 N
E[HtN ! ΣN
Ht ], from which it follows that
t

ςTLM (A∗ ) = T λ!T

'

1 " N ! N N −1 N N N
Ht (βT )Σt (βT )Ht (βT )
T t

(−1

D

λT → χ2 (G).

(35)

Summarizing our results,
ςTW (A∗ )

is asymptotically equivalent to

τ (HtG ! (θ0 )ΣG−1
(θ0 ), A∗ )
t

ςTLM (A∗ )

is asymptotically equivalent to

−1
τ (HtN ! (β0 )ΣN
(β0 ), A∗ ).
t

Both tests effectively assess whether the managed portfolio returns Ht! Σ−1
t rt+1 are correctly priced by mt+1 . The difference is that the (locally) most powerful, managed
portfolio weights HtG ! ΣG−1
underlying the W ald test are evaluated at θ0 , whereas the
t
−1
weights HtN ! ΣN
used to construct the LM statistic are evaluated at γ0 = 0. It follows
t

immediately that the W ald and LM statistics have the same asymptotic distribution
under H0 and local alternatives.

B

Wald and LM Tests for “Completely” Affine SDF s

For the special case in which the factor weights φ0 (zt , θ0 ) and φf (zt , θ0 ) are affine
functions of zt ,14 and thus mGt+1 can be expressed as a higher dimensional factor model
with constant coefficients as in (6), the sample optimal W ald and LM tests take a
particularly revealing form that further highlights the structure of the optimal portfolio
weights. Since these representations hold exactly for the sample statistics, as contrasted
with results for asymptotically equivalent expansions, they are useful for interpreting
the subsequent empirical examples.

20

Assume that the SDF under the alternative can be expressed as
#N
#G
+ γ0! ft+1
,
mGt+1 (θ0 ) = β0! ft+1

(36)

and mN
t+1 (β0 ) is again the special case of γ0 = 0. With state-dependent weights on
the actual risk factors ft+1 , the pseudo-factors f #N and f #G are composed of components of ft+1 and the conditioning variables zt determining the factor weights, and
N
N
N
their cross-products. Let (Σ̂Gt , hGt+1 (θTG ), θTG ) and (Σ̂N
t , ht+1 (βT ), βT ) be the estimated

conditional pricing error second moment matrix, realized pricing errors, and optimal
GMM estimates when estimation is done under the alternative (G) and with the null
γ0 = 0 (N ) imposed.
Solving for the sample moment condition defining the optimal GMM estimate θTG
for the G-subvector γTG gives15

γTG

= [0, IG ]
=

Ω̂Gγγ

'

T
1 " θ! G−1
#!
Ψ̂t Σ̂t rt+1 ft+1
T t=1

T
1 " 2 G G ! G−1
H (θ ) Σ̂ p,
T t=1 t T t

(−1

T
1 " θ! G−1
Ψ̂ Σ̂ p
T t=1 t t

γβ
ββ −1 β!
2tG (θG ) ≡ Ψ̂γ!
where H
t − K̂T (K̂T ) Ψ̂t and it is now understood that
T

K̂Tγβ (θTG )

T
$
1 " # γ! G−1
#N !
≡
Ψ̂t Σ̂t rt+1 ft+1
,
T t=1

(37)

G−1 β
the robust, sample version of E[Ψγ!
Ψt ], and similarly for K̂Tββ (θTG ). Note that, for
t Σt

this completely affine setting, the matrices Ψ̂γt and Ψ̂βt are the same whether they are

21

evaluated under the null or the alternative. Substitution into (25) gives

ςTW = T

'

T
1 " 2 G G−1
H Σ̂ p
T t=1 t t

(! '

T
1 " 2 G G−1 2 G !
H Σ̂ Ht
T t=1 t t

(−1 '

(
T
1 " 2 G G−1
H Σ̂ p .
T t=1 t t

(38)

Now, as shown in Internet Appendix D, for a completely affine SDF ,
T
T
1 " 2 G G−1
1 " 2 G G−1 N . N 1
H Σ̂ p =
H Σ̂ ht+1 βT .
T t=1 t t
T t=1 t t

(39)

Thus, we can interpret the sample W ald statistic as checking whether the SDF under
2tG Σ̂G−1
H0 prices the managed portfolios BtW ald = H
evaluated at θTG . Recall from
t
Section A that the sample moment entering the LM statistic ςTLM is16
T
1 " 2 N N −1 N . N 1
1 " γ! N −1 N
Ψt Σ̂t ht+1 (βTN ) =
H Σ̂
ht+1 βT .
T t
T t=1 t t

(40)

This expression is identical to (39), except that the managed portfolio weights BtLM =
−1
2 N Σ̂N
H
are evaluated under the null at βTN . Similarly the matrices that define the
t
t

quadratic forms ςTW and ςTLM are identical, except again they are evaluated at θTG and

βTN , respectively. Thus, to the extent that there are conflicts between these tests in
evaluating the goodness-of-fit of an SDF , it is a consequence of the use of different
estimates of the parameters to define the sample weights of the managed portfolios or
the distance matrices in the quadratic forms. Both tests are constructed with identical
pricing errors, namely those under H0 .

22

IV

Implementation: Methods and Data

In our empirical analysis, we consider several linearized consumption-based SDF s that
have been proposed in the recent literature. The factor weights of each of these pricing
kernels are affine functions of a (scalar) conditioning variable zt ,
mGt+1 (θ0 ) = (β1 + γ1 zt ) + (β2 + γ2 zt ) ∆ct+1 .

(41)

We consider three choices of zt : the consumption-wealth ratio of Lettau and Ludvigson
(2001a) (cayt ), the corporate bond spread as in Jagannathan and Wang (1996) (deft ),
or the labor income-consumption ratio of Santos and Veronesi (2006) (yct ).17
Our sample period runs from 1952:2 to 2006:4, and we construct a quarterly log
consumption growth series for this period from nondurables and services consumption,
seasonally adjusted, per capita, and in 2000 chained dollars, as reported by the Bureau
of Economic Analysis. We obtain a series of cayt from Martin Lettau’s website. The
deft series is the spread in yields between Baa- and Aaa-rated bonds, obtained from
the Federal Reserve Bank of St. Louis. Finally, following Santos and Veronesi (2006),
we calculate yct using labor income defined as the labor income component of cayt and
with data from the Bureau of Economic Analysis.
The “primitive” returns that enter the construction of the portfolios with maximal
power can be those on individual common stocks or portfolios of these stocks. While
in principle it seems desirable to work with relatively disaggregated portfolios so that
the nature of the SDF is central to determining the weights on the traded securities,
computational considerations may lead one to partially aggregate assets into test portfolios and then to apply the optimal weights BtW ald or BtLM to the latter portfolios. To
illustrate our methods we follow the latter approach and use the three-month Trea23

sury Bill and common stock portfolios sorted by firm size and book-to-market equity
as test assets. More specifically, we choose the small-value, small-growth, large-value,
and large-growth portfolios from the six portfolios of Fama and French (1993) as our
equity test portfolios. Restricting the set of equity portfolios to these four allows us to
keep the number of assets low (small R), but still capture most of the cross-sectional
variation in returns related to the “size” and “value” effects. Including a larger number
of size and book-to-market portfolios would not add much additional return variation,
due to the strong commonality in the returns of these portfolios (Fama and French
(1993); Lewellen, Nagel, and Shanken (2010)). By construction of BtW ald and BtLM ,
we are asking candidate SDF s to explain not only the cross-section of unconditional
moments of returns, but also their conditional moments.
We compound monthly stock portfolio returns to obtain quarterly returns from
1952:2 to 2006:4 (in tests that use lagged returns as instruments we also use returns
from quarter 1952:1 as instruments). Nominal returns are deflated by the quarterly
CP I inflation rate to obtain ex-post real returns. To distinguish how well the candidate
models do in fitting the return on T-Bills and the return premia of stocks over and
above T-Bill returns, we use returns in excess of T-Bill returns for the four equity
portfolios (i.e., payoffs with a price of zero), and the gross real return for T-Bills (i.e.,
a payoff with price of one).

A

Estimation of Conditional Moments

Implementation of the optimal estimator requires estimates of the conditional moments
4- &!
&
%3
!
∂ φ̃ (zt , θ0 )!
∂ht+1 (θ0 )! -rt+1
E
E
- Jt ,
-Jt =
!
∂θ0
∂θ0
∆ct+1 rt+1
%

24

(42)

and
!

Var [ht+1 (θ0 ) |Jt ] = φ̃ (zt , θ0 ) Var

%3

4 &
rt+1
|Jt φ̃ (zt , θ0 ) ,
∆ct+1 rt+1

(43)

where ∂ φ̃ (zt , θ0 )! /∂θ0 = (I2 ⊗ z̃t! ), z̃t! = (1, zt ), for the affine pricing kernels (41) that
we consider here. In our empirical implementation, we work with Var [ht+1 (θ0 ) |Jt ] in/
0
stead of the uncentered E ht+1 (θ0 ) ht+1 (θ0 )! |Jt . Both are equivalent under the null
hypothesis, but the centered Var [ht+1 (θ0 ) |Jt ] should be better behaved under misspec-

ification. To construct estimates of (42) and (43), we need estimates of the conditional
!
!
!
!
moments E[(rt+1
, ∆ct+1 rt+1
)! |Jt ] and Var[(rt+1
, ∆ct+1 rt+1
)! |Jt ]. We use nonparametric

local polynomial regression estimators of these moments, as well as as a sieve method
that uses a global polynomial approximation.18
Nonparametric estimators converge asymptotically, under regularity and as the
flexibility of the approximating conditional moment functions increases with sample
size, to the true moments conditional on Jt . The downside is that computational
considerations typically dictate that nonparametric estimation must focus on a small
number of conditioning variables. In our implementation we restrict ourselves to just
one conditioning variable. For each of the three pricing kernels, we condition moments
on zt , i.e., the conditioning variable cayt , deft , or yct that appears in the pricing kernel.
The dependence of the SDF weights on zt means that, if these models are correctly
specified, conditional moments of returns and consumption are likely to vary with zt .
!
!
To estimate g (zt ) ≡ E[(rt+1
, ∆ct+1 rt+1
)! |zt ], we run local linear regressions of the
. !
1!
!
elements of yt+1 ≡ rt+1
, ∆ct+1 rt+1
on zt . Local linear regression has several desirable

properties, including better behavior at the boundaries of the state space compared
with fitting a local constant (Fan (1992)). To obtain the estimates ĝ (zt ) of the con-

ditional mean function, a linear regression is estimated locally, with weighted least

25

squares in a fixed neighborhood around zt , where the neighborhood is defined in terms
of the distance |zj − zt |, not proximity in time. The weights are determined by the
kernel function, the distance |zj − zt |, and the bandwidth b. The fitted value at zt
yields the conditional moment estimate ĝ (zt ).
We use the Epanechnikov kernel function,

K (u) =

1
3.
1 − u2 I (|u| ≤ 1) ,
4

where u ≡ |zj − zt | /b. The bandwidth b determines the weighting of the neighborhood
observations around each point zt , and hence the smoothness of the estimated function.
Regarding the choice of b, our experience from the simulations reported in Internet
Appendix F suggests that in small samples the optimal GMM estimator is better
behaved numerically when we impose a common bandwidth bk for each pair yk,t+1 =
. !
1!
!
rk,t+1, ∆ct+1 rk,t+1
corresponding to asset k. Effectively, this means that for each asset
!
!
k, the two conditional moments in gk (zt ) = E[(rk,t+1
, ∆ct+1 rk,t+1
)! |zt ] are estimated

from the same local neighborhood around zt . To determine the optimal bandwidth b∗k ,
we use automatic bandwidth selection by leave-one-out cross-validation, i.e.,

b∗k

T
1"
{yk,t+1 − ĝk,−t (zt )}! V −1 {yk,t+1 − ĝk,−t (zt )} ,
= arg min
bk T
t=1

where ĝk,−t (zt ) denotes the local linear regression estimate of gk (zt ) that is obtained
with bandwidth bk and with observation t excluded from the estimation.19 The matrix
V is diagonal, with the vector of sample variances of yk,t+1 on the diagonal. As T → ∞,
and more and more observations exist in the neighborhood of zt , the optimal bandwidth
shrinks, and the nonparametric regression estimates converge to the true conditional
moments.
26

!
!
To estimate Ω (zt ) ≡ Var[(rt+1
, ∆ct+1 rt+1
)! |zt ] we calculate the residuals yt+1 −

ĝ (zt ) from the “first step” local regressions, and we use all elements of the crossproduct matrix of these residuals as the dependent variables for “second step” local
regressions. We make two modifications compared with the “first step” methodology
to ensure that our estimated matrices Ω̂ (zt ) are positive semi-definite: We fit a local
constant instead of a local linear regression and we use a common bandwidth for all
elements of Ω̂ (zt ). Fitting a local constant with a common bandwidth for all elements of
Ω̂ (zt ) is equivalent to estimating a sample covariance matrix in the usual way (albeit
with weighted observations, and only those in a neighborhood of zt ), which ensures
positive semi-definiteness. Similar to the first-step estimation of g (zt ), we also use an
Epanechnikov kernel for Ω (zt ). The common optimal bandwidth is chosen according
to a likelihood-type criterion as

b∗Ω

T
-6$
51 "#
{yt+1 − ĝ (zt )}! Ω̂−t (zt )−1 {yt+1 − ĝ (zt )} + log -Ω̂−t (zt )- ,
= arg min
bΩ T
t=1

where Ω̂−t (zt ) denotes the estimate of Ω (zt ) obtained with bandwidth bΩ and observation t omitted.
Figure 1 plots the nonparametric estimates of E [rt+1 |zt ] (a subvector of g (zt )),
where zt is set to cayt , deft , and yct in the top, middle, and bottom graphs, respectively. The left-hand graphs depict the fitted conditional expected excess returns of
the four stock portfolios, and the right-hand graphs show the fitted conditional expected gross return on the T-Bill. The relationships between cayt and yct and the
stock portfolio returns and the T-Bill return reveal some non-linearities. For deft , the
local polynomial regressions indicate only slight non-linearity. In this case, the estimated optimal bandwidths for the stock portfolio returns are sufficiently high so that

27

the local linear regression essentially turns into a globally linear regression.
[Figure 1 about here]
[Figure 2 about here]
Figure 2 plots the nonparametric estimates of E [∆ct+1 rt+1 |zt ] (a subvector of g (zt )).
In this case there are pronounced non-linearities for all three conditioning variables.20
While there are some cross-sectional differences in the relationships between returns
and the predictors, most of the variation in the fitted conditional cross-products is
common to the four stock portfolios.
Overall, the nonparametric regressions pick up considerable time-variation in conditional moments related to cay, def , and yc. This suggests that conditional moment
restrictions constructed with these estimated conditional moments are likely to present
a more serious challenge to the asset-pricing models than the restriction that the unconditional means of the pricing errors are zero.
Our nonparametric estimates for Ω (zt ), in contrast, do not pick up much timevariation. The bandwidth for Ω (zt ) chosen by the optimal bandwidth selection algorithm is between three and four times the sample range of for all three predictors.
This means that the estimated Ω (zt ) is essentially the unconditional sample covariance
matrix. Not surprisingly then, our subsequent asset-pricing results are virtually identical if one estimates Ω (zt ) with the time-constant unconditional sample covariance
matrix. The power of our optimal instruments estimator therefore derives mainly from
time-variation in g (zt ), i.e., from predictability of returns and cross-products of returns
and consumption growth, not from time-variation in the higher moments captured by
Ω (zt ).
As an alternative to the local polynomial estimates of conditional moments we
28

employ a sieve estimator that relies on a global polynomial approximation. For this
construction we assume that E [rt+1 |Jt] and E [rt+1 ∆ct+1 |Jt ] have the functional forms
of linear projections onto xt ≡ (rt , ∆ct , zt , zt2 , (zt − min(zt ) + 0.01)−1).21 For each of the
elements of yt+1 , we use the Akaike Information Criterion (AIC) to select regressors.
The regressor selection by AIC plays a similar role as optimal bandwidth estimation
by cross-validation does in our local regression method. Both have the property that
they would allow the approximation of conditional moments to become increasingly
flexible with increasing sample size.
We use the sample covariance matrix of the residuals from these regressions to
!
!
construct Var[(rt+1
, ∆ct+1 rt+1
)! |Jt]. Thus, we assume that this conditional covariance

matrix is constant. This assumption is motivated by the lack of evidence of timevariation in Ω (zt ) in the local regression case discussed above, as well as a paucity
of evidence for significant conditional heteroskedasticity in quarterly returns and consumption growth.22
While this sieve method is potentially less flexible in adapting to highly non-linear
dependence on zt than the local regression method, it allows us to condition on a
broader set of instruments that includes (rt , ∆ct ). The resulting estimates of E [rt+1 |Jt ]
and E [rt+1 ∆ct+1 |Jt ] capture well the linear, parabolic, and “S on its side” patterns
displayed in Figures 1 and 2, but they also capture some additional variation in conditional moments due to the conditioning on lagged returns and consumption growth.
We emphasize again that, for valid inference, it is not necessary to assume that the
approximation of A∗t constructed from these conditional moment estimators perfectly
matches the population counterpart A∗t . In cases where one is concerned about the
accuracy of these approximations in small samples, robust statistics should be used
that are valid even if the approximation accuracy is poor (see Internet Appendix E).
29

B

Estimators and Test Statistics

We present results for four different estimators: One (denoted “unconditional”) is based
on the R unconditional moment restrictions,

E [mt+1 (θ0 ) rt+1 − p] = 0,

(44)

where the elements of p are 1 for gross returns and 0 for excess returns. The second
(denoted “fixed IV”) is based on the LR moment restrictions,

E [(mt+1 (θ0 ) rt+1 − p) ⊗ wt ] = 0,

(45)

where wt = (1, rt! , ∆ct , zt )! is an L × 1 vector, and zt equals cayt , deft , or yct, depending
on the asset-pricing model. Our third estimator (denoted “optimal IV – local”) is our
optimal GMM estimator, based on the K moment restrictions
E [A∗t (mt+1 (θ0 ) rt+1 − p)] = 0,

(46)

and conditional moments estimated with local polynomial regressions. Finally, we let
“optimal IV – sieve” denote the optimal GMM estimator that employs conditional
moments estimated with the sieve method.
In the cases of the unconditional and fixed IV estimators, we iterate on the associated distance matrices until convergence. In the case of the optimal GMM estimators,
we solve K equations in the K unknowns θT with both A∗t and mt+1 depending on θT
and, thus, this calculation is analogous to the continuously-updated GMM estimator.
The discussion of the small-sample simulations in Internet Appendix F discusses some
of the practical issues that can arise in the numerical solution of these equations.
30

[Table I about here]
For each of the choices of GMM estimator θTA we present three test statistics for
model evaluation: τT (I), for the null hypothesis that the means of the “pricing errors”
(44) or (45) are zero; and the Wald and LM statistics, τT (B W ald ) and τT (B LM ), for
the joint test that the SDF parameters γ1 = 0 and γ2 = 0. All three of these statistics
are variants of our general specification test based on a test matrix Bt ,

τT (B, A) =

'

T
1 "
√
ht+1 (θTA )! Bt!
T t=1

(

−1
(ΓA
T)

'

(
T
1 "
√
Bt ht+1 (θTA ) .
T t=1

(47)

Table I summarizes the ingredients that enter into the calculation of the test statistics. Their construction differs depending on the estimator (unconditional, fixed IV, or
optimal IV). For the unconditional and fixed IV estimators, τT (I) represents Hansen’s
J-test statistic. The statistics τT (B W ald ) and τT (B LM ) are calculated with unconditional moments for the unconditional and fixed IV estimators, and with conditional
moments for the optimal IV estimator.
Our baseline standard errors and the test statistics are computed in their robust
forms, without relying on the assumption that the conditional moments are correctly
specified, but for the optimal IV estimators we also report results based on the latter
assumption. Appendix E provides the details.

V

Implementation: Results

As a basis for comparing models with time-varying SDF factor weights, we start by
estimating the constant-weight consumption CAP M, which is obtained by setting
γ1 = 0 and γ2 = 0 in the pricing kernel (41). We focus on the conditioning variable
31

zt = cayt as the estimators conditioned on deft or yct give very similar results.
In the case of estimation based on unconditional moment restrictions, the estimated
coefficient on consumption growth lies within the economically admissible region (Table II), but its magnitude is implausibly large in absolute value, 365. On the other
hand, when estimation is based both on the cross-section of mean pricing errors and
the models’ restrictions on the conditional distributions of returns (fixed IV and optimal IV), the implied consumption risk premium is almost zero. This pattern is very
similar to previous results from estimating consumption-based Euler equations with
CRRA preferences. Grossman and Shiller (1981) find an unreasonably high relative
risk aversion coefficient based on unconditional moment restrictions, while Hansen and
Singleton (1982) work with conditional moment restrictions and obtain an estimate
that is much closer to zero. Again, consistent with this prior literature, the test statistics τ (I) constructed with all three estimators suggest that CRRA preferences fail to
describe the real returns on common stocks and Treasury bills.
[Table II about here]
The results with time-varying SDF factor weights are displayed in Tables III, IV,
and V for conditioning variables cay, def , and yc, respectively. A common feature
of the results for all three conditioning variables is that the standard errors of the
SDF parameters are notably larger in the case of the unconditional estimator than
for either the fixed IV or optimal IV estimators. This is reflected in the relatively
small magnitudes of τT (B W ald ) and τT (B LM ) and the lack of evidence against the null
hypothesis that (γ1 , γ2) = 0, regardless of the choice of conditioning variable zt , with
the exception of τT (B LM ) for cay, which has a p-value of 0.02. Based on this evidence
from the unconditional estimator, one would reasonably be led to conclude that one
32

cannot have much statistical confidence that the three enhanced consumption-based
models improve pricing over and above the simpler model with CRRA preferences.
[Table III about here]
Substantially different estimates, with correspondingly smaller estimated standard
errors, are obtained when conditioning information is used to construct the fixed IV and
optimal GMM estimators. For the Lettau and Ludvigson (2001b) model in Table III
with zt = cayt , the τT (B W ald ) and τT (B LM ) statistics provide some evidence to reject
the null of the basic CRRA model in favor of the extended model, but more so for
fixed IV than for optimal IV. With zt = deft and zt = yct in Tables IV and V, the
picture is also mixed, with some support for a rejection of (γ1 , γ2 ) = 0 with fixed IV
and optimal IV - sieve, but not with optimal IV - local.
However this indication that conditioning the SDF on zt may help in pricing the
test assets must be interpreted with caution, because of the evidence from the overall
goodness-of-fit statistic τT (I). For all three models, when conditioning information
is incorporated in estimation, this statistic is large relative to its degrees of freedom,
indicating failure of these models at conventional significance levels. Only in the case
of zt = cayt and estimation based on unconditional moments does the evidence suggest
that the pricing model adequately describes expected returns. In this case it appears
to be a relative lack of power when estimation is based on unconditional moment
restrictions, and not the actual success of the Lettau and Ludvigson (2001b) model,
that explains their findings and ours.
The W ald and LM tests provide a complementary perspective in circumstances
where power of overall goodness-of-fit tests may be an issue, as these tests may point
to non-rejection of the simpler null model. This is what we find for the Lettau and Lud33

vigson (2001b) model with unconditional moment restrictions: The overall goodnessof-fit statistic τT (I) does not reject the extended model, while at the same time the
W ald test does not indicate that the extension of the model beyond the basic CRRA
model helps in pricing the test assets, consistent with a lack of power.
[Table IV about here]
Looking across the three models, the point estimates of the parameters based on
the optimal IV - local and optimal IV - sieve estimators are quite close to each other,
and the fixed IV estimates are also much closer to the optimal IV estimates than
the unconditional ones. The finding that the fixed IV and optimal IV estimators
produce results that are quite similar raises the question of under what circumstances
the optimal IV estimator provides an efficiency gain over fixed IV estimators. In
general, as in our specific application, this will depend on the choice of fixed instruments
wt (on their functional dependence on information in Jt ).
To illustrate this sensitivity, recall that Lettau and Ludvigson (2001b) find that
the fit of their model evaluated at the fixed IV estimator with wt = (1, 1 +

cay !
)
σ(cay)

is

comparable to the fit obtained with their unconditional estimator. A similar pattern
cay !
) yields τT (I) =
appears in our data. The fixed IV estimator based on wt = (1, 1+ σ(cay)

18.48 (p-value 0.01), which is much closer to the τT (I) from the unconditional method
than the τT (I) from our baseline fixed IV results reported in Table III. Even though
cay !
the fixed IV estimator with wt = (1, 1 + σ(cay)
) conditions on the same information set

as our optimal IV - local estimator, it appears to have much less power. Our strategy
removes the arbitrariness of many past choices of wt by directing attention to the choice
that maximizes the (local) power of chi-square tests of fit.
In addition, even though our baseline fixed IV estimator produces SDF parameter
34

estimates that are close to those from the optimal IV estimators, the optimal estimators based on the sieve method (which use the same information set as the fixed IV
estimator) often produce considerably smaller standard errors. This finding supports
our premise that the incorporation of conditioning information in a manner that allows researchers to achieve the asymptotic efficiency bounds improves the reliability
of estimation. The optimal IV - local estimator is more difficult to compare in this
respect because it conditions on a smaller information set (only zt ) than the fixed IV
estimator.
Comparing the optimal GMM estimators based on the local regression and sieve
methods, the similarity of the point estimates (relative to the unconditional estimates)
is encouraging as there is some robustness to the precise specification of the model of
the conditional moments. The lower standard errors from the sieve method could be
!
!
an indication that conditioning E[(rt+1
, ∆ct+1 rt+1
)! |Jt ] on the history of past returns

and consumption growth in addition to zt leads to some additional efficiency gains.
It is also noteworthy that the difference between the robust standard errors and
test statistics and those that assume correctly specified conditional moments is, in most
cases, quite small, particularly relative to the differences in standard errors between the
unconditional, fixed IV, and optimal IV estimators. This suggests that our methods
of empirically approximating the conditional moments work reasonably well.
[Table V about here]

A

Conditional Pricing Errors

The main motivation for moving from simple constant-weight pricing kernels to models
with time-varying weights is to obtain a more flexible asset-pricing model that is in
35

better accordance with the data, in the cross-section of unconditional moments, but
also the time-series of conditional moments. So far the literature has focused mostly on
examining the cross-section of average pricing errors, but Daniel and Titman (2006) and
Lewellen, Nagel, and Shanken (2010) argue that this is not an informative criterion
to judge these models. Examination of their conditional pricing errors is a natural
alternative. Since our method involves explicit estimation of conditional moments, it
provides a straightforward way of checking to what extent the SDF s estimated from
unconditional moment restrictions, which produce a relatively good fit in the crosssection, actually achieve their promise of matching the conditional moment properties
of the data, and how this picture changes when SDF s are estimated from conditional
moment restrictions.
Figure 3 presents our estimates of the conditional pricing errors of the five “primitive” assets evaluated at the unconditional, fixed IV, and optimal IV - local estimators.
In each case, the conditional moments are estimated with the local regression method.
For the stock portfolio we look at what is perhaps the most interesting dimension: the
spread between high and low B/M stocks. The plots on the left-hand side show the
conditional pricing errors of a zero-investment portfolio that takes a long position in
the two high B/M portfolios (each with weight one-half) and a short position in the
two low B/M portfolios (each with weight one-half). The plots on the right-hand side
show the conditional pricing error of the T-Bill.
The two plots in the top row illustrate that the pricing kernel estimated with
unconditional moment restrictions and zt = cay fails dramatically in matching timevariation in conditional moments. Conditional pricing errors for the high-low B/M
portfolio vary between −0.1 and 0.4. Those for the T-Bill vary between −8 and 15
(the most extreme peaks extend beyond the range shown in the figures). Given that the
36

T-Bill payoff has a constant price of 1.0, the magnitudes of this conditional mispricing is
enormous. Similar patterns are evident, albeit less extreme, for zt = def in the middle
row. With zt = yc in the bottom row, the magnitudes of the conditional pricing errors
are relatively smaller, but still large in absolute terms, ranging from −0.05 to 0.05 for
the high-low B/M portfolio, and from −1.5 to 1.5 for the T-Bill.
[Figure 3 about here]
[Figure 4 about here]
Employing conditional moment restrictions should help alleviate this mismatch between model-implied and actual variation in conditional moments. Indeed, the fixed IV
and optimal IV estimates produce conditional pricing errors that are an order of magnitude smaller than those based on unconditional estimates for the stock portfolios, and
several orders of magnitude smaller for the T-Bill. These IV estimators give nontrivial
weight to conditional moments in estimation and, thereby, enforce consistency between
the model-implied and sample conditional moments. It is important to note, though,
that even for these IV estimators the conditional pricing errors are economically large.
The models do not match the time-variation in the sample conditional moments. The
SDF parameters we obtained with optimal IV imply a virtually constant SDF which
does not help much to explain cross-sectional or time-series variation in returns. The
reason why the conditional pricing errors are so much bigger with the unconditional
SDF estimates is that these SDF estimates imply variation in conditional moments
that is far greater than what is actually found in the data, which produces conditional
pricing errors that are far in excess of what one would get by naively setting the pricing
kernel to a constant, say 0.99.
Figure 4 compares the model-implied conditional pricing errors based on the two
37

optimal IV estimators with the axes scaled to reveal differences around zero. These
optimal IV methods produce conditional pricing errors that are positively correlated
with each other, but the errors from the sieve method exhibit more high-frequency variation. This is a consequence of our inclusion of lagged returns and lagged consumption
growth in the conditioning set for the optimal IV-sieve estimator. In the models, the
SDF weights vary with the relatively slow moving zt variables. When, as with the
optimal IV-sieve estimation, conditioning involves a richer information set, the limitations of the model are revealed through much greater short-run predictability of the
model-implied pricing errors. If one takes the view that frictionless consumption-based
asset-pricing models are not designed to explain such short-run predictability patterns,
one might prefer to focus on the conditional pricing errors from the local regression
method, which are conditioned only on zt . For the T-Bill, any differences that exist
between the two methods are small relative to the differences that exist between the
errors based on unconditional and optimal IV estimators.
[Table VI about here]
The message from Figures 3 and 4 is also underscored by Table VI, which summarizes the time-series standard deviation (S.D.) of conditional pricing errors, and the
cross-sectional root mean squared unconditional pricing errors (RMSE). As Panel A
shows, the unconditional estimates with zt = cayt imply an enormous standard deviation of the conditional pricing errors, particularly for the T-Bill. Evidently, the model
achieves a relatively good fit in the cross section at the unconditional moment restriction estimates, as in Lettau and Ludvigson (2001b), but at the price of producing wild
swings in conditional pricing errors. Similar patterns, albeit somewhat less dramatic,
exist in Panels B and C for zt = deft and zt = yct . Evaluated at the unconditional
38

estimates, the models imply variation in conditional moments of asset returns far in
excess of the variation that exists in the data. This pattern is consistent with the finding in Lewellen and Nagel (2006) that the pricing kernels estimated with unconditional
moment restrictions and size- and book-to-market sorted equity portfolio returns imply
excessive variation in conditional factor risk premia.
When conditioning information is introduced in estimation, variation in the conditional pricing errors shrinks, but the cross-sectional RMSE increases. Given that the
motivation for models with time-varying pricing kernel weights is to match conditional
moments of returns and factors, this inability to reconcile the cross section and time
series of asset returns is an important failure of the model.
A key difference between the way the real returns on the T-bill and the stock
portfolios enter our pricing relations is that the former enters as a gross return while
the latter enter as excess returns. The model-implied price of a gross return is more
sensitive to misspecification in the conditional mean of the pricing kernel than the
model-implied price of an excess return, because

E [ht+1 |zt ] = E [mt+1 |zt ] E [rt+1 |zt ] + Cov [mt+1 , rt+1 |zt ] − 1.
Misspecification of E [mt+1 |zt ] has a much bigger effect on E [ht+1 |zt ] when rt+1 is 1 plus
a return than when it is an excess return. This observation no doubt partially explains
the finding that the T-Bill features the biggest differences in conditional pricing errors
between the unconditional and the IV estimates. However it is not the T-bill per se
that challenges these pricing kernels. We obtain similar results if we replace the gross
return on the T-Bill with, for example, the gross return on a value-weighted stock
market index. Rather, it is the fact that inclusion of a gross return (as contrasted with

39

working exclusively with excess returns) is informative about misspecification of the
conditional mean of the SDF .

B

Time-variation of Estimated SDF Weights

An alternative way of evaluating the economic properties of these models is to examine
the implied estimates of the time-varying pricing kernel weights, φ0t = β1 + γ1 zt and
φft = β2 + γ2 zt . We focus our discussion on φft . Figure 5 plots the estimates of φft with
zt equal to cayt , deft , or yct .
The coefficient φft has a close connection to the coefficient of relative risk aversion.
Consider a constant-relative risk aversion pricing kernel, mt+1 = δt exp (−γt ∆ct+1 ),
with time-varying relative risk aversion γt and time-discount factor δt . Linearizing
mt+1 around ∆ct+1 = 0, we get mt+1 ≈ δt − δt γt ∆ct+1 or, in our notation, φft = −δt γt .
For δt close to one we get φft ≈ −γt , which means that we can interpret the plots
in Figure 5 as plots of the (negative of the) estimated implied relative risk aversion
coefficient. Clearly, φft should then always be negative to make economic sense.
As an example of a SDF specification that produces strongly time-varying risk
premia, the Campbell and Cochrane (1999) pricing kernel, linearized in a similar way,
implies that the weight φft should equal −γ [1 + λ (st )], where λ (st ) is the (statedependent) sensitivity of habit to consumption (see Campbell and Cochrane’s Eq. (5)).
Note that λ (st ) is always strictly positive in their specification, hence φft should always
be negative (at least if we ignore the approximation error in the linearization). Judging
from Campbell and Cochrane’s Figure 1, λ (st ) is in the range of [0, 50]. Setting γ = 2,
as in their calibrations, we get magnitudes for φft ∈ [−100, 0].
[Figure 5 about here]

40

[Figure 6 about here]
Focusing first on the estimates based on unconditional moment restrictions (the
top graph in Figure 5), the estimates of φft for the model with zt = cayt wander far
outside the region of economic plausibility. Most of the time the estimates are greater
than zero, implying negative relative risk aversion, and they vary far more than the
range [−100, 0] suggested by the Campbell-Cochrane model (see, also, the calculations
in Section 5 of Lewellen and Nagel (2006)). Consistent with our earlier analysis of
conditional pricing errors, this shows that the model achieves its relatively good fit in
the cross section by making risk premia counter-factually volatile. When zt = deft or
zt = yct , the estimates of φft are much less volatile, always negative, but still outside
the [−100, 0] interval, with values around −150 for zt = deft and −300 for zt = yct .
Using the fixed IV estimator, as shown in the middle graph, reduces the volatility
of φft for zt = cayt by several orders of magnitude, but the estimated φft are still
often positive. The corresponding estimates for the model with zt = yct are also much
closer to zero, but are now also sometimes positive. The most volatile φft is obtained
with zt = deft . The statistical significance of these patterns is weak, however, as the
coefficients on deft and deft × ∆ct+1 are estimated with relatively high standard errors
(see Table IV).
Using the optimal IV-local estimator, the estimated φft exhibit relatively little variation over time, and are close to or within the [−100, 0] range for all three for all three
choices of zt . With the sieve method, shown in Figure 6, the optimal IV estimates
closely resemble those obtained with fixed IV.
Finally, it is also useful to note that the SDF s mt+1 = φ0t + φft ∆ct+1 implied by
the optimal IV-local estimates (not shown) are positive throughout the entire sample
for all three conditioning variables, with only a few exceptions for zt = deft . With
41

optimal IV-sieve, the estimated mt+1 is always greater than zero and ranges between
0.98 and 1.01. In contrast, the SDF implied by the estimates from unconditional
moment restrictions frequently takes large negative values.

VI

Concluding Remarks

We explore the use of conditional moment restrictions in estimation and evaluation of
asset pricing models in which the SDF is a conditionally affine function of a set of risk
factors. We make two methodological advances. First, we develop and implement an
optimal GMM estimator for this class of models. We thus provide some guidance in
choosing from the large array of possible instruments when setting up GMM estimators. Second, we show that there is an optimal choice of managed portfolios to use in
testing a generalized specification of an SDF against a more parsimonious null model.
The application of these methods to several consumption-based models in the literature
produces several interesting results, including (i) considerable efficiency can be gained
by employing the optimal GMM estimator, and (ii) using conditional moment restrictions and optimal GMM leads to very different conclusions regarding the fit of several
consumption-based models. While these models appear to do quite well in fitting the
cross-section of average returns of size and book-to-market portfolios in tests based on
unconditional moment restrictions, they fail to match variation in conditional moments
of returns. Our methodology allows us to transparently show that the small average
pricing errors that are obtained when estimation is based on unconditional moment
restrictions hide enormous time-variation in conditional pricing errors.

42

Notes
1

Under value additivity and additional, relatively weak, regularity conditions, Hansen and Richard

(1987) show that there is a unique pricing kernel mt+1 that prices all of the payoffs in a given payoff
space according to E [mt+1 ri,t+1 |At ] = p, where At is agents’ information set. Conditioning down to
the econometrician’s information set Jt gives this pricing relation.
2

This follows from the observation that
i
E[rt+1
|Jt ] − µ0J
=
t

i
−Cov[rt+1
, mt+1 | Jt ]
,
E[mt+1 | Jt ]

for a given rti in the set of R test asset returns rt . Substituting (3) and rearranging gives (4). This
construction does not require the assumption that ft ∈ Jt . However, if ft is not in Jt , then the
presumption would typically be that Jt is a subset of an econometrician’s information set. This is
because having observations on ft is generally required for the econometric implementation of (4)-(5).
3

More generally, the links are between the return on a zero-beta portfolio and the conditional mean

of mt+1 .
4

Virtually all of the GMM estimators of factor models that have been implemented in the literature

imply first-order conditions that are special cases of this moment condition. This includes Hansen
(1982)’s fixed-instrument GM M estimator. Therefore, estimation based on the optimal choice of
At determined subsequently will lead to estimators that are at least as efficient, and generally more
efficient, than those employed in the extant literature.
5

This form for ΣA follows from the fact that At ht+1 (θ0 ) is a martingale difference sequence (see

Hansen and Singleton (1982)).
6

The rank condition in the definition of A ensures that the model is econometrically identified. It

is the counterpart to the rank condition in the classical simultaneous equations models.
Hansen (1982)’s fixed-instrument GM M estimator has one minimize the quadratic form GT (θ)" WT GT (θ),
!
where GT (θ) = T −1 t ht+1 (θ)⊗wt and WT is a LR×LR dimensional distance matrix. The first-order
7

conditions to this minimization problem set K linear combinations of the sample moments GT (θT ) to
zero. Straightforward rearrangement of these equations gives an expression of the form (10) with At
depending on the choices of instruments wt and distance matrix W .
8

This step is exactly analogous to the projection of “right-hand-side” regressors onto the prede-

43

termined variables in 2SLS and 3SLS estimation. In linear models, these regressors comprise the
partial derivatives of the equation error with respect to θ0 .
9

In general, ∂ht+1 (θ0 )/∂θ is nonlinear and its conditional expectation is unknown. The resulting

intractability of the optimal GMM estimator no doubt underlies the absence of its application in
financial economics. Hansen and Singleton (1996) derive and implement the optimal GMM estimator
for a class of consumption-based pricing models with serially correlated, homoskedastic errors. The
estimation problem here is fundamentally different in that we have serially uncorrelated, conditionally
heteroskedastic errors.
10

The potential for large biases is discussed theoretically in Newey and Smith (2004) and simulation

evidence is provided by Altonji and Segal (1996), Hansen, Heaton, and Yaron (1996), and Imbens and
Spady (2005), among others.
11

Both the form of the pricing kernel mGt+1 (β0 , γTL ) and the density underlying the expectation

E[At ht+1 (β0 , γTL )] will in general depend on γTL .
12

This form of the asymptotic distribution of γTA under local alternatives, as well as the characteri-

zation of the non-centrality parameter in (26), follow from results in Newey and West (1987).
13

More precisely, we are projecting the scaled versions of these constructs on each other, where

scaling is by the square root of Σ−1
t , as discussed above.
14

We stress again that all of the derivations and results up to this point do not require that these

factor weights be affine functions of zt ; they can be any continuously differential function of zt .
15
16

That is, we solve (10), after substitution of the relevant special case of A∗ in (20), for γTG .
The following equality is an immediate implication of the first-order conditions for the optimal

2N .
GM M estimator βTN and the definition of H
t
17

Jagannathan and Wang (1996) and Santos and Veronesi (2006) use these conditioning variables in

β-style representations of excess returns, while we use them as conditioning variables in a consumptionbased pricing kernel.
18

Consistent with the extant literature that uses GM M estimators to evaluate the goodness-of-fit of

asset pricing models under rational expectations, moments are estimated “in sample.” In this setting,
the managed portfolio weights Bt are known to the representative agent/investor. They are not known
to the econometrician assessing the model’s fit and so they are estimated using the full sample. In
contrast, a “real time” investor implementing a dynamic trading strategy would be led to implement

44

a rolling optimal GM M estimator and its associated rolling portfolio weights Bt∗ .
19

The presence of autocorrelation does not necessarily mean that leave-one-out cross-validation

will produce a suboptimal bandwidth. Autocorrelation implies dependence among neighboring observations in the time domain. Whether leave-one-out cross-validation results in under-smoothed or
over-smoothed estimates depends on the dependence of observations that are neighbors in the state
domain. High correlation of residuals of neighbors in time space does not necessarily translate into
high correlation of residuals of neighbors in the state domain, unless zt is very persistent and the
sample short (Hart (1994); Yao and Tong (1998)).
20

The conditional moment plots reveal some outliers for the lowest value of cay in Figure 1 and the

highest value of def in Figure 2. Our subsequent estimation results are not sensitive to these outliers.
Removal of these observations yiels virtually unchanged results.
21

The inclusion of this polynomial approximation to nonlinear dependence of the conditional means

on zt is motivated in part by the analysis in Ait-Sahalia (1996). This functional form is able to capture
the linear, parabolic, and “S on its side” patterns evidenced in the non-parametric estimates of the
conditional means displayed in Figures 1 and 2.
22

We experimented with time-varying conditional covariance matrix from a dynamic conditional

correlation (DCC) model (Engle (2002)), but allowing this flexibility had only negligible effects on
our asset-pricing results. Accordingly, we proceed with the simpler specification outlined above.

45

References
Ait-Sahalia, Yacine, 1996, Testing Continuous-Time Models of the Spot Interest
Rate, Review of Financial Studies 9, 385–426.
Altonji, Joseph G., and Lewis M. Segal, 1996, Small Sample Bias in GMM Estimation
of Covariance Structures, Journal of Business and Economic Statistics 14, 353–
366.
Campbell, John Y., and John H. Cochrane, 1999, By Force of Habit:

A

Consumption-Based Explanation of Aggregate Stock Market Behavior, Journal
of Political Economy 107, 205–251.
Carhart, Mark M., 1997, On Persistence of Mutual Fund Performance, Journal of
Finance 52, 57–82.
Chamberlain, Gary, 1987, Asymptotic Efficiency in Estimation with Conditional
Moment Restrictions, Journal of Econometrics 34, 305–344.
Cochrane, John H., 1996, A Cross-Sectional Test of an Investment-Based Asset
Pricing Model, Journal of Political Economy 104, 572–621.
Daniel, Kent D., and Sheridan Titman, 2006, Testing Factor Model Explanations of
Market Anamolies, Working Paper, Northwestern University.
Engle, Robert F., 2002, Dynamic Conditional Correlation - A Simple Class of Multivariate GARCH Models, Journal of Business and Economic Statistics 17, 339–
350.
Fama, Eugene F., and Kenneth R. French, 1992, The Cross-Section of Expected
Stock Returns, Journal of Finance 47, 427–465.

46

Fama, Eugene F., and Kenneth R. French, 1993, Common Risk Factors in the Returns on Stocks and Bonds, Journal of Financial Economics 33, 23–49.
Fama, Eugene F., and Kenneth R. French, 1996, Mulitifactor Explanations of Asset
Pricing Anomalies, Journal of Finance 51, 55–87.
Fan, Jianqing, 1992, Design-adaptive Nonparametric Regression, Journal of the
American Statistical Association 87, 998–1004.
Grossman, Sanford J., and Robert J. Shiller, 1981, The Determinants of the Variability of Stock Market Prices, American Economic Review 71, 222–227.
Hansen, Lars P., 1982, Large Sample Properties of Generalized Method of Moments
Estimators, Econometrica 50, 1029–1054.
Hansen, Lars P., 1985, A Method for Calculating Bounds on the Asymptotic Covariance Matrices of Generalized Method of Moments Estimators, Journal of
Econometrics 30, 203–238.
Hansen, Lars P., John C. Heaton, and Masao Ogaki, 1988, Efficiency Bounds Implied by Multiperiod Conditional Moment Restrictions, Journal of the American
Statistical Association 83, 863–871.
Hansen, Lars P., John C. Heaton, and Amir Yaron, 1996, Finite-Sample Properties of Some Alternative GMM Estimators, Journal of Business and Economic
Statistics 14, 262–280.
Hansen, Lars P., and Scott F. Richard, 1987, The Role of Conditioning Information
in Deducing Testable Restrictions Implied by Dynamic Asset Pricing Models,
Econometrica 55, 587–613.
Hansen, Lars P., and Kenneth J. Singleton, 1982, Generalized Instrumental Variables

47

Estimation of Nonlinear Rational Expectations Models, Econometrica 50, 1269–
1286.
Hansen, Lars P., and Kenneth J. Singleton, 1996, Efficient Estimation of Linear
Asset Pricing Models with Moving Average Errors, Journal of Business & and
Economic Statistics 14, 53–68.
Hart, Jeffrey D., 1994, Automated Kernel Smoothing of Dependent Data by Using
Time Series Cross-Validation, Journal of the Royal Statistical Society, Series
B 56, 529–542.
Hodrick, Robert J., and Xiaoyan Zhang, 2001, Evaluating the Specification Errors
of Asset Pricing Models, Journal of Financial Economics 62, 327–376.
Imbens, Guido W., and Richard H. Spady, 2005, The Performance of Empirical
Likelihood and its Generalizations, in Donald W.K. Andrews and J.H. Stock,
eds.: Identification and Inference for Econometric Models: Essays in Honor of
Thomas Rothenberg (Cambridge University Press, New York).
Jagannathan, Ravi, and Zhenyu Wang, 1996, The Conditional CAPM and the Crosssection of Expected Returns, Journal of Finance 51, 3–54.
Lettau, Martin, and Sydney C. Ludvigson, 2001a, Consumption, Aggregate Wealth,
and Expected Stock Returns, Journal of Finance 56, 815–849.
Lettau, Martin, and Sydney C. Ludvigson, 2001b, Resurrecting the (C)CAPM: A
Cross-Sectional Test When Risk Premia Are Time-Varying, Journal of Political
Economy 109, 1238–1287.
Lewellen, Jonathan, and Stefan Nagel, 2006, The Conditional CAPM Does Not
Explain Asset Pricing Anomalies, Journal of Financial Economics 79, 289–314.

48

Lewellen, Jonathan, Stefan Nagel, and Jay Shanken, 2010, A Skeptical Appraisal of
Asset-Pricing Tests, Journal of Financial Economics 96, 175–194.
Lustig, Hanno, and Stijn Van Nieuwerburgh, 2006, Housing Collateral, Consumption
Insurance, and Risk Premia: An Empirical Perspective, Journal of Finance 60,
1167–1219.
Newey, Whitney K., and Richard J. Smith, 2004, Higher Order Properties of GMM
and Generalized Empirical Likelihood Estimators, Econometrica 72, 219–255.
Newey, Whitney K., and Kenneth D. West, 1987, Hypothesis Testing with Efficient
Method of Moment Estimation, International Economic Review 28, 777–787.
Pastor, Lubos, and Robert F. Stambaugh, 2003, Liquidity Risk and Expected Stock
Returns, Journal of Political Economy 111, 642–685.
Roussanov, Nikolai, 2009, Composition of Wealth, Conditioning Information, and
the Cross-Section of Stock Returns, Working Paper, Unversity of Pennsylvania.
Santos, Tano, and Pietro Veronesi, 2006, Labor Income and Predictable Stock Returns, Review of Financial Studies 19, 1–44.
Yao, Qiwei, and Howell Tong, 1998, Cross-validatory bandwidth selections for regression estimation based on dependent data, Journal of Statistical Planning and
Inference 68, 387–415.

49

Table I: Calculation of Test Statistics
2 G and H
2 N are as defined in Section B, but with unconditional instead of
The matrices H
t
t
conditional moments in the cases of the unconditional and fixed IV estimators. DF denotes
degrees of freedom, R the number of basis assets, K the number of SDF parameters, L the
number of fixed instruments, and G the number of additional SDF parameters describing
the alternative relative to the null SDF specification.
Test statistic
τT (I)

ht+1
Bt
DF

τT (B W ald )

ht+1
Bt
DF

τT (B LM )

ht+1
Bt
DF

Unconditonal

Fixed IV

Optimal IV

. 1
mt+1 θTG rt+1 − p
IR
R−K

. 1
1
.
mt+1 θTG rt+1 − p ⊗ wt
ILR
LR − K

. 1
mt+1 θTG rt+1 − p
IR
R

. 1
mt+1 θTN rt+1 − p
2 G Σ̂G−1
H
G

. 1
mt+1 θTN rt+1 − p
2 N Σ̂N −1
H
G

.
. 1
1
mt+1 θTN rt+1 − p ⊗ wt
2 G Σ̂G−1
H
G
.
. 1
1
mt+1 θTN rt+1 − p ⊗ wt
2 N Σ̂N −1
H
G

50

. 1
mt+1 θTN rt+1 − p
2 G Σ̂G−1
H
t t
G
. 1
mt+1 θTN rt+1 − p
−1
2 tN Σ̂N
H
t
G

Table II: Consumption CAPM, moments conditioned on cay
Test asset returns are the excess returns on the four size and B/M portfolios and the gross
return on the T-Bill. Standard errors (in parentheses) and p -values (in brackets) are robust to
misspecification of conditional moments, except those shown in italics, which assume correctly
specified conditional moments. Conditional moments for opt. IV-local are estimated with
local regressions; for opt. IV-sieve they are based on the sieve method.
const.

∆ct+1

τ (I)

Uncond.

2.95
(0.74)

-365.35
(135.26)

9.30
[0.03]

Fixed IV

1.00
(0.00)

-0.11
(0.15)

215.12
[0.00]

Opt. IV – Local

0.99
(0.00)
(0.00 )

0.47
(0.24)
(0.34 )

67.17
[0.00]
[0.00 ]

Opt. IV – Sieve

1.00
(0.00)
(0.00 )

0.12
(0.19)
(0.12 )

113.41
[0.00]
[0.00 ]

51

Table III: Pricing kernel estimates with moments conditioned on cay
Test assets returns are the excess returns on the four size and B/M portfolios and the gross
return on the T-Bill. Standard errors (in parentheses) and p-values (in brackets) are robust to
misspecification of conditional moments, except those shown in italics, which assume correctly
specified conditional moments. Conditional moments for opt. IV-local are estimated with
local regressions; for opt. IV-sieve they are based on the sieve method.
const.

cayt

∆ct+1

cayt × ∆ct+1

τ (I)

τ (B W ald )

τ (B LM )

Uncond.

-3.24
(8.84)

-40.83
(206.91)

626.99
(1437.79)

-70564.09
(99269.77)

0.09
[0.77]

0.59
[0.74]

7.90
[0.02]

Fixed IV

1.00
(0.00)

-0.64
(0.16)

-0.47
(0.30)

105.42
(35.02)

143.91
[0.00]

21.37
[0.00]

51.05
[0.00]

Opt. IV – Local

1.27
(0.29)
(0.23 )

-9.12
(9.15)
(6.96 )

-50.00
(49.84)
(41.16 )

1054.53
(1161.22)
(861.37 )

47.27
[0.00]
[0.00 ]

1.31
[0.52]
[0.42 ]

1.56
[0.46]
[0.42 ]

Opt. IV – Sieve

1.00
(0.00)
(0.00 )

-0.06
(0.06)
(0.04 )

-0.09
(0.27)
(0.14 )

-2.81
(9.13)
(7.21 )

89.29
[0.00]
[0.00 ]

5.19
[0.07]
[0.00 ]

4.65
[0.10]
[0.00 ]

52

Table IV: Pricing kernel estimates with moments conditioned on def
Test assets returns are the excess returns on the four size and B/M portfolios and the gross
return on the T-Bill. Standard errors (in parentheses) and p-values (in brackets) are robust to
misspecification of conditional moments, except those shown in italics, which assume correctly
specified conditional moments. Conditional moments for opt. IV-local are estimated with
local regressions; for opt. IV-sieve they are based on the sieve method.
const.

deft

∆ct+1

deft × ∆ct+1

τ (I)

τ (B W ald )

τ (B LM )

Uncond.

4.50
(3.06)

-274.15
(343.00)

-71.89
(381.84)

-11214.69
(39098.00)

6.49
[0.01]

2.62
[0.27]

1.70
[0.43]

Fixed IV

1.05
(0.04)

-5.33
(4.05)

-9.80
(7.25)

945.10
(671.89)

124.17
[0.00]

2.51
[0.29]

38.79
[0.00]

Opt. IV – Local

2.12
(0.49)
(0.66 )

-30.59
(31.44)
(40.27 )

-188.65
(78.15)
(111.06 )

3215.15
(4126.64)
(6579.73 )

34.98
[0.00]
[0.00 ]

1.14
[0.56]
[0.42 ]

6.06
[0.05]
[0.13 ]

Opt. IV – Sieve

1.01
(0.00)
(0.00 )

-1.00
(0.38)
(0.22 )

-1.30
(0.58)
(0.40 )

117.04
(59.16)
(38.10 )

52.16
[0.00]
[0.00 ]

10.33
[0.01]
[0.00 ]

9.68
[0.01]
[0.00 ]

53

Table V: Pricing kernel estimates with moments conditioned on yc
Test asset returns are the excess returns on the four size and B/M portfolios and the gross
return on the T-Bill. Standard errors (in parentheses) and p-values (in brackets) are robust to
misspecification of conditional moments, except those shown in italics, which assume correctly
specified conditional moments. Conditional moments for opt. IV-local are estimated with
local regressions; for opt. IV-sieve they are based on the sieve method.
const.

yct

∆ct+1

yct × ∆ct+1

τ (I)

τ (B W ald )

τ (B LM )

Uncond.

-5.70
(32.49)

9.33
(35.51)

-140.41
(4454.77)

-214.90
(4922.26)

9.63
[0.00]

0.13
[0.93]

0.14
[0.93]

Fixed IV

0.79
(0.09)

0.24
(0.09)

34.16
(15.23)

-38.31
(16.62)

128.69
[0.00]

7.43
[0.02]

44.72
[0.00]

Opt. IV – Local

0.72
(0.11)
(0.15 )

0.31
(0.12)
(0.17 )

53.95
(19.08)
(27.06 )

-59.64
(21.19)
(29.95 )

56.31
[0.00]
[0.00 ]

8.46
[0.01]
[0.11 ]

2.26
[0.32]
[0.27 ]

Opt. IV – Sieve

0.99
(0.05)
(0.02 )

0.01
(0.06)
(0.02 )

-1.36
(8.59)
(3.78 )

1.52
(9.45)
(4.13 )

94.29
[0.00]
[0.00 ]

2.00
[0.37]
[0.12 ]

2.03
[0.36]
[0.12 ]

54

Table VI: Pricing errors in cross section and time series
The table reports the time-series standard deviation (S.D.) of conditional pricing errors and
the cross-sectional root mean squared error (RMSE) of the test assets’ unconditional pricing
errors. Test asset returns are the excess returns on the four size and B/M portfolios and the
gross return on the T-Bill. Conditional moments for opt. IV-local are estimated with local
regressions; for opt. IV-sieve they are based on the sieve method.
Time-series S.D. of conditional pricing errors
Cross-sectional RMSE of
SmGrw SmVal BigGrw BigVal T-Bill
uncond. pricing errors
Panel A: SDF with ∆ct+1 scaled by cayt , moments conditioned on cayt
Uncond.
Fixed IV
Opt. IV – Local
Opt. IV – Sieve

0.17
0.02
0.03
0.03

0.21
0.02
0.02
0.03

0.15
0.02
0.03
0.03

0.17
0.02
0.02
0.03

5.41
0.00
0.01
0.00

0.02
0.05
0.04
0.05

Panel B: SDF with ∆ct+1 scaled by deft , moments conditioned on deft
Uncond.
Fixed IV
Opt. IV – Local
Opt. IV – Sieve

0.09
0.02
0.01
0.03

0.09
0.02
0.01
0.03

0.05
0.01
0.00
0.02

0.06
0.01
0.01
0.02

1.36
0.00
0.04
0.00

0.02
0.05
0.03
0.05

Panel C: SDF with ∆ct+1 scaled by yct , moments conditioned on yct
Uncond.
Fixed IV
Opt. IV – Local
Opt. IV – Sieve

0.02
0.00
0.00
0.03

0.00
0.00
0.00
0.02

0.02
0.01
0.01
0.02

0.02
0.02
0.02
0.03

55

0.38
0.00
0.00
0.00

0.02
0.05
0.05
0.05

Gross return on T−Bill

Excess returns on stock portfolios
0.15

1.02

0.1

1.015

0.05

1.01

0

1.005

−0.05

1

−0.1

0.995

−0.05

0
cay

0.05

0.99
−0.04

0.15

1.02

0.1

1.015

0.05

1.01

0

1.005

−0.05

1

−0.1

0.995

0

0.01

0.02

0.03

0.99

0

−0.02

0.01

0.02

0.04

0.02

0.03

0.95

1

def

def

1.02

0.15
SmGrw
SmVal
BigGrw
BigVal

0.1
0.05

1.015
1.01

0

1.005

−0.05

1

−0.1

0.995

0.85

0
cay

0.9

0.95

0.99
0.85

1

0.9
yc

yc

Figure 1: Fitted conditional expected returns from the local regression method

56

Excess returns on stock portfolios

Gross return on T−Bill

0.001

0.01

0

0.005

−0.001

0

0.002

0.01

0.001

0.005

0
0
−0.001
−0.05

0
cay

0.05

−0.04

0.001

0.01

0

0.005

−0.001

−0.02

0
cay

0.02

0.04

0

0.002

0.01

0.001

0.005

0
0
−0.001

0

0.01

0.02

0.03

0

0.01

def

0.02

0.03

0.95

1

def

0.001

0.01
SmGrw
SmVal
BigGrw
BigVal

0
−0.001

0.005
0

0.002

0.01

0.001

0.005

0
0
−0.001
0.85

0.9

0.95

1

yc

0.85

0.9
yc

Figure 2: Fitted conditional expected cross-products of return and log consumption
growth from the local regression method

57

Cond. pricing errors: High minus low B/M, cay
0.2

Cond. pricing errors: T−Bill, cay
10

0.15
5
0.1
0.05

0

0
−5
−0.05
−0.1
1950

1975

−10
1950

2000

Cond. pricing errors: High minus low B/M, def
0.2

1975

2000

Cond. pricing errors: T−Bill, def
10

0.15
5
0.1
0.05

0

0
−5
−0.05
−0.1
1950

1975

−10
1950

2000

Cond. pricing errors: High minus low B/M, yc
0.2

1975

2000

Cond. pricing errors: T−Bill, yc
10

0.15
5
0.1
0.05

0

0
−5
−0.05
−0.1
1950

1975

−10
1950

2000

Unconditional

Fixed IV

1975

2000

Optimal IV

Figure 3: Conditional pricing errors implied by unconditional, fixed IV, and optimal IVlocal estimates of pricing kernels with time-varying weights: High minus low book-tomarket zero investment portfolio (left) and T-Bill (right) with local regression estimates
of moments conditioned on cay (top row), def (middle row), and yc (bottom row)

58

Cond. pricing errors: High minus low B/M, cay
0.1

Cond. pricing errors: T−Bill, cay
0.1
0

0.05

−0.1
0
−0.2
−0.05
−0.1
1950

−0.3

1975

−0.4
1950

2000

Cond. pricing errors: High minus low B/M, def
0.1

1975

2000

Cond. pricing errors: T−Bill, def
0.1
0

0.05

−0.1
0
−0.2
−0.05
−0.1
1950

−0.3

1975

−0.4
1950

2000

Cond. pricing errors: High minus low B/M, yc
0.1

1975

2000

Cond. pricing errors: T−Bill, yc
0.1
0

0.05

−0.1
0
−0.2
−0.05
−0.1
1950

−0.3

1975

−0.4
1950

2000

Sieve

1975

2000

Local

Figure 4: Conditional pricing errors implied by optimal IV-local and optimal IV-sieve
estimates of pricing kernels with time-varying weights: High minus low book-to-market
zero investment portfolio (left) and T-Bill (right) and moments conditioned on cay (top
row), def (middle row), and yc (bottom row)

59

Slope on consumption growth: Unconditional
4000
3000
2000
1000
0
−1000
−2000
1950

1960

1970

1980

1990

2000

2010

2000

2010

Slope on consumption growth: Fixed IV
20
15
10
5
0
−5
−10
1950

1960

1970

1980

1990

Slope on consumption growth: Optimal IV − Local
50
0
−50
−100
−150
−200
1950

1960

1970

1980

cay

def

1990

2000

2010

yc

Figure 5: Time-series of estimated SDF weights from with unconditional (top row),
fixed IV (middle row), and optimal IV-local estimators (bottom row)

60

Slope on consumption growth: Optimal IV − Sieve
2

1.5

1

0.5

0

−0.5

−1
1950

1960

1970

1980
cay

def

1990

2000

2010

yc

Figure 6: Time-series of optimal IV estimates of SDF weight with conditional moments
obtained with the sieve method

61

Internet Appendix
for
Estimation and Evaluation of
Conditional Asset Pricing Models∗
Stefan Nagel†
Stanford University and NBER

Kenneth J. Singleton‡
Stanford University and NBER

September 28, 2010

∗

Citation Format: Nagel, Stefan, and Kenneth J. Singleton, YEAR, Internet Appendix to “Estimation and Evaluation of Conditional Asset Pricing Models,” Journal of Finance VOL, pages,
http://www.afajof.org/IA/YEAR.asp. Please note: Wiley-Blackwell is not responsible for the content or functionality of any supporting information supplied by the authors. Any queries (other than
missing material) should be directed to the authors of the article.
†
Stanford University, Graduate School of Business, 518 Memorial Way, Stanford, CA 94305, e-mail:
Nagel Stefan@gsb.stanford.edu, http://faculty-gsb.stanford.edu/nagel
‡
Stanford University, Graduate School of Business, 518 Memorial Way, Stanford, CA 94305, e-mail:
kenneths@stanford.edu, http://www.stanford.edu/∼kenneths/

1

A

The Asymptotic Distribution of τT (B, A)

A standard, coordinate by coordinate, mean-value expansion of the sample moment
conditions (10) gives
#
%−1
√ ! A
"
1 $ ∂ht+1 (θTAm )
1 $
√
T θT − θ0 = −
At ht+1 (θ0 ),
At
T t
∂θ
T t

(A.1)

where θTAm is a collection of vectors, one for each coordinate of At ht+1 , that lie between
θTA and θ0 , almost surely. Similarly, a mean-value expansion of the sample mean of
Bt ht+1 (θTA ) gives
"
1 $
1 $
1 $ ∂ht+1 (θTBm ) √ ! A
√
Bt ht+1 (θTA ) = √
Bt ht+1 (θ0 ) +
Bt
× T θT − θ0 ,
T t
∂θ
T t
T t
(A.2)
with θTBm interpreted similarly. Substitution of (A.1) into (A.2) leads to
1 $
1 $ A
√
Bt ht+1 (θTA ) = √
Ct ht+1 (θ0 ) + op (1) ,
T t
T t

(A.3)

where CtA is given by (15). The limiting distribution in (14) follows immediately under
the regularity conditions in Hansen (1982) using the fact that ht+1 (θ0 ) follows a martingale difference sequence with conditional covariance matrix E[ht+1 (θ0 )ht+1 (θ0 )" ] = Σt .

B

Intermediate Steps in Section III

To express the Wald statistic ςTW (A∗ ) as in (27) we proceed as follows. From the
intermediate steps in deriving the asymptotic distribution of θTA we can express (θT∗ −θ0 )

2

as
T
! " θ" G−1 θ #$−1 1 %
G−1
√
T
− θ0 ) = − E Ψt Σt Ψt
Ψθ"
ht+1 (θ0 ).
(A.4)
t Σt
T t=1
√
√
Noting that T (γT∗ −γ0 ) = [0, IG ] T (θT∗ −θ0 ), and using the partitioned matrix formula

√

a

(θT∗

for inverting Ω∗0 , we obtain
√

The random vector

T (γT∗

√1
T

a

− γ0 ) =

&T

t=1

− Ω∗γγ

T
1 % G " G−1
√
Ht Σt ht+1 (θ0 ).
T 1

(A.5)

HtG " ΣG−1
ht+1 (θ0 ) converges in distribution to a normal
t

random vector with mean zero and covariance matrix
!

Ω∗γγ

$−1

!
$−1 βγ
= Kγγ − Kγβ Kββ
K ,

(A.6)

where the last equality follows from the partitioned matrix inversion formula applied
to Ω∗0 . Therefore, the asymptotic distribution of ςTW (A∗ ) in (27) is χ2 (G).

C

Derivation the Lagrange Multiplier

The relevant Lagrange multipliers come from solving the GMM estimation problem
subject to the constraint that γ0 = 0. More precisely, the moment conditions associated
with the optimal GMM estimator of θ0 for the unconstrained mGt+1 are



E 

Ψβ"
t
Ψγ"
t





 −1

Σt ht+1 (β0 , γ0 ) = 0.

(A.7)

Under the constraint that γ0 = 0, (A.7) gives more moment equations (K) than unknown parameters (K−G = dimβ0 ). Therefore, the LM statistic for testing H0 : γ0 = 0
3

is obtained by minimizing a quadratic form in the sample version of the moments (A.7)
for joint estimation of β0 and γ0 , subject to the constraint that γT = 0 (see Eichenbaum, Hansen, and Singleton (1988)). Letting hN
t+1 (β) = ht+1 (β, 0), the pricing errors
under the constraint that γ = 0, the optimal distance matrix in this quadratic form is
a consistent estimator of



W0 = E 

N −1 N
Ψβ!
ht+1
t Σt
N −1 N
Ψγ!
ht+1
t Σt



'
(


! N −1 β
! N −1 γ
 hN
Ψt , hN
Ψt  .
t+1 Σt
t+1 Σ

The first-order conditions to this minimization problem are
)

1*
Pt+1
T t

+

WT−1



Ψβ!
t







1 *
 N −1 N
 0 
,

Σt ht+1 (βT ) = 
T t
Ψγ!
λ
T
t

(A.8)

where λT is the G × 1 vector of Lagrange multipliers associated with the constraint
γ
θ
that γT = 0; it is understood that ΣN
t , Ψt , and Ψt have been replaced by consistent

estimators of these constructs; and the matrix P is given by



Pt+1 = 

The lead matrix T −1

2

t

!
∂hN
−1 β
t+1 (βT )
ΣN
Ψt
t
∂β

!
∂hN
−1 γ
t+1 (βT )
ΣN
Ψt
t
∂β

!
∂hN
t+1 (βT )

!
∂hN
t+1 (βT )

∂γ

−1 β
ΣN
Ψt
t

∂γ

−1 γ
ΣN
Ψt
t




.

(A.9)

Pt+1 in (A.8) is a consistent estimator of W0 . Therefore,

the first K − G first-order conditions in (A.8) are
1 * β! N −1 N
Ψt Σt ht+1 (βTN ) = 0.
T t

(A.10)

These are the sample first-order conditions for the optimal GMM estimator of the
parameters of the SDF under the null hypothesis γ0 = 0; that is, they are the first4

1
N
order conditions when estimation proceeds with the constrained SDF mN
t+1 . We let βT

denote this optimal GMM estimator obtained when the SDF is taken to be mN
t+1 (β0 ).
The last G first-order conditions in (A.8) yield the Lagrange multipliers

λT =

1 ! γ! −1 N
Ψt Σt ht+1 (βTN ),
T t

(A.11)

as in (34).

D

An Alternative Representation of the Wald Statistic for Completely Affine SDF s

We want to prove that
affine SDF s.

1
T

"T

# G G−1 p =
t=1 Ht Σ̂t

1
T

$ N%
N
#tG Σ̂G−1
H
h
for completely
t
t+1 βT
t=1

"T

$ N%
#N ! N
We have pR − hN
= rt+1 ft+1
βT and so
t+1 βT

1

T
$ N %()
1 ! & # G G−1 '
Ht Σ̂t
p − hN
t+1 βT
T t=1
.
/
T *+
,
-−1
1!
γ!
γβ
ββ
#N ! N
β!
G−1
Ψ̂t − K̂T K̂T
=
Ψ̂t Σ̂t rt+1 ft+1 βT
T t=1
/
T *
,
-−1
1 ! γ! G−1
ββ
β! G−1
#N ! N
#N ! N
γβ
Ψ̂t Σ̂t rt+1 ft+1 βT
=
Ψ̂t Σ̂t rt+1 ft+1 βT − K̂T K̂T
T t=1
,
-−1 ,
γβ N
γβ
ββ
ββ
= K̂T βT − K̂T K̂T
K̂T βTN = 0,

This derivation addresses an important question that was left implicit up to this point. In previous
sections we first constructed the optimal GM M estimator θT∗ of the parameters governing mt+1 (θ0 ),
and then proceeded to construct tests based on managed portfolio weights Bt and the moment conditions E[Bt ht+1 (θ0 )] = 0. Readers may wonder whether we would have obtained even more efficient
estimators than θT∗ by using the moment conditions E[A∗t ht+1 (θ0 )] = 0 and E[Bt ht+1 (θ0 )] = 0 simultaneously to estimate θ0 . By analogous derivations to those above we see that the answer is no. For
otherwise A∗ would not have been the optimal set of instruments to begin with.

5

where we are relying on the robust formulation of K̂Tγβ as discussed in Section III.B.

E

Robust Statistics

The robust version of the asymptotic variance of the SDF parameter estimates follows
Eq. (11), while the non-robust version replaces ∂ht+1 (θ0 ) /∂θ and the realized crossproducts of pricing errors in Eq. (11) with their conditional expectations, Ψθt and Σt ,
respectively, which yields the asymptotic variance as in Eq. (21).
Similarly, we compute the LM test statistic τT (B LM ) in its robust version following
−1 N
" N −1 ! N "
! N Σ̂N
the LM analog of Eq. (38) with H
ht+1 (βT )hN
Ht in the summation
t
t
t+1 (βT ) Σ̂t

terms in the inverse. In the non-robust version of the LM statistic, these terms are
−1 ! N "
! N Σ̂N
reduced to H
Ht .
t
t

The robust version of the W ald statistic is analogous to the LM statistic, just with

!tG in place of H
! N , Σ̂Gt in place of Σ̂N , and the pricing error cross-product matrix in the
H
t
t
inverse term based on hGt+1 (θT ) instead of hN
t+1 (βT ). We could also compute the non-

robust version of the W ald statistic analogous to the corresponding version of the LM
statistic, but in this case it would not be numerically identical to the W ald statistic
computed in the traditional way as a quadratic form in γT as in Eq. (25) (the numerical
equivalence of the portfolio representation shown in Section III.B holds only for the
robust version). For the Wald test we therefore report the non-robust version in its
traditional form as a quadratic form in the γT estimates with the asymptotic covariance
taken from Eq. (21). Of course, under the null hypothesis and local alternatives, the
robust and non-robust statistics and the different ways of computing them are all
asymptotically equivalent.

6

F

Small-Sample Properties

We perform Monte Carlo simulations to investigate the small-sample properties of the
estimators employed in our empirical analysis. The results we report here should be
regarded as a preliminary first step towards understanding the small-sample properties
of optimal-instrument estimators in an asset-pricing setting. The behavior of these
estimators is likely to depend in various ways on the specification of the hypothesized
data-generating process. Factors that are likely to play a role include the amount
of time-variation in various conditional moments, the degree of non-linearity in the
conditional moment functions, the specification of the SDF , and the length of the
data sample. A comprehensive analysis of the behavior of the optimal instruments
estimators along these dimensions touches on some deep econometric issues that we we
cannot hope to adequately address within the scope of this appendix.2
We pursue the more limited objective of obtaining some first insights into the small
sample properties of the optimal IV estimator under a specific null hypothesis that
is consistent in many ways with the empirical evidence on time-varying conditional
moments that we reported in our paper (NS). Given the poor empirical performance of
the SDF candidates analyzed in the main paper, we have to choose whether to generate
data under a null that would seem reasonable based on theoretical considerations (e.g.,
with reasonable implied relative risk aversion) or one that matches the empirical data
well. Here we choose the latter, which means we pick SDF parameters that generate
mean returns and time-variation of conditional expected returns close to what is found
in the empirical data.
We simulate returns of five assets and these returns are assumed to be consistent
2
In fact, the literature on small-sample properties of GMM estimators in asset-pricing applications
is sparse to begin with (Tauchen (1986), Hansen, Heaton, and Yaron (1996), Ferson and Siegel (2003)).

7

with a linearized pricing kernel of the type that we investigate empirically in NS:
mGt+1 (θ0 ) = (β1 + γ1 zt ) + (β2 + γ2 zt ) ∆ct+1 .

(A.12)

Combining the pricing kernel with the pricing restriction, Eq. (1) in NS, and conditioning on the state variable zt , we obtain

E [rt+1 |zt ] =

pt − (β2 + γ2 zt )Cov (ft+1 , rt+1 |zt )
.
β1 + γ1 zt + (β2 + γ2 zt )E [ft+1 |zt ]

(A.13)

To generate artificial data on conditional expected returns consistent with this pricing
model, we need to model the dynamics of zt . Given a process for zt we then need to
make sure the SDF parameters and the dynamics of Cov (ft+1 , rt+1 |zt ) and E [ft+1 |zt ]
are consistent with E [rt+1 |zt ] according to Eq. (A.13).
Regarding the dynamics of zt , we assume a homoskedastic AR(1) with normally
distributed innovations, and we set the AR(1)-parameters equal to the point estimates
that we obtain from estimating an AR(1) for the conditioning variable cay used in NS.
We assume that the risk factor ft+1 is mean zero with IID normal innovations and
variance equal to the variance of consumption growth in our empirical data sample.
Conditional correlations between returns and ft+1 for assets 1 to 4 (the simulated
equity portfolios) are assumed to follow the quadratic function 0.30 − 200(zt − 0.01)2 .
This delivers conditional expected cross products of returns and ft+1 that are roughly
consistent with those that we reported with cay as predictor in the empirical analysis.
For asset 5 (the simulated Treasury Bill), we assume a correlation of zero.
Given the simulated zt and ft+1 , we choose SDF parameters β2 and γ2 such that
the term β2 + γ2 zt (which corresponds approximately to a time-varying relative risk
aversion coefficient) has mean 200 and standard deviation 70. These parameter values
8

allow us to roughly match the mean and standard deviation of conditional expected
stock returns from the local linear conditional moment estimates in NS.
We further proceed to pick γ1 so that the standard deviation of the conditional mean
return of the conditionally risk free asset; that is, 1/E[mGt+1 |zt ] matches the standard
deviation of the conditional mean of the real T-Bill return, where the latter is obtained
from the local polynomial conditional moment estimates in NS. We choose β1 so that
the mean of 1/E[mGt+1 |zt ] matches the mean real T-Bill return.
Given the Cov (ft+1 , rt+1 |zt ) and Var (ft+1 |zt ) as specified above, we simulate return
innovations from a conditional one-factor factor model. The factor related component is
Cov (ft+1 , rt+1 |zt )Var (ft+1 |zt )−1 ft+1 . We then add an IID normal residual for each asset
(uncorrelated between assets) to match the unconditional variance of the unexpected
return of the four stock portfolios and the T-Bill in the empirical data (i.e., the residuals
from the local polynomial regressions estimates in NS). This completes the specification
of the joint dynamics of zt , ft+1 , and rt+1 .
We generate 5,000 Monte Carlo samples. In each Monte Carlo sample, we generate
219 observations, the same sample size (in quarters) as our data set in NS. In each
Monte Carlo sample, we apply the same types of estimators as in NS: unconditional,
fixed IV with instruments wt = (1, zt , rt , ft ), and optimal IV with local polynomial
estimates of conditional moments. For the local polynomial estimation we perform a
data-driven bandwidth selection with cross-validation, as in NS.
Ensuring a global optimum for the optimal IV estimator across all simulations can
be a challenge. For example, the numerical non-linear equation solver might run off
towards a “solution” with extremely large SDF parameters which make E[At ht+1 |zt ]
close to zero not by making ht+1 small, but instead by blowing up E[ht+1 h"t+1 |zt ] (which
appears with an inverse in At ) to huge values. A method that we found to work well is to
9

first construct preliminary fixed IV estimates, using the first few principal components
of E [∂ht+1 /∂θ|zt ] (taken from the local polynomial estimation) as instruments, and
then using these preliminary estimates as initial values for the non-linear equation
solver, supplemented if necessary with an extensive grid search over initial values.
It also helps to impose a common bandwidth bk in the estimation of the two condi!
!
, ∆ct+1 rk,t+1
)|zt ] corresponding to asset k. In some of
tional moments gk (zt ) = E[(rk,t+1

the Monte-Carlo samples, the local polynomial regressions can produce quite extreme
!
!
values for the estimates of E[rk,t+1
|zt ] or E[∆ct+1 rk,t+1
|zt ] for outlier observations of

zt , and this seems to be more of a problem if only one of the two elements of the
!
!
estimate of gk (zt ) = E[(rk,t+1
, ∆ct+1 rk,t+1
)! |zt ] is affected (because is estimated with a

small bandwidth), while the other is not (because it is estimated with a wide band!
!
width). Imposing the same bandwidth ensures that E[rk,t+1
|zt ] and E[∆ct+1 rk,t+1
|zt ]

are estimated from the same local neighborhood around zt .
Figure 1 presents the Monte Carlo density of the parameter estimates. The estimates from fixed IV and optimal IV estimators are considerably more precise and
better centered around the true parameter values than the estimates based on the unconditional estimator. For the β1 and γ1 estimates, the fixed IV estimates seem to
be slightly more precise, but for the β2 and γ2 estimates, the fixed IV estimates show
considerably higher dispersion and also some bias. For β2 , the RMSE of the fixed IV
estimates is about five times as big as with the optimal IV estimator. Overall, the
optimal IV estimates look well behaved.
Figure 2 plots the empirical distribution of p-values from the τ (I) test to illustrate
the actual size of the test in relation to its nominal size. The test based on the
unconditional estimator under-rejects compared with the nominal size of the test. The
test based on the fixed IV estimator severely over-rejects. Its actual size is much
10

β1

γ1

20

0.25
0.2

15

0.15
10
0.1
5

0.05

0
0.5

1

0
−100

1.5

β2

−50

2

0.008

50

100

γ2

−4

0.01

0

x 10

1.5

0.006
1
0.004
0.5

0.002
0

−300

−200

−100

0
−10000

0

Unconditional

Fixed IV

−5000

0

5000

Optimal IV

Figure 1: Kernel-smoothed Monte Carlo density of SDF parameter estimates. The
vertical line indicates the true parameter value.
higher than the nominal size of the test, particularly for small nominal sizes. This is
a consequence of the large number of instruments relative to the sample size (which is
also often typical in empirical applications of the fixed IV estimator). If one reduced
the number of instruments, the tendency to over-reject would likely be reduced. In the
extreme case of only a constant as the “instrument”, the fixed IV estimator becomes
the unconditional estimator. The τ (I) test based on the optimal IV estimator also
exhibits a tendency to over-reject, but considerably less so than the test based on
the fixed IV estimator, a likely consequence of the fact that it does not use a large
11

1
0.9
0.8

Actual Size

0.7
0.6
0.5
0.4
0.3
0.2
0.1
0
0

0.2

0.4
0.6
Nominal Size

Unconditional

Fixed IV

0.8

1

Optimal IV

Figure 2: p-value plots for τ (I) test of zero average pricing errors
number of moment conditions in the construction of the test statistic. Nevertheless,
an interpretation of empirical results based on the τ (I) test statistic should take into
account this tendency to over-reject.
Next, we investigate the size and power of the Wald and LM tests of H0 : γ1 =
0, γ2 = 0. To generate data under this null hypothesis, we simulate from the SDF
N
mN
t+1 with γ1 = 0, γ2 = 0, β2 = −200, and β1 chosen such that 1/E[mt+1 |zt ] matches

the mean gross return on Treasury Bills in our sample.
Figure 3 compares actual and nominal sizes of the Wald and LM tests with data
generated under the null mN
t+1 . For the Wald statistic, the unconditional estimator
produces an under-sized test, while the tests based on the fixed IV and optimal IV
estimators tend to over-reject the null. For the LM statistic, all three estimators
produce tests that are much closer to the correct size.
12

Wald test
1
0.9
0.8

Actual Size

0.7
0.6
0.5
0.4
0.3
0.2
0.1
0
0

0.2

0.4
0.6
Nominal Size

0.8

1

0.8

1

LM test
1
0.9
0.8

Actual Size

0.7
0.6
0.5
0.4
0.3
0.2
0.1
0
0

0.2

0.4
0.6
Nominal Size

Unconditional

Fixed IV

Optimal IV

Figure 3: p-value plots for Wald and LM tests of mN
t+1

13

Wald test
1
0.9
0.8
0.7
Power

0.6
0.5
0.4
0.3
0.2
0.1
0
0

0.2

0.4
0.6
Actual Size

0.8

1

0.8

1

LM test
1
0.9
0.8
0.7
Power

0.6
0.5
0.4
0.3
0.2
0.1
0
0

0.2

0.4
0.6
Actual Size

Unconditional

Fixed IV

Optimal IV

Figure 4: Size-power plots for Wald and LM tests of mN
t+1

14

Figure 4 shows the results of a simple and preliminary investigation of the power
of the Wald and LM tests with different estimators. This analysis is preliminary in the
sense that we investigate the power only under one alternative hypothesis, the SDF
mGt+1 that we described above. Power depends on the specification of the alternative,
and so with different alternatives, results may be different. To take into account the
fact that the Wald and LM tests are not always correctly sized, particularly for the
Wald test (see Figure 3), we investigate power not as a function of nominal size (which
would ignore the size distortions of the test), but as a function of actual size. We do
this by plotting the empirical distribution function of p-values under the mN
t+1 null (as
a function of nominal size) against the empirical distribution of p-values under mGt+1
alternative (as a function of nominal size). For example, this means that we ask how
often the tests rejects under the null at nominal size of 0.05, and we plot this number
against the proportion of the simulations under the alternative that lead to rejection
at a nominal size of 0.05.
As Figure 4 shows, the Wald and LM tests based on the unconditional estimator
essentially have no power in our setting. The tests reject as frequently under the null as
they do under the alternative hypothesis. The fixed IV and optimal IV estimators have
similar properties and are more powerful than the test based on the unconditional estimator. However, if a size correction is implemented, as in these plots of power against
actual size instead of nominal size, they have only moderate power. For example, with
nominal size of the LM test set such that actual size is 0.10 (this test rejects 10% of the
time under the null), the tests based on fixed and optimal IV estimators reject around
30% of the time under the alternative. Clearly, these results will be sensitive to the
distance between (γ1 , γ2 ) under the null and alternative, as well as the sample size.
Overall, our preliminary analysis suggests that the optimal IV estimator is reason15

ably well behaved in small samples. It shares some of the over-rejection problems of
the fixed IV estimator, but we found some indication that the optimal IV estimator
may have some advantages over fixed IV estimators that employ a large number of
moment conditions. An interesting question that we leave for future research is the
extent of the efficiency gains and increased power from using the optimal IV estimator
with larger sample sizes or different specifications of the null hypothesis.

16

References
Eichenbaum, M., L. Hansen, and K. Singleton, 1988, A Time Series Analysis of Representative Agent Models of Consumption and Leisure Choice Under Uncertainty,
Quarterly Journal of Economics 103, 51–78.
Ferson, W., and A. Siegel, 2003, Stochastic Discount Factor Bounds with Conditioning Information, Review of Financial Studies 16, 567–595.
Hansen, Lars P., 1982, Large Sample Properties of Generalized Method of Moments
Estimators, Econometrica 50, 1029–1054.
Hansen, Lars P., John C. Heaton, and Amir Yaron, 1996, Finite-Sample Properties of Some Alternative GMM Estimators, Journal of Business and Economic
Statistics 14, 262–280.
Tauchen, G., 1986, Statistical Properties of GMM Estimates of Structural Parameters Using Financial Market Data, Journal of Business and Economic Statistics 4,
397–416.

17

