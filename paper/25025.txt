                             NBER WORKING PAPER SERIES




                 INTEGRABILITY AND GENERALIZED SEPARABILITY

                                        Thibault Fally

                                     Working Paper 25025
                             http://www.nber.org/papers/w25025


                    NATIONAL BUREAU OF ECONOMIC RESEARCH
                             1050 Massachusetts Avenue
                               Cambridge, MA 02138
                                  September 2018




Many thanks to Philippe Aghion, Dave Donaldson, Federico Etro, Ben Faber, Ethan Ligon,
Kiminori Matsuyama, Marti Mestieri, Andres Rodriguez-Clare, Ina Simonovska and Brian
Wright for helpful comments and suggestions. The views expressed herein are those of the author
and do not necessarily reflect the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

¬© 2018 by Thibault Fally. All rights reserved. Short sections of text, not to exceed two
paragraphs, may be quoted without explicit permission provided that full credit, including ¬©
notice, is given to the source.
Integrability and Generalized Separability
Thibault Fally
NBER Working Paper No. 25025
September 2018
JEL No. D11,D40,L13

                                         ABSTRACT

This paper examines demand systems where the demand for a good depends only on its own
price, consumer income, and a single aggregator synthesizing information on all other prices.
This generalizes directly-separable preferences where the Lagrange multiplier provides such an
aggregator. As indicated by Gorman (1972), symmetry of the Slutsky substitution terms implies
that such demand can take only one of two simple forms. Conversely, here we show that only
weak conditions ensure that such demand systems are integrable, i.e. can be derived from the
maximization of a well-behaved utility function. This paper further studies useful properties and
applications of these demand systems.


Thibault Fally
Department of Agricultural and Resource Economics
University of California, Berkeley
301 Giannini Hall
Berkeley, CA 94720-3310
and NBER
fally@berkeley.edu
1         Introduction
The integrability problem, which consists in characterizing demand systems that can be ratio-
nalized and derived from utility functions, has long been a central issue in economic theory.
Its earliest contributions date from Antonelli (1886), with applications to various fields, includ-
ing micro and macroeconomics, econometrics, industrial organization and international trade.
Theorists have provided broad sufficient and necessary conditions for demand patterns to be
integrable, notably Hurwicz and Uzawa (1971), who provide conditions based on the Slutsky
substitution matrix, which must be symmetric and negative semi-definite for all prices and
income levels.
    While very general, the Hurwicz and Uzawa (1971) integrability conditions lack practicality.
Perhaps a consequence is that applied theorists and practitioners have often focused on less
general cases to ensure both tractability and rationality. In particular, one often focuses on
directly-separable, indirectly-separable or quasi-linear preferences. An attractive feature of
these preferences is that demand depends only on a few variables, namely consumer income, a
good‚Äôs own price, and a single aggregator (scalar) that is itself a function of the vector of prices
and income. Such an aggregator can be, for instance, a price index (e.g. with constant elasticity
of substitution preferences) or the marginal utility of money (directly-separable preferences).
These preferences, however, have properties that may be undesirable and too restrictive in terms
of income and price effects. For instance, quasi-linear preferences suppress income effects, while
direct separability implies that income elasticities and price elasticities are proportional across
goods (‚ÄúPigou‚Äôs law‚Äù), a testable prediction that has been rejected by Deaton (1974).
    In this paper, we characterize more general demand systems that retain a key practical
property of these widely-used demand systems: the existence of a single price aggregator, a
feature that is very useful to welfare analysis and models of monopolistic and oligopolistic
competition. Following Pollak (1972), we refer to such a demand systems as ‚Äúgeneralized
separable‚Äù whereby demand satisfies:

                                                   qi = qi (pi /w, Œõ)                                     (1)

for each good i, where w refers to consumer income (total outlays), pi the price of good i, and Œõ
is a scalar (aggregator) function of all prices and income. Without providing a complete proof,
Gorman (1972, 1995) indicates that such demand system can take either of two main forms1 if
    1
        There are other cases that can be ruled out under additional restrictions on price sensitivity.




                                                           2
we impose the Slutsky matrix to be symmetric:

                              Di (F (Œõ)pi /w)
                       qi =                        or:     qi = Ai (Œõ)(pi /w)‚àíœÉ(Œõ)                       (2)
                                   H(Œõ)

where, in both cases, Œõ is a scalar that is adjusted so that the budget constraint is satisfied, and
can thus be defined as an implicit function of prices and income. As little is known about these
demand systems, they have not been used in the applied literature in spite of their usefulness.2
    The objectives of this paper are twofold. First, I provide conditions under which demand
with generalized separability have to take these two forms (i.e. a formal statement of Gorman‚Äôs
claims mentioned above). These functional forms however do not imply that these demand
systems are well defined and integrable, as shown with counter-examples in each case. The
second and main contribution is to show that any demand function that takes the form in
equation (2) can be integrated under weak restrictions. These restrictions ensure that the Slut-
sky substitution matrix not only is symmetric but also negative semi-definite, or equivalently,
a quasi-concave and well-defined utility function.
    In the first case, where demand satisfies qi = Di (F (Œõ)pi /w)/H(Œõ), integrability is guaran-
teed if Di is monotonically decreasing in pi , and demand qi is decreasing in Œõ. We will refer
to this case as a ‚Äúgeneralized Gorman-Pollak‚Äù demand system, which generalizes the demand
systems mentioned above. It corresponds to directly-additive utility when H(Œõ) is constant
and indirectly-additive utility when F (Œõ) is constant. This also generalizes the results of Mat-
suyama and Ushchev (2017), who focus on homothetic demand where F (Œõ) = 1/H(Œõ) = Œõ.
Income and price elasticities both depend on the functional form chosen for Di , which can
be very flexible; demand and price shifters H(Œõ) and F (Œõ) also influence income effects and
depend flexibly on the price aggregator.
    In the second case, with common price elasticities across goods and qi = Ai (Œõ)(pi /w)‚àíœÉ(Œõ) ,
integrability requires that the demand shifters Ai (Œõ) increase quickly enough in Œõ to ensure
that the associated utility is well defined. In that case, there is a one-to-one mapping between Œõ
and utility. Notice that the price elasticity œÉ(Œõ) does not have to remain constant or monotonic
across indifference curves; it can increase or decrease with Œõ, i.e. indifference curves can become
flatter or more convex as income goes up, as long as they do not cross. We will refer to that
case as ‚Äúgeneralized non-homothetic CES‚Äù. This second case features Allen-Uzawa substitution
elasticities that do not vary across goods but may vary with the demand aggregator Œõ, and
generalizes implicitly-additive utility functions previously defined by (Comin et al., 2015) who
impose a constant elasticity of substitution œÉ(Œõ) = œÉ. Relative to Gorman-Pollak demand, this
   2
    There are a few recent exceptions, including Bertoletti and Etro (2017a) for the first case, Comin et al.
(2015) and Matsuyama (2015) for the second case with homogeneous œÉ(Œõ) = œÉ.


                                                     3
case allows for more flexible income patterns, but less flexible price effects.3
    The demand systems in both cases yield various applications. They are particularly useful
in the case of monopolistic competition. In the limit where firms have small market shares,
they choose their price by taking as given other prices and quantities. It is then practical to
have a single industry-wide indicator Œõ that uniquely determines the locus of the demand curve
for a good with respect to its own price.4
    With the first type of demand system, the generalized Gorman-Pollak form, the price aggre-
gator Œõ can be interpreted as an index of tightness of the budget constraint,5 or alternatively
as an index of the toughness of competition in a model with firms. It may shift downward
or upward along demand curves as income and competition grows, with flexible implications
for markups. These demand functions encompass most examples from MraÃÅzovaÃÅ and Neary
(2013), e.g. bi-power and inverse bi-power demand functions, or Weyl and Fabinger (2013),
e.g. Bulow-Pfleiderer demand. With iso-elastic functions H and Di , they coincide with the
self-dual addilog demand systems (Houthakker, 1965) and extend the constant relative income
elasticities (CRIE) used for instance in Fieler (2011) and Caron et al. (2014). The general-
ized Gorman-Pollak form can also generate choke prices (as demand Di for a good i goes to
zero) which can be expressed as a simple function of income and the price aggregator, with a
functional form that is again more flexible than commonly used in macroeconomics and inter-
national trade. In particular, this form can be used to generalize the results of Bertoletti and
Etro (2017b) and Bertoletti et al. (2016) in which the choke price is proportional to income.
    Applications of the second type of demand, with generalized non-homothetic CES, remain
very tractable and empirically relevant, because they allow for heterogeneous price elasticities
across the income distribution. Several studies (such as Handbury, 2013 and Faber and Fally,
2017) based on expenditure surveys and scanner data have shown that price elasticities vary
significantly with income. Handbury (2013) and Faber and Fally (2017) model income effects in
the elasticity of substitution by relying on a numeraire good. With generalized non-homothetic
CES, we can instead generate such relationship between income and the elasticity of substitution
through utility, without relying on a numeraire, while retaining a common elasticity œÉ(Œõ) across
goods for a given income level.
    The paper is also related to a vast literature studying functional forms restrictions of utility
   3
     Note that implicitly-additive utility depends on a single aggregator only in the case where the Allen-Uzawa
elasticity of substitution is common across goods. In other cases, such as Kimball (1995), two aggregators are
needed. See also Preckel et al. (2005) for another form of implicitly additive utility and generalization of CES
preferences.
   4
     Bertoletti and Etro (2017a) recent work formalizes this insight and covers this demand system as an example.
   5
     Aggregator Œõ is implicitly determined by the budget constraint and its role is very similar to the Lagrange
multiplier under directly-separable preferences.




                                                       4
and demand systems. Ligon (2016) focuses on cases where the aggregator Œõ corresponds to
the Lagrange multiplier associated with the budget constraint, and shows that Œõ‚àíseparability
implies directly-additive utility with even more specific functional forms. Nocke and Schutz
(2017) study the (‚Äúquasi-‚Äù) integrability of quasi-linear demand systems, i.e. without income
effects. Atkin et al. (2018) examine quasi-separable preferences (following Gorman, 1970, 1995)
and applications to welfare estimation using Engel curves. The discussion on the existence of
aggregators also mirrors the restrictions associated with the rank of a demand system (Gorman,
1981; Lewbel, 1991, 2010; LaFrance and Pope, 2006; Lewbel and Pendakur, 2009). The rank
of a demand system corresponds to the number of vectors and homothetic price aggregators
needed to recover Engel curves (see Lewbel, 1991). Here, the single aggregator Œõ is generally not
homogeneous of degree one in prices (it also depends on income) and the two demand systems
studied here do not have restrictions in terms of rank. Finally, Blackorby et al. (1978) study
functional forms implied by various definitions of separability, and find that the same functional
structure as with generalized non-homothetic CES is obtained when imposing stronger forms
of separability that imply equality among Allen-Uzawa elasticities of substitution.
    The remainder of the paper proceeds as follows. Section 2 examines the functional forms
imposed by generalized separability. Section 3 provides sufficient conditions to ensure integra-
bility for each type of demand. Section 4 discusses key properties of these demand systems.
Section 5 concludes by discussing various applications.


2    Functional Forms under Generalized Separability
Additively-separable utility allows us to obtain demand as a simple function of a good‚Äôs own
price pi and a single aggregator, the Lagrange multiplier. While practical, both direct and indi-
rect separability put strong constraints on the structure of demand, such as a tight relationship
between price elasticity and income elasticity, with for instance the adverse consequence that
preferences with constant elasticity of substitution (CES) are the only directly-separable and
indirectly-separable preferences that are homothetic.
    In an attempt to generalize the concept of separability, Gorman (1972) and Pollak (1972)
define generalized separability as demand that would take the form:

                                        qi = qi (pi /w, Œõ)                                    (3)

where qi refers to demand for good i (quantity) and Œõ is implicitly defined by the budget
constraint:
                               X
                                  pi qi = pi qi (pi /w, Œõ) = w


                                                5
i.e. such that total expenditures equal a fixed revenue w. Note that, generally, Œõ is not a
Lagrange multiplier, except for the case where demand can be derived from a directly-additive
separable utility (Ligon 2016).
    In an unpublished note by Gorman (printed in Gorman, 1995) mentioned by Pollak (1972),
Gorman indicates that a demand system defined as above needs to take specific forms in order
to satisfy Slutsky‚Äôs symmetry condition. With a few additional restrictions, this result can be
formulated as follows:6


Proposition 1 If demand satisfies the following conditions:
  i) generalized separability (equation 3);
  ii) there are at least four goods,
  iii) holding Œõ constant, (pi /w)qi (pi /w, Œõ) is not constant over the range of prices pi

Then demand can be written as either:

                                       Di (F (Œõ)pi /w)
         case 1:       qi (pi /w, Œõ) =                           for all goods i and all pi , w, Œõ
                                            H(Œõ)
         case 2:       qi (pi /w, Œõ) = Ai (Œõ)(pi /w)‚àíœÉ(Œõ)           for all goods i and all pi , w, Œõ
        + case 2‚Äô:     qi (pi /w, Œõ) = Ai ŒõœÅ (pi /w)‚àíœÉ          for all but one good i

or a combination of cases 2 and 2‚Äô depending on Œõ. In all cases, Œõ is implicitly defined such
                                                   P
that budget constraint is satisfied, i.e. such that i qi (pi /w, Œõ)pi = w.


    The proof of Proposition 1 is rather tedious. A key step is to show that the symmetry of
the Slutsky matrix implies, with a few exceptions, that either the cross-elasticity of demand
w.r.t to the normalized price pi /w and Œõ is constant across all goods (this corresponds to case
                                                ‚àíŒõi
2 above) or that the ratio of elasticities Œõi
                                             yi ‚àíyi
                                                     is identical across all pairs of goods (conditional
on Œõ), where Œõi denotes the demand elasticity of good i w.r.t Œõ and yi w.r.t own normalized
prices pi /w. Solving differential equations implied by these constraints, we can then show that
the functional forms above are the only possible demand functions. Symmetry of the Slutsky
matrix is the only constraint that is imposed on substitution patterns, and the negative semi-
definiteness is not yet guaranteed.
   6
     Gorman‚Äôs sketch of proof had many shortcuts, as he himself noted: ‚ÄúThroughout this paper I have talked
as if my claims were definitely proven. Of course this is not so: my arguments are far from rigorous‚Äù (Gorman,
1995). Here I impose somewhat stronger assumptions on the form of demand and price effects in order to avoid
a few inelegant cases. In particular, the assumption that expenditure shares are not just a function of Œõ allows
me to avoid what Gorman calls ‚Äúthe abnormal case‚Äù.



                                                       6
   Since the third case is relatively interesting and elegant (CES for all but one good), the
remainder of the paper focuses on cases 1 and 2, setting aside case 2‚Äô. Note that there may
be alternative functional forms under generalized separability if we allow for price-insensitive
expenditures shares, which Gorman calls ‚Äúabnormal‚Äù goods. Assumption iii) allows us to
exclude such cases.
   Finally, note that functional forms are unique up to a constant term and a monotonic
transformation of Œõ:


Proposition 2 Uniqueness of functional forms, except for the CES case:

       Case 1: H(Œõ) and F (Œõ) are uniquely determined by demand patterns, up to a constant
       term and a strictly-monotonic transformation of Œõ

       Case 2: Ai (Œõ) and œÉ(Œõ) are uniquely defined by demand patterns, up to a strictly-
       monotonic transformation of Œõ


To prove this result, in case 1), note that price effect depend tightly on ŒµDi (see sections 3.2
and 3.3), hence price elasticities can be used to determine Di . One can then identify functions
F and H by examining variations in ŒµDi depending on income (except in the CES case).7 In
case 2), œÉ corresponds to price elasticities and Ai (Œõ) can be determined by examining income
expansion path. Note that for any function H, F , Ai and œÉ, one would obtain the same demand
patterns after the change in variable Œõ0 = g(Œõ) with any one-to-one mapping g.
   In the first case, note that we can express the inverse demand system as:

                                      pi /w = (1/F (z)) Di‚àí1 (H(z)qi )                                        (4)

where z is implicitly defined as described in equation (8) as function of the vector of con-
sumption. When F (z)H(z) is constant and preferences are homothetic, this aggregator z is
homogeneous of degree one in quantities qi . This inverse demand formulation highlights the
symmetric role of H vs. F . While H is the demand shifter in the direct demand function
(equation 4), now F is the demand shifter in the inverse demand function.
   7
    Price and income elasticities depend on the ratio of ŒµF and ŒµH which is uniquely determined once we know
these elasticities. Taking a strictly monotonic transformation of Œõ does not change this ratio and yields the same
consumption patterns (assuming that this new aggregator is also such that the budget constraint is satisfied).




                                                        7
3      Integrability
3.1     Integrability of Generalized Gorman-Pollak Demand
Let us now examine the reciprocal of Proposition 1. Under which conditions are these de-
mand systems integrable, i.e. can be derived from a rational utility-maximizing consumption
behavior? These functional forms, imposed by the symmetry of the Slutsky matrix, do not
necessarily correspond to rational consumer behavior (see counter-examples in Appendix B).
However it turns out that only weak additional conditions are sufficient to guarantee that the
demand systems described in Proposition 1 are integrable.
   Suppose that demand is given by:

                                               Di (F (Œõ)pi /w)
                                       qi =                                                   (5)
                                                    H(Œõ)
                                                              P
where Œõ is implicitly determined by the budget constraint       i pi Di (F (Œõ)pi /w)/H(Œõ) = w,
which can be rewritten:
                                     X
                            H(Œõ) =       (pi /w) Di (F (Œõ)pi /w)                           (6)
                                           i

   Let us denote by ŒµDi = ‚àÇ‚àÇlog     Di
                                 log x
                                       the elasticity of Di in its argument, and ŒµH = ‚àÇ‚àÇ log H
                                                                                         log Œõ
                                                                                               and
     ‚àÇ log F
ŒµF = ‚àÇ log Œõ the elasticity of H and F in Œõ.
   To ensure integrability, we impose the following sufficient regularity restrictions:

Regularity assumptions [A1] on functions Di and H:

    i) Di is differentiable, ŒµDi < 0 unless Di = 0

    ii) H and F are differentiable and ŒµF ŒµDi < ŒµH for all i, Œõ and pi /w

 iii) For any set of normalized prices pi /w, equation (6) admits a solution in Œõ.


Note that instead of [A1] ii) we could assume that ŒµF ŒµDi ‚àí ŒµH has the same sign for all i, Œõ and
pi /w. Assuming that this difference is negative is without loss of generality as we can always
make the change in variable Œõ0 = 1/Œõ to invert its sign for all goods and prices. Assumptions i)
and ii) imply that the solution in Œõ to equation (6) is always unique, but they are also needed
to show that utility is quasi-concave and that the Slutsky substitution matrix is negative semi-
definite. However, condition ii) on elasticities does not ensure that there exists a Œõ to satisfy
the budget constraint, so we need to also impose condition iii). Note also that condition iii)
could be implied by stricter conditions on elasticities (see Appendix C for practical examples).

                                                   8
       Under these conditions, we obtain:


Proposition 3 If H and Di satisfy the regularity conditions [A1], the demand described in
equations (5) and (6) is integrable, i.e. can be derived from a utility function.


I provide two alternative proofs in Appendix. First, we can reconstruct a utility function that
depends on an implicitly-defined aggregator.8 We can show that demand can be derived from
the maximization of:
                                   XZ    x=H(z)qi                    Z   z
                         U (q) =                    Di‚àí1 (x)dx   ‚àí           H 0 (z)F (z)dz                 (7)
                                    i   x=xi0                        z0


for arbitrary z0 , x0i ‚â• 0 and where z is itself a function of the consumption vector x implicitly
defined by:
                                             X
                                    F (z) =       qi Di‚àí1 (H(z)qi )                            (8)
                                                    i

As a slight abuse of notation, we define Di‚àí1 (0) = ai if Di (y) = 0 for all y ‚â• ai (which yields a
choke price) and Di‚àí1 (x) = 0 for all x ‚â• bi if Di (0) = bi . Regularity conditions [A1] are needed
to ensure that equation (8) always has a unique solution in z and that the utility function
is quasi-concave. Note that equation (8) can be seen as a first-order condition such that the
derivative of the expression above for U has a zero derivative in z, and such that:

                                            ‚àÇU
                                                = Di‚àí1 (H(z)qi )                                            (9)
                                            ‚àÇqi

The two aggregators Œõ (function of prices and income) and z (function of quantities q) coincide
for the optimal consumption basket.9
    An alternative proof of Proposition 3 checks that the Slutsky substitution matrix is negative
semi-definite under these restrictions, so that we can apply the integrability theorem of Hurwitz
and Uzawa (1971). Thanks to Proposition 1, we already know that it is symmetric but this
does not ensure semi-definite negativity. As one could expect, the conditions ensuring the semi-
definite negativity of the Slutsky matrix are the same as those providing the quasi-concavity
of the utility function above.
   8
     This utility representation was pointed out by Gorman (1987) with a more restrictive formulation and
no formal proof that such utility
                                P    function is well defined and quasi-concave. Gorman formulated this as a
maximization: U = maxz { i ui (zqi ) ‚àí Œ¶(z)} but this approach omits very useful cases (e.g. cases with
0 < Œ≤ < 1 in applications 3, 4, 9 and 10 in Section 4) where the second order condition of this maximization is
not satisfied yet the utility function remains quasi-concave with z implicitly defined by equation 8.
   9
     But note that z is defined as a function of the vector of quantities while Œõ is a function of the vector of
prices and income.


                                                        9
    Next, an important concern is whether the set of conditions [A1] can be relaxed, but I argue
here that all are needed. First, the demand system would clearly not be well defined if it does
not have a solution in equation (6), so condition iii) is unavoidable. It is possible to impose
more simple conditions to ensure existence, but such condition would be less general. Second,
restriction ii) is the simplest and more direct way to insure that the equation defining the price
aggregator has a unique solution. It is required for good i for a given level of prices when a
good i has a sufficiently large expenditure share. In Appendix B, I provide an example with two
goods where restrictions i) and iii) are met but the Slutsky matrix is no longer negative semi-
definite when ŒµF ŒµDi ‚àí ŒµH does not have the same sign for the two goods. Finally, restriction i)
ensures that we have a negative effect of prices on demand when the expenditure share of a good
is small (a positive price effect would not be rational for small expenditure shares). Inverting
Di is also needed in equations (8) and (7) to retrieve utility.
    The case F (Œõ) = 1/H(Œõ) coincides with Matsuyama and Ushchev (2017) for homothetic
preferences. With the change in variable: F (Œõ) = 1/H(Œõ) = wŒõ0 (where Œõ0 is again implicitly
determined by the budget constraint), a demand system such that qi = Œõ0 wDi (Œõ0 pi ) can be
rationalized as long as ŒµDi + 1 has the same sign for all goods (which is equivalent to A1-ii). If
ŒµDi + 1 is negative, we define Œõ0 instead by w/Œõ0 = F (Œõ) = 1/H(Œõ).
    In general, Proposition 3 does not require F (Œõ) to be monotonic in Œõ. If F 0 (Œõ) > 0, an
increase in Œõ (tightness of the budget constraint) leads to a downward shift in the partial
demand curve Di . When F 0 (Œõ) < 0, we would instead have an upward shift in Di , which
needs to be compensated by a large enough decrease in the demand shifter H(Œõ). If F (Œõ) can
be inverted (which is satisfied for most applications provided in Section 4), note that we can
reformulate demand as:
                                                                   X
               qi = H(Œõw)D
                    e      i (Œõpi )          s.t.:      H(Œõw)
                                                        e              pi Di (Œõpi ) = w      (10)
                                                                   i


with the change in variable: Œõ0 = F (Œõ)/w and the transformation 1/H(¬∑)     e    = H(F ‚àí1 (¬∑)). In
this case, condition [A1] ii) and iii) are automatically satisfied if there exists  > 0 such that
ŒµHe + ŒµDi < ‚àí for all pi , w and Œõ.


3.2    Integrability of Generalized Non-Homothetic CES
Now, consider the second case of Proposition 1. Let us assume that demand is given by:

                                  pi qi = w (Gi (Œõ) pi /w)1‚àíœÉ(Œõ)                             (11)




                                               10
where Œõ is an implicit function of the vector of normalized prices pi /w such that the budget
constraint is satisfied:
                                  X
                                     (Gi (Œõ)pi /w)1‚àíœÉ(Œõ) = 1                             (12)
                                             i

To ensure integrability, we impose the following sufficient regularity restriction [A2]:


Regularity assumptions [A2] For each Œõ, we have œÉ(Œõ) 6= 1 and either one of the following
two conditions:

   i) œÉ(Œõ) is weakly increasing in Œõ and Gi (Œõ) is strictly increasing in Œõ
                                                                                                    P
   ii) œÉ(Œõ) is decreasing in Œõ and, for each Œõ0 , there exists Œ±i > 0 such that                         i   Œ±i = 1 and
                                 1
                              œÉ(Œõ)‚àí1
       such that Gi (Œõ) Œ±i             is strictly increasing in Œõ in a neighborhood of Œõ0


When both œÉ(Œõ) and Gi (Œõ) are all differentiable, condition ii) can be rewritten after solving
for the minimum Œ±i that would satisfy this monotonicity condition. Condition ii) is formally
equivalent to imposing:10
                                      (œÉ(Œõ) ‚àí 1)2 G0i (Œõ)
                            X                            
                                exp         0 (Œõ)G (Œõ)
                                                            <1                            (13)
                             i
                                          œÉ       i

See Appendix for the proof of equivalence.
   We obtain the following proposition for generalized non-homothetic CES:


Proposition 4 Suppose that demand can be written as in equation (11) where Gi and œÉ are
continuous and where Œõ is implicitly defined by (12). This demand system is integrable if
conditions [A2] are satisfied. Under [A2], demand can be derived from a utility function that is
implicitly defined by:
                                   X                œÉ(U )‚àí1
                                       (qi /Gi (U )) œÉ(U ) = 1                             (14)
                                                 i

which has a unique solution in U , with Œõ = U for the demand qi described above.


The constant elasticity case œÉ(Œõ) = œÉ corresponds to implicitly additive utility as in (Comin
et al., 2015). This is not equivalent to the standard CES since, even in that case, non-trivial
  10
     In general, note that condition ii) need not hold for any set of Œ±i ‚Äôs, it is sufficient that it holds for a single
set of Œ±i ‚Äôs. In particular, using Œ±i = 1/N (where N denotes the number of goods), a sufficient condition is that
             1
Gi (Œõ) N 1‚àíœÉ(Œõ) strictly increases in Œõ.




                                                          11
income effects through the demand shifter Gi (Œõ) allow for very flexible Engel curves. The main
contribution of this proposition is to generalize to variable elasticity of substitution.
    The proof of Proposition 4 mainly consists in showing that Œõ is well-defined, i.e. that
the budget constraint has a unique solution in Œõ, and that utility is also uniquely defined by
equation 14. As the more general case allows for varying curvature of indifference curves, one
needs to ensure in particular that these indifference curves do not cross.
                                                                     hP           i1
                                                                                œÅ œÅ
    The proof proceeds as follows. First we show in a lemma that         i Œ±i x i    is monotonically
                   P
increasing in œÅ if i Œ±i = 1 (a consequence of Jensen‚Äôs inequality). This allows us to obtain
comparative statics in the exponent in equations (14) and (12). We can then show that the
solutions to these equations are unique, for a given set of income and prices, or quantities.
Once we have uniqueness, it is easy to verify the quasi-concavity of the utility function (as in
Comin et al., 2015). The last step is to check that this utility maximum problem does yield
the demand system described above.
    Again, as for Proposition 3, a potential concern is whether restrictions [A2] are necessary.
When neither condition i) or ii) is satisfied, neither the demand system described above nor the
utility in Proposition 3 is well defined. Counter-examples in the Appendix further illustrate
the role of each condition, showing that equations (12) and (14) admit multiple solutions in Œõ
and U if conditions i) and ii) are not satisfied. Incidentally, this shows that monotonicity in
demand shifters Gi (Œõ) is not sufficient.11
    One should also point out why we need different conditions depending on whether œÉ(Œõ)
decreases or increases with Œõ. In the first case, where œÉ(Œõ) increases with Œõ, indifference
curves become flatter as we move away from the origin (with increases in income and Œõ). In
that case, indifference curves are most likely to cross around the intercepts (when only one
good is consumed). Monotonicity in Gi (Œõ) is then sufficient to ensure that indifference curves
do not cross. In the second case, where the elasticity of substitution œÉ(Œõ) decreases with Œõ, the
indifference curves are more curved as we move away from the origin. In this case, indifference
curves are most likely to be close to each other and intersect in the middle.
 11
      We can also have œÉ(Œõ) = 1 for a discrete number of limit cases.




                                                       12
4     Properties: Welfare, price and income effects
4.1     Generalized Gorman-Pollak
Price elasticities. In this case, the price elasticity of Marshallian demand is:

                            ‚àÇ log qi                  Wj (1 + ŒµDj )(ŒµH ‚àí ŒµF ŒµDi )
                                     = ŒµDi . 1(i=j) ‚àí
                            ‚àÇ log pj                         ŒµH ‚àí ŒµF ŒµÃÑD

where Wj is the expenditure share of good j and 1(i=j) is a dummy equal to one when i = j.
Given our restriction ŒµH > ŒµF ŒµDi , the cross-price elasticity (i 6= j) is positive if and only if
ŒµDj < ‚àí1. The own-price elasticity is always negative, which rules out Giffen goods.
   The own price elasticity is mainly determined by the shape of function Di when that good
has a negligible market share:
                                         ‚àÇ log qi
                                                  ‚âà ŒµDi
                                         ‚àÇ log pi
Since we impose very few constraints on ŒµDi the patterns of price elasticities can be very flexible.

Shifters and choke prices. For applications to oligopolistic and monopolistic competition,
a key determinant of the toughness of competition is the position along demand curves. Here
this is reflected in the price shifter F (Œõ)/w as well as the demand shifter H(Œõ). Either one is
constant with directly or indirectly-separable preferences.
    The demand system can be accommodated to yield choke prices (also called reservation
prices), i.e. a price threshold p‚àói such that Di (F (Œõ)pi /w) = 0 for all pi ‚â• p‚àói , which arises as
soon as Di (y) = 0 for large enough y‚Äôs.12
    Of particular interest is how choke prices depend on income. Income is irrelevant with
homothetic preferences, but this prediction contradicts substantial evidence (e.g. Hummels
and Klenow 2007) showing that richer consumer buy a greater variety of goods and that richer
countries import a larger variety of products. A special case corresponds to indirectly-additive
preferences (H is constant). In this case, choke prices are linear in income, as documented by
Bertoletti et al (2017). In the general case, the choke price depends on both income and the
toughness of competition, captured by Œõ:

                                                            ai w
                                                   p‚àói =
                                                           F (Œõ)
  12
     Choke prices are particularly useful in international trade to explain why less efficient firms are less likely
to export to a specific market (without having to rely on export fixed costs) and to obtain gravity equations as
shown in Melitz and Ottaviano (2008) and Arkolakis et al (2015) among others.




                                                        13
where ai = min{Di‚àí1 (0)} is the level above which demand is null.

Income effects. The income elasticity of good i is:

                                 ‚àÇ log qi     (ŒµH + ŒµF )(ŒµÃÑD ‚àí ŒµDi )
                                          =1+                                                           (15)
                                 ‚àÇ log w          ŒµH ‚àí ŒµF ŒµÃÑD

Using this expression, one can see that homotheticity implies that either ŒµH = ‚àíŒµF or ŒµDi = ŒµÃÑD
for all i.
     As pointed out by Pigou (1910) and Deaton (1974), own-price elasticities and income elas-
ticities are tightly linked when demand is derived from a directly-additive utility (which corre-
sponds to the case where ŒµH = 0). Here we obtain: ‚àÇ‚àÇ log     qi
                                                         log w
                                                                = ŒµŒµÃÑDi
                                                                     D
                                                                        with directly separable utility.
With ŒµH 6= 0, the relationship between income elasticity and price elasticity is muted and we
obtain a demand system that is more in line with Deaton (1974) empirical results. Note that
‚àÇ log qi
‚àÇ log w
         ‚àí 1 has the same sign as ŒµÃÑD ‚àí ŒµDi when ŒµF + ŒµH > 0, and flipped otherwise. This property
can seem attractive, as empirical evidence indicates that price-elastic goods are not necessarily
more income elastic.

Homotheticity. This demand system is homothetic if and only if H(Œõ)F (Œõ) is constant or
if it is CES. This corresponds to the case studied by Matsuyama and Ushchev (2017). In this
case, without loss of generality we can assume that F (z) = 1/H(z) = z. We obtain that a
utility representation given by:

                                                    XZ          x=qi /z
                             U (q) = log(z) +                             Di‚àí1 (x)dx                    (16)
                                                        i   x=xi0


                                   ‚àí1
                       P
where z is such that     i (qi /z)Di (qi /z)   = 1, and xi0 are constant terms.

Indirect utility. Here we draw from Pollak (1972) to show that indirect utility can be ex-
pressed as:

                                           XZ     yi0                           Z   Œõ
               V (p, w) = Ve (p, w, Œõ) =                        Di (y)dy +              F 0 (l)H(l)dl   (17)
                                           i     (pi /w)F (Œõ)                     Œõ0


where Œõ = Œõ(p, w) is implicitly defined as above, and where yi0 and Œõ0 are constant terms.
Conveniently, we can verify that ‚àÇ‚àÇŒõVe
                                       = 0, hence we obtain simple expressions for marginal
(indirect) utility from income and price changes. Taking the derivative w.r.t income, one can




                                                    14
interpret the product of the two shifters as the marginal utility of income:

                                    ‚àÇV (p, w)   F (Œõ)H(Œõ)
                                              =                                              (18)
                                      ‚àÇw            w

This expression can also be useful to compute equivalent and compensating variations, implic-
itly defined such that V (p0 , w ‚àí CV ) = V (p, w) and V (p, w + EV ) = V (p0 , w0 ).

Additivity When are these preferences directly or indirectly additive? Recall that prefer-
                                                                    P
ences are directly additive if utility can be written as U (q) = f ( i ui (qi )) where f and {ui }
are scalar functions. Preferences are indirectly additive if indirect utility can be written as
             P
V (p, w) = g( i vi (pi /w)) where g and {vi } are scalar functions.
    From equation (7), we can conclude that utility is directly-additive if and only if H is
constant or demand is CES. From equation (17) for indirect utility, we can see that we have
indirect additivity if and only if F is constant or demand is CES.


4.2    Generalized Non-Homothetic CES
Price effects. In the second case, when demand corresponds to equation (11), price effects
are more simple. The price elasticity of the Hicksian demand corresponds to œÉ(Œõ), since we
can also interpret Œõ as utility (Proposition 3).

Income effects. In the second case, demand corresponding to equation (11) yields even more
flexible income effects. Changes in Gi (Œõ) in Œõ need not be related to changes in œÉ(Œõ). Starting
with the special case where œÉ(Œõ) = œÉ is constant, which corresponds to Hanoch (1975), the
effect of income on Œõ is such that:
                                         ‚àÇ log Œõ   1‚àíœÉ
                                                 =                                          (19)
                                         ‚àÇ log w    ŒµÃÑG
                                             ŒõG0 (Œõ)
where ŒµÃÑG is an average of elasticities ŒµGi = Gii(Œõ) weighted by expenditures shares. We obtain
the income elasticity:                                     
                                   ‚àÇ log qi                ŒµGi
                                            = œÉ + (1 ‚àí œÉ)                                  (20)
                                   ‚àÇ log w                 ŒµÃÑG
Good i is income-elastic if œÉ < 1 and ŒµGi > ŒµÃÑG or if œÉ > 1 and ŒµGi < ŒµÃÑG . In the more general
case where œÉ(Œõ) is not constant, function Gi plays a similar role and dictates income effects.
Moreover, depending on how income affects Œõ (with depends on both the sign of œÉ 0 (Œõ) and
whether œÉ(Œõ) is smaller than unity), one can have œÉ increase or decrease with income.
   One constraint, however, links the price elasticity and the income elasticity. Both in the
cases where œÉ(Œõ) is fixed or increasing in Œõ, the price elasticity imposes a lower bound on


                                                15
income elasticities of demand:13

                                     ‚àÇ log qi
                                              > œÉ(Œõ)              if œÉ(Œõ) < 1
                                     ‚àÇ log w
                                     ‚àÇ log qi
                                              < œÉ(Œõ)              if œÉ(Œõ) > 1
                                     ‚àÇ log w

Homotheticity. The demand system in (11) is homothetic only in the CES case, as one can
see for instance in expression (20).


5        Concluding remarks
Economists have often focused on demand systems where prices are conveniently summarized by
a single aggregator, and where demand depends solely on such an aggregator, total expenditures
and a good‚Äôs own price (‚Äúgeneralized separability‚Äù, following the terminology of Pollak 1972).
Here I show that such a demand system can take only one of two forms when price effects are not
trivial. This result was already known by Pollak (1972) and Gorman (1972) but not formally
demonstrated and is not well known today in spite of its usefulness. Furthermore, I show that
these two types of demand systems are integrable (i.e. can be derived from well-behaved utility
functions) under fairly mild regularity restrictions that guarantee the semi-definite negativity
of the Slutsky substitution matrix (and quasi-concavity of utility).
    The first case of demand allows for very flexible price effects but more restricted income
effects. This is particularly useful in industrial organization where income effects are not the
main focus. The second case of demand allows for very flexible income effects (highly flexible
Engel curves) but more restricted price effects. Allen-Uzawa substitution elasticities have to
be constant across goods to ensure the symmetry of the Slutsky matrix, but here I show that
they may vary (increase or decrease) with utility and thus vary indirectly with income.
    There can be numerous applications and uses of such demand systems, spanning different
fields. I provide additional examples in Appendix C. I describe cases of Gorman-Pollak forms
where functions H and F are iso-elastic, which provides simple generalizations of directly-
separable and indirectly-separable preferences, and cases where functions Di are iso-elastic,
which coincide with self-dual addilog demand systems (Houthakker 1965). Other examples
described in the appendix generalize demand systems featured in Mazrova and Neary (2013),
such as cases where functions Di take a bi-power form, and the use of non-homothetic CES.
                                                                                             (œÉ(Œõ)‚àí1)2 G0i (Œõ)
                                                                                                                
  13
       When œÉ(Œõ) decreases in Œõ, the income elasticity exceeds œÉ(Œõ) if and only if exp         œÉ 0 (Œõ)Gi (Œõ)         < Wi .
This need not be satisfied, even if inequality (13) is imposed.




                                                       16
References
Antonelli, G. B. (1886). Sulla teoria matematica della economia politica.

Atkin, D., B. Faber, T. Fally, and M. Gonzalez-Navarro (2018). ‚ÄúA New Engel on the Gains
  from Trade‚Äù. Working paper .

Bertoletti, P. and F. Etro (2017a). Monopolistic competition, as you like it. University Ca‚Äô
  Foscari of Venice, Dept. of Economics Research Paper Series, 08/2017.

Bertoletti, P. and F. Etro (2017b). Monopolistic competition when income matters. The
  Economic Journal 127 (603), 1217‚Äì1243.

Bertoletti, P., F. Etro, and I. Simonovska (2016). International trade with indirect additivity.
  National Bureau of Economic Research WP No. 21984 .

Blackorby, C., D. Primont, and R. R. Russell (1978). Duality, separability, and functional
  structure: Theory and economic applications, Volume 2. Elsevier Science Ltd.

Caron, J., T. Fally, and J. Markusen (2017). Per capita income and the demand for skills.
  National Bureau of Economic Research WP No. 23482 .

Caron, J., T. Fally, and J. R. Markusen (2014). International trade puzzles: A solution linking
  production and preferences. The Quarterly Journal of Economics 129 (3), 1501‚Äì1552.

Comin, D. A., D. Lashkari, and M. Mestieri (2015). Structural change with long-run income
  and price effects. National Bureau of Economic Research Working Paper .

Deaton, A. (1974). A reconsideration of the empirical implications of additive preferences. The
  Economic Journal 84 (334), 338‚Äì348.

Faber, B. and T. Fally (2017). Firm heterogeneity in consumption baskets: Evidence from
  home and store scanner data.

Fieler, A. C. (2011). Nonhomotheticity and bilateral trade: Evidence and a quantitative ex-
  planation. Econometrica 79 (4), 1069‚Äì1101.

Gorman, W. M. (1970). Quasi separable preferences, costs, and technologies. Unpublished
 manuscript.

Gorman, W. M. (1972). Conditions for generalized additive separability. Unpublished tran-
 script, now printed in Gorman (1995).

Gorman, W. M. (1981). Some engel curves. Essays in the theory and measurement of consumer
 behaviour in honor of sir Richard Stone.

Gorman, W. M. (1987). Separability. The New Palgrave: A Dictionary of Economics, London:
 Macmillan Press, 4, 305‚Äì11.



                                              17
Gorman, W. M. (1995). Collected Works of WM Gorman: Separability and Aggregation, Vol-
 ume 1. Oxford University Press.

Handbury, J. (2013). Are poor cities cheap for everyone? non-homotheticity and the cost of
  living across us cities. Mimeograph, Wharton University.

Hanoch, G. (1975). Production and demand models with direct or indirect implicit additivity.
  Econometrica, 395‚Äì419.

Houthakker, H. S. (1965). A note on self-dual preferences. Econometrica, 797‚Äì801.

Hurwicz, L. and H. Uzawa (1971). On the integrability of demand functions. Preferences,
 utility, and demand , 114‚Äì148.

LaFrance, J. T. and R. D. Pope (2006). Full rank rational demand systems. Department of
  Agricultural & Resource Economics, UCB .

Lewbel, A. (1991). The rank of demand systems: theory and nonparametric estimation. Econo-
  metrica: Journal of the Econometric Society, 711‚Äì730.

Lewbel, A. (2010). Shape-invariant demand functions. The Review of Economics and Statis-
  tics 92 (3), 549‚Äì556.

Lewbel, A. and K. Pendakur (2009). Tricks with hicks: The easi demand system. The American
  Economic Review 99 (3), 827‚Äì863.

Ligon, E. (2016). All Œª-separable demands and rationalizing utility functions. Economics
  Letters 147, 16‚Äì18.

Matsuyama, K. (2015). ‚ÄúThe home market effect and patterns of trade between rich and poor
 countries‚Äù. Working paper .

Matsuyama, K. and P. Ushchev (2017). ‚ÄúBeyond CES: Three alternative classes of flexible
 homothetic demand systems‚Äù. Working paper .

Mayer, T., M. J. Melitz, and G. I. Ottaviano (2014). Market size, competition, and the product
 mix of exporters. The American Economic Review 104 (2), 495‚Äì536.

Melitz, M. J. and G. I. Ottaviano (2008). Market size, trade, and productivity. The Review of
 Economic Studies 75 (1), 295‚Äì316.

MraÃÅzovaÃÅ, M. and J. P. Neary (2013). Not so demanding: Preference structure, firm behavior,
 and welfare. The American Economic Review (forthcoming).

Mrazova, M., J. P. Neary, and M. Parenti (2017). Sales and markup dispersion: Theory and
 empirics. CEPR Discussion Paper No. DP12044 .

Nocke, V. and N. Schutz (2017). Quasi-linear integrability. Journal of Economic Theory 169,
 603‚Äì628.


                                             18
Ottaviano, G., T. Tabuchi, and J.-F. Thisse (2002). Agglomeration and trade revisited. Inter-
  national Economic Review , 409‚Äì435.

Pollak, R. A. (1972). Generalized separability. Econometrica: Journal of the Econometric
  Society, 431‚Äì453.

Preckel, P. V., J. Cranfield, T. W. Hertel, et al. (2005). Implicit additive preferences: A
  further generalization of the ces. In Annual Meetings of the American Agricultural Economics
  Association, pp. 24‚Äì27.

Weyl, E. G. and M. Fabinger (2013). Pass-through as an economic tool: Principles of incidence
 under imperfect competition. Journal of Political Economy 121 (3), 528‚Äì583.




                                             19
Appendix A ‚Äì Proofs of Propositions 1, 3 and 4
Proof of Proposition 1
Consider the demand system:
                                         qi = (w/pi ).Wi (pi /w, Œõ)                               (21)
where Wi denotes expenditure shares as a function of normalized prices pi /w (demand is homogeneous
of degree zero in prices and income) and Œõ (by assumption), and where Œõ is implicitly determined by
the budget constraint:                  X
                                            Wi (pi /w, Œõ) = 1                                  (22)
                                              i

We denote normalized prices by yi ‚â° P   pi /w such that qi = (1/yi ).Wi (yi , Œõ) and with Œõ an implicit
function of the vector of yi such that:   j Wj (yj , Œõ) = 1.
   For i 6= j, the Slutsky substitution coefficient is:
                         ‚àÇqi       ‚àÇqi
               sij   =        + qj
                         ‚àÇpj       ‚àÇw
                                              
                         w ‚àÇWi ‚àÇŒõ           ‚àÇŒõ        qj ‚àÇWi      qj qi
                     =                 + qj      ‚àí              ‚àí
                         pi ‚àÇŒõ ‚àÇpj          ‚àÇw        w ‚àÇyi        w
                                                              
                         ‚àÇ log Wi qi ‚àÇ log Œõ     qi qj ‚àÇ log Œõ      qj qi ‚àÇ log Wi   qj qi
                     =                         +                 ‚àí                 ‚àí
                          ‚àÇ log Œõ pj ‚àÇ log pj     w ‚àÇ log w           w ‚àÇ log yi      w
                         qi Œõi ‚àÇ log Œõ   qi qj Œõi ‚àÇ log Œõ   qj qi yi   qj qi
                     =                  +                   ‚àí           ‚àí
                          pj ‚àÇ log pj         w ‚àÇ log w          w         w

where we denote:
                                       ‚àÇ log Wi                         ‚àÇ log Wi
                               yi ‚â°                  and       Œõi ‚â°
                                       ‚àÇ log yi                          ‚àÇ log Œõ
To compute the derivatives of Œõ in w and pi , we differentiate (22) w.r.t w, which gives:
                                   "          # "               #
                                ‚àÇŒõ X ‚àÇWi            X pi ‚àÇWi
                                                ‚àí                 =0
                                ‚àÇw       ‚àÇŒõ             w2 ‚àÇyi
                                          i                 i
                                              "    "       ##
                                ‚àÇ log Œõ X           X
                             ‚áê‚áí           Wi Œõi ‚àí    Wi yi = 0
                                ‚àÇ log w
                                                  i              i

We obtain:                                         P
                                         ‚àÇ log Œõ      Wi yi   y
                                                 = Pi        =
                                         ‚àÇ log w    i Wi Œõi   Œõ
where y and Œõ denotes the expenditure-weighted averages of yi and Œõi .
   Similarly, differentiating (22) w.r.t price pj , we get:
                                         "           #
                                     ‚àÇŒõ X ‚àÇWi               1 ‚àÇWj
                                                       +          =0
                                    ‚àÇpj         ‚àÇŒõ         w ‚àÇyj
                                              i




                                                      20
                                                "       #
                                       ‚àÇ log Œõ X
                                    ‚áê‚áí            Wi Œõi + Wj yj = 0
                                       ‚àÇ log pj
                                                      i

which gives:
                                                ‚àÇ log Œõ     Wj yj
                                                         =‚àí
                                                ‚àÇ log pj     Œõ
Incorporating the expressions for the derivatives of Œõ, the Slutsky coefficients become:
                                        qi Œõi Wj yj    qi qj Œõi y     qj qi yi     qj qi
                        sij     =    ‚àí                 +               ‚àí             ‚àí
                                          pj      Œõ         w Œõ             w           w
                                        qi qj Œõi yj   qi qj Œõi y     qj qi yi     qj qi
                                =    ‚àí                +               ‚àí             ‚àí
                                            w Œõ            w Œõ            w           w
                                     qi qj
                                =           [‚àíyj Œõi + Œõi y ‚àí yi Œõ ‚àí Œõ ]
                                     wŒõ
Rearranging, one can see that the Slutsky substitution matrix is symmetrical if and only if, for all
i 6= j:
                        yi Œõj ‚àí Œõj y + yj Œõ = yj Œõi ‚àí Œõi y + yi Œõ
Subtracting yj Œõj on both sides, rearranging and factorizing, this can be rewritten:

                                 (yj ‚àí y )(Œõj ‚àí Œõi ) = (yj ‚àí yi )(Œõj ‚àí Œõ )

This holds for any pair of goods i and j. Picking any three goods i, j, k from the consumption basket,
we have:

                                (yj ‚àí y )(Œõj ‚àí Œõi ) = (yj ‚àí yi )(Œõj ‚àí Œõ )
                                (yi ‚àí y )(Œõi ‚àí Œõk ) = (yi ‚àí yk )(Œõi ‚àí Œõ )
                               (yk ‚àí y )(Œõk ‚àí Œõj ) = (yk ‚àí yj )(Œõk ‚àí Œõ )

Adding up, the average terms y and Œõ disappear and we obtain:

                              Œõi yj + Œõk yi + Œõj yk = Œõj yi + Œõi yk + Œõk yj

Subtracting Œõj yj on both sides and factorizing, we obtain:

                                (Œõi ‚àí Œõj )(yj ‚àí yk ) = (Œõj ‚àí Œõk )(yi ‚àí yj )                (23)

Let us denote by Y(Œõ) the set of feasible y (vector of normalized prices for which the aggregator takes
a value Œõ):                              (                             )
                                                    X
                                Y(Œõ) = y ; s.t.         Wi (yi , Œõ) = 1
                                                            i

and denote by Yi (Œõ) its projection onto the i axis, i.e. the set of feasible yi for a given Œõ.


For a given Œõ, to satisfy equation (23) for any triplet of goods, three cases arise naturally:
   - case 1A: yj = yi for all goods, for each y ‚àà Y(Œõ).
   - case 1B: yj = yi for all but one good i0, for all y ‚àà Y(Œõ).
   - case 2: there exists three goods i 6= j 6= k such that yi 6= yj 6= yk for some y ‚àà Y(Œõ).


                                                          21
Case 1A is easier to consider. Recall that, in general, yj is a function of yj and Œõ. The goal is to
show that
                            (Œõ)
    ‚Ä¢ Wi (yi , Œõ) = Ai (Œõ)yi    for all yi ‚àà Yi (Œõ) for some functions Ai (Œõ) and (Œõ).
                 n                    o
                             (Œõ)
    ‚Ä¢ Yi (Œõ) = yi ; Ai (Œõ)yi      <1

Suppose that y ‚àó ‚àà Y(Œõ), i.e. such that          Wi (yi‚àó , Œõ) = 1 and denote (Œõ) = yj (yj , Œõ). Also suppose
                                             P
for now that (Œõ) is strictly positive (the same proof applies to the other case after a simple change
in variable). Define Ai (Œõ) such that Wi (yi‚àó , Œõ) = Ai (Œõ)yi‚àó (Œõ) .
    Denote by (yi , yi ) the maximum interval included in Yi (Œõ) containing yi‚àó and such that, for each
yi ‚àà (yi , yi ), there exists yÃÉ ‚àà Y(Œõ), with yÃÉj ‚àà (yj , yj ) in each of its argument, with yÃÉi = yi , and such
that Wj (yÃÉj , Œõ) = Aj (Œõ)(yÃÉj )(Œõ) .
    By contradiction, suppose that this is not the case: suppose that for a good i = I we have
yI > 0. We need to show that it is then possible to construct a new vector y 0 such that Wj (yj0 , Œõ) =
Aj (Œõ)(yj0 )(Œõ) and j Aj (Œõ)(yj0 )(Œõ) = 1, and such that yI0 < yI .
                        P

    Since we deal with bounded intervals, we can construct a series y (n) that satisfies these four
conditions:
               (n)                (n)
    i) Wj (yj , Œõ) = Aj (Œõ)(yj )(Œõ) ;
        P           (n)
    ii) j Wj (yj , Œõ) = 1;
    iii) each term converge to a finite (possibly zero) value denoted yj‚àû ;
                         (n)
    iv) and such that yI       converges to yI > 0.
By continuity (with the abuse of notation Wi (0, Œõ) = 0 in the limit case), we must have Wj (yj‚àû , Œõ) =
Aj (Œõ)(yj‚àû )(Œõ) and j Wj (yj‚àû , Œõ) = 1. Denote by K0 the set of goods k such that yk‚àû = 0. If K0 is
                    P
empty, pick a good k 6= I. Since yI > 0, we know that such a good k satisfies yk < 1/Ak . Next, since
yI > 0 and yk < 1/Ak for k ‚àà K0 , and since the derivative of WI is non-zero at yI , we can find small
enough but positive ŒΩI > 0 and ŒΩk > 0 (for k ‚àà K0 ) such that:
                                       X                       X
                   WI (yI‚àû ‚àí ŒΩI , Œõ) +    Wk (yk‚àû + ŒΩk , Œõ) +         Wj (yj‚àû , Œõ) = 1
                                         k‚ààK0                     j ‚ààK
                                                                    / 0 ,k6=I

Moreover, given that the derivative of Wi is strictly positive on each interval (yI‚àû ‚àí ŒΩI , yI‚àû ) and
(yk‚àû , yk‚àû + ŒΩk ), we can construct a continuum of other vectors y on such intervals that satisfy the same
condition as above. For all these vectors, the elasticity ŒΩyj must be kept constant so we must have:
Wj (yj‚àû , Œõ) = Aj (Œõ)(yj‚àû )(Œõ) . This contradicts the assumption that yI > 0 and proves that yi = 0 for
all i.
     Conversely, one can show that yi = 1/Ai otherwise one can construct a new vector y 0 such as y ‚àû
with a ith argument strictly above yi if yi < 1/Ai .
     Here we have imposed (Œõ) > 0. The same arguments can be applied to the case with (Œõ) < 0
with the change in variable yi0 = 1/yi .


Case 1B Here we assume that all but one good i0 has a common elasticity (Œõ). Applying the
                                                                            (Œõ)
same arguments as in the previous case, we obtain that Wj (yj , Œõ) = Aj (Œõ)yj    for all yj such that
       (Œõ)
Ai (Œõ)yi    < 1 ‚àí si0 where si0 is the minimum expenditure share of good i0 for which its elasticity
differs from other goods.


                                                      22
   On these intervals, we have:
                                                                         
                                                             Œõi0 ‚àí Œõj
                         Œõj (yj , Œõ) ‚àí Œõk (yk , Œõ) =                        (yj ‚àí yk ) = 0
                                                             yi0 ‚àí yj

which holds for any two goods j, k 6= i0, we obtain that they also share the same elasticity with respect
to Œõ: Œõj (yj , Œõ) = Œõk (yk , Œõ) = œÅ(Œõ). Hence these elasticities do not depend on yi or yk . This implies
that both  and œÅ are constant, and that for any good k 6= i on these intervals we must have:

                                   Wk (yk , Œõ) = Ak ŒõœÅ yk                k 6= i0


Case 2 is more involved. Pick any three goods i, j, k from the consumption basket. From equation (23),
we have:
                            (Œõi ‚àí Œõj )(yj ‚àí yk ) = (Œõj ‚àí Œõk )(yi ‚àí yj )
In this case, there exists at least three goods i 6= j 6= k such that yj 6= yi 6= yk for some y ‚àà Y(Œõ).
For these goods, we obtain:
                                          Œõi ‚àí Œõj            Œõj ‚àí Œõk
                                                         =                                            (24)
                                          yi ‚àí yj            yj ‚àí yk
                                          Œõi ‚àí Œõj            Œõk ‚àí Œõi
                                                         =                                            (25)
                                          yi ‚àí yj            yk ‚àí yi

Notice that the left-hand side of both equations potentially depend on yi and yj but the right-hand
side of equation (24) does not depend on yi and the right-hand side of equation (25) does not depend
on yj . Since there are at least four goods (by assumption) and the expenditure share of these other
goods vary with prices for a given Œõ, we obtain that equations (24) and (25) hold for a neighborhood
of yi , yj and yk (these can vary over that neighborhood while holding Œõ constant).
                          ‚àíŒõj
    Denote by f (Œõ) = Œõi yi ‚àíyj
                                  the left-hand side of equations (24) and (25).
    Picking any good h instead of k, equation (23) also applies and yields:

                         Œõj (yj , Œõ) ‚àí Œõk (yh , Œõ) = f (Œõ) (yj (yj , Œõ) ‚àí yh (yh , Œõ))            (26)

Given that there are at least four goods, this should hold over a non-trivial range of yh (same argument
as above). Taking the derivative w.r.t. yh , we get:

                                            ‚àÇŒõh              ‚àÇyh
                                                    = f (Œõ)                                           (27)
                                           ‚àÇ log yh         ‚àÇ log yh

Given the symmetry of the cross-derivative (we assume that demand is twice differentiable), this can
be rewritten:
                                       ‚àÇyh             ‚àÇyh
                                              = f (Œõ)                                           (28)
                                      ‚àÇ log Œõ         ‚àÇ log yh
By continuity, the conditions required for this equation hold over a neighborhood of Œõ. Take
                                                                                         R reference 
                                                                                           Œõ
Œõ0 and consider the function: M (y, Œõ) = yh (y, Œõ) ‚àí yh (yF (Œõ), Œõ0 ) where F (Œõ) = exp Œõ0 f (t) dtt .
Note that F (Œõ0 ) = 1 hence M (y, Œõ0 ) = 0. For other Œõ, we obtain:

                          ‚àÇM              ‚àÇyh (y, Œõ)   ‚àÇ log F ‚àÇyh (yF (Œõ), Œõ0 )
                                     =                ‚àí
                         ‚àÇ log Œõ           ‚àÇ log Œõ      ‚àÇ log Œõ      ‚àÇ log yh

                                                         23
                                         ‚àÇyh (y, Œõ)         ‚àÇyh (yF (Œõ), Œõ0 )
                                   =                 ‚àí f (Œõ)
                                           ‚àÇ log Œõ                ‚àÇ log yh
                                   =     0

Hence, M (y, Œõ) = 0 over the neighborhood where equation (28) holds. This implies:

                                       yh (yh , Œõ) = yk (yh F (Œõ), Œõ0 )

Now, for a given reference point y ‚àó and Œõ0 , let us construct Di as:
                                                        "Z                           #
                                                               yh
                             Dh (yh ) = Wi (yh‚àó , Œõ0 ) exp          yh (y, Œõ0 )dy
                                                               ‚àó
                                                              yh

Integrating over y from a reference point y ‚àó in the region where this equality holds, we obtain that
demand can be written as:
                                                      "Z                    #
                                                          yh
                                            ‚àó                            dy
                      Wh (yh , Œõ) = Wh (yh , Œõ) exp           yh (y, Œõ)
                                                          ‚àó
                                                         yh               y
                                                      "Z                            #
                                                          yh
                                                                                 dy
                                  = Wh (yh‚àó , Œõ) exp          yh (yF (Œõ), Œõ0 )
                                                          ‚àó
                                                         yh                       y
                                                      "Z                           #
                                                          yh F (Œõ)
                                                                                dy
                                  = Wh (yh‚àó , Œõ) exp               yh (y, Œõ0 )
                                                          ‚àó F (Œõ)
                                                         yh                     y
                                                       Dh (yh F (Œõ))
                                    = Wh (yh‚àó , Œõ) .
                                                       Dh (yh‚àó F (Œõ))

                                    = Hh (Œõ) Dh (yh F (Œõ))

where Hh is a function of Œõ defined as:

                                                      Dh (yh‚àó F (Œõ))
                                          Hh (Œõ) ‚â°
                                                       Wh (yh‚àó , Œõ)
                                                        D (y ‚àó F (Œõ ))
                                                      h h      0        h h D (y ‚àó )
for which, by definition of Dh , we have: Hh (Œõ0 ) = W     ‚àó
                                                       h (yh ,Œõ0 )
                                                                   = Wh (y ‚àó       = 1.
                                                                           h ,Œõ0 )
    Examining elasticities w.r.t. prices and Œõ, we can then show that Hh is in fact identical across
goods. To check this, with Wh (yh , Œõ) = Dh (yh F (Œõ))/Hi (Œõ), we have:

                                                  yh = Dh

where Dh denotes the elasticity of Dh , while the elasticity in Œõ is:

                                          Œõh = f (Œõ) Dh ‚àí Hh

where Hh denotes the elasticity of Hh in Œõ. Thanks for condition (26), we obtain that for any two
goods h and k:
                           Hk ‚àí Hh = Œõh ‚àí Œõk ‚àí f (Œõ) (Dh ‚àí Dk )
                                           = Œõh ‚àí Œõk ‚àí f (Œõ) (yh ‚àí yk )
                                           = 0


                                                      24
    This implies that Hh (Œõ) and Hk (Œõ) remain proportional for any two goods k and h. Given that
Hh (Œõ0 ) = Hk (Œõ0 ) = 1, Hh must be identical across all goods h.
    Hence, demand in case 1 can be written for any good h as:

                                    Wh (yh , Œõ) = Dh (yh F (Œõ)) / H(Œõ)



Combinations of cases: Locally, for a given Œõ and around it, one must be in one of these three
cases. A remaining question is whether demand can be a mixture of these three cases as Œõ varies.
To finish the proof of Proposition 1, we show that we cannot combine case 2 with cases 1A and 1B.
Hence the functional form of case 2 needs to hold globally across all Œõ‚Äôs, while we can potentially have
a combination of 1A and 1B across Œõ.


Combination of cases 2+1A Here we show that we cannot have a combination of cases 1A and 2
globally. First, note that for a given Œõ, case 1 and 2 are mutually exclusive by definition. Hence, if
we have a mixture of cases 1 and 2, it must occurs along different Œõ‚Äôs. By contradiction, suppose that
there exists Œõ‚àó such that, at least locally,

                             Wi (yi , Œõ) = Di (F (Œõ)yi ) / H(Œõ)    if Œõ < Œõ‚àó
                                                    1‚àíœÉ(Œõ)
                               Wi (yi , Œõ) = Ai (Œõ)yi              if Œõ > Œõ‚àó

By continuity, at the limit where Œõ = Œõ‚àó , we must have:

                                     ‚àÇ log Di (F (Œõ‚àó )y)
                                                         = 1 ‚àí œÉ(Œõ‚àó )
                                           ‚àÇ log y

Since it must hold for any i and any y, it implies that F ‚àó (y) = 0 and that 1 ‚àí œÉ(Œõ‚àó ) = 0, which
contradicts our assumption that Wi (yi , Œõ) is not locally constant across yi for any given Œõ.

Combinations of cases 1+2B Here we show that we cannot have a combination of cases 1B and
2 globally, using the same arguments as above. Note again that for a given Œõ, case 1B and 2 are
mutually exclusive by definition. Hence, if we have a mixture of cases 1B and 2, it must occurs along
different Œõ‚Äôs.
    By contradiction, suppose that there exists Œõ‚àó such that, at least locally, such that for all but one
good we have:

                             Wi (yi , Œõ) = Di (F (Œõ)yk )/H(Œõ)      if Œõ < Œõ‚àó
                                 Wi (yi , Œõ) = Œõ‚àíœÅ Ai yi1‚àíœÉ        if Œõ > Œõ‚àó

Again, by continuity, at the limit where Œõ = Œõ‚àó , we must have:

                                        ‚àÇ log Di (F (Œõ‚àó )y)
                                                            =1‚àíœÉ
                                              ‚àÇ log y

Since it must hold for any i and any y, it implies that either demand is CES or F ‚àó (y) = 0 and that
1 ‚àí œÉ(Œõ‚àó ) = 0. This contradicts the assumption that Wi (yi , Œõ) is not locally constant across yi for any
given Œõ.



                                                     25
Proof of Proposition 3
Define U
       e (q, z) as:
                                           X                          Z   z
                              U
                              e (q, z) =       ui (H(z)qi ) ‚àí                 F (z)H 0 (z)dz
                                           i                           z0

where:                                                  Z   qi
                                           ui (qi ) =             Di‚àí1 (x)dx
                                                            q=0

and u0i = Di‚àí1 . Recall that Di is strictly decreasing unless Di = 0. As noted in the text, as an
abuse of notation, we define Di‚àí1 (0) = ai if Di (y) = 0 for all y ‚â• ai (which yields a choke price) and
Di‚àí1 (x) = 0 for all x ‚â• bi if Di (0) = bi .
   In turn, we want to define z as an implicit function of q such that:
                                                    X
                                            F (z) =   qi u0i (H(z)qi )                               (29)
                                                        i

   We proceed in three steps. First we show that equation (29) admits a solution z(q) for each q and
that this solution is unique. Second we show that utility defined as U (q) = U
                                                                             e (q, z(q)) is well-behaved
and quasi-concave. Finally, we show that maximizing U leads to the demand function in the text, and
that the single aggregator Œõ is also well defined.

Step 1: Implicit function z(q). Here we show that for any vector q of consumption, there is a
z such that equation (29) holds.
    With restrictions [A1] iii), we have assumed that for each good i and each yi , there is a Œõ such
that Di (F (Œõ)yi )/H(Œõ) is arbitrarily small. Take yi = 1/(N qi ) where N denotes the number of goods.
For each i, there is a z such that:

                                       Di (F (z)/(N qi ))/H(z) < qi

Since the left-hand side decreases with z (this is implied by restriction [A1]-ii), we can take the
maximum z of all zi ‚Äôs such that it holds for all goods i with a common z. This inequality is equivalent
to:

                                     Di (F (z)/(N qi )) < H(z)qi
                                 ‚áî         F (z)/(N qi )) > u0i (H(z)qi )
                                 ‚áî              F (z)/N            > qi u0i (H(z)qi )

Going from the first to second inequality above is guaranteed by the assumption that Di decreases
strictly. Adding across all goods (given that qi u0i is positive for all goods), we obtain that for each
vector q there exists a z such that:
                                               X
                                       F (z) >      qi u0i (H(z)qi )
                                                        i

Next, with restrictions [A1] iii), we have also assumed that there is at least one good i such that, for
each yi , there is a Œõ such that yi Di (F (Œõ)yi )/H(Œõ) is larger than 1. Taking yi = 1/qi , there is a z = Œõ




                                                            26
such that:

                                   (1/qi )Di (F (z)/qi )/H(z) > 1
                                          ‚áî Di (F (z)/qi ) > H(z)qi
                                          ‚áî F (z)/(N qi )) < u0i (H(z)qi )
                                         ‚áî                   F (z) < qi u0i (H(z)qi )

Hence, summing across goods, we also have:
                                                     X
                                           F (z) <            qi u0i (H(z)qi )
                                                         i

                                                                                   0
                                                                          P
We havePshown that for each q there is a z such that F (z) >                 i qi ui (H(z)qi ) and a z such that
              0
F (z) < i qi ui (H(z)qi ). By continuity, we conclude that equation (29) has a solution.
    Then, using part ii) of restrictions [A1], we can see that Di (F (Œõ)yi )/H(Œõ) strictly decreases
with Œõ. This implies
                   P that       qi u0i (H(z)qi ) also strictly decreases with z, and that the right-hand side
of equation (29),           0
                      i qi ui (H(z)qi ), decreases faster (or increases slower) than the left-hand side of
equation (29), F (z). Hence the solution to equation (29) is unique.

Step 2: Quasi-concavity. The second step is to show that utility defined as U (q) = Ue (q, z(q))
is quasi-concave. First, we need to get the first and second derivatives.

Derivatives in z. Here we consider the properties of z = z(q), the solution of equation (29).
Taking the derivative of equation (29), we get:
                                    "                  #
                                ‚àÇz     0     0
                                               X
                                     F ‚àíH         2 00
                                                 qi ui = u0i + Hqi u00i
                                ‚àÇqi
                                                     i

and thus:
                                              ‚àÇz   u0 + Hqi u00i
                                                  = i
                                              ‚àÇqi      ‚àÜ
with ‚àÜ ‚â° F 0 ‚àí H 0        2 00
                     P
                       i qi ui .

                                                       u0i
Showing that ‚àÜ is positive. Note that                 00
                                                     ui Hqi
                                                                   = ŒµDi and thus:
                                                     X
                                   ‚àÜ = F 0 ‚àí H0               qi2 u00i
                                                      i
                                                         Hqi2 u00i
                                                     P            
                                                       i
                                       = (F/z) ŒµF ‚àí ŒµH P
                                                           qi u0
                                                     P i 0 i          
                                                         qi u (1/ŒµDi )
                                       = (F/z) ŒµF ‚àí ŒµH i P i 0
                                                             i qi ui

We can see that, if ŒµDi < 0 and ŒµF ŒµDi < ŒµH for all i, then ŒµF ‚àí ŒµH (1/ŒµDi ) > 0 for all i and we always
have ‚àÜ > 0.
    This implies that the derivatives of z are always well defined, and knowing ‚àÜ > 0 will be useful
below.



                                                             27
Derivatives in U. First derivatives:
                                                            "                                           #
                 ‚àÇU                        ‚àÇz                        X
                          = H u0i (Hqi ) +                      H0              qi u0i (Hqi ) ‚àí H 0 F       = H u0i (Hqi )
                 ‚àÇqi                       ‚àÇqi
                                                                       i

Second derivatives:
                                    ‚àÇ2U                   ‚àÇz
                                                  =          (u0 + Hqi u00i )H 0 + H 2 u00i
                                    ‚àÇqi2                  ‚àÇqi i
                                   ‚àÇ2U                    ‚àÇz
                                                  =          (u0 + Hqi u00i )H 0
                                  ‚àÇqi ‚àÇqj                 ‚àÇqj i

and thus, incorporating the derivatives in z:

                                  ‚àÇ2U
                                              = (u0i + Hqi u00i )2 H 0 /‚àÜ + H 2 u00i
                                  ‚àÇqi2
                                 ‚àÇ2U
                                              = (u0i + Hqi u00i ) (u0j + Hqj u00j ) H 0 /‚àÜ
                                ‚àÇqi ‚àÇqj

Negative semi-definiteness. To show that utility is quasi-convex, we need to show that the
bordered Hessian is negative semi-definite, i.e we need to show:
                                                                                  !2
                X             ‚àÇ2U             X                                                     X
                       ti tj         =                ti (u0i   +   Hqi u00i )         H 0 /‚àÜ +             t2i H 2 u00i < 0
                             ‚àÇqi ‚àÇqj
                 i,j                          i                                                         i

for any ti such that:
                                              X ‚àÇU      X
                                               ti     =   ti Hu0i = 0
                                                  ‚àÇqi
                                                  i                         i

The objective function above is homogeneous of degree 2. We can renormalize the sum i ti (u0i +
                                                                                             P
Hqi u00i ) up to any constant without loss of generalization.
   First step is to find the optimal vector of ti ‚Äôs that maximizes the left-hand side of the inequality
above. It is equivalent to consider the maximization:
                                                 (               )
                                                    X
                                             max        t2i u00i
                                                                        i

under the constraint: i ti (u0i + Hqi u00i ) = constant and i ti u0i = 0.
                          P                                  P
   This leads to ti proportional to:
                                                     u0i
                                              ti ‚àº        + ¬µqi
                                                    Hu00i
(and second-order condition is fine, objective function is concave since u00i < 0 for all i). Given that
                            P u02
we must have 0 = i ti u0i = i Hui 00 + ¬µ i qi u0i , ¬µ must be:
                  P                      P
                                          i


                                                                     u02
                                                                      P i
                                                                  i Hu00  i
                                                      ¬µ =       ‚àíP         0
                                                                  i q i u  i




                                                                       28
                                                                                               ui    0
                                                                                         0
                                                                                   P
                                                                                   i qi ui qi Hu00i
                                                                     =           ‚àí P           0
                                                                                         q i u
                                                                                  P i0 i
                                                                                   i qi ui ŒµDi
                                                                     =           ‚àí P         0
                                                                                      i qi ui
                                                                     = ‚àíŒµÃÑD
                   u0i
where ŒµDi =     qi Hu00
                            and ŒµÃÑD is its weighted average.
                       i

                                                       u0i
   Next, using the optimal ti =                       Hu00
                                                               ‚àí ŒµÃÑD qi = qi ŒµDi ‚àí qi ŒµÃÑD , a sufficient and necessary condition for
                                                           i
negative semi-definiteness is:
                                                                          !2
                  X                                                                                      X
                           (qi ŒµDi ‚àí qi ŒµÃÑD )(u0i + qi Hu00i )                     H 0 /‚àÜ + H 2                      (qi ŒµDi ‚àí qi ŒµÃÑD )2 u00i < 0
                    i                                                                                        i

Since ‚àÜ > 0, this condition can be rewritten:
                                                                    !2
            X                                                                                            X
                (qi ŒµDi ‚àí qi ŒµÃÑD )(u0i + qi Hu00i )                      H0 < ‚àí H2 ‚àÜ                         (qi ŒµDi ‚àí qi ŒµÃÑD )2 u00i
            i                                                                                            i
                                                                    !2
                     X                              X                                                    X
            ‚áî                qi u0i ‚àí ŒµÃÑD H              qi2 u00i        H0 < ‚àí H2 ‚àÜ                         (qi ŒµDi ‚àí qi ŒµÃÑD )2 u00i
                        i                            i                                                   i
                                                                    !2                                                                                              !
                     X                              X                                                                X                              X
            ‚áî                qi u0i ‚àí ŒµÃÑD H              qi2 u00i        H0 < ‚àí H ‚àÜ                      ‚àíŒµÃÑD              qi u0i + ŒµÃÑ2D H               qi2 u00i
                        i                            i                                                                 i                             i
                                                                    !2                                                                                         !
                     X                              X                                                        X                             X
            ‚áî                qi u0i   ‚àí ŒµÃÑD H            qi2 u00i        H   0
                                                                                   <          ŒµÃÑD H ‚àÜ                 qi u0i   ‚àí ŒµÃÑD H              qi2 u00i
                        i                            i                                                           i                            i


                       0                          2 00
            P                              P             
Note that        i qi ui    ‚àí ŒµÃÑD H            i qi ui
                                          is negative (unless all price elasticities ŒµDi are identical):
                                                                        0         qi u0i (‚àíŒµDi )
                                                              P                P
                                                                  i qi ui
                        X               X
                              0             2 00                                iP
                          qi ui ‚àí ŒµÃÑD H   qi ui < 0 ‚áê‚áí P            0    1   <             0
                        i               i                    i qi ui (‚àíŒµDi )         i qi ui

(In the second inequality, the left hand side corresponds to a harmonic average while the right-hand-
side corresponds P               P average of a positive variable ‚àíŒµDi >
                  to an arithmetic                                         P0).
    Hence, using i qi u0i ‚àí ŒµÃÑD H i qi2 u00i < 0 and also that ‚àÜ ‚â° F 0 ‚àíH 0 i qi2 u00i the previous inequality
is equivalent to:
                                                             !
                               X                 X
                   ‚áî H0           qi u0i ‚àí ŒµÃÑD H     qi2 u00i > ŒµÃÑD H ‚àÜ
                                                i                            i
                                                                                              !                                                     !
                                           X                             X                                                           X
                                       0
                            ‚áî     H                 qi u0i   ‚àí ŒµÃÑD H               qi2 u00i       > ŒµÃÑD H              0
                                                                                                                     F ‚àíH        0
                                                                                                                                         qi2 u00i
                                                i                            i                                                       i
                                           X
                                       0
                            ‚áî     H             qi u0i   > ŒµÃÑD H F           0

                                           i




                                                                                     29
                               0
                   P
Given that F =           i qi ui ,   this gives:

                                                         ‚áî       H 0 F > ŒµÃÑD H F 0
                                                         ‚áî       ŒµÃÑD ŒµF < ŒµH

This holds, given that ŒµDi ŒµF < ŒµH is assumed in part ii) of restrictions [A1] for each good i.

Step 3: Marshallian
        P           demand and price aggregator. Maximizing U (q) under the budget
constraint    i p i qi   = w leads to:

                                                 ‚àÇU
                                                     = H(z) u0i (H(z)qi ) = ¬µpi
                                                 ‚àÇqi
where ¬µ henceforth denotes the Lagrange multiplier associated with the budget constraint. Summing
across goods, we can see that ¬µ is such that:

                                         1X          1X                   H(z)F (z)
                                ¬µ =         ¬µpi qi =    H qi u0i (Hqi ) =
                                         w           w                       w
                                             i

(note that it only depends on quantities and prices through z). Using H(z) u0i (H(z)qi ) = ¬µpi , we
obtain:
                                                  ¬µpi    F (z)pi
                                  u0i (H(z)qi ) =      =
                                                  H(z)      w
and thus, given the definition of u0i :

                                          H(z)qi = Di (¬µpi /H(z)) = Di (F (z)pi /w)

and:
                                                       qi = Di (F (z)pi /w)/H(z)
The final step is to show that z can be written as z = Œõ where Œõ is implicitly defined as a function of
all normalized prices pi /w.
    To see this, notice that qi must satisfy the budget constraint:
                                    X            X
                                w=      qi p i =   pi Di (F (z)pi /w)/H(z)
                                                   i             i

which can be rewritten:                                    X
                                                 H(z) =          (pi /w)Di (F (z)pi /w)
                                                             i

This equation in z has a unique solution, which we denote Œõ and is a function of all pi /w:
    - To prove uniqueness, we use restriction [A1] part ii) which implies that Di (F (z)pi /w)/H(z) is
      strictly decreasing in z. Hence the right-hand side of the equation above decreases strictly faster
      with z (or increases strictly slower) than the left-hand side.
    - To prove existence (for a given set of prices and income), we use restriction [A1] part iii) which
      assumes that Di (F (z)pi /w)/H(z) can be arbitrarily small and that there is at least one good
      for which Di (F (z)pi /w)/H(z) is larger for unityP for some z. By continuity, there must be at
      least one solution Œõ = z to the equation H(z) = i (pi /w)Di (F (z)pi /w).


                                                                     30
Alternative proof of Proposition 3 using the Slutsky Matrix
An alternative proof of proposition 3 is to show that the Slutsky matrix is symmetric and negative
semi-definite, and then apply Hurwicz and Uzawa (1971) theorem. We have already proved symmetry
in Proposition 1 but semi-definitiveness is yet to be checked. Consider the demand system:

                                     qi = Di (F (Œõ)pi /w) / H(Œõ)                               (30)
                                                             P
where Œõ is implicitly determined by the budget constraint i pi Di (Œõpi /w) / H(Œõ) = w, which can be
rewritten:                      X
                                    (pi /w)Di (F (Œõ)pi /w) / H(Œõ) = 1                          (31)
                                          i


Slutsky substitution coefficients. For i 6= j, the Slutsky term is:
                                                   ‚àÇqi      ‚àÇqi
                                    sij       =        + qj
                                                   ‚àÇpj      ‚àÇw
                                                                    
                                                   ‚àÇqi ‚àÇŒõ         ‚àÇŒõ           ŒµDi
                                              =              + qj      ‚àí qi qj
                                                   ‚àÇŒõ ‚àÇpj         ‚àÇw            w
                P                                 ‚àÇ log Di
where ŒµÃÑD =     i (pi qi /w)ŒµDi   and ŒµDi =        ‚àÇ log x .   The first term is:

                                                   ‚àÇqi   qi (ŒµF ŒµDi ‚àí ŒµH )
                                                       =
                                                   ‚àÇŒõ            Œõ
Then, we get the derivative of Œõ w.r.t. pj and w. From:
                                X
                                    (pi /w)Di (F (Œõ)pi /w) / H(Œõ) = 1                               (32)
                                          i

we get:
                                          ‚àÇ log Œõ                  1 + ŒµDj
                                                   = ‚àí(pj qj /w)
                                          ‚àÇ log pj               ŒµF ŒµÃÑD ‚àí ŒµH
                                                  ‚àÇ log Œõ     1 + ŒµÃÑD
                                                          =
                                                  ‚àÇ log w   ŒµF ŒµÃÑD ‚àí ŒµH
Hence we obtain:
                                                                                   
                    qi (ŒµF ŒµDi ‚àí ŒµH )               1 + ŒµDj               1 + ŒµÃÑD             ŒµDi
          sij   =                     . Œõ ‚àí(qj /w)            + (qj /w)               ‚àí qi qj
                            Œõ                      ŒµF ŒµÃÑ ‚àí ŒµH           ŒµF ŒµÃÑD ‚àí ŒµH            w
                    qi qj (ŒµF ŒµDi ‚àí ŒµH )(ŒµÃÑ ‚àí ŒµDj )           ŒµDi
                =          .                          ‚àí qi qj
                     w            ŒµF ŒµÃÑD ‚àí ŒµH                  w
                        qi qj ŒµF (ŒµDi ‚àí ŒµÃÑD )(ŒµDj ‚àí ŒµÃÑD )         ŒµDj + ŒµDi ‚àí ŒµÃÑ
                =   ‚àí        .                            ‚àí qi qj
                         w            ŒµF ŒµÃÑD ‚àí ŒµH                      w


which is symmetric in i and j.                                                      P
   When ŒµF 6= 0, denote Œ∏i = ŒµH ‚àí ŒµF ŒµDi , which is positive by assumption, and Œ∏ÃÑ = i (pi qi /w)Œ∏i its




                                                                 31
weighted average across goods. It is more convenient to write the Slutsky substitution coefficient as:

                                      qi qj (Œ∏i ‚àí Œ∏ÃÑ)(Œ∏j ‚àí Œ∏ÃÑ)       qi qj                    
                         sij    =          .                       +         Œ∏j + Œ∏i ‚àí Œ∏ÃÑ ‚àí ŒµH
                                       w            ŒµF Œ∏ÃÑ            ŒµF w
                                      qi qj Œ∏ i Œ∏ j     q i q j ŒµH
                                =          .        ‚àí
                                       w     ŒµF Œ∏ÃÑ        w ŒµF
In turn, the diagonal coefficients of the Slutsky matrix are:

                                             qi ŒµDi         q2 Œ∏2        qi2 ŒµH
                                    sii =              ‚àí i . i ‚àí
                                               pi           w ŒµF Œ∏ÃÑ      w ŒµF
                                                qi (Œ∏i ‚àí ŒµH )     q2     Œ∏i2    q 2 ŒµH
                                        =    ‚àí                 ‚àí i .          ‚àí i
                                                     p i ŒµF       w     ŒµF Œ∏ÃÑ   w ŒµF

Is the Slutsky matrix negative semi-definite? Denote wi = pi qi /w expenditure shares, we
obtain:
                                                wi wj Œ∏ i Œ∏ j         ŒµH
                         sij . pi pj /w =        P            ‚àí wi wj
                                              ŒµF k w k Œ∏ k            ŒµF
                                                wi (Œ∏i ‚àí ŒµH )        w2 Œ∏2          ŒµH
                               sii . p2i /w = ‚àí                +    Pi i      ‚àí wi2
                                                     ŒµF          ŒµF k w k Œ∏ k       ŒµF

    In order to show that the Slutsky matrix is negative semi-definite, we need to show that for any
vector x we have:                         X
                                              sij xi xj ‚â§ 0
                                                        ij
                           ‚àö
Normalizing the x‚Äôs by pi / w, this is equivalent to showing the following inequality:
               X  Œ∏ i ‚àí ŒµH             X wi x i wj x j Œ∏ i Œ∏ j   X                
                                                                                    ŒµH
                                   2
             ‚àí     wi             xi +          P                ‚àí   wi wj x i x j     ‚â§ 0
                           ŒµF                     i wi Œ∏ i                          ŒµF
                    i                             i,j                        i,j
                      "P                                                #           "                            #
                  P                       2
                                                  P                   2
              w i Œ∏ i           w i Œ∏ i x       (        w  i Œ∏ i xi )         Œµ H
                                                                                       X           X         2
      ‚áê‚áí ‚àí i                  i           i
                                            ‚àí Pi                           +              wi x2i ‚àí     wi x i       ‚â§ 0
                                                  ( i wi Œ∏i )2
                            P
             ŒµF                 i wi Œ∏ i                                       ŒµF
                                                                                        i            i
             "P                                             #                          "                           #
                              2
                                          P               2
           1        w i Œ∏ i x           (    w i Œ∏ i x i )                 Œµ H
                                                                                         X          X         2
     ‚áê‚áí ‚àí      P  i           i
                                  ‚àí Pi                  2         +        P               wi x2i ‚àí     wi x i       ‚â§ 0
          ŒµF        i w i Œ∏ i             (  i w i Œ∏ i )               Œµ F   i w i Œ∏ i i              i

The terms in brackets can be interpreted as variances and are positive. We need to distinguish three
cases depending on the sign of ŒµH and ŒµF :

   ‚Ä¢ First, if ŒµF > 0 and ŒµH ‚â§ 0 (and Œ∏i > 0), each term of the sum is negative, the sum is negative
     and the Slutsky matrix is semi-definite negative.

   ‚Ä¢ If ŒµF > 0 and ŒµH > 0, note that Œ∏i = ŒµH ‚àí ŒµF ŒµDi is then larger than ŒµH given that ŒµDi is
     assumed to be negative. With ŒµF > 0, the inequality above is then equivalent to:
                 "P                                    #             "                       #
                                2
                                    P                2
                     i w i Œ∏ i xi  (   w i Œ∏ i x i )         Œµ H
                                                                      X
                                                                             2
                                                                                 X       2
           ‚áê‚áí                     ‚àí Pi                   ‚àí P            wi x i ‚àí    wi xi      ‚â• 0
                                     ( i wi Œ∏ i ) 2
                    P
                       i wi Œ∏ i                             i wi Œ∏ i               i              i



                                                             32
      The proof then relies on Lemma 5, an auxiliary result from Matsuyama and Uchshev (2017).
      In this case, denote ai = PŒ∏iwwji Œ∏j , bi = wi and Œ≥ = P ŒµH     . Since Œ∏i > ŒµH for each i, we have
                                  j                           i wi Œ∏i
      ai > Œ≥bi for each i. We obtain the result that we want by applying Lemma 5, which implies the
      inequality above.

   ‚Ä¢ Finally, if ŒµF < 0, note that ŒµH > Œ∏i and ŒµH > 0 given that ŒµDi is negative by assumption, and
     given that Œ∏i = ŒµH ‚àí ŒµF ŒµDi is positive by assumption. With ŒµF < 0, the inequality above is
     then equivalent to:
                    "                           #              "P                                  #
                                                    P                        2
                                                                                 P               2
                      X           X         2        w i Œ∏ i     w i Œ∏ i x    (   w i Œ∏ i x i )
            ‚áê‚áí           wi x2i ‚àí     wi x i      ‚àí  i           i           i
                                                                               ‚àí Pi                  ‚â• 0
                                                                                  ( i wi Œ∏i )2
                                                                P
                                                      ŒµH           i w i Œ∏ i
                         i                       i
                                                                                                                             P
                                                                                                                                 wŒ∏
      The proof again relies on Lemma 5. In this case, denote ai = wi , bi = PŒ∏iwwji Œ∏j , and Œ≥ = iŒµHi i .
                                                                               j
      Since Œ∏i < ŒµH for each i, we obtain again that ai > Œ≥bi for these new ai and bi . Lemma 5 then
      implies the inequality above.

This finishes the proof that the Slutsky matrix is negative semi-definite when ŒµF 6= 0.

   What happens when ŒµF = 0? When ŒµF = 0, then ŒµH > 0 by assumption, and we have instead:
          ‚àÇqi    q i ŒµH                       ‚àÇ log Œõ               1 + ŒµDj                             ‚àÇ log Œõ     1 + ŒµÃÑ
              =‚àí                    ;                  = (pj qj /w)                            ;                = ‚àí
          ‚àÇŒõ        Œõ                         ‚àÇ log pj                ŒµH                                ‚àÇ log w      ŒµH

Hence we obtain:
                                                                           
                               q i ŒµH              1 + ŒµDj           1 + ŒµÃÑ           ŒµDi
                   sij   =            . Œõ ‚àí(qj /w)         + (qj /w)          ‚àí qi qj
                                  Œõ                  ŒµH               ŒµH               w

and thus the Slutsky substitution coefficients are:
                                                                              ŒµDj + ŒµDi ‚àí ŒµÃÑ
                                                sij      =         ‚àí qi qj
                                                                                    w
                                                                   qi ŒµDi        2 2ŒµDi ‚àí ŒµÃÑ
                                                sii =                        ‚àí qi
                                                                     pi               w
Is the Slutsky matrix negative semi-definite in the special case where ŒµF = 0? As before, we need:
                         X                X
                             wi x2i ŒµDi ‚àí     wi wj xi xj (ŒµDj + ŒµDi ‚àí ŒµÃÑ) ‚â§ 0
                                i                            i,j

where wi denotes the consumption share in good i.
   This statement is successively equivalent to:

                                                        wi xi )2 ‚â§ 0
           X                 X                        X
      ‚áê‚áí      wi x2i ŒµDi ‚àí 2    wi wj xi xj ŒµDj + ŒµÃÑ(
             i                          i,j                                  i

                                                                                                        wi x i ) 2 ‚â§ 0
           X                            X                X                        X                 X
      ‚áê‚áí         wi x2i ŒµDi   ‚àí 2(            wi xi )(         wi xi ŒµDj ) + (          wi ŒµDj )(
             i                            i              i                         i                i
            wi x2i ŒµDi
        P                  P          P
                         2( i wi xi )( i wi xi ŒµDj )
                                                          wi xi )2 ‚â• 0
                                                        X
          i
      ‚áê‚áí P             ‚àí       P                     +(
             w  Œµ
            i i Dj                   w Œµ
                                   i i Dj                                           i



                                                                        33
                                            
            P          2+(
                             P             2
             w  Œµ
            i i Di   x i          w
                                j j jx   )           P           P
                                                   2( i wi xi )( i wi xi ŒµDj )
       ‚áê‚áí          P                            ‚â•         P
                       i wi ŒµDj                              i wi ŒµDj
          P                 P              2
           i wi ŒµDi xi ‚àí (      j wj x j )
                                                   P             P
                                                  2 i wi ŒµDi xi ( j wj xj )
                                                                                  P          P
                                                                                2( i wi xi )( i wi xi ŒµDj )
       ‚áê‚áí          P                           +        P                     ‚â•       P
                       i wi ŒµDj                            i wi ŒµDj                       i wi ŒµDj
          P                 P              2
           i wi ŒµDi xi ‚àí (      j wj x j )
       ‚áê‚áí          P                           ‚â• 0
                       i wi ŒµDj

which is satisfied if all the ŒµDj are negative.



Lemma 5 (Matsuyama   P Ushchev,     2017) Suppose that ai > Œ≥bi > 0 for all i ‚àà {1, ..., N } where Œ≥ is a
positive scalar and i ai = i bi = 1. Define A = diag{a1 , ..., an } ‚àí aaT and B = diag{b1 , ..., bn } ‚àí
                             P
bbT , two (positive semi-definite) matrices. We obtain that the matrix M:

                                                 M = A ‚àí Œ≥B

is positive semi-definite.

Proof of Lemma 5: This lemma is from Matsuyama and Ushchev (2017) which I report here again
for convenience (see last part of the proof of Proposition 1 of Matsuyama and Ushchev 2017).

   One needs to show that, for each vector t of the               RN + with components ti ‚â• 0,   i ‚àà {1, ..., N }:

                                           tT A t ‚àí Œ≥ . tT B t ‚â• 0

Denote
P       a and Tb the random variables such that: P rob{Ta = ti } = ai and P rob{Tb = ti } = bi . Since
       TP
   a
  i i =   i bi = 1, one can write each term above as a variance:
                                                                              !2
                                           X                  X
                               T
                              t At =            ai t2i   ‚àí            ai ti        = V ar(Ta )
                                            i                     i
                                                                              !2
                                           X                  X
                              tT B t =          bi t2i ‚àí              bi ti        = V ar(Tb )
                                            i                     i

Note that V ar(Tb ) > 0 unless ti = tj for all i, j, in which case we also have V ar(Ta ) = 0 and thus
tT A t ‚àí Œ≥ . tT B t = 0. Since V ar(Tb ) is homogeneous of degree two and strictly positive aside from the
case above, we can focus on t‚Äôs such that tT B t = 1. Under this assumption, we need to show that:

                                                    tT A t ‚â• Œ≥

Consider the maximization:
                                     max tT A t            s.t.          tT B t = 1
                                       t

The maximum is attained when At‚àói = Œõ‚àó Bt‚àó where Œõ‚àó is the minimum value of the objective function,
which can also be written:                                    
                                   ‚àó      ‚àó       ‚àó    ‚àó       ‚àó
                              ai ti ‚àí E[Ta ] = Œõ bi ti ‚àí E[Tb ]                                (33)


                                                             34
where E[Tx ] refers to the expectation of Tx .
   The goal is to show that Œõ‚àó > Œ≥. To prove this claim by contradiction, suppose that Œõ‚àó < Œ≥.
Given that ai > Œ≥bi , we also have ai > Œõ‚àó bi .
   If E[Ta ] ‚â§ E[Tb ], we can see that:

                                 max ti ‚àí E[Ta ] ‚â• max ti ‚àí E[Tb ] > 0

hence equation (33) cannot hold for i = arg max tj .
   If E[Ta ] > E[Tb ], we can see that:

                                 min ti ‚àí E[Ta ] < min ti ‚àí E[Tb ] < 0

hence, again, equation (33) cannot hold for i = arg min tj . This yields a contradiction and concludes
the proof of Lemma 5.




                                                  35
Proof of Proposition 4
Suppose that demand can be written:

                                          qi = Gi (Œõ)1‚àíœÉ(Œõ) (pi /w)‚àíœÉ(Œõ)

with Œõ implicitly defined by i [Gi (Œõ)pi /w]1‚àíœÉ(Œõ) = 1.
                            P
   The goal is to to show that these equations:
                                 "                                      #     1
                                     X                                      1‚àíœÉ(Œõ)

                                      (Gi (Œõ) pi /w)1‚àíœÉ(Œõ)                            = 1            (34)
                                      i
                                     "                                  #    œÉ(U )
                                                                            1‚àíœÉ(U )
                                          X                   1‚àíœÉ(U )
                                              (Gi (U )/qi )    œÉ(U )                  = 1            (35)
                                          i

have a unique solution in Œõ and U respectively. To do so, we show that the left-hand side of each of
these equations strictly increase in Œõ and U around the solution, showing that the left-hand side can
be equal to unity only once.
    We distinguish two cases, depending on whether elasticity œÉ(Œõ) increases with Œõ. If the first case
we assume that Gi (Œõ) strictly increases with Œõ. In the second case, we impose condition ii).

1) In the first case, suppose that œÉ(Œõ) increases with Œõ and that Gi (Œõ) strictly increases with Œõ.
The equation above in Œõ is equivalent to:
                                    X
                                        (Gi (Œõ) pi /w)1‚àíœÉ(Œõ) = 1
                                              i

If œÉ(Œõ) ‚àà (0, 1), each term Gi (Œõ) pi /w in the summation increases in Œõ and has to be smaller than
unity. Hence, if 1 ‚àí œÉ(Œõ) decreases with Œõ, the left-hand side of this expression is strictly increasing
                                                                                                  1
with Œõ. The same holds if we raise the whole expression on the left-hand side to the power 1‚àíœÉ(Œõ)     .
     If œÉ(Œõ) > 1, each term Gi (Œõ) pi /w in the summation increases in Œõ and has to be larger than unity.
Hence, if 1 ‚àí œÉ(Œõ) decreases with Œõ (i.e. becomes more positive), the left-hand side of this expression
is strictly decreasing in Œõ. The inverse holds if we raise the whole expression on the left-hand side to
               1
the power 1‚àíœÉ(Œõ)    < 0.
     Now consider the equation:
                                         X               1‚àíœÉ(U )
                                                            œÉ(U )
                                              Gi (U )/qi           =1
                                              i
                                     1‚àíœÉ(U )
    If œÉ(Œõ) ‚àà (0, 1), the exponent    œÉ(U ) is positive and decreases with U . The term within parenthesis
increases in U . Moreover, each summation term has to be smaller than unity. Hence, as U increases,
each summation term increases (strictly) with U . The same holds if we raise the whole expression on
                                   œÉ(U )
the left-hand side to the power 1‚àíœÉ(U    ).
    If œÉ(Œõ) > 1, the exponent 1‚àíœÉ(U     )
                                   œÉ(U ) is negative and decreases with U . The term within parenthesis
increases in U . Moreover, each summation term has to be larger than unity. Hence, as U increases,
each summation term decreases (strictly) with U . If we raise the whole expression on the left-hand
                    œÉ(U )
side to the power 1‚àíœÉ(U   ) , we obtain a strictly increasing function of U .




                                                              36
2) In the second case, we assume that œÉ(Œõ) decreases with Œõ and that, around each solution Œõ0 of
                                                                                ‚àí 1
equation (34), there exists a set of Œ±i such that i Œ±i = 1 and such that Gi (Œõ)Œ±i 1‚àíœÉ(Œõ) increases in
                                                 P
Œõ.                              1
                             ‚àí 1‚àíœÉ(Œõ)
   Define Ki (Œõ) = Gi (Œõ)Œ±i              The left-hand side of equation (34) can then be rewritten:
                                      "                                          #     1
                                       X                                             1‚àíœÉ(Œõ)

                                                 Œ±i (Ki (Œõ) pi /w)1‚àíœÉ(Œõ)
                                            i

To show that it strictly increases in Œõ, we use Lemma 6 discussed in the next appendix section. We
obtain that the left-hand side of the above equation decreases with œÉ, which itself decreases with Œõ.
Moreover, the term Ki (Œõ) strictly increases in Œõ, by assumption, hence the whole left term strictly
increases with Œõ.
    We can again use the same approach to show that the left-hand side of (35) increases strictly with
U . This is equivalent to showing that the following expression strictly increases in U :
                                        "                                        #    œÉ(U )
                                            X                        1‚àíœÉ(U )       1‚àíœÉ(U )
                                                                        œÉ(U )
                                                  Œ±i Ki (U )/qi
                                             i


Each exponent 1‚àíœÉ(U   )
                 œÉ(U ) increases in U and each term Ki (U ) strictly increases with U . With Lemma 6
again, we obtain that the whole term strictly increases with U .


   Hence, in both cases, Œõ and U are well defined by equations (34) and (35) which admit no more
than one solution. This implicitly defines utility U as a function of qi . It is straightforward to see that
such utility function is quasi-concave in q: indifference curves have the same shape as CES indifference
curves, holding œÉ = œÉ(U ) constant.
   Consumption quantities q chosen to maximize U would satisfy the following first-order conditions:
                                                             œÉ(U )‚àí1
                                        (œÉ(U ) ‚àí 1)  qi  œÉ(U )
                                                                     = ¬µpi
                                          qi œÉ(U )   Gi (U )

where ¬µ is a constant term (combination of the Lagrange multiplier associated with the equation in U
and the budget constraint multiplier). To satisfy the budget constraint, (œÉ(U    )‚àí1)¬µ
                                                                               œÉ(U )   has to equal 1/w.
                        œÉ(U )‚àí1

In other words, Giq(U
                    i      œÉ(U )
                      )           corresponds to the budget share of good i in consumption baskets:

                                                 œÉ(U )‚àí1
                                     qi         œÉ(U )        (œÉ(U ) ‚àí 1)¬µ         p i qi
                                                           =                pi qi =
                                    Gi (U )                       œÉ(U )              w

This leads to the demand qi :
                                            qi = Gi (U )1‚àíœÉ(U ) (pi /w)‚àíœÉ(U )
which is the same expression as above, with Œõ corresponding to utility. Moreover, we can see that
                      P  i  œÉ(U  )‚àí1

utility U is such that i Giq(U
                                 œÉ(U )
                               )        = 1 which, using the demand for qi just above, can be written
as:                                    X
                                         [Gi (U )pi /w]1‚àíœÉ(U ) = 1
                                                 i


                                                                37
which is the same equation as the one determining Œõ, which proves that Œõ = U .




Proof of equivalence between condition ii) and inequality (13)
We mention in the text that condition ii) of Proposition 4 is equivalent to inequality (13) when both
œÉ and Gi are differentiable.
                                                   1
                                               ‚àí
   Taking the derivative of the log of Gi (Œõ)Œ±i 1‚àíœÉ(Œõ) with respect to Œõ, we find that it is positive if
and only if:
                              G0i (Œõ)
                                                                
                                                     ‚àÇ      1
                                      ‚àí (log Œ±i ) .                >0
                              Gi (Œõ)                ‚àÇŒõ 1 ‚àí œÉ(Œõ)
Hence, for each good i, the minimum Œ±i such that it is positive is:

                                              (œÉ(Œõ) ‚àí 1)2 G0i (Œõ)
                                                                   
                                    ‚àó
                                  Œ±i = exp
                                                   œÉ 0 (Œõ)Gi (Œõ)

One can see that inequality i Œ±i‚àó < 1 corresponds to inequality (13) in the text.
                            P
   Note: one can also verify that this condition is equivalent to imposing that Gi (Œõ) and œÉ(Œõ) are
such that:                        "                            # 1
                                    X                           1‚àíœÉ(Œõ)
                                                        1‚àíœÉ(Œõ)
                                       (Gi (Œõ) pi /w)
                                       i

increases for any set of pi /w.




                                                   38
                                                                                            P
Lemma 6 For any given set of xi ‚â• 0 and Œ±i ‚â• 0 such that                                          i Œ±i   = 1, the following expression is
monotonically increasing in œÅ ‚àà (‚àí‚àû, +‚àû):
                                                   hX                 i1
                                                            Œ±i xœÅi
                                                                          œÅ


                                                        i



                                                                                                                                       œÅ0
Proof of Lemma 6: First, consider two values œÅ < œÅ0 < 0 and consider the mapping m(x) = x œÅ
which is convex in x. Jensen‚Äôs inequality implies that:
                                       X         X
                                    m       Œ±i yi ‚â§     Œ±i m(yi )
                                               i                      i

and thus:
                                        X             1       X                 œÅ0       10
                                                        œÅ                                    œÅ
                                              Œ± i yi        ‚â§                 Œ±i yiœÅ
                                         i                            i

Choosing yi = [xi   ]œÅ ,   we obtain:
                                        hX             i1        hX                    0
                                                                                           i 10
                                              Œ±i xœÅi                          Œ±i xœÅi
                                                        œÅ                                    œÅ
                                                            ‚â§
                                         i                            i
                                                                                                                         œÅ0
Second, consider two values œÅ0 > œÅ > 0 and consider again the mapping m(x) = x œÅ which is now
concave in x. Jensen‚Äôs inequality for concave functions implies:
                                        X        X
                                      m     Œ±i yi ‚â•      Œ±i m(yi )
                                               i                      i

and thus, taking to the exponent 1/œÅ < 0, we have:
                                        X             1       X                 œÅ0       10
                                                        œÅ                          œÅ         œÅ
                                              Œ± i yi        ‚â§                 Œ±i yi
                                         i                            i

Choosing yi = [xi ]œÅ , we obtain:
                                        hX             i1        hX                    0
                                                                                           i 10
                                              Œ±i xœÅi                          Œ±i xœÅi
                                                        œÅ                                    œÅ
                                                            ‚â§
                                         i                            i

Note that these terms are well defined when œÅ converges to zero (on both sides):
                                              hX                 i1
                                                        Œ±i xœÅi
                                                                              Y
                                                                                   xŒ±i i
                                                                  œÅ
                                        lim                           =
                                        œÅ‚Üí0
                                                   i                           i

hence the findings above also apply to œÅ = 0. This proves Lemma 6.




                                                            39
Appendix B ‚Äì Counter-examples
First case with homogeneous demand shifters
Here I show that we can find a case where conditions ii) fails and where the Slutsky substitution
matrix is not semi-definite negative, thus proving that condition ii) cannot be entirely waived.
     Suppose that F (Œõ) = Œõ (no problem arises when F is locally constant) and that we have two
goods 1 and 2, where ŒµD1 < ŒµH while ŒµD2 > ŒµH for the other good, i.e. ŒµH ‚àà (ŒµD1 , ŒµD2 ). In particular,
to fix ideas, supposed that all elasticities are constant, with ŒµH = ŒµD2 +Œµ  2
                                                                               D1
                                                                                    ‚â° ‚àíŒ∫ < 0 and denote
Œ¥ ‚â° ŒµD2 ‚àí ŒµH = ŒµH ‚àí ŒµD1 > 0. Denote by the expenditure share of product 1 as 1‚àí               2 and the
expenditure share of good 2 as 1+  2  such  that ŒµÃÑ D ‚àí Œµ H = Œ¥. While elasticities are constant, we can
still adjust the demand shifter for each good to obtain the desired market shares (hence  can be
chosen independently from the elasticities).
     The off-diagonal coefficients of the Slutsky substitution matrix are then:

                             a1 a2 (ŒµD1 ‚àí ŒµH )(ŒµD2 ‚àí ŒµH )                (1 ‚àí 2 )Œ¥ 2 (1 ‚àí 2 )Œ∫
          s12 p1 p2 /w = ‚àí                                + a1 a2 ŒµH = ‚àí             ‚àí
                                       ŒµÃÑD ‚àí ŒµH                             4Œ¥           4
where ai denotes the expenditure share of good i. The diagonal coefficients are:

                              a21 (ŒµD1 ‚àí ŒµH )2              (1 ‚àí )(Œ∫ + Œ¥) (1 ‚àí )2 Œ¥ 2 (1 ‚àí )2 Œ∫
      s11 p21 /w = a1 ŒµD1 ‚àí                    + a21 ŒµH = ‚àí               +            ‚àí
                                   ŒµÃÑD ‚àí ŒµH                        2          4Œ¥           4

                              a22 (ŒµD2 ‚àí ŒµH )2              (1 + )(Œ∫ ‚àí Œ¥) (1 + )2 Œ¥ 2 (1 + )2 Œ∫
      s22 p22 /w = a2 ŒµD2 ‚àí                    + a22 ŒµH = ‚àí               +            ‚àí
                                   ŒµÃÑD ‚àí ŒµH                        2          4Œ¥           4
One can see that the substitution coefficients become very large as  approach zero (because some
of the terms have  in the denominator). Moreover, if we denote by Œ£ the matrix with coefficients
sij pi pj /w, we obtain:                                   
                                                   +Œ¥ ‚àíŒ¥
                                     lim 4Œ£ =
                                    ‚Üí0+           ‚àíŒ¥ +Œ¥
This matrix is semi-definite positive: xT 4Œ£x = Œ¥ 2 (x1 ‚àí x2 )2 ‚â• 0. By continuity, when  is small
enough, the substitution matrix with coefficient sij is semi-definite positive, which is not consistent
with a rational demand system.


Second case with iso-elastic substitution
In this case, I provide counter-examples to show that neither Œõ or U are well defined if the assumptions
of Proposition 4 are not satisfied.

   ‚Ä¢ First, suppose that œÉ(Œõ) increases in Œõ. In this case, the elasticity of substitution increases
     with income and issues are more likely to arise when consumption is concentrated in one or few
     goods.
      When Gi (Œõ) is not monotonic in Œõ for a good i, the budget constraint can be written:

                                                 Gi (Œõ)pi /w = 1

      when the consumption of all other goods become negligible, i.e. when (pj /w)1‚àíœÉ(Œõ) = 0. If
      there exists Œõ1 6= Œõ2 such that Gi (Œõ1 ) = Gi (Œõ2 ), one can see that the equation above has at


                                                    40
  least two solutions when pi /w = 1/Gi (Œõ1 ).
  Conversely, utility is not well defined by the implicit equation provided in Proposition 4 when
                                                                         œÉ(U )‚àí1

  Gi is not monotonic for a good. Suppose that qj œÉ(U ) is zero (or close to zero) for other goods
                                           œÉ(U )‚àí1
                                     qi       œÉ(U )
  j. In that case, we can see that Gi (U )           = 1 ‚áî Gi (U ) = qi has several solutions in U for
  some qi if Gi is not monotonic, potentially violating the monotonicity of U w.r.t quantities.
  We also need G0i to have the same sign for all goods. If it is not the case, we can obtain
  situations where Œõ and U are not well defined, or where U would decrease with quantities qi for
  some goods.

‚Ä¢ Counter-examples for the second case are more difficult to construct. Here we will assume here
  that œÉ(Œõ) and Gi (Œõ) are differentiable. Let us examine what happens when inequality (13) is
  not satisfied, i.e. when:
                                           (œÉ(Œõ) ‚àí 1)2 G0i (Œõ)
                                 X                            
                                     exp                         >1
                                              œÉ 0 (Œõ)Gi (Œõ)
                                               i

  for a given Œõ = U0 . In that case, we can show that it is possible to find a set of quantities qi
  such that U0 is the solution of equation (14) but where implicit utility would depend negatively
  on some of the quantities. This amounts to showing that the following expression:
                                               hX                        1‚àíœÉ(U ) i    œÉ(U )
                                                                            œÉ(U )      1‚àíœÉ(U )
                                                            Gi (U )/qi
                                                   i

  decreases with U and for at least some of the qi ‚Äôs.
  Suppose that U0 is the solution of equation (14) for a given set of qi . We can always rearrange
  the qi to match a given set of consumption shares while still having U0 as the solution of
  equation (14) . In particular, choose qi‚àó such that U0 is still the solution of (14) and such that:
                                               1‚àíœÉ(U0 )          1
                                                                            
                                                                                (œÉ(U0 ) ‚àí 1)2 G0i (U0 )
                                                                                                          
                                Gi (U0 )/qi‚àó
                                                   œÉ(U0 )
                                                                 =   exp
                                                                   A               œÉ 0 (U0 )Gi (U0 )
                          (œÉ(U0 )‚àí1)2 G0i (U0 )
               P                               
  where A ‚â°       i exp      0
                            œÉ (U0 )Gi (U0 )       > 1, strictly larger than unity if condition ii) is not
  satisfied. Consider the function:
                                                       hX                       1‚àíœÉ(U ) i      œÉ(U )
                                                                                    œÉ(U )       1‚àíœÉ(U )
                                      f (U, q) =                  Gi (U )/qi
                                                             i

  which corresponds to the left-hand side of equation (14). One can see that the derivative in U
  at U = U0 and q = q ‚àó is negative:

                     X G0 (U0 )  Gi (U0 )  1‚àíœÉ(U 0)                                            1‚àíœÉ(U )
                                                                         œÉ 0 (U0 ) X  Gi (U0 )  œÉ(U0 )0      G (U )  1‚àíœÉ(U0 )
                                                                                                                 i    0
  fU (U0 , q ‚àó ) =          i                 œÉ(U )         0                                                             œÉ(U0 )
                                                                  +                                       log
                          Gi (U0 )       qi‚àó                           (1‚àíœÉ(U0 ))2       qi‚àó                      qi‚àó
                      i                                                                     i
                   œÉ 0 (U0 )
               =             log A < 0
                 (1‚àíœÉ(U0 ))2

  while the derivative fqi (U0 , q ‚àó ) in each qi is also negative. This leads to an implicit utility
  function U of q that decreases with quantities.


                                                                  41
Appendix C ‚Äì Practical cases and applications
For the second case, generalized non-homothetic CES, with uniform elasticity of substitution across
goods:
   1. In various contexts, one has associated a lower elasticity of substitution for richer consumers
      (in line with empirical evidence) while keeping the practicality of CES preferences. Proposition
      4 case ii) allows us to do just that. Handbury (2016) and Faber and Fally (2017) assume that
      the consumption of the outside good influences elasticities. Here, one can circumvent such
      assumption by defining utility implicitly in a similar fashion as in Hanoch (1975) and Comin et
      al (2015).
   2. Comin et al (2015) provide an excellent application of the case with constant elasticity of
      substitution œÉ that does not depend on income. In the calibration of their model, each industry
      is associated with a distinct structural parameter driving income effect, while keeping constant
      elasticities of substitution among industries. Here we show that it can be extended to elasticities
      of substitution that can potentially change with real income. Moreover, these income effects
      in substitution would not have to be tied (in terms of functional form) to income effects in
      consumption shares across industries.
      For instance, one application could be to rationalize the rise of profits and fixed costs relative to
      variable costs. If œÉ decreases with utility (and thus income), growth would be associated with
      larger markups and larger variable profits, and under free entry with larger shares of fixed costs
      over total costs. If fixed costs are more intensive in capital, this would rationalize an increasing
      share of capital in GDP.
   3. While Comin et al (2015) focus on constant elasticity œÉ(Œõ) = œÉ, an opposite case would be to
      assume that all goods have the same shifters Gi (Œõ) = G(Œõ). Generalized non-homothetic CES
      would still be non-homothetic in that case. Assuming that œÉ(Œõ) is differentiable, integrability
      is ensured if G(Œõ) increases sufficiently fast:

                                   G0 (Œõ)                œÉ 0 (Œõ)
                                                                       
                                           > max 0, ‚àí             log N
                                   G(Œõ)               (œÉ(Œõ) ‚àí 1)2

For the first case, generalized Gorman-Pollak form, with non-uniform elasticity of substitution:
   4. A simple way to generalize both directly and indirectly-separable preferences, as well as homo-
      thetic single-aggregator (HSA) preferences, is to consider iso-elastic functions H and F such
      that demand can be written:
                                            qi = ŒõŒ≤ Di (Œõpi /w)
      For instance, if we assume that the price elasticity of Di is always strictly larger than unity
      (a common assumption under monopolistic competition to ensure finite markups), integrability
      is ensured as long as Œ≤ ‚â§ 1. Directly-separable preferences correspond to the special case
      Œ≤ = 0, indirectly-separable preferences correspond to the limit case Œ≤ ‚Üí ‚àí‚àû, and homothetic
      single-aggregator to the special case Œ≤ = 1.
   5. Iso-elastic functions Di (x) = Ai x‚àíœÉi , F (Œõ) = Œõ and H(Œõ) = Œõ‚àíŒ≤ with Œ≤ < 1 lead to another
      interesting case. It is equivalent to CES only if the œÉi ‚Äôs are identical.
      This corresponds to self-dual addilog preferences previously examined by Houthakker (1965),
      Pollak (1972) and just recently by Bertoletti and Etro (2017a). With direct separability (when


                                                   42
       H is constant), we obtain preferences with ‚ÄúConstant Relative Income Elasticities‚Äù (Fieler 2011,
       Caron et al., 2017, 2014). When Œ≤ = 0 (CRIE). In the latter case with Œ≤ = 0, income elasticities
       are:
                                                 ‚àÇ log qi   œÉi
                                                          =                                        (36)
                                                 ‚àÇ log w    œÉÃÑ
       where œÉÃÑ is the expenditure-weighted average of œÉj . With Œ≤ 6= 0, we obtain a generalization of
       such preferences where income elasticities are given by:
                                             ‚àÇ log qi                œÉ ‚àí œÉÃÑ 
                                                                        i
                                                      = 1 + (1 ‚àí Œ≤)                               (37)
                                             ‚àÇ log w                  œÉÃÑ ‚àí Œ≤

       These demand systems are non-homothetic except for the case where Œ≤ = 1 (which does not
       necessarily imply CES) or when œÉj = œÉi for all i, j.

 6. Augmented bi-power form, as in Mazrova and Neary (2013)
       Consider the demand system, assuming œÉ > ŒΩ > 0:

                                      qi (pi /w, Œõ) = Œ≥(Œõ)[pi /w]‚àíŒΩ + Œ¥(Œõ)[pi /w]‚àíœÉ
                                                                                                    1
       Under which conditions is that demand system integrable? Defining F (Œõ) = [Œ≥(Œõ)/Œ¥(Œõ)] œÉ‚àíŒΩ
                                                 œÉ       ŒΩ
       and H(Œõ) = Œ¥(Œõ)‚àí1 F (Œõ)‚àíœÉ = Œ≥(Œõ)‚àí œÉ‚àíŒΩ Œ¥(Œõ) œÉ‚àíŒΩ , one can recover the form of demand
       systems as in Mazrova and Neary (2013) by applying Proposition 3.
       To apply Proposition 3, one would need qi to be decreasing in Œõ, regardless of prices. Hence
       a sufficient condition is that both Œ¥(Œõ) and Œ≥(Œõ) decrease with Œõ. If those conditions are
       not satisfied, we can see that Œõ will not be well defined.14 TakingPvery low prices, we have
       qi (pi /w, Œõ) ‚âà Œ¥(Œõ)[pi /w]‚àíœÉ and we can see that the equation         i Œ¥(Œõ)[pi /w]
                                                                                           1‚àíœÉ = 1 can

       lead to multiple solutions in Œõ if Œ¥ is not monotonic.
                                                         P Conversely,     if we have very high prices,
       qi (pi /w, Œõ) ‚âà Œ≥(Œõ)[pi /w]‚àíŒΩ , and the equation     i Œ≥(Œõ)[pi /w]1‚àíœÉ = 1 can lead to multiple

       solutions in Œõ if Œ≥ is not monotonic. Hence monotonicity in both Œ≥(Œõ) and Œ¥(Œõ) is required to
       ensure that Œõ is well defined.

 7. The previous example builds on a symmetric case (symmetric across all goods). More generally,
    one can also consider asymmetric bi-power forms. With Di (yi ) = Œ≥i yi‚àíŒΩi + Œ¥i yi‚àíœÉi , one can
    obtain recoverable demand systems as long as F (Œõ) and H(Œõ) are common across all goods, i.e.
    if demand takes the form:

                             qi (pi /w, Œõ) = Œ≥i H(Œõ)[F (Œõ)pi /w]‚àíŒΩi + Œ¥i H(Œõ)[F (Œõ)pi /w]‚àíœÉi
              ‚àÇ log H
       with   ‚àÇ log Œõ   < min{ŒΩi , œÉi } to ensure that Œõ is well defined.

 8. Similarly, one can consider inverse demand functions that are bi-power, with the same extensions
    as above.

 9. Mrazova et al. (2017) introduce CREMR demand (with constant revenue elasticity of marginal
    revenue) where the own-price effects are such that the distribution of sales and productivity
    belong to the same family (e.g. lognormal+lognormal, Pareto+Pareto, etc.). They rationalize
    their demand system with a directly-additive utility function.
14
     If both Œ¥ and Œ≥ are instead increasing in Œõ, we can just replace Œõ by 1/Œõ.



                                                         43
       Using our results, one can further generalize such demand system (though only in the supercon-
       vex case where there is no restriction on minimum quantities) with more flexible income effects
       while keeping the CREMR properties linked to price effects. If we specify:
                                                              Œ≤i          œÉ‚àí1
                                                 Di‚àí1 (x) =      (x ‚àí Œ≥i ) œÉ
                                                              x
       with Œ≥i < 0, and H(z) such that ŒµH ‚â• ‚àí1, the following (inverse) demand systems is integrable:

                                         pi (qi , z) = w/z Di‚àí1 (H(z)qi )

       where z is implicitly defined by the budget constraint i pw
                                                                   P i qi
                                                                          =1 (see Section 3), which can be
       written:                             X                      œÉ‚àí1
                                      z =         Œ≤i (H(z)qi ‚àí Œ≥i ) œÉ / H(z)
                                                  i

       The directly additive case described in Mrazova et al. (2017) corresponds to the case where
       H(z) is constant. The homothetic case corresponds to H(z) = 1/z.

  10. Conditionally-linear demand:
                                                qi = (Œ±i ‚àí Œ≥i Œõpi )/H(wŒõ)
                                          Œ±i
       is integrable as long as Œõpi ‚â§     2Œ≤i   and ŒµH > ‚àí1.
       This generalizes Ottaviano et al. (2002), Melitz and Ottaviano (2008) and Mayer et al. (2014)
       based on quasi-linear preferences. This conditionally-linear demand system nevertheless yields
       very simple expressions for markups in monopolistic competition when Œõ is taken as given (limit
       case with many firms).
       A practical case is to impose H(wŒõ) = (wŒõ)‚àíŒ≤ with Œ≤ < 1, but even in this most simple case
       there is no fully closed-form solution since utility (direct and indirect) still depends on functions
       z and Œõ that are implicitly defined.15 While z ‚àíŒ≤ qi < Œ±i and pi Œõ < Œ±i /Œ≥i , utility and indirect
       utility take the form:

                                                   Œ≤z 1‚àíŒ≤   X z ‚àíŒ≤ qi (2Œ±i ‚àí z ‚àíŒ≤ qi )
                                     U (q) =              +
                                                   1‚àíŒ≤                  2Œ≥i
                                                                 i
                                                   (wŒõ)1‚àíŒ≤   X pi Œõ(2Œ±i ‚àí Œ≥i pi Œõ)
                                  V (p, w) =               ‚àí
                                                    1‚àíŒ≤                2
                                                                     i

                                                                                              ‚àíŒ≤ q                               Œ≤p
                                                                           P                                        P
       where z and Œõ are implicitly defined as the solutions of z =             i qi (Œ±i ‚àíz          i )/Œ≥i   and       i (wŒõ)        i (Œ±i ‚àí
       Œ≥i Œõpi ) = w respectively.

  11. Counter-examples where demand depends on more than one aggregator: Kimball (1995) and
  15                                                                             Œ±i
     Note that the conditions in Proposition 2 are not always satisfied if x ‚â§ 2Œ≥  i
                                                                                     and the elasticity of H is close
to ‚àí1 (Di would have an elasticity below unity in absolute value). In a monopolistic competition framework,
                               2
a trick is to replace Di by 4Œ≥Œ±i x for x < 2Œ≥
                                            Œ±
                                              i
                                                . Such a function Di would satisfy the conditions of Proposition 1
as long as the elasticity of H remains between zero and unity. In equilibrium, none of the firms would set an
                                                                   Œ±i
infinite markup, hence equilibrium prices are such that Œõpi > 2Œ≥     i
                                                                       and none of the firms would end up on the
non-linear portion of the demand curve.




                                                         44
QMOR (Feenstra 2015). QMOR demand can be expressed as:
                                          "     ‚àó r/2 #
                                   pi r‚àí1
                                      
                                                p
                        qi = Œ±u             1‚àí
                                  e(p)          pi

which is a function of two aggregators: p‚àó and e(p). Given that e(u)u = w, we also have:
                                                 "    ‚àó r/2 #
                                            pi r
                                         
                               p i qi                   p
                                      =Œ±           1‚àí
                                w          e(p)         pi

Note that the price elasticity can be expressed as a function of p‚àó only.
Similarly, demand with Kimball preferences with an implicit aggregator depends in fact on two
aggregators (it also depend on the Lagrange multiplier associated with the budget constraint)
hence they are not a special case of the demand systems described here.




                                            45
