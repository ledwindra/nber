NBER WORKING PAPER SERIES

CONSUMPTION RISK-SHARING IN SOCIAL NETWORKS
Attila Ambrus
Markus Mobius
Adam Szeidl
Working Paper 15719
http://www.nber.org/papers/w15719

NATIONAL BUREAU OF ECONOMIC RESEARCH
1050 Massachusetts Avenue
Cambridge, MA 02138
February 2010

We are grateful to Dean Karlan and Tanya Rosenblat for allowing us to use data they collected jointly
with Markus Mobius. We thank Daron Acemoglu, In Koo Cho, Erica Field, Drew Fudenberg, Andrea
Galeotti, Matthew Jackson, Eric Maskin, Stephen Morris, Gabor Pete, Debraj Ray, Laura Schechter
and seminar participants for helpful comments and suggestions, and the National Science Foundation
for financial support. The views expressed herein are those of the authors and do not necessarily reflect
the views of the National Bureau of Economic Research.
NBER working papers are circulated for discussion and comment purposes. They have not been peerreviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.
© 2010 by Attila Ambrus, Markus Mobius, and Adam Szeidl. All rights reserved. Short sections of
text, not to exceed two paragraphs, may be quoted without explicit permission provided that full credit,
including © notice, is given to the source.

Consumption Risk-sharing in Social Networks
Attila Ambrus, Markus Mobius, and Adam Szeidl
NBER Working Paper No. 15719
February 2010
JEL No. D02,D31,D70
ABSTRACT
We develop a model of informal risk-sharing in social networks, where relationships between individuals
can be used as social collateral to enforce insurance payments. We characterize incentive compatible
risk-sharing arrangements and obtain two results. (1) The degree of informal insurance is governed
by the expansiveness of the network, measured by the number of connections that groups of agents
have with the rest of the community, relative to group size. Two-dimensional networks, where people
have connections in multiple directions, are sufficiently expansive to allow very good risk-sharing.
We show that social networks in Peruvian villages satisfy this dimensionality property; thus, our model
can explain Townsend's (1994) puzzling observation that village communities often exhibit close to
full insurance. (2) In second-best arrangements, agents organize in endogenous "risk-sharing islands"
in the network, where shocks are shared fully within, but imperfectly across islands. As a result, network
based risk-sharing is local: socially closer agents insure each other more.

Attila Ambrus
Department of Economics
Harvard University
Littauer 309
Cambridge, MA 02138
ambrus@fas.harvard.edu
Markus Mobius
Harvard University
Department of Economics
Littauer 327
Cambridge, MA 02138
and NBER
mobius@fas.harvard.edu

Adam Szeidl
Department of Economics
University of California, Berkeley
517 Evans Hall, #3880
Berkeley, CA 94720-3880
szeidl@econ.berkeley.edu

In much of the developing world, people face severe income ‡uctuations due to weather
shocks, diseases a¤ecting crops and livestock, and other factors. These ‡uctuations are
costly because households are poor and lack access to formal insurance markets. Informal
risk-sharing arrangements, which help cope with this risk through transfers and gifts, are
therefore widespread. For example, Figure 1 depicts …nancial and in-kind transfers between
relatives and friends in a rural village in the Huaraz province of Peru.1
Development economists have studied both the pattern of informal transfers and their
e¤ectiveness in sharing risk. Two seemingly contradictory …ndings have been documented.
On the one hand, these arrangements often seem to be based on local obligations, as people
mainly help out close neighbors, relatives and friends (Udry 1994). On the other hand,
these local mechanisms often achieve almost full global insurance on the village level. For
example, (Townsend 1994) argues that the full insurance model provides a surprisingly good
benchmark even though it is typically rejected in the data.2
How can local obligations and transfers aggregate up to good global risk-sharing? We
build a simple model of risk-sharing in social networks that provides an explanation for this
puzzle. We …nd that full insurance is di¢ cult to obtain because it requires a high level
of connectedness that we do not observe in real social network data. However, consistent
with the evidence, we also show that close to perfect risk-sharing can be achieved for the
type of more loosely connected social networks that we do observe. Our model also allows
us to study the nature of informal risk-sharing arrangements. We show that households’
consumption will comove more strongly with that of socially closer households, a prediction
consistent with the empirical …ndings in Angelucci, Giorgi, Rangel and Rasul (2008), who
therefore provide indirect evidence for our model.
We model the social network as a set of pre-existing relationships, like friendships and
family ties. These links have utility value, which represents either the direct consumption
value of relationships, or indirect bene…ts from future transactions. We de…ne a risk-sharing
arrangement as a set of transfers between direct neighbors in the social network in every
1

The data used in constructing this Figure were collected by Karlan, Mobius and Rosenblat (2007). See
Appendix B for details.
2
Also see Ogaki and Zhang (2001) and Mazzocco (2007).

1

Huaraz Community

J

F

H
Agricultural tool (74.3%)
Other tool (7.3%)
Animals (1.8%)
Electric device (0.8%)
Kitchen utensil (5.6%)
Clothes (0.7%)
Food (7.0%)
Other (2.5%)

A

D

I

C
E

G

B

X

0 to 10 S/.
11 to 20 S/.
21 to 50 S/.
51 to 100 S/.
101 S/. or more

40.5%
15.6%
17.1%
11.0%
15.9%

Figure 1: Financial and real transactions between relatives and friends in a rural community
in Peru, represented as lines between transacting parties in the village map. Thickness of
line measures value of transaction in Peruvian New Soles.
state of the world. This arrangement is subject to moral hazard: ex post, an agent who
is expected to make a transfer to a network neighbor may prefer to deviate and withhold
payment. In our model, such deviations result in the loss of the a¤ected link. Intuitively,
network links serve as social collateral ensuring that agents live up to their obligations under
the informal risk-sharing arrangement.
Our …rst result is that an incentive-compatible risk-sharing arrangement always gives rise
to a consumption allocation that is coalition-proof in the following sense: the net transfer
from any group of agents to the rest of the community, de…ned as the di¤erence between the
group’s total endowment and consumption, cannot exceed the sum of the values of all links
between the group and the community. Intuitively, individual obligations embedded in the
value of links build up to group obligations represented by the total value of links connecting
the group with the larger community.
This equivalence between coalition-proof allocations and incentive compatible risk-sharing
2

arrangements has two implications. First, it shows that decentralized insurance arrangements
can also be implemented in a centralized fashion through intermediaries such as trusted village elders, who respect the obligations of each group (e.g., extended family) in the community. Second, the result relates the geometry of the network to its e¤ectiveness for risksharing, allowing us to study how local links aggregate to social capital at the community
level.
The key property of network structure identi…ed by our equivalence result is called expansiveness, and measures the number of connections that groups of agents have with the
rest of the community relative to group size. To gain intuition about this property, consider
the three example networks in Figure 2. Among these networks, the in…nite line in Figure
2A is the least expansive, because any connected set of agents always has only two links with
the rest of the community. The in…nite “plane” network of Figure 2B is more expansive,
while the in…nite binary tree of Figure 2C is the most expansive network of all, where the
number of outgoing links for any set grows at least proportionally with its size.
Figure 2: Expansion properties of three example networks

c[ ]

c[ ]

c[ ]

/

3

We show that full insurance requires highly expansive networks like the in…nite binary
tree. However, we do not …nd that real-world social networks in rural villages in Peru exhibit
this large degree of expansiveness. Instead, these social networks are more similar to planar
networks, possibly because people tend to have connections at close geographic distance. We
next show that a two-dimensional structure, such as found in our Peruvian data, is su¢ cient
to ensure very good risk-sharing in most states of the world. For an intuition, consider a
connected group of agents in the plane network. With idiosyncratic shocks, the standard
deviation of the total endowment of the group is proportional to the square root of group size.
But on the plane, the number of outgoing links from the group is also at least proportional
to the square root of size (the worst case would be when the group has a square shape).
Thus group obligations with the rest of the community – links connecting the group with
the network –are of the same order of magnitude as group shocks. Since this holds for every
group, it follows that “almost” full risk-sharing can be implemented in the network. This
argument applies not just for the regular plane network, but for any social network which
has a two-dimensional sub-structure. We call these networks geographic networks and we
show that our Peruvian village networks fall into this class. As a result, our model provides
a potential explanation for the informal insurance puzzle highlighted by Townsend.
The above results constitute a quantitative analysis of informal risk-sharing. Our second
main contribution is a qualitative analysis of constrained e¢ cient “second-best” arrangements. We show that in these arrangements, the network can be partitioned into endogenously organized connected groups called “risk-sharing islands” for every realization of uncertainty. This partition has the property that shocks are completely shared within, but
only imperfectly across islands. The island structure can be understood in terms of “almost
deviating coalitions,”who are indi¤erent between staying in the network and deviating as a
group. Islands are maximal connected sets subject to the constraint that they are not divided
by any almost deviating coalition; therefore, insurance across island boundaries is limited,
but insurance within islands is complete. The size and location of these risk-pooling islands
is endogenously determined by the social structure and the realization of endowment shocks,
consistent with evidence documented by Attanasio, Barr, Cardenasy, Genicot and Meghir
(2009), and distinguishing our model from theories with exogenously speci…ed risk-sharing
4

groups.
A key implication of the islands result is that an agent’s consumption will comove more
with the consumption of closely connected neighbors. This follows because islands are connected subgraphs: agents who are socially closer are more likely to belong to the same island
and thus provide more insurance. This observation helps characterize informal insurance as
a function of shock size. Risk-sharing works well for relatively small shocks: sharing islands
are large, and both direct and indirect friends help out. As the size of the shock increases,
only close friends help with the additional burden; and risk-sharing completely breaks down
for large shocks. Some of these predictions are con…rmed in the empirical work of Angelucci
et al. (2008).
Our paper builds on a growing literature studying informal insurance in networks. Bloch,
Genicot and Ray (2008) develop a model with both informational and commitment constraints, and characterize network structures that are stable under certain exogenously speci…ed risk-sharing arrangements. We conduct the opposite investigation: taking the network
as given, we study the degree and structure of informal risk-sharing. Bramoulle and Kranton (2006) also study insurance arrangements in networks, but in their model there are no
enforcement constraints. Our modeling approach builds on Karlan, Mobius, Rosenblat and
Szeidl (2009), who explore informal borrowing in networks.3 Empirical work in this area
includes De Weerdt and Dercon (2006), Fafchamps and Lund (2003) and Fafchamps and
Gubert (2007), who use data on village networks, Attanasio et al. (2009) who document
the importance of social ties for risk-pooling, while Mazzocco (2007) emphasizes the role of
within-caste transfers.
More broadly, our work contributes to the growing literature on informal institutions.
Kandori (1992), Ellison (1994) and Greif (1993) develop game-theoretic models of community enforcement, and Kranton (1996) studies the interaction between relational and formal
markets. In the context of consumption insurance, Ligon (1998), Coate and Ravaillon (1993),
Kocherlakota (1996) and Ligon, Thomas and Worrall (2002) explore related models with limited commitment, while Mace (1991) and Cochrane (1991) are in‡uential empirical studies
3

See also Ali and Miller (2008), who study network formation with repeated games and Dixit (2003), who
compares relational and formal governance in a circle network.

5

of consumption insurance. These papers do not study the e¤ects of network structure.
The rest of this paper is organized as follows. Section 1 presents our model of informal
insurance in networks. Section 2 characterizes the limits to risk-sharing, and confronts the
theoretical results with data on social networks in Peru. Section 3 analyses constrained
e¢ cient arrangements. Section 4 explores a more general version of our model and Section
5 concludes. Proofs are delegated to Appendix A and a supplementary appendix.

1

A model of risk-sharing in the network

1.1

Model setup

In our model, agents face income uncertainty due to factors such as weather shocks and crop
diseases. In the absence of a formal insurance market, agents can agree on an informal
risk-sharing agreement that speci…es transfers between pairs of agents in each state of the
world. These transfers are secured by the social network: connections in the network have
an associated consumption value that is lost if an agent fails to make a promised transfer.
Formally, a social network G = (W; L) consists of a set W of agents (vertices) and
a set L of links, where a link is an unordered pair of distinct vertices. Unless otherwise
stated, we assume that the network is …nite; the supplementary appendix discusses how to
extend our setup to in…nite networks. Each link in the network represents a friendship or
business relationship between the two parties involved. We assume that the strength of these
relationships is determined outside the model, and that they are measured by a capacity.
De…nition 1 A capacity is a function c : W

W ! R such that c(i; j) > 0 if (i; j) 2 L and

c(i; j) = 0 otherwise.
The capacity of an (i; j) link measures the bene…t that i derives from his relationship
with j. These bene…ts can represent the direct utility that agents derive from interacting
with each other, or the utility or monetary value of economic interaction in the present or
in future periods. For ease of presentation, we assume that the strength of relationships is
symmetric, so that c(i; j) = c(j; i) for all i and j. All our results extend to the case with
asymmetric capacities.
6

Agents in this economy face uncertainty in the form of endowment risk. We denote the
vector of endowment realizations by e = (ei )i2W , which is drawn from a commonly known
joint distribution. The vector of endowments is observed by all agents.
A risk-sharing arrangement speci…es a collection of bilateral transfer payments te = teij ,
where teij is the net dollar amount transferred from agent i to agent j in state of the world e,
teji by de…nition. The risk-sharing arrangement te implements a consumption
P e
allocation xe where xei = ei
j tij . For simplicity, we suppress the dependence of the
so that teij =

transfers teij and consumption allocation xe on e for the rest of the paper.
P
An agent who consumes xi enjoys utility Ui (xi ; ci ), where ci = j c(i; j) denotes the

total value that agent i derives from all his relationships in the network, and U is strictly
increasing and concave. To simplify exposition, in the body of the paper we focus on the
analytically convenient case where consumption and friendship are perfect substitutes, so
that the utility of i is Ui (xi + ci ). Section 4 develops the model with imperfect substitutes,

and shows that under weak conditions, all our qualitative conclusions extend. The agent’s
ex-ante expected payo¤ is EUi (xi + ci ), where the expectation is taken over the realization
of endowment shocks.
We say that a risk-sharing arrangement is incentive compatible if every agent i prefers
to make each of his promised transfers tij rather than lose the (i; j) link and its associated
value. Because consumption and friendships are perfect substitutes, incentive compatibility
implies tij

1.2

c(i; j).

Discussion of modeling assumptions

Risk-sharing arrangement. The most literal interpretation of these arrangements, in the spirit
of Arrow and Debreu, is that agents choose an ex ante informal contract, which speci…es
payments for every conceivable realization of uncertainty. Alternatively, the consumption
allocation may also be determined ex post by a social norm that speci…es how to reallocate
goods among connected agents. For example, Fafchamps and Lund (2003) describe how
informal insurance is implemented through a collection of bilateral “quasi-loans,” where
households borrow from neighbors, who expect their kindness returned when they themselves
are hit by adverse shocks.
7

Capacities and dynamic interpretation. We analyze a one-time risk-sharing arrangement
in a network where links and capacities are determined outside the model. The most direct
interpretation of this framework is that link values are generated by a number of social
activities and services besides risk-sharing. In this interpretation, the links themselves may
be created through a long term network formation process largely shaped by factors outside
our model, such kinship and geographic proximity. However, our setup can also be viewed as
a “snapshot”of a dynamic model, where the value of a network connection is determined in
part by the ability to conduct insurance transactions through the link in the future. In such
a dynamic model, link capacities would be endogenized by the expected future bene…ts from
risk-sharing. As Bloch et al. (2008) show in a similar model, this leads to restrictions on the
equilibrium network structure and link values. While our static analysis applies for any set
of capacities, our results could presumably be strengthened by imposing such restrictions
on the network. We plan to explore the implications of dynamics more explicitly in future
work.
Incentive compatibility. Our notion of incentive compatibility is motivated by Karlan et
al. (2009). In their model of informal borrowing, a link between two agents is destroyed if a
promised transfer is not made. They develop explicit micro-foundations for this assumption
where the failure to make a transfer is a signal that the agent no longer values his friend, in
which case these former friends …nd it optimal not to interact with each other in the future.4
An alternative justi…cation is that people break a link for emotional or instinctive reasons
when a promise is not kept; Fehr and Gachter (2000) provide evidence for such behavior.
Full information. Our model assumes that agents in the community can observe the vector of endowment realization so that they know what transfer payments to expect from their
neighbors and how much to send. Full information about endowments seems reasonable in
village environments, where individuals can easily observe the state of livestock or crops. For
example, Udry (1994), shows that asymmetric information between borrowers and lenders
is relatively unimportant in villages in Northern Nigeria.
4

In the supplementary appendix we develop similar foundations for the present model, in which the
value of connections is earned in a “friendship game.” See Ambrus et al. (2010) (available at http://www.
socialcollateral.org/risksharing/supplementary_appendix.pdf).

8

1.3

Coalition-proof allocations

We …rst show that incentive compatible risk-sharing arrangements give rise to consumption
allocations that are coalition-proof in every state of the world in the following sense. The net
transfer between any group of agents and the rest of the community, de…ned as the di¤erence
between the group’s total endowment and total consumption, cannot exceed the sum of the
values of all links connecting the group and the rest of the community. Formally, for any
group F we de…ne the perimeter c [F ] to be sum of the values of all links between the group
and the rest of the community:
c [F ] =

X

c (i; j)

(1)

i2F , j 2F
=

Intuitively, the perimeter is the “joint obligation”of the group F to the rest of the community. Similarly, we de…ne the joint endowment of the group as eF and the joint consumption
allocation induced by the risk-sharing arrangement with xF . Coalition-proofness then requires eF

xF

c [F ] for all F , i.e., the net transfer from the group to the community

cannot exceed the group’s joint obligation c [F ].5
Surprisingly, coalition-proofness tightly characterizes all the consumption allocations that
are implementable through informal risk-sharing.
P
P
Theorem 1 A consumption allocation x that is feasible ( xi = ei ) is coalition-proof in
every state of the world if and only if it can be implemented by an incentive-compatible
informal risk-sharing arrangement.
That an incentive compatible allocation is coalition proof is easy to see: since each transfer
is bounded by the capacity of the link, the same inequality must also hold when transfers
are added up along the perimeter of a group. Proving the converse is more di¢ cult, and
builds on the mathematical theory of network ‡ows. Recall that the maximum ‡ow between
nodes s and t in a network is the highest amount that can ‡ow from s to t along the edges
respecting the capacity constraints. Finding a transfer representation for a coalition-proof
5

The supplementary appendix shows that this de…nition of coalition-proofness in our context is equivalent
to de…ning coalition-proofness along the lines of Bernheim, Peleg and Whinston (1987), i.e., allowing only
for coalitional deviations that are not prone to further deviations by subcoalitions.

9

allocation turns out to be equivalent to …nding a ‡ow in an auxiliary network with two
additional nodes s and t added. According to the theorem of Ford and Fulkerson (1956), the
maximum ‡ow equals the value of the minimum cut, i.e., the smallest capacity that must be
deleted so that s and t end up in di¤erent components. We prove in Appendix A that each
cut in the ‡ow problem corresponds to a coalition, and then the coalition-proofness condition
ensures that the cut values are high enough so that the desired ‡ow can be implemented.
The theorem has two main implications. First, it shows how individual obligations aggregate up to social capital at the community level. Links matter not because they act as
conduits for transfer, but because they de…ne the pattern of obligations in the community.
In particular, a coalition-proof arrangement does not have to be implemented by transfers
over links: intermediaries such as village elders could also collect and distribute resources,
as long as they respect the obligations of each group of households, i.e., coalition-proofness.6
Hence our model need not predict long chains of transfers in practice: these chains are likely
to be shortened by intermediaries.
A second implication of the theorem is that it relates the geometry of the network to its
e¤ectiveness for risk-sharing. This connection forms the basis of our analysis in the following
section.

2

The limits to risk-sharing

In this section use the equivalence between incentive compatibility and coalition-proofness
to explore how much risk-sharing can be obtained in a given network. Our central …nding is
that good risk-sharing requires social networks to have good “expansion properties”; that is,
all groups of agents should have enough connections with the rest of the community, relative
to group size.
6

ei
ei

At the extreme, a single trusted intermediary could implement the allocation by collecting a “tax” of
xi from each agent i for whom this is positive, and use these funds to pay the unlucky agents for whom
xi is negative.

10

2.1

Limits to full risk-sharing

We …rst use Theorem 1 to establish a negative result: full risk-sharing cannot be achieved
unless the network is extremely expansive, because coalitions with a relatively low “group
obligation”c [F ] will choose to deviate in some states.
To build intuition, consider the in…nite line, plane and binary tree networks depicted in
Figure 2, where all link capacities are equal to a …xed number c.7 For these examples, we
assume that endowment shocks are independent across agents, and take values + or
with equal probability. We focus on implementing equal sharing, i.e., an arrangement where
all agents consume the per capita average endowment. This allocation is Pareto-optimal
when agents have identical preferences over consumption. Since our example networks are
in…nite, the law of large numbers implies that the average endowment is zero; equal sharing
thus requires all agents to consume zero with probability one.
Consider an interval set of consecutive agents F on the line (see Figure 2A). The coalitional constraint for F is most likely to bind in the positive probability event where all
agents in F receive a positive shock + . In this event, the zero consumption pro…le dictates
that members of F give jF j

to the rest of the community; but they can only commit to

giving up c [F ] = 2c. Coalition proofness thus requires 2c

jF j

for all F . However, for

any …xed c, this is violated for long enough intervals F . A similar negative result holds for
the more expansive plane network in Figure 2B. The perimeter of a square-shaped set F is
p
c [F ] = 4c jF j; for a large enough square, this is smaller than jF j , which is how much
members of F would have to give up if they all get a positive shock + .

However, these perimeter bounds do not rule out equal sharing for the yet more expansive
binary tree in Figure 2C. Here, the perimeter of any set F is at least

jF j, and so for c

,

no coalition of agents has to give up more than their group obligation in any realization.
These examples suggest that equal sharing can only be incentive compatible in networks
with good expansion properties, i.e., where the perimeter of sets grows in proportion with
set size. To measure expansiveness, we de…ne the “perimeter-area ratio” a[F ] = c [F ] = jF j,
where area stands for the number of agents in F . Intuitively, a [F ] represents the group’s
maximum obligation to the community relative to the group’s size. The next result tightens
7

We consider in…nite networks here because they are useful for building intuition.

11

the connection between expansiveness and insurance by characterizing full risk-sharing in
any network in terms of a [F ], under the assumptions that (1) the support of ei is the same
compact interval of length S for all agents; and (2) the support of ei given any realization
of (e i ) is the same as its unconditional support, for all i.8
Proposition 1

[Limits to full risk-sharing] Under the above assumptions, equal sharing

is supported by an incentive-compatible risk-sharing arrangement if and only if for every
subset of agents F the perimeter-area ratio satis…es a [F ]

1

jF j
jW j

S.

The condition implies that a [F ] must be greater than the constant S=2 for any set of
size at most half the community. In particular, a [F ] must be bounded away from zero
for such sets as the network size grows without bound. The intuition builds on our earlier
examples: risk-sharing between F and the rest of the community is hardest to support when
everyone in F gets the maximum realization and everyone outside F gets the minimum. The
above inequality ensures that the group has a large enough perimeter to credibly pledge the
required resources even in such extreme realizations. The condition is violated for big groups
on the line and plane networks because a [F ] can be arbitrarily small, and only holds for
highly expansive graphs like the binary tree.9
Full insurance in real world networks. We use data from a village community in Huaraz,
Peru to show that real-world networks are unlikely to be expansive enough to allow for full
insurance.10
Figure 3A compares the expansiveness of the Huaraz network with the line, plane, and
in…nite binary tree. For all these networks, link capacities are assumed to be equal across links
and normalized so that the per household average capacity is one. To measure expansiveness,
we construct, for each household, a collection of “ball” sets which contain all households
within a …xed social distance r. We then calculate the average of the perimeter-area ratio
and set size for each r, and plot the perimeter-area ratio as a function of size for all four
networks. Comparing across our three example networks illustrates our earlier discussion:
8

Bloch et al. (2008) impose the same condition on endowment shocks in their Assumption 1.
Families of networks where the perimeter-area ratio is bounded below by a positive constant are called
“expander graphs” in the computer science literature.
10
The data was collected by Dean Karlan, Markus Mobius and Tanya Rosenblat and is described in
Appendix B in more detail.
9

12

Figure 3: Expansiveness of the social network in Huaraz, Peru

.1

.1

.2

.2

Perimeter−Area ratio
.4
.6
.8

Perimeter−Area ratio
.4
.6
.8

1

Panel B

1

Panel A

10

50
Volume of ball

Huaraz community
Plane

100

200 300 400

10

Line
Binary Tree

50
Volume of ball

100

200 300 400

Non−relatives network
Relatives network

the perimeter-area ratio goes to zero quickly for the line network, goes to zero more slowly
for the plane, and remains bounded away from zero for the binary tree.
The key curve in the Figure is the heavy line representing the social network in Huaraz.
This curve lies slightly above the plane but well below the in…nite binary tree, and approaches
zero as set sizes grow, with a slope that parallels the curve for the plane. It follows that
the Huaraz network is less expansive than the in…nite binary tree, and hence our model
predicts that full insurance is not coalition-proof. The result is the same if we look at the
two sub-network of relatives and non-relative friends, respectively, in Figure 3B: the nonrelative network is slightly more expansive, but does not approach the expansiveness of the
binary tree.
Figure 3 suggests that the expansion properties of the Huaraz network are similar to the
plane. A plausible reason is that the Huaraz network, like many social networks in practice,
is partly organized on the basis of geographic distance. For example, the average distance
between two connected agents in this network is only 42 meters, while the average distance
between two randomly selected addresses is 132 meters. This correlation between distance
and network connections can result in expansion properties similar to the plane, if agents
tend to have friends at close physical distance in multiple directions, e.g., both horizontally
and vertically on a map. This logic suggests that to understand partial insurance in real
13

world networks, we should focus on plane-like networks.

2.2

Partial risk-sharing in less expansive networks

Plane networks turn out to be just su¢ ciently well-connected to generate very good risksharing in most states of the world. The key insight is that with a two-dimensional structure,
outcomes where the coalitional constraint binds under equal sharing become rare. To see
the logic, consider again the regular plane with the i.i.d. + =

shocks. As we have seen,

equal sharing fails because households in a large n by n square F would need to give up n2
resources if all of them get a positive shock, which is an order of magnitude larger than the
perimeter c [F ]

n.

The key is that for large n, such extreme realizations are unlikely, and in typical realizations the required transfers do not exceed the perimeter. With i.i.d. shocks, the standard
deviation of the group’s endowment is only n , which is only of order n even though it is
the sum of n2 random variables – intuitively, a lot of the idiosyncratic shocks cancel out
within the group.11 Thus the “typical shock” in F has the same order of magnitude as the
maximum pledgeable amount, and hence potentially deviating coalitions are rare. The same
logic works with correlated shocks, as long as correlation declines fast enough with distance.
By way of contrast, the argument breaks down for the line, since the perimeter of even large
interval sets is only 2c, a constant.

2.3

Plane and line networks

Our intuitive analysis suggests that when shocks are not too correlated, risk-sharing on the
plane should be reasonably good, and substantially better than on the line. We …rst formalize
these ideas and then extend them to less regular networks.
Partial risk-sharing measure. We measure partial risk-sharing as the average utility loss
relative to the benchmark of equal sharing where all agents consume the average endowment
e = eW =jW j :
11

The sum of n2 i.i.d. random variables has variance n2

14

2

and hence standard deviation n .

U DISP (x) = E

1 X
fUi (e)
jW j i2W

Ui (xi )g :

This “utility-based dispersion,” is simply the di¤erence between average utility under
partial and full sharing. Here we ignore the dependence of utility on link consumption to
simplify notation.
If all agents have the same quadratic utility function over x, then we can express U DISP as
an increasing function of
"

1 X
SDISP (x) = E
(xi
jW j i2W

e)2

#1=2

;

(2)

which is the square-root of the expected cross-sectional variance of x. For non-quadratic
utilities, SDISP (x) can be interpreted as a second order approximation of the utility based
measure. SDISP is a tractable measure that inherits the intuitive properties of U DISP :
it is zero only under equal sharing and positive otherwise, and its magnitude measures the
departure from equal sharing: e.g., if ei are + =

with equal probabilities, then in autarky

SDISP (e) = . We use SDISP as our central measure in the analysis below.12
Shocks with limited correlation. While we focused on i.i.d. symmetric shocks in our
example, the formal result accommodates much more general endowment shocks. The key
requirements are that shocks do not have fat tails and are not too correlated; we formalize
these using assumptions (P1) to (P5) below. From now on we use the convention that
K, K 0 and K 00 denote positive constants, but their values at di¤erent occurrences may be
di¤erent.
We model the source of uncertainty as a collection of independent random variables yj ,
j = 1; :::; 1, which can represent both idiosyncratic shocks like illness and aggregate shocks
like weather. Like in a factor model, endowments are determined as linear functions of these
P
basic shocks: ei = j ij yj .where ij measures the extent to which agent i is exposed to
shock j. We assume that ei and yj satisfy the following.

12
Equation (2) only de…nes SDISP for …nite networks. For in…nite networks, we de…ne it to be the lim
sup of (2), taken over an increasing sequence of ball sets centered around some agent i. For the line and the
plane, the choice of i does not a¤ect this lim sup.

15

(P1) [Thin tails] yj are independent, have zero mean and unit variance, and satisfy that
K 2 =2 for all > 0.
P 2
< K for all i.
(P2) [Bounded variance] There exists K > 0 such that j ij

there exists K > 0 such that log[E(exp [ yj ])]

(P3) [Limited correlation] Endowments satisfy

where

F

F = jF j

K jF j

1=2

for some K > 0,

is the standard deviation of eF .

(P4) [More people have more risk] For all G

F , we have

G

(P5) [Sharing with more people is always good.] For all G

F.

F , we have

F = jF j

G = jGj.

Here (P1) is a uniform bound on the moment-generating function of yj , which allows us
to use the theory of large deviations to bound the tails of ei . (P1) is satis…ed for example
if yj are i.i.d. normal, or if they have a common compact support. Property (P3) requires
that shocks are not too correlated, so that aggregate uncertainty disappears at the same
rate as the square root of set size. This condition considerably relaxes the i.i.d. assumption;
for example, on the line or plane, (P3) is satis…ed if the correlation between ei decays
geometrically with network distance.
Formal results. We now state the formal result on risk-sharing on the plane and line
networks. We focus on in…nite networks because they are more convenient for stating our
asymptotic result.
Proposition 2 Under properties (P1)-(P5), there exist positive constants K, K 0 and K 00
such that
(i) On the in…nite line with capacities c and i.i.d. shocks, we have SDISP (x)

K=c

for all incentive-compatible risk-sharing arrangements.
(ii) On the in…nite plane with capacities c, we have SDISP (x)

K 0 exp

K 00 c2=3 for

some incentive-compatible risk-sharing arrangement.
This Proposition characterizes the rate of convergence to full risk-sharing as capacities
increase. The contrast between the line and plane is remarkable. Risk-sharing is relatively
poor on the line: SDISP goes to zero at a slow polynomial rate of 1=c as c goes to in…nity. In
contrast, the rate of convergence for the plane is exponentially fast, con…rming our intuition
that agents are able to share typical shocks due to the more expansive structure.
16

The proof of (i) essentially builds on our earlier arguments: for long enough intervals,
much of the interval-speci…c shock must remain trapped in the set, because the perimeter is
only 2c. Even if agents perfectly smooth inside the interval, overall dispersion remains high.
The result for the plane is much more di¢ cult, and requires going beyond our previous
intuition: even though the coalitional constraint is rarely violated for any particular set F,
we need an allocation that satis…es the constraints of all sets. Equivalently, we need to
construct a transfer arrangement such that the typical ‡ow on every link meets the capacity
constraint. The key idea is to construct this arrangement from the ground up. First we
partition the plane into 2 by 2 squares of agents and implement equal sharing in each of
these. Then we implement fully sharing in 4 by 4 squares, then in 8 by 8 ones, and so
on. After n iterations, we obtain full sharing of endowments in 2n by 2n “super-squares”.
Because each link is used once in every round, the construction uses every link at most n
times. By our earlier intuition, each time a link is used, the required transfer is typically of
order one, resulting in a total ‡ow per link of order n. This is the uniform bound on the ‡ow
over every link that we require for exponentially good risk-sharing. Since the arrangement
does not yet account for capacity constraints, we use the theory of large deviations to bound
the exceptional event when incentive compatibility is violated, obtaining the bound in the
proposition.
Simulations. Numerical simulations suggest that the asymptotic results of the Proposition provide a good description of behavior for …nite c as well. Figure 4 shows constrained
optimal allocations for …nite line and plane networks, for a given realization of uniform shocks
with support [ 1; 1].13 Figure 4A shows the endowment realizations for both the line and
the plane network: darker red (green) squares correspond to lower (higher) endowments.
We use the same vector of realizations for both networks. The SDISP of these realizations
is 0:55 in the absence of any insurance. Now consider Figure 4B, where we assume that
the average capacity per agent is 1: thus each link has value c = 0:5 in the line network
and c = 0:25 in the plane. For these capacities, the …gure depicts the optimal, SDISP
minimizing incentive compatible allocation. The contrast between the line and the plane is
13

In the simulations opposing edges of the networks are connected, so the line is in fact a circle and the
plane a torus.

17

Figure 4: Risk-sharing simulations on the line and the plane for increasing capacities
Panel A: initial endowments (uniform over [−1, 1])
84

85

86

87

88

89

90

91

92

93

94

95

96

97

98

99

82
81

80

79

78

77

76

75

74

73

72

71

70

69

68

67

66

10

20

30

40

50

60

70

80

90

100

9

19

29

39

49

59

69

79

89

99

8

18

28

38

48

58

68

78

88

98

7

17

27

37

47

57

67

77

87

97

6

16

26

36

46

56

66

76

86

96

5

15

25

35

45

55

65

75

85

95

4

14

24

34

44

54

64

74

84

94

3

13

23

33

43

53

63

73

83

93

2

12

22

32

42

52

62

72

82

92

1

11

21

31

41

51

61

71

81

91

100

83

65

64

63
62
61

42

43

44

45

46

47

48

49

50

51

52

53

54

55

56

57

58

59

60

41
40
39

38

37

36

35

34

33

32

31

30

29

28

27

26

25

24

23

22

21
20
19

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

SDISP= 0.556

SDISP= 0.556

Panel B: risk-sharing with total capacity 1 per agent
84

85

86

87

88

89

90

91

92

93

94

95

96

97

98

99

82
81

80

79

78

77

76

75

74

73

72

71

70

69

68

67

66

10

20

30

40

50

60

70

80

90

100

9

19

29

39

49

59

69

79

89

99

8

18

28

38

48

58

68

78

88

98

7

17

27

37

47

57

67

77

87

97

6

16

26

36

46

56

66

76

86

96

5

15

25

35

45

55

65

75

85

95

4

14

24

34

44

54

64

74

84

94

3

13

23

33

43

53

63

73

83

93

2

12

22

32

42

52

62

72

82

92

1

11

21

31

41

51

61

71

81

91

100

83

65

64

63
62
61

42

43

44

45

46

47

48

49

50

51

52

53

54

55

56

57

58

59

60

41
40
39

38

37

36

35

34

33

32

31

30

29

28

27

26

25

24

23

22

21
20
19

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

SDISP= 0.246
30 islands

SDISP= 0.127
17 islands

Panel C: risk-sharing with total capacity 1.4 per agent
84

85

86

87

88

89

90

91

92

93

94

95

96

97

98

99

82
81

80

79

78

77

76

75

74

73

72

71

70

69

68

67

66

10

20

30

40

50

60

70

80

90

100

9

19

29

39

49

59

69

79

89

99

8

18

28

38

48

58

68

78

88

98

7

17

27

37

47

57

67

77

87

97

6

16

26

36

46

56

66

76

86

96

5

15

25

35

45

55

65

75

85

95

4

14

24

34

44

54

64

74

84

94

3

13

23

33

43

53

63

73

83

93

2

12

22

32

42

52

62

72

82

92

1

11

21

31

41

51

61

71

81

91

100

83

65

64

63
62
61

42

43

44

45

46

47

48

49

50

51

52

53

54

55

56

57

58

59

60

41
40
39

38

37

36

35

34

33

32

31

30

29

28

27

26

25

24

23

22

21
20
19

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

SDISP= 0.199
17 islands

SDISP= 0.035
4 islands

Panel D: risk-sharing with total capacity 2 per agent
84

85

86

87

88

89

90

91

92

93

94

95

96

97

98

99

82
81

80

79

78

77

76

75

74

73

72

71

70

69

68

67

66

10

20

30

40

50

60

70

80

90

100

9

19

29

39

49

59

69

79

89

99

8

18

28

38

48

58

68

78

88

98

7

17

27

37

47

57

67

77

87

97

6

16

26

36

46

56

66

76

86

96

5

15

25

35

45

55

65

75

85

95

4

14

24

34

44

54

64

74

84

94

3

13

23

33

43

53

63

73

83

93

2

12

22

32

42

52

62

72

82

92

1

11

21

31

41

51

61

71

81

91

100

83

65

64

63
62
61

42

43

44

45

46

47

48

49

50

51

52

53

54

55

56

57

58

59

60

41
40
39

38

37

36

35

34

33

32

31

30

29

28

27

26

25

24

23

22

21
20
19

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

SDISP= 0.148
13 islands

SDISP= 0
1 island

18

remarkable: for the line, we see substantial color variation re‡ecting imperfect risk-sharing
(SDISP = 24%), while the plane achieves better insurance (SDISP = 12%). As capacities increase, the contrast becomes sharper. In Figure 4C, the per capita capacity in both
networks is assumed to be 1:4, SDISP on the line is still 20%, while on the plane it falls to
3%. Finally, in Figure 4D, when the per capita capacity is 2, dispersion on the line falls to
14% while full risk-sharing is achieved on the plane (SDISP = 0). We conclude that the
asymptotic results of the Proposition provide a good characterization of insurance behavior
in …nite networks and for …nite c as well.

2.4

Geographic networks

If real world networks are similar to the plane, Proposition 2 suggests that they should allow
for reasonably good risk-sharing. However, as Figure 1 illustrates, real-world social networks
have a much less regular structure. Nevertheless, these networks can often be represented in
a way that closely resembles a regular plane, because in the physical map of the community,
households tend to have social connections at close distances and in multiple directions.
Intuitively, if a su¢ ciently accurate representation of this sort does exist, then our results
on good risk-sharing are likely to carry over to real world social networks.
To formally de…ne what makes a representation “su¢ ciently accurate,” we consider (1)
a function

: W ! R2 that maps agents in a social network to locations in R2 ; and (2) a

two dimensional grid that divides R2 into squares of side length A. This pair constitutes an
even representation if the number of households inside each grid cell is uniformly bounded
by positive constants from below and above. The representation is local if geographically
close agents are connected through a path that is also geographically close: for any d > 0
and i and j at geographic distance d ( (i) ; (j))

d, there is a path connecting i and j

such that for all agents h in the path, d ( (i) ; (h)) is bounded from above by a constant
that only depends on d. Finally, the representation exhibits no separating avenues if the
sum of capacities of links between any two neighboring squares is uniformly bounded away
from zero; this is the key condition that guarantees plane-like expansion properties.
A network is called a geographic network if it has a representation that is even, local, and

19

has no separating avenues, and all link capacities are bounded away from zero.14
Corollary 1 In a geographic network, if (P1)-(P5) is satis…ed, then there exist positive constants K 0 and K 00 such that SDISP (x)

K 0 exp

00

K c2=3 for some incentive-compatible

risk-sharing arrangement.
Thus the risk-sharing properties of geographic networks are similar to the plane. The
proof combines Proposition 2 with a renormalization argument. We take a geographic network, and superimpose on its planar representation a grid with A by A squares. We then
merge all people within each square to create a new network. Because of the key no separating avenues condition, this new network is essentially a plane, and hence Proposition 2 (ii)
can be applied to yield a bound for SDISP in the new network. We then pull this bound
back to the old network using the fact that the embedding is even and local.
Geographic networks in practice. We next check whether the Huaraz village network is
a geographic network. Figure 5A shows the natural geographic map of household locations,
referred to as lots, in this village. In Figure 5B the horizontal and vertical coordinates of the
map are re-scaled to …t the community into the unit square, and a grid of 16 squares is also
depicted. As is clear from Figure 5B, this representation is unlikely to satisfy the geographic
networks condition, because there are empty squares and the distribution of agents is quite
heterogeneous. To construct a “geographic” representation of this Huaraz community, we
transform the map using a di¤usion algorithm described in detail in the supplementary
appendix. The basic idea is to stretch the network uniformly over the unit square using
a procedure in which nearby lots “repel” each other and hence lots will tend to escape to
empty spaces. Figures 5C and 5D depict the result after one and …ve rounds of iteration: the
distribution of lots becomes gradually more homogenous. After 23 iterations (Figure 5E),
the distribution of lots is almost completely uniform. Figure 5E also shows the number of
lots in each of the 16 squares, con…rming that we have an even embedding.
To evaluate the key “no separating avenues”condition, Figure 5E also shows the number
14

A geographic network is by assumption in…nite; we de…ne SDISP for these networks as the lim sup of
(2) over a sequence of increasing squares in the map representation. The exact sequence does not matter for
the results.

20

Figure 5: Stretching a real-world network to construct a geographic representation
Panel A: original map of Huaraz community

A.38

A.4

A.39

I.16

I.26

I.11 I.7

J.17
J.12

J.11

A.43

I.10

I.2

I.9
I.8

I.1

I.3 I.4

D.18
D.17D.7
D.6

D.1
D.2

F.32

D.4
D.3

I.25

F.29

H.17

H.19
H.18

F.8 F.9

H.4
H.3

H.12 H.20
H.11
H.21
H.10 H.8H.7

F.36
F.13

F.11

H.6

X.4

E.23 E.24

E.32
E.31
G.3
E.50
G.4
E.35
G.42
E.29
G.49
G.5
G.36
G.50
E.34
G.45
G.7
E.55
G.35
G.9
G.34
G.47
G.40
G.6
G.43
G.39
G.8
G.32
E.28
G.13 G.12G.11
G.15G.14
G.33
G.10
G.31
G.30
G.29
G.27

E.27

E.57
E.56
E.30

E.36
E.25

E.53

E.46
E.26

X.2 X.5

E.54

E.43

E.37

G.28

G.51

X.8

G.25
G.26

G.24

X.7

X.9

Panel B: iteration 0

Panel C: iteration 1
A.1
A.2

A.38

A.4

A.39

D.26
A.44
A.49

I.18
I.17
I.15

I.20

I.21

J.12

I.10

I.4

I.8

I.22

J.9

D.6

I.1

D.1
D.2

F.32
D.3

I.25

C.18

J.7
J.6

J.3 J.2

I.2

F.30

J.1

H.3

F.3
F.4
F.5

F.7

F.28
F.27
H.13
F.25
H.14
F.24
H.15
F.22

C.14
C.13
C.12
C.11
C.10
C.9

F.1

F.10

F.29

H.19
H.18H.17

E.12
E.11
E.9
E.14

H.1

F.14

F.21
F.15

G.17
H.6

E.4
E.5

G.3
G.4

G.22
G.5

E.29

G.36

J.3

B.21

B.15
B.11
B.12
B.13

B.18

H.3
H.1

X.4

E.25

E.37

A.39

A.38

A.4

A.36

A.2

1

A.1

A.34

I.12

I.6

J.10

J.5

I.24

J.1

J.3

H.17

F.14

H.6

E.13

G.39

G.14

E.1

E.24

X.1

E.53
E.25

E.29

E.27

G.43

4

E.43

G.33

G.30

X.9
G.28

G.13

F.3

30

C.2

C.4

13

E.11

13
E.13

E.17

F.15

B.14

13

B.11

B.9

B.12

E.6

E.16

E.22

G.31

E.33

F.18

B.22

B.15

11

28

G.6

G.10

10

G.34

E.27

E.37

G.30

2

E.26

E.53

X.8

X.4

E.1
E.24

E.29

G.43

X.9
G.28

E.46

G.35

19

11

G.8

B.18
B.19

0

E.5

E.23

G.40

G.33

G.32

E.4

6

E.31

G.36

0

B.13

E.49
E.32

8

E.50
G.4

B.21

20

C.9

E.9

E.18

A.14
A.18

B.1

B.6

35

1

A.19

B.5

C.10

7

13

B.8

E.12

F.14

A.45

A.17
A.46

A.21

15

C.12

F.4

E.14

A.12

C.3

13

C.14

F.5

F.20

G.3

G.2

G.39

1

X.7

A.47

A.32
A.22

C.13

F.1

A.9

A.15

C.5

C.11

8

G.5

G.9

X.8
G.29

G.29

7

F.32

F.10

F.21

G.17

11

14

G.14
E.37

G.8

G.10

H.5

G.20

G.21

X.5
G.22

1

H.8

H.21

19

13

A.6

18

A.40

A.23
A.27
C.6

D.2

F.12

X.3

X.2

G.34

G.32

G.31

12

A.1
A.8

A.7

A.33

A.28

C.19

D.3

F.22

H.1

A.2

H.10

H.20

H.6
E.26

G.35

G.40

H.11

X.4
X.6

E.46

G.36
G.6

G.13

E.4

E.5

E.23

E.31

E.50
G.4
G.5

G.9

0

B.19

18

D.1

I.1

F.7
F.27

H.12

B.13

E.16

E.32

G.21
G.22

H.18

B.18

B.12

E.6

E.49

G.3

G.2

E.11

13

F.25

H.3

A.4

C.18

F.24

H.17

3

A.42
A.5

17

D.23

F.28

17

H.19

A.38 A.43

A.34

D.6

F.30

F.29

H.13

H.15

B.15
B.11

E.22

E.33
F.18

20

D.12

I.25

28

A.36

A.31

D.20

I.4

H.14

8

A.39

A.44

I.2

J.1

J.3

B.14

E.17

F.20

G.17

A.35

A.49

22

I.8

I.23

J.6

B.6

E.9

F.15

H.5

X.7

D.14

I.10

12

B.22

F.21

G.20

J.2

B.21

B.9

E.14
E.18

H.21
H.10

B.8

E.12

F.4
F.5

F.12

H.1

H.8
H.11

F.7
F.27
F.22

H.3

E.43

E.37

D.15

I.24

J.7

J.5

B.1

B.5
C.9

X.1

X.2 X.5

E.27

14

I.22

J.10

1

A.14

A.18

C.3
C.2

F.3

F.25
F.24

H.18

C.4

C.12

C.11
C.10

H.15
H.19

C.13

F.1

F.10

F.28

H.12

H.20

F.30

E.25

A.29

I.12

I.6

9

J.4
A.46

A.19

C.14

F.32

I.25
F.29

H.13
H.14

2

D.24

I.15

I.21

J.12

A.17
A.21

C.5

C.18

I.23

J.7
J.6

E.53

I.13

18

10

A.45

A.22
C.6

X.3 X.6

X.8

D.26

I.20

A.47

A.32

A.23

D.3

I.1
I.4

B.19
E.1

E.4
E.5

X.4

E.26

E.29

D.13

C.19

D.2

I.8

I.16

I.17

J.9

A.12

A.15

D.1

D.6

I.2

I.10

I.22

J.15

A.9

A.33
A.28
A.27

D.13

J.9

J.4

13

A.6
A.7

A.29

D.23
D.14

I.21

A.40

A.31
D.20

D.12

D.15

J.2

A.8

I.13

I.15

J.12

A.5

A.43
A.42

A.35

B.18

B.12
B.13

Panel E: iteration 23
I.18

I.17

E.46

E.50

X.9

A.44

A.49

B.22

B.11

E.23 E.24

G.28

D.24

B.21

B.14

E.49

E.32

X.7

D.26

B.1

B.15

E.31

G.3
G.4

G.36
G.35
G.34
G.40
G.6
G.43
G.39
G.8
G.32
G.33
G.10
G.31
G.30
G.29

G.14
G.13

A.18 A.14

B.5
B.6

E.6

E.22
E.33

F.18

G.2

G.5

Panel D: iteration 5

I.20

G.20

G.22

X.8

J.15

F.15

G.9

X.9

I.16

F.14

F.21
G.17

G.21

X.2X.5

E.13
E.16
E.18
E.17

F.12

A.19

B.9

E.12
E.9E.11
E.14

A.17

A.21

C.4
C.3
C.2

B.8

F.4
F.5

F.7

F.20

H.6
X.1

X.6
X.3

G.28

I.18

F.10

F.28
F.27

F.22

H.12H.20H.11
H.21H.10 H.8

E.43

G.29

F.24

H.19H.18H.17

E.1

F.25

A.45

A.46

A.22

C.14
C.13
C.12
F.1
C.11
C.10
C.9
F.3

H.13
H.14
H.15

A.12

A.47

A.15
A.32

C.6
C.5

C.18

F.29

J.1

A.33

A.23

C.19

D.3

F.30

J.2

B.22

E.27

G.35
G.9
G.34
G.40
G.6
G.43
G.39
G.8
G.32
G.33
G.10
G.31
G.30

G.14
G.13

E.46
E.26

E.53

F.32
I.25

B.14

E.23E.24

E.32
E.31
E.50

G.2

D.2

I.1

I.23

J.7

H.5

E.49

D.1

D.6

I.4

I.8

I.24

J.10

A.42

A.31
A.29
A.28
A.27

D.23

A.9

A.7

A.40

D.13

I.2

I.10
I.22

J.9

J.5

D.15
D.14

I.6

J.12

J.4

A.43

D.20
D.12

I.12

E.22

E.33

F.20
F.18

G.20
G.21

A.46

B.19

H.12
H.11
H.21
H.20
H.10H.8

A.35A.34

D.24
I.13

I.21

A.47 A.45

J.6
B.1
B.5
B.6

B.8
B.9

E.6

E.13
E.16
E.18
E.17

F.12

H.5

I.18
I.17
I.15

I.20

A.12
J.15

I.23
I.24
J.10

J.5

J.4

A.40

A.31
A.29
A.15
A.28
A.27 A.33
A.32
C.19 A.23
A.22 A.17
A.21
C.6
C.5
C.4 A.19
C.3 A.18 A.14
C.2

D.23

A.6

D.26
A.49A.44

A.43
A.42

D.20
D.12
D.15
D.14D.13

I.6

A.8

A.5
A.36

I.16

A.7

D.24

I.13
I.12

J.15

A.4

A.39

A.9

A.6

A.35
A.34

A.2A.1

A.38
A.8

A.5

A.36
I.16

X.1

X.3 X.6

E.52

G.2

G.22

G.23

B.22

E.33

F.20
F.18

G.21

E.45

E.39 E.22
E.20
E.21
E.49

F.15

G.20

B.1
B.2
B.21
B.3
B.5
B.6
B.14
B.7
B.8
B.9
B.10 B.15
B.16
B.11
B.12
B.18
B.13
E.6
B.17
B.19
E.51
B.20
E.3
B.23
E.1
E.4
E.2
E.5

E.40

F.14

F.21

G.44
G.17

A.46

A.48

E.12 E.9 E.11
E.10
E.14

E.13
E.16
E.18
E.17

F.12

H.2
H.1
H.5

F.2
F.3
F.4
F.5
F.6

F.7

F.28
F.27
F.25F.26
F.24
F.35
F.23
F.22

H.13
H.14

H.15
H.16

F.10

F.31
F.34

F.33

A.12

A.45

A.47

C.18
C.17
C.16
C.14
C.13
C.20
C.12
C.11
F.1
C.10
C.9

F.30

J.1

A.11

A.41

A.50
A.31
A.29
A.16A.15
A.28
A.33
A.27
A.25
A.32
A.24
C.8
A.23
C.19
A.22
A.17
C.7
A.21
C.6
A.20
C.5
A.19
C.4
A.18
C.3
A.14
C.2

D.5
D.23

J.7

J.18J.19

A.42

A.40

D.9
D.10

A.8

A.10

A.7

D.8

D.11 D.19
D.13

I.24I.23
J.10
J.6

J.2

J.3

A.44
A.49

D.20
D.12
D.16 D.15
D.14

I.6 I.5

I.22

J.8 J.9

J.5

J.4

A.37

A.35
A.34

A.9

A.6

D.24
I.12

I.21

J.13

D.21

D.22

D.25

I.19
I.18
I.17
I.15 I.14
I.13

I.20

J.16
J.15

J.14

D.26

A.1
A.2
A.3

A.5

A.36

I.27

4

E.43

E.25

X.1

X.6

X.3

9
X.2

4
X.5

X.7

8

3

21
)

of links crossing the sides of each square.15 The agreement with our theoretical condition is
very good: except for one side of the square in the lower right corner, there are no separating
avenues between any two neighboring squares. To better understand what drives the success
of this embedding, note that in Figure 5E each of the 16 squares is di¤erently colored, and
the corresponding households are represented by the same colors in panels A to D as well. In
the original image (Figure 5A), households are geographically concentrated by color; hence
the reason why the Huaraz network has similar expansion properties as the plane is that
households tend to have friends in multiple directions at close distance in the original map.
Numerical simulations suggest that the Huaraz social network in fact behaves very much
like the plane network. We use simulations to calculate SDISP for uniform shocks with
support [ 1; 1] and per capita capacities 1, 1:4 and 2. We obtain SDISP equal to 0:20, 0:11
and 0:02, respectively, which tracks the rapid decline of SDISP on the plane.
The …nding that the Huaraz community is a “geographic network”in part because connections are correlated with physical distance suggests that village networks in developing
countries may be similarly expansive. Our results then imply that typical village networks
should facilitate high, although imperfect, levels of informal risk-sharing –a result consistent
with the empirical …ndings of Townsend (1994), Ogaki and Zhang (2001), Mazzocco (2007)
and others.

2.5

Risk-sharing ability of a group

One commonly used approach to testing full risk-sharing in the data is to regress the consumption of an individual or a group on their own endowment and a community-wide shock.
A variant of this regression when there is no aggregate uncertainty is
xF =

+

eF + "

where consumption in F is regressed on the endowment shock of F . Equal sharing implies
= 0; this corresponds to the test of full risk-sharing used in Cochrane (1991), Mace
15
Opposing sides of the large square are assumed to be geographically next to each other, generating the
topology of a torus.

22

(1991), Townsend (1994) and others. When

6= 0, equal sharing is rejected; however, small

magnitudes of the coe¢ cient can be interpreted to mean that agents in F share their risk with
the rest of the community reasonably well. The following result supports this interpretation.
Proposition 3 We can bound the regression coe¢ cient
1

c [F ]

as

:

F

This lower bound is a function of the perimeter c [F ] relative to the standard deviation
of the community-speci…c shock

F.

The intuition is familiar: when the perimeter of a set

is small, much of the idiosyncratic shock is trapped inside F , resulting in higher correlation.
The Proposition is related to Townsend’s (1994) …nding that there is considerable risk-sharing
within, but only limited sharing across villages, as well as Rosenzweig and Stark (1989) who
show that Indian households try to create cross-village family links through marriage. Our
results are consistent with these facts if cross-village network ties are relatively weaker.

3

Constrained e¢ cient risk-sharing

In this section, we study constrained e¢ cient arrangements which are Pareto-optimal given
the enforcement constraints imposed by the network. Such second-best arrangements are a
natural benchmark because they achieve the highest possible level of risk-sharing in a given
network. As we show below, foundations for these arrangements include both simple rules
of thumb and dynamic coalitional bargaining.

3.1

Risk-sharing islands

Our main result is that constrained-e¢ cient insurance arrangements exhibit an “island structure.”For every realization of endowments, connected islands of agents emerge endogenously,
such that risk-sharing is perfect within each island, while links between di¤erent islands are
“blocked” in the sense that transfers equal the link capacities. This result follows from the
equivalence between constrained e¢ cient arrangements and a planner’s problem formalized
below.
23

The intuition for islands can be seen by focusing on a utilitarian social planner who
maximizes average expected utility. Whenever two agents consume di¤erent amounts, this
planner can increase welfare by shifting a small amount from the agent with higher- to the
one with lower consumption. But in the optimum, such shifts must violate the enforcement
constraints. Hence linked agents either consume the same amount and belong to the same
“island”, or consume di¤erent amounts and are connected by a blocked link that does not
allow for further transfers. Panels B-D of Figure 4 depict constrained e¢ cient allocations
corresponding to such a social planner: islands within which consumption is equalized are
indicated by di¤erent colors.
For a formal analysis, let ( i ) be a set of positive weights, and de…ne the planner’s problem
as
max
(t)

X

i

EUi (xi )

(3)

i2W

subject to the constraint that all transfers respect the capacity constraints of the social
network.
Proposition 4 Every constrained e¢ cient risk-sharing arrangement is the solution to a
planner’s problem with some set of weights ( i ). Conversely, any solution to the planner’s
problem is constrained e¢ cient.
Wilson (1968) establishes a similar equivalence result for risk-sharing in syndicates. His
proof builds on the convexity of the set of possible payo¤ vectors. Since an e¢ cient allocation
must lie on the boundary of this set, convexity implies the existence of a tangent hyperplane
with some normal vector ( i ). Maximizing a planner’s problem with these

i

weights will then

select the e¢ cient allocation. Adapting this argument to our model requires that the set of
coalition-proof payo¤ vectors be convex. This is straightforward given the perfect substitutes
speci…cation: when two transfers satisfy a capacity constraint, their convex combination will
also satisfy it.16 The formal proof is provided in Appendix A.
P
Observe that maximizing the planner’s expected utility E
i Ui is equivalent to maxP
imizing realized utility
i Ui independently for each state. This yields a set of intuitive
16

See section 4 for extending this result to imperfect substitutes.

24

…rst-order conditions for each realization. To state these conditions, recall that a link from
i to j is blocked in a given realization if tij = c (i; j), i.e., if the link is used at full capacity.
Proposition 5 An incentive-compatible arrangement (tij ) is constrained e¢ cient if and only
if there exist positive weights ( i )i2W such that for every i; j 2 W one of the following
conditions hold:
1)

0
i Ui (xi )

=

0
j Uj (xj )

2)

0
i Ui (xi )

>

0
j Uj (xj )

and the link from j to i is blocked

3)

0
i Ui (xi )

<

0
j Uj (xj )

and the link from i to j is blocked.

This result generalizes our earlier intuition for arbitrary welfare weights. Su¢ ciency
and uniqueness of the …rst-order conditions follow from the strict concavity of the planner’s
objective function and the convexity of the domain. The Proposition also implies that for
any pair of agents i and j, if

0
i Ui

<

0
j Uj ,

then along every all path connecting i and j, at

least one link must be blocked. Therefore, in any realization agents can be partitioned into
connected risk-sharing islands such that within an island agents share risk perfectly, while
cross-island insurance is limited because boundary links operate at full capacity.
Proposition 6 [Risk-sharing islands] In any realization (ei ) the set of agents can be partitioned into connected components Wk such that

0
i Ui

=

0
j Uj

if i; j 2 Wk , and jtij j = c (i; j)

if i 2 Wk ; j 2
= Wk .
Sharing islands partition the network in each realization. Using the coalitional interpretation, these islands can be thought of in terms of “almost-deviating coalitions.” For
example, if all links on the boundary of an island are blocked in the outward direction,
then members of this are transferring the highest amount they can credibly pledge to the
community, and hence are indi¤erent to deviating as a coalition. More generally, it can be
shown that the island decomposition obtains by splitting the network along the boundaries
of all almost-deviating coalitions. In e¤ect, almost deviating coalitions act as “bottleneck
groups”limiting the ‡ow of resources in a way parallel to the bottleneck agents emphasized
in Bloch et al. (2008). The emergence of network-based risk-pooling islands is consistent

25

with evidence documented by Attanasio et al. (2009) that about the importance of social
ties in the formation of insurance groups in Colombian villages.
When link capacities increase, the planner becomes less constrained and risk-sharing
islands tend to grow in size. This is illustrated by Figure 4, panels B to D. In Figure 4B,
where per capita capacity is one, insurance is fairly local: there are 30 islands on the line
and 17 on the plane. As the per capita capacity goes up to 1:4, in Figure 4C there are 17
islands on the line and only 4 on the plane; and in Figure 4D where average capacity is 2
per agent, there are 13 islands on the line and just one, fully insured island on the plane. In
these simulations, the number of islands closely tracks the degree of insurance.
As is clear from Figure 4, in the island partition the size and location of islands, and hence
the set of agents who fully share each others’shocks, is endogenous to the realization and
the network. This result di¤erentiates our model from group-based models of risk-sharing,
where insurance groups are exogenous and do not vary with the realization.

3.2

Spillover e¤ects and local sharing

The island result also helps us characterize how shocks propagate in the network as a function
of social distance. We show that shocks are shared to a greater degree with socially close
agents, and hence network-based insurance is local: the consumption of socially close agents
comoves more strongly than that of socially distant ones.
To formalize this point, we must introduce a slightly stronger de…nition of risk-sharing
islands. Fix an endowment realization (ei ), and let W (i) denote the sharing island containing
c (i) to be the maximal connected set of agents j such
i as de…ned above. We now de…ne W

that there exists a path between i and j along which no links are blocked in either direction.
c (i)
With this de…nition, W

W (i), because Proposition 6 implies that links connecting

di¤erent islands are all blocked. Except for knife-edge cases when the transfer amount just
reaches the capacity over a link but does not “bind”yet, the two de…nitions are equivalent:
c (i) = W (i). It can be shown that these knife-edge cases have zero probability when the
W

distribution of shocks is absolutely continuous, and hence the two de…nitions can be treated
as equivalent for practical purposes.
We now explore the e¤ects of an idiosyncratic shock to one agent’s endowment on the
26

consumption of others. Fix a constrained e¢ cient arrangement, and consider two realizations
e = (ei ) and e0 = (e0i ), where e0i < ei for some i but e0j = ej for all others j 6= i. E¤ectively,
agent i is experiencing an idiosyncratic negative shock in e0 relative to e (or a positive shock
like aid in e relative to e0 ). We can measure the impact of this negative shock on another
agent j by computing the ratio of marginal utilities of j before and after the shock. Formally,
let x and x0 denote the consumption vectors associated with e and e0 , then we can de…ne
M U Cj =

Uj0 (x0 )
Uj0 (x)

which measures the marginal utility cost of the shock for agent j. A larger M U Cj corresponds
to a higher increase in marginal utility and hence a greater consumption drop.
Proposition 7 [Spillovers and local sharing] In any second best arrangement x:
(i) [Monotonicity] xj (e0 )

c (i) then xj (e0 ) < xj (e).
xj (e) for all j, and if j 2 W

(ii) [Local sharing] There exists

> 0 such that jei

c (i), and xj (e0 ) = xj (e) for all j 2 W nW (i):
for all j 2 W

e0i j <

implies M U Ci = M U Cj

(iii) [More sharing with close friends] For any j 6= i, there exists a path i ! j such that

for any agent l along the path, M U Cl

M U Cj .

Part (i) shows that spillovers are monotone: If one agent receives a negative shock,
the consumption of everybody else either decreases or remains constant. Moreover, the
agent is partially insured by all others in the same risk-sharing island, who all reduce their
consumption by a positive amount. Thus unless i is in a singleton island, he has access to at
c (i) are not blocked, and hence all members
least some insurance. Intuitively, links within W

of the island can help out a little. As part (ii) shows, for small shocks, the set of agents
c (i). All these agents share an equal burden measured in terms of
who insure i is exactly W

the marginal utility cost M U C. Agents outside of W (i) do not reduce their consumption
at all.17 Finally, (iii) shows how the utility cost of agents varies by social distance. Indirect
friends provide less insurance to i than direct friends: for any agent j 6= i, there exists some
direct friend of i, denoted l, who shares at least as much of the burden of the shock as j
does.
17

c (i) 6= W (i), agents in W (i) nW
c (i) may or may not share.
In the knife edge case where W

27

Marginal utility cost of shock (MUC)

Figure 6: Utility cost of shocks to direct and indirect friends

Agent
with
shock (i)
Direct friend ( j)

Indirect friend ( j)

Size of shock measured by utility cost to i

The results of Proposition 7 are summarized in Figure 6, which shows the marginal
utility cost of direct and indirect friends in response to a shock to i. The horizontal axis
is the marginal utility cost of i himself while the vertical axis measures the M U C of direct
and indirect friends. For small shocks, both direct and indirect friends in the same island
help out. As the size of the shock grows, some indirect friends hit their capacity constraints
(dotted line), but some direct friends continue to help (heavy line). After a point, all direct
friends hit their capacity constraints and additional increases in the shock are fully borne
by agent i. These implications can be used to test our model against other theories of
limited risk-sharing, which do not predict variation in the degree of insurance as a function
of network distance.
The results of Proposition 7 are consistent with the empirical …ndings in Angelucci and
De Giorgi (2009), who show that Progresa, a conditional cash transfer program in rural
Mexico, leads to an increase in the consumption of the non-treated, which they attribute
to the spillover e¤ect of aid through the social network of the village. This is the logic of
part (i) in the Proposition. Angelucci et al. (2008) also show that much of the increase in
the consumption of the non-treated is due to the consumption increase of households who
are relatives of the treated, consistent with (ii) and (iii). The agreement between our results
28

and existing evidence suggests that a calibrating our model may be useful for quantifying
the welfare e¤ects of development aid taking into account network-based spillovers.

3.3

Foundations for constrained e¢ ciency

We now brie‡y discuss two intuitive dynamic mechanisms that provide foundations for constrained e¢ ciency. The supplementary appendix contains the corresponding formal results.
First consider a decentralized procedure where agents use a simple rule of thumb in helping those who are in need. In every round, agents attempt to equate weighted marginal
utilities between neighbors subject to the capacity constraints: intuitively, people help out
less fortunate friends. This procedure converges to the constrained e¢ cient allocation corresponding to the welfare weights used. In particular, constrained e¢ ciency can emerge even
if in every transaction agents only use local information about the current resources of the
parties involved.18
A second mechanism is collective dynamic bargaining with renegotiation. Gomes (2000)
shows that when agents can propose renegotiable arrangements to subgroups and make sidepayments in a dynamic bargaining procedure, ultimately a Pareto-e¢ cient arrangement will
be selected.19 This result can be incorporated in our model by assuming that there is a
negotiations phase prior to the endowment realization, and would imply that agents select
a constrained e¢ cient risk-sharing arrangement.
We also note that constrained e¢ cient arrangements are particularly stable in that they
are also robust to ex ante coalitional deviations, not just ex post ones.

4

Discussion: General preferences

This section discusses how our results extend when goods and friendship are imperfect substitutes. Formal statements and proofs are presented in the supplementary appendix, here
we only summarize our …ndings.
18

Bramoulle and Kranton (2006) use a similar procedure with equal welfare weights and no capacity
constraints.
19
Aghion, Antras and Helpman (2007) establish a similar result in a model involving renegotiating freetrade agreements.

29

With a general utility function U (x; c), the de…nition of incentive compatibility (IC) of
a transfer arrangement is the following:
De…nition 2 A risk-sharing arrangement t is incentive compatible (IC for short) if
Ui (xi ; ci )

Ui (xi + tij ; ci

c (i; j))

(4)

for all i and j, for all realizations of uncertainty.
Our key tool is a pair of necessary and su¢ cient conditions for incentive compatibility
with imperfect substitutes. To derive these, de…ne the marginal rate of substitution (MRS)
between good and friendship consumption as M RSi = (@Ui =@ci ) = (@Ui =@xi ). We say that
the MRS is uniformly bounded if there exist positive constants m < M such that m
M RSi

M for all i, xi and ci .

When the MRS is uniformly bounded, (i) any IC arrangement must satisfy tij
c (i; j), and (ii) any arrangement that satis…es tij

M

m c (i; j) must be IC. The intuition is

that the MRS measures the relative price of goods and friendship. If this relative price is
always between m and M , then a transfer exceeding M c (i; j) is always worth more than the
link and hence never IC, but a transfer below mc (i; j) is always worth less than the link and
hence is IC. With perfect substitutes M RSi = 1, so we can set m = M = 1, which yields
Theorem 1.

4.1

The limits to risk-sharing with imperfect substitutes

With imperfect substitutes, the results in section 2 extend but the upper and lower bounds
on risk-sharing are weakened by constant factors that depend on the degree of substitution.
To obtain these extensions, we assume that the marginal rate of substitution (MRS) is
uniformly bounded. We continue to …nd that the …rst-best can only be achieved in highly
expansive graphs where the perimeter-area ratio is bounded from below: we require a [F ]
=M . Our …ndings about partial risk-sharing are about rates of convergence and hence they
extend without modi…cation; in particular, SDISP converges exponentially for geographic
networks.
30

Imperfect substitution also yields additional implications. If the M RS is increasing
in consumption, then agents with low consumption value their friends less, reducing the
maximum amount they are willing to give up. As a result, if in a society that experiences
a negative aggregate shock, the scope for insuring idiosyncratic risk is reduced. We show
that reducing the endowments of all agents results in a smaller set of incentive compatible
transfer arrangements, and hence an increase in SDISP . The aggregate negative shock
is thus a double burden: besides its direct negative e¤ect on consumption, it also induces
worse sharing of idiosyncratic risks, a …nding consistent with Kazianga and Udry (2006), who
document limited informal insurance during the severe draught of 1981-85 in rural Burkina
Faso.

4.2

Constrained e¢ cient arrangements

The key novelty with imperfect substitutes is that changing the goods consumption of an
agent a¤ects his implied link values and hence incentive compatibility. To characterize constrained e¢ ciency, we assume that the marginal rate of substitution M RSi de…ned above is
concave in xi . When this holds, we can generalize Proposition 4, establishing the equivalence
between constrained e¢ ciency and the planner’s problem.
To develop …rst order conditions, we next analyze the e¤ect of an additional dollar to
agent i on the planner’s objective. With imperfect substitutes, this marginal welfare gain
is no longer equal to

i

times the marginal utility of i, because increased consumption also

softens enforcement constraints. The planner may wish to use these softer constraints and
transfer some of the original dollar to neighboring agents. To formalize this, we de…ne the
marginal social gain of an additional unit of transfer to i using an iterative procedure, which
takes into account the indirect e¤ect of softening constraints.
Using the concept of marginal social gain allows us to extend the characterization of
constrained e¢ cient agreements in Proposition 5. Given this result, we can also partition
the network into endogenous risk-sharing islands, such that marginal social utility is equalized
within islands, and all links connecting the island to the rest of the community are blocked.
Finally, for an agent i who is not on the boundary of his risk-sharing island and hence
has no links with binding constraints, the marginal social gain does equal
31

i

times his

marginal utility of consumption; hence, for such agents, the results of section 3 hold without
modi…cation. For example, weighted marginal utilities are equalized for any two such agents
in the same risk-sharing island. Thus if risk-sharing islands are “large”, then the results
from the perfect substitutes case hold without modi…cation for most agents.

5

Conclusion

This paper showed that the expansiveness of a social network determines the e¤ectiveness of
informal risk-sharing. We found that many real-life social networks are likely to be su¢ ciently
expansive to allow for good risk-sharing. We also characterized Pareto-optimal arrangements
and found that resources are shared among local groups.
In future work, we would like to develop a dynamic extension of our model, where the
value of a social link is partly derived from the present value of future insurance bene…ts
in the network. In such a model the values of social links, the network structure, and the
risk-sharing agreement would all be endogenized.
We also plan to extend our empirical analysis. Our model is su¢ ciently tractable that it
can be used to estimate the strength of di¤erent types of links from social network and consumption data. Such estimates could be used for policy experiments, such as (i) measuring
the welfare e¤ects of development aid, taking into account network spillovers; or (ii) comparing the network structure of communities with di¤erent degrees of ethnic heterogeneity,
and exploring the implications for informal insurance.

References
Aghion, Philippe, Pol Antras, and Elhanan Helpman, “Negotiating Free Trade,”
Journal of International Economics, September 2007, 73 (1), 1–30.
Ali, Nageeb and David Miller, “Enforcing Cooperation in Networked Societies,”Working
paper, UC San Diego, 2008.

32

Ambrus, Attila, Markus Mobius, and Adam Szeidl, “Supplementary Material to:
"Consumption Risk-sharing in Social Networks",” available online at http://www.
socialcollateral.org/risksharing/supplementary_appendix.pdf January 2010.
Angelucci, Manuela and Giacomo De Giorgi, “Indirect E¤ects of an Aid Program: How
do Cash Injections A¤ect Non-Eligibles’Consumption?,” American Economic Review,
March 2009, 99 (1), 486–508.
, Giacomo De Giorgi, Marcos Rangel, and Imran Rasul, “Insurance in the
Extended Family,”Working paper, University of Arizona, 2008.
Attanasio, Orazio, Abigail Barr, Juan Camilo Cardenasy, Garance Genicot, and
Costas Meghir, “Risk Pooling, Risk Preferences, and Social Networks,” working paper, UCL Department of Economics August 2009.
Bernheim, B. Douglas, Bezalel Peleg, and Michael D. Whinston, “Coalition-Proof
Nash Equilibria I. Concepts,”Journal of Economic Theory, 1987, pp. 1–12.
Bloch, Francis, Garance Genicot, and Debraj Ray, “Informal Insurance in Social
Networks,”Journal of Economic Theory, 2008, 143 (1), 36–58.
Bramoulle, Yann and Rachel E. Kranton, “Risk-Sharing Networks,” Journal of Economic Behavior and Organization, 2006, forthcoming.
Coate, S. and M. Ravaillon, “Reciprocity Without Commitment: Characterization and
Performance of Informal Insurance Arrangements,”Journal of Development Economics,
1993, 40, 1–24.
Cochrane, John H., “A Simple Test of Consumption Insurance,” Journal of Political
Economy, 1991, 99 (5), 957–976.
Cormen, Thomas H., Charles E. Leiserson, Ronald L. Rivest, and Cli¤ord Stein,
Introduction to Algorithms, Cambridge, MA: MIT Press, 2001.
De Weerdt, Joachim and Stefan Dercon, “Risk-sharing networks and insurance against
illness,”Journal of Development Economics, December 2006, 81 (2), 337–356.
Dixit, Avinash, “Trade Expansion and Contract Enforcement,”Journal of Political Economy, 2003, 111, 1293–1317.
Edmonds, Jack and Richard M. Karp, “Theoretical improvements in algorithmic e¢ ½
ciency for network ‡ow problems,”Journal of the ACM, 1972, 19 (2), 248U264.
33

Ellison, Glenn, “Cooperation in the Prisoner’s Dilemma with Anonymous Random Matching,”Review of Economic Studies, 1994, 61, 567–588.
Fafchamps, Marcel and Flore Gubert, “Risk Sharing and Network Formation,”American Economic Review Papers and Proceedings, 2007, 97 (2).
and Susan Lund, “Risk-Sharing Networks in Rural Philippines,” Journal of Development Economics, 2003, 71, 261 –287.
Fehr, Ernst and Simon Gachter, “Cooperation and Punishment in Public Goods Experiments,”American Economic Review, September 2000, 90 (4), 980–994.
Ford, Lester Randolph and Delbert Ray Fulkerson, “Maximal Flow Through a Network,”Canadian Journal of Mathematics, 1956, 8, 399–404.
Gomes, Armando R., “Externalities and Renegotiations in Three-Player Coalitional Bargaining,” Technical Report PIER Working Paper No. 01-028, Washington University,
St. Louis 2000.
Greif, Avner, “Contract Enforceability and Economic Institutions in Early Trade: The
Maghribi Traders’Coalition,”American Economic Review, 1993, 83, 525–548.
Kandori, Michihiro, “Social Norms and Community Enforcement,” Review of Economic
Studies, 1992, 59, 63–80.
Karlan, Dean, Markus Mobius, Tanya Rosenblat, and Adam Szeidl, “Trust and
Social Collateral,”forthcoming in the Quarterly Journal of Economics, November 2009,
124 (4).
Kazianga, Harounan and Christopher Udry, “Consumption smoothing? Livestock,
insurance and drought in rural Burkina Faso,” Journal of Development Economics,
April 2006, 79 (2), 413–446.
Kocherlakota, Narayana, “Implications of E¢ cient Risk Sharing without Commitment,”
Review of Economic Studies, 1996, 63 (4), 595–609.
Kranton, Rachel E., “Reciprocal Exchange: A Self-Sustaining System,” American Economic Review, 1996, 86, 830–851.
Ligon, Ethan, “Risk-sharing and Information in Village Ecocomies,” Review of Economic
Studies, 1998, 65, 847–864.
, J. P. Thomas, and T. Worrall, “Informal Insurance Arrangements with Limited
34

Commitment: Theory and Evidence from Village Economies,” Review of Economic
Studies, 2002, 69 (1), 209–244.
Mace, Barbara J, “Full insurance in the presence of aggregate uncertainty.,” Journal of
½
Political Economy, 1991, 99, 928U956.
Mazzocco, Maurizio, “Household Intertemporal Behavior: a Collective Characterization
and a Test of Commitment,”Review of Economic Studies, July 2007, 74 (3), 857–895.
Milgrom, Paul and Chris Shannon, “Monotone Comparative Statics,” Econometrica,
January 1994, 62 (1), 157–80.
Ogaki, Masao and Qiang Zhang, “Deceasing Relative Risk Aversion and Tests of Risk
Sharing,”Econometrica, March 2001, 69 (2), 515–526.
Rosenzweig, Mark R. and Oded Stark, “Consumption Smoothing, Migration, and
Marriage: Evidence from Rural India,”Journal of Political Economy, August 1989, 97
(4), 905–26.
Townsend, Robert, “Risk and Insurance in Village India,” Econometrica, May 1994, 62
(3), 539–591.
Udry, Chris, “Risk and Insurance in a Rural Credit Market: An Empirical Investigation
in Northern Nigeria,”Review of Economic Studies, 1994, 61 (3), 495–526.
Wilson, Robert, “The Theory of Syndicates,” Econometrica, January 1968, 36 (1), 119–
132.

Appendix A: Proofs
Proof of Theorem 1
The theorem can be generalized to the case where links in the network are directed, so
that c (i; j) and c (j; i) may di¤er. In that environment, coalition proofness now requires that
eF
where cout [F ] =

P

i2F;j 2F
=

cout [F ]

xF

(5)

c(i; j) is the maximum amount that agents in F are willing to give

to the outside community. Here we present a proof of this more general result. Su¢ ciency

35

follows from the discussion in the text. To prove necessity, let gi = ei xi the amount
P
that i has to transfer away, and let gF = i2F ei for any subset of agents F . Note that
gW = 0 by eW = xW . Let U be the set of agents for whom gi

0 and let D = W nU .

De…ne the auxiliary graph G0 which has two additional vertices, s and t, and additional
edges connecting s with all agents in U , and additional edges connecting t with all agents in
D. For any i 2 U , de…ne the capacity c (s; i) = gi and c (i; s) = 0. Similarly, for any j 2 D,
let c (j; t) =

gj and c (t; j) = 0.

The auxiliary graph is useful, because implementing the desired consumption allocation
with a transfer scheme that meets the capacity constraints is equivalent to …nding an s ! t
P
‡ow in G0 that has value gU = gi 0 gi . To see why, note that in the desired allocation,

exactly gi must leave each agent i 2 U . The capacities on the new links ensure that in any
s ! t ‡ow, at most gi can leave agent i. Similarly, to implement the target, exactly

gj

must ‡ow to each agent j 2 D, and the capacity on the (j; t) link ensures that this is the
P
maximum that can ‡ow to j. As a result, any ‡ow with value gi 0 gi must, by construction,
take exactly gi away from i and deliver exactly gj to j.

We have reduced our implementation problem to a ‡ow problem. To compute the maximum s ! t ‡ow, we instead compute the value of the minimum cut. Fix a minimum cut,
let S be the set of agents in W that are still connected to s after the cut, and let T = W nS.
Clearly, if we consider the restriction of the cut to the original network G, there will be no
surviving paths connecting some agent in S with some other agent in T .
Let U1
let D1

U denote those agents whose link with s is cut in the minimum cut of G0 , and

D denote those in D whose link with t is cut. Let U2 = U nU1 and D2 = DnD1

be the sets of agents whose link with s respectively t remains; then U2

S and D2

T,

because otherwise there would be surviving path in G0 connecting s and t after the cut. This
also implies that gS

gU2 + gD1 , because
gS = gS\U + gS\D

where we used that gi

gU2 + (gD

gD2 ) = gU2 + gD1

0 when i is in U and negative when i is in D.

36

(6)

The value of the cut in G0 can be bounded as
cut value

gU1

gD1 + cout [S]

where the …rst two terms count the total capacity of links with s and t that have been
deleted, and the …nal term is a lower bound for links deleted from the original network G.
By assumption (5), cout [S]
cut value

xS = gS , and using (6) we obtain

eS
gU1

gD1 + gU2 + gD1 = gU1 + gU2 = gU :

It follows that the value of the maximum ‡ow is at least gU , as desired.
Proof of Proposition 4
We prove the following more general result.
Suppose that the M RSi = (@Ui =@ci )=(@Ui =@xi ) is concave in xi for every i. Then every
constrained e¢ cient arrangement is the solution to a planner’s problem with some set of
weights ( i ), and conversely, any solution to the planner’s problem is constrained e¢ cient.
Proof. Let U

RW be the set of expected utility pro…les that can be achieved by IC

transfer arrangements: U = f(vi )i2W j9 IC allocation x such that vi

EUi (xi ; ci ) 8ig. Our

goal is to show that U is convex. By concave utility, it su¢ ces to prove that the set of IC
arrangements is convex.
To show that the convex combination of IC arrangements is IC, …x an endowment realization e and let x be an IC allocation. Consider an agent i, and for r

0 de…ne y (r; xi ) to

be the consumption level that makes i indi¤erent between his current allocation and reducing friendship consumption by r units, that is, U (xi ; ci ) = U (y (r; xi ) ; ci
values of r, the locations (y (r; xi ) ; c

r). For di¤erent

r) trace out an indi¤erence curve of i. Note that

y (0; xi ) = xi and that the IC constraint for the transfer between i and j can be written as
tij
since y (c (i; j) ; xi )

y (c (i; j) ; xi )

xi

(7)

xi is the dollar gain that makes i accept losing the friendship with j.

37

Moreover, the implicit function theorem implies that
yr (r; xi ) =

Uc
(y; ci
Ux

(8)

r)

which is the marginal rate of substitution M RSi . This is intuitive: M RSi measures the
dollar value of a marginal change in friendship consumption. Using the concavity of the
MRS, we will show that y (r; xi ) is a concave function in xi for any r

0. When r = c (i; j),

this implies that the convex combination of IC allocations also satis…es the IC constraint
(7), and consequently, that the set of IC pro…les is convex.
To show that y (r; xi ) is concave in xi , let x1 , x2 be two IC allocations, and let x3i =
x1i + (1
(y (r) ; ci

) x2i for some 0

y (r; x1i ) + (1

1. De…ne y (r) =

) y (r; x2i ), so that

r) traces out the convex combination of the indi¤erence curves passing through

(x1i ; ci ) and (x2i ; ci ), and let f (r) = U (y (r) ; ci

r), the utility of agent i along this curve.

Clearly, f (0) = U (x3 ; ci ). Moreover, using (8),
f 0 (r) = Ux (y (r) ; ci

r)

Ux (y (r) ; ci

r)

Uc
y r; x1i ; ci
Ux
Uc
(y (r) ; ci
Ux

r)

r + (1

)

Uc (y (r) ; ci

Uc
y r; x2i ; ci
Ux

r

Uc (y (r) ; ci

r) = 0

where we used the assumption that Uc =Ux is concave in the …rst argument. It follows that f
is nonincreasing, and in particular f (r)
which implies that y (x3i ; r)

f (0) or equivalently U (y (r) ; ci

y (r) = y (r; x1i ) + (1

r)

U (x3i ; ci ),

) y (r; x2i ), and hence that y (x; r) is

concave.
Finally, let P (U ) denote the Pareto-frontier of U . Since U is convex, the supporting
hyperplane theorem implies that for every u0 2 P (U ) there exist positive weights i such
P
that u0 2 arg maxU
i i ui , as desired. The converse statement in the proposition holds
for any U .

38

r)

Appendix B: Data
Dean Karlan, Markus Mobius and Tanya Rosenblat conducted a survey in November 2006
in a rural village close to Huaraz (Peru). The heads of households and spouses (if available)
of 223 households were interviewed. The survey consisted of two components: a household
survey and a social network survey. The household survey recorded a list of all members of
the household and basic demographic characteristics including gender, education, occupation
and income.
The social network component of the survey asked the head of household and the spouse
to list up to 10 non-relatives in the community with whom the respondent spends the most
time with in an average week. Respondents were also asked separately to list their …rst and
second-degree relatives (excluding relatives related through marriage). We use this data to
construct an undirected social network where two agents have a friendship link if one of
them names the other as a friend and as a relative link if one of them lists the other as
relative. We also added intra-household links between all members of a household which are
assumed to be of unlimited strength. Individuals have, on average, 1.84 relative links and
1.95 non-relative links.
In the survey, individuals were also asked whether they borrow or lend money or object
across each link. This data was aggregated on the household level and used to construct
…gure 1.

39

Supplementary Material to: “Consumption
Risk-sharing in Social Networks”
1

Attila Ambrus
Markus Mobius
Adam Szeidl
Harvard University Harvard University and NBER UC - Berkeley
January 2010

This material supplements the paper “Consumption Risk-sharing in Social Networks”.
First of all, we provide missing proofs for results stated in the main paper. Second, we
discuss …ve extensions to the main paper. (1) We provide game theoretic micro-foundations
to justify our assumption that links “die” when a promised transfer is not made. (2) We
provide background about the mathematical theory of network ‡ows used in the proofs of
the paper. (3) We formalize two decentralized mechanisms leading to constrained e¢ cient
allocations. (4) We formally develop the extensions of our main results to the case where
goods and friendship consumption are imperfect substitutes. (5) We explain the numerical
methods used to simulate the model and to construct the geographic network representation
of the real world Huaraz network.

A-1

Missing Proofs for Sections 1 to 4

Proof that coalition-proof arrangements are robust to deviating subcoalitions
Our de…nition of coalition-proofness in the risk-sharing context is equivalent to Bernheim et al.’s (1987) stricter de…nition of coalition-proofness who only allow for coalitional
deviations that are not prone to further deviations by subcoalitions. We establish this result
without the perfect substitutes assumption, i.e., for general Ui (xi ; ci ) utility functions.
1

E-mails: ambrus@fas.harvard.edu, mobius@fas.harvard.edu, szeidl@econ.berkeley.edu.

1

Proposition 8 Requiring coalitions to be robust to further coalitional deviations does not
a¤ect the set of coalition-proof allocations.
Proof. Let F be a deviating coalition, and let F 0

F be a deviating subcoalition. Then

F 0 is also a deviating coalition in the original set of agents W . To see why, note that the
capacities e
c0 after the subcoalition F 0 deviates are exactly those associated with links within
F 0 , and hence these are also the capacities that remain when F 0 deviates in W . Moreover,

the allocation x
e0 of the subcoalition F 0 only uses the resources in F 0 and hence is also feasible

when F 0 deviates from W . These observations imply that the same allocation is available to
all agents in F 0 if they consider a coalitional deviation from W . Since these agents are better
o¤ with this allocation than they were in the coalition F , where in turn they are better
o¤ than in the original allocation, it follows that F 0 is a pro…table coalitional deviation
in the original network as well. Hence minimal deviating coalitions are robust to further
coalitional deviations. Since any allocation that has a deviating coalition also has a minimal
one, requiring no deviating coalitions is equivalent to requiring no deviating coalitions that
are robust to further group deviations.
Proof of Proposition 1
We denote the supremum of the support of the endowment distribution with M and the
in…mum with m where S = M

m. To show that the perimeter-area inequality implies

equal risk-sharing in all states we focus on the worst case scenario where all agents inside
F get the maximum endowment M and all agents outside F get the minimum m.1 In this
case, under equal sharing all agents consume [jF j M + (jW j

jF j)m]= jW j. This requires

agents in set F to give up:

jF j M

jF j [jF j M + (jW j

jF j)m]= jW j

This amount has to be less or equal to the group’s obligation which equals the perimeter
c[F ]. Some algebra reduces this inequality to a [F ]

1

jF j
jW j

S. Hence the perimeter-area

inequality implies that no group will want to deviate even in the worst case scenario. For the
1

If the supremum and in…mum do not lie in the support of the endowment distribution, we can assume
realizations that are -close to the supremum and in…mum and then take to 0.

2

same reason, coalition proofness implies the perimeter-area inequality because the coalitional
IC constraint eF

xF

c [F ] has to hold for all states of the world.

In…nite networks in subsection 2.2
Some of our results in subsection 2.2 are stated for in…nite networks. We now discuss
how to extend our model to these environments. Say that a network is locally …nite if W is
countable, each agent has a …nite number of connections, and every pair of agents is connected
through a …nite path. A risk-sharing arrangement speci…es a consumption allocation x (e)
for every realization. Let Bir denote the set of agents within network distance r from i. The
arrangement x is feasible if with probability one
1
eBir
r!1 jB r j
i
lim

xBir = 0

for all i. This condition is a generalization of the feasibility constraint for …nite networks.
We extend the concept of coalition proofness by requiring a consumption allocation x to
be coalition-proof in every …nite subset. Formally, let H

W be a …nite set of agents, and

de…ne the auxiliary network H 0 by collapsing all agents in GnH into a single node z. In this
transformation, all links outside H disappear, all links between i 2 H and j 2
= H become
links between i and z, and all links inside H are preserved. The capacities inherited from
G in H 0 are denoted cH . Fix realization e; for each i 2 H the consumption value xi is well
de…ned. For z, we let ez = 0 and de…ne xz such that eH

xH + ez

xz = 0, which guarantees

that the resource constraint in H 0 is satis…ed. We also assume that the utility function of
z is cz + xz . With these de…nitions, we have constructed a feasible allocation x0 in H 0 . If
this allocation is coalition-proof for every …nite subgraph H, then we say that the original
allocation x is coalition-proof in the in…nite network G.
Extending Theorem 1. An informal risk-sharing arrangement can be de…ned in the same
way as before. We claim that in this in…nite network environment, the statement of Theorem
1 holds word by word. As in the …nite case, su¢ ciency is immediate. To prove necessity, let
H1

H2

::: be an increasing sequence of sets such that [k Hk = W , and …x a coalition-

proof allocation x. For each k, construct the auxiliary network Hk0 as above. We can de…ne
P
gi = ei xi for all i 2 Hk as in the proof of Theorem 1, and let gz =
i2Hk gi ; with
3

this de…nition, we have constructed a …nite implementation problem just like in the proof of
Theorem 1. Since we have a coalition-proof allocation in Hk0 , Theorem 1 yields an informal
risk-sharing arrangement tk in Hk0 . For each (i; j) link we thus obtain a sequence of transfers
tkij 2 [ c (i; j) ; c (i; j)] for the in…nite sequence of k values for which i; j 2 Hk . Because
there are only countably many links, we can select a subsequence that converges to some
tij pointwise for each i and j. It is immediate that this transfer arrangement implements
consumption allocation x and meets the capacity constraints.
Dispersion. Fix a coalition-proof allocation x in a locally …nite network. To de…ne
dispersion, …x an agent i, and consider the sequence of ball sets Bir around i. We de…ne the
dispersion of x as in the in…nite network as
DISP (x) = lim sup DISP r (x)
r!1

where DISP r (x) = SDISP r (x)2 is just the expected cross-sectional variance of the allocation x restricted to the ball set Bir . We then de…ne SDISP (x) to be the square root of
DISP in the in…nite network. We remark that in general networks, the value of SDISP
can depend on the initial agent i used to construct the balls. However, it is easy to see that
for the line and plane networks, SDISP is the same for all initial agents.
When the average endowment in the in…nite network, e = limr!1 eBir = jBir j is wellde…ned, it is easy to see that
1 X
(xj
r!1 jB r j
i j2B r

DISP (x) = lim

e)2 :

i

In particular, when e = 0, as in the applications we consider, one can think about DSIP as
the limit of the average of Ex2j over increasing ball sets. We will use this observation in the
proofs below.
Proof of Proposition 2
The following Lemma is used in the proof.
Lemma 1 Let Z be a random variable such that jZj
4

c almost surely. Then

Z

c.

This result appears to be standard; a proof is available upon request.
(i) Dispersion on the line equals the lim sup of SDISP over increasing intervals Il of
length l = 1, 3,... Fix an interval of length l and split it into subintervals of length k.
Throughout this argument we ignore integer constraints by assuming that l is large relative
p
to k. For each segment F , F =
k and c [F ] = 2c. Using Lemma 1, this implies that in
p
any coalition-proof arrangement x, stdev(xF )
k 2c. Even if agents manage to smooth
xF perfectly in F , the standard deviation of per capita consumption is at least stdev(xF ) =k.
But this implies that in interval Il we have SDISP (x)
p
= k

SDISP (x)

stdev(xF ) =k, i.e.,

2c=k:

To obtain the sharpest bound, let k = 16 (c= )2 , which gives SDISP

2

= (8c) as desired.

(ii) We establish a result for more general networks. We …x an initial network with
capacities c0 , and explore the behavior of SDISP when capacities are given by c c0 , as
c ! 1. Stating the conditions that we impose on the initial network requires some additional
notation. Let G

F be two subsets of W , and de…ne the relative perimeter of G in

F , denoted c0 [G]F , as the perimeter of G in the subgraph generated by F . With this
de…nition, c0 [G]F simply sums the capacities over all links between G and F nG. In the
subsequent analysis, we continue to use the convention that K, K 0 , K 00 , as well as K1 , K2 ,...
denote positive constants, and may represent di¤erent values at di¤erent occurrences. Our
assumptions about the network are the following.
(N1) The network is connected, countably in…nite, and all agents have at most K direct
friends.
(N2) [Partition] For every n

1 integer there exist a collection of sets Fji , where i =

1; :::; n and j = 1; :::; 1 , such that Fji , j = 1; :::; 1 give a partition of W and when i = 1,
Fj1 are all singletons.
(N3) [Ascending chain] For all 1
or Fji

i

1 and all j; j 0 , we have either Fji \ Fji+1
=?
0

n

Fji+1
.
0

(N4) [Exponential growth.] There exist 1 <

5

<

constants such that whenever Fji

Fji+1
, we have
0

Fji+1

Fji

Fji .

(N5) [Relative perimeter] There exists K > 0 such that for any G
we have c0 [G]F i
j

Fji =2

Fji with jGj

K 0 c0 [G].

Note that we de…ne the sets Fji separately for each n; we suppress the dependence on n
in notation for simplicity. (N2) implies that for each i, the i-level sets partition the entire
network. (N3) requires that each i + 1-level set is a disjoint union of some i-level sets, so
i-level sets partition the i + 1-level sets. (N4) requires that the size of these sets grows
exponentially; this implies in particular that the number of i-level sets in an i + 1 level set is
bounded by some constant K for all n and i. (N5) requires that the partitioning sets Fji are
“representative” in the sense that the relative perimeter of sets inside Fji is the same order
of magnitude as their true perimeter in G.
A speci…c example where (N1)-(N5) are satis…ed is the plane network, where the sets
can be chosen to be squares. Speci…cally, de…ne Fjn for j = 1, 2, ... to be a partition of the
plane by 2n by 2n sized squares. Split each of these squares in four 2n
and index these smaller squares by Fjn

1

1

by 2n

1

subsquares,

for j = 1, 2, .... Split these squares again and

again to de…ne Fji for lower values of i, until we arrive at singleton sets when i = 1. In this
construction, conditions (N1)-(N4) are satis…ed: we can set K = 4 for (N1) and

=

=4

for (N4). It is also easy to see that (N5) is satis…ed with K 0 = 1=3; equality can be achieved
only when the side length of Fji is even, in which case G can be chosen as a rectangle-shaped
half-square such that three sides of G lie on the sides of Fji .
To obtain a result about risk-sharing, we need to connect the network structure with the
distribution of shocks. We require the following key perimeter/area condition, which can be
viewed as an extension of the conditions used in Proposition 1:
(K) There exists K > 0 such that for all G …nite,

G

K c0 [G].

For the plane network, this condition essentially requires that for all squares F , the
standard deviation

F

is at most proportional to the side length of F , which in turn is a

consequence of assumption (P3). We now state and prove the following result.
Proposition 9 Under conditions (P1)-(P5), (N1)-(N5) and (K), there exist positive constants K 0 and K 00 and a coalition-proof allocation x (c) such that for every agent i, Ex2i (c)
K 0 exp

K 00 c2=3 .
6

Proposition 2 (ii) is an immediate consequence of this result. This is because (1) the
plane network satis…es conditions (N1)-(N5) and (K); and (2) DISP is de…ned as the limit
of averages of Ex2i (c) over increasing sets of agents, and in consequence also satis…es the
exponential bound that each Ex2i (c) satis…es.
Proof. Note that (N5) and (K) together imply that here exists K > 0 such that for all
G

Fji with jGj

Fji =2, we have

G

K c0 [G]F i . Since our goal is to obtain a result
j

about the rate of convergence, we can re-scale the initial capacity c0 by a positive constant
without loss of generality. Hence we can assume that the following condition is satis…ed:
(K’) For all G

Fji with jGj

Fji =2, we have

G

c0 [G]F i .
j

Roadmap. Our proof constructs an incentive-compatible risk-sharing arrangement in several steps. Fix n, and consider the decomposition described above. We begin by constructing
an “unconstrained”risk-sharing arrangement that implements equal sharing in each set Fjn ,
j = 1; :::; 1, but does not necessarily satisfy the capacity constraints. We compute the
implied typical link use of this transfer arrangement for each link, and choose n and c such
that capacity constraints are satis…ed most of the time. This arrangement results in exponentially small SDISP:We then bound the contribution of non-typical shocks to SDISP
and combine these terms to obtain the result stated in the proposition.
Iterative logic. The unconstrained arrangement is constructed by …rst smoothing consumption within each Fj1 set; then smoothing consumption within each Fj2 set; and so on.
When i = 1, all sets are singletons, so there is no need to smooth within a set. Now consider
the step when we move from i to i + 1. As we have seen, by (N4) the number of i level
sets in Fji+1 is bounded by a positive constant K. To simplify notation, denote Fji+1 by F ,
and denote the i-level sets Fji0 that are subsets of F by F1 ,...,Fk where k

K. We know

from (N2) and (N3) that F1 ,...,Fk partition F . We smooth consumption in Fji+1 by …rst
smoothing the total amount of resources currently present in F1 through the entire set F ;
then smoothing the total amount currently in F2 through the set F , and so on until Fk .
Note that the total consumption in F1 at this round is the same as the total endowment eF1 ,
because in each round i, we smooth all endowments within an i-level set. Having completely
smoothed resources in F1 in the previous round, all agents in F1 are currently allocated
eF1 = jF1 j units of consumption.
7

Auxiliary network ‡ow. To smooth consumption over F , we de…ne an auxiliary network
‡ow. This is a key step in the proof. For this ‡ow, focus on the subgraph generated by F
together with capacities c0 , and assume for the moment that each agent in F1 has
units of the consumption good (so the total in F1 is exactly

F1 ),

F1 = jF1 j

while each agent in F nF1

has zero. We will show that a ‡ow respecting capacities c0 can achieve equal sharing in
F from this endowment pro…le; and then use this ‡ow to construct an unconstrained ‡ow
implementing the desired sharing over F for arbitrary shock realizations.
To verify that equal sharing can be implemented in the above endowment pro…le, note
that equal sharing can be implemented through some IC transfer if for each set G

F the

excess demand for goods does not exceed the perimeter relative to F (this is where the key
perimeter/area condition (K) plays it’s role). What is this excess demand? Since we want
equal sharing, we should allocate
are also in F1 each have

F1 = jF1 j.

F1 = jF j

to every agent in G. But those agents in G who

So the excess demand for goods in the set G is

ed (G) = jGj

F1

jF j

jG \ F1 j

F1

jF1 j

(9)

:

Applying Theorem 1 to the …nite network F , there is a feasible ‡ow if for every G, we have
jed (g)j

c0 [G]F . To check that this holds, …rst assume that jGj = jF j

then the …rst term in (9) is larger, and hence jed (G)j
F,

F1

jed (G)j

implying jed (G)j
G.

F

F1

jGj = jF j. Now (P5) implies

Now recall the key condition (K’) that

G

jG \ F1 j = jF1 j;

jGj = jF j. From (P4) we have
F = jF j

G = jGj,

and hence

c0 [G]F ; it follows that jed (G)j

c0 [G]F as desired. We now check that (9) also holds when jGj = jF j < jG \ F1 j = jF1 j. In this
case, the second term in (9) dominates, and hence jed (G)j
F1 = jF1 j

satis…es

G\F1 = jG
G\F1

G

F1

jG \ F1 j = jF1 j. Since

\ F1 j by (P3), we can bound the right hand side by
c0 [G]F again verifying that jed (G)j

G\F1 ,

which

c0 [G]F . This shows that the

auxiliary ‡ow can be implemented.
Smoothing with auxiliary ‡ow. Denote the transfers associated with the auxiliary ‡ow by
t1 . To smooth the consumption of F1 over F for arbitrary shocks, we just use the transfers
t1 (eF1 =

F1 );

that is, we scale up the above ‡ow with the actual size of the shock in F1 .

This works, because t1 was constructed to smooth a shock of exactly one standard deviation

8

F1 .

Extending this logic, to smooth the endowment of each other Fj through the set F ,

we construct auxiliary ‡ows t2 , ..., tk analogously, and implement the total transfer given
by t1 eF1 =

F1

+ ::: + tk eFk =

Fk .

This construction results in an unconstrained ‡ow which

smooths consumption in the entire set F .
Note that while we used the capacities to construct the ‡ow (this is how we got t1 ,...,
tk ), the actual ‡ow is a stochastic object that may violate some capacity constraints, both
because it is scaled by eF1 =

F1

and because it is summed over all j.

Iteration. We do the above step for all i + 1-level sets Fji+1 ; this concludes round i + 1
of the algorithm. Then we go on to round i + 2, and so on, until …nally we implement
equal sharing in each of the highest-level sets Fjn , j = 1,...,1. Denote the unconstrained
arrangement obtained in this way by tU .
How low is SDISP in the arrangement tU ? To answer, recall that (N4) implies Fjn
and (P3) implies

F = jF j

1=2

K jF j

, so that SDISP

K

m=2

n

,

= K1 exp [ K2 m].

This SDISP , however, is implemented with an unconstrained ‡ow; and now we want to
assess how often the ‡ow violates capacity constraints once we choose c and m. To do this,
we need to compute the distribution of the ‡ow over each link in the network.
Link usage. Consider the step where we smooth the consumption of F1 over the entire
set F using the ‡ow t1 eF1 =

F1 .

Fix some (u; v) link; then the use of this link in the

‡ow at this round is t1 (u; v) eF1 =

F1 .

standard deviation t1 (u; v), since eF1 =
that t1 (u; v)

F1

This is a random variable with mean zero and
has unit standard deviation. Moreover, we know

c0 (u; v) because this is how t1 was constructed (this is why it was important

to construct t1 such that it satis…es the capacity constraints c0 .) It follows from Lemma 1
that the standard deviation of link use at this step is at most c0 (u; v).
Now consider link use as we smooth the consumption of all sets F1 , ..., Fk over the set
F . As we have seen, smoothing for each of these sets implies adding a ‡ow over the (u; v)
link that has standard deviation of at most c0 (u; v). Given that k

K for some constant,

the total standard deviation of the ‡ow over (u; v) in each round of the algorithm is at the
most K c0 (u; v). Adding up these ‡ows over all n rounds shows that the total standard
deviation of the unconstrained arrangement over the (u; v) link is at most nK c0 (u; v).
Constrained arrangement. We construct an arrangement which satis…es the capacity
9

constraints in a simple way. We …x c and n, and for each agent u, try to implement his
in‡ows and out‡ows according to the unconstrained ‡ow we just constructed. If this is not
possible, then we just implement as much of the prescribed ‡ows as possible. This approach
ensures that binding capacity constraints do not propagate down the network.
Bounding exceptional event. Denote Fjn = F , and consider some agent u 2 F . We
begin bounding the exceptional event by looking at those realizations where the capacity
constraint binds on exactly one of u’s links: tU (u; v) > c c0 (u; v). We explore the e¤ect
of multiple binding constraints later. We focus on the contribution of these realizations to
Ex2u , recalling that SDISP is the square root of the average of this quantity over all agents
u. The contribution of realizations where tU (u; v) > c c0 (u; v) but the other constraints of
u do not bind to Ex2u is at most
Z

c (u; v)]2 dP

[eF + t (u; v)

tU (u;v)>c c0 (u;v)

where eF = eF = jF j, the integral is taken over the probability space on which all random
variables are de…ned and P is the associated probability measure. Noting that (x + y)2
3 (x2 + y 2 ), we can bound this from above by
3

Z

e2F

dP + 3

Z

c c0 (u; v)]2 dP:

[t (u; v)

tU (u;v)>c

(10)

c0 (u;v)

Here the …rst term is proportional to the variance of the unconstrained ‡ow, which, as we
have seen, is exponentially small. Thus we have to bound the contribution of the second
term.
Large deviations. Let z =
c > 0 and

> 0,

Pr [z > c]

P

E exp [ (z

j

j yj

for some

c)] = e

c

E exp

j

satisfying

h X

j yj

i

P

=e

2
j

c

< 1. Then, for any

Y
E exp [

j yj ] :

j

Now we can bound the last term using (P1) to obtain
Pr [z > c]

e

c

Y

E exp K

2 2
j =2

j

10

=e

c

h
X
E exp K 2 =2

2
j

i

:

This holds for any , in particular, for

P

2
j

, resulting in the bound Pr [z > c]
P 2
exp [ c2 = (2K z2 )], where we used the fact that the variance of z is z2 =
j . This shows
= c= K

that the tail probabilities of z can be bounded by a term exponentially small in (c= z )2 , just
like in the case when z is normally distributed.
Bound on remaining variance. Using the bound on the tail probability, we can estimate
the …nal term in (10). Let z = tU (u; v) which is a weighted sum of the yj shocks by
construction. Denoting the c.d.f. of z by H (z) we have
Z

2

Z

1

c c0 (u; v)] dP =
(z c c0 (u; v))2 dH (z)
tU (u;v)>c c0 (u;v)
z=c c0 (u;v)
Z 1
=
(z c c0 (u; v))2 d [1 H (z)] =
z=c c0 (u;v)
Z 1
1
2
2 (z c c0 (u; v)) [1 H (z)] dz
=
(z c c0 (u; v)) (1 H (z)) c(u;v) +
[t (u; v)

z=c c0 (u;v)

where we integrated by parts. The above argument with large deviations proves 1
exp [ z 2 =2K

2
z ].

H (z)

This implies that the …rst term is zero, and combining it with the second

term, direct integration shows that
Z

[t (u; v)

tU (u;v)>c

c c0 (u; v)]2 dP

K 0 c c0 (u; v) exp

c2 c0 (u; v)2 =2K

2
z

c0 (u;v)

for appropriate constants K and K 0 .
Since

z

nKc0 (u; v), the last term is bounded by K exp

K 0 (c=n)2 , where the

values of the constants are now di¤erent.
Combine bounds. We have obtained a bound on the exceptional event where the capacity
constrained on a single link is binding. We must similarly bound the contribution to Ex2u of
binding capacity on all other single links of u; all possible pairs of links; all possible sets of
three links; and so on. Since u has a bounded number of links, doing this just increases the
bound we just obtained by a constant factor. In total, all exceptional events thus contribute
to Ex2u at most K exp

K 0 (c=n)2 .

To obtain a bound on SDISP , we …rst bound DISP = SDISP 2 , which is just the

11

average of Ex2u over the entire network. We have seen that for each u,
Ex2u

K1 exp [ K2 n] + K3 exp

K4 (c=n)2

where the …rst term is the variance of the unconstrained ‡ow and the second term is the
bound coming from exceptional events. Setting n = c2=3 yields Ex2u

K5 exp

K6 c2=3 ,

as desired.
Proof of Corollary 1
For this proof we also construct an informal risk-sharing arrangement step by step. The
logic of the proof is to …x a grid associated with the geographic embedding, show that inside
grid squares risk-sharing is good because the embedding is local and there are only a bounded
number of people, and use the result for the plane to show that insurance is good across
squares.
Fix the geographic embedding, and consider the grid with step size A for which the no
separating avenues condition holds: for this grid, there is at least capacity K > 0 between
any pair of adjacent squares under c0 . Since capacities are bounded away from zero, after
re-scaling we can assume that all link capacities are at least 1; in this case all neighboring
squares have connecting ‡ow of at least 1 as well in c0 . Index the squares in the grid by
j = 1; :::; 1 and denote the set of agents in square j by Gj .
We have to accomplish good risk-sharing inside each square as well as across the squares.
We will do this by using a share of the capacity of each link for within square sharing, and the
remaining capacity for cross-square sharing. By locality of the embedding, any two agents in
a given square are connected through a path lies within a bounded distance from the square.
Assign, for each pair of agents inside a square one such path. By evenness, any link in the
network is used by at most a bounded number of such paths. Let K be large enough such
that all links are used by no more than K paths (K will denote this …xed quantity for the
rest of the proof.)
Now …x c > 0, and use a share 1= (10K ) of capacities to implement between-squares
risk-sharing using Proposition 2, taking eGj as the “endowment shocks”of the squares. The
conditions of the proposition are easily seen to be satis…ed, and hence we obtain between12

squares dispersion which is exponentially small in c2=3 .
Second, we have to smooth the incoming and outgoing transfers for each square. Use a
share 4=10 of capacities to smooth all incoming and outgoing transfers of each square. To
do this, we need to use the paths connecting agents. Since the perimeter of each square
used for incoming and outgoing transfers is 4c= (10K ), and each link is used for at most K
connecting paths, a total capacity of 4c= (10K ) K = 4c=10 will be su¢ cient to completely
share the incoming and outgoing transfers among agents inside each square.
Third, we also have to smooth the total endowment shock realized in each square. To do
this, …rst note that for any network of bounded size where capacities are bounded below and
endowment shocks satisfy (P1) and (P2), the large deviations argument of the previous proof
imply that SDISP can be bounded by K exp [K 0 c2 =2]. Since the number of agents in a
square are bounded and shocks satisfy (P1) and (P2), and all pairs of agents are connected
by (potentially external) paths of remaining capacity 5c= (10K ) or more, it follows that we
can achieve within-square dispersion on the order of exp [ K 0 c2 =2] This is of smaller order
than the main exp

K 00 c2=3 term; hence the proof is complete.

Proof of Proposition 3
By de…nition
=

cov [xF ; eF ]
cov [eF tF ; eF ]
=
=1
var [eF ]
var [eF ]

cov [tF ; eF ]
var [eF ]

where tF denotes the total transfer leaving F . Moreover, jcov [tF ; eF ]j =
jcorr [tF ; eF ]j

c [F ]

(tF )

(eF )

(eF ), using Lemma 1, and the claim of the Proposition follows.

Proof of Proposition 5
Fix realization e, and let t denote the vector of transfers over all links in a given IC
arrangement. Denote the planner’s objective with a given set of weights i by V (t) =
P
P
i i Ui ei
j tij ; ci . Then the planner’s maximization problem can be written as maxt V (t)

subject to tij

c (i; j) and tij =

tji for all i and j. It is easy to see that Karush-Kuhn-

Tucker …rst order conditions associated with this problem are those given in the Proposition.
Since we have a concave maximization problem where the inequality constraints are linear,

13

the Karush-Kuhn-Tucker conditions are both necessary and su¢ cient for characterizing a
global maximum. For uniqueness, rewrite the planner’s objective as a function of the consumption pro…le x, V (x) = V (t). This function is strictly concave in x and maximized over
a convex domain, and hence the maximizing consumption allocation is unique, although the
transfer pro…le supporting it need not be.
Proof of Proposition 6
For each i and j, say that i and j are in the same equivalence class if there is an i ! j
path such that for all agents l on this path, including j, we have

0
i Ui

=

0
l Ul .

The partition

generated by these equivalence classes is the set of risk-sharing islands Wk . If i 2 Wk and
j2
= Wk , then either c (i; j) = 0, in which case tij = c (i; j) by de…nition, or c (i; j) > 0, which
implies that

0
i Ui

6=

0
l Ul

by construction of the equivalence classes. But then Proposition 5

implies that jtij j = c (i; j), as desired.
Proof of Proposition 7
In this proof we focus on transfer arrangements that are acyclical, i.e., have the property
that after any endowment realization there is no path of linked agents i1 ! ik such that
i1 = ik , and til il+1 > 0 8 l 2 f1; :::; k

1g. This is without loss of generality, as it is easy to

show that for any IC arrangement there is an outcome equivalent acyclical IC arrangement
that achieves the same consumption vector after any endowment realization.
(i): We begin with the weak inequalities of the claim (xj (e0 )

xj (e) 8 j), which we

establish in a slightly more general setup. Say that a transfer arrangement is monotone over
all sets if for any F

W and any two endowment realizations (e) and (e0 ) such that e0i

for all i 2 F and t0ji

tji for all i 2 F and j 2
= F , we have x0i

ei

xi for all i 2 F . Monotonicity

over all sets means that for any set of agents F , reducing their endowments and/or their
incoming transfers weakly reduces everybody’s consumption. Note that this property indeed
implies monotonicity in the sense of the Proposition, by taking F = W .
Fix a constrained e¢ cient arrangement, and suppose it is not monotone over all sets.
Let F be a set where this property fails, and …x a connected component of the subgraph
spanned by F that contains an agent i such that x0i > xi . Let S be the set of agents for
whom x0i

xi , and T be the set of agents for whom x0i > xi in this component. S is
14

non-empty, because the total endowment available in any connected component of F has
decreased, and T is non-empty by assumption. In addition, there exist s 2 S and t 2 T
such that t0st > tst , because consumption in T is higher under e0 than under e. But t0st > tst
implies c (s; t) > tst and c (t; s) > t0ts , and hence, by Proposition 5,
in e, and also
implies
0
0
s Us (xs )

0 0
t Ut (xt )

<

0
0
s Us (xs )

0 0
t Ut (xt )

0
t Ut (xt ),

<

0
s Us (xs ).

0
s Us (xs )

0
t Ut (xt )

in e0 . Since x0t > xt by assumption, strict concavity

which, combined with the previous two inequalities, yields

But this implies xs < x0s , which is a contradiction.

c (i) follows directly from this monotonicity
Finally, the claim that x0j < xj for all j 2 W

condition combined with (ii) which is proved below.

bi denote the set of links connecting agents in W
c (i). Let Li denote the set of
(ii): Let L

links connecting agents in W (i). Let t be a transfer arrangement respecting the capacity
bi .
constraints and achieving x(e) at endowment realization e, such that tkl < c(k; l) 8 (k; l) 2 L

bi are slack. Such
In words, in transfer arrangement t, the capacity constraints for all links in L
c (i). Let b be the minimum amount of slackness on a link in
a t exists by the de…nition of W
bi : b = min
L
b i (c(k; l)
(k;l)2L

jtkl j).

Let L0i denote the set of links connecting agents in W (i) with agents in W nW (i). For

every (k; l) 2 L0i ; let t0kl be such that

0
k Uk (xk (e)

t0kl ) =

0
l Ul (xl (e)

+ t0kl ). In words, t0kl is

the amount of transfer between k and l that would equate the weighted marginal utilities of
k and l. By Proposition 5 and by the de…nition of W (i), t0kl 6= 0 8 (k; l) 2 L0i . Let b0 be the
minimum amount of transfer that would equate the weighted marginal utilities of an agent
in W (i) and a neighboring agent outside W (i) : b0 = min(k;l)2L0i jt0kl j.
We claim that the result holds for
we have

0
0
j Uj (xj (e ))

=

0
0
i Ui (xi (e ))

= min(b; b0 ), that is whenever jei

e0i j < min(b; b0 ),

c (i); and Uj (xj (e0 )) = Ui (xi (e)) 8 j 2
8 j 2 W
= W (i).

To see this, consider the restricted set of agents W (i); and endowments xi (e) + e0i

ei

for agent i, and xj (e) for j 2 W (i)=fig (where xi (e) still refers to the constrained e¢ 0

cient allocation given set of agents W and endowment realization e). Let xe;e denote this
endowment vector on W (i). Consider now the consumption arrangement over W (i) that
P
0
maximizes j2W (i) j Uj (xj ) subject to x being achievable from xe;e by transfer scheme t0
(over W (i)) for which jtjj 0 + t0jj 0 j
by xW (i) . Because

0
j Uj (xj )

c(j; j 0 ) 8 j; j 0 2 W (i). Let this arrangement be denoted

is decreasing in xj for all j, jxW (i)
15

xi (e)j

jei

e0i j. Then

0

there is a transfer scheme t0 over W (i) that achieves xW (i) from endowments xe;e , for which
jt0jj 0 j

e0i j <

jei

. Since

Proposition 5 this means that

bi are still slack. By
< b, all the capacity constraints in L
W (i)
0
)
j Uj (xj

=

0 W (i)
).
i Ui (xi

Moreover, since

< b0 , all the

capacity constraints in L0i are still binding, in the same direction. Extend now xW (i) to W
W (i)

such that xj

= xj (e) for j 2 W nW (i). Similarly, extend transfer scheme t0 to W such

that t0jj 0 = 0 whenever at least one of j an j 0 are not in W (i). Note that t + t0 is a direct
transfer arrangement on W which meets the capacity constraints, and that xW (i) satis…es
the conditions of Proposition 5. Hence xW (i) is the constrained e¢ cient allocation given
endowment realization e0 , and as shown above, satis…es the claims in (ii).
(iii): Let t0 be an acyclical transfer arrangement achieving x(e0 ) after endowment realization e0 . Then we can decompose t0 as the sum of acyclical transfer arrangements t and t00
such that t achieves x(e) after endowment realization e. By part (i) above, xj 0 (e0 )
8 j 0 2 W , implying that M U Cj 0

xj 0 (e)

1 8 j 0 2 W . Therefore if xj (e0 ) = xj (e), hence

M U Cj = 1, then the statement in the claim holds. Assume now that xj (e0 ) < xj (e).
Since xj 0 (e0 )

xj 0 (e) 8 j 0 2 W by part (i), for any j 0 2 W nfig it must hold that the sum
P
00
0.
of transfers received by j 0 in transfer arrangement t00 is non-positive:
l2W nfj 0 g tlj 0

Hence, only i can be a net recipient in the transfer arrangement t00 . This, together with
xj (e0 ) < xj (e) implies that there is a j ! i path such that t00im im+1 > 0 along the path.
Hence, in transfer scheme t no link (im ; im+1 ) along the above j ! i path is blocked, implying

0
im+1 Uim+1 (xim+1

(e))

0
im Uim (xim

i ! j path is blocked, implying

(e)), and that no link (im+1 ; im ) along the reverse

0
im+1 Uim+1 (xim+1

(e0 ))

0
im Uim (xim

(e0 )). Dividing these

inequalities yields the result.

A-2

Microfoundations for link-level punishment

Consider the following multi-stage game.
Stage 1. An endowment vector e is drawn from a commonly known prior distribution.
Stage 2. Each agent i makes a transfer teij to every neighbor j. Transfer teij is only
observed by players i and j.
Stage 3. Agents play friendship games over links. The game over the (i; j) link is
16

C
C

D

c (i; j) c (i; j)

D c (i; j) =2

1 c (i; j) =2

1 0 0

which is a coordination game with two pure strategy equilibria, (C; C) and (D; D). Denote the payo¤ of i from the game with j by c0 (i; j).
Stage 4. The realized utility of agent i is Ui (x0i ; c0i ).
Proposition 10 An allocation x (e) is the outcome of a pure-strategy subgame-perfect equilibrium of this game if and only if it can implemented through an incentive-compatible informal risk-sharing arrangement.
Proof. Fix an incentive-compatible informal risk-sharing arrangement and consider the
following strategy pro…le . In Stage 2, each agent is supposed to make the transfer according
to the above arrangement. In Stage 3, the neighbors across links where transfers were made
as prescribed coordinate on the high equilibrium (C; C) and otherwise they coordinate on
the low equilibrium (D; D). It is easy to see that making the promised transfers is an SPE.
Conversely, consider a pure strategy SPE, and the corresponding risk-sharing arrangement
it induces. Note that in any such pro…le, in stage 3 any two neighbors should either play
(D; D), resulting in a payo¤ of (0; 0), or play (C; C), resulting in a payo¤ of (c(i; j); c(i; j)).
But then all transfers in Stage 2 have to satisfy the IC constraints because the actual transfer
from i to j can only in‡uence the continuation strategy of j, not agents in W=fi; jg (since
they do not observe the actual transfer). Therefore the actual transfer from i to j can
only in‡uence the payo¤ i gets from the friendship game with j, not the payo¤ from other
friendship games he is involved at in Stage 3. Hence the maximum loss in Stage 3 payo¤s in
a pure SPE when not delivering a promised transfer teij is c(i; j), the di¤erence between the
best Nash equilibrium payo¤s of the friendship game (c(i; j)) and the payo¤ that a player
can guarantee in the friendship game (0). This implies that the transfer scheme has to be
IC.

17

A-3

Background on the theory of network ‡ows

The following concepts from the theory of network ‡ows are useful for many of the proofs in
the paper. Cormen, Leiserson, Rivest and Stein (2001) provides a more careful treatment.
Fix a …nite graph G two nodes s and t (for “source”and “target”) and a capacity c.
De…nition 3 An s ! t ‡ow with respect to capacity c is a function f : G

G ! R which

satis…es
(i) Skew symmetry: f (u; v) =

f (v; u).

(ii) Capacity constraints: f (u; v) c(u; v).
P
(iii) Flow conservation: w f (u; w) = 0 unless u = s or u = t.

A useful physical analogue is to think about a ‡ow as some liquid ‡owing through the

network from s to t, which must respect the capacity constraints on all links. The value
P
of a ‡ow is the amount that leaves s, given by jf j =
w f (s; w): The maximum ‡ow is

the highest feasible ‡ow value in G. Flows are particularly useful in our setting, because

the capacity constraints associated with our direct transfer representation are exactly the
constraints (ii) in the above de…nition. In particular, a direct transfer representation that
meets the capacity constraints is called a circulation in the computer science literature.
De…nition 4 A cut in G is a disjoint partition of the nodes into two sets G = S [ T such
that s 2 S and t 2 T . The value of the cut is the sum of c (u; v) for all links such that u 2 S
and v 2 T .
It is easy to see that the maximum ‡ow is always less than or equal to the minimum cut
value. The following well-known result establishes that these two quantities are equal.
Theorem 2

[Ford and Fulkerson, 1958] The maximum ‡ow value equals the minimum cut

value.
We rely both on the concept of network ‡ows and the maximum ‡ow - minimum cut
theorem in the proofs of the paper.

18

A-4

Formal results for subsection 3.3 of the paper

A decentralized exchange implementing any constrained e¢ cient arrangement.
We show that for any constrained e¢ cient allocation, there exists a simple iterative procedure
that only uses local information in each round of the iteration, and converges to the allocation
as the number of iterations grow. A simpler version of this procedure, with equal welfare
weights and no capacity constraints, was proposed by Bramoulle and Kranton (2006). The
basic idea is to equalize, subject to the capacity constraints, the marginal utility of every
pair of connected agents at each round of iteration. This procedure can be interpreted as a
set of rules of thumb for behavior that implements constrained e¢ ciency in a decentralized
way.
Fix an endowment realization e, and denote the e¢ cient allocation corresponding to
welfare weights

i

by x . Fix an order of all links in the network: l1 ,...,lL , and let ik and

jk denote the agents connected by lk . To initialize the procedure, set xi = ei and tij = 0
for all i and j. Then, in every round m = 1; 2; :::, go through the links l1 ; :::; lL in this
order, and for every lk , given the current values xik , xjk , and tik jk , de…ne the new values x0ik
and x0jk and t0ik jk = tik jk + x0jk

xjk such that they satisfy the following two properties: (1)
0

(x0jk ), or

0
0
ik Uik (xik )

0
0
jk Ujk (xjk )

x0ik + x0jk = xik + xjk . (2) Either

0
0
ik Uik (xik )

=

t0ik jk =

0
0
jk Ujk (xjk )

and t0ik jk = c (i; j). This amounts to the agent

c (i; j), or

0
0
ik Uik (xik )

<

jk U

>

and

with lower marginal utility helping out his friend up to the point where either their marginal
utility is equalized, or the capacity constraint starts to bind. Once this step is completed
for link k, we set x = x0 and t = t0 before moving on to link k + 1. For m = 1; 2; ::: let xm
i
denote the value of xi , and let tm
ij denote the value of tij , at the end of round m. Note that
xm meets the capacity constraints by design for every m.
Proposition 11

If consumption and friendship are perfect substitutes, then xm ! x as

m ! 1.
Proof. Let V (x) denote the value of the planner’s objective in allocation x. The above
procedure weakly increases V (x) in every round and for every link lk . Hence V (x1 )
V (x2 )

::, and since V (x)

V (x ) for all x that are IC, we have limm!1 V (xm ) = V

V (x ). Since the set of IC allocations is compact, and xm is IC for every m, there exists a
19

convergent subsequence of xm , with limit x and associated transfers t. Clearly, V (x) = V .
If V = V

then x = x since the optimum is unique. If V < V , then x is not optimal,

and hence does not satisfy the …rst order condition over all links. Let lk be the …rst link in
the above order for which the …rst order condition fails in x and t. Then there is a transfer
meeting the capacity constraints at x that increases the planner’s objective by a strictly
positive amount . But this means that for every xm far along the convergent subsequence,
the planner’s objective increases by at least =2 at that round, which implies that V (xm )
is divergent, a contradiction. Hence lim xm = x along all convergent subsequences, which
implies that xm itself converges to x .
Ex ante coalition-proofness of constrained e¢ ciency. If we require stability with
respect to both ex ante and ex post coalitional deviations we obtain a subset of the constrained e¢ cient agreements. In the case of perfect substitutes this subset is exactly the
set of constrained e¢ cient agreements. We say that a coalition-proof agreement x admits
no ex ante coalitional deviations if there is no coalition S and coalition-proof risk-sharing
agreement x0S within S such that all agents in S weakly prefer losing all their links to agents
in W=S and having agreement x0S to keeping all their links and having agreement x, and at
least one agent in S strictly prefer the former. Intuitively, an ex ante coalitional deviation
implies that the agents of the deviating coalition leave the community (cut their ties with
the rest of the community) and agree upon a new risk-sharing agreement among each other
(using only their own resources).
Proposition 12 A coalition-proof agreement that admits no pro…table ex ante coalitional
deviations is constrained e¢ cient. If goods and friendship are perfect substitutes then the set
of coalition-proof agreements that admit no pro…table ex ante deviations is equal to the set
of constrained e¢ cient agreements.
Proof. Consider …rst a coalition-proof agreement x that is not constrained e¢ cient.
Then there is another coalition-proof agreement x0 that ex ante Pareto-dominates x. But
then x0 is a pro…table ex ante coalitional deviation for coalition W . This concludes the …rst
part of the statement.

20

Assume now that goods and friendship are perfect substitutes and consider a coalitionproof agreement x that is constrained e¢ cient. Suppose there is coalition S and a pro…table
ex ante deviation x0S by S. Theorem 1 implies that x can be achieved by a direct-transfer
agreement t that respects all capacity constraints. Similarly, x0S can be achieved by a direct
transfer agreement t0S within S that respects all capacity constraints (within S). Consider
now a combined direct transfer agreement (t0S ; t

S)

that is equal to t0S for links within S, and

it is equal to t otherwise. Since both t and t0S respect capacity constraints, so does (t0S ; t

S ),

hence the resulting consumption pro…le x00 is coalition-proof. By construction x is equivalent
to x00 for agents in W nS. Agents in S are at least weakly better o¤ with consumption pro…le
x00 and not losing any of their links than with consumption pro…le x0S and losing their links
with agents in W nS, since x00 is coalition-proof. But this, combined with x0S being a pro…table
ex ante coalitional deviation, implies that coalition-proof agreement x00 Pareto-dominates x,
which contradicts that x is constrained e¢ cient.

A-5

Analysis with imperfect substitutes

A-5.1

Formal results for subsection 4.1 of the paper

The extension of the results in Section 2 follows directly from the discussion in subsection
4.1. We now also show that with an increasing MRS, the set of IC arrangements contracts
after a negative aggregate shock.
Proposition 13 Assume that M RSi is increasing in xi for all i. Then for any pair of
endowment realizations e and e such that ei

ei for all i, an incentive compatible set of

transfers in e is also incentive compatible given e.
Proof. Let V (yi ; ci ; si ) = Ui (yi + si ; ci ), then (Vx =Vc ) (yi ; ci ; si ) = (Ux =Uc ) (yi + si ; ci ),
and hence the condition that M RSi = (Ux =Uc ) (xi ; ci ) is increasing in xi implies that
(Vx =Vc ) (yi ; ci ; s) is increasing in s for any …xed (yi ; ci ), i.e., that V (yi ; ci ; s) satis…es the
Spence-Mirrlees single-crossing condition. Since Ui is continuously di¤erentiable and Ux ,
Uc > 0, Theorem 3 in Milgrom and Shannon (1994) implies that V has the single crossing
property. In particular, V (yi ; ci ; 0)

V (yi0 ; c0i ; 0) implies V (yi ; ci ; si )
21

V (yi0 ; c0i ; si ) for any

si

0, or equivalently, Ui (xi ; ci )

follows that for any si

Ui (x0i ; c0i ) implies Ui (xi + si ; ci )

Ui (x0i + si ; c0i ). It

0, the compensating variation satis…es
CVi (xi ; ci ; c0i )

and hence for any set F , we have cx [F ]

CVi (xi + s; ci ; c0i )
cx+s [F ]. Now denote e

0; it follows

e=s

immediately that any IC transfer scheme given e is IC given e as well.

A-5.2

Formal results for subsection 4.2 of the paper

The equivalence between the planner’s problem and constrained e¢ ciency with general preferences and a concave MRS was established in Appendix A to the paper. To present our
characterization result building on this equivalence, …rst we de…ne a measure of marginal
social welfare gain of transfers to agents. Fix an IC arrangement x, and recalling the de…nition of acyclical transfer arrangements from the proof of Corollary 7, let t be an acyclical
implementation of x in endowment realization e. Consider the following iterative construction. We say that the IC constraint from i to j binds if Ui (xi ; ci ) = Ui (xi + tij ; b
ci;j ). Let

W1

W denote the set of agents i for whom (i) there is no j such that c(i; j) > 0; and (ii)

the IC constraint from i to j binds. Since t is acyclical, W 1 is nonempty. For any i 2 W 1 ,
let

i

=

i Ui;x (xi ; ci )

be the marginal bene…t of an additional dollar to i. This is both the

private and social marginal welfare gain, because no IC constraint binds for transfers from
i.
Suppose now that we have de…ned the sets W 1 ; :::; W k
any i 2 [l

k 1W

l

1

and the corresponding

. Let W k denote the set of agents i such that i 2
= [l

c(i; j) > 0 and the IC constraint from i to j binds, j 2 [l

k 1W

l

k 1W

. To de…ne

l

i

for

but whenever
i,

…rst denote,

for every j such that the IC constraint from i to j binds, x
bi;j = xi + tij , and b
ci;j = ci

c(i; j),

and let

ij

=

As we will show below,

i Ui;x (xi ; ci )

ij

Ui;x (b
xi;j ; b
ci;j )
+
Ui;x (xi ; ci )

j

1

Ui;x (b
xi;j ; b
ci;j )
:
Ui;x (xi ; ci )

measures the marginal social gain of an additional dollar to i, under

the assumption that i optimally transfers some of the dollar to j. Intuitively, to transfer

22

to j, i has to increase his own consumption somewhat to maintain incentive compatibility.
More formally, we show below that a share Ui;x (b
xi;j ; b
ci;j )=Ui;x (xi ; ci ) of the marginal dollar

must be kept by i, and only the remaining share can be transferred to j, where it has a
welfare impact of

j.

Denote

ii

=

i Ui;x (xi ; ci ),

and to account for the softening of the IC

constraint over all links, let
= max f

i

ij

j j : the IC constraint from i to j binds or j = ig :

With this recursive de…nition, the marginal social welfare of an additional dollar takes into
account both the marginal increase in i’s consumption, and the softening of the IC constraints
which allow transfers of resources through a chain of agents.
Proposition 14

[Constrained e¢ ciency with imperfect substitutes] Assume that M RSi is

concave in xi for every i. A transfer arrangement t is constrained e¢ cient i¤ there exist
positive ( i )i2W such that for every i; j 2 W one of the following conditions holds:
1)

j

=

i

2)

j

>

i

and the IC constraint binds for tij

3)

j

<

i

and the IC constraint binds for tji :

Proof. We begin with some preliminary observations. Suppose that the IC constraint
from i to j binds, and i receives an additional dollar. Suppose that i keeps a share
dollar and transfers the remaining 1

of the

such that the IC constraint continues to bind. Then

it must be that Ui;x (xi ; ci ) = Ui;x (b
xi;j ; b
ci;j ), or equivalently,

= Ui;x (xi ; ci )=Ui;x (b
xi;j ; b
ci;j ).

To maintain incentive compatibility, this share of the dollar has to be consumed by i, and
only the remainder can be transferred to j.

Now we establish the necessity part of the proposition. Fix a constrained e¢ cient arrangement, and let

i

be the associated planner weights. Consider realization e. We …rst show

that the marginal value to the planner of an additional dollar to an agent i is

i.

Let

i 2 W 1 , then the marginal value to the planner of endowing i with an additional dollar
is at least

i.

It cannot be larger, since that would imply that transferring a dollar away
23

from i increases social welfare in the original allocation, contradicting constrained e¢ ciency.
Hence, the marginal social value of a dollar to i is exactly
all j 2 [l

k 1W

l

i.

Suppose we established for

that the marginal social value of a dollar to j is

j such that the IC constraint from i to j is binding,

j

Let i 2 W k . For any

j.

is at least as large as the marginal

social value of an additional dollar to i, because otherwise optimality requires reducing tij .
Hence the marginal social value of a dollar to i is obtained when i transfers as much of the
dollar as possible under incentive compatibility to some agent j. Given our above argument,
i can transfer at most 1

Ui;x (xi ; ci )=Ui;x (b
xi;j ; b
ci;j ) to j, hence the marginal welfare gain if

he chooses to transfer to j will be

ij .

Since i will choose to transfer the dollar to the agent

where it is most productive, the marginal social gain will be the maximum of
which is

ij

over j,

i.

It follows easily that if

j

>

i

for some i; j, then the IC constraint for tij has to bind:

otherwise social welfare could be improved by marginally increasing tij . This establishes that
in a constrained e¢ cient allocation, for any endowment realization and any pair of agents
one of conditions (1)-(3) from the theorem have to hold.
For su¢ ciency, let now x denote the unique welfare maximizing consumption, let t be
an IC transfer scheme achieving this allocation, and let b i =

i (x; t),

for every i 2 W .

Assume now that there exists another consumption vector x0 6= x achieved by IC transfer
scheme t0 such that (x0 ; t0 ) satisfy conditions (1)-(3), and let

0
i

=

i (x

0

; t0 ), for every i 2 N .

Then there exists an acyclical nonzero transfer scheme td that achieves x from x0 , and which
is such that t0 + td is IC. By de…nition of x, td from x0 improves social welfare. Let now
W d = fi 2 W j9 j such that tdij 6= 0g, and partition W d into sets W0d ; :::; WKd the following
way. Let W0d = fi 2 W d j

9 j 2 W d st. tdij > 0g. Given W0d ; :::; Wkd for some k

d
Wk+1
= fi 2 W d n( [ Wld )j
l=0;:::;k

i2

W0d ,

9 j 2 W d n( [ Wld ) st. tdij > 0g. Note that x0i > xi 8
l=0;:::;k

which together with there being no agent j such that tdi j > 0 implies that

Now we iteratively establish that
for some k

0, let

0
i

< b i 8 i 2 W d . Suppose that

0
i

< bi 8 i 2

d
0. Let i 2 Wk+1
. Note that by de…nition there is j 2

can only be compatible with tdi j > 0,
(x; t0 + td ) if xi > x0i . But xi > x0i , and

0
j
0
i0

< b i.

[ Wld

l=0;:::;k

[ Wld such that

l=0;:::;k

tdi j > 0, and there is no j 0 2 W d n( [ Wld ) such that tdi j 0 > 0. Suppose
l=0;:::;k

0
i

0
i

b i . This

< b j , and (1)-(3) holding for both (x0 ; t0 ) and

< b i0 8 i0 2 W such that tdii0 > 0 implies
24

0
i

< b i,

a contradiction. Hence

0
i

d
< b i 8 i 2 Wk+1
, and then by induction

0
i

< b i 8 i 2 W d . But

note that for any i 2 WKd it holds that xi < x0i and there is no j 2 W such that tdji > 0, and
hence

0
i

> b i . This contradicts

0
i

< b i 8 i 2 W d , hence there cannot be (x0 ; t0 ) satisfying

(1)-(3) such that t0 is IC and x0 6= x.

Corollary 7 can also be extended to the imperfect substitutes case. Fix a constrained
e¢ cient arrangement, and let e and e0 be two endowment realizations such that ei > e0i for
some i 2 W , and ej = e0j 8 j 2 W nfig. Let x (e) be the consumption in the constrained

c (i) the largest
e¢ cient allocation after e. Analogously to the perfect substitutes case, let W

set of connected agents containing i such that all IC constraints within the set are slack
given some transfer arrangement achieving the constrained e¢ cient allocation after ei . For
any endowment realization e, let

j (e)

be

j,

as de…ned above, given any transfer scheme

with the maximal number of links on which the IC constraints are slack, among the ones
that attain the constrained e¢ cient allocation. It is straightforward to show that there is
a transfer scheme with a maximal number of links on which the IC constraints are slack,
among the ones achieving the constrained e¢ cient allocation, and that for all such transfer
arrangements

j

is the same.

Corollary 2 [Spillovers with imperfect substitutes] Assume that M RSi is concave, then
(i) [Monotonicity]

0
j (e )

j (e)

(ii) [Local sharing] There exists
c (i):
all j 2 W

c (i) then
for all j, and if j 2 W

> 0 such that jei

e0i j <

0
j (e )

implies

>

0
i (e )

j (e).

=

0
j (e )

for

(iii) [More sharing with close friends] For any j 6= i, there exists a path i ! j such that

for any agent l along the path,

0
l (e )

0
j (e ).

The proof of this result is analogous to the perfect substitutes case and hence omitted.
Note that (ii) is weaker than in Corollary 7, because even small shocks can spill over the
boundaries of the risk-sharing islands of agent hit by the shocks. Also note that since
i

=

i Ui;x

for any agent not on the boundary of an island, (i) implies that consumption is

monotonic in the endowment realization for such agents.

25

A-6

Numerical methods

Risk-sharing simulations. We use the following numerical approach for the simulations
underlying Figure 4. We assume throughout that endowment shocks are uniformly distributed with support [ 1; 1]. We build on Theorem 1 and express a SDISP-minimizing
incentive-compatible risk-sharing arrangement as a cost-minimizing ‡ow as follows. (1) Create two arti…cial nodes s and t as in the proof of Theorem 1. (2) Divide the shock support
into K equal intervals. For each agent i, denote the subinterval into which i’s endowment
falls by ki (treating [ 1; 1 + 2=K] as the …rst interval and [1

2=K; 1] as the Kth interval).

Create ki links between s and i such that each link has capacity 2=K in the direction from
s to i and zero in reverse direction. De…ne the “cost”of a ‡ow going from s to i across any
of these links to be j for the jth link of out ki links. Similarly, create K

ki links between t

and i. such that each link has capacity 2=K in the direction from i to t and zero in reverse
direction. De…ne the cost of a ‡ow going from i to t across any of these links to be j for the
jth link of out ki links. (3) Use Edmonds and Karp’s (1972) algorithm to calculate a costminimizing ‡ow in this augmented network. This solution induces an incentive-compatible
risk-sharing arrangement that maximizes a piecewise linear approximation to the quadratic
utility function assumed in the de…nition of SDISP , where the marginal utility of consumption for any agent is constant within each of the K intervals. Simulations (not reported)
show that this approximation generates highly accurate predictions for K = 20. For the
results presented in the text we set K = 100.
Geographic network representation. The algorithm used in the geographic representation constructed in Figure 5 is the following. For each household i, we …rst construct
vectors vj to every other households j in the unit square using households’initial (re-scaled)
geographic coordinates. We also calculate the length di of each of these vectors. Note, that
p
the maximum distance between two households is 2. We then calculate a shift vector as
Pp
the weighted sum
( 2 di )vj = kvj k and move each household in the direction of this

shift vector. Shifts are larger if a household is closely surrounded by other households and
the shift will push the household away from its neighbors. This procedure is repeated 23
times to obtain the representation in Figure 5E.

26

