                               NBER WORKING PAPER SERIES




   IDENTIFICATION AND ESTIMATION IN DISCRETE CHOICE DEMAND MODELS
        WHEN ENDOGENOUS VARIABLES INTERACT WITH THE ERROR

                                           Amit Gandhi
                                           Kyoo il Kim
                                           Amil Petrin

                                       Working Paper 16894
                               http://www.nber.org/papers/w16894


                     NATIONAL BUREAU OF ECONOMIC RESEARCH
                              1050 Massachusetts Avenue
                                Cambridge, MA 02138
                                    March 2011




We thank Arthur Lewbel, Rosa Matzkin, and numerous seminar participants for many helpful suggestions.
This paper previously circulated under the title â€œThe Interaction of Observed and Unobserved Demand
Factors in Discrete Choice Demand Models.â€ The views expressed herein are those of the authors
and do not necessarily reflect the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been peer-
reviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.

Â© 2011 by Amit Gandhi, Kyoo il Kim, and Amil Petrin. All rights reserved. Short sections of text,
not to exceed two paragraphs, may be quoted without explicit permission provided that full credit,
including Â© notice, is given to the source.
Identification and Estimation in Discrete Choice Demand Models when Endogenous Variables
Interact with the Error
Amit Gandhi, Kyoo il Kim, and Amil Petrin
NBER Working Paper No. 16894
March 2011
JEL No. C25,L0

                                              ABSTRACT

We develop an estimator for the parameters of a utility function that has interactions between the unobserved
demand error and observed factors including price. We show that the Berry (1994)/Berry, Levinsohn,
and Pakes (1995) inversion and contraction can still be used to recover the mean utility term that now
contains both the demand error and the interactions with the error. However, the instrumental variable
(IV) solution is no longer consistent because the price interaction term is correlated with the instrumented
price. We show that the standard conditional moment restrictions (CMRs) do not generally suffice
for identification. We supplement the standard CMRs with new moments that we call â€œgeneralizedâ€
control function moments and we show together they are sufficient for identification of all of the demand
parameters. A major advantage of our setup is that it requires little more than the existence of the same
instruments used in this standard IV setting. We run several monte carlos that show our approach works
when the standard IV approaches fail because of non-separability. We also test and reject additive
separability in the original Berry, Levinsohn, and Pakes (1995) automobile data, and we show that
demand becomes significantly more elastic when the correction is applied


Amit Gandhi                                           Amil Petrin
University of Wisconsin                               Department of Economics
1180 Observatory Drive                                University of Minnesota
Madison, WI 53706-1393                                4-101 Hanson Hall
agandhi@ssc.wisc.edu                                  Minneapolis, MN 55455
                                                      and NBER
Kyoo il Kim                                           petrin@umn.edu
Department of Economics
University of Minnesota
4-129 Hanson Hall
1925 4th Street South
Minneapolis, MN 55455
kyookim@umn.edu
1        Introduction
        Demand estimation is a critical issue in many policy problems and correlation between unob-
served demand factors and prices arising from market equilibration can confound estimation. In
discrete choice settings the problem is complicated by the fact that the unobserved demand factor
enters non-linearly into the demand equation, making standard Instrumental Variables (IV) tech-
niques invalid. A major contribution of Berry (1994) and Berry, Levinsohn, and Pakes (1995) is to
show how to invert from market shares the mean utility term. As long as the unobserved demand
factor enters mean utility additively, standard IV techniques can be applied to recover the demand
parameters subsumed in it.
        Restricting the unobserved demand factor to enter utility additively is not always innocuous.
Separability rules out several important aspects of economic behavior. For example, separability
does not allow unobserved advertising to affect the marginal utility derived from observed character-
istics or from the composite commodity index (typically given by residual income), even though this
is often the purpose of advertising. Similarly, if the demand error represents unobserved physical
characteristics, a separable setup does not allow the marginal utility derived from observed charac-
teristics or the composite commodity index to depend on the level of the unobserved characteristic.
Empirically, allowing for the possibility of a non-separable error may be important because the set
of product characteristics observed by the practitioner is often limited, leaving a large role for the
unobserved demand factor in explaining realized demand.
        Our main contribution is to show how to consistently estimate demand parameters while allowing
for observed endogenous and exogenous variables to interact with the unobserved factor. We begin
by showing when endogenous variables interact with the demand error, the Berry (1994)/Berry,
Levinsohn, and Pakes (1995) inversion and contraction can still be used to recover the mean utility
term. However, the IV approach is no longer consistent for the parameters embedded in the mean
utility term. The instrumented price is correlated with the interaction term between price and the
unobserved demand factor, which is now in the estimation equationâ€™s error.
        We then show in Section 3 that the conditional moment restrictions (CMR) used in the Berry/BLP
setup are no longer sufficient for identification. While higher-order moments of the standard CMRs
solve the identification problem if only exogenous variables interact with the demand unobservable,
they do not help with identification when one (or more) endogenous variables interacts with the
demand unobservable. Our non-separable setup thus provides a simple example of the failure of
identification using CMRs in settings with non-separable errors (see Blundell and Powell (2003) and
Hahn and Ridder (2008)).
        Our setup is closest to a model of multiplicative heteroskedasticity with both exogenous and en-
dogenous variables interacting with the error.1 We achieve identification by coupling the Berry/BLP
CMRs with new moment conditions based on insights from Kim and Petrin (2010d), who revisit
the early control function literature (see Section 4). We develop a control function that conditions
    1
        Our approach can be generalized somewhat (see Kim and Petrin (2010b)).



                                                          2
out the correlation between the unobserved demand factor and price. We then construct the new
moments conditions based on a specification that includes the control function as an addtional
explanatory variable for mean utility. For identification the control function must not have argu-
ments that are perfectly collinear with price and other characteristics entering mean utility. We
show the CMR conditions from BLP put shape restrictions on the control function that ensure this
collinearity does not occur.
      We prove identification for the random coefficients case using a high-level condition from Berry,
Linton, and Pakes (2004) (see the Appendix). In Section 5 we provide a proof for the case without
random coefficients that more clearly illustrates how combining the two types of moments achieves
identification. This proof shows that we require little beyond the standard conditions for identifi-
cation with valid instruments. Specifically, just as in Berry/BLP, if price is the only endogenous
variable then we only require one instrument that shifts price around and is excluded from utility.
      We develop a semiparametric sieve estimator for our non-separable demand model and prove
consistency in Section 6. In a setting without random coefficients our estimator inverts market
shares to recover mean utility and then reduces to three simple steps. With random coefficients for
each evaluation of the objective function we use the BLP contraction to solve for the mean utility
term and then carry out the same simple steps.2
      In Section 7 we run three sets of Monte Carlos to illustrate implementation of our estimator
and to show the possible impact of interaction terms on estimated demand elasticities. In all of the
Monte Carlos both ordinary least squares (OLS) and two-stage least squares (2SLS) are significantly
biased while our estimator is consistent.
      We then return to the original Berry, Levinsohn, and Pakes (1995) automobile data to investigate
whether allowing for interaction terms changes the estimated demand elasticities (see Section 8).
In our most general specification where we include interactions terms and random coefficients, we
reject at the 5% level that the coefficients on all of the interaction terms are zero, and demand
elasticities increase on average by 60% relative to 2SLS.
      We are aware of three other approaches that can allow for some form of non-separability with
endogenous prices in discrete choice settings.3 In the case where an observed characteristic exists
that is perfectly substitutable (i.e. separable) with the unobserved demand factor, Berry and Haile
(2010) show the Berry/BLP CMRs are sufficient for identification. Bajari and Benkard (2005) and
Kim and Petrin (2010a) - which are based on Imbens and Newey (2009) - invert out from the pricing
function a vector of controls that are exactly one-to-one functions with unobserved factors. The
benefit of inverting out the unobserved factors is they are then observed, and one can allow for
much more flexible non-separable settings than our setup. The drawback is that they require strong
conditions on the demand and supply setting to get existence of the inverse. We provide a more
detailed comparison with all three approaches in Section 4.
  2
    Code is available from the authors for Stata.
  3
    Also see a recent nonparametric bounds (partial identification) approach by Chesher, Rosen, and Smolinski
(2011).




                                                     3
2    Utility Specification
    We use a standard discrete choice model with conditional indirect utility uij given as a function
of observed and unobserved product j and consumer i characteristics. We decompose utility into
three components
                                              uij = Î´j + Âµij + ij                                     (1)

where first component, Î´j is a product-specific term common to all consumers, the Âµij term captures
heterogeneity in consumer tastes for observed product characteristics and can be a function of
demographics, and ij is a â€œlove of varietyâ€ taste term that is assumed to be independent and
identically distributed across both products and consumers. Consumer i is assumed to choose the
product j out of J +1 choices that yields maximal utility, and market shares obtain from aggregating
over consumers.
    The utility component common to all consumers, Î´j , is usually given as

                                           Î´j = c + Î² 0 xj âˆ’ Î±pj + Î¾j ,

where we normalize the mean utility derived from the outside good be zero (Î´0 = 0), xj =
(xj1 , . . . , xjK )0 and Î² are, respectively, the vector of observed (to the econometrician) product
characteristics and the population average taste parameters associated with those characteristics,
Î± is the marginal utility of income and pj denotes the price of good j, and Î¾j is the characteristic
observed to consumers and producers but unobserved to the econometrician. It may represent other
physical attributes of the product or advertising that is not conditioned upon in the estimation, and
it is usually found to be positively correlated with price, biasing elasticities in the positive direction.
    Âµij is parameterized as

                                    K
                                    X          XR                      K
                                                                       X
                            Âµij =         xjk (   Ï„rk zir ) + Ïƒc Î½ic +   Ïƒk Î½ik xjk
                                    k=1       r=1                    k=1

where zi = (zi1 , . . . , ziR ) is a vector of consumer specific demographics which may include income
and Ï„k = (Ï„1k , . . . , Ï„Rk ) with Ï„rk the taste parameter associated with demographic characteristic
r and product characteristic k. Ï„rk zir is then the marginal utility derived from a unit of the kth
characteristic for a consumer with demographic zir . Î½i = (Î½ic , Î½i1 , . . . , Î½iK ) are mean-zero standard
normal idiosyncratic taste shocks for each consumer-characteristic pair and Ïƒ = (Ïƒc , Ïƒ1 , . . . , ÏƒK ) are
the standard deviation parameters associated with the taste shocks.
    We write the vector of induced tastes for each product for individual i as Âµi = (Âµi1 , . . . , ÂµiJ ).
Letting f (Âµi ) be the induced density and assuming ij is independent and identically distributed
extreme value, the market share of product j is




                                                        4
                                                           eÎ´j +Âµij
                                                      Z
                                           sj (Î´) =       J
                                                                        f (Âµ)dÂµ
                                                               Î´   +Âµ
                                                          P
                                                             e   k   ik
                                                          k=0


Letting Ï„ = (Ï„1, . . . , Ï„K ), Berry (1994) shows under certain conditions that a unique Î´(Ïƒ, Ï„ ) =
(Î´1,..., Î´J ) exists that exactly matches observed to predicted markets shares,

                                               s(Ïƒ, Ï„, Î´(Ïƒ, Ï„ )) = sData ,

and Berry, Levinsohn, and Pakes (1995) provide a contraction mapping that locates it conditional
on any values of (Ïƒ, Ï„ ). Together these results are critical for addressing the endogeneity of price.
2.1      Non-Separable Demand
       Our main contribution is to extend this utility framework to a setup where we allow the mean
utility term to include interactions between observed and unobserved product attributes

                                                                K
                                                                X
                            Î´j = c + Î² 0 xj âˆ’ Î±pj + Î¾j +              Î³k xjk Î¾j + Î³p (yÌ„ âˆ’ pj )Î¾j .                    (2)
                                                                k=1

(Î³, Î³p ) is the new vector of parameters, y is representative income, and the interaction terms between
the observed variables are included in xj . Theory readily accommodates this extension (e.g. see
McFadden (1981)). The Î³k â€™s allow unobserved advertising or an unobserved product characteristic
to impact the marginal utility from observed characteristics. Similarly, Î³p allows the marginal utility
of income to depend on the amount of unobserved quality or unobserved advertising. Thus if Î³p is
negative consumers become less price sensitive as the demand error increases.
       We can continue to use the same result from Berry (1994) to establish the existence and unique-
ness of a Î´(Ïƒ, Ï„ ) = (Î´1,..., Î´J ) that exactly matches observed to predicted markets shares.4 However,
if Î³p 6= 0 the standard two stage least squares estimator (or GMM estimator) that recovers the
parameters contained in Î´ is inconsistent.
2.2      Standard 2SLS Inconsistent with Non-Separable Demand
       Let the instrumented value of pj be given by pÌ‚j and rewrite (2) as

                                                      K
                                                      X
                                0
                   Î´j = c + Î² xj âˆ’ Î±pÌ‚j + [Î¾j +             Î³k xjk Î¾j + Î³p (yÌ„ âˆ’ pj )Î¾j âˆ’ Î±(pj âˆ’ pÌ‚j )]                (3)
                                                      k=1

with the new error in brackets. There are several new components to the error but only (yÌ„ âˆ’ pj )Î¾j
presents an econometric problem. Î¾j is not correlated with the fitted price, pÌ‚j asymptotically and
   4
     If we allow the interaction term with residual income - (yi âˆ’ pj ) instead of (y âˆ’ pj ) - Berry (1994)â€™s existence and
uniqueness result no longer hold. We are working to extend Gandhi (2009)â€™s inversion result to this setting. This
also requires us to develop a new contraction to locate Î´(Ïƒ, Ï„ ) = (Î´1,..., Î´J ). Once we have done so we can also allow
for random coefficients on both Î¾ and on the interactions between Î¾ and the observed characteristics and price. This
work is well beyond the scope of the current paper.



                                                              5
PK
    k=1 Î³k xjk Î¾j   is also uncorrelated with pÌ‚j asymptotically as long as the instrument(s) include xj
and they are valid. By construction (pj âˆ’ pÌ‚j ) is uncorrelated with pÌ‚j .
     The problem arises because pÌ‚j is correlated with yÌ„ âˆ’ pj , leading to the possibility that pÌ‚j and
Î³p (yÌ„ âˆ’ pj )Î¾j are correlated conditional on xj . The sign of the bias depends on the sign of Î³p and the
sign of the conditional correlation of pÌ‚j and (yÌ„ âˆ’ pj )Î¾j . In the Berry, Levinsohn, and Pakes (1995)
automobile data our estimate of Î³p is negative and the standard IV estimate is biased down, which
would imply a negative correlation between pÌ‚j and (yÌ„ âˆ’ pj )Î¾j conditional on xj .
3      Conditional Moment Restrictions Alone Insufficient for Identifi-
       cation
     We consider identification using the Berry, Levinsohn, and Pakes (1995) (BLP) conditional
moment restrictions (CMR). We collect the model parameters into Î¸ = (c, Î² 0 , Î±, Î³ 0 , Î³p )0 and denote
its true value by Î¸0 . A set of instruments zj is presumed to exist such that

                                                     E[Î¾j (Î¸0 )|zj ] = 0.

We follow BLP and assume zj includes all observed product characteristics and income. Letting
Î¾j = Î¾j (Î¸0 ), the CMR restriction leads to the moments BLP use for identification, given as


                                  E[Î¾j |zj ] = E[Î´j âˆ’ (c0 + Î²00 xj âˆ’ Î±0 pj )|zj ] = 0.

xj and the intercept are included in zj and thus are valid instruments for themselves. If a valid
instrument for price exists then E[pj |zj ] can replace pj and all parameters are identified.
     Once we generalize the model to the non-separable setting the same CMR leads to the moments

                    E[Î¾j |zj ] = E[Î´j âˆ’ (c0 + Î²00 xj âˆ’ Î±0 pj + Î¾j (Î³00 xj + Î³p0 (yÌ„ âˆ’ pj )))|zj ] = 0.     (4)

xj and pj can be treated as in the separable case, and since xj and yÌ„ are in the conditioning set
E[xj Î¾j |zj ] = xj E[Î¾j |zj ] = 0 and E[yÌ„Î¾j |zj ] = yÌ„E[Î¾j |zj ] = 0. However, pj is not generally known
given zj , so E[pj Î¾j |zj ] 6= pj E[Î¾j |zj ], and the CMR alone fails to identify any of the parameters.
     (4) is an example of simple nonseparable setting that illustrates a more general point regarding
non-separable errors and the failure of identification using CMRs (see Blundell and Powell (2003)
and Hahn and Ridder (2008)). We have valid conditional moment restrictions and our setting is one
where we can explicitly solve for Î¾ for any candidate value of Î¸. However, these together are not be
sufficient for identification. One can see this by solving for Î¾j as a function of the other arguments
and expressing the CMR as

                                                 Î´j âˆ’ c0 âˆ’ Î²00 xj + Î±0 pj
                                                                               
                                  E[Î¾j |zj ] = E                             |zj = 0.
                                                 1 + Î³00 xj + Î³p0 (yÌ„ âˆ’ pj )

These moment conditions are satisfied for multiple values of the parameters (e.g. any Î³k0 = âˆ)


                                                              6
and thus do not identify the model parameters.
    One approach is to add further restrictions that allow the practitioner to calculate and thus
control for E[pj Î¾j |zj ]. However, calculating the value of this expectation with Î¾j unknown is virtu-
ally impossible without fully specifying how pj is determined in equilibrium. Researchers may be
reluctant to do so because pj may be a function of all observed and unobserved characteristics of
vehicles in the market, in addition to other cost and demand shifters. An advantage of our solution
is that we will add controls to the conditioning set zj such that price will be known, so we avoid
the problem of having to resolve this exact relationship between pj and Î¾j conditional on zj .
4    Adding Moments with Control Functions
    We add new moment conditions to the CMRs to solve this non-uniqueness problem. We develop
a control function that has as arguments new controls and zj which together condition out the
correlation between the demand error Î¾j and price. For identification the control function must not
have arguments that are perfectly collinear with (xj , pj ). The CMR conditions from BLP put shape
restrictions on the control function that ensure this collinearity does not occur.
    A major advantage of our approach is that our moments require nothing beyond the standard
conditions for identification with valid instruments. Specifically, just as in Berry (1994) and Berry,
Levinsohn, and Pakes (1995) we require no new instruments beyond those from their setup, and we
only require - as they do - that the instruments shift price around while being excluded from the
utility function.
    Each product j may have its own set of controls that we denote Vj . The control function is the
conditional expectation of the error given zj and Vj , which we write as

                                         f (zj , Vj ) = E[Î¾j |zj , Vj ].

It is well-defined and (almost surely) unique as long as the unconditional expectation E[Î¾j ] exists.
    Vj must satisfy the next condition in order to address the endogeneity problem.
Condition 1. (CF) Any bounded function of (zj , pj ) is uncorrelated with Î¾j given f (zj , Vj ).

    While Vj = pj would trivially satisfy this condition, if we include prices in Vj we will not be
identified because the controls will leave no variation to identify Î±0 . We look for controls Vj 6= pj
such that the control function f (zj , Vj ) removes the dependence between pj and Î¾j and leaves some
remaining (causal) variation of pj .
    In order to resolve the difficulty associated with E[pj Î¾j |zj ] 6= pj E[Î¾j |zj ], we require that pj is
known conditional on (zj , Vj ), which allows us to write E[pj Î¾j |zj , Vj ] = pj E[Î¾j |zj , Vj ] and leads
to the CF condition being satisfied.

Theorem 1. If there exists control(s) Vj such that pj is known conditional on (zj , Vj ), then the
condition CF is satisfied.

Proof. For any bounded function of (zj , pj ), say h(zj , pj ), we have E[h(zj , pj )(Î¾j âˆ’ f (zj , Vj ))] = 0


                                                       7
due to the law of iterated expectation, because E[h(zj , pj )(Î¾j âˆ’ f (zj , Vj ))|zj , Vj ] = h(zj , pj )E[Î¾j âˆ’
f (zj , Vj )|zj , Vj ] = 0 because pj is known given (zj , Vj ) and f (zj , Vj ) = E[Î¾j |zj , Vj ].


    We propose two variants of controls that both satisfy the CF condition. Here we discuss using

                             Vj    = pj âˆ’ E[pj |zj ] = pj âˆ’ Î (zj ), j = 1, . . . , J,                        (5)

with Î (zj ) â‰¡ E[pj |zj ], the expected value of pj given zj . In subsection 4.3 we consider an idea
proposed in Matzkin (2003) as an alternative way to generate Vj . The controls for good j are then
given by Vj = gj (V1 , . . . , VJ ), for some known (vector) function gj (Â·) of (V1 , . . . , VJ ) chosen by the
researcher. Vj satisfies the CF condition by Theorem 1 as long as Vj is an element of Vj . In
the simplest case Vj = Vj , which is sufficient for identification and consistency. However, since
f (zj , Vj ) is a new regressor in our setup, for efficiency purposes one may want to include Vk k 6= j
as they may also â€œexplainâ€ Î¾j , leading to more variation in f (zj , Vj ).
    Having determined Vj = gj (V1 , . . . , VJ ), we can then exploit the moment condition:

             0 = E [Î´j âˆ’ {c0 + Î²0 xj âˆ’ Î±0 pj + f (zj , Vj )(1 + Î³0 xj + Î³p0 (yÌ„ âˆ’ pj ))}|zj , Vj ] ,         (6)

where without loss of generality we let xj be scalar. Letting Î¾ej = (1 + Î³xj + Î³p (yÌ„ âˆ’ pj )) Î¾j we now
obtain

                E[Î¾ej |z, Vj ] = E[Î¾j |zj , Vj ] + Î³E[xj Î¾j |zj , Vj ] + Î³p E[(yÌ„ âˆ’ pj )Î¾j |zj , Vj ]
                               = E[Î¾j |zj , Vj ](1 + Î³xj + Î³p (yÌ„ âˆ’ pj ))
                               = f (zj , Vj )(1 + Î³xj + Î³p (yÌ„ âˆ’ pj )),

because xj âˆˆ zj and pj is also known conditional on zj and Vj . The choice of the control function
coupled with (6) thus allows us to circumvent the problem of specifying the exact relationship
between pj and Î¾j .
    The structural parameters would all be identified from (6) if no linear functional relationship
existed between 1, xj , pj , f (zj , Vj ), f (zj , Vj )xj , and f (zj , Vj )(yÌ„ âˆ’ pj ). However, f (zj , Vj ) may
contain linear functions of xj or be collinear with pj , in which case one will not be able to separate
the coefficients (c0 , Î²0 , Î±0 ) from the function f (zj , Vj ). We reintroduce the conditional moment
restrictions to rule out this possible collinearity.

Condition 2 (CMR). E[Î¾j |zj ] = 0.

    The CMR condition imposes

                            0 = E[Î¾j |zj ] = E[E[Î¾j |zj , Vj ]|zj ] = E[f (zj , Vj )|zj ].

CMR imposes that the mean of f (zj , Vj ) is equal to zero for any value of zj . Thus while f (zj , Vj )


                                                          8
can depend on a function of Vj and its interaction with zj , it cannot be an additive function of zj
only, so functions of xj only are also ruled out. Also, since Vj 6= pj , as long as zj includes a variable
not included in xj , f (zj , Vj ) will not be perfectly collinear with (xj , pj ) because f (zj , Vj ) cannot
be an additive function of zj . Thus the generalized control function moments combined with the
implied shape restrictions from CMR on f (zj , Vj ) will suffice for identification of the structural
parameters Î¸0 . Section 4.1 provides a simple example and Section 5 proves identification formally.
    Together CF and CMR can be written as a set of moment conditions

                 0 = E Î´j âˆ’ {c0 + Î²00 xj âˆ’ Î±0 pj + f (zj , Vj )(1 + Î³00 xj + Î³p0 (yÌ„ âˆ’ pj ))}|zj , Vj
                                                                                                     
                                                                                                                                  (7)

with f (zj , Vj ) restricted to satisfy
                                                     E[f (zj , Vj )|zj ] = 0.                                                     (8)

We use a multi-step least squares estimator based on the moment conditions from (7) and (8) to
estimate Î¸0 and the nonparametric function f (zj , Vj ), which we approximate with sieves. In the
first-step we obtain consistent estimates of Vj = gj (V1 , . . . , VJ ) using a consistent estimator for
Î (zj ) j = 1, . . . , J and Vj = pj âˆ’ Î (zj ). In the second step we construct the approximation of
f (zj , Vj ) that it satisfies (8). For example, we can approximate f (zj , Vj ) as

                 âˆ
                 X                                           Xâˆ                 X
f (zj , Vj ) =           Ï€l1 ,0 (Ï•l1 (Vj )âˆ’E[Ï•l1 (Vj )|zj ])+                                    Ï€l1 ,l2 Ï†l2 (zj )(Ï•l1 (Vj )âˆ’E[Ï•l1 (Vj )|zj ])
                 l1 =1                                          l=2 l1 â‰¥1,l2 â‰¥1 s.t. l1 +l2 =l


where Ï•l1 (Vj ) and Ï†l2 (zj ) denote approximating functions of Vj and zj (e.g., tensor products
polynomials or splines), with plug-in consistent estimates of E[Ï•l1 (Vj )|zj ]. In the final step we
estimate Î¸0 and f (zj , Vj ) simultaneously using non-linear least squares.5 Kim and Petrin (2010c)
provide conditions for the consistency and the asymptotic normality of the general sieve multi-step
estimator.



4.1     Example
    While our general approach allows f (zj , Vj ) to come from any class of functions that can be
consistently approximated by sieves, here we consider a simple example to illustrate how the CMR
restriction yields identification. For some parameter values Ï€ = (Ï€0 , Ï€10 , Ï€2 , Ï€30 )0 we assume f (zj , Vj )
can be written as
                                        f (zj , Vj ) = Ï€0 + Ï€10 zj + Ï€2 Vj + Ï€30 zj Vj
    5
      Alternatively
                Pâˆ one can estimatePthe        model parameters in two steps using the unconstrained approximation
Ëœ                                          âˆ P
f (zj , Vj ) =    l1 =1 Ï€l1 ,0 Ï•l1 (Vj ) + l=2  l1 â‰¥1,l2 â‰¥1 s.t. l1 +l2 =l Ï€l1 ,l2 Ï†l2 (zj )Ï•l1 (Vj ). If one wanted an estimate of
f (zj , Vj ) one would use a standard estimator to approximate E[fËœ(zj , Vj )|zj ] and then calculate

                                           f (zj , Vj ) = fËœ(zj , Vj ) âˆ’ E[fËœ(zj , Vj )|zj ].




                                                                   9
with zj = (xj , z2j )0 . Letting Ï€30 zj = Ï€31 xj + Ï€32 z2j the CMR in this case implies

        f (zj , Vj ) = f (zj , Vj ) âˆ’ E[f (zj , Vj )|zj ]                                                                            (9)
                      = (Ï€0 +      Ï€10 zj   + Ï€2 Vj +      Ï€30 zj   Vj ) âˆ’ (Ï€0 +   Ï€10 zj   + Ï€2 E[Vj |zj ] +   Ï€30 zj E[Vj |zj ])
                      = Ï€2 Vj +        Ï€30 zj   Vj ,

because Vj = pj âˆ’ Î (zj ) so E[Vj |zj ] = 0. Thus f (zj , Vj ) is a function of Vj and its interaction with
zj , but conditional on these terms is not an additive function of pj nor zj alone.
    Identification follows from plugging (9) in (7) and rearranging to obtain

0 = E[Î´j âˆ’ {c0 + Î²0 xj âˆ’ Î±0 pj + Ï€2 Vj + (Ï€2 Î³0 + Ï€31 )xj Vj + Ï€2 Î³p0 Vj (yÌ„ âˆ’ pj )
         +Ï€31 Î³0 x2j Vj + Ï€31 Î³p0 xj Vj (yÌ„ âˆ’ pj ) + Ï€32 z2j Vj + Ï€32 Î³0 z2j xj Vj + Ï€32 Î³p0 z2j Vj (yÌ„ âˆ’ pj )}|zj , Vj ].

The unconstrained regression of Î´j on 1, xj , pj , Vj , xj Vj , Vj (yÌ„ âˆ’pj ), x2j Vj , xj Vj (yÌ„ âˆ’pj ), z2j Vj , z2j xj Vj ,
and z2j Vj (yÌ„ âˆ’pj ) then identifies the coefficients (c0 , Î²0 , Î±0 , Ï€2 ) and the composite coefficients (Ï€2 Î³0 +
Ï€31 , Ï€2 Î³p0 , Ï€31 Î³0 , Ï€31 Î³p0 , Ï€32 , Ï€32 Î³0 , Ï€32 Î³p0 ) unless the regressors are â€œmulticollinearâ€. (Î³0 , Î³p0 , Ï€31 , Ï€32 )
are then identified by the composite coefficients.
4.2     Identification and Higher-order CMRs
    If Î³p 6= 0 then the higher order moments of Î¾j conditional on zj do not help with identifica-
tion. The problem is the same as that encountered with the conditional mean, where moment
conditions are satisfied for multiple values of the parameters. For example, consider the conditional
homoskedasticity assumption where E[Î¾j2 |zj ] = Ïƒ 2 . Rewritten we have

                                               Î´j âˆ’ c0 âˆ’ Î²00 xj + Î±0 pj 2
                                                                               
                         E[Î¾j2 |zj ]        2
                                       âˆ’Ïƒ =E (                             ) |zj âˆ’ Ïƒ 2 = 0,
                                               1 + Î³00 xj + Î³p0 (yÌ„ âˆ’ pj )
which is satisfied for any Î³k0 = âˆ and Ïƒ = 0.
    If Î³p = 0 then only exogenous variables interact with the demand error. The conditional moment
restrictions E[Î¾j |zj ] = 0 are sufficient to identify (c0 , Î²0 , Î±0 ) because the CMR implies

                                  K
                                  X
                        E[Î¾j +           Î³k xjk Î¾j | zj ] = E[Î´j âˆ’ (c0 + Î²00 xj âˆ’ Î±0 pj )|zj ] = 0.
                                  k=1


Given (c0 , Î²0 , Î±0 ), the entire multiplicative heteroskedastic error Î¾Ëœj = Î¾j + K
                                                                                 P
                                                                                  k=1 Î³k xjk Î¾j is identified.
    Ëœ
The Î¾j can be used with a higher-order moment restriction on Î¾j conditional on zj to identify Î³.
    We illustrate assuming conditional homoskedasticity holds and (without loss of generality) there
is only one exogenous characteristic, so the entire identified error is Î¾Ëœj = Î¾j (1 + Î³xj ). Taking the
conditional expectation of this squared error yields

                                            E[Î¾Ëœj2 |zj ] = Ïƒ 2 + 2Ïƒ 2 Î³xj + Ïƒ 2 Î³ 2 x2j .



                                                                     10
If we consider the regression model

                                              Î¾Ëœj2 = Ï€0 + Ï€1 xj + Ï€2 x2j + Î·j

with E[Î·j |zj ] = 0 by construction, then Î³ is overidentified because Î³ 2 = Ï€2 /Ï€0 and Î³ = Ï€1 /2Ï€0 .
4.3     Matzkin (2003) Controls
    We can also use the controls proposed in Matzkin (2003), as done in Florens, Heckman, Meghir,
and Vytlacil (2008) and Imbens and Newey (2003). Assuming pj is continuous, we can always
rewrite pj as a function of zj and a continuous single error term VÌƒj - pj = hÌƒ(zj , VÌƒj ) - such that VÌƒj
is independent of zj and hÌƒ(zj , VÌƒj ) is increasing in VÌƒj .6 Normalizing VÌƒj to be uniform over the unit
interval [0, 1] we obtain the new control

                                                    VÌƒj = Fpj |zj (pj |zj )

where Fpj |zj denotes the conditional cumulative distribution function of pj given zj . The con-
trol VÌƒj satisfies the requirement in Theorem 1 because conditional on (zj , VÌƒj ), pj is known, given
as pj = Fpâˆ’1
          j |zj
                (VÌƒj |zj ) â‰¡ hÌƒ(zj , VÌƒj ). One can then proceed as described above constructing VÌƒj =
gÌƒj (VÌƒ1 , . . . , VÌƒJ ). Identification also holds for VÌƒj (see Kim and Petrin (2010c) for the latter case).
4.4     Alternative Approaches
    We are aware of three other approaches that allow for some form of non-separable demands with
endogenous prices in discrete choice settings. Bajari and Benkard (2005) and Kim and Petrin (2010a)
use the structure from Imbens and Newey (2009) and place restrictions on demand and supply such
that it is possible to invert out from the pricing equations the demand errors. Once the demand
errors have been recovered from the inversion, they can enter utility in any non-separable fashion
that the practitioner desires because the variable is now observed. The tradeoff is that they require
the controls (V1 , . . . , VJ ) to be one-to-one with Î¾ = (Î¾1 , . . . , Î¾J ) conditional on Z = (z1 , . . . , zJ ), and
they also need full independence of Î¾ and Z, two important features of the econometric setup from
Imbens and Newey (2009). We require neither assumption but our non-separable setup is not fully
general.
    In the case where a special type of characteristic exists, Berry and Haile (2010) show how to
use it in conjunction with conditional moment restrictions to achieve identification in differentiated
                                                                                                  (1)
products models with market level data. This special characteristic - call it xj                        - must be perfectly
substitutable with Î¾j , and the coefficient on the special characteristic must be known.7 The approach
                                                                              (1)         (2)
allows for non-parametric identification in the variables ((xj + Î¾j ), xj , pj ).
    We show how in our parametric setup from (2) identification using the CMRs is achieved when
this special characteristic exists. Substituting in the special characteristic to the mean utility we
   6
     This does not imply that pj and Î¾j are independent given VÌƒj nor that pj and Î¾j are independent given (VÌƒ1 , . . . , VÌƒJ )
even if Î¾j is independent of zj .
   7
     This characteristic is related to but not the same as the special regressor from Lewbel (2000).




                                                              11
have
                           (1)      (2)0 (2)                         (2)    (1)                           (1)
              Î´j = c0 + xj + Î²0 xj âˆ’ Î±0 pj + Î¾j + Î³00 xj (xj + Î¾j ) + Î³p0 (yÌ„ âˆ’ pj )(xj + Î¾j ),
                                               (2)
with the other regressors given as xj                and where for transparency we suppress interactions between
 (2)
xj      and (yÌ„ âˆ’ pj ). Solving for Î¾j and taking expectations conditional on zj , we obtain

                                                                                 (2)0 (2)
                                                   (1)          Î´j âˆ’ c0 âˆ’ Î²0 xj + Î±0 pj
                             0 = E[Î¾j |zj ] =    âˆ’xj     + E[              (2)
                                                                                              |zj ],
                                                                1 + Î³00 xj + Î³p0 (yÌ„ âˆ’ pj )

                                                             (1)
so this setup rules out any Î³k0 = Â±âˆ unless xj                     = 0. Note that if we did not know the coefficient
on the special characteristic we would have to estimate it and the moment condition would become

                                                                                   (2)0 (2)
                                                 (1) (1)           Î´j âˆ’ c0 âˆ’ Î²0 xj + Î±0 pj
                           0 = E[Î¾j |zj ] =    âˆ’Î²0 xj      + E[              (2)
                                                                                                 |zj ],
                                                                   1 + Î³00 xj + Î³p0 (yÌ„ âˆ’ pj )

                              (1)
which is satisfied for Î²0 = 0 and any Î³k0 = Â±âˆ , leading to failure of identification.
5        Identification
        In this section we show global identification for the model with Âµij = 0. In the next section we
provide conditions under which our sieve estimator is consistent. In the appendix we provide the
consistency proof for the random coefficients setup with Âµij 6= 0.
        We study identification using the moment conditions (7) and (8). We use controls Vj that both
satisfy the CF condition and are possibly a function of (pj âˆ’ Î (zj )) for j = 1, . . . , J. We write this
function Vj = gj (p1 âˆ’ Î (z1 ), . . . , pJ âˆ’ Î (zJ )) = gj (V1 , . . . , VJ ).8 Vj is identified from the first step
regression of (5), and we treat Î (zj ) and Vj as known throughout the discussion.9
    If Î¸0 and f0 (zj , Vj ) are identified they must be the unique solution to (7) and (8). E [Î´j |zj , Vj ]
is unique with probability one, which implies if there exists any other function Î¸Ì„ and fÂ¯(zj , Vj ) that
satisfies (7) and (8) it must be that

Pr{c0 +Î²00 xj âˆ’Î±0 pj +f0 (zj , Vj )(1+Î³00 xj +Î³p0 (yÌ„âˆ’pj )) = cÌ„+Î²Ì„ 0 xj âˆ’Î±Ì„pj +fÂ¯(zj , Vj )(1+Î³Ì„ 0 xj +Î³Ì„p (yÌ„âˆ’pj ))} = 1.
                                                                                                 (10)
                                                                         Â¯
Therefore, identification means we must have Î¸0 = Î¸Ì„ and f0 (zj , Vj ) = f (zj , Vj ) with probability
one whenever (10) holds.
        Our proof uses the unconstrained version of the moment condition (7)

          0 = E Î´j âˆ’ {c0 + Î²00 xj âˆ’ Î±0 pj + f0 (zj , Vj ) + fx (zj , Vj )0 xj + fp (zj , Vj )(yÌ„ âˆ’ pj )}|zj , Vj
                                                                                                                

    8
     It is possible to modify this proof to allow for more general Vj as defined in Matzkin (2003) (see Kim and Petrin
(2010c)).
   9
     While we proceed assuming price pj is endogenous this is not necessary. We can allow for settings where the
practitioner does not know whether the variable is exogenous or endogenous (see Kim and Petrin (2010b)).




                                                                12
from which we will show (c0 , Î²0 , Î±0 ), f0 (zj , Vj ), fx (zj , Vj ) = Î³0 f0 (zj , Vj ), and fp (zj , Vj ) =
Î³p0 f0 (zj , Vj ) are identified, and thus so are (Î³0 , Î³p0 ). Working with differences Îº(zj , Vj ) = f0 (zj , Vj )âˆ’
fÂ¯(zj , Vj ), Îºx (zj , Vj ) = fx (zj , Vj )âˆ’ fÂ¯x (zj , Vj ), and Îºp (zj , Vj ) = fp (zj , Vj )âˆ’ fÂ¯p (zj , Vj ) we can write
(10) as

             Pr{Ïˆ0 + Ïˆ10 xj + Ïˆ2 pj + Îº(zj , Vj ) + Îº0x (zj , Vj )xj + Îºp (zj , Vj )(yÌ„ âˆ’ pj ) = 0} = 1.           (11)

If (11) holds, for identification we must have Ïˆ0 = 0, Ïˆ1 = 0, Ïˆ2 = 0, Îº(zj , Vj ) = 0, Îºx (zj , Vj ) = 0,
and Îºp (zj , Vj ) = 0 with probability one. We formalize this identification statement in Theorem 2.
Theorem 2 (Identification). Let

           Î¨(xj , pj , Â·; Ïˆ) = Ïˆ0 + Ïˆ10 xj + Ïˆ2 pj + Îº(zj , Vj ) + Îº0x (zj , Vj )xj + Îºp (zj , Vj )(yÌ„ âˆ’ pj ),

and assume the CF condition holds. If (xj , pj ) and (zj , Vj ) do not have a functional relationship of
the form
                          Pr {Î¨(xj , pj , Îº(zj , Vj ), Îºx (zj , Vj ), Îºp (zj , Vj ); Ïˆ) = 0} = 1                   (12)

then the structural parameters Î¸0 = (c0 , Î²00 , Î±0 , Î³00 , Î³p0 )0 are identified.

Proof. The CF condition allows one to move from equation (2) to equation (7) (and thus to equation
(12)). If there exists an additive functional relationship between 1, xj , pj , Îº(zj , Vj ), xj1 Îºx1 (zj , Vj ),
. . ., xjK ÎºxK (zj , Vj ), and (yÌ„ âˆ’ pj )Îºp (zj , Vj ) then (12) must be satisfied. The contrapositive proves
the statement.

       We now use Theorem 2 to show global identification when Î (zj ) and f (zj , Vj ) are differentiable.
Let zj = (x0j , z2j
                 0 )0 and let subscripts with (2), (p ), and (v ) denote partial differentiation with
                                                     j         j
respect to z2j , pj , and Vj . The proof uses differentiability and completeness (from Newey and
Powell (2003)) to show that equation (12) implies Îº(zj , Vj ) is only a function of (pj , xj ). Writing
Îº(zj , Vj ) = ÎºÌƒ(pj , xj ) and using the CMR implies E[Îº(zj , Vj )|zj ] = E[ÎºÌƒ(pj , xj )|zj ] = 0. The
completeness condition then implies Îº(zj , Vj ) = ÎºÌƒ(pj , xj ) = 0 almost surely. The same logic yields
Îºx (zj , Vj ) = 0 a.s., Îºp (zj , Vj ) = 0 a.s., and (Ïˆ0 , Ïˆ1 , Ïˆ2 ) = 0.10

Theorem 3. Assume Î (zj ) and f (zj , Vj ) are differentiable and the one-sided derivatives are con-
tinuous at the boundary of the support of (zj , Vj ). Assume the CF and CMR conditions hold. If
for all functions B(pj , xj ) with finite expectation, E[B(pj , xj )|zj ] = 0 a.s. implies B(pj , xj ) = 0 a.s.
(completeness condition), then Î¸0 is identified.

Proof. Given differentiability, it suffices to consider differentiable ÎºÂ· (zj , Vj ) where ÎºÂ· (zj , Vj ) is
generic notation for Îº(zj , Vj ), Îºx (zj , Vj ), or Îºp (zj , Vj ). Taking derivatives of Î¨(xj , pj , Â·; Ïˆ), we
  10
    We also maintain that the one-sided derivatives of Î¨(xj , pj , Â·; Ïˆ) are continuous at the boundary of the support
of (zj , Vj ), although instead one may alternatively assume that the boundary of the support of (zj , Vj ) has zero
probability (this may require a trimming device to deal with the boundary of the support in the estimation).




                                                           13
obtain

  Î¨(2) (Â·; Ïˆ) = Î (2) (zj )(Ïˆ2 âˆ’ Îºp (zj , Vj )) + Îº(2) (zj , Vj ) + Îº0x,(2) (zj , Vj )xj + Îºp,(2) (zj , Vj )(yÌ„ âˆ’ pj )
 Î¨(vj ) (Â·; Ïˆ) = Ïˆ2 âˆ’ Îºp (zj , Vj ) + Îº(vj ) (zj , Vj ) + Îº0x,(vj ) (zj , Vj )xj + Îºp,(vj ) (zj , Vj )(yÌ„ âˆ’ pj ).

If there is an additive functional relationship then Î¨(Â·; Ïˆ) = 0 with probability one, and also

                                             Î¨(2) (Â·; Ïˆ) = 0 and Î¨(vj ) (Â·; Ïˆ) = 0.

    Premultiplying Î¨(vj ) (Â·; Ïˆ) by Î (2) (zj ) and combining Î¨(2) (Â·; Ïˆ) = 0 and Î (2) (zj )Ã—Î¨(vj ) (Â·; Ïˆ) = 0,
we obtain

                    Î (2) (zj ){Îº(vj ) (zj , Vj ) + Îº0x,(vj ) (zj , Vj )xj + Îºp,(vj ) (zj , Vj )(yÌ„ âˆ’ pj ) âˆ’ Îºp (zj , Vj )}   (13)
            = Îº(2) (zj , Vj ) + Îº0x,(2) (zj , Vj )xj + Îºp,(2) (zj , Vj )(yÌ„ âˆ’ pj ) âˆ’ Î (2) (zj )Îºp (zj , Vj ).

Letting
                                 Î·(Â·) = Îº(zj , Vj ) + Îº0x (zj , Vj )xj + Îºp (zj , Vj )(yÌ„ âˆ’ pj )
            âˆ‚Î·(Â·)
we have     âˆ‚z2j     equal to the right hand side of equation (13). Vj = gj (p1 âˆ’ Î (z1 ), . . . , pJ âˆ’ Î (zJ ))
      âˆ‚Vj
and   âˆ‚pj   = 1 imply
                                               ÎºÂ·,(vj ) (zj , Vj ) = ÎºÂ·,(pj ) (zj , Vj ),

Using (13) it follows that

      âˆ‚Î·(Â·)
               = Î (2) (zj ){Îº(pj ) (zj , Vj ) + Îº0x,(pj ) (zj , Vj )xj + Îºp,(pj ) (zj , Vj )(yÌ„ âˆ’ pj ) âˆ’ Îºp (zj , Vj )}
      âˆ‚z2j
                       âˆ‚pj âˆ‚Î·(Â·)   âˆ‚Î·(Â·) âˆ‚pj
               =                 =
                       âˆ‚z2j âˆ‚pj     âˆ‚pj âˆ‚z2j

implying (a) z2j affects Î·(Â·) and thus ÎºÂ· (zj , Vj ) only through pj . We also know that for all j 0 6= j,
ÎºÂ· (zj , Vj ) is not a function of z2j 0 , so

                                 âˆ‚ÎºÂ· (zj , Vj )/âˆ‚z2j 0 = Î (2) (zj 0 )ÎºÂ·,(vj 0 ) (zj , Vj ) = 0.

Completeness implies the full rank of Î (2) (zj 0 ), which then implies that ÎºÂ·,(vj 0 ) (zj , Vj ) = 0 for all
j 0 6= j so (b) ÎºÂ· (zj , Vj ) is not a function of Vj 0 for j 0 6= j. Combining these two findings (a) and
(b), we conclude

                                     ÎºÂ· (zj , Vj ) = ÎºÂ· (zj , Vj ) = ÎºÂ· (zj , pj âˆ’ Î (zj ))
                                                     = ÎºÌƒÂ· (pj , zj ) = ÎºÌƒÂ· (pj , xj )

for some function ÎºÌƒÂ· (Â·), where the first equality holds by (b) and the last equality holds by (a).
    The CMR condition then implies E[ÎºÂ· (zj , Vj )|zj ] = E[ÎºÌƒÂ· (pj , xj )|zj ] = 0 and from the complete-


                                                                  14
ness condition, it follows that 0 = ÎºÌƒÂ· (pj , xj ) = ÎºÂ· (zj , Vj ) with probability one. Î·(Â·) = 0 coupled with
Î¨(Â·; Ïˆ) = 0 implies Ïˆ0 + Ïˆ10 xj + Ïˆ2 pj = 0. In the special case where we condition on zj , we obtain
E[Ïˆ0 + Ïˆ10 xj + Ïˆ2 pj |zj ] = 0. Full rank of Î (2) (zj ) implies Ïˆ0 = 0, Ïˆ1 = 0, and Ïˆ2 = 0.11 Therefore,
Ïˆ0 = 0, Ïˆ1 = 0, Ïˆ2 = 0, Îº(zj , Vj ) = 0, Îºx (zj , Vj ) = 0, and Îºp (zj , Vj ) = 0 with probability one.
This completes the proof.


         A simple example for a non-linear parametric setup may help to illustrate the mechanism of
identification. Consider the model

                                           Î´j = c0 âˆ’ Î±0 pj + Î¾j + Î³p0 Î¾j (yÌ„ âˆ’ pj )

with E[Î¾j |zj , Vj ] = Ï€0 Vj . Then one can use the unconstrained moment given by E[Î´j âˆ’ (c0 âˆ’
Î±0 pj + Ï€0 Vj + Î³p0 Ï€0 Vj (yÌ„ âˆ’ pj ))|zj , Vj ] = 0 for identification. Specifically, c0 , Î±0 , %0 â‰¡ Î³p0 Ï€0 , and
Ï€0 are globally identified from unconstrained least squares by the uniqueness of the conditional
expectation as long as 1, pj , Vj , and Vj (yÌ„ âˆ’ pj ) do not have a linear relationship. Î³p0 is also identified
from Î³p0 = %0 /Ï€0 as long as Ï€0 6= 0. The theorem shows that for this non-linear model the global
identification condition coincides with the local identification condition for parametric non-linear
models given in Rothenberg (1971), which says the vector of derivatives with respect to parameters
must not be collinear.12
         We can also generalize the identification result to more flexible specifications of utility. Consider
mean utility
                                         Î´j = h1 (xj , pj ) + Î¾j (1 + h2 (xj , yÌ„ âˆ’ pj ))

where h1 (xj , pj ) and h2 (xj , yÌ„ âˆ’ pj ) are nonparametric, and we normalize h2 (xÌƒj , yÌ„ âˆ’ pÌƒj ) = c for some
known constant c at some (xÌƒj , pÌƒj ).

Theorem 4 (Nonparametric Identification with CMR). Assume Î (zj ), h1 (xj , pj ), h2 (xj , yÌ„ âˆ’ pj ),
and f (zj , Vj ) are differentiable and the one-sided derivatives are continuous at the boundary of the
support of (zj , Vj ). Assume the CF and CMR conditions hold. If for all functions B(pj , xj ) with
finite expectation, E[B(pj , xj )|zj ] = 0 a.s. implies B(pj , xj ) = 0 a.s., then (h10 (xj , pj ), h20 (xj , yÌ„ âˆ’
pj )) is identified up to a normalization of h2 (xÌƒj , yÌ„ âˆ’ pÌƒj ) = c for some known constant c at some
(xÌƒj , pÌƒj ).

         The proof strategy is essentially the same as the parametric case (see Kim and Petrin (2010c)).



6         Sieve Estimation and Consistency
         We show consistency of our multi-step sieve estimator for the case when Âµij = 0 (see appendix
    11
     The full rank of Î (2) (zj ) is equivalent to Î (2) (zj ) 6= 0 since pj is scalar.
     In this example the vector of first derivatives w.r.t. (c0 , Î±0 , Î³p0 , Ï€0 )0 is given by (1, âˆ’pj , Ï€0 Vj (yÌ„ âˆ’ pj ), Î³p0 Vj (yÌ„ âˆ’
    12

pj ) + Vj )0 , and they are not collinear as long as Ï€0 6= 0 and 1, pj , Vj , and Vj (yÌ„ âˆ’ pj ) do not have a linear relationship.


                                                                 15
for Âµij 6= 0). In the first stage we estimate Î (zj ) and obtain VÌ‚j = pj âˆ’ Î Ì‚(zj ) for j = 1, . . . , J
and construct VÌ‚j = gj (VÌ‚1 , . . . , VÌ‚J ). In the second step, we construct approximating basis functions
using VÌ‚j and zj , where we subtract out conditional means of underlying basis functions (conditional
on zj ) to approximate f (Â·) that satisfies (8). In the final step we estimate Î¸0 and f0 (Â·) using a sieve
method.
    Let F denote a space of functions that includes the true function f0 , endowed with kÂ·kF a
pseudo-metric on F. We first write the infeasible basis functions (and we replace them with their
estimates below) for f (Â·) when Vj is known as


                                           Ï•Ìƒl (Vj , zj ) = Ï•l (Vj , zj ) âˆ’ Ï•Ì„l (zj )

where Ï•Ì„l (zj ) = E[Ï•l (Vj , zj )|zj ] and {Ï•l (Vj , zj ), l = 1, 2, . . .} denotes a sequence of approximating
basis functions of (Vj , zj ) such as power series or splines. By subtracting out the conditional means
from the underlying basis functions, we let any function f (Â·) in the sieve space defined below satisfy
the requirement (8).
    Let J = M
            P
              m=1 Jm be the sample size where Jm denotes the number products in market m and
M denotes the number of markets and define the (infeasible) sieve space FJ as the collection of
functions
                                                       X
                                  FJ = {f : f =               al Ï•Ìƒl (Vj , zj ), kf kF < CÌ„}
                                                     lâ‰¤L(J)

for some bounded positive constant CÌ„ and coefficients (a1, . . . , aL(J) ), with L(J) â†’ âˆ and L(J)/J â†’
0 such that FJ âŠ† FJ+1 âŠ† . . . âŠ† F, so we use more flexible approximations as the sample size grows.
      We then replace the sequence of the infeasible basis functions Ï•Ìƒl (Vj , zj ) with their estimates as
Ë†
Ï•Ìƒl (VÌ‚j , zj ) = Ï•l (VÌ‚j , zj ) âˆ’ Ï•Ì„Ë†l (zj ). We then define the sieve space constructed using the estimated
basis functions as
                                                         X
                                    FÌ‚J = {f : f =              al Ï•ÌƒË†l (Â·, Â·), kf kF < CÌ„}.              (14)
                                                       lâ‰¤L(J)

Under weak regularity conditions FÌ‚J â†’ FJ (in the Hausdorff metric defined on the metric space
(F, kÂ·kF )) as Î Ì‚(Â·) â†’ Î (Â·) and Ï•Ì„Ë†l (Â·) â†’ Ï•Ì„l (Â·) (in a pseudo-metric kÂ·ks ).
    Denote a sample criterion function QJ (Î´, z, p, VÌ‚; Î¸, f ) for estimation based on the moment con-
dition of (7). If we use nonlinear sieve least squares estimation, then the sample criterion function
becomes
                                 M Jm
                               1 XX
   QJ (Î´, z, p, VÌ‚; Î¸, f ) =          {Î´mj âˆ’ (c + Î² 0 xmj âˆ’ Î±pmj + f (Â·)(1 + Î³ 0 xmj + Î³p (yÌ„m âˆ’ pmj )))}2
                               J
                                 m=1 j=1


subject to (Î¸, f ) âˆˆ Î˜ Ã— FÌ‚J . We define the corresponding population criterion function as

                              M Jm
                            1 XX
Q0J (Î´, z, p, V; Î¸, f )   =        E[{Î´mj âˆ’(c+Î² 0 xmj âˆ’Î±pmj +f (zj , Vj )(1+Î³ 0 xmj +Î³p (yÌ„m âˆ’pmj )))}2 ].
                            J
                               m=1 j=1



                                                              16
Note that below we do not require Q0J (Î´, z, p, V; Î¸, f ) converges when J â†’ âˆ.
    Then we obtain our estimator as

                                  Ë† fË†) = arginf
                                 (Î¸,            (Î¸,f )âˆˆÎ˜Ã—FÌ‚J QJ (Î´, z, p, VÌ‚; Î¸, f ).                             (15)

We derive the consistency of our estimator under the following assumptions based on the results
in Newey and Powell (2003), Chen, Linton, and van Keilegom (2003), and Chen (2006).13 Here
we abstract from the sampling error in the market shares although we allow for it in the proof
of consistency with random coefficients.14 The following assumptions are commonly imposed and
standard in the sieve estimation literature, so we minimize our discussion.
    We first assume identification (see Section 5):
Assumption 1 (A1). (Î¸0 , f0 ) âˆˆ Î˜ Ã— F is the only (Î¸, f ) âˆˆ Î˜ Ã— F 15 satisfying the moment condition
(7) and (8) and Q0J (Î´, z, p, V; Î¸0 , f0 ) < âˆ.

    Next we assume that our extremum estimator solves (15).

Assumption 2 (A2). QJ (Î´, z, p, VÌ‚; Î¸Ì‚, fË†) â‰¤ inf(Î¸,f )âˆˆÎ˜Ã—FÌ‚J QJ (Î´, z, p, VÌ‚; Î¸, f ) + op (1)

    Denote the true functions of Î (Â·) and Ï•Ì„l (Â·) as Î 0 (Â·) and Ï•Ì„0l (Â·), respectively, and assume Î (Â·)
and Ï•Ì„l (Â·) are endowed with a pseudo-metric kÂ·ks . Assumption A3 says that both Î 0 (Â·) and Ï•Ì„0l (Â·)
can be approximated by the first stage and the middle stage series approximations. For example,
this is known to be satisfied for power series and splines approximation if Î 0 (Â·)â€™s and Ï•Ì„0l (Â·)â€™s are
smooth and their derivatives are bounded (e.g., belong to a HÃ¶lder class of functions).

Assumption 3 (A3).           Î Ì‚(Â·) âˆ’ Î 0 (Â·)       = op (1) and Ï•Ì„Ë†l (Â·) âˆ’ Ï•Ì„0l (Â·)   s
                                                                                         = op (1) for all l.
                                              s

Assumption 4 (A4). The sieve space FJ satisfies FJ âŠ† FJ+1 âŠ† . . . âŠ† F for all J â‰¥ 1; and for
any f âˆˆ F there exists Ï€J f âˆˆ FJ such that kf âˆ’ Ï€J f kF â†’ 0 as J â†’ âˆ.

    We maintain the following continuity conditions, which are easy to show for our objective func-
tion.

Assumption 5 (A5). Q0J (Î´, z, p, V; Î¸, f ) is continuous in (Î¸, f ) âˆˆ Î˜ Ã— F.

Assumption 6 (A6). Q0J (Î´, z, p, V; Î¸, fJ ) is continuous in Î (Â·) and Ï•Ì„l (Â·) uniformly for all (Î¸, fJ ) âˆˆ
Î˜ Ã— FJ .

    Next we impose compactness on the sieve space.
  13
     Our problem is different from Newey and Powell (2003)â€™s Theorem 4.1 because we use estimated regressors
                      Ë†l (Â·)) in the main estimation. Our problem is also different from Chen, Linton, and van Keilegom
(functions, Î Ì‚(Â·) and Ï•Ì„
(2003) because we estimate the parametric component (Î¸0 ) and the nonparametric component (f0 ) simultaneously
in the main estimation.
  14
     See Berry, Levinsohn, and Pakes (1995) and Berry, Linton, and Pakes (2004) for explicit treatments of this
sampling error. The contribution of this sampling error to the variance of the estimator will be negligible when the
market size is large.
  15
     The parameter space does not need to be a product space. We use â€œ Â· Ã— Â·â€ for ease of notation throughout the
paper.


                                                            17
Assumption 7 (A7). The parameter space Î˜ is compact and the sieve space, FJ , is compact under
the pseudo-metric || Â· ||F .

          A sufficient condition for compactness is that the sieve space be based on power series or splines.
          The last condition we add is that in the neighborhoods of Î 0 (Â·) and Ï•Ì„0l (Â·), the difference between
the sample criterion function and the population criterion function is small enough when J is large.
16


Assumption 8 (A8). For all positive sequences J = o(1), we have

                                   sup                          QJ (Î´, z, p, V; Î¸, f ) âˆ’ Q0J (Î´, z, p, V; Î¸, f ) = op (1)
              (Î¸,f )âˆˆÎ˜Ã—FJ ,kÎ âˆ’Î 0 ks â‰¤J ,kÏ•Ì„l âˆ’Ï•Ì„0l ks â‰¤J âˆ€l


where Vmj = gj (pm1 âˆ’ Î (zm1 ), . . . , pmJm âˆ’ Î (zmJm )).

Theorem 5. Suppose Assumptions A1-A8 are satisfied. Then Î¸Ì‚ â†’p Î¸0 .

          See appendix for the proof. Kim and Petrin (2010c) also develop the asymptotic distribution
of Î¸Ì‚ in the context of the sieve estimation where both Î (Â·) and Ï•Ì„l (Â·) are nonparametrically esti-
mated. The formulas for standard errors of Î¸Ì‚ developed there can be also used for the parametric
estimation case when the truncated semiparametric model (i.e., with fixed length of sieves) is the
true parametric model.



7          Monte Carlo Evidence
          We demonstrate our estimatorâ€™s performance using Monte Carlo studies on simple demand/pricing
models. We first consider the following demand function (i.e., mean utility of one inside good) where
the endogenous price p interacts with the unobserved demand shock Î¾:

                                                       q = c âˆ’ Î±p + Î³pÎ¾ + Î¾.

Before turning to a single product monopolist setting we consider two reduced form pricing equations

                                            [1] p = 2 + Z + (5 + Z 2 + 5Z)Î¾ + Ï‚
                                            [2] p = Z + (5 + 5Z + Ï‚)Î¾.

Here the instrument Z is an observed supply shifter and Ï‚ is an unobserved cost shock. In the first
design [1], the instrument and the demand error are not additively separable. In the second design
[2] the demand error is not additively separable from the instrument nor the supply-side error.
     16
     Note that Assumption A8       Pcan be PJeasily    satisfied by applying
                                                                         PM a P proper law of large numbers (e.g., Chebychevâ€™s
weak LLN). Define WÌ„J = J1 M           m=1
                                                m
                                               j=1 W mj   and  ÂµÌ„ W
                                                                  J = J
                                                                       1
                                                                            m=1
                                                                                  Jm
                                                                                  j=1 E[Wmj ] for a random vector Wmj . Then
                                                                           W                                   0
it is not difficult to see that Assumption A8 holds if ||WÌ„J âˆ’ ÂµÌ„J || = op (1) with Wmj = vec(wmj wmj             ) and wmj =
           0                                         0                               0
(Î´mj , 1, xmj , pmj , f (zmj , Vmj ), f (zmj , Vmj )xmj , f (zmj , Vmj )(yÌ„m âˆ’ pmj )) for all f âˆˆ FJ such that kÎ  âˆ’ Î 0 ks â‰¤ J
and kÏ•Ì„l âˆ’ Ï•Ì„0l ks â‰¤ J .


                                                                     18
       We generate a simulation data based on these designs with the following distributions: Î¾ âˆ¼
U[âˆ’1/2,1/2] , Ï‚ âˆ¼ U[âˆ’1/2,1/2] , Z = 2 + 2U[âˆ’1/2,1/2] , and they are independent where U[âˆ’1/2,1/2] denotes
the uniform distribution supported on [âˆ’1/2, 1/2]. Note that in these designs, the control V =
p âˆ’ E[p|Z] is not independent of Z. We set the true parameter values (c0 , Î±0 , Î³0 ) = (1, 1, 0.5). The
data is generated with the sample sizes: M = 1, 000 and M = 10, 000. We take one reasonable
sample size and one large sample size because we are interested both in a finite sample performance
and the consistency of our proposed estimator.
       In our third design we consider a single product monopolistic pricing model with a demand
function (i.e., mean utility in the logit demand)

                      q(X, p, Î¾; c, Î², Î±, Î³) = ln s âˆ’ ln(1 âˆ’ s) = c + Î²X âˆ’ Î±p + Î³pÎ¾ + Î¾ and

                                                              exp(q(X, p, Î¾; c, Î², Î±, Î³))
                                 p = argmaxp (p âˆ’ mc)
                                                            1 + exp(q(X, p, Î¾; c, Î², Î±, Î³))
where s is the share of the inside good, X is an observed demand shifter, and we let the marginal cost
be mc = 2+0.5Z2 +(2+2Z2 )Ï‚. In this design we draw a demand shock Î¾ âˆ¼ U[âˆ’1/2,1/2] , a supply-side
shock Ï‚ âˆ¼ Î¾ + U[âˆ’1/2,1/2] , X = U[âˆ’1/2,1/2] , and an observed supply shifter Z2 = X + 2 + 2U[âˆ’1/2,1/2] .
We set the true parameter values (c0 , Î²0 , Î±0 , Î³0 ) = (âˆ’2, 1, 1, 0.5). The data is generated with the
sample sizes: M = 2, 000 and M = 10, 000. We let Z = (X, Z2 )0 .
       We estimate the models using three methods: OLS, 2SLS, and our estimator (CMRCF). Our
estimator is implemented in three steps. First we estimate VÌ‚ = p âˆ’ (Ï€Ì‚0 + Ï€Ì‚10 Z + Ï€Ì‚20 Z 2 + Ï€Ì‚30 Z 3 ) using
OLS and construct approximating functions VÌƒ1 = VÌ‚ , VÌƒ2 = VÌ‚ 2 âˆ’ EÌ‚[VÌ‚ 2 |Z], and others are defined
similarly where EÌ‚[Â·|Z] is implemented by the OLS estimation on (1, Z, Z 2 , Z 3 ).17 In the last step
we estimate the model parameters using nonlinear least squares:
                                 XM                                   XLM             XLM
 (cÌ‚, Î²Ì‚, Î±Ì‚, Î³Ì‚, aÌ‚) = argmin            {qm âˆ’ (c + Î²Xm âˆ’ Î±pm + Î³pm (    al VÌƒml ) +     al VÌƒml )}2 /M
                                    m=1                                              l=1                 l=1

where we let Î² = 0 in designs [1] and [2].
       For the design [1] we use the controls (VÌƒ1 , Z VÌƒ1 , Z 2 VÌƒ1 ) when M = 1, 000 and use (VÌƒ1 , Z VÌƒ1 , Z 2 VÌƒ1 , Z 3 VÌƒ1 , VÌƒ2 )
when M = 10, 000. For the design [2] we use (VÌƒ1 , Z VÌƒ1 , Z 2 VÌƒ1 ) with M = 1, 000 and use (VÌƒ1 ,
Z VÌƒ1 , Z 2 VÌƒ1 , VÌƒ2 ) with M = 10, 000. Finally we use (VÌƒ1 , Z VÌƒ1 , Z 2 VÌƒ1 ) for the design [3] with both
sample sizes.18
       We report the biases and the RMSE based on 100 repetitions of the estimations: OLS, 2SLS,
and our estimator. The simulation results (Tables I-III) clearly show that OLS is biased in all
designs. 2SLS is also biased. Our estimator is robust regardless of different designs for the price.
       In the designs [1]-[3], 2SLS estimates for the constant term (c) are biased (-69%, 21%, -18%
respectively). In the designs [1]-[3] the 2SLS estimates for the coefficient on the price (Î±) are
severely biased (38%, 21%, and -16%). The 2SLS estimates for the coefficient on the exogenous
  17
    In the third design Z l = (X l , Z2l )0 for l = 2, 3 with abuse of notation.
  18
    One can choose an optimal set of controls among alternatives based on the cross validation (CV) criterion,
although the validity of CV may be compromised due to the presence of the first and the second step in our estimation.


                                                              19
demand shifter (Î²) in the design [3] seem not biased.
   From other Monte Carlos (not reported here) we find higher coefficients on Î¾ in the pricing
equation create larger biases for the 2SLS estimates of c and higher coefficients on the interaction
term ZÎ¾ in the pricing equation generate larger biases for the 2SLS estimates of Î±.


    Table I: Design [1], c0 = 1, Î±0 = 1, Î³0 = 0.5, Controls: VÌƒ1 , Z VÌƒ1 , Z 2 VÌƒ1 , Z 3 VÌƒ1 , VÌƒ2
                      mean          bias       RMSE        mean          bias           RMSE
                                M = 1, 000                           M = 10, 000
      OLS        c   1.2081       0.2081        0.2119    1.2037        0.2037          0.2040
                Î±    1.1501       0.1501        0.1503    1.1506        0.1506          0.1506
      2SLS       c   0.3584       -0.6416       0.7461    0.3054       -0.6946          0.7007
                Î±    1.3634       0.3634        0.3765    1.3752        0.3752          0.3760
    CMRCF        c   1.0118       0.0118        0.0523    1.0024        0.0024          0.0245
                Î±    0.9982       -0.0018       0.0132    0.9998       -0.0002          0.0058
                Î³    0.5063       0.0063        0.1276    0.4975       -0.0025          0.0549
     Table II: Design [2], c0 = 1, Î±0 = 1, Î³0 = 0.5, Controls: VÌƒ1 , Z VÌƒ1 , Z 2 VÌƒ1 , VÌƒ2
                      mean          bias       RMSE        mean          bias         RMSE
                                M = 1, 000                           M = 10, 000
      OLS        c   1.3596       0.3596        0.3603    1.3580        0.3580        0.3581
                Î±    1.1333       0.1333        0.1335    1.1337        0.1337        0.1337
      2SLS       c   1.2038       0.2038        0.2195    1.2062        0.2062        0.2072
                Î±    1.2117       0.2117        0.2163    1.2096        0.2096        0.2099
    CMRCF        c   1.0097       0.0097        0.0388    1.0018        0.0018        0.0162
                Î±    0.9960       -0.0040       0.0202    0.9995       -0.0005        0.0083
                Î³    0.5089       0.0089        0.1499    0.5014        0.0014        0.0626
    Table III: Design [3], c0 = âˆ’2, Î²0 = 1, Î±0 = 1, Î³0 = 0.5, Controls: VÌƒ1 , Z VÌƒ1 , Z 2 VÌƒ1
                      mean           bias       RMSE        mean           bias           RMSE
                                 M = 2, 000                           M = 10, 000
      OLS        c   -2.7465       -0.7465       0.7469    -2.7484       -0.7484          0.7485
                Î²     0.9438       -0.0562       0.0777     0.9453       -0.0547          0.0587
                Î±     0.7496       -0.2504       0.2505     0.7487       -0.2513          0.2513
      2SLS       c   -2.2934       -0.2934       0.3561    -2.3637       -0.3637          0.3778
                Î²     1.0007       0.0007        0.0673     0.9955       -0.0045          0.0274
                Î±     0.8617       -0.1383       0.1470     0.8437       -0.1563          0.1583
    CMRCF        c   -1.9316       0.0684        0.2472    -2.0092       -0.0092          0.0978
                Î²     1.0048       0.0048        0.0735     1.0024        0.0024          0.0261
                Î±     1.0143       0.0143        0.0600     0.9942       -0.0058          0.0245
                Î³     0.4929       -0.0071       0.2274     0.5067        0.0067          0.1464



                                                          20
8          Non-separability in the BLP Automobile Data
          We revisit the original Berry, Levinsohn, and Pakes (1995) automobile data to investigate
whether interaction terms are important for own- and cross-price elasticities. There are 2217
market-level observations on prices, quantities, and characteristics of automobiles sold in the 20
U.S. automobile markets indexed m beginning in 1971 and continuing annually to 1990. We let
Jm denote the number products in market m and include the same characteristics: horsepower-
to-weight, interior space, a/c standard, and miles per dollar. We do not use a supply side model
when we estimate the demand side model so our point estimates only exactly match their estimated
specifications for the cases they examine without the supply side.19
          We decompose utility into three components as in equation (1), with the utility common to all
consumers Î´mj given as

                                                          4
                                                          X
                     Î´mj = c + Î² 0 xmj âˆ’ Î±pmj + Î¾mj +           Î³k xmjk Î¾mj + Î³p (yÌ„m âˆ’ pmj )Î¾mj .
                                                          k=1

When (Î³1 , Î³2 , Î³3 , Î³4 , Î³p ) 6= 0 either characteristics or price are not separable from the demand error.
We parameterize Âµij (Ïƒ) as
                                                              4
                                                              X
                                          Âµij = Ïƒc Î½ic +            Ïƒk Î½ik xjk
                                                              k=1

with Î½i = (Î½ic , Î½i1 , . . . , Î½i4 ) mean-zero standard normal and Ïƒ = (Ïƒc , Ïƒ1 , . . . , Ïƒ4 ) the standard devia-
tion parameters associated with the taste shocks. The induced vector of tastes for each car j for con-
sumer i is given as Âµi (Ïƒ) = (Âµi1 (Ïƒ), . . . , ÂµiJ (Ïƒ)) with density f (Âµi (Ïƒ)). Letting Î´m = (Î´m1 , . . . , Î´mJm )
the market share of product j is then

                                                          eÎ´mj +Âµij
                                                    Z
                                      smj (Î´m ) =       J
                                                                      f (Âµ)dÂµ,
                                                          m
                                                            eÎ´mk +Âµik
                                                        P
                                                        k=0


and we approximate this integral with standard simulation techniques.
8.1         Controls
          We use the mean projection residuals for price as the starting point for controls. Following
Berry, Levinsohn, and Pakes (1995) we assume all observed product characteristics are exogenous
and denote these variables for market m as Zm . The mean projection residual is given as an estimate
of
                                          Î¾Ëœmj = pmj âˆ’ E[ pmj | Zm ].

          There are many instruments so we follow Berry, Levinsohn, and Pakes (1995) and Pakes (1996),
reducing this set to 15 instruments for each good j that we denote zÌƒmj . These instruments include
     19
    We focus on the demand side for three reasons: it makes the comparison more transparent, most researchers do
not impose a supply side model when estimating demands, and the results are easier to replicate.


                                                         21
jâ€™s product characteristics, the sum of each of the product characteristics across all goods in market
m produced by the same firm producing j, and the sum in market m of each of the product
characteristics across all other firms not producing j. Our first control is then given as

                                         Î¾Ëœmj = pmj âˆ’ E[ pmj | zÌƒmj ],

and we estimate the expectation using ordinary least squares.
   The control function in our setup is given as f (zj , Vj ) = E[Î¾j |zj , Vj ] and for consistency setting
Vj = Î¾Ëœmj is sufficient. However, f (zj , Vj ) is a new regressor in our setting, and more variation
in this regressor can help to improve precision of the parameter estimates. We add two additional
controls that may lead to an increase in the variation of E[Î¾j |zj , Vj ] . Following the logic used in
refining the instrument set, we use
                                                          X
                                            Î¾Ëœ(1)mj =               Î¾Ëœmk
                                                        k6=j,kâˆˆJf


and
                                                          X
                                              Î¾Ëœ(2)mj =          Î¾Ëœmk ,
                                                          kâˆˆJ
                                                           / f

where Jf is the set of products produced by the firm that produces the product j. These controls
are respectively the sum of all of the other residuals of the products made by the same firm, given
by Î¾Ëœ(1)mj , and the sum of all the residuals of all the products made by other firms, given by Î¾Ëœ(2)mj .
   Based on these Î¾Ëœmj , Î¾Ëœ(1)mj , and Î¾Ëœ(2)mj , we generate the following nine controls that we use for
our estimation:

          V1mj     = Î¾Ëœmj , V2mj = Î¾Ëœmj
                                     2
                                        âˆ’ E[Î¾Ëœmj
                                              2
                                                 |zÌƒmj ], V3mj = Î¾Ëœmj
                                                                   3
                                                                      âˆ’ E[Î¾Ëœmj
                                                                            3
                                                                               |zÌƒmj ],
          V4mj     = Î¾Ëœ(1)mj , V5mj = Î¾Ëœ(1)mj
                                        2
                                              âˆ’ E[Î¾Ëœ(1)mj
                                                    2
                                                          |zÌƒmj ], V6mj = Î¾Ëœ(1)mj
                                                                            3
                                                                                  âˆ’ E[Î¾Ëœ(1)mj
                                                                                        3
                                                                                              |zÌƒmj ],
          V7mj     = Î¾Ëœ(2)mj , V8mj = Î¾Ëœ(2)mj
                                        2
                                              âˆ’ E[Î¾Ëœ(2)mj
                                                    2
                                                          |zÌƒmj ], V9mj = Î¾Ëœ(2)mj
                                                                            3
                                                                                  âˆ’ E[Î¾Ëœ(2)mj
                                                                                        3
                                                                                              |zÌƒmj ].

Our model for Î´mj then becomes

                  Î´mj = c + Î² 0 xmj âˆ’ Î±pmj + f (zÌƒmj , VÌ‚mj )(1 + Î³ 0 xmj + Î³p (yÌ„m âˆ’ pmj )),
                                             P9
where we approximate f (zÌƒmj , VÌ‚mj ) =         l=1 Ï€l VÌ‚lmj   with parameters Ï€ = (Ï€1 , . . . , Ï€9 ) to be esti-
mated.
8.2    Estimation
   Letting Î¸ = (c, Î² 0 , Î±, Î³ 0 , Î³p )0 we have three sets of parameters to identify given by (Ïƒ, Î¸, Ï€).
Estimation proceeds as in Berry, Levinsohn, and Pakes (1995). Given a value of Ïƒ, we use the
contraction mapping to solve for the vector Î´Ìƒm (Ïƒ) that satisfies s(Ïƒ, Î´(Ïƒ)) = sData . Î´Ìƒm (Ïƒ) then
becomes the regressand in the non-linear least squares objective function given as



                                                        22
                           M Jm
                         1 XX
QJ (Î¸(Ïƒ), Ï€(Ïƒ); Ïƒ) = min        {Î´Ìƒmj (Ïƒ)âˆ’(c+Î² 0 xmj âˆ’Î±pmj +f (zÌƒmj , VÌ‚mj )(1+Î³ 0 xmj +Î³p (yÌ„m âˆ’pmj )))}2
                     Î¸,Ï€ J
                                 m=1 j=1

             PM                                   P9
with J =       m=1 Jm    and f (zÌƒmj , VÌ‚mj ) =     l=1 Ï€l VÌ‚lmj .   This procedure is used iteratively to minimize
QJ (Î¸(Ïƒ), Ï€(Ïƒ); Ïƒ) over Ïƒ, yielding parameter estimates (ÏƒÌ‚, Î¸Ì‚, Ï€Ì‚) = (ÏƒÌ‚, Î¸Ì‚(ÏƒÌ‚), Ï€Ì‚(ÏƒÌ‚)) such that ÏƒÌ‚ =
argminÏƒ QJ (Î¸(Ïƒ), Ï€(Ïƒ); Ïƒ) .
8.3       Results
       The first three columns of Table 1 report results for different specifications in the case where
Âµij = 0, so the dependent variable is Î´mj = ln(smj ) âˆ’ ln(sm0 ), where smj and sm0 denote respectively
the observed market shares in market m for good j and for the outside good. Column 4 reports
results with Âµij 6= 0, with the market vector Î´m then recovered from matching observed to predicted
market shares conditional on all parameters not entering into mean utility. Table 2 reports the
implied demand elasticities.
       The results for the separable error and exogenous price case are in Column 1 of Table 1 and
they replicate those results from the first column of Table III in BLP. The price coefficient increases
from -0.088 to -0.136 when we move from OLS to 2SLS, suggesting prices are endogenous, as noted
in Berry, Levinsohn, and Pakes (1995).20
       Column 3 includes our CMRCF results where we do not impose (Î³, Î³p ) = 0. The additively
separable specification is rejected at 5% as the p-value for H0 :(Î³0 , Î³p0 ) = 0 is 0.019, although no
single interaction term is significant on its own. The point estimate on the interaction term for price
is negative but not significant, and thus only suggestive that the marginal utility of income declines
as the demand error increases.
       Most relevant for estimates of price elasticities is the bias in the 2SLS price coefficient estimate
induced by the correlation between the instrumented price and the interaction term in the error.
The price coefficient Î± increases from -0.136 to -0.232 and is also significantly different from the
coefficient from 2SLS. The sign of the bias coupled with a negative estimate for the interaction term
on price suggests that there is positive correlation between âˆ’pÌ‚j and (yÌ„ âˆ’ pj )Î¾j conditional on xj in
the automobile data.
       Column 4 allows for random coefficients in the non-separable specification. Horsepower/weight
and miles-per-dollar have significant Ïƒk0 s, but with the exception of the point estimate for Î²k on
Horsepower/weight, all of the other point estimates from Column 3 are largely the same. The
  20
     While it does not change the substance of either their findings or our findings, we were not able to exactly
replicate the results for their 2SLS estimator using the optimal instruments described in their paper. We find a price
coefficient that is somewhat smaller than their original reported finding of -0.21. While we can only speculate as to
the source of the difference, we suspect it lies in the instruments they used for these results, as we are able to replicate
the OLS point estimates and standard deviations in their paper. Also consistent with this hypothesis is the fact that
our estimate of -0.13 falls well within +/- two standard deviations of their estimate, as their standard deviation was
-0.12. The significantly smaller standard deviation on our price coefficient also suggests the instruments they used
for that specification - whatever they might of been - were not nearly as â€œoptimalâ€ as the instruments they propose
in the paper, for which we find a much smaller standard deviation on the price coefficient.


                                                            23
                       Table 1: Estimated Parameters for Automobile Demand
     No Correction, 2SLS, CMRCF (w/ Interactions), RandomCoefficient-CMRCF (w/ Interactions)
                                     Dependent Variable is Î´bmj
                                          No              2SLS         CMRCF      RC-CMRCF
 Parameter             Variable            Correctionâˆ—      (No Interactions)      (w/ Interactions)      (w/Interactions)
 Term on Price         price                      -0.088                -0.136                 -0.232                 -0.233
                                                 (0.004)               (0.011)                (0.019)                (0.019)
 Mean                  Constant                  -10.071                -9.915                 -9.661                 -9.332
 Parameters                                      (0.252)               (0.263)                (0.290)                (0.317)
                       HP/Weight                  -0.122                 1.226                  2.813                  1.019
                                                 (0.277)               (0.404)                (0.527)                (1.074)
                       Air                        -0.034                 0.486                  1.384                  1.410
                                                 (0.072)               (0.133)                (0.179)                (0.186)
                       MP$                         0.265                 0.172                  0.104                  0.121
                                                 (0.043)               (0.049)                (0.054)                (0.056)
                       Size                        2.342                 2.292                  2.365                  2.409
                                                 (0.125)               (0.129)                (0.140)                (0.148)
 Interaction           (yÌ„-price)Â·Î¾                                                            -0.043                 -0.042
 Parameters                                                                                   (0.041)                (0.044)
                       HP/WeightÂ·Î¾                                                              1.158                  1.258
                                                                                              (1.809)                (2.071)
                       AirÂ·Î¾                                                                    0.514                  0.627
                                                                                              (0.636)                (0.814)
                       MP$Â·Î¾                                                                   -0.096                 -0.145
                                                                                              (0.116)                (0.153)
                       SizeÂ·Î¾                                                                   0.262                  0.368
                                                                                              (0.728)                (0.993)
 Std. Deviations       Constant                                                                              0.042   (0.228)
                       HP/Weight                                                                             2.214   (0.792)
                       Air                                                                                   0.034   (0.578)
                       MP$                                                                                   0.083   (0.014)
                       Size                                                                                  0.001   (0.181)
 Control Ftns          V1                                                                       2.605                  2.388
                                                                                              (2.683)                (2.702)
                       V2                                                                      -0.898                 -0.716
                                                                                              (1.606)                (1.453)
                       V3                                                                       0.114                  0.087
                                                                                              (0.774)                (0.689)
                       V4                                                                      -0.530                 -0.485
                                                                                              (0.533)                (0.536)
                       V5                                                                       0.063                  0.067
                                                                                              (0.132)                (0.132)
                       V6                                                                       0.799                  0.740
                                                                                              (0.805)                (0.820)
                       V7                                                                      -0.062                 -0.062
                                                                                              (0.099)                (0.099)
                       V8                                                                       0.216                  0.214
                                                                                              (0.233)                (0.248)
                       V9                                                                      -0.081                 -0.083
                                                                                              (0.192)                (0.187)
The data are identical to BLP (1995). Column 1 replicates estimates for the model of their first column of results in their Table
III. The second column uses the same instruments from BLP and estimates 2SLS for the characteristics used in Column 1.
The third column reports estimates of our CMRCF approach. The last column reports the CMRCF estimates of the random
coefficients model with interactions. We do not impose a supply side model during estimations. Standard errors reported for
our CMRCF and RC-CMRCF estimators are robust to heteroskedasticity and account for the â€œfirst and second-stage estimatesâ€
following Kim and Petrin (2010c). The p-value for H0 :all the interaction parameters equal to zero is 0.019 for the CMRCF
and is 0.036 for the RC-CMRCF.
                                                               24
presence of the random coefficients does not change the fact that H0 :(Î³0 , Î³p0 ) = 0 is rejected at 5%
as the p-value is 0.036, and the coefficient on the price coefficient changes from 0.232 to 0.233 and
the price interaction term from -0.043 to -0.042.
       Table 2 translates these estimates into elasticities. Berry, Levinsohn, and Pakes (1995) report
elasticities for selected automobiles from 1990, so we do the same, choosing every fourth automobile
from their Table III, in which vehicles are sorted in order of ascending price. The first column
uses the uncorrected logit specification from Column 1 of Table III in BLP (1995).21 Ignoring price
endogeneity severely biases price elasticities towards zero. As we control the endogeneity using the
2SLS the price elasticities change significantly and become more elastic, as the median elasticity
moves from -0.77 to -1.18. However, biggest change comes when we move from 2SLS to our CMRCF
approach allowing for interactions, as the median elasticity increases from -1.18 to -2.05, and the
mean elasticity increases from -1.60 to -2.65. Adding the random coefficients to the non-separable
specification has very little effect on the elasticities reported in Table 2, as is clear from examining
columns three and four.
                                                    Table 2
                       Automobile Elasticities: No Correction, 2SLS (without Interactions),
                           CMRCF, and RandomCoefficient-CMRCF (with Interactions)
                                                No Correction1   2SLS CMRCF RC-CMRCF
                 Interactions                               No     No         Yes             Yes
                 Results for 1971-1990
                    Median                                -0.77 -1.18       -2.05           -2.04
                    Mean                                  -0.75 -1.60       -2.65           -2.65
                    Standard Deviation                     0.34   1.17       1.69            1.70
                    No. of Inelastic Demands               68%    21%         4%              4%

                 Elasticities from 1990
                    Median                                      -0.93   -1.43        -2.80            -2.79
                    Mean                                        -0.91   -1.90        -3.23            -3.24
                    Standard Deviation                           0.46    1.28         1.85             1.87
                    No. of Inelastic Demands                     53%     12%           2%               2%

                 1990 Models (from BLP, Table VI):
                    Mazda 323                                   -0.44   -0.69        -1.61            -1.61
                    Honda Accord                                -0.81   -1.26        -1.42            -1.47
                    Acura Legend                                -1.67   -2.57        -4.17            -4.20
                    BMW 735i                                    -3.39   -5.09        -7.14            -7.26

The uncorrected specification is that from Table III of BLP (1995). 1990 is the year BLP focus
on for the individual models; we choose every fourth automobile from their Table VI (the other
elasticities were also very similar).



  21
       Because the data sets are the same, these are the same elasticities that result from the coefficients of their Table
III.




                                                             25
9    Conclusion
    We show how to allow for interactions in the utility function between the unobserved demand
factor and observed factors including price in a discrete choice demand setting. We start by noting
that when endogenous variables interact with the demand error the inversion and contraction from
Berry (1994) and Berry, Levinsohn, and Pakes (1995) can still be used to recover mean utility.
However, the standard IV approach is no longer consistent because the price interaction term is
correlated with the instrumented price. Furthermore, the conditional mean restrictions (CMR) used
for identification in Berry (1994) and Berry, Levinsohn, and Pakes (1995) are no longer sufficient
for identification.
    We show how to consistently estimate demand parameters while allowing for both endogenous
and exogenous variables to interact with the error. We couple the standard CMRs with new moment
conditions that we call â€œgeneralized control function moments.â€ We require only the use of the
exact same instruments used in the separable setting. Our approach thus extends the non-separable
demand literature as we do not require that our controls be one-to-one with the unobserved factors,
as in Bajari and Benkard (2005) or Kim and Petrin (2010a).
    We develop a sieve semiparametric estimator for the nonseparable demand models. Given mean
utility it is a simple three-step estimator to recover the parameters subsumed in the mean utility
term, including those parameters on the interaction terms. Monte Carlos suggest standard IV
estimators in the non-separable setting perform poorly, while our approach is consistent. Using the
same automobile data as was used in Berry, Levinsohn, and Pakes (1995), our estimates reveal that
the interactions terms are significant and the demand elasticities become 60% more elastic relative
to the standard IV estimator, primarily because the coefficient on price changes substantially when
the interaction terms are included.




                                                26
A      Proof of Consistency (Theorem 5)
We prove the consistency by extending Chen (2006)â€™s consistency proof for sieve extremum estima-
tors allowing for pre-step estimates. We first show that any (infeasible) estimator, (Î¸Ìƒ, fËœ) defined as
any sequence that satisfies the following is consistent:

                          QJ (Î´, z, p, VÌ‚; Î¸Ìƒ, fËœ) â‰¤ inf(Î¸,f )âˆˆÎ˜Ã—FJ QJ (Î´, z, p, VÌ‚; Î¸, f ) + op (1).                           (16)

   Let Îµ > 0 be any small real numbers. Any estimator (Î¸Ìƒ, fËœ) that satisfies (16) also satisfies that
with probability approaching to one (w.p.a.1), QJ (Î´, z, p, VÌ‚; Î¸Ìƒ, fËœ) < QJ (Î´, z, p, VÌ‚; Î¸, fJ ) + Îµ for all              6
(Î¸, fJ ) âˆˆ Î˜ Ã— FJ . From the fact that Î¸0 âˆˆ Î˜ and Ï€J f0 âˆˆ FJ , it follows that QJ (Î´, z, p, VÌ‚; Î¸Ìƒ, fËœ) <
QJ (Î´, z, p, VÌ‚; Î¸0 , Ï€J f0 ) + 6Îµ . Then by Assumption A8 and the consistency of the pre-stage estimators
(A3), we have w.p.a.1, Q0 (Î´, z, p, VÌ‚; Î¸Ìƒ, fËœ) âˆ’ QJ (Î´, z, p, VÌ‚; Î¸Ìƒ, fËœ) < Îµ and Q0 (Î´, z, p, VÌ‚; Î¸0 , Ï€J f0 ) âˆ’
                                      J                                                           6           J
QJ (Î´, z, p, VÌ‚; Î¸0 , Ï€J f0 ) >      âˆ’ 6Îµ .    It follows that w.p.a.1,

                                  Îµ
      Q0J (Î´, z, p, VÌ‚; Î¸Ìƒ, fËœ) âˆ’             < QJ (Î´, z, p, VÌ‚; Î¸Ìƒ, fËœ)
                                  6
                                                                                   Îµ                                   Îµ Îµ
                                              < QJ (Î´, z, p, VÌ‚; Î¸0 , Ï€J f0 ) +      < Q0J (Î´, z, p, VÌ‚; Î¸0 , Ï€J f0 ) + + .
                                                                                   6                                   6 6

Next we note that by the continuity assumption (A6) and the consistency of the pre-stage estimators
(A3), we have w.p.a.1, Q0 (Î´, z, p, V; Î¸Ìƒ, fËœ) âˆ’ Q0 (Î´, z, p, VÌ‚; Î¸Ìƒ, fËœ) < Îµ and Q0 (Î´, z, p, V; Î¸0 , Ï€J f0 ) âˆ’
                                      J                              J                            6           J
Q0J (Î´, z, p, VÌ‚; Î¸0 , Ï€J f0 )   >   âˆ’ 6Îµ .    It follows that w.p.a.1,

                                                     Îµ                                 Îµ 3Îµ
                           Q0J (Î´, z, p, V; Î¸Ìƒ, fËœ) âˆ’ < Q0J (Î´, z, p, V; Î¸0 , Ï€J f0 ) + + .
                                                     6                                 6 6

By A1 and A5 (continuity) and the fact that kf0 âˆ’ Ï€J f0 kF â†’ 0 as J â†’ âˆ, for all J > J0 large
enough we have Q0J (Î´, z, p, V; Î¸0 , Ï€J f0 ) < Q0J (Î´, z, p, V; Î¸0 , f0 ) + 6Îµ . It follows that

                                       Q0J (Î´, z, p, V; Î¸Ìƒ, fËœ) < Q0J (Î´, z, p, V; Î¸0 , f0 ) + Îµ.                               (17)

Next note that for any  > 0, by A4, A5(continuity), A7 (compactness),

                                                          inf                   Q0J (Î´, z, p, V; Î¸, f )
                                     {(Î¸,f )âˆˆÎ˜Ã—FJ :||Î¸âˆ’Î¸0 ||+||f âˆ’f0 ||F â‰¥}


exists (it can vary by J). Then by A1 (identification) and the fact that FJ âŠ‚ F, it must be that

                  Q0J (Î´, z, p, V; Î¸0 , f0 ) <                            inf                    Q0J (Î´, z, p, V; Î¸, f ).
                                                       {(Î¸,f )âˆˆÎ˜Ã—FJ :||Î¸âˆ’Î¸0 ||+||f âˆ’f0 ||F â‰¥}


Take Îµ small enough that inf {(Î¸,f )âˆˆÎ˜Ã—FJ :||Î¸âˆ’Î¸0 ||+||f âˆ’f0 ||F â‰¥} Q0J (Î´, z, p, V; Î¸, f )âˆ’Q0J (Î´, z, p, V; Î¸0 , f0 ) â‰¥
Îµ. Then from (17) it follows that w.p.a.1, Q0 (Â·; Î¸Ìƒ, fËœ) < inf {(Î¸,f )âˆˆÎ˜Ã—F :||Î¸âˆ’Î¸ ||+||f âˆ’f || â‰¥} Q0 (Â·; Î¸, f ).
                                                                J                                  J      0         0 F     J
Then by A5 (continuity) and the fact that (Î¸Ìƒ, fËœ) âˆˆ Î˜ Ã— FJ , we conclude ||Î¸Ìƒ âˆ’ Î¸0 || + ||fËœ âˆ’ f0 ||F < .
This proves any estimator, (Î¸Ìƒ, fËœ) that satisfies (16) is consistent. Next we note that our estimator


                                                                         27
(Î¸Ì‚, fË†) satisfies the following, so is consistent:

                    QJ (Î´, z, p, VÌ‚; Î¸Ì‚, fË†) â‰¤ inf(Î¸,f )âˆˆÎ˜Ã—FÌ‚J QJ (Î´, z, p, VÌ‚; Î¸, f ) + op (1)
                                            = inf(Î¸,f )âˆˆÎ˜Ã—FJ QJ (Î´, z, p, VÌ‚; Î¸, f ) + op (1)

where the first inequality holds by Assumption A2 (extremum estimator) and the second equality
holds because FÌ‚J â†’ FJ by Assumption A3 and QJ (Î´, z, p, VÌ‚; Î¸, f ) is continuous in f .


B     Consistency Theorem for Random Coefficients Logit Models
We extend Berry, Linton, and Pakes (2004)â€™s consistency theorem to the case of our estimator.
In proofs of consistency for estimators of random coefficients models, when the asymptotics are
in the number of products Berry, Linton, and Pakes (2004) argue against maintaining uniform
convergence of the objective function and our proof accordingly avoids it. We heavily borrow
notation and regularity conditions from Berry, Linton, and Pakes (2004). The key complication is
that our estimator is a multi-step estimator, so we need to control the approximation errors from
pre-step estimators together with two other sources of errors, the sampling error in the observed
shares and the simulation error in the simulated distribution of the random coefficients.
    For transparency here we suppress the market index and assume the data is from a single market,
M = 1. The theorem naturally extends to the data of the multiple markets.
    Let Î½(x, p, Î¾, Î», Î¸, Î¸Î» ) be a J Ã— 1 share function specific to a household type Î» and P (Î») be the
distribution of Î» that represents household heterogeneity. Then the vector of aggregate market
shares predicted by the random coefficients model at given values of the parameters Î¸ in the mean
utility, the parameter Î¸Î» in P (Î»), x,p, Î¾, and P are
                                                             Z
                         Ïƒ(Î´(x, p, Î¾, Î¸), x, p, Î¸Î» , P ) =       Î½(x, p, Î¾, Î», Î¸, Î¸Î» )dP (Î»).

Note that our notation allows for random coefficients on (x, p) but not Î¾, so Î¾ appears only in the
mean utility. The function Ïƒ(Â·) maps the appropriate product space to the J + 1 dimensional unit
simplex for shares,

                                                                                     J
                                                                                     X
                   SJ = {(s0 , . . . , sJ )0 |0 â‰¤ sj â‰¤ 1 for j = 0, . . . , J, and         sj = 1}.
                                                                                     j=0


The actual market shares in the population are given by evaluating Ïƒ(Î´(Â·, Î¸), x, p, Î¸Î» , P ) at (Î¸0 ,Î¸Î»0 ,P 0 ),
the true value of Î¸,Î¸Î» , and P .
    As the first source of error in the implementation of the random coefficients model we approxi-
mate P 0 by simulating it with P R , the empirical measure of some i.i.d. sample Î»1 , . . . , Î»R such that




                                                         28
(e.g.)
                                               Z                                               R
                                                                                         1 X
             Ïƒ(Î´(Â·, Î¸), x, p, Î¸Î» , P R ) =          Î½(x, p, Î¾, Î», Î¸, Î¸Î» )dP R (Î») =          Î½(x, p, Î¾, Î»r , Î¸, Î¸Î» ).
                                                                                         R
                                                                                             r=1

The second source of error is the sampling error in observed market shares sn , typically constructed
from n i.i.d. draws from the population of consumers. We denote by s0 , the population market
shares. We assume Berry, Linton, and Pakes (2004)â€™s Assumption A1 that regulates the simulation
errors and the sampling errors.
                                                              1   Pn
Assumption 9. The market shares snj =                         n    i=1 1(Ci      = j), where Ci is the choice of the i-th
consumer, and Ci are i.i.d. across i. For any fixed (x, p, Î¾, Î¸,Î¸Î» ),

                                                                                         R
                                                                                     1 X
                Ïƒj (Î´(Â·, Î¸), x, p, Î¸Î» , P R ) âˆ’ Ïƒj (Î´(Â·, Î¸), x, p, Î¸Î» , P 0 ) =          Îµj,r (Î´(Â·, Î¸), x, p, Î¸Î» ),
                                                                                     R
                                                                                         r=1

where Îµj,r (Î´(Â·, Î¸), x, p, Î¸Î» ) is bounded, continuous, and differentiable in Î´(Â·, Î¸), Î¸, and Î¸Î» .

    The following regularity conditions on Ïƒ(Î´(Â·, Î¸), x, p, Î¸Î» , P ) are from Assumption A2 of Berry,
Linton, and Pakes (2004) but the key difference is that we require some conditions to hold in terms
of the mean utility Î´(Â·, Î¸) rather than Î¾. As consequences, our assumption can be weaker than
Assumption A2 of Berry, Linton, and Pakes (2004) because we allow that Î´j (Â·, Î¸) is not necessarily
monotonic in Î¾j (so Ïƒj (Î´(Â·, Î¸), x, p, Î¸Î» , P ) does not need to be monotonic in Î¾j ) in our models with
interactions. But note that we specifically consider the random coefficients logit model while Berry,
Linton, and Pakes (2004) is applicable to other models too.

Assumption 10. (i) For every finite J, for all finite Î´ and Î¸Î» âˆˆ Î˜Î» , and for all P in a neighborhood
         âˆ‚Ïƒj (Î´,Â·,Î¸Î» ,P )                                                                                       âˆ‚Ïƒj (Î´,Â·,Î¸Î» ,P )
of P 0 ,      âˆ‚Î´k         exists, and is      continuously differentiable in both Î´ and Î¸Î» , with                    âˆ‚Î´j         >   0,
                      âˆ‚Ïƒj (Î´,Â·,Î¸Î» ,P )                        âˆ‚Ïƒ(Î´,Â·,Î¸Î» ,P )
and   for k 6= j,          âˆ‚Î´k         â‰¤ 0.   The matrix          âˆ‚Î´ 0         is invertible for all J; (ii)   s0j > 0 for all       j;
(iii) For every finite J, for all Î¸ âˆˆ Î˜, Î´(Â·, Î¸) is continuously differentiable in Î¸.

    We outline our estimation procedure for which we show the consistency specifically. We first
obtain the mean utility Î´ âˆ— = Î´ âˆ— (x, p, Î¸Î» , s, P ) that solves

                                                     s âˆ’ Ïƒ(Î´ âˆ— , x, p, Î¸Î» , P ) = 0

and this solution is unique under the conditions outlined in BLP (1995), which we maintain here.
Therefore s and Î´ âˆ— are in one-to-one relation for any Î¸Î» and P . Then by the implicit function
theorem, Dieudonne (1969)(Theorem 10.2.1), and Assumption 9, the mapping Î´ âˆ— (x, p, Î¸Î» , s, P ) is
continuously differentiable in Î¸Î» ,s, P , in some neighborhood. Moreover, Assumption 10 above allows
us to expand the inverse map from (x, p, Î¸Î» , sn , P ) to Î´ âˆ— (Â·) around s0 , which in turn facilitates
controlling the sampling error to show the consistency. As the convention, we let the true value of
Î´ âˆ— , Î´ âˆ—0 = Î´ âˆ— (x, p, Î¸Î»0 , s0 , P 0 ) be the solution to

                                                   s0 âˆ’ Ïƒ(Î´ âˆ— , x, p, Î¸Î»0 , P 0 ) = 0.

                                                                   29
Note that in the additive models where Î¾j enters additively in Î´j (Â·, Î¸), inverting Î¾ is equivalent to
inverting Î´ âˆ— but in non-additive models it is convenient to characterize the inversion in term of
the mean utility. First some regularity conditions below regarding Î´ âˆ— (Â·) does not depend on Î¸, the
parameters in the mean utility. Given Î¸Î» , i.e., Î´ âˆ— (Â·, Î¸Î» , Â·) the estimation procedure of the mean
utility parameters is identical to that of the model (in Section 6) without random coefficients when
we treat Î´ âˆ— (Â·, Î¸Î» , Â·) as the actual mean utility.
    We need to specify the mean utility for estimation (e.g.)

                     Î´jâˆ— = Î´j (xj , pj , Î¾j , Î¸) = c + Î² 0 xj âˆ’ Î±pj + Î¾j + Î³ 0 xj Î¾j + Î³p (yÌ„ âˆ’ pj )Î¾j .

Then the moment condition (that corresponds to (7) for the model without random coefficients) we
use becomes

   0 = E Î´jâˆ— (xj , pj , Î¸Î»0 , s0 , P 0 ) âˆ’ {c0 + Î²00 xj âˆ’ Î±0 pj + f0 (zj , Vj )(1 + Î³00 xj + Î³p0 (yÌ„ âˆ’ pj ))}|zj , Vj
                                                                                                                     


for j = 1, . . . , J where f0 (zj , Vj ) = E[Î¾j |zj , Vj ]. In the estimation we replace s0 with sn and
Î´ âˆ— (Â·, s0 , P 0 ) with Î´ âˆ— (Â·, sn , P R ). We also approximate Vj with VÌ‚j and approximate f0 with a function
in the sieve space FÌ‚J defined in (14). Therefore we obtain the estimator (Î¸Ì‚, Î¸Ì‚Î» , fË†(Â·)) that minimizes
the sample criterion function such that

                       Ë† Î¸Ì‚Î» , fË†) = arginf                          âˆ—          n   R
                      (Î¸,                  (Î¸,Î¸Î» ,f )âˆˆÎ˜Ã—Î˜Î» Ã—FÌ‚J QJ (Î´ (Â·, Î¸Î» , s , P ), z, p, VÌ‚; Î¸, f )              (18)

where we define (e.g.) in the case of the sieve least squares estimation

                                            J
                                          1X âˆ—
QJ (Î´ âˆ— (Â·, Î¸Î» , s, P ), Â·, V; Î¸, f ) â‰¡       {Î´j (xj , pj , Î¸Î» , s, P )âˆ’(c+Î² 0 xj âˆ’Î±pj +f (zj , Vj )(1+Î³ 0 xj +Î³p (yÌ„âˆ’pj )))}2 .
                                          J
                                            j=1


Also define the population criterion function Q0J (Î´ âˆ— (Â·, Î¸Î» , s, P ), Â·, V; Î¸, f ) = E[QJ (Î´ âˆ— (Â·, Î¸Î» , s, P ), Â·, V; Î¸, f )].
    To obtain the consistency theorem we need to add further assumptions (Assumption 11 below)
that control the way in which sn approaches s0 and Ïƒ(Î´ âˆ— (Â·), Â·, Î¸Î» , P R ) approaches to Ïƒ(Î´ âˆ— (Â·), Â·, Î¸Î» , P 0 )
(corresponding to Assumption A3 in Berry, Linton, and Pakes (2004)) and add identification con-
ditions (Assumption 17 and 18 below, corresponding to Assumptions A3-A6 in Berry, Linton, and
Pakes (2004)). We also add restrictions on the rate at which s0j approaches to zero (Condition S in
Berry, Linton, and Pakes (2004)).

Condition 3 (S). There exist positive finite constants c and c such that with probability one

                                             c/J â‰¤ s0j â‰¤ c/J, j = 0, 1, . . . , J.

    In the following we work on the product space Î˜Ã—Î˜Î» Ã—F Ã—SJ Ã—P where P is the set of probability
measures and endow the marginal spaces with (pseudo) metrics: ÏP (P, PÌƒ ) = supBâˆˆB |P (B)âˆ’ PÌƒ (B)|,
where B is the class of all Borel sets on Rdim(Î») , the Euclidean metric ÏE (Â·, Â·) on Î˜ and Î˜Î» , the

                                                               30
pseudo metric || Â· ||F on F, and a metric Ïs0 on SJ , defined by

                                                                         sj âˆ’ sÌƒj
                                                Ïs0 (s, sÌƒ) = max                 .
                                                                 0â‰¤jâ‰¤J      s0j

The same metric is used for Ïƒj (Â·) in place of sj .
   We also use the metric ÏÎ´ (Î´ âˆ— , Î´Ìƒ âˆ— ) = J âˆ’1 Jj=1 (Î´jâˆ— âˆ’Î´Ìƒjâˆ— )2 . Lastly define for each  > 0, the following
                                                 P

neighborhoods of Î¸0 , Î¸Î»0 , f0 , P 0 , and s0 : NÎ¸0 () = {Î¸ : ÏE (Î¸, Î¸0 ) < }, NÎ¸Î»0 () = {Î¸Î» : ÏE (Î¸Î» , Î¸Î»0 ) <
}, Nf0 ,J () = {f : ||f âˆ’ f0 ||F < , f âˆˆ FJ }, NP 0 () = {P : ÏP (P, P 0 ) < }, and Ns0 () = {s :
Ïs0 (s, s0 ) < }. Also for each Î¸Î» and  > 0, define NÎ´âˆ—0 (Î¸Î» , ) = {Î´ âˆ— : ÏÎ´ (Î´ âˆ— , Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 )) < }.
We further denote NÎ 0 () = {Î  : kÎ  âˆ’ Î 0 ks < } and NÏ•Ì„0l () = {Ï•Ì„l : kÏ•Ì„l âˆ’ Ï•Ì„0l ks < } for the
pseudo metric || Â· ||s .

Assumption 11. The random sequences sn and Ïƒ R (Î¸Î» ) are consistent with respect to the corre-
sponding metrics,

                           (a) Ïs0 (sn , s0 ) â†’p 0; (b) sup ÏÏƒ(Î¸Î» ) (Ïƒ R (Î¸Î» ), Ïƒ(Î¸Î» )) â†’p 0
                                                                Î¸Î» âˆˆÎ˜Î»


where Ïƒ R (Î¸Î» ) = Ïƒ(Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), Â·, Î¸Î» , P R ) and Ïƒ(Î¸Î» ) = Ïƒ(Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), Â·, Î¸Î» , P 0 ). Furthermore
suppose that the true market shares satisfy

                          J                                    J
                        1 X s0j (1 âˆ’ s0j )                   1 X Ïƒj (Î¸Î» )(1 âˆ’ Ïƒj (Î¸Î» ))
                 (c)                       â†’p 0; (d)  sup                               â†’p 0.
                       nJ
                           j=0
                                (s0j )2              Î¸Î» âˆˆÎ˜Î» RJ        (Ïƒj (Î¸Î» ))2
                                                                           j=0


    Next we assume that our estimator is an extremum estimator that solves (18).

Assumption 12. QJ (Î´ âˆ— (Â·, Î¸Ì‚Î» , sn , P R ), Â·, VÌ‚; Î¸Ì‚, fË†) â‰¤ inf(Î¸,Î¸Î» ,f )âˆˆÎ˜Ã—Î˜Î» Ã—FÌ‚J QJ (Î´ âˆ— (Â·, Î¸Î» , sn , P R ), Â·, VÌ‚; Î¸, f )+
op (1).

    The next condition is that in the small neighborhoods of Î 0 (Â·) and Ï•Ì„0l (Â·), the difference between
the sample criterion function and the population criterion function is small enough when J is large.

Assumption 13. For any C > 0 there exists  > 0 such that

                  lim Pr{                           sup                          |QJ (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), Â·, V; Î¸, f )
                 Jâ†’âˆ         (Î¸,Î¸Î» ,f )âˆˆÎ˜Ã—Î˜Î» Ã—FJ ,Î âˆˆNÎ 0 (),Ï•Ì„0l âˆˆNÏ•Ì„0l ()âˆ€l

                 âˆ’Q0J (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), Â·, V; Î¸, f )|   > C} = 0

where Vj = gj (p1 âˆ’ Î (z1 ), . . . , pJ âˆ’ Î (zJ )).

    Although it is obvious, we add the following continuity conditions.

Assumption 14. Q0J (Î´ âˆ— (Â·, Î¸Î» , s, P ), Â·, V; Î¸, f ) is continuous in (Î¸, Î¸Î» , f ) âˆˆ Î˜ Ã— Î˜Î» Ã— FJ .

Assumption 15. Q0J (Î´ âˆ— (Â·, Î¸Î» , s, P ), Â·, V; Î¸, fJ ) is continuous in Î (Â·) and Ï•Ì„l (Â·) uniformly for all
(Î¸, Î¸Î» , fJ ) âˆˆ Î˜ Ã— Î˜Î» Ã— FJ .

                                                                  31
    We also assume our parameter space is compact.

Assumption 16. The parameter space Î˜ Ã— Î˜Î» is compact and the sieve space, FJ , is compact
under the pseudo-metric || Â· ||F .

    The next condition ensures that we can, at least asymptotically, distinguish the Î´ âˆ— that sets the
models predictions for shares equal to the actual shares from other values of Î´ âˆ— .

Assumption 17. For all , there exists C() > 0 such that Ïƒ(Î´ âˆ— , x, p, Î¸Î» , P )

 lim Pr{ inf              inf          ||J âˆ’1/2 log Ïƒ(Î´ âˆ— , Â·, Î¸Î» , P 0 )âˆ’J âˆ’1/2 log Ïƒ(Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), Â·, Î¸Î» , P 0 )|| > C()} = 1.
Jâ†’âˆ         Î¸Î» âˆˆÎ˜Î» Î´ âˆ— âˆˆN
                       / Î´âˆ—0 (Î¸Î» ,)


    The following is the key condition for the consistency on the limiting behavior of the population
criterion function for (Î¸, Î¸Î» , f ) outside a neighborhood of (Î¸0 , Î¸Î»0 , f0 ).

Assumption 18. (i) Q0J (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), Â·, V; Î¸0 , f0 ) < âˆ; (ii) For all  > 0, there exists C() > 0
such that

 lim {                  inf                     Q0J (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), Â·, V; Î¸, f )âˆ’Q0J (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), Â·, V; Î¸0 , f0 )} â‰¥ C().
Jâ†’âˆ Î¸âˆˆN
     / Î¸0 (),Î¸Î» âˆˆN
                 / Î¸Î»0 (),f âˆˆN
                             / f0 ,J ()


    We now state our consistency theorem.

Theorem 6. Suppose Assumptions 9-18 hold for some n(J), R(J) â†’ âˆ. Further suppose Assump-
tions A3 and A4 hold. Then Î¸Ì‚ â†’p Î¸0 and Î¸Ì‚Î» â†’p Î¸Î»0 .

B.1      Proof of General Consistency (Theorem 6)
In proving Theorem 6 we use a strategy very close to Berry, Linton, and Pakes (2004). We first
show that the estimator, (Î¸Ìƒ, Î¸ÌƒÎ» , fËœ) defined as any sequence that satisfies the following is consistent:

   QJ (Î´ âˆ— (Â·, Î¸ÌƒÎ» , s0 , P 0 ), z, p, VÌ‚; Î¸Ìƒ, fËœ) = inf(Î¸,Î¸Î» ,f )âˆˆÎ˜Ã—Î˜Î» Ã—FJ QJ (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), z, p, VÌ‚; Î¸, f ) + op (1).
                                                                                                              (19)
                                                                                        Ëœ
    Let Îµ > 0 be any small real numbers. Note that any estimator (Î¸Ìƒ, Î¸ÌƒÎ» , f ) satisfying (19)
also satisfies that with probability approaching to one (w.p.a.1), QJ (Î´ âˆ— (Â·, Î¸ÌƒÎ» , s0 , P 0 ), Â·, VÌ‚; Î¸Ìƒ, fËœ) <
QJ (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), Â·, VÌ‚; Î¸, fJ ) +   Îµ
                                                6   for all (Î¸, Î¸Î» , fJ ) âˆˆ Î˜ Ã— Î˜Î» Ã— FJ . Then from the fact that
(Î¸0 , Î¸Î»0 ) âˆˆ Î˜ Ã— Î˜Î» and Ï€J f0 âˆˆ FJ , it follows that

                                                                                                                       Îµ
               QJ (Î´ âˆ— (Â·, Î¸ÌƒÎ» , s0 , P 0 ), z, p, VÌ‚; Î¸Ìƒ, fËœ) < QJ (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), z, p, VÌ‚; Î¸0 , Ï€J f0 ) + .
                                                                                                                       6

Then by Assumption 13 and the consistency of the pre-stage estimators (A3), we have w.p.a.1,
Q0J (Î´ âˆ— (Â·, Î¸ÌƒÎ» , s0 , P 0 ), Â·, VÌ‚; Î¸Ìƒ, fËœ) âˆ’ QJ (Î´ âˆ— (Â·, Î¸ÌƒÎ» , s0 , P 0 ), Â·, VÌ‚; Î¸Ìƒ, fËœ) < 6Îµ and

                                                                                                                          Îµ
          Q0J (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), z, p, VÌ‚; Î¸0 , Ï€J f0 ) âˆ’ QJ (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), z, p, VÌ‚; Î¸0 , Ï€J f0 ) > âˆ’ .
                                                                                                                          6


                                                                     32
It follows that w.p.a.1,

                                                           Îµ
         Q0J (Î´ âˆ— (Â·, Î¸ÌƒÎ» , s0 , P 0 ), z, p, VÌ‚; Î¸Ìƒ, fËœ) âˆ’ < QJ (Î´ âˆ— (Â·, Î¸ÌƒÎ» , s0 , P 0 ), z, p, VÌ‚; Î¸Ìƒ, fËœ)
                                                           6
                                                                 Îµ                                                    Îµ Îµ
         < QJ (Î´ (Â·, Î¸Î»0 , s , P ), z, p, VÌ‚; Î¸0 , Ï€J f0 ) + < Q0J (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), z, p, VÌ‚; Î¸0 , Ï€J f0 ) + + .
                    âˆ—             0     0
                                                                 6                                                    6 6

Next we note that by the continuity assumption (Assumption 15) and the consistency of the pre-
stage estimators (A3), we have w.p.a.1, Q0 (Î´ âˆ— (Â·, Î¸ÌƒÎ» , s0 , P 0 ), Â·, V; Î¸Ìƒ, fËœ)âˆ’Q0 (Î´ âˆ— (Â·, Î¸ÌƒÎ» , s0 , P 0 ), Â·, VÌ‚; Î¸Ìƒ, fËœ) <
                                                             J                                            J
Îµ
6    and Q0J (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), Â·, V; Î¸0 , Ï€J f0 ) âˆ’ Q0J (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), Â·, VÌ‚; Î¸0 , Ï€J f0 ) > âˆ’ 6Îµ . It follows that
w.p.a.1,

                                                           Îµ                                                        Îµ 3Îµ
          Q0J (Î´ âˆ— (Â·, Î¸ÌƒÎ» , s0 , P 0 ), z, p, V; Î¸Ìƒ, fËœ) âˆ’ < Q0J (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), z, p, V; Î¸0 , Ï€J f0 ) + + .
                                                           6                                                        6 6

Then by Assumption 18 and Assumption 14 (continuity) and the fact that kf0 âˆ’ Ï€J f0 kF â†’ 0 as
J â†’ âˆ, for all J > J0 large enough we have

                                                                                                                          Îµ
                Q0J (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), z, p, V; Î¸0 , Ï€J f0 ) < Q0J (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), z, p, V; Î¸0 , f0 ) + .
                                                                                                                          6

It follows that

                    Q0J (Î´ âˆ— (Â·, Î¸ÌƒÎ» , s0 , P 0 ), z, p, V; Î¸Ìƒ, fËœ) < Q0J (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), z, p, V; Î¸0 , f0 ) + Îµ.               (20)

Next note that for any  > 0, by A4, Assumption 14 (continuity), 16 (compactness),

                                                inf                   Q0J (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), z, p, V; Î¸, f )
                              Î¸âˆˆN
                               / Î¸0 (),Î¸Î» âˆˆN
                                           / Î¸Î»0 (),f âˆˆN
                                                       / f0 ,J ()


exists (it can vary by J). Then by Assumption 18 and the fact that FJ âŠ‚ F, it must be that

    Q0J (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), z, p, V; Î¸0 , f0 ) <                   inf                    Q0J (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), z, p, V; Î¸, f ).
                                                          Î¸âˆˆN
                                                           / Î¸0 (),Î¸Î» âˆˆN
                                                                       / Î¸Î»0 (),f âˆˆN
                                                                                   / f0 ,J ()


Take Îµ small enough that

                     inf                    Q0J (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), Â·, V; Î¸, f ) âˆ’ Q0J (Î´ âˆ— (Â·, Î¸Î»0 , s0 , P 0 ), Â·, V; Î¸0 , f0 ) â‰¥ Îµ.
     Î¸âˆˆN
      / Î¸0 (),Î¸Î» âˆˆN
                  / Î¸Î»0 (),f âˆˆN
                              / f0 ,J ()


Then from (20) it follows that w.p.a.1,

     Q0J (Î´ âˆ— (Â·, Î¸ÌƒÎ» , s0 , P 0 ), z, p, V; Î¸Ìƒ, fËœ) <                   inf                    Q0J (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), z, p, V; Î¸, f ).
                                                         Î¸âˆˆN
                                                          / Î¸0 (),Î¸Î» âˆˆN
                                                                      / Î¸Î»0 (),f âˆˆN
                                                                                  / f0 ,J ()


Then by Assumption 14 (continuity) and the fact that (Î¸Ìƒ, Î¸ÌƒÎ» , fËœ) âˆˆ Î˜ Ã— Î˜Î» Ã— FJ , we conclude
Î¸Ìƒ âˆˆ NÎ¸0 (), Î¸ÌƒÎ» âˆˆ NÎ¸Î»0 (), and fËœ âˆˆ Nf0 ,J (). Therefore we have shown that any estimator (Î¸Ìƒ, Î¸ÌƒÎ» , fËœ)
that satisfies (19) is consistent.



                                                                        33
    Next we show that the actual estimator (Î¸Ì‚, Î¸Ì‚Î» , fË†) satisfies the following, so is consistent because
it then satisfies (19) :

                   QJ (Î´ âˆ— (Â·, Î¸Ì‚Î» , s0 , P 0 ), z, p, VÌ‚; Î¸Ì‚, fË†) = QJ (Î´ âˆ— (Â·, Î¸Ì‚Î» , sn , P R ), z, p, VÌ‚; Î¸Ì‚, fË†) + op (1)   (21)
              â‰¤ inf(Î¸,Î¸Î» ,f )âˆˆÎ˜Ã—Î˜Î» Ã—FÌ‚J QJ (Î´ âˆ— (Â·, Î¸Î» , sn , P R ), z, p, VÌ‚; Î¸, f ) + op (1)                                  (22)
                                                        âˆ—           n        R
              = inf(Î¸,Î¸Î» ,f )âˆˆÎ˜Ã—Î˜Î» Ã—FJ QJ (Î´ (Â·, Î¸Î» , s , P ), z, p, VÌ‚; Î¸, f ) + op (1)                                        (23)
              = inf(Î¸,Î¸Î» ,f )âˆˆÎ˜Ã—Î˜Î» Ã—FJ QJ (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), z, p, VÌ‚; Î¸, f ) + op (1)                                   (24)

where (22) (the first inequality) holds because (Î¸Ì‚, Î¸Ì‚Î» , fË†) is an extremum estimator satisfying (18)
and (23) (the second equality) holds because FÌ‚J â†’ FJ (in the Hausdorff metric defined on the
metric space (F, kÂ·kF )) by Assumption A3 and QJ (Â·, VÌ‚; Î¸, f ) is continuous in f . We focus on (21)
(the first equality) and (24) (the last equality). Consider that by applying the Cauchy-Schwarz
inequality twice we obtain

        sup (Î¸,Î¸Î» ,f )âˆˆÎ˜Ã—Î˜Î» Ã—(FÌ‚J âˆªFJ ) |QJ (Î´ âˆ— (Â·, Î¸Î» , sn , P R ), Â·, VÌ‚; Î¸, f ) âˆ’ QJ (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), Â·, VÌ‚; Î¸, f )| (25)
                                                   J
                                                   X
   â‰¤ sup (Î¸,Î¸Î» ,f )âˆˆÎ˜Ã—Î˜Î» Ã—(FÌ‚J âˆªFJ ) J âˆ’1                (Î´jâˆ— (Â·, Î¸Î» , sn , P R ) âˆ’ Î´jâˆ— (Â·, Î¸Î» , s0 , P 0 ))2 Ã—
                                                   j=1

        Ã—2 sup (Î¸,Î¸Î» ,f )âˆˆÎ˜Ã—Î˜Î» Ã—(FÌ‚J âˆªFJ ) (QJ (Î´ âˆ— (Â·, Î¸Î» , sn , P R ), Â·, VÌ‚; Î¸, f ) + QJ (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), Â·, VÌ‚; Î¸, f ))
                               J
                               X
   â‰¤ C Â· sup Î¸Î» âˆˆÎ˜Î» J âˆ’1             (Î´jâˆ— (Â·, Î¸Î» , sn , P R ) âˆ’ Î´jâˆ— (Â·, Î¸Î» , s0 , P 0 ))2
                               j=1


for some constant C. Here the second inequality holds because any Î´ âˆ— (Â·) obtained from the con-
traction mapping is bounded (BLP (1995) show the random coefficients logit model satisfies the
contraction mapping property), all the parameter spaces are bounded (Assumption 16), and we
assume zj and pj are (stochastically) bounded, so sup (Î¸,Î¸Î» ,f )âˆˆÎ˜Ã—Î˜Î» Ã—(FÌ‚J âˆªFJ ) QJ (Â·) is bounded. Also
note that Î´ âˆ— (Â·, Î¸Î» , Â·) does not depend on (Î¸, f ).
    Therefore (25) is op (1) if

                                           J
                                           X
                                      âˆ’1
                              sup J              (Î´jâˆ— (Â·, Î¸Î» , sn , P R ) âˆ’ Î´jâˆ— (Â·, Î¸Î» , s0 , P 0 ))2 = op (1).                 (26)
                           Î¸Î» âˆˆÎ˜Î»          j=1

This in turn implies (21) immediately and also implies (24) by the triangle inequality as we argue be-
                        (1)
low. Let QJ (Î´ âˆ— (Â·, Î¸Î» , sn , P R ), z, p, VÌ‚; Î¸(1) , f (1) ) = arginf(Î¸,Î¸Î» ,f )âˆˆÎ˜Ã—Î˜Î» Ã—FJ QJ (Î´ âˆ— (Â·, Î¸Î» , sn , P R ), z, p, VÌ‚; Î¸, f )
                  (2)
and QJ (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), z, p, VÌ‚; Î¸(2) , f (2) ) = arginf(Î¸,Î¸Î» ,f )âˆˆÎ˜Ã—Î˜Î» Ã—FJ QJ (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), z, p, VÌ‚; Î¸, f ).
                               (1)                            (2)
The minimizers (Î¸(1) , Î¸Î» , f (1) ) and (Î¸(2) , Î¸Î» , f (2) ) exist because QJ (Â·) is continuous in (Î¸, Î¸Î» , f )




                                                                        34
and the parameter space Î˜ Ã— Î˜Î» Ã— FJ is compact (Assumption 16). It follows that

                           (1)                                                    (1)
op (1) = QJ (Î´ âˆ— (Â·, Î¸Î» , sn , P R ), z, p, VÌ‚; Î¸(1) , f (1) ) âˆ’ QJ (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), z, p, VÌ‚; Î¸(1) , f (1) )
                           (1)                                                    (2)
         â‰¤ QJ (Î´ âˆ— (Â·, Î¸Î» , sn , P R ), z, p, VÌ‚; Î¸(1) , f (1) ) âˆ’ QJ (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), z, p, VÌ‚; Î¸(2) , f (2) )
                           (2)                                                    (2)
         â‰¤ QJ (Î´ âˆ— (Â·, Î¸Î» , sn , P R ), z, p, VÌ‚; Î¸(2) , f (2) ) âˆ’ QJ (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), z, p, VÌ‚; Î¸(2) , f (2) ) = op (1)

where the first and the last equality hold by (25) and (26). The first inequality holds because
        (2)
(Î¸(2) , Î¸Î» , f (2) ) minimizes QJ (Î´ âˆ— (Â·, Î¸Î» , s0 , P 0 ), z, p, VÌ‚; Î¸, f ) over Î˜Ã—Î˜Î» Ã—FJ and the second inequal-
                                 (1)
ity holds because (Î¸(1) , Î¸Î» , f (1) ) minimizes QJ (Î´ âˆ— (Â·, Î¸Î» , sn , P R ), z, p, VÌ‚; Î¸, f ) over Î˜Ã—Î˜Î» Ã—FJ . This
proves (24).
    Finally note that (26) is op (1) by the essentially same proof (page 647-648) in the proof of
Theorem 1 of Berry, Linton, and Pakes (2004) under Assumption 11 and Assumption 17 because
(i) all arguments there in terms of Î¾ also hold in terms of our Î´ âˆ— and (ii) Assumption 11 replaces
their Assumption A3 and Assumption 17 replaces their Assumption A5.
    This completes the proof.




                                                               35
References
Bajari, P., and L. Benkard (2005): â€œDemand Estimation with Heterogeneous Consumers and
  Unobserved Product Characteristics: A Hedonic Approach,â€ Journal of Political Economy, 113,
  1239â€“1276.

Berry, S. (1994): â€œEstimating Discrete-Choice Models of Product Differentiation,â€ The RAND
  Journal of Economics, 25(2), 242â€“262.

Berry, S., and P. Haile (2010): â€œIdentification in Differentiated Products Markets Using Market
  Level Data,â€ NBER working paper.

Berry, S., J. Levinsohn, and A. Pakes (1995): â€œAutomobile Prices in Market Equilibrium,â€
  Econometrica, 60(4), 889â€“917.

Berry, S., O. Linton, and A. Pakes (2004): â€œLimit Theorems for Estimating the Parameters
  of Differentiated Product Demand Systems,â€ Review of Economic Studies, 71, 613â€“654.

Blundell, R., and J. Powell (2003): â€œEndogeneity in Nonparametric and Semiparametric Re-
  gression Models,â€ Advances in Economics and Econometrics:Theory and Applications, Eighth
  World Congress.

Chen, X. (2006): â€œLarge Sample Sieve Estimation of Semi-Nonparametric Models,â€ forthcoming in
  Handbook of Econometrics, Volume 6.

Chen, X., O. Linton, and I. van Keilegom (2003): â€œEstimation of Semiparametric Models
  When the Criterion Function is Not Smooth,â€ Econometrica, 71, 1591â€“1608.

Chesher, A., A. Rosen, and K. Smolinski (2011): â€œAn Instrumental Variable Model of Multiple
  Discrete Choice,â€ Working paper.

Dieudonne, J. (1969): Foundations of Modern Analysis, New York: Academic Press.

Florens, J., J. Heckman, C. Meghir, and E. Vytlacil (2008): â€œIdentification of Treatment
  Effects Using Control Functions in Models with Continuous Endogenous Treatment and Hetero-
  geneous Effects,â€ Econometrica, 76, 1191â€“1206.

Gandhi, A. (2009): â€œInverting Demand Systems,â€ Working paper.

Hahn, J., and G. Ridder (2008): â€œConditional Moment Restrictions and Triangular Simultaneous
  Equations,â€ Working Paper.

Imbens, G., and W. Newey (2003): â€œIdentification and Estimation of Triangular Simultaneous
  Equations Models without Additivity,â€ Working Paper.

Imbens, G., and W. Newey (2009): â€œIdentification and Estimation of Triangular Simultaneous
  Equations Models Without Additivity,â€ Econometrica, 77, 1481â€“1512.

                                              36
Kim, K., and A. Petrin (2010a): â€œControl Function Corrections for Unobserved Factors in Dif-
  ferentiated Product Models,â€ Working Paper.

         (2010b): â€œControl Functions for a Class of Non-Separable Models without Independence
  and Monotonicity Conditions,â€ Working paper.

        (2010c): â€œMultiplicative Heterogeneity Models with Endogeneity,â€ Working paper.

         (2010d): â€œRevisiting Instrumental Variables and the Classic Control Function Approach,
  with Implications for Parametric and Non-Parametric Regressions,â€ Working paper.

Lewbel, A. (2000): â€œSemiparametric Qualitative Response Model Estimation With Instrumental
  Variables and Unknown Heteroscedasticity,â€ Journal of Econometrics, 97, 145â€“177.

Matzkin, R. (2003): â€œNonparametric Estimation of Nonadditive Random Functions,â€ Economet-
  rica, 71, 1339â€“1375.

McFadden, D. (1981): â€œStructural discrete probability models derived from theories of choice,â€
  Structural Analysis of Discrete Data and Econometric Applications, pp. 115â€“178, Edited by
  Charles Manski and Daniel McFadden, The MIT press.

Newey, W., and J. Powell (2003): â€œInstrumental Variable Estimation of Nonparametric Mod-
  els,â€ Econometrica, 71, 1565â€“1578.

Pakes, A. (1996): â€œDynamic structural models, problems and prospects: mixed continuous discrete
  controls and market interaction,â€ in Advances in Econometrics, Sixth World Congress, Volume
  II, ed. by C. Sims, pp. 171â€“259, New York. Cambridge.

Rothenberg, T. (1971): â€œIdentification in Parametric Models,â€ Econometrica, 39, 577â€“591.




                                                37
