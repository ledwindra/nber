NBER WORKING PAPER SERIES

AGGREGATING FROM MICRO TO MACRO PATTERNS OF TRADE
Stephen J. Redding
David E. Weinstein
Working Paper 24051
http://www.nber.org/papers/w24051

NATIONAL BUREAU OF ECONOMIC RESEARCH
1050 Massachusetts Avenue
Cambridge, MA 02138
November 2017

We are especially grateful to Ben Faber, Dave Donaldson, Rob Feenstra, Keith Head, Pete
Klenow, Kalina Manova, Thierry Mayer, Marc Melitz, Gianmarco Ottaviano and Daniel Xu for
helpful comments. We would also like to thank colleagues and seminar participants at CarnegieMellon, Chicago, Columbia, Duke, NBER, Princeton, Stanford and UC Berkeley for helpful
comments. Thanks to Mark Greenan, Ildiko Magyari, Charly Porcher and Dyanne Vaught for
outstanding research assistance. Redding and Weinstein thank Princeton and Columbia
respectively for research support. Weinstein would also like to thank the NSF (Award 1127493)
for generous financial support. Any opinions, findings, and conclusions or recommendations
expressed in this paper are those of the authors and do not necessarily reflect the views of the
U.S. Census Bureau or any organization to which the authors are affiliated. Results have been
screened to insure that no confidential data are revealed. The views expressed herein are those of
the authors and do not necessarily reflect the views of the National Bureau of Economic
Research.
NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.
© 2017 by Stephen J. Redding and David E. Weinstein. All rights reserved. Short sections of text,
not to exceed two paragraphs, may be quoted without explicit permission provided that full
credit, including © notice, is given to the source.

Aggregating from Micro to Macro Patterns of Trade
Stephen J. Redding and David E. Weinstein
NBER Working Paper No. 24051
November 2017
JEL No. F10,F14,F60
ABSTRACT
We develop a new framework for aggregating from micro to macro patterns of trade. We derive
price indexes that determine comparative advantage across countries and sectors and the
aggregate cost of living. If firms and products are imperfect substitutes, we show that these price
indexes depend on variety, average demand/quality and the dispersion of demand/qualityadjusted prices, and are only weakly related to standard empirical measures of average prices,
thereby providing insight for elasticity puzzles. Of the cross-section (time-series) variation in
comparative advantage, 50 (90) percent is accounted for by variety and average demand/quality,
with average prices contributing less than 10 percent.

Stephen J. Redding
Department of Economics
and Woodrow Wilson School
Princeton University
14 College Road
Princeton, NJ 08540
and NBER
reddings@princeton.edu
David E. Weinstein
Columbia University, Department of Economics
420 W. 118th Street
MC 3308
New York, NY 10027
and NBER
dew35@columbia.edu

1

Introduction

Research in international trade has traditionally focused heavily on two questions: what explains trade patterns and what are the implications of trade for domestic prices? Researchers have typically pursued these
questions using one of two approaches. On the one hand, general equilibrium “macro” models of trade explain aggregate trade patterns based on assumptions about disaggregated economic activity. On the other
hand, “micro” studies of firm export and import behavior use disaggregated datasets on firm-level trade decisions. While each line of research has informed the other, a substantial gap between the two approaches
remains. The reduced-form nature of the micro studies means that there is no clear mapping between what
happens at the firm level and what happens at the aggregate level. Similarly, the supply-side assumptions
of the macro models can be at odds with what researchers observe in the micro data. In contrast, we develop a framework for aggregating from micro trade transactions by firm, product, source and destination
to macro trade and prices. Our framework is thus the first to exactly rationalize observed trade flows at
both the aggregate and disaggregate level, which enables us to quantify the relative importance of different
micro mechanisms for macro trade and prices. We thus inform recent empirical research on the margins of
international trade, providing a framework that directly connects theory and data.1
Our first main insight is that the demand system alone is sufficient to provide a framework for aggregating trade data from the micro to the macro level. All we require to implement this framework is the assumed
demand system, its parameters, and data on prices and expenditures. The intuition for how this works is that
the supply-side only enters through the observed prices and expenditures and the estimated demand-side
parameters. If the demand system is invertible, we can use these observables and the estimated parameters
to solve for unique values for an unobserved demand/quality shifter for each good. Although this insight
holds for any invertible demand system, we implement our analysis for constant elasticity of substitution
(CES) preferences, as the most commonly-used specification in international trade. Our approach holds for
any nesting structure within this demand system. We show that the value and price for each observed disaggregated trade transaction can be rationalized as the equilibrium of our model, without making any of the
standard supply-side modeling assumptions, such as iceberg trade costs, perfect or monopolistic competition,
and Pareto or Fréchet productivity distributions. Furthermore, although the nested CES demand system is
non-linear, we show that it admits an exact log-linear representation, which can be applied recursively across
nests, and hence permits exact additive decompositions of aggregate variables.
Our second main insight is that this general approach can be applied to the specific nesting structures that
have dominated theoretical and empirical work in international trade. Traditional theories of comparative
advantage emphasize specialization across countries and sectors. Therefore, we distinguish industry nests
through which the goods supplied by each industry enter the aggregate expenditure function. More recent
theories of firm heterogeneity stress differentiation across firms within sectors (as in Krugman 1980 and
Melitz 2003). Hence we specify firm nests within each industry that summarize each firm’s contribution to
the industry expenditure function. Finally, other recent theories of multi-product firms highlight the range of
1 For example, Feenstra (1994) quantifies the entry and exit of goods over time, and Hummels and Klenow (2005) examine the
contribution of variety and quality to a nation’s exports.

2

distinct products supplied by many firms. Thus, we identify products within firms as the most disaggregated
units in our demand system that enter the expenditure function for each firm. Importantly, while our setup
incorporates this rich nesting structure, we also allow for the special cases of simpler structures in which
industry or firm nests are absent. We implement our approach by developing a new estimator of the elasticities
of substitution in a nested CES demand system, which generalizes the reverse-weighting approach of Redding
and Weinstein (2016) to a nested demand structure. We provide conditions under which this estimator is
consistent and show that it successfully recovers the true parameter values in a Monte Carlo exercise in
which the data are generated according the model.
Our third main contribution is to use this trade nesting structure to derive price indexes that summarize
the cost of sourcing goods from each country and sector. We develop a theory-consistent measure of revealed
comparative advantage (RCA), which depends on the relative values of these price indexes across countries
and sectors. We show that these relative price indexes are weakly related to standard empirical measures of
average prices, thereby providing insight for elasticity puzzles, in which real variables respond weakly to these
empirical proxies. We use our model to decompose these price indexes and comparative advantage into the
contributions of a number of different micro mechanisms in a sequence of steps. First, we show that relative
price indexes depend on contributions from entry/exit and demand-adjusted prices. Second, we break out the
demand-adjusted price term into contributions from the average and dispersion of demand-adjusted prices.
Third, we separate out the average demand-adjusted price term into contributions from average demand and
average prices. In the special case in which goods are perfect substitutes, only average demand-adjusted
prices matter, because all varieties consumed have the same demand-adjusted price, and the consumer is
indifferent between all these consumed varieties. More generally, if goods are imperfect substitutes, these
price indexes are decreasing in the number of varieties, because of consumer love of variety. Similarly, in this
more general case, greater dispersion of demand-adjusted prices across varieties reduces these price indexes,
because it implies that consumers can more easily substitute from less to more attractive varieties.
We implement our approach using both U.S. data from 1997-2011 (reported in the main paper) and also
Chilean data from 2007-14 (reported in the web appendix). We demonstrate the same qualitative and quantitative pattern of results in these two different contexts. In both cases, we find that products within firms,
firms within sectors and sectors are each imperfect substitutes. For the U.S., we estimate a median elasticity of
substitution across products of 6.29, a median elasticity across firms of 2.66, and an elasticity across sectors of
1.36. Using these estimates, we reject the special cases of our model in which industry or firm nests are absent
at conventional significance levels. We show that these findings of imperfect substitutability have important
implications for patterns of comparative advantage. Firm entry/exit and the dispersion of demand-adjusted
prices each account for around one third of the cross-section variation in patterns of trade across countries
and sectors. By contrast, average demand and average prices contribute just over 20 percent and just under
10 percent respectively to the total variation. For changes in trade patterns over time, the results are even
more stark. Firm entry/exit and average demand each account for around 45 percent of the variation, with the
dispersion of demand-adjusted prices making up most of the rest. We demonstrate that this pattern is robust
across a range of alternative values for the elasticities of substitution. Indeed, for parameter values for which

3

goods are imperfect substitutes, we show that the contributions from firm entry/exit and the dispersion of
demand-adjusted prices to patterns of trade are invariant to these assumed elasticities.
Although there is an exact mapping between our price index and observed trade flows, the same need
not be true for other approaches that impose stronger assumptions, such as the Feenstra price index, which
corresponds to a special case that assumes no demand shifts for surviving goods. Thus, the difference between observed trade patterns and those predicted using alternative price indexes provides a metric for how
successful models based on these assumptions are. By comparing actual RCA with counterfactual values of
RCA based on different assumptions—e.g., with or without demand-shifts or variety corrections—we can directly assess the implications of these simplifying assumptions for understanding trade patterns. In particular,
we find that models that assume no demand shifts and no changes in variety perform poorly on trade data.
Models that incorporate variety changes while maintaining the assumption of no demand shifts do better, but
still can only account for about ten percent of the changes in comparative advantage over time. These findings highlight the importance of changes in demand/quality within surviving varieties in understanding the
changes in comparative advantage documented in Freund and Pierola (2015) and Hanson, Lind and Muendler
(2015). They also point to the relevance of dynamic trade theories, in which comparative advantage evolves
endogenously with process and product innovation, as in Grossman and Helpman (1991).
Our paper is related to several strands of existing research. First, we contribute to the literature on firm
heterogeneity in international trade following Melitz (2003), as reviewed in Bernard, Jensen, Redding and
Schott (2007) and Melitz and Redding (2014). One strand of this literature has used micro data on plants and
firms to examine performance differences between exporters and non-exporters following the early empirical
work of Bernard and Jensen (1995). Another strand has provided evidence on the extensive margin of firm
entry into export markets, including Hummels and Klenow (2005) and Eaton, Kortum, and Kramarz (2011).2
Other research has examined the range of products supplied by multi-product firms, including Bernard, Redding, and Schott (2010, 2011) and Hottman, Redding, and Weinstein (2016).3
Second, our research connects with the recent literature on quantitative trade models following Eaton
and Kortum (2002). Using constant elasticity assumptions for both demand and supply (including for example Fréchet or Pareto productivity distributions), these models exactly rationalize aggregate trade. More
recently, research has relaxed the constant-elasticity assumptions in neoclassical trade models by providing
conditions under which they reduce to exchange models in which countries directly trade factor services (see
Adao, Costinot and Donaldson 2017). In contrast, we assume a constant elasticity of demand, but relax the
assumption of a constant elasticity of supply. By using additional structure on the demand-side, we are able
to rationalize both micro and macro trade data, enabling us to aggregate up from the micro level and quantify
the importance of different micro mechanisms for macro variables. As a result of imposing less structure
on the supply-side, we can encompass non-neoclassical models with imperfect competition and increasing
2 Hsieh et al. (2016) examine the contribution of this extensive margin to welfare using the Sato-Vartia price index and aggregate
moments from U.S. and Canadian data. We show below that this Sato-Vartia price index cannot rationalize micro trade flows, because
it assumes away idiosyncratic shifts in expenditure conditional on prices. Therefore, we use the unified price index (UPI) of Redding
and Weinstein (2016), which enables us to both rationalize these micro trade flows and aggregate to the macro level.
3 See also Eckel and Neary (2010), Feenstra and Ma (2008), Dhingra (2013), and Mayer, Melitz, and Ottaviano (2014).

4

returns to scale (including Krugman 1980, Melitz 2003, and Atkeson and Burstein 2008).
Third, our paper is related to the literature estimating elasticities of substitution between varieties and
quantifying the contribution of new goods to welfare. As shown in Feenstra (1994), the contribution of entry and exit to the change in the CES price index can be captured using the expenditure share on common
products (supplied in both periods) and the elasticity of substitution. Building on this approach, Broda and
Weinstein (2006) quantify the contribution of international trade to welfare through an expansion on the number of varieties, and Broda and Weinstein (2010) examine product creation and destruction over the business
cycle. Other related research using scanner data to quantify the effects of globalization includes Handbury
(2013), Atkin and Donaldson (2015), and Atkin, Faber, and Gonzalez-Navarro (2015), and Fally and Faber
(2016). Whereas this existing research assumes that demand/quality is constant for each surviving variety,
we show that allowing for time-varying demand/quality is central to both rationalizing both aggregate and
disaggregate patterns of trade.
The remainder of the paper is structured as follows. Section 2 introduces our theoretical framework.
Section 3 outlines our structural estimation approach. Section 4 discusses our data. Section 5 reports our
empirical results. Section 6 concludes. A web appendix contains technical derivations, additional empirical
results for the U.S., and a replication of our U.S. results using Chilean data.

2

Theoretical Framework

We begin by showing that our framework exactly rationalizes observed micro trade data and permits exact
aggregation, so that it can be used to quantify the importance of different micro mechanisms for macro
variables. Although our approach could be implemented for any nested demand system that is invertible,
we focus on CES preferences as the leading demand system in international trade, with a nesting structure
guided by existing theories of trade, which distinguish countries, sectors, firms and products.
Throughout the paper, we index importing countries (“importers”) by j and exporting countries (“exporters”) by i (where each country can buy its own output). Each exporter can supply goods to each importer
in a number of sectors that we index by g (a mnemonic for “group”). We denote the set of sectors by ΩG and
we indicate the number of elements in this set by N G . We denote the set of countries from which importer j
I and we indicate the number of elements in this set by N I . Each
sources goods in sector g at time t by Ω jgt
jgt

sector (g) in each exporter (i) is comprised of firms, indexed by f (a mnemonic for “firm”). We denote the set
of firms in sector g that export from country i to country j at time t by Ω Fjigt ; and we indicate the number
F . Each active firm can supply one or more products that we index by u (a
of elements in this set by Njigt

mnemonic for “unit,” as our most disaggregated unit of analysis); we denote the set of products supplied by
4
firm f at time t by ΩUft ; and we indicate the number of elements in this set by N U
f t.
4 We use the superscript G to denote a sector-level variable, the superscript F to represent a firm-level variable, and the superscript
U to indicate a product-level variable. We use subscripts j and i to index individual countries, the subscript g to reference individual
sectors, the subscript f to refer to individual firms, the subscript u to label individual products, and the subscript t to indicate time.

5

2.1

Demand

The aggregate unit expenditure function for importer j at time t (Pjt ) is defined over the sectoral price index
G ) and demand parameter (ϕ G ) for each sector g ∈ Ω G :
(Pjgt
jgt


Pjt = 

∑



g∈ΩG

G
Pjgt
/ϕG
jgt

 1− σ G



1
1− σ G

σ G > 1, ϕG
jgt > 0,

,



(1)

where σ G is the elasticity of substitution across sectors and ϕG
jgt captures the relative demand for each sector.
The unit expenditure function for each sector g depends on the price index (PfFt ) and demand parameter (ϕ Fft )
I within that sector:
for each firm f ∈ Ω Fjigt from each exporter i ∈ Ω jgt


G
Pjgt
=

∑ ∑



PfFt /ϕ Fft

1−σgF



1
1−σgF

,



σgF > 1, ϕ Fft > 0,

(2)

I f ∈Ω F
i ∈Ω jgt
jigt

where σgF is the elasticity of substitution across firms f for sector g and ϕ Fft controls the relative demand
for each firm within that sector. We assume that the unit expenditure function within each sector takes the
same form for both final consumption and intermediate use, so that we can aggregate both these sources of
expenditure, as in Eaton and Kortum (2002) and Caliendo and Parro (2015).
We allow firm varieties to be horizontally differentiated and assume the same elasticity of substitution
for domestic and foreign firms within sectors (σgF ).5 The unit expenditure function for each firm f depends
U ) and demand parameter (ϕU ) for each product u ∈ ΩU supplied by that firm:
on the price (Put
ut
ft


PfFt = 

∑



U
/ϕU
Put
ut

1−σgU




1
1−σgU

,

σgU > 1, ϕU
ut > 0,

(3)

u∈ΩUft

where σgU is the elasticity of substitution across products within firms for sector g and ϕU
ut captures the relative
demand for each product within a given firm.
A few remarks about this specification are useful. First, we allow prices to vary across products, firms,
sectors and countries, which implies that our setup nests models in which relative and absolute production
costs differ within and across countries. Second, for notational convenience, we define the firm index f ∈
Ω Fjigt by sector g, destination country j and source country i. Therefore, if a firm has operations in multiple
sectors and/or exporting countries, we label these different divisions separately. As we observe the prices of
the products for each firm, sector and exporting country in the data, we do not need to take a stand on market
structure or the level at which product introduction and pricing decisions are made within the firm. Third,
the fact that the elasticities of substitution across products within firms (σgU ), across firms within sectors
(σgF ), and across sectors within countries (σ G ) need not be infinite implies that our framework nests models
5 Therefore, we associate horizontal differentiation within sectors with firm brands, which implies that differentiation across
countries emerges solely because there are different firms in different countries, as in Krugman (1980) and Melitz (2003). It is straightforward to also allow the elasticity of substitution to differ between home and foreign firms, which introduces separate differentiation
by country, as in Armington (1969).

6

in which products are differentiated within firms, across firms within sectors, and across sectors. Moreover,
our work is robust to collapsing one or more of these nests. For example, if all three elasticities are equal
(σgU = σgF = σ G ), all three nests collapse, and the model becomes equivalent to one in which consumers only
care about firm varieties. Alternatively, if σgU = σgF = ∞ and σ G < ∞, only sectors are differentiated, and
varieties are perfectly substitutable within sectors. Finally, if σgU = σgF > σ G , firm brands are irrelevant, so
that products are equally differentiated within and across firms for a given sector.
U
F
Fourth, the demand shifters (ϕG
jgt , ϕ f t , ϕut ) capture anything that shifts the demand for sectors, firms and

products conditional on price. Therefore, they incorporate both quality (vertical differences across varieties)
and consumer tastes. We refer to these demand shifters as “demand/quality” to make clear that they can be
interpreted either as shifts in consumer demand or product quality.6 Finally, in order to simplify notation,
we suppress the subscript for importer j, exporter i, and sector g for the firm and product demand shifters
(ϕ Fft , ϕU
ut ). However, we take it as understood that we allow these demand shifters for a given firm f and
product u to vary across importers j, exporters i and sectors g, which captures the idea that a firm’s varieties
can be more appealing in some markets than others. For example, Sony products may be more appealing to
Americans than Chileans, or may have more consumer appeal in the television sector than the camera sector,
or even may be perceived to have higher quality if they are supplied from Japan rather than from another
location.

2.2

Non-traded Sectors

We allow some sectors to be non-traded, in which case we do not observe products within these sectors
in our disaggregated import transactions data, but we can measure total expenditure on these non-traded
sectors using domestic expenditure data. We incorporate these non-traded sectors by re-writing the overall
unit expenditure function in equation (1) in terms of the share of expenditure on tradable sectors (µ Tjt ) and a
unit expenditure function for these tradable sectors (PTjt ):
  G1
Pjt = µ Tjt σ −1 PTjt .

(4)

The share of expenditure on the set of tradable sectors Ω T ⊆ ΩG (µ Tjt ) can be measured using aggregate data
on expenditure in each sector:
µ Tjt ≡

G
∑ g∈ΩT X jgt
G
∑ g∈ΩG X jgt


 1− σ G
G /ϕ G
∑ g∈ΩT Pjgt
jgt
=

 1− σ G ,
G
G
∑ g∈ΩG Pjgt /ϕ jgt

(5)

G is total expenditure by importer j on sector g at time t. The unit expenditure function for tradable
where X jgt
G ):
sectors (PTjt ) depends on the price index for each tradable sector (Pjgt


PTjt ≡ 

∑

g∈ΩT



G
Pjgt
/ϕG
jgt

 1− σ G




1
1− σ G

,

(6)

6 See, for example, the discussion in Di Comite, Thisse and Vandenbussche (2014). A large literature in international trade has
interpreted these demand shifters as capturing product quality, including Schott (2004), Khandelwal (2010), Hallak and Schott (2011),
Feenstra and Romalis (2008), and Sutton and Trefler (2016).

7

where we use the “blackboard” font P to denote price indexes that are defined over tradable goods.
Therefore, our assumption on demand allows us to construct an overall price index without observing
entry, exit, sales, prices or quantities of individual products in non-tradable sectors. From equation (5), there
is always a one-to-one mapping between the market share of tradable sectors and the relative price indexes
in the two sets of sectors. In particular, if the price of non-tradables relative to tradables rises, the share of
tradables (µ Tjt ) also rises. In other words, the share of tradables is a sufficient statistic for understanding the
relative prices of tradables and non-tradables. As one can see from equation (4), if we hold fixed the price of
tradables (PTjt ), a rise in the share of tradables (µ Tjt ) can only occur if the price of non-tradables sectors also
rises, which means that the aggregate price index index (Pjt ) must also be increasing in the share of tradables.

2.3

Domestic Versus Foreign Varieties Within Tradable Sectors

We also allow for domestic varieties within tradable sectors, in which case we again do not observe them
in our import transactions data, but we can back out the implied expenditure on these domestic varieties
using data on domestic shipments, exports and imports for each tradable sector. We incorporate domestic
varieties within tradable sectors by re-writing the sectoral price index in equation (2) in terms of the share
of expenditure on foreign varieties within each sector (the sectoral import share µG
jgt ) and a unit expenditure
function for these foreign varieties (a sectoral import price index PG
jgt ):

 F1
G
Pjgt
= µGjgt σg −1 PGjgt .

(7)

The sectoral import share (µG
jgt ) equals total expenditure on imported varieties within a sector divided by total
expenditure on that sector:
µG
jgt ≡
where Ω Ejgt ≡

n

∑i∈ΩEjgt ∑ f ∈ΩFjigt X Fft
G
X jgt


1−σgF
∑i∈ΩEjgt ∑ f ∈ΩFjigt PfFt /ϕ Fft
=

1−σgF ,
F /ϕ F
P
I
F
∑i∈Ω jgt ∑ f ∈Ω jigt
ft
ft

(8)

o
I : i 6 = j is the subset of foreign countries i 6 = j that supply importer j within sector g
Ω jgt

G is country j’s total expenditure on all firms in sector g at
at time t; X Fft is expenditure on firm f ; and X jgt

time t. The sectoral import price index (PG
jgt ) is defined over the foreign goods observed in our disaggregated
import transactions data as:


PG
jgt ≡

∑ ∑

i ∈Ω Ejgt



PfFt /ϕ Fft

1−σgF




1
1−σgF

.

(9)

f ∈Ω Fjigt

In this case, the import share within each sector is the appropriate summary statistic for understanding
the relative prices of home and foreign varieties within that sector. From equation (7), the sectoral price index
G ) is increasing in the sectoral foreign expenditure share (µ G ). The reason is that our expression for the
(Pjgt
jgt
G ) conditions on the price of foreign varieties, as is captured by the import price index
sectoral price index (Pjgt
G
(PG
jgt ). For a given value of this import price index, a higher foreign expenditure share (µ jgt ) implies that

domestic varieties are less attractive, which implies a higher sectoral price index.7
7 In

contrast, the expression for the price index in Arkolakis, Costinot and Rodriguez-Clare (2012) conditions on the price of

8

2.4

Exporter Price Indexes

To examine the contribution of individual countries to trade patterns and aggregate prices, it proves convenient to rewrite the sectoral import price index (PG
jgt ) in equation (9) in terms of price indexes for each foreign
exporting country within that sector (PEjigt ):


PG
jgt =

∑



PEjigt

1−σgF



1
1−σgF

,



(10)

i ∈Ω Ejgt

where importer j’s price index for exporter i in sector g at time t (PEjigt ) is defined over the firm price indexes
(PfFt ) and demand/qualities (ϕ Fft ) for each of the firms f from that foreign exporter and sector:

PEjigt ≡ 

∑



PfFt /ϕ Fft

1−σgF



1
1−σgF



,

(11)

f ∈Ω Fjigt

and we use the superscript E to denote a variable for a foreign exporting country.
This exporter price index (11) is a key object in our empirical analysis, because it summarizes importer j’s
cost of sourcing goods from exporter i within sector g at time t. We show below that the relative values of these
exporter price indexes across countries and sectors determine comparative advantage. Note that substituting
this definition of the exporter price index (11) into the sectoral import price index (10), we recover our earlier
equivalent expression for the sectoral import price index in equation (9).

2.5

Expenditure Shares

Using the properties of CES demand, the share of each product in expenditure on each firm (SU
ut ) is given by:
SU
ut

=

U /ϕU
Put
ut

1−σgU

∑`∈ΩUft P`Ut /ϕU
`t

1−σgU ,

(12)

where the firm and sector expenditure shares are defined analogously.
U ) and quantities (QU ) for each product category. In
In the data, we observe product expenditures (Xut
ut

our baseline specification in the paper, we assume that the level of disaggregation at which products are
observed in the data corresponds to the level at which firms make product decisions. Therefore, we measure
U = X U /QU ). From equation (12) above, demand-adjusted prices (PU /ϕU ) are
prices using unit values (Put
ut
ut
ut
ut
U
uniquely determined by the expenditure shares (SU
ut ) and the elasticities (σg ). Therefore, any multiplicative
U
U
U
change in the units in which quantities (QU
ut ) are measured, which affects prices (Put = Xut /Qut ), leads to an

exactly proportionate change in demand/quality (ϕU
ut ), in order to leave the demand-adjusted price unchanged
U /ϕU ). It follows that the relative importance of prices and demand/quality in explaining expenditure share
(Put
ut

variation is unaffected by any multiplicative change to the units in which quantities are measured.
domestically-produced varieties, and is increasing in the domestic expenditure share. The intuition is analogous. For a given price
of domestically-produced varieties, a higher domestic trade share implies that foreign varieties are less attractive, which implies a
higher price index.

9

In Section A.7 of the web appendix, we show that our analysis generalizes to the case in which firms
supply products at a more disaggregated level than the categories observed in the data. In this case, there can
be unobserved differences in composition within observed product categories. However, we show that these
unobserved compositional differences enter the model in exactly the same way as unobserved differences in
demand/quality for each observed product category, and hence our analysis goes through.

2.6

Log-Linear CES Price Index

We now use the CES expenditure share to rewrite the CES price index in an exact log linear form that enables
us to aggregate from micro to macro. We illustrate our approach using the product expenditure share within
the firm tier of utility, but the analysis is analogous for each of the other tiers of utility. Rearranging the
expenditure share of products within firms (12) using the firm price index (3), we obtain:
PfFt =

 1
U 
Put
U σgU −1
S
,
ut
ϕU
ut

(13)

which must hold for each product u ∈ ΩUft . Taking logarithms, averaging across products within firms, and
adding and subtracting

1
σgU −1

ln N U
f t , we obtain the following exact log linear decomposition of the CES price

index into four terms:
ln PfFt

!
h
i
1
1
1
U
U
−
ln
+ U
E f t ln Sut − ln U − U
ln N U
=
f t,
σ
−
1
N
σ
−
1
g
g
{z
}
{z
}
|
|
ft
{z
}
{z
} |
|
(i) Average log
(ii) Average log
(iv)
Variety
(iii) Dispersion demandprices
demand
adjusted prices
EUft

h

U
ln Put

i

EUft

h

ϕU
ut

i



U ≡
where E [·] denotes the mean operator such that EUft ln Put

1
NU
ft

(14)

U ; the superscript U indicates
∑u∈ΩUft ln Put

that the mean is taken across products; and the subscripts f and t indicate that this mean varies across firms
and over time.8
This expression for the firm price index in equation (14) has an intuitive interpretation. When products are


U /ϕU ) is a sufficient
perfect substitutes (σgU → ∞), the average of log demand-adjusted prices (EUft ln Put
ut
statistic for the log firm price index (as captured by terms (i) and (ii)). The reason is that perfect substitutability
U /ϕU = PU /ϕU for all
implies the equalization of demand-adjusted prices for all consumed varieties (Put
ut
`t
`t

u, ` ∈ ΩUft as σgU → ∞). Therefore, the mean of the log demand-adjusted prices is equal to the log demand


U /ϕU
U
U
adjusted price for each product (EUft ln Put
= ln P`Ut /ϕU
ut
`t for all u, ` ∈ Ω f t as σg → ∞).
In contrast, when products are imperfect substitutes (1 < σgU < ∞), the firm price index also depends on
both the number of varieties (term (iv)) and the dispersion of demand-adjusted prices across those varieties
(term (iii)). The contribution from the number of varieties reflects consumer love of variety: if varieties are
imperfect substitutes (1 < σgU < ∞), an increase in the number of products sold by a firm (N U
f t ) reduces the
firm price index. Keeping constant the price-to-quality ratio of each variety, consumers obtain more utility
from firms that supply more varieties than others.
8 This

price index in equation (14) uses a different but equivalent expression for the
Hottman et al. (2016),
 CES
 price index
 from


in which the dispersion of sales across goods is captured using a different term from 1/ σgU − 1 EUft ln SU
ut .

10

The contribution from the dispersion of demand-adjusted prices also reflects imperfect substitutability. If
U
all varieties have the same demand-adjusted price, they all have the same expenditure share (SU
ut = 1/N f t ).

At this point, the mean of log-expenditure shares is maximized, and this third term is equal to zero. Moving
away from this point and increasing the dispersion of demand-adjusted prices, by raising the demand-adjusted
price for some varieties and reducing it for others, the dispersion of expenditure shares across varieties increases. As the log function is strictly concave, this increased dispersion of expenditure shares in turn implies
a fall in the mean of log expenditure shares. Hence, this third term is negative when demand-adjusted prices




U ), which reduces the firm price index. Intuitively, holding
<
ln
1/N
differ across varieties (EUft ln SU
ut
ft
constant average demand-adjusted prices, consumers prefer to source products from firms with more dispersed demand-adjusted prices, because they can substitute away from products with high demand-adjusted
prices and towards those with low demand-adjusted prices.
The decomposition in equation (14) can be undertaken in a sequence of steps. First, we can separate out the
contribution of variety (term (iv)) and demand-adjusted prices (terms (i)-(iii)). Second, we can break down the
demand-adjusted prices component (terms (i)-(iii)) into terms for average demand-adjusted prices (terms (i)(ii)) and the dispersion of demand-adjusted prices (term (iii)). Third, we can disaggregate the demand-adjusted
prices term into components for average prices (term (i)) and average demand (term (ii)). This sequential
decomposition is useful, because it highlights the ways in which the model-based price indexes differ from
standard empirical measures of average prices, since the change in average log prices (term (i) differenced)
is the log of a conventional Jevons Price Index. Furthermore, as the decomposition in equation (14) is log
additive, it provides the basis for exact log-linear decompositions of aggregate variables into different micro
mechanisms in the model. Finally, the log-linear nature of this decomposition also implies that it is robust to
measurement error in prices and/or expenditure shares that is mean zero in logs.

2.7

Entry, Exit and the Unified Price Index

One challenge in implementing this exact aggregation approach is the entry and exit of varieties over time
in the micro data. To correctly take account of entry and exit between each pair of time periods, we follow
Feenstra (1994) in using the share of expenditure on “common” varieties that are supplied in both of these
time periods. In particular, we partition the set of firms from exporter i supplying importer j within sector
g in periods t − 1 and t (Ω Fjigt−1 and Ω Fjigt respectively) into the subsets of “common firms” that continue
F+
to supply this market in both periods (Ω Fjigt,t−1 ), firms that enter in period t (Ijigt
) and firms that exit after
F−
period t − 1 (Ijigt
−1 ). Similarly, we partition the set of products supplied by each of these firms in that sector

+
U−
into “common products” (ΩUft,t−1 ), entering products (I U
f t ) and exiting products (I f t−1 ). A foreign exporting

country enters an import market within a given sector when its first firm begins to supply that market and
exits when its last firm ceases to supply that market. We can thus define analogous sets of foreign exporting
E+
E−
countries i 6= j for importer j and sector g: “common” (Ω Ejgt,t−1 ), entering (Ijgt
) and exiting (Ijgt
−1 ). We
F
denote the number of elements in these common sets of firms, products and foreign exporters by Njigt,t
−1 ,
E
NU
f t,t−1 and Njgt,t−1 respectively.

To incorporate entry and exit into the firm price index, we compute the shares of firm expenditure on

11

common products in periods t and t − 1 as follows:
λUft

 U
U /ϕU 1−σg
∑u∈ΩUft,t−1 Put
ut
≡
 U ,
U /ϕU 1−σg
∑u∈ΩU Put
ut

λUft−1

1−σgU
U /ϕU
∑u∈ΩUft,t−1 Put
−1
ut−1
≡
1−σgU ,
U /ϕU
Put
∑ u ∈ ΩU
−1
ut−1

(15)

f t −1

ft

where recall that ΩUft,t−1 is the set of common products such that ΩUft,t−1 ⊆ ΩUft and ΩUft,t−1 ⊆ ΩUft−1 .
Usingthese common
 expenditure shares, the change in the log firm price index between periods t − 1
F
F
and t (ln Pf t /Pf t−1 ) can be exactly decomposed into four terms that are analogous to those for our levels
decomposition in equation (14) above:
ln

PfFt
PfFt−1

!

"
!#
!#
"
!#
!
U
∗
λUft
ϕU
Put
SU
1
1
U∗
U∗
ut
ut
−
E
ln
+
+
E
ln
ln
,
ft
U
∗
Put
ϕU
σgU − 1 f t
SU
σgU − 1
λUft−1
−1
ut−1
ut−1
{z
} |
{z
} |
{z
} |
|
{z
}
(i) Average log
(ii) Average log
(iii) Dispersion demand(iv) Variety
prices
demand
adjusted prices
"

= EUf t∗ ln



U /PU
≡
as shown in Section A.2.7 of the web appendix; EUf t∗ ln Put
ut−1

1
NU
f t,t−1

(16)


U /PU
∑u∈ΩUft,t−1 ln Put
ut−1 ;

the superscript U ∗ indicates that the mean is taken across common products; and the subscripts f and t

∗
indicate that this mean varies across firms and over time; SU
ut is the share of an individual common product

in expenditure on all common products, which takes the same form as the expression in equation (12), except
that the summation in the denominator is over the set of common products (ΩUft,t−1 ); if entering varieties
are either more numerous or have lower demand-adjusted prices than exiting varieties, the common goods


expenditure share at time t is lower than at time t − 1, implying a fall in the price index (ln λUft /λUft−1 < 0).
We refer to the exact CES price index in equation (16) as the “unified price index” (UPI), because the
time-varying demand shifters for each product (ϕU
ut ) ensure that it exactly rationalizes the micro data on
prices and expenditure shares, while at the same time it permits exact aggregation to the macro level, thereby

1/(σgU −1)
unifying micro and macro. This price index shares the same variety correction term λUft /λUft−1
as Feenstra (1994). The key difference from Feenstra (1994) is the formulation of the price index for common
goods, which we refer to as the “common-goods unified price index” (CG-UPI). Instead of using the SatoVartia price index for common goods, which assumes time-invariant demand/quality for each common good,
we use the formulation of this price index for common goods from Redding and Weinstein (2016), which
allows for changes in demand/quality for each common good over time.

2.8

Model Inversion

U , X U } and the substitution paramGiven the observed data on prices and expenditures for each product {Put
ut

eters {σgU , σgF , σ G }, the model is invertible, such that unique values of demand/quality can be recovered from
the observed data (up to a normalization or choice of units). We illustrate this inversion for the firm tier of
utility, but the same approach holds for each of our tiers of utility. Dividing the share of a product in firm
expenditure (12) by its geometric mean across common products within that firm, product demand can be
expressed as the following function of data and parameters:
U
Put
ϕU
ut


 U
=
MUf t∗ ϕU
MUf t∗ Put
ut

12

SU
ut
 
MUf t∗ SU
ut

!

1
σgU −1

.

(17)

1/Nt,tU −1
  
U
.
ϕ
≡
where M [·] is the geometric mean operator such that MUf t∗ ϕU
U
∏
ut
u∈Ω f t,t−1 ut
As the CES expenditure shares are homogeneous of degree zero in the demand/quality parameters, we
G
F
can only recover the product, firm and sector demand parameters {ϕU
ut , ϕ f t , ϕ jgt } up to a choice of units

in which to measure these parameters. We choose the convenient choice of units such that the geometric
 
mean of product demand across common products within each foreign firm is equal to one (MUf t∗ ϕU
ut = 1
in equation (17)), the geometric mean of firm demand across common foreign firms within each sector is
equal to one, and the geometric mean of sector demand across tradable sectors is equal to one. Under these
normalizations, product demand (ϕU
ut ) captures the relative demand/quality of products within foreign firms;
firm demand (ϕ Fft ) absorbs the relative demand/quality of foreign firms within sectors; and sector demand
9
(ϕG
jgt ) reflects the relative demand/quality of tradable sectors.

Given this choice of units, we use the recursive structure of the model to solve for unique values of
G
F
product, firm and sector demand {ϕU
ut , ϕ f t , ϕ jgt }, as shown in Section A.2.8 of the web appendix. First, we

use the product expenditure share in equation (17) to solve for product demand/quality (ϕU
ut ). Second, we
use these solutions for product demand/quality to construct the firm price index for each foreign firm (PfFt ).
Third, we use the shares of individual foreign firms in expenditure on foreign imports within a sector to solve
for demand/quality for each foreign firm (ϕ Fft ). Fourth, we use these solutions for demand/quality for each
foreign firm and the share of expenditure on foreign firms within the sector (µG
jgt ) to compute the price index
G ). Fifth, we use the share of individual tradable sectors in expenditure on all
for each tradable sector (Pjgt

tradable sectors (µ Tjt ) to solve for demand/quality for each tradable sector (ϕG
gt ). Sixth, we use these solutions
for sector demand/quality for each tradable sector and the share of aggregate expenditure on tradable sectors
to compute the aggregate price index (Pjt ).
Our decompositions of comparative advantage across countries and sectors are robust to alternative
choices of units in which to measure product, firm and sector demand/quality. In particular, comparative
advantage is based on relative comparisons across countries and sectors. Therefore, any common choice of
units across firms within each sector differences out when we compare firms from different countries within
U , X U } and the substitution parameters
that sector. Given the observed data on prices and expenditures {Put
ut

{σgU , σgF , σ G }, no supply-side assumptions are needed to undertake this analysis and recover the structural
F
G
U
U
residuals {ϕU
ut , ϕ f t , ϕ jgt }. The reason is that we observe both prices (Put ) and expenditures (Xut ). Therefore,

we do not need to take a stand on the different supply-side forces that determine the observed prices (e.g.
technology, factor prices, oligopoly, monopolistic competition or perfect competition). Hence, the only way in
which supply-side assumptions enter our analysis is through the estimation of the elasticities of substitution,
as discussed further in Section 3 below.
An important difference between our approach and standard exact price indexes for CES is that we allow
the demand/quality parameters to change over time. Therefore, our framework captures demand/quality
9 For

 
firms with no common products, we set the geometric mean of demand across all products equal to one (MUft ϕU
ut = 1),

F
which enables us to recover product demand (ϕU
ut ) and construct the firm price index (P f t ) for these firms. This choice has no
G
impact on the change in the exporter price indexes (PEjigt /PEjigt−1 ) and sectoral import price indexes (PG
jgt /P jgt−1 ), because firms

with no common products enter these changes in price indexes through the variety correction terms (λ Fjigt /λ Fjigt−1 and λ Fjgt /λ Fjgt−1
respectively) that depend only on observed expenditures.

13

F
upgrading for individual foreign products (changes in ϕU
ut ) for individual foreign firms (changes in ϕ f t ) and

for individual tradable sectors (changes in ϕG
jgt ). We also allow for proportional changes in the demand/quality
for all foreign varieties relative to all domestic varieties within each sector, which are implicitly captured in
the shares of expenditure on foreign varieties within sectors (µG
jgt ) in equation (7) for the sectoral price index
G ). Similarly, we allow for proportional changes in the demand/quality for all tradable sectors relative
(Pjgt

to all non-tradable sectors, which are implicitly captured in the share of expenditure on tradable sectors
(µ Tjt ) in equation (4) for the aggregate price index (Pjt ). Finally, the only component of demand/quality that
cannot be identified from the observed expenditure shares is proportional changes in demand/quality across
all sectors (both traded and non-traded) over time. Nevertheless, our specification considerably generalizes
the conventional assumption that demand/quality is time-invariant for all common varieties.

2.9

Exporter Price Movements

Having inverted the model to recover the unobserved demand/quality parameters that rationalize the observed data, we now show how to aggregate to the exporter price index that summarizes the cost of sourcing
goods across countries and sectors. Recursively applying our log linear representation of the CES price index
in equation (14) for the exporter and firm price indexes, we obtain the following exact log linear decomposition of the exporter price index, as shown in Section A.2.9 of the web appendix:
ln PEjigt

EFU
jigt

=

h

U
ln Put

i

|
{z
}
(i) Average log
prices

−

n
|

EFjigt

h

ln

ϕ Fft

i

+ EFU
jigt

h

{z
(ii) Average log
demand

ln

ϕU
ut

(

"
#
"
#)
1
1
1
1
FU
U
F
EF
+
E
ln Sut − ln U + F
E
ln S f t − ln F
(18)
σg − 1 jigt
Njigt
σgU − 1 jigt
Nf t
}
|
{z
}
(iii) Dispersion demand-adjusted prices

io

(

)
h
i
1
1
F
U
F
E
−
ln N f t + F
ln Njigt ,
σg − 1
σgU − 1 jigt
{z
}
|
(iv) Variety

where SEF
f t is the share of a firm in imports from an individual exporting country and sector, as defined in


1
1
U
U
Section A.2.9 of the web appendix; EFU
jigt ln Put ≡ N F ∑ f ∈Ω Fjigt N U ∑u∈ΩUft ln Put is a mean across firms and
jigt
ft
h
i
products within that exporting country and sector; and EFjigt ln PfFt ≡ N1F ∑ f ∈ΩF ln PfFt is a mean across
jigt

jigt

firms for that country and sector.
Similarly, partitioning varieties into those that are common, entering and exiting, and taking differences
over time, we obtain an analogous exact log linear decomposition for changes in the exporter price index:
(
)
n
h
i
h
io
h
i
h
i
h
i
1
1
∗
U
F∗
F
FU ∗
U
FU ∗
U∗
F∗
EF
∆ ln PEjigt = EFU
∆
ln
P
−
E
∆
ln
ϕ
+
E
∆
ln
ϕ
+
E
∆
ln
S
+
E
∆
ln
S
ut
ut
ut
jigt
jigt
jigt
ft
ft
σgF − 1 jigt
σgU − 1 jigt
|
{z
}
|
{z
}
|
{z
}
(i) Average log
(ii) Average log
(iii) Dispersion demand-adjusted prices
prices
demand
(

+

)
h
i
1
1
F
F∗
U
∆
ln
λ
E
∆
ln
λ
+
jigt ,
ft
σgF − 1
σgU − 1 jigt
|
{z
}
(iv) Variety

as also shown in Section A.2.9 of the web appendix.
14

(19)

Equations (18) and (19) make explicit the three key features of our framework that allow exact aggregation
from micro to macro. First, we can invert the model to recover the unobserved demand/quality parameters
G
F
{ϕU
ut , ϕ f t , ϕ gt } that rationalize the observed data. Second, for each tier of utility, the CES price index can be

written as a log linear form of these demand/quality parameters and the observed data. Third, demand is
nested, such that the price index for utility tier K depends on the price index and demand/quality parameters
for utility tier K − 1. Combining these three properties, and noting that the mean for tier K of the means
from tier K − 1 remains linear, we obtain our exact log linear decomposition of aggregate variables into the
contributions of different microeconomic mechanisms.
Each of the terms in these equations have an intuitive interpretation. The first term in equation (19) is
the average log change in the price of common products sourced from exporting country i within sector


∗
U
g (EFU
jigt ∆ ln Put ). This first component equals the log of a Jevons Index, which is a standard empirical
measure of average prices, and is used to aggregate prices in the U.S. consumer price index.
h
i


∗ ln ϕ F + E FU ∗ ln ϕU ) captures demand shifts or quality upgrading for comThe second term (EFjigt
ut
jigt
ft
mon products and firms and its presence reflects the fact that consumers care about demand-adjusted prices
rather than prices alone. Recall that our normalization in equation (A.2.7) implies that the average log change


∗
U
in common-product demand within foreign firms is equal to zero: EFU
jigt ∆ ln ϕut = 0. Similarly, our normalization in equation (A.2.10) implies that the average log change in firm demand across all common foreign
h
i
firms within a sector is equal to zero: EFjgt∗ ∆ ln ϕ Fft = 0. Nevertheless, the relative demand/quality of firms
in different foreign countries within that sector can change, if demand/quality rises in some countries relative
h
i
h
i
∗ ∆ ln ϕ F
F ∗ ∆ ln ϕ F
to others, in which case this second term is non-zero: EFjigt
6
=
E
jgt
ft
f t = 0 for country
i 6= j. Therefore, if one foreign exporter upgrades its demand/quality relative to another, this implies a fall in
the cost of sourcing imports from that exporter relative to other foreign exporters.
The third term captures the dispersion of demand-adjusted prices across common products and firms
for a given exporter and sector. Other things equal, if the dispersion of these demand-adjusted prices in

∗ ∆ ln SU ∗ < 0 and
creases, this reduces the cost of sourcing goods from that exporter and sector (EFU
ut
jigt
h
i
∗ ∆ ln SEF < 0). The reason is that this increased dispersion of demand-adjusted prices enhances the
EFjigt
ft
ability of consumers to substitute away from varieties with high demand-adjusted prices and towards varieties
with low demand-adjusted prices.
h
i
∗ ∆ ln λU +
The fourth term in equation (19) ( σU1−1 EFjigt
ft
g

1
∆ ln λ Fjigt )
σgF −1

captures the effect of product

turnover and firm entry and exit on the cost of sourcing imports from a given exporter and sector. If entering
firms and products are more numerous or desirable than exiting firms and products, this again reduces the
h
i
∗ ∆ ln λU < 0 and ∆ ln λ F < 0).
cost of sourcing goods from that exporter and sector (EFjigt
jigt
ft

2.10

Patterns of Trade Across Sectors and Countries

Thus far, we have been focused on measuring the price indexes that determine the costs of sourcing goods
from a given exporter and sector. The move from price indexes to trade patterns, however, is straightforward,
because these patterns of trade are determined by relative price indexes. We can therefore translate our results
for exporter price indexes into the determinants of patterns of trade across countries and sectors.
15

2.10.1

Revealed Comparative Advantage

We begin by deriving a theoretically-rigorous measure of revealed comparative advantage (RCA) that holds
in all models based on a CES demand system. We start with importer j’s expenditure on foreign exporter
i 6= j as a share of its expenditure on all foreign exporters within sector g at time t:
1−σgF


1−σgF
F /ϕ F
P
PEjigt
∑ f ∈ΩFjigt
f
t
f
t
SEjigt =
i 6= j.

1−σgF = 
1−σgF ,
G
F
F
Pf t /ϕ f t
P jgt
∑ h∈Ω E ∑ f ∈Ω F
jgt

(20)

jhgt

where the single superscript E is a mnemonic for exporter and indicates that this is the expenditure share
for a foreign exporting country i 6= j; the numerator in equation (20) captures importer j’s price index for
exporting country i in sector g at time t (PEjigt ); and the denominator in equation (20) features importer j’s
overall import price index in sector g at time t (PG
jgt ).
Using the definition of this exporter expenditure share (20), we measure RCA in sector g for import market
j, by first taking the value of country i’s exports relative to the geometric mean across countries for that sector
h
i
(XEjigt /MEjgt XEjigt ), and then dividing by country i’s geometric mean of this ratio across tradable sectors
h
h
ii
(MTjit XEjigt /MEjgt XEjigt ):

RCA jigt

h
i
h
i
SEjigt /MEjgt SEjigt
XEjigt /MEjgt XEjigt
ii =
ii ,
h
h
h
h
≡
MTjit XEjigt /MEjgt XEjigt
MTjit SEjigt /MEjgt SEjigt

(21)

where we use XEjigt to denote the value of bilateral exports from country i to importer j 6= i within sector
E
h
i

1/Njgt
g at time t; MEjgt XEjigt = ∏h∈ΩE XEjhgt
is the geometric mean of these exports across all foreign
jgt
h
i

1/NjitT
exporters for that importer and sector; MTjit XEjigt = ∏k∈ΩT XEjikt
is the geometric mean of these
jit

exports across tradable sectors for that importer and foreign exporter; and SEjigt = XEjigt / ∑h∈ΩE XEjhgt =
jgt

XEjigt /XG
jgt is the share of foreign exporter i 6 = j in country j’s imports from all foreign countries within
sector g at time t.
From equation (21), an exporter has a revealed comparative advantage in a sector within a given import
market (a value of RCA jigt greater than one) if its exports relative to the average exporter in that sector are
larger than for its average sector. This RCA measure is similar to those in Costinot, Donaldson and Komunjer
(2012) and Levchenko and Zhang (2016). However, instead of choosing an individual sector and country as the
base for the double-differencing, we first difference relative to a hypothetical country within a sector (equal
to the geometric mean country for that sector), and then second difference relative to a hypothetical sector
(equal to the geometric mean across sectors).10 We also derive our measure solely from our demand-side
assumptions, without requiring a Ricardian supply-side to the model.
As we now show, these differences enable us to quantify the role of different economic mechanisms in
understanding patterns of trade across countries and sectors. From equations (20) and (21), RCA captures the
10 Our measure also relates closely to Balassa (1965)’s original measure of RCA, which divides a country’s exports in a sector by
the total exports of all countries in that sector, and then divides this ratio by the country’s share of overall exports across all sectors.
Instead, we divide a country’s exports in a sector by the geometric mean exports in that sector across countries, and then divide this
ratio by its geometric mean across sectors.

16

relative cost to an importer of sourcing goods across countries and sectors, as determined by relative price

1−σgF
):
indexes and the elasticity of substitution ( PEjigt

1−σgF 

1−σgF
E
E
E
/M jgt P jigt
P jigt


RCA jigt =
(22)
1−σgF
1−σgF  .
T
E
E
E
M jit P jigt
/M jgt P jigt
Taking logarithms in equation (22), and using equation (18) to substitute for the log exporter price index
(ln PEjigt ), we can decompose differences in log RCA across countries and sectors into the contributions of




ϕ
average log prices (ln RCA Pjigt ), average log demand (ln RCA jigt ), the dispersion of demand-adjusted




prices (ln RCASjigt ), and variety (ln RCA N
jigt ):









ϕ
ln RCA jigt = ln RCA Pjigt
+ ln RCA jigt
+
ln RCASjigt
+ ln RCA N
jigt ,
|
{z
}
|
{z
}
|
{z
}
|
{z
}
(i) Average log
(ii) Average log
(iii) Dispersion demand(iv) Variety
prices
demand
adjusted prices

(23)

where each of these terms is defined in full in Section A.2.10.1 of the web appendix.
Each term is a double difference in logs, in which we first difference a variable for an exporter and sector
relative to the mean across exporters for that sector (as in the numerator of RCA), before then second differencing the variable across sectors (as in the denominator of RCA). For example, to compute the average log


price term (ln RCA Pjigt ), we proceed as follows. In a first step, we compute average log product prices for
an exporter and sector in an import market. In a second step, we subtract from these average log product
prices their mean across all exporters for that sector and import market. In a third step, we difference these
scaled average log product prices from their mean across all sectors for that exporter and import market.
Other things equal, an exporter has a RCA in a sector if its log product prices relative to the average exporter
in that sector are low compared to the exporter’s average sector.
A key implication of equation (23) is that comparative advantage cannot be measured independently of
U
F
F
demand when goods are differentiated (σgU < ∞, σgF < ∞, ϕU
ut 6 = ϕ`t for u 6 = `, and ϕ f t 6 = ϕmt for f 6 = m),

in the same way that productivity cannot be measured independently of demand in this case.11 The reason is
that comparative advantage depends on relative price indexes, which cannot be inferred from relative prices
alone if goods are differentiated. In such a setting, average demand/quality, the number of products and firms,
and the dispersion of demand-adjusted prices across these products and firms (as captured by the dispersion
of expenditure shares) are also important determinants of relative price indexes.
Similarly, partitioning varieties into those that are common, entering and exiting, and taking differences
over time, we can decompose changes in RCA across countries and sectors into four analogous terms:










ϕ∗
∗
∗
∆ ln RCA∗jigt = ∆ ln RCA Pjigt
+ ∆ ln RCA jigt +
∆ ln RCASjigt
+ ∆ ln RCAλjigt ,
|
{z
}
|
{z
}
|
{z
}
|
{z
}
(i) Average log
(ii) Average log
(iii) Dispersion demand(iv) Variety
prices
demand
adjusted prices

(24)

11 For a discussion of the centrality of demand to productivity measurement when goods are imperfect substitutes, see for example

Foster, Haltiwanger and Syverson (2008) and De Loecker and Goldberg (2014).

17

where all four terms are again defined in full in subsection A.2.10.1 of the web appendix.
The interpretation of these four terms is similar to that for our decomposition of exporter price indexes
above. Other things equal, an exporter’s RCA in a sector rises if its prices fall faster than its competitors in that
sector relative to other sectors. The second term incorporates the effects of average log demand/quality. All
else constant, RCA increases in a sector if an exporter’s demand/quality rises more rapidly than its competitors
in that sector relative to other sectors. The third term summarizes the impact of the dispersion of demandadjusted prices across varieties. Other things equal, RCA rises for an exporter in a sector if the dispersion of
demand-adjusted prices increases relative to its competitors in that sector more than in other sectors. As its
demand-adjusted prices become more dispersed, this enables consumers to more easily substitute from the
exporter’s less attractive varieties to its more attractive varieties, which increases the demand for its goods.
Finally, the fourth term summarizes the contribution of entry/exit. All else constant, if entering varieties are
more numerous or have lower demand-adjusted prices than exiting varieties, this increases the value of trade.
Therefore, an exporter’s RCA in a sector increases if the exporter’s rate of net product and firm entry relative
to its competitors in that sector exceeds its relative rate in other sectors.
2.10.2

Aggregate Trade

We now aggregate further to obtain an exact log linear decomposition of exporting countries’ shares of total
imports that can be used to examine the reasons for the large-scale changes in countries’ import shares over
our sample period (such as the dramatic rise in Chinese import penetration). At first sight, our ability to obtain
log linear decompositions of both sectoral and aggregate trade is somewhat surprising, because aggregate
trade is the sum of sectoral trade (rather than the sum of log sectoral trade). What makes this possible is that
the structure of CES demand yields a closed-form solution for an exact Jensen’s Inequality correction term
that controls for the difference between the log of the sum and the sum of the logs.
Partitioning varieties into common, entering and exiting varieties, we show in Section A.2.10.2 of the web
appendix that the log change in the share of foreign exporter i in importer j’s total expenditure on all foreign
importers can be exactly decomposed as follows:
n
h

i
h

io
∗
U
∗
U
∆ ln SEjit = − ETFU
σgF − 1 ∆ ln Put
− ETEFU
σgF − 1 ∆ ln Put
jit
jt
|
{z
}
(i) Average log prices

n
h

i
h

io n
h

i
h

io
∗
TEFU ∗
∗
∗
+ ETFU
σgF − 1 ∆ ln ϕU
σgF − 1 ∆ ln ϕU
+ ETF
σgF − 1 ∆ ln ϕ Fft − ETEF
σgF − 1 ∆ ln ϕ Fft
ut − E jt
ut
jit
jt
jit
{z
} |
{z
}
|
(ii) Average log product demand

(

"

∗
− ETFU
jit

|

σgF − 1
σgU − 1

#
∗
∗
∆ ln SU
− ETEFU
ut
jt

(iii) Average log firm demand

σgF − 1
σgU − 1

#)
∗
∆ ln SU
ut

{z

}

(iv) Dispersion demand-adjusted product prices

(

"

∗
− ETF
jit

σgF − 1
σgU

−1

#

"

∗
∆ ln λUft − ETEF
jt

|

+

"

σgF − 1
σgU

−1

#)
∆ ln λUft

{z

}

(vi) Product Variety

∆ ln KTjit
| {z }

(ix) Country-sector Scale

+

∆ ln JTjit
| {z }

n

h

i

h
io
∗
∗
∗
∗
− ETF
∆ ln SEF
− ETEF
∆ ln SEF
jit
jt
ft
ft
|
{z
}
(v) Dispersion demand-adjusted firm prices

n
h
i
h
io
∗
− ETjit ∆ ln λ Fjigt − ETE
∆ ln λ Fjigt −
jt
|
{z
}
(vii) Firm Variety



∆ ln λ Ejit /λ Tjt
|
{z
}

(25)

(viii) Country-Sector Variety

,

(x) Country-sector Concentration

where the country-sector scale (∆ ln KTjit ) and country-sector concentration (∆ ln JTjit ) terms are defined in
18

∗ [·], ETFU ∗ [·], ETF ∗ [·], ETEF ∗ [·], ETE∗ [·] and ET [·] are means
Section A.2.10.2 of the web appendix; ETEFU
jit
jt
jt
jit
jit
jt

across sectors, exporters, firms and products, as also defined in that section of the web appendix.
From the first term (i), an exporter’s import share increases if the average prices of its products fall more
rapidly than those of other exporters. In the second term (ii), our choice of units for product demand in
equation (A.2.7) implies that the average log change in demand across common products within firms is


equal to zero (EUf t∗ ∆ ln ϕU
ut ), which implies that this second term is equal to zero. From the third term (iii),
an exporter’s import share also increases if the average demand/quality of its firms rises more rapidly than
that of firms from other exporters within each sector (recall that our choice of units for firm demand only
implies that its average log change equals zero across all foreign firms within each sector).
The fourth and fifth terms ((iv) and (v)) capture the dispersion of demand-adjusted prices across common
products and firms. An exporter’s import share increases if demand-adjusted prices become more dispersed
across its products and firms compared to other foreign exporters. The sixth through eighth terms ((vi)(viii)) capture the contribution of entry/exit to changes in country import shares. An exporter’s import share
increases if its entering products, firms and sectors are more numerous and/or have lower demand-adjusted
prices compared to its exiting varieties than those for other foreign exporters.
The last two terms capture compositional effects across sectors. From the penultimate term (ix), an exporter’s import share increases if its exports become more concentrated in sectors that account for large
shares of expenditure relative to exports from other foreign countries. The final term (x) captures the concentration of imports across sectors for an individual exporter relative to their concentration across sectors
for all foreign exporters. This final term is the exact Jensen’s Inequality correction term discussed above.

2.11

Aggregate Prices

In addition to understanding aggregate trade patterns, researchers are often interested in understanding
movements in the aggregate cost of living, since this is important determinant of real income and welfare. In
Section A.2.11 of the web appendix, we show that the change in the aggregate price index in equation (4) can
be exactly decomposed into the following five terms:
"
#


h
i
h
i
1
1
1
T
T
T
G
T
T
G
T
G
∆ ln Pjt
=
∆
ln
µ
+
E
+
E
∆
ln
ϕ
+
E
∆
ln
S
, (26)
∆
ln
µ
+
E
∆
ln
P
jt
jt
jt
jt
jgt
jt
jgt
jgt
jgt
F
σg − 1
σG − 1
σG − 1
| {z }
|
{z
}
|
{z
}
|
{z
}
|
{z
}
{z
}
|
Aggregate
Average
Aggregate Import
Non-Tradable
Dispersion demandDomestic
Price Index
Demand
Price Indexes
Competitiveness
adjusted prices across sectors
Competitiveness

where STjgt is the share of an individual tradable sector in expenditure on all tradable sectors. Recall that the
set of tradable sectors is constant over time and hence there are no terms for the entry and exit of sectors in
equation (26).
The first three terms capture shifts in aggregate prices that can be inferred from changes in market shares
or demand. The first term ( σG1−1 ∆ ln µ Tjt ) captures the relative attractiveness of varieties in the tradable and
non-tradable sectors. Other things equal, a fall in the share of expenditure on tradable sectors (∆ ln µ jtI < 0)
implies that varieties in non-tradable sectors have become relatively more attractive, which reduces the cost
h
i
of living. The second term (ETjt σ F1−1 ∆ ln µG
jgt ) captures the relative attractiveness of domestic varieties
g

19

within sectors. Other things equal, a fall in the average share of expenditure on foreign varieties within
h
i
sectors (ETjt σ F1−1 ∆ ln µG
< 0) implies that domestic varieties have become relatively more attractive
jgt
g
h
i
within sectors, which again reduces the cost of living. The third term (ETjt ∆ ln ϕG
jgt ) captures changes in
the average demand/quality for tradable sectors, where the superscript T on the expectation indicates that
this mean is taken across the subset of tradable sectors (Ω T ⊆ ΩG ). Given our choice of units in which
h
i
to measure sector demand/quality, this third term is equal to zero (ETjt ∆ ln ϕG
jgt = 0). The fourth term
h
i
(ETjt σG1−1 ∆ ln SG
jgt ) captures changes in the dispersion of demand-adjusted prices across tradable sectors.
Intuitively, when sectors are substitutes (σ G > 1), an increase in the dispersion of demand-adjusted prices
across sectors reduces the cost of living, as consumers can substitute from less to more desirable sectors. The
h
i
fifth and final term (ETjt ∆ ln PG
jgt ) captures changes in aggregate import price indexes across all tradable
h
i
sectors. Other things equal, a fall in these aggregate import price indexes (ETjt ∆ ln PG
jgt < 0) reduces the
cost of living. We now show that this fifth term can be further decomposed.
Partitioning goods into common, entering and exiting varieties, Section A.2.11 of the web appendix shows
that the change in aggregate import price indexes can be exactly decomposed as follows:
h
i
h
i
h
i
h
i
∗
U
∗
∗
= ETEFU
∆ ln Put
− ETEF
ln ϕU
ETjt ∆ ln PG
∆ ln ϕ Fft − ETEFU
ut
jt
jt
jt
jgt
|
|
{z
}
{z
}
|
{z
}
{z
}
|
Aggregate Import
Average log prices
Average log
Average log
Price Indexes
firm demand
product demand
"
#
#
#
"
"
1
1
1
∗
E
EF
U
TEF ∗
TEFU ∗
ETE
∆
ln
S
∆
ln
S
∆
ln
S
+
E
+
E
ut
jt
jigt
jt
jt
ft
σgF − 1
σgF − 1
σgU − 1
|
|
{z
}
{z
} |
{z
}
Dispersion country-sector
Dispersion firm
Dispersion product
demand-adjusted prices
demand-adjusted prices
demand-adjusted prices

(27)

#
#
"
#
"
1
1
1
U
E
TE∗
F
TEF ∗
∆ ln λ f t .
∆ ln λ jgt + E jt
∆ ln λ jigt + E jt
σgF − 1
σgF − 1
σgU − 1
{z
} |
{z
} |
{z
}
Country - Sector
Firm
Product
Variety
Variety
Variety
"

+ ETjt∗
|

The interpretation of each of these components in equation (27) is analogous to the interpretation of the
corresponding components of countries aggregate import shares in equation (25). Aggregate import price
indexes fall with declines in average product prices, rises in average firm and product demand, increases
in the dispersion of demand-adjusted prices across surviving countries, firms and products, and if entering
countries, firms and products are more numerous or more desirable than those that exit.

3

Structural Estimation

In order to take our model to data, we need estimates of the elasticities of substitution {σgU , σgF , σ G }. We now
turn to our estimation of these elasticities, which is the only place in our approach where we are required
to make assumptions about the supply-side. In particular, in the data, we observe changes in expenditure
shares and changes in prices, which provides a standard demand and supply identification problem. In a
CES demand system with N goods, this identification problem can be equivalently formulated as follows:
we have N parameters, which include N − 1 independent demand shifters (under a normalization) and one
20

elasticity of substitution, but we have only N − 1 independent equations for expenditure shares, resulting in
underidentification.
In our baseline specification, we estimate these elasticities of substitution using an extension of the
reverse-weighting (RW) estimator of Redding and Weinstein (2016). This reverse weighting estimator solves
the above underidentification problem by augmenting the N − 1 independent equations of the demand system with two additional equations derived from three equivalent ways of writing the change in the unit
expenditure function. In the web appendix, we also report robustness checks, in which we compare our RW
estimates of the elasticities of substitution to alternative estimates, and in which we examine the sensitivity
of our results to alternative values of these elasticities of substitution using a grid search.
We extend the RW estimator to a nested demand system and show that the estimation problem is recursive.
In a first step, we estimate the elasticity of substitution across products (σgU ) for each sector g. In a second
step, we estimate the elasticity of substitution across firms (σgF ) for each sector g. In a third step, we estimate
the elasticity of substitution across sectors (σ G ).
In this section, we illustrate the RW estimator for the product tier of utility, and report the full details of
the nested estimation in Section A.3 of the web appendix. The RW estimator is based on three equivalent
expressions for the change in the CES unit expenditure function: one from the demand system, a second from
taking the forward difference of the unit expenditure function, and a third from taking the backward difference
of the unit expenditure function. Together these three expressions imply the following two equalities

+
ΘUf t,t
−1




∑

∗
SU
ut−1

u∈ΩUft,t−1

U
Put
U
Put
−1


−
ΘUf t,t
−1




∑

u∈ΩUft,t−1

∗
SU
ut

U
Put
U
Put−1

!1−σgU



1
1−σgU

!−(1−σgU )

−

"

=




MUf t∗

1
1−σgU

"

=




U
Put
U
Put
−1

MUf t∗

"

#

U
Put
U
Put−1

MUf t∗

#

∗
SU
ut
∗
SU
ut−1

"
MUf t∗

#!

∗
SU
ut
U
∗
Sut−1

1
σgU −1

#!

,

1
σgU −1

(28)

,

(29)


 U1
where the variety correction terms ( λUft /λUft−1 σg −1 ) have cancelled because they are common to all three
+
U−
expressions; ΘUf t,t
−1 and Θ f t,t−1 are forward and backward aggregate demand shifters respectively, which

summarize the effect of changes in the relative demand for individual products on the unit expenditure function (as defined in Section A.3 of the web appendix); finally the equalities in equations (28) and (29) are robust
to introducing a Hicks-neutral shifter of demand/quality across all products within each firm, which would
cancel from both sides of the equation (like the variety correction term).
The RW estimator uses equations (28) and (29) to estimate the elasticity of substitution across products
(σgU ) under the identifying assumption that the shocks to relative demand/quality cancel out across products:

 −1
+
U−
ΘUf t,t
=
Θ
= 1.
−1
f t,t−1

(30)

The asymptotic properties of this estimator are characterized in Redding and Weinstein (2016). The RW
U
estimator is consistent as demand shocks become small (ϕU
ut /ϕut−1 → 1) or as the number of common goods
U
becomes large and demand shocks are independently and identically distributed (Nt,t
−1 → ∞). More gen-

erally, the identifying assumption in equation (30) is satisfied up to a first-order approximation. Therefore,
21

the RW estimator can be interpreted as providing a first-order approximation to the data. In practice, we find
that the RW estimated elasticities are similar to those estimated using other methods, such as the generalization of the Feenstra (1994) estimator used in Hottman et al (2016). More generally, a key advantage of our
CES specification is that it is straightforward to undertake robustness checks to alternative values of these
elasticities of substitution using a grid search.

4

Data Description

To undertake our empirical analysis of the determinants of trade patterns and aggregate prices, we use international trade transactions data that are readily available from customs authorities. In this section, we briefly
discuss the U.S. trade transactions data that we use in the paper, and report further details in Section A.4.1 of
the web appendix. In Section A.4.2 of the web appendix, we discuss the Chilean trade transactions data that
we use in robustness tests in the web appendix.
For each U.S. import customs shipment, we observe the cost inclusive of freight value of the shipment in
U.S. dollars (market exchange rates), the quantity shipped, the date of the transaction, the product classification (according to 10-digit Harmonized System (HS) codes), the country of origin, and a partner identifier
containing information about the foreign exporting firm.12 We concord the HS-digit 10-digit products to 4digit sectors in the North American Industry Classification System (NAICS). We are thus able to construct a
dataset for a single importer j (the U.S.) with many exporters i (countries of origin), sectors g (4-digit NAICs
codes), firms f (foreign firm identifiers within exporters within sectors), and products u (10-digit HS codes
within foreign firm identifiers, within exporters and within sectors) and time t (year). We standardize the
units in which quantities are reported (e.g. we convert dozens to counts and grams to kilograms). We also
drop any observations for which countries of origin or foreign firm identifiers are missing. Finally, we collapse
the import shipments data to the annual level by exporting firm and product, weighting by trade value, which
yields a dataset on U.S. imports by source country (exporter), foreign firm, product and year from 1997-2011.
In our final year of 2011, we have over 3.7 million observations by exporter-firm-product.
Our measure of prices is the export unit value of an exporting firm within a 10-digit HS category. While
these data necessarily involve some aggregation across different varieties of products supplied by the same exporting firm within an observed product category, Section A.7 of the web appendix shows that our framework
generalizes to the case in which firms make product decisions at a more disaggregated level than observed
in the data. In this case, the product demand shifter (ϕU
ut ) captures unobserved compositional differences
within each observed product category. Moreover, 10-digit HS categories are relatively narrowly defined,
and the coverage of sectors is much wider than in datasets that directly survey prices. As a result, many
authors—including those working for statistical agencies—advocate for greater use of unit value data in the
construction of import price indexes.13 Furthermore, existing research comparing aggregate import price in12 See Kamal, Krizan and Monarch (2015) for further discussion of the U.S. trade transactions data and comparisons of these partner

identifiers using import data for the U.S. and export data from foreign countries. In robustness checks, we show that we continue
to find that the variety and average demand/quality terms dominate if we omit this partner identifier (and focus only on countries,
sectors and products) or use Chilean trade transactions data that report foreign brands.
13 For instance, Nakamura et al (2015) argue for the superiority of indexes based on disaggregated unit value data on theoretical

22

dexes constructed using unit values and directly surveyed prices finds only small differences between them,
as reported using U.S. data in Amiti and Davis (2009).
In Section A.5.5 of the web appendix, we show that our U.S. trade transactions data exhibit the same
properties as found by a number of existing studies in the empirical trade literature.14 Two key features are
the high concentration of trade across countries and the dramatic increase in Chinese import penetration. As
shown in Figure A.5.5 of that section of the web appendix, the top 20 import source countries account for
around 80 percent of U.S. imports in each year; China’s import share more than doubles from 7 to 18 percent
from 1997-2011; in contrast, Japan’s import share more than halves from 14 to 6 percent over this period.

5

Empirical Results

We present our results in several stages. We begin in Section 5.1 by reporting our estimates of the elasticities
of substitution (σgU , σgF , σ G ), which we use to invert the model and recover the values of product, firm and
F
G
sector demand/quality (ϕU
ut , ϕ f t , ϕ jgt ). In Section 5.2, we use these estimates to compute the exporter price

indexes that determine the cost of sourcing goods across countries and sectors. In Section 5.3, we report our
main results for comparative advantage, aggregate trade and aggregate prices. In Section 5.4, we compare the
results of our framework with special cases that impose additional theoretical restrictions. In Section A.6 of
the web appendix, we replicate all of these specification using our Chilean trade transactions data, and show
that we find the same qualitative and quantitative pattern of results.

5.1

Elasticities of Substitution

In Table 1, we summarize our baseline estimates of the elasticities of substitution (σgU , σgF , σ G ). Since we
estimate a product and firm elasticity for each sector, it would needlessly clutter the paper to report all of these
elasticities individually. Therefore we report quantiles of the distributions of product and firm elasticities
(σgU , σgF ) across sectors and the single estimated elasticity of substitution across sectors (σ G ). The estimated
product and firm elasticities are significantly larger than one statistically and always below eleven. We find a
median estimated elasticity across products (σgU ) of 6.29, a median elasticity across firms (σgF ) of 2.66, and an
elasticity across sectors (σ G ) of 1.36. These results imply that products within firms, firms within sectors and
sectors are imperfect substitutes for one another, which has important implications for the measurement of
comparative advantage below, because observed product prices are no longer sufficient statistics for the cost
of sourcing goods across countries and sectors.
Although we do not impose this restriction on the estimation, we find a natural ordering, in which varieties are more substitutable within firms than across firms, and firms are more substitutable within industries
than across industries: σ̂gU > σ̂gF > σ̂ G . We find that the product elasticity is significantly larger than the firm
elasticity at the 5 percent level of significance for all sectors, and the firm elasticity is significantly larger than
the sector elasticity at this significance level for all sectors as well.15 Therefore, the data reject the special
grounds and “recommend alternatives to conventional price indexes that make use of unit values.”
14 For example, see Bernard, Jensen and Schott (2009) and Bernard, Jensen, Redding and Schott (2009) for the U.S.; Mayer, Melitz
and Ottaviano (2014) for France; and Manova and Zhang (2012) for China.
15 In Figure A.5.1 in Section A.5.1 of the web appendix, we show the bootstrap confidence intervals for each sector.

23

cases in which consumers only care about firm varieties (σgU = σgF = σ G ), in which varieties are perfectly
substitutable within sectors (σgU = σgF = ∞), and in which products are equally differentiated within and
across firms for a given sector (σgU = σgF ). Instead, we find evidence of both firm differentiation within sectors
and product differentiation within firms.
Percentile

Min
5th
25th
50th
75th
95th
Max

Elasticity
Across
Products (σgU )
5.14
5.43
5.85
6.29
6.99
8.36
10.59

Elasticity
Across
Firms (σgF )
1.97
2.06
2.36
2.66
3.41
4.83
7.66

Elasticity
Across
Sectors (σ G )
1.36
1.36
1.36
1.36
1.36
1.36
1.36

Product-Firm
Difference
(σgU − σgF )
1.51
2.42
3.13
3.48
3.94
4.77
5.51

Firm-Sector
Difference
(σgF − σ G )
0.60
0.69
1.00
1.30
2.04
3.47
6.30

Note: Estimated elasticities of substitution from the reverse-weighting estimator discussed in section 3 and in section A.3 of the web
appendix. Sectors are 4-digit North American Industrial Classification (NAICS) codes; firms are foreign exporting firms within each
foreign country within each sector; and products are 10-digit Harmonized System (HS) codes within foreign exporting firms within
sectors.

Table 1: Estimated Elasticities of Substitution, Within Firms (σgU ), Across Firms (σgF ) and Across Sectors (σ G )
(U.S. Data)
Our estimated elasticities of substitution are broadly consistent with those of other studies that have used
similar data but different methodologies and/or nesting structures. In line with Broda and Weinstein (2006),
we find lower elasticities of substitution as one moves to higher levels of aggregation. Our estimates of
the product and firm elasticities (σgF and σgU ) are only slightly smaller than those estimated by Hottman et al.
(2016) using different data (U.S. barcodes versus internationally-traded HS products) and a different estimation
methodology based on Feenstra (1994).16 Therefore, our estimated elasticities do not differ substantially from
those obtained using other standard methodologies. As a check on the sensitivity of our estimated elasticities
to the definition of categories, we re-estimated the product, firm, and sector elasticities using 6-digit instead
of 4-digit NAICS codes as our definition of sectors. We find a similar pattern of results, with a median product
elasticity of 6.20, a median firm elasticity of 2.70, and a sector elasticity of 1.47. As a check on the sensitivity
of our results for comparative advantage to these estimated elasticities, report the results of a grid search over
a range of alternative values for these elasticities in Section 5.3 below.

5.2

Exporter Price Indexes Across Sectors and Countries

F
G
We use these estimated elasticities (σgU , σgF , σ G ) to recover the structural residuals (ϕU
ut , ϕ f t , ϕ jgt ) and solve for

the exporter price indexes (PEjigt ) that summarize the cost of sourcing goods from each exporter and sector.
A key implication of our framework is that these exporter price indexes depend not only on conventional
average price terms, but also on the non-conventional forces of average demand/quality, variety and the
16 Our

median estimates for the elasticities of substitution within and across firms of 6.3 and 2.7 respectively compare with those
of 6.9 and 3.9 respectively in Hottman et al. (2016).

24

dispersion of demand-adjusted prices. We now quantify the relative importance of each of these components
in our data.
In the four panels of Figure 1, we display a bin scatter of the log of the exporter price index (ln PEjigt ) and


U
each of its components against average log product prices (EFU
jigt ln Put ), where the bins are twenty quantiles
of each variable.17 In each panel, we also show the regression relationship between the two variables based
on the disaggregated (i.e., not binned) data. For brevity, we show results for the final year of our sample
in 2011, but find the same pattern for other years in our sample. In the top-left panel, we compare the log


U
exporter price index (ln PEjigt ) to average log product prices (EFU
jigt ln Put ). In the special case in which
firms and products are perfect substitutes within sectors (σgU = σgF = ∞) and there are no differences in
F for all f , m and ϕU = ϕU for all u, `), these two variables would be perfectly
demand/quality (ϕ Fft = ϕmt
ut
`t

correlated. In contrast to these predictions, we find a positive but imperfect relationship, with an estimated
regression slope of 0.59 and R2 of 0.23. Therefore, the true cost of sourcing goods across countries and sectors
can differ substantially from standard empirical measures of average prices.

1
0
−2

−1

Average Log Demand

6
4
2

−3

0

Log Exporter−Sector Price Index

2

Average Demand Versus Average Prices

8

Price Index Versus Average Prices

0

2

4

6

8

10

0

2

Average Log Prices

4

6

8

10

8

10

Average Log Prices

Note: Slope coefficient: 0.5901; standard error: 0.0135; R−squared: 0.2342.

Note: Slope coefficient: 0.4055; standard error: 0.0105; R−squared: 0.2838.

Dispersion Versus Average Prices

−.8

.5

−1.2

−1

Dispersion Contribution

1.5
1

Variety Contribution

−.6

2

−.4

Variety Versus Average Prices

0

2

4

6

8

10

0

Average Log Prices

2

4

6

Average Log Prices

Note: Slope coefficient: 0.0064; standard error: 0.0064; R−squared: 0.0001.

Note: Slope coefficient: 0.0020; standard error: 0.0039; R−squared: 0.0000.

Figure 1: U.S. Exporter-Sector Price Indexes and their Components Versus Average Log Product Prices, 2011
In the remaining panels of Figure 1, we explore the three sources of differences between the exporter
price index and average log product prices. As shown in the top-right panel, exporter sectors with high
average prices (horizontal axis) also have high average demand/quality (vertical axis), so that the impact of
higher average prices in raising sourcing costs is partially offset by higher average demand/quality. This
17 We

use a bin scatter, because U.S. Census disclosure requirements preclude showing results for each exporter-sector using the
U.S. data. In Section A.6.2 of the web appendix, we show results by exporter-sector using publicly-available Chilean data.

25

positive relationship between average prices and demand/quality is strong and statistically significant, with
an estimated regression slope of 0.41 and R2 of 0.28. This finding of higher average demand for products
with higher average prices is consistent with the quality interpretation of demand stressed in Schott (2004),
in which producing higher quality incurs higher production costs.18
In measuring demand/quality as a residual that shifts expenditure shares conditional on price, we follow
a long line of research in trade and industrial organization. This approach is similar to that taken to measure
productivity in the growth literature, in which total factor productivity is a residual that shifts output conditional on inputs. The substantial variation in firm exports conditional on price is the underlying feature of
the data that drives our finding of an important role for demand/quality in Figure 1. For plausible values of
the elasticity of substitution, the model cannot explain this sales variation by price variation, and hence it is
attributed to demand/quality. This result implies that the large class of trade models based on CES demand
requires heterogenous demand/quality and cost shifts in order to rationalize the data.
In the bottom-left panel of Figure 1, we show that the contribution from the number of varieties to the
exporter-sector price index exhibits an inverse U-shape, at first increasing with average prices, before later
decreasing. This contribution ranges by more than two log points, confirming the empirical relevance of
consumer love of variety. In contrast, in the bottom-right panel of Figure 1, we show that the contribution
from the dispersion of demand-adjusted prices displays the opposite pattern of a U-shape, at first decreasing with average prices before later increasing. While the extent of variation is smaller than for the variety
contribution, this term still fluctuates by around half a log point between its minimum and maximum value.
Therefore, the imperfect substitutability of firms and products implies important contributions from the number of varieties and the dispersion in the characteristics of those varieties towards the true cost of sourcing
goods across countries and sectors.
These non-conventional determinants are not only important in the cross-section but are also important
for changes in the cost of sourcing goods over time. A common empirical question in macroeconomics and
international trade is the effect of price shocks in a given sector and country on prices and real economic
variables in other countries. However, it is not uncommon to find that measured changes in prices often
appear to have relatively small effects on real economic variables, which has stimulated research on “elasticity
puzzles” and the “exchange-rate disconnect.” Although duality provides a precise mapping between prices
and quantities, the actual price indexes used by researchers often differ in important ways from the formulas
for price indexes from theories of consumer behavior. For example, as we noted earlier, our average price
term is the log of the “Jevons Index,” which is used by the U.S. Bureau of Labor Statistics (BLS) as part of its
calculation of the consumer price index. Except in special cases, however, this average price term will not
equal the theoretically-correct measure of the change in the unit expenditure function.
We first demonstrate the importance of this point for aggregate prices. In Table 2, we decompose the log
change in the U.S. aggregate cost of living from 1998-11 using equations (26) and (27). In the first column,
we find that the aggregate U.S. price index increased by 0.22 log points over this time period. In the second
18 This close relationship between demand/quality and prices is consistent the findings of a number of studies, including the
analysis of U.S. barcode data in Hottman et al. (2016) and the results for Chinese footwear producers in Roberts et al. (2011).

26

US Aggregate Price Growth 1998-2011
Aggregate
Aggregate Terms With Import Terms
Aggregate Price
0.22
Import Prices
0.12
Domestic Competitiveness
0.30
0.30
Non-Tradable Competitiveness
-0.19
-0.19
Sector Dispersion
0.00
0.00
Average Prices
0.39
Product Variety
-0.01
Product Dispersion
0.00
Firm Demand
-0.02
Firm Variety
-0.16
Firm Dispersion
-0.05
Country-Sector Variety
0.00
Country-Sector Dispersion
-0.03
Table 2: U.S. Aggregate Price Growth 1998-2011
column, we decompose this price change into four elements. First, the import price index rose by 0.12 log
units which accounted for a little over half of the aggregate movement. Second, the value of imports rose
as a share of tradables despite the rise in import prices, which implies that the exact price index of domestic
tradables must have risen even more. This change in domestic competitiveness resulted in an increase in the
price index by of an additional 0.3 log units. Offsetting this increase was a decline in the share of tradables in
the US economy, which implies a relative decline in non-tradable prices that equaled a 0.19 log-unit decline
in the U.S. aggregate price index. Finally, there was a negligible contribution from the dispersion of demandadjusted prices across sectors. Thus, our decomposition enables us to capture not only the impact of import
prices on aggregate prices, but also the impact of relative movements in the price indexes of domestic tradables
and non-tradables.
Interestingly, the 0.12 log-point increase in aggregate import prices is much less than the 0.41 log point
change in import prices between 1998 and 2011 reported in the BLS’s U.S. Import Price Index for All Commodities. We can see the reason for the difference in the third column which expands our theoretical measure of
the import price index into its components. The average log-price change, which equals the log of the Jevons
index (the first term in equation (27)) rose by 0.39 log points over this time period: remarkably close to the
0.41 log point change reported in official series. In other words, one obtains a very similar measure of import
price increases regardless of whether one uses averages of log unit values or the price quotes used by the BLS
in its Import Price Index. As we have been emphasizing, however, this index does not capture many of the
other forces that matter for cost-of-living changes in more sophisticated models of consumer behavior. In
particular, we find that the positive contribution from higher average prices of imported goods was offset by
a substantial negative contribution from firm variety (see equation (27) for the definition of each term). This
expansion in firm import variety reduced the cost of imported goods by around 0.16 log points. Changes in
average firm demand and the dispersion of demand-adjusted prices across firms also acted to reduce aggre27

gate import prices over this period. As a result, the true increase in the cost of imported goods from 1998-2011
was only 0.12 log points, less than one third the value implied by the conventional Jevons Index. In other
words, a theory-based measure of aggregate import prices behaves very differently from one based only on
average prices.
We next show that this point applies not only to aggregate import prices but also to the changes in exporter
price indexes (∆ ln PEjigt ) that summarize the cost of sourcing goods across countries and sectors. Figure 2
displays the same information as in Figure 1, but for log changes from 1998-2011 rather than for log levels
in 2011. In changes, the correlation between average prices and the true model-based measure of the cost
of sourcing goods is much weaker (top-left panel) and the role for demand/quality is even greater (top-right
panel). Indeed, the slope for the regression of average log changes in demand/quality on average log changes
in prices is 0.92, indicating that most price changes are almost completely offset by demand/quality changes.
This result suggests that the standard assumption of no shifts in demand/quality, which underlies standard
price indexes such as the Sato-Vartia, is problematic. Price and demand/quality shifts are highly correlated.

2
0
−4

−2

Average Log Changes in Demand

3
1
−1
−3
−5

Log Changes in Exporter−Sector Price Index

4

Average Demand Versus Average Prices

5

Price Index Versus Average Prices

−4

−2

0

2

4

−4

−2

0

Average Log Changes in Prices

4

Note: Slope coefficient: 0.9194; standard error: 0.0125; R−squared: 0.7299.

3
1
−1
−3
−5

−5

−3

−1

1

3

Changes in Dispersion Contribution

5

Dispersion Versus Average Prices

5

Variety Versus Average Prices

Changes in Variety Contribution

2

Average Log Changes in Prices

Note: Slope coefficient: 0.0849; standard error: 0.0169; R−squared: 0.0087.

−4

−2

0

2

4

−4

Average Log Changes in Prices

−2

0

2

4

Average Log Changes in Prices

Note: Slope coefficient: −0.0024; standard error: 0.0052; R−squared: 0.0000.

Note: Slope coefficient: 0.0021; standard error: 0.0056; R−squared: 0.0000.

Figure 2: Log Changes in U.S. Sector-Exporter Price Indexes and their Components Versus Average Log
Changes in Product Prices, 1998-2011

5.3

Trade Patterns

We now use our results connecting RCA to relative exporter price indexes to examine the importance of the
different components of these price indexes for comparative advantage across countries and sectors. We start
with the decompositions of the level and change of RCA in equations (23) and (24) in Section 2.10.1 above.
28

We use a variance decomposition introduced into the international trade literature by Eaton, Kortum and
Kramarz (2004). We assess the contribution of each mechanism by regressing each component of RCA on the
overall value of RCA. Therefore, for the level of RCA in equation (23), we have:


ln RCA Pjigt


ϕ
ln RCA jigt


ln RCASjigt


ln RCA N
jigt


= α P + β P ln RCA jigt + u Pjigt ,

ϕ
= α ϕ + β ϕ ln RCA jigt + u jigt ,

= αS + β S ln RCA jigt + uSjigt ,

= α N + β N ln RCA jigt + u N
jigt .

(31)

where observations are exporters i and sectors g for a given importer j and year t. By the properties of OLS,
β P + β ϕ + β S + β N = 1, and the relative value of each coefficient tells us the relative importance of each
component of exporter price indexes. Similarly, we regress the log change in each component in equation
(24) on the overall log change in RCA.
In Table 3, we report the results of these decompositions for both levels of RCA (Columns (1)-(2)) and
changes of RCA (Columns (3)-(4)). In Columns (1) and (3), we undertake these decompositions down to the
firm level. In Columns (2) and (4), we undertake them all the way down to the product level. For brevity,
we concentrate on the results of the full decomposition in Columns (2) and (4). We find that average prices
are comparatively unimportant in explaining patterns of trade. In the cross-section, average product prices
account for 6.5 percent of the variation in RCA. In the time-series, we find that higher average prices are
more than offset by higher demand/quality, resulting in a negative contribution of 4.8 percent from prices to
changes in RCA. These results reflect the low correlations between average prices and exporter price indexes
seen in the last section. If average prices are weakly correlated with exporter price indexes, they are unlikely
to matter much for RCA, because RCA is determined by relative exporter price indexes.
One potential explanation for the relative unimportance of average prices in explaining trade patterns
arises in the neoclassical Heckscher-Ohlin model. In an international trade equilibrium characterized by
factor price equalization, relative goods prices are the same across all countries, and patterns of trade across
countries and sectors are entirely explained by relative factor endowments. However, we find substantial
differences in average prices across countries within sectors. Conditional on observing these price differences,
the demand-side of our model implies that patterns of trade must be explained by some combination of average
prices, average demand, the dispersion of demand-adjusted prices, and variety. Of these four components of
exporter price indexes, we find that average prices are the least important.
By contrast, we find that average demand/quality is over three times more important than average prices,
with a contribution of 22 percent for levels of RCA and 42 percent for changes in RCA in Table 3. This
empirical finding for the relative importance of these two terms for patterns of trade is the reverse of the
relative amount of attention devoted to them in existing theoretical research. In principle, one could reinterpret the predictions of neoclassical trade models as predictions for relative prices after adjusting for demand/quality. However, we find marked differences in these average demand/quality-adjusted prices across
countries within sectors, implying substantial departures from goods price equalization even after making
29

Firm Price Index
Firm Demand
Firm Variety
Firm Dispersion
Product Prices
Product Variety
Product Dispersion

Log Level RCA 2011
Firm-Level
Product-Level
Decomposition
Decomposition
0.094
0.220
0.220
0.324
0.324
0.362
0.362
0.065
0.014
0.014

Log Change RCA 1998-11
Firm-Level
Product-Level
Decomposition
Decomposition
-0.005
0.422
0.422
0.501
0.501
0.082
0.082
-0.048
0.037
0.007

Note: Variance decomposition for the log level of RCA in 2011 and the log change in RCA from 1998-2011 (from equation (31)).

Table 3: Variance Decomposition U.S. RCA
these adjustments. What sustains these differences in adjusted prices in the model is the imperfect substitutability of firms and products within sectors, which implies that both the number of varieties and the
dispersion of demand-adjusted prices also matter for patterns of trade. Finally, it is not obvious that the determinants of quality/demand are the same as those of prices, with, for example, a large literature in industrial
organization emphasizing the importance of sunk costs for quality (e.g. Sutton 1991).
By far the most important of the different mechanisms for trade in Table 3 is firm variety, which accounts
for 32 and 50 percent of the level and change of RCA respectively. We also find a substantial contribution
from the dispersion of demand-adjusted prices across firms, particularly in the cross-section, where this term
accounts for 36 percent of the variation in RCA. In the time-series, this firm dispersion term is relatively less
important, though it still accounts for 8 percent of the variation in RCA. On the one hand, our findings for
firm variety are consistent with research that emphasizes the role of the extensive margin in understanding
patterns of trade (e.g. Hummels and Klenow 2005, Chaney 2008). On the other hand, our findings for the
dispersion of demand-adjusted prices across common varieties imply that the intensive margin is also important (consistent with the analysis for a log normal distribution in Fernandes et al. 2015). In particular, we
find quantitatively relevant differences in the second moment of the distribution of demand-adjusted prices
across common products and firms within exporters and sectors.
More broadly, this pattern of empirical results is consistent with theoretical frameworks in which comparative advantage operates not only through prices but also through the mass of firms and the distributions of
productivity and demand across firms, such as Bernard, Redding, and Schott (2007). While recent empirical
studies have documented substantial churning in patterns of comparative advantage over time, as in Freund and Pierola (2015) and Hanson, Lind and Muendler (2016), our findings imply that this churning largely
occurs through changes in average demand/quality and firm entry/exit. The dominance of these two components of changes in average demand/quality and firm entry/exit points towards the relevance of theoretical
frameworks in which comparative advantage arises from endogenous investments in product and process
innovation, as in Grossman and Helpman (1991).
We find that our results for comparative advantage are robust across a number of different specifications.
30

1

1.5

Log Change in Country Share of US Imports 1998-11

.5

------------

-.5

0

----------------------------------

-1

------------

Canada

China

Germany

Japan

Mexico

Average Prices

Firm Demand

Product Dispersion

Firm Dispersion

Product Variety

Firm Variety

Country-Sector Variety

Country-Sector Scale

Country-Sector Concentration

Figure 3: Country Aggregate Shares of U.S. Imports
As a check on the sensitivity of our findings to the definition of categories, we replicated our entire analysis
using a definition of sectors based of 6-digit instead of 4-digit NAICS codes. Using this different definition,
we find a similar pattern of results as in our baseline specification, with average demand/quality accounting
for 23 and 46 percent of the level and change of RCA, and firm variety making up 34 and 47 percent. As a
further robustness check, we undertook a grid search over the range of plausible values for the elasticities of
substitution across firms and products. In particular, we consider values of σgF from 2 to 8 (in 0.5 increments)
and values of σgU from (σgF + 0.5) to 20 in 0.5 increments, while holding σ G constant at our estimated value,
which respects our estimated ranking that σgU > σgF > σ G . As shown in Section A.5.3 of the web appendix,
the contributions from firm variety and the dispersion of demand-adjusted prices across firms are invariant
across these parameter values, because the elasticities of substitution cancel from these two terms. In contrast, the contributions from average prices and average demand/quality are increasing and decreasing in σgF
respectively. Nevertheless, across the grid of parameter values, we find that average prices account for less
than 25 percent of the level of the RCA and less than 10 percent of the changes in RCA. Therefore, our finding
that the relative price indexes that determine comparative advantage depart substantially from average prices
is robust across the range of plausible elasticities of substitution.
We now show that the non-conventional forces of variety, average demand/quality, and the dispersion of
demand-adjusted prices are also important for understanding aggregate U.S. imports from its largest suppliers. In Figure 3, we show the time-series decompositions of aggregate import shares from equation (25) for
the top-five trade partners of the United States. We find that most of the increase in China’s market share

31

over the sample period occurs through increases in the number of firm varieties (orange), average firm demand/quality (dark gray) and the dispersion of demand-adjusted prices across firm varieties (light blue).19 In
contrast, average product prices (green) increased more rapidly for China than for the other countries in our
sample, which worked to reduce China’s market share. Therefore, the reasons for the explosive growth of
Chinese exports were not cheaper Chinese exports, but rather substantial firm entry (variety), demand/quality
upgrading, and improvements in the performance of leading firms relative to lagging firms (the dispersion of
demand-adjusted prices). For Canada, we find that firm exit (orange) makes the largest contribution to the
decline in its import share. For Germany, Japan and Mexico, we find substantial contributions from average
firm demand/quality (gray) and the dispersion of demand-adjusted prices across firms (light blue), which are
large relative to the contributions from average prices. Therefore, consistent with our results for sectoral
patterns of trade above, we find that most of the change in aggregate import shares is explained by forces
other than standard empirical measures of average prices.
Taken together, the results of this section highlight the role of imperfect substitutability across firms and
products for comparative advantage and the aggregate volume of trade. Both are determined by relative
price indexes that summarize the cost of sourcing goods from each country and sector. In a world in which
goods are imperfect substitutes, these relative price indexes cannot be inferred solely from conventional
measures of average prices. Instead, they also depend on the non-conventional forces of the number of
varieties, demand/quality upgrading, and the performance of leading relative lagging varieties. Empirically,
we find that these non-conventional forces are the dominant ones at work in the data.

5.4

Additional Theoretical Restrictions

We now compare our approach, which exactly rationalizes both micro and macro trade data, with special
cases of this approach that impose additional theoretical restrictions. As a result of these additional theoretical restrictions, these special cases no longer exactly rationalize the micro trade data, and we quantify the
implications of these departures from the micro data for macro trade patterns and prices.
Almost all existing theoretical research with CES demand in international trade is encompassed by the
Sato-Vartia price index, which assumes no shifts in demand/quality for common varieties. Duality suggests
that there are two ways to assess the importance of this assumption. First, we can work with a price index
and examine how a CES price index that allows for demand shifts (i.e., the UPI in equation (16)) differs from
a CES price index that does not allow for demand shifts (i.e., the Sato-Vartia index). Since the common goods
component of the UPI (CG-UPI) and the Sato-Vartia indexes are identical in the absence of demand shifts,
the difference between the two is a metric for how important demand shifts are empirically. Second, we
can substitute each of these price indexes into equation (22) for revealed comparative advantage (RCA), and
examine how important the assumption of no demand shifts is for understanding patterns of trade. Since
the UPI perfectly rationalizes the data, any deviation from the data arising from using a different price index
must reflect the effect of the restrictive assumption used in the index’s derivation. In order to make the
19 Our finding of an important role for firm entry for China is consistent with the results for export prices in Amiti, Dai, Feenstra,
and Romalis (2016). However, their price index is based on the Sato-Vartia formula, which abstracts from changes in demand/quality
for surviving varieties, and they focus on Chinese export prices rather on than trade patterns.

32

comparison fair, we need to also adjust the Sato-Vartia index for variety changes, which we do by using the
Feenstra (1994) index, which is based on the same no-demand-shifts assumption for common goods, but adds
the variety correction term given in equation (16) to incorporate entry and exit.
In Figure 4, we report the results of these comparisons. The top two panels consider exporter price
indexes, while the bottom two panels examine RCA. In the top-left panel, we show a bin scatter of the SatoVartia exporter price index (on the vertical axis) against the common goods exporter price index (the CG-UPI
on the horizontal axis), where the bins are twenty quantiles of each variable.20 We also show the regression
relationship between the two variables based on the disaggregated (i.e. not binned) data. If the assumption
of time-invariant demand/quality were satisfied in the data, these two indexes would be perfectly correlated
with one another and aligned on the 45-degree line. However, we find little relationship between them. The
reason is immediately apparent if one recalls the top-right panel of Figure 2, which shows that price shifts are
strongly positively correlated with demand shifts. The Sato-Vartia price index fails to take into account that
higher prices are typically offset by higher demand/quality. In the top-right panel, we compare the Feenstra
exporter price index (on the vertical axis) with our overall exporter price index (the UPI on the horizontal axis).
These two price indexes have exactly the same variety correction term, but use different common goods price
indexes (the CG-UPI and Sato-Vartia indexes respectively). The importance of the variety correction term
as a share of the overall exporter price index accounts for the improvement in the fit of the relationship.
However, the slope of the regression line is only around 0.5, and the regression R2 is about 0.1. Therefore,
the assumption of no shifts in demand/quality for existing goods results in substantial deviations between
the true and measured costs of sourcing goods from an exporter and sector.
In the bottom left panel, we compare predicted changes in RCA based on relative exporter Sato-Vartia
price indexes (on the vertical axis) against actual changes in RCA (on the horizontal axis). As the SatoVartia price index has only a weak correlation with the UPI, we find that it has little predictive power for
changes in RCA, which are equal to relative changes in the UPI across exporters and sectors. Hence, observed
changes in trade patterns are almost uncorrelated with the changes predicted under the assumption of no
shifts in demand/quality and no entry/exit of firms and products. In the bottom right panel, we compare
actual changes in RCA (on the horizontal axis) against predicted changes in RCA based on relative exporter
Feenstra price indexes (on the vertical axis). The improvement in the fit of the relationship attests to the
importance of adjusting for entry and exit. However, again the slope of the regression line is only around
0.5 and the regression R2 is less than 0.1. Therefore, even after adjusting for the shared entry and exit term,
the assumption of no demand shifts for existing goods can generate predictions for changes in trade patterns
that diverge substantially from those observed in the data.
Although the Sato-Vartia price index assumes no shifts in demand/quality for surviving varieties, it does
not impose functional form restrictions on the cross-sectional distributions of prices, demand/quality and expenditure shares. We now examine the implications of imposing additional theoretical restrictions on these
cross-sectional distributions. In particular, an important class of existing trade theories assumes not only
20 Again we use a bin scatter, because U.S. Census disclosure requirements preclude showing results for each exporter-sector using
the U.S. data. In Section A.6.4 of the web appendix, we show results by exporter-sector using publicly-available Chilean data.

33

0

1

2

2
1
0
−1

Feenstra Price Index (Log Change)
−1

−2

3
2
1
0
−1

Sato−Vartia (Log Change)

−2
−2

3

−2

CG−UPI (Log Change)

2

2

4

4
2
0
−2

Predicted Change in RCA (Feenstra)
0

−4

4
2
0
−2

Predicted Change in RCA (Sato−Vartia)

1

Note: Slope: 0.5462; SE: 0.0387; R : 0.1270.

−4

−2

0
2

Note: Slope: −0.0033; SE: 0.0252; R : 0.0000.

−4

−1

Unified Price Index (Log Change)

2

−4

Log Change in RCA

−2

0

2

4

Log Change in RCA

2

2

Note: Slope: −0.0539; SE: 0.0334; R : 0.0017.

Note: Slope: 0.4904; SE: 0.0447; R : 0.0724.

45 degree line

Fitted values

Figure 4: Sector-exporter Price Indexes with Time-Invariant Demand/Quality (Vertical Axis) Versus TimeVarying Demand/Quality (Horizontal Axis) for the U.S.
a constant demand-side elasticity but also a constant supply-side elasticity, as reflected in the assumption
of Fréchet or Pareto productivity distributions.21 As our approach uses only demand-side assumptions, we
can examine the extent to which these additional supply-side restrictions are satisfied in the data. In particular, we compare the observed data for firm sales and our model solutions for the firm price index and
n
o
firm demand/quality (ln VfFt ∈ ln XFft , ln PfFt , ln ϕ Fft ) with their theoretical predictions under alternative
supply-side distributional assumptions.
To derive these theoretical predictions, we use the QQ estimator of Kratz and Resnick (1996), as introduced
into the international trade literature by Head, Mayer and Thoenig (2016). This QQ estimator compares the
empirical quantiles in the data with the theoretical quantiles implied by alternative distributional assumptions.
As shown in Section A.5.4 of the web appendix, under the assumption that VfFt has an untruncated Pareto
distribution, we obtain the following theoretical prediction for the quantile of the logarithm of that variable:
 
h
 i
1
ln VfFt = ln V Fjigt − V ln 1 − F jigt VfFt ,
(32)
ag
21 A

special case of our theoretical framework falls within this class of trade theories, as characterized in Arkolakis, Costinot
and Rodriguez-Clare (2012), under the following additional supply-side restrictions: (i) Each industry consists of a continuum of
firms and a continuum of products; (ii) Monopolistic competition; (iii) A single factor of production (labor); (iv) Balanced trade; (iii)
Constant variable costs; (iv) Firm productivity is Pareto distributed; (v) Firm-product productivity is Pareto distributed; (vi) Firm
demand/quality is a power function of firm productivity; (vii) Firm-product demand/quality is a power function of firm-product
productivity. Together these assumptions ensure that firm sales (X Fft ), the firm price index (PfFt ), and firm demand/quality (ϕ Fft ) are
all Pareto distributed, as shown for the case of a single sector in Bernard, Redding and Schott (2011).

34

where F jigt (·) is the cumulative distribution function; ln V Fjigt is the lower limit of the support of the untruncated Pareto distribution, which is a constant across firms f for a given importer j, exporter i, sector g and
year t; aV
across sectors g.
g is the shape parameter of this distribution, which we allow to vary
 
F
We estimate equation (32) by OLS using the empirical quantile for ln Vf t on the left-hand side and the
 
empirical estimate of the cumulative distribution function for F jigt VfFt on the right-hand side, as discussed
further in the web appendix. We estimate this regression for each sector across foreign firms (allowing the
slope coefficient aV
g to vary across sectors) and including fixed effects for each exporter-year-sector combination (allowing the intercept ln V Fjigt to vary across exporters, sectors and time). The fitted values from this
regression correspond to the predicted theoretical quantiles, which we compare to the empirical quantiles
observed in the data. Under the null hypothesis of a Pareto distribution, there should be a linear relationship
between the theoretical and empirical quantiles that coincides with the 45-degree line.
To assess the empirical validity of this theoretical prediction, we estimate equation (32) for two separate
subsamples: firms with values below the median for each exporter-sector-year cell and firms with values
above the median for each exporter-sector-year cell. Under the null hypothesis of a Pareto distribution, the
22 As shown in
estimated slope coefficient 1/aV
g should be the same for firms below and above the median.

Section A.5.4 of the web appendix, we strongly reject this null hypothesis of a Pareto distribution for all three
variables, with substantial differences in the estimated coefficients below and above the median, which are
statistically significant at conventional levels.23
To provide a point of comparison, we also consider the log-normal distributional assumption. As shown
in Section A.5.4 of the web appendix, we obtain the following theoretical prediction for the quantile of the
logarithm of a variable VfFt under this distributional assumption:
 

 
V −1
ln VfFt = κ V
Φ
+
χ
F
VfFt .
jigt
g
jigt

(33)

V
where Φ−1 (·) is the inverse of the normal cumulative distribution function; κ V
jigt and χ g are the mean and


 
 2
standard deviation of the log variable, such that ln VfFt ∼ N κ V
,
χV
; we make analogous assumpg
jigt

tions about these two parameters as for the untruncated Pareto distribution above; we allow the parameter
controlling the mean (κ V
jigt ) to vary across exporters i, sectors g and time t for a given importer j; we allow
the parameter controlling dispersion (χV
g ) to vary across sectors g.
 
Again we estimate equation (33) by OLS using the empirical quantile for ln VfFt on the left-hand side
 
and the empirical estimate of the cumulative distribution function for F jigt VfFt on the right-hand side.
We estimate this regression for each sector across foreign firms (allowing the slope coefficient χV
g to vary
across sectors) and including fixed effects for each exporter-year-sector combination (allowing the intercept
κV
jigt to vary across exporters, sectors and time). As shown in Section A.5.4 of the web appendix, we find
that the log-normal distributional assumption provides a closer approximation to the data than the Pareto
22 U.S.

Census disclosure requirements preclude showing the quantiles for individual foreign firms using the U.S. data. In Figures
A.6.7 and A.6.8 in Section A.6.4 of the web appendix, we show firm quantiles using publicly-available Chilean data.
23 A similar analysis can be undertaken for a Fréchet distribution. We find a similar pattern of statistically significant departures
from the predicted linear relationship between the theoretical and empirical quantiles under this distributional assumption.

35

distributional assumption. Consistent with Bas, Mayer and Thoenig (2017), we find smaller departures from
the predicted linear relationship between the theoretical and empirical quantiles for a log-normal distribution
than for a Pareto distribution. Nevertheless, we reject the null hypothesis of a log-normal distribution at conventional significance levels for all three variables for the majority of industries, with substantial differences
in estimated coefficients above and below the median. Instead of imposing such supply-side distributional
assumptions, our demand-side approach uses the observed empirical distributions of prices and expenditure
shares, and the resulting implied distribution of demand/quality under our assumption of CES demand.
As a concluding point, we examine the implications of these departures from a Pareto and log-normal
distributions for understanding trade patterns across countries and sectors. Here, we demonstrate a surprising result. If one rationalizes the data using the unified price index, distributional assumptions about the
underlying parameters do not matter, as long as these distributions are centered on the correct mean of the
logs of each variable. To see this, we take the mean of the predicted values for log firm import shares, log
firm-price indexes and log firm-demand/quality, and use our estimated elasticities of substitution to construct
the predicted log common-goods unified price index for each exporter and sector:
h
i
h
i
\
[
[
ln
PEjigt = EFjigt ln
PfFt − EFjigt ln
ϕ Fft +

h
i
1
F
\
EF ,
E
ln
S
ft
σgF − 1 jigt

(34)

F
where a hat above a variable denotes a predicted value (recall that SEF
f t is the share of each firm f ∈ Ω jigt in

county j’s imports from a given exporter i 6= j in sector g at time t).
A notable feature of this equation is that if we remove the hats, we obtain the exporter price index, which
rationalizes revealed comparative advantage exactly. In this case, each of the terms on the right-hand side
correspond the means of the logs of each variable. It follows immediately from this that that any distribution
of the logs of prices, demand/quality parameters, and shares that has the same means as in the data will
produce the correct exporter price index and match RCA. Given our inclusion of exporter-sector-year fixed
effects in equations (32) and (33), both of the estimated distributions are centered on the correct means of the
logs of each variable for each exporter-sector-year. Therefore, these distributional assumptions do not matter
for our conclusions about the sources of variation of RCA, as long as they implemented in such a way as to
preserve the correct means of the logs of each variable for each exporter-sector-year.

6

Conclusions

Existing trade research is largely divided into micro and macro approaches. Macro models rationalize aggregate trade but impose distributional assumptions that can be at odds with the micro data. In contrast, micro
studies examine the properties of disaggregated trade data but lack a clear template for aggregation to the
macro level. We unify these two approaches by developing a framework that rationalizes both micro and
macro trade data, enabling us to aggregate up from the micro level and quantify the importance of different
micro mechanisms for macro variables.
We use our framework to derive price indexes that determine comparative advantage across countries
and sectors and the aggregate cost of living. If firms and products are imperfect substitutes, we show that

36

these price indexes depend on variety, average demand/quality and the dispersion of demand/quality-adjusted
prices, in addition to average prices. As a result, these theoretically-consistent price indexes are only weakly
related to standard empirical measures of average prices, thereby providing insight for elasticity puzzles, in
which real variables respond weakly to these empirical proxies. Of the cross-section (time-series) variation in
comparative advantage, we show that 50 (90) percent is accounted for by variety and average demand/quality,
with average prices contributing less than 10 percent.
As our framework exactly rationalizes the observed trade data at both the disaggregate and aggregate
level, there is an exact mapping between our relative price indexes and observed patterns of trade. However,
the same need not be true for other approaches that impose stronger assumptions, such as the Feenstra price
index, which corresponds to a special case of our framework that assumes no demand shifts for surviving
varieties. Comparing our framework to these special cases, we find that models that assume no demand
shifts and no changes in variety perform poorly on trade data. Models that incorporate variety changes while
maintaining the assumption of no demand shifts do better, but can still only account for a relatively small
proportion of changes in comparative advantage over time.
Finally, we find that standard supply-side distributional assumptions such as Pareto or log-normal productivity distributions are rejected by the data. However, we show that if one rationalizes the data using the
unified price index, distributional assumptions about the underlying parameters do not matter, as long as the
distributions are centered on the correct mean of the logs of prices, demand/quality, and expenditure shares.
As these means and the elasticities of substitution between firms and products are sufficient statistics for the
costs of sourcing goods from each exporter and sector, they are all that matters for patterns of comparative
advantage across countries and sectors and the aggregate cost of living.

References
[1] Adao, Rodrigo, Arnaud Costinot and Dave Donaldson (2017) “Nonparametric Counterfactual Predictions
in Neoclassical Models of International Trade,” American Economic Review, 107(3), 633-689.
[2] Amiti, Mary, Mi Dai, Robert Feenstra, and John Romalis (2016) “How Did China’s WTO Entry Benefit
U.S. Consumers?”, UC Davis, mimeograph.
[3] Amiti, Mary and Donald R. Davis (2009) “What’s Behind Volatile Import Prices from China?,” Current
Issues in Economics and Finance, 15(1), 1-7.
[4] Arkolakis, Costas, Arnaud Costinot and Andres Rodriguez-Clare (2012) “New Trade Models, Same Old
Gains,” American Economic Review, 102(1), 94-130.
[5] Armington, Paul S. (1969) “A Theory of Demand for Products Distinguished by Place of Production,”
International Monetary Fund Staff Papers, 16(1), 159–78.
[6] Atkeson, Andrew, and Ariel Burstein (2008) “Pricing to Market, Trade Costs and International Relative
Prices,” American Economic Review, 98, 1998-2031.
[7] Atkin, David, and Dave Donaldson (2015) “Who’s Getting Globalized? The Size and Implications of
Intra-national Trade Costs,” NBER Working Paper, 21439.

37

[8] Atkin, David, Benjamin Faber and Marco Gonzalez-Navarro (2016) “Retail Globalization and Household
Welfare: Evidence from Mexico,” Journal of Political Economy, forthcoming.
[9] Balassa, Bela (1965) “Trade Liberalization and Revealed Comparative Advantage,” Manchester School of
Economic and Social Studies, 33, 99-123.
[10] Bas, Maria, Thierry Mayer and Mathias Thoenig (2017) “From Micro to Macro: Demand, Supply and
Heterogeneity in the Trade Elasticity,” Journal of International Economics, 108, 1-19.
[11] Bernard, Andrew. B., and J. Bradford Jensen (1995) “Exporters, Jobs, and Wages in US Manufacturing:
1976-87,” Brookings Papers on Economic Activity: Microeconomics, 67-112.
[12] Bernard, Andrew B., J. Bradford Jensen, and Peter K. Schott (2009) “Importers, Exporters and Multinationals: A Portrait of Firms in the U.S. that Trade Goods,” in Producer Dynamics: New Evidence from Micro
Data, ed. by T. Dunne, J. B. Jensen, and M. J. Roberts. Chicago University Press, Chicago.
[13] Bernard, Andrew B., J. Bradford Jensen, Stephen J. Redding, and Peter K. Schott (2007) “Firms in International Trade,” Journal of Economic Perspectives, 21(3), 105-130.
[14] Bernard, Andrew B., J. Bradford Jensen, Stephen J. Redding, and Peter K. Schott (2009) “The Margins of
U.S. Trade,” American Economic Review, Papers and Proceedings, 99(2), 487-493.
[15] Bernard, Andrew B., Stephen J. Redding and Peter K. Schott (2007) “Comparative Advantage and Heterogeneous Firms,” Review of Economic Studies, 74(1), 31-66.
[16] Bernard, Andrew B., Stephen J. Redding and Peter K. Schott (2010) “Multi-product Firms and Product
Switching,” American Economic Review, 100(1), 70– 97.
[17] Bernard, Andrew B., Stephen J. Redding and Peter K. Schott (2011) “Multiproduct Firms and Trade Liberalization,” Quarterly Journal of Economics, 126(3), 1271-1318.
[18] Broda, Christian and David E. Weinstein (2006) “Globalization and the Gains from Variety,” Quarterly
Journal of Economics, 121, 541-86.
[19] Broda, Christian and David E. Weinstein (2010) “Product Creation and Destruction: Evidence and Price
Implications,” American Economic Review, 100, 691-723.
[20] Caliendo, Lorenzo and Fernando Parro (2015) “Estimates of the Trade and Welfare Effects of NAFTA,”
Review of Economic Studies, 82 (1), 1-44.
[21] Chaney, Thomas (2008) “Distorted Gravity: The Intensive and Extensive Margins of International Trade,”
American Economic Review, 98(4), 1707-1721.
[22] Costinot, Arnaud, Dave Donaldson and Ivana Komunjer (2012) “What Goods Do Countries Trade? A
Quantitative Exploration of Ricardo’s Ideas,” Review of Economic Studies, 79, 581-608.
[23] De Loecker, Jan and Penny Goldberg (2014) “Firm Performance in a Global Market,” Annual Review of
Economics, 6, 201-227.
[24] Dhingra, Swati (2013) “Trading Away Wide Brands for Cheap Brands,” American Economic Review, 103(6),
2554-84.
[25] Di Comite, F., Thisse, J., Vandenbussche, H. (2014). “Verti-zontal Differentiation in Export Markets”,
Journal of International Economics, 93, 50-66.

38

[26] Eaton, Jonathan and Samuel S. Kortum (2002) “Technology, Geography, and Trade,” Econometrica, 70(5),
1741-1779.
[27] Eaton, Jonathan, Samuel S. Kortum and Francis Kramarz (2004) “Dissecting Trade: Firms, Industries, and
Export Destinations,” American Economic Review, Papers and Proceedings, 94(2), 150–154.
[28] Eaton, Jonathan, Samuel S. Kortum and Francis Kramarz (2011) “An Anatomy of International Trade:
Evidence from French Firms,” Econometrica, 79(5), 1453–1498.
[29] Eckel, Carsten and J. Peter Neary (2010) “Multi-product Firms and Flexible Manufacturing in the Global
Economy,” Review of Economic Studies, 77, 188-217.
[30] Fally, Thibault and Benjamin Faber (2016) “Firm Heterogeneity in Consumption Baskets: Evidence from
Home and Store Scanner Data,” University of California, Berkeley, mimeograph.
[31] Feenstra, Robert C. (1994) “New Product Varieties and the Measurement of International Prices,” American Economic Review, 84, 157-177.
[32] Feenstra, Robert C. and Hong Ma “Optimal Choice of Product Scope for Multiproduct Firms,” in The
Organization of Firms in a Global Economy, in (eds) Elhanan Helpman, Dalia Marin and Thierry Verdier,
chapter 6, 173-199. Cambridge MA: Harvard University Press.
[33] Feenstra, Robert C. and John Romalis (2014) “International Prices and Endogenous Quality,” Quarterly
Journal of Economics, 129(2), 477-527.
[34] Fernandes, Ana, Peter Klenow, Martha Denisse Pierola, Andres Rodriguez-Clare and Sergii Meleshchuk
(2015) “The Intensive Margin in Trade,” Stanford University, mimeograph.
[35] Foster, Lucia, John Haltiwanger and Chad Syverson (2008) “Reallocation, Firm Turnover, and Efficiency:
Selection on Productivity or Profitability?” American Economic Review, 98(1), 394-425.
[36] Freund, Caroline and Martha Denisse Pierola (2015) “Export Superstars,” Review of Economics and Statistics, 97(5), 1023-32.
[37] Grossman, Gene and Elhanan Helpman (1991) Innovation and Growth in the Global Economy, Cambridge:
MIT Press.
[38] Hallak, Juan Carlos and Peter K. Schott (2011) “Estimating Cross-Country Differences in Product Quality,” Quarterly Journal of Economics, 126, 417-474.
[39] Handbury, Jessie (2013) “Are Poor Cities Cheap for Everyone? Non-Homotheticity and the Cost of Living
Across U.S. Cities,” the Wharton School, University of Pennsylvania.
[40] Hanson, Gordon H., Nelson Lind and Marc-Andreas Muendler (2015) “The Dynamics of Comparative
Advantage,” NBER Working Paper, 21753.
[41] Head, Keith, Thierry Mayer and Mathias Thoenig (2014) “Welfare and Trade Without Pareto,” American
Economic Review, Papers and Proceedings, 104(5), 310-316.
[42] Hottman, Colin, Stephen J. Redding and David E. Weinstein (2016) “Quantifying the Sources of Firm
Heterogeneity,” Quarterly Journal of Economics, 131(3), 1291-1364.
[43] Hsieh, Chang-Tai, Nicholas Li, Ralph Ossa, and Mu-Jeung Yang (2016) “Accounting for the Gains from
Trade Liberalization,” University of Chicago, mimeograph.

39

[44] Hummels, David and Peter J. Klenow (2005) “The Variety and Quality of a Nation’s Exports,” American
Economic Review, 95(3), 704-723.
[45] Kamal, Fariha, C. J. Krizan and Ryan Monarch (2015) “Identifying Foreign Suppliers in U.S. Merchandise
Import Transactions”, Center for Economic Studies Working Paper, 15-11, Bureau of the Census.
[46] Khandelwal, Amit K. (2010) “The Long and Short (of) Quality Ladders,” Review of Economic Studies, 77,
1450-1476.
[47] Kratz, Marie, and Sidney I Resnick (1996) “The QQ-estimator and Heavy Tails,” Stochastic Models, 12(4),
699-724.
[48] Krugman, Paul (1980) “Scale Economies, Product Differentiation, and the Pattern of Trade,” American
Economic Review, 70(5), 950-959.
[49] Levchenko, Andrei A. and Jing Zhang (2016) “The Evolution of Comparative Advantage: Measurement
and Welfare Implications,” Journal of Monetary Economics, 78, 96-111.
[50] Manova, Kalina and Zhiwei Zhang (2012) “Export Prices across Firms and Destinations,” Quarterly Journal of Economics, 127, 379-436.
[51] Mayer, Thierry and Marc Melitz and Gianmarco I. P. Ottaviano (2014) “Market Size, Competition, and
the Product Mix of Exporters,” American Economic Review, 104(2), 495-536.
[52] Melitz, Marc J. (2003) “The Impact of Trade on Intra-Industry Reallocations and Aggregate Industry
Productivity,” Econometrica, 71, 1695-1725.
[53] Melitz, Marc J. and Stephen J. Redding (2014) “Heterogeneous Firms and Trade,” in Handbook of International Economics, ed. by E. Helpman, G. Gopinath, and K. Rogoff, vol. 4, chapter 1, 1-54, Elsevier, North
Holland: Amsterdam.
[54] Nakamura, Alice, W. Erwin Diewert, John S. Greenlees, Leonard I. Nakamura, and Marshall B. Reinsdorf (2015) “Sourcing Substitution and Related Price Index Biases,” in Susan N. Houseman and Michael
Mandel (eds.), Measuring Globalization: Better Trade Statistics for Better Policy, Volume 1, Biases to Price,
Output, and Productivity Statistics from Trade W.E. Upjohn Institute for Employment Research, 21-88.
[55] Redding, Stephen J. and David E. Weinstein (2016) “A Unified Approach to Estimating CES Demand and
Welfare,” NBER Working Paper, 22479.
[56] Roberts, Mark J., Xiaoyan Fan, Daniel Xu and Shengxing Zhang (2011) “A Structural Model of Demand,
Cost, and Export Market Selection for Chinese Footwear Producers,” NBER Working Paper, 17725.
[57] Schott, Peter K. (2004) “Across-product Versus Within-product Specialization in International Trade,”
Quarterly Journal of Economics, 119, 647-678.
[58] Sutton, John (1991) Sunk Costs and Market Structure: Price Competition, Advertising, and the Evolution of
Concentration, Cambridge MA: MIT Press.
[59] Sutton, John and Daniel Trefler (2016) “Capabilities, Wealth, and Trade,” Journal of Political Economy,
124(3), 826-878.

40

