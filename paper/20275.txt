NBER WORKING PAPER SERIES

A MARKET BASED SOLUTION TO PRICE EXTERNALITIES:
A GENERALIZED FRAMEWORK
Weerachart T. Kilenthong
Robert M. Townsend
Working Paper 20275
http://www.nber.org/papers/w20275
NATIONAL BUREAU OF ECONOMIC RESEARCH
1050 Massachusetts Avenue
Cambridge, MA 02138
June 2014

Robert Townsend is grateful to financial support from the Eunice Kennedy Shriver National Institute
of Child Health and Human Development (NICHD) under grant R01 HD027638, NSF, the John Templeton
Foundation, and the Consortium on Financial Systems and Poverty at the University of Chicago through
a grant from the Bill & Melinda Gates Foundation. The findings and conclusions contained in the report
are those of the author(s) and do not necessarily represent the views of the funders. The views expressed
herein are those of the authors and do not necessarily reflect the views of the National Bureau of Economic
Research.
NBER working papers are circulated for discussion and comment purposes. They have not been peerreviewed or been subject to the review by the NBER Board of Directors that accompanies official
NBER publications.
© 2014 by Weerachart T. Kilenthong and Robert M. Townsend. All rights reserved. Short sections
of text, not to exceed two paragraphs, may be quoted without explicit permission provided that full
credit, including © notice, is given to the source.

A Market Based Solution to Price Externalities: A Generalized Framework
Weerachart T. Kilenthong and Robert M. Townsend
NBER Working Paper No. 20275
June 2014
JEL No. D52,D53,D61,D62
ABSTRACT
Pecuniary externalities have regained the interest of researchers as they seek policy interventions and
regulations to remedy externality-induced distortions, e.g., balance sheet effects, amplifiers and fire
sales. In this paper we go back to first principles and show how to design financial contracts and markets
in such a way that ex ante competition can achieve a constrained-efficient allocation. The key as in
general equilibrium theory is to extend the commodity space in such a way that bundling, exclusivity
and additional markets internalize these pecuniary externalities. We devise in this paper a general
wayof proceeding that covers as a general case the large variety of example-economies which differ
fromone another in the particular source of the constraint generating the externality. A key take away
fromour approach is that we do not need to identify and quantify some policy intervention. With the
appropriate ex ante design we can let markets solve the problem.
Weerachart T. Kilenthong
Faculty of Economics, and
Research Institute for Policy Evaluation and Desig
University of the Thai Chamber of Commerce
126/1 Vibhavadee-Rangsit, Dindaeng
Bangkok 10400
Thailand
tee@riped.utcc.ac.th
Robert M. Townsend
Department of Economics, E17-230
MIT
77 Massachusetts Avenue
Cambridge, MA 02139
and NBER
rtownsen@mit.edu

Abstract
Pecuniary externalities have regained the interest of researchers as they seek policy
interventions and regulations to remedy externality-induced distortions, e.g., balance
sheet effects, amplifiers and fire sales. In this paper we go back to first principles and
show how to design financial contracts and markets in such a way that ex ante competition can achieve a constrained-efficient allocation. The key as in general equilibrium
theory is to extend the commodity space in such a way that bundling, exclusivity and
additional markets internalize these pecuniary externalities. We devise in this paper a
general way of proceeding that covers as a general case the large variety of exampleeconomies which differ from one another in the particular source of the constraint generating the externality. A key take away from our approach is that we do not need to
identify and quantify some policy intervention. With the appropriate ex ante design
we can let markets solve the problem.

Keywords: price externalities; segregated exchanges; Walrasian equilibrium; market-based
solution; collateral; exogenous incomplete markets; moral hazard with retrading; hidden
information with retrading; liquidity constraints; fire sales.

1

Introduction

A large variety of economies can suffer from pecuniary externalities and for a variety of
distinct reasons. There is long history of research into this subject, with a solid tradition right
from the beginnings of general equilibrium theory. Lately, and particularly in the aftermath
of the recent financial crisis, models with pecuniary externalities have regained the interest of
researchers as they seek policy interventions and regulations to remedy externality-induced
distortions, e.g., balance sheet effects, amplifiers and fire sales, to name some key words. Here
in this paper we go back to first principles and show how to design financial contracts and
markets in such a way that ex ante competition can achieve a constrained-efficient allocation.
The key as in general equilibrium theory is to extend the commodity space in such a way that
bundling, exclusivity and additional markets internalize pecuniary externalities. We devise
in this paper a general way of proceeding that covers as a general case the large variety of
2

example-economies which differ in the particular in the source of the constraint generating
the externality.
One class of example economies are those in which collateral is used to back promises.
The issuer of a promise in the contract period is required to back the promise with collateral.
In the spot market/trading period the issuer can either honor the promise or default, handing
over the collateral. But the value of collateral is endogenous in the spot market, determined
by the forces of supply and demand at that time. Maximizing agents take prices as given
and do not take into account that their actions in the contract period, the promises they
issue and their savings and collateral, determine ex post spot market prices. That is, there
is a collateral constraint facing the issuers of promises, which has in it those spot market
prices. The problem of haircuts in which collateral backing loans receives deep discounts
when markets seem to suffer from illiquidity has received, rightly, much attention. See, e.g.,
Begalle et al. (2013); Gorton and Metrick (2012); Krishnamurthy et al. (2012). Our own
first paper on collateral-constraint-induced externalities, Kilenthong and Townsend (2014b),
shows how to remedy the problem, in that specific context. This is what got us started along
this more general path.
Likewise, and even simpler in some respects, when security markets are incomplete for
some exogenous reason, i.e. missing an equivalent set of Arrow Debreu securities, the welfare theorems fail and competitive markets do not achieve an ex ante optimal allocation,
even when the comparison of competitive equilibrium allocations to those achievable by a
“planner” limits the planner to the same set of limited securities. Here spot market prices
can move with initial security positions, something the planner can take into account, but in
competitive markets the consequent wealth effects cannot be covered due to missing markets.
See, e.g., Geanakoplos and Polemarchakis (1986). Pareto improving taxation has been proposed as a remedy1 (see, e.g., Geanakoplos and Polemarchakis, 2008; Greenwald and Stiglitz,
1986; Herings and Polemarchakis, 2005).
Our general framework encompasses economies with information problems and retrading
in spot markets. For example in a moral hazard insurance economy the incentive to take
1

We are reminded of Farhi and Werning (2013) though their externalities arises from sticky prices and a

zero bound on interest rates, which are different from our general set up.

3

appropriate action ex ante is induced by vectors of consumption rewards ex post. But
if retrading of goods is allowed, as in ex post spot markets, this can undercut ex ante
incentives. Indeed this is raised as a criticism of the realism of Prescott and Townsend
(1984a,b) who show how to apply the standard welfare theorems to many limited-information
environments but who also do not allow retrading as in more typical dynamic spanning
arguments. However, see Acemoglu and Simsek (2012); Kilenthong and Townsend (2011)
for particular remedies. This again is one of our examples that set us on the general path.
Likewise, the well-known Diamond and Dybvig bank-run environment can, in the norun equilibrium at least, achieve an information-constrained efficient allocation. But this is
undercut when retrading in a bond market is allowed, a point made forcefully in the seminal
work of Jacklin (1987). Farhi et al. (2009) use this environment to argue for portfolio
restrictions in the regulation of financial institutions.
As already mentioned, there is a growing literature on fire sales and amplifiers; where
private agents undervalue net worth in a period of financial distress because they fail to
internalize that net worth has positive spill overs on other agents. Bianchi and Mendoza
(2012) study the relationship of these so-called credit externalities to financial fragility and
welfare losses from balance sheet effects, for example. There is a much larger literature in
the international context, e.g., Caballero and Krishnamurthy (2001); Jeanne and Korinek
(2010). Lorenzoni (2008) is a seminal paper on inefficient credit booms and we feature
that particular environment here. Others propose regulation of international capital flows,
Korinek (2010), and taxation, Jeanne and Korinek (2010).
On the flip side, so to speak, Hart and Zingales (2113) study an economy where markets
for the forward sale of labor are precluded, due to human capital considerations. Ironically,
this leads to excess savings, not over borrowing; savings backs liquidity instruments used in
trade when there are Wicksell absence-of-double-coincidence-of-wants in real goods. They
show how fiscal policy following a large negative shock can increase ex ante welfare.
Again we can cast every one of these environments as an example-economy of a larger,
generalized framework. The key is to be clear -- beyond preferences, endowments, and
technology and beyond ordinary budget constraints -- is that there are extra constraints
typically binding on a subset of agent types which contain market clearing price. These can
4

be ex ante security prices or ex post prices, or both. Indeed the price-containing constraints
when binding are the definition of pecuniary externalities. Examples are, again, collateral
constraints, spot market budget constraint in incomplete markets, retrading entering into
incentives to take ex ante action or announce ex post shocks truthfully, no default conditions,
or the price of liquidity assets used in trade.
With this generalized set-up, we establish that there is a common way to internalize the
externality, by having markets for rights to trade at the culprit equilibrium spot and/or
security prices, bundled with the other traded objects. That is, agents pay a market participation fee, or receive a compensation, depending on the exchange, the targeted price pair,
and rights to trade. An agent who chooses to trade in a security exchange can act as if she
can trade commodities and securities with the specific prices indicated, in effect indexing the
commodity/security trade by the price. Moreover, these are self-fulfilling in that security
exchanges, given the composition of traders attracted to the exchange, are in an equilibrium
fixed point. Importantly, agents are not allowed to trade with agents in other exchanges, that
is, our remedy requires a registration/identification system and an exclusivity assumption;
that is, an agent type can trade exclusively within his exchange but not with agents in other
exchanges. But contemporary financial markets currently already have and utilize technologies which allow this to happen. We elaborate on this in some detail in the conclusion of our
first paper Kilenthong and Townsend (2014b).
To reiterate, we create rights to trade in these security exchanges and in turn these rights
are priced in competitive markets. These rights are the externality-correcting commodities2 .
For example, in the collateral equilibrium model in Kilenthong and Townsend (2014b), this
object is called the type-h discrepancy from the fundamental, that object which determines
2

The rights to trade or the discrepancy from the fundamental is key to our solution concept. To ensure

the consistent execution of each security exchange, the sum of the rights to trade or the discrepancies within
the exchange must, by the definition of consistency, be zero so that the specified price that indexed ex
ante contracts is the one which prevails in equilibrium. This is like a club constraint in other literature, e.g.,
Prescott and Townsend (2006). This solution concept with segregated security exchanges is also related to the
assignment literature (e.g., Koopmans and Beckmann, 1957; Prescott and Townsend, 1984a,b). Mortensen
and Wright (2002) internalizes a search externality using directed search into segregated submarkets that
promise different expected waiting times. See also Guerrieri, Shimer, and Wright (2010).

5

the spot market price, and this discrepancy depends on type h endowments, his choice of
collateral allocation, and the specific target fundamental/price. An alternative example is in
Kilenthong and Townsend (2011), in which the rights to trade are implicitly embedded in the
incentive comparability constraints. More generally, an agent’s required rights to trade can
be defined by excess demand functions for relevant commodities, which are again functions
of his endowments, his choice of trades, and the specific target price.
A key take away from our approach is that we do not need to identify and quantify
some policy intervention. Policy makers may accept the arguments in the literature about
taxation, or portfolio restrictions, for example, and then ask how exactly to implement, i.e.,
what is the order of magnitude of the intervention. In contrast in our approach, we let
markets determine prices for rights to trade, determined in the usual manner. There is no
need for intervention. The outcome will be constrained-efficient (and indeed any constrained
efficient allocation can be achieved with conventional ex ante lump-sum taxes and transfers
that do not impede the operation of markets).
As mentioned at the outset, there are clear antecedents for what we are doing in the
general equilibrium literature. This includes Arrow (1969)’s early suggestion to expand the
commodity space to include the object creating the externality, following Meade (1952)’s
early treatment of externalities3 . The exclusive security exchanges we feature in this paper are founded in the tradition of the geographic assignment problem of Koopmans and
Beckmann (1957), the labor problem of Sattinger (1993), the treatment of the firm as an
endogenous object of McKenzie (1959, 1981), the treatment of firms and plants in general
equilibrium of Hornstein and Prescott (1993), and the treatment of firms as clubs of Prescott
and Townsend (2006).
The remaining of the paper proceeds as follows. Section 2 introduces key ingredients
of the general model and then shows how the ingredients of the main example-economies
map into the generalized framework, including a collateral economy, an exogenous incomplete markets economy, a moral hazard with retrading economy, and a liquidity constrained
economy. For expositional purposes, each key ingredient of the general model is followed by
3

Bisin and Gottardi (2006) use this as well to deal with an adverse selection problem, though that

externalities is different from the pecuniary externality we feature here.

6

its counterpart for each example-economies, and in the text we limit ourselves to these four
to control length. Section 3 presents the competitive equilibrium with obstacles to trade and
constrained optimality and establishes the existence of the externality. To save on space in
the main text, and as its already covered with the notation of the general model, the competitive equilibrium and constrained optimality for each of the four example-economies are
presented in Appendix A. Section 4 formally defines our market-based solution concept, the
competitive equilibrium with segregated exchanges, and shows how to establish the existence
and welfare theorems. The other two example-economies, including a fire sales economy and
a hidden information with retrading economy are presented in entirety in Appendix B.

2

A General Model with Price Externalities and Its
Prototypical Economies

This section formulates a general model that captures key features regarding price externalities of prototypical economies including a collateral economy (Kilenthong and Townsend,
2014b), an exogenous incomplete markets economy (Geanakoplos and Polemarchakis, 1986;
Greenwald and Stiglitz, 1986), a moral hazard with retrading economy (Kilenthong and
Townsend, 2011), and a liquidity constrained economy (Hart and Zingales, 2113). Each
subsection presents a key ingredient of the model along with the relevant part of each prototypical economy. More prototypical economies, namely a fire sales economy (Lorenzoni,
2008) and a hidden information with retrading economy (Diamond and Dybvig, 1983; Jacklin, 1987), are presented in Appendix B.

2.1

Basic Ingredients: Commodity Space, Preferences, Endowments, and Technology

There are L commodities. These can be basic underlying commodities and also date and/or
state contingent where the date and/or state are public. In order to incorporate private
information problems into this framework, we also allow a subset of commodities to be contingent on recommended but unobserved actions or on reported but unobserved states. For
7

actions, let a be the recommended action and (with the incentive compatibility constraints
in place) the actually taken action, and a0 be potentially deviating action. For privately
observed states, let a be the reported state and (with incentive compatibility constraints in
place) the actual state, and let a0 be some potentially counterfactual report. Let A ∈ R+ be
the set of possible actions/states, i.e., a, a0 ∈ A.
There is a continuum of agents of measure one. The agents are divided into H (ex-ante)
types, each of which is indexed by h = 1, 2, · · · , H. Each type h consists of αh ∈ [0, 1]
P
fraction of the population such that h αh = 1. In addition, this model allows for ex-post
diversity denoted by ex-post (either observable or unobservable) type ω ∈ Ω. More formally,
let ζ h (ω) be the fraction of agents of type h whose ex-post type is ω. An ex-post type ω may
depend on an observed output, an unobserved action, and/or unobserved state of nature as
well.
Each agent type h is endowed with an endowment eh ∈ RL+ . Note that ch and eh lie in
the L-dimensional commodity space. The preferences of an agent of type h are represented

by the utility function U h ch , where ch ∈ RL is the consumption allocation for an agent of
type h.
Each agent of type h has an access to a production technology defined implicitly by

F h yh ≥ 0,

(1)

where yh ∈ RL is the vector of its inputs and outputs in commodity space L. This production technology is generally a multidimensional vector of constraints with dimension O, i.e.,
 
O
F h yh ≡ Foh yh o=1 .
2.1.1

Basic Ingredients for the Collateral Economy

This is a two-period economy, t = 0, 1. There are a finite S states of nature in the second
period t = 1, i.e., s = 1, 2, ..., S. Let 0 < πs ≤ 1 be the objective and commonly assessed
P
probability of state s occurring, where s πs = 1. There are two goods, called good 1 and
good 2 in each period. These two goods can be traded in each date and in each state, and
we refer to those markets as spot markets with good 1 as the numeraire good in every date
and state. Thus, there are L = 2 (1 + S) commodities. There is no unobserved action or
8

privately observed state.

Each agent of type h = 1, 2, . . . , H is endowed with good 1 and good 2, eh0 = eh10 , eh20 in


the first period and ehs = eh1s , eh2s , in each state s = 1, · · · , S. Let eh = eh0 , · · · , ehS be the
endowment profile of an agent of type h over the first period and all states s in the second
period, respectively. There is no ex-post diversity in this economy, and therefore we simply
omit all related notation.

The preferences of an agent of type h are represented by the utility function uh ch1 , ch2 ,
and the discounted expected utility of h is defined by:
S
X



U h ch ≡ uh ch10 , ch20 + β
πs uh ch1s , ch2s ,

(2)

s=1

where β is the discount factor.
Good 1 is consumable but cannot be stored from t = 0 to t = 1 (is completely perishable),
while good 2 is consumable and storable. The good 2 that is stored can be collateralizable,
i.e., can serve as collateral to back promises. Henceforth, good 2 and the collateral good will
be used interchangeably. Each unit of good 2 stored (as input) will become Rs units of good
2 in state s. As a result, the production function in our general framework can be written
as follows:
h
h
Fsh (yh ) = y2s
+ Rs y20
= 0, for s = 1, . . . , S,

(3)

h
h
∈ R+ , s = 1, 2, . . . , S are inputs and outputs, respectively. We use
∈ R− and y2s
where y20

the standard convention under which an input must be non-positive and an output must be
non-negative. This economy has O = S production functions.
2.1.2

Basic Ingredients for the Exogenous Incomplete Markets Economy

Consider an economy with two periods, t = 0, 1. There are S possible states of nature in the
second period t = 1, i.e., s = 1, . . . , S, each of which occurs with probability πs such that
P
s πs = 1. There are 2 goods, labeled good 1 and good 2, in each date and in each state.
Thus, there are L = 2 (1 + S) commodities. Because the endowment profiles are the same
as specified in the collateral economy discussed above, we omit the details in this section for
brevity.
9


The preferences of an agent of type h are represented by the utility function uh ch1 , ch2 ,
and the discounted expected utility of h is defined by:
U

h

c

h



h

≡u

ch10 , ch20



+β

S
X


πs uh ch1s , ch2s ,

(4)

s=1

where β is the discount factor. There is no ex-post diversity in this economy, and endowments
and preferences are known ex-ante, and therefore we simply omit all related notation.
For simplicity, we assume that there is no production. Thus, Foh can be suppressed. As
a result, there would be no externalities if preferences were identically homothetic, as spot
prices are determined by ratio of aggregate endowment only, which no one can influence. So
we assume otherwise; that is, preferences are not identically homothetic.
2.1.3

Basic Ingredients for the Moral Hazard with Retrading Economy

There are two physical commodities, labeled as good 1 and good 2, in each states. These
commodities can be produced using the sole input, called action, a. Let A be the number
of possible actions. As in the literature, the random production technology is given by
f (q|a), which is the probability density function of the output vector of good 1 and good 2,
q = (q1 , q2 ), conditional on an action a taken by an agent. In other words, the probability
that the realized output will be q is f (q|a) when an agent takes an action a. The action
that an agent takes is private information. Hence, there is a moral hazard problem. There
is a continuum of ex ante identical agents of mass 1, i.e., no diversity in types so trivially
α1 = 1. For simplicity, we assume that each agent is endowed with zero units of both goods.
We will now map this moral hazard economy into our general model with securities
trading. Different combinations of outputs q define (idiosyncratic) states or indexes for
contracting purposes. There is no loss of generality to assume that there are a finite Q
states, q ∈ Q. Following the mechanism design literature, an optimal consumption of the
two goods under moral hazard depends on realized output q and recommended action a;
that is, c1 (q, a) and c2 (q, a). Accordingly, we define commodity using both output/state
q and recommended action a. In particular, for each recommended action a, there are Q
states. There are two commodities in each state. In addition, actual action a itself is another
commodity. Therefore, there are L = 2QA + 1 commodities in this model.
10

Each agent is endowed with the instantaneous common utility function for the two goods
and action, u (c1 , c2 , a). Again, let a be recommended action, and a0 be taken (possibly out-of
equilibrium) action. The discounted expected utility of an agent who is reported action a
but took action a0 is define by:
U (c) =

X

π(q|a0 )u (c1 (q, a), c2 (q, a), a0 )

(5)

q

where π(q|a) denote the probability of realizing outputs q given action a (actually taken),
which satisfies the following probability constraint:
X

π(q|a) = 1, ∀a.

(6)

q

Ex-post diversity in this model is determined by actual (ex ante) action and realized
(ex post) outputs, i.e., ω = (q, a0 ). For generality, let δ (a0 ) be the fraction of agents who
took action a0 . Recall that the fraction of agents who realized outputs q conditional on
taking action a0 is f (q|a0 ). As a result, the fractions of agents of ex-post type (q, a0 ) is
ζ 1 (q, a0 ) = f (q|a0 ) δ (a0 ).
As in the literature, the probability distribution across outputs/states depend on agent’s
choice of action a. This dependency is modeled as a general production function F whose
input is actual action a and outputs are q:
F (q, a) = f (q|a) − π(q|a) = 0, ∀q, a

(7)

In words, different actions will lead to different probability distributions. There are, as in (7),
O = QA production functions. Combining these production technologies with the probability
conditions (6) leads to the standard probability constraints of production function f (q|a):
X
q

2.1.4

π(q|a) = 1 ⇒

X

f (q|a) = 1, ∀a.

(8)

q

Basic Ingredients for the Liquidity Constrained Economy

Consider an economy with four periods, t = 0, 1, 2, 3. There are two types of agents, called
“doctors” and “builders”, each of which consists of αh > 0 for all h = b, d fraction of the
P
population with h=b,d αh = 1. Each agent h = b, d is endowed with eh = e units of wheat
11

at period t = 0. This is a simplified and deterministic version of Hart and Zingales (2113)
in which we assume that the doctors will buy building services in period t = 1 first, and the
builders will buy doctor services later in period t = 2. As in the collateral model in section
2.1.1, there is no unobserved action or privately observed state, and therefore we simply omit
all related notation.
There are two commodities in period t = 0, wheat w0h , and storage f0h , where the latter
is formally defined below. There are three commodities in period t = 1, storage f1h , building
services bd and labor supply of the doctors ld . Similarly, there are three commodities in
period t = 2, storage f2h , doctor services db , and labor supply of the builders lb . There is one
commodity, wheat w3h , in the last period t = 3. Therefore, there are L = 9 commodities in
this model.
The preferences of doctors and builders are represented by
2
lh
U (c) = u w , d , b , l =
+b −
,
2
2

lb
b
b
b b b b
b
b
U (c) = u w , d , b , l = w3 + d −
,
2
d

d

h

h

h

h



w3h

h

(9)
(10)

respectively. Note that doctors do not consume doctor services, and vice versa for builders.
We can write the utility function in a more general from as follows:
h

h

U (c) = u

h

h

h

w ,d ,b ,l

h



=

w3h

+

δbh bh

+ 1−

δdh



2
lh
d −
,
2
h

(11)

where δbh = 1 if h 6= b, and zero otherwise.
There are two technologies or assets available in period t = 0. First, the collateralizeable
asset is a storage technology, whose return from t = 0 to t = 3 is 1 unit of wheat, i.e., saving
one unit of wheat in the first period t = 0 will return 1 unit of wheat in the last period t = 3.
In addition, the claim on the output of this technology is transferable, and therefore can be
used as private money (or collateral) during periods t = 1 and t = 2. The second asset is an
investment project, whose return from t = 0 to t = 3 is R̄ > 1 units of wheat. However, this
asset cannot be used as collateral. For simplicity, we consider only a deterministic return
case here. Let f0h be the amount of wheat stored by an agent type h = b, d, and accordingly,
the agent type h invests e − f0h units of wheat in the investment project.
12

The production technologies are irreversible; that is, their outputs will be realized in
the last period t = 3 only. The production function of the storage technology (denoted by
subscript “s”) for an agent type h is defined as follows:
h
Fsh f2h , y31



h
− f2h = 0, ∀h = b, d,
= ys3

(12)

where f2h is the number of claims on the storage technology held by the agent type h at the
h
is the output in unit of wheat in period t = 3 received by the
end of period t = 2, and ys3

agent type h from the storage technology. Similarly, the production function for investment
project (denoted by subscript “i”) is defined by
h
Fih e − f0h , yi3




h
= yi3
− R̄ e − f0h = 0, ∀h,

(13)

h
where f0h is the amount of wheat stored by an agent type h in period t = 0, and yi3
is the

output in unit of wheat in period t = 3 received by the agent type h from the investment
technology .
In addition, the builders and the doctors produce building and doctor services (denoted
by subscript “o”), respectively, using the following simple linear technologies:
Foh yhh , lh



= yhh − lh = 0, ∀h = b, d,

(14)

which use labor as the only input. For notational convenience, we also set

h
h
F0h y−h
= y−h
= 0, ∀h = b, d,

(15)

h
= ybd , ydb denote building services produced by doctors and vice versa. To sum up,
where y−h

there are O = 4 production functions.

2.2

Market Structure: Security and Spot Markets

There are J securities. Let θjh ∈ R denote the amount of security j acquired (negative if
sold) by an agent of type h, and Dj = [Djl ]Ll=1 ∈ RL+ denote its payoff vector. Note securities
have payoffs of goods in the L-dimensional space of underlying commodities. Notationally,
let D = [Dj ]Jj=1 be the payoff matrix of all securities. Let P ∈ RJ+ be the price vector of all
securities, that is, Pj ≥ 0 for j = 1, . . . , J.
13

In addition, agents can trade in each of S restricted (ex-post spot) markets of subsets
of commodities. Let Ls be the subset of commodities that can be traded in an s restricted
(spot) markets such that ∪Ss=1 Ls ⊂ L. Note that ex-post trades are in proper subsets of
commodity space L as some dates or states are by then realized or known. With abuse of
notation, let Ls denote the number of commodities in Ls . These markets are assumed to be
0

mutually exclusive, i.e., Ls ∩ Ls = ∅ for any s 6= s0 .
h
(ω) denoting the amount of the
Let τ h denote the set of trades in these markets with τ`s

`th good in market Ls acquired (negative if surrendered) by an agent of ex-ante type h and
h
ex-post type ω. Note again that these spot trades τ`s
(ω) are restricted to be traded with
s

commodities in Ls only. Let p̃s ≡ [p̃`s ]`∈Ls ∈ RL+ be the price vector of commodities in Ls .
The relationship between consumption, endowments, securities, spot trades, and outputs
for an agent of type h is defined implicitly by

g h ch , eh , θh , τ h , yh = 0.

(16)

These will be obvious identities or accounting formulas in the examples which follow. This
condition is generally multidimensional vector with dimension N , i.e.,
g h ≡ gnh ch , eh , θh , τ h , yh
2.2.1

N
n=1

.

Market Structure for the Collateral Economy

h
Let θks
denote securities paying in good k = 1, 2 in state s or net transfers of good k = 1, 2
h
in state s acquired by an agent type h. If this is negative, it is a promise to pay. Also θk0

is spot purchase of good k at t = 0 but for convenience we refer to this as a security trade.
Thus there are J = 2 (1 + S) securities. Let P`0 and P`s denote the security (spot) price of
good ` at period t = 0 and the price of a security paying in good ` in state s, respectively.
We take good ` = 1 as the numeraire.
h
Let τks
denote spot trade amount of good k = 1, 2 in spot markets Ls in state s acquired
h
by an agent of ex-ante type h. With abuse of notation, let τk0
denote spot trade amount of

good k in spot markets L0 in period t = 0 acquired by an agent of ex-ante type h. Each spot
market has two commodities, namely good 1 and good 2, i.e., Ls = 2 for all s = 0, 1, . . . , S.
There are S + 1 spot markets here. We set the spot-market-clearing price of good 1 equal
14

to one (the numeraire good), and let p̃s denote the spot-market-clearing price of good 2 in
each spot market Ls .
The consumption-relationship constraints in this case are defined as follows:

h
h
h
h
gks
ch , eh , θh , τ, yh = ehks + yks
+ θks
+ τks
− chks = 0, for k = 1, 2; s = 0, 1, . . . , S,

(17)

h
h
= 0 to represent the fact that good 1 cannot be stored. There are
= 0 and y1s
where we set y10

N = 2 (1 + S) consumption-relationship constraints. As proved in Kilenthong and Townsend
(2014b), with complete collateralized contracts, there is no need for restricted/spot trades
τ in this case. All trades can be accomplished in ex-ante security markets. As a result, the
consumption-relationship constraints can be rewritten as follows:

h
h
h
gks
ch , eh , θh , yh = ehks + yks
+ θks
− chks = 0, for k = 1, 2; s = 0, 1, . . . , S.

(18)

Nevertheless, we can define what the ex-post spot price p̃s would be that would clear these
markets (without active trade).
2.2.2

Market Structure for the Exogenous Incomplete Markets Economy

There are J < S securities available for purchase or sell in the first period t = 0. Let
D = [Djs ] be the payoff matrix of those assets where Djs be the payoff of asset j in unit of
good 1 (the numeraire good) in state s in the second period t = 1, s = 1, 2, . . . , S. Let θjh
denote the amount of the j th security acquired by an agent of type h at t = 0, and Pj denote
the price of security j. An exogenous incomplete markets assumption specifies that D is not
full rank; that is again, J < S. This is crucial.
h
Let τks
denote spot trade amount of good k = 1, 2 in spot markets Ls in state s acquired
h
by an agent of ex-ante type h. With abuse of notation, let τk0
denote spot trade amount

of good k = 1, 2 in spot markets L0 in period t = 0 acquired by an agent of ex-ante type
h. Each spot market has two commodities, namely good 1 and good 2, i.e., Ls = 2 for all
s = 0, 1, . . . , S. There are S + 1 spot markets here. We set the spot-market-clearing price of
good 1 equal to one (the numeraire good), and let p0 and p̃s denote the spot-market-clearing
price of good 2 in spot market L0 in period t = 0, and the spot-market-clearing price of good
2 in spot market Ls at state s in period t = 1, respectively.
15

The consumption-relationship functions in the first period t = 0 is defined as follows:

h
gkh ch , eh , θh = ehk0 + τk0
− chk0 = 0, for k = 1, 2.

(19)

The consumption-relationship function for good 1 and good 2, respectively, in the state s in
the second period is defined as follows:
h
g1+2s
ch , eh , θh , τ h



= eh1s +

h
g2+2s



eh2s

X

h
Djs θjh + τ1s
− ch1s = 0, for s = 1, . . . , S,

(20)

j
h

h

h

c ,e ,θ ,τ

h

=

+

h
τ2s

− ch2s = 0, for s = 1, . . . , S.

(21)

Note here there will be active spot market trades τ to support the equilibrium allocation.
To sum up, there are N = 2(1 + S) consumption-relationship constraints.
2.2.3

Market Structure the Moral Hazard with Retrading Economy

To be consistent with the general model, one can imagine that there are state-contingent
securities paying in good k = 1, 2 when state/output is q and the recommended action is
a, namely θk (q, a). That is, security j is indexed by q, k, and a. Even though there are
J = 2QA securities available to trade, each agent can trade only 2Q securities depending on
his recommended action a only. In particular, an agent recommended action a will be able
to trade only securities θa ≡ [θk (q, a)]k,q . Let Pk (q, a) denote the price of a security paying
in good k conditional on output q and recommended action a. Recall that actual action
a0 = a is an input of the production technology, and there is no loss of generality to assume
that it is non-tradable. Therefore, there is no price for that commodity action. Note also
that as in the literature, these equilibrium securities prices are fair prices.
There is the possibility of retrade in ex post spot markets. One can think of two subperiods: the first with the application of inputs, securities, and production; the second for
output and possible retrading with final consumption. Without aggregate uncertainty, there
is only one set of spot markets (S = 1) for good 1 and good 2 (Ls = 2), in which everyone
participates. Let τk (q, a) be spot trade of an agent of ex-post type (q, a) when a is both the
recommended and taken action. We set the spot-market-clearing price of good 1 equal to
one (the numeraire good), and let p̃ denote the spot-market-clearing price of good 2, which
depends on agents’ action a (recommended and taken) and securities θa = [θk (q, a)]k,q as a
16

function of recommended action a (as if the markets can be partitioned by action a); that
is, p̃ = p̃ (θa , a).
As in Kilenthong and Townsend (2011) and the collateral example in Section 2.2.1, the
spot markets are redundant (with complete contracts), however. Anything that can be done
with spot markets can be done without them with altered security holdings. Therefore, we
can omit spot trades, henceforth, though there is still an implicit shadow spot price. The
consumption-relationship in this case is defined as follows:
gkqa = qk + θk (q, a) − ck (q, a) = 0, ∀q, a; k = 1, 2.

(22)

There are N = 2QA consumption-relationship constraints.
2.2.4

Market Structure the Liquidity Constrained Economy

To be consistent with the general model, there is no security in this model; that is, J = 0.
All trades occur in the spot markets. There are 2 sets of spot markets in period t = 1 and
t = 2; that is, S = 2. Agents can trade storage claim τfh1 and building services τbh in the spot
markets in period t = 1 at price p̃b ; that is, there are two commodities in the spot markets
in period t = 1 (L1 = 2). Similarly, agents can trade storage claim τfh2 and doctor services
τdh in the spot markets in period t = 2 at price p̃d ; that is, there are two commodities in the
spot markets in period t = 2 (L2 = 2).
The consumption-relationship constraints are as follows:
gbh bh , ybh , τbh


= bh − ybh + τbh = 0, ∀h,


gdh dh , ydh , τdh = dh − ydh + τdh = 0, ∀h,

h
h
h
h
gwh wh , yi3
, ys3
= w3h − yi3
− ys3
= 0, ∀h,

h
h
, τfht = fth − ft−1
− τfht = 0, ∀h; t = 1, 2.
gfht fth , ft−1


(23)
(24)
(25)
(26)

To sum up, there are N = 6 consumption-relationship constraints.

2.3

Trade Frictions: Obstacle-to-Trade Constraints

Price externalities in this model come from the fact that agents face obstacles to trade that
depend on prices. These obstacles are formulated as constraints and are called obstacle17

to-trade constraints. Each set of obstacle-to-trade constraints depends on the prices of a
particular subset of securities denoted P̃i or the prices of a particular subset of commodities
p̃i , or both. Let J i ≤ J be the dimensions of P̃i , and Li ≤ L be the dimensions of p̃i .


4
i
i
There are I sets of obstacle-to-trade constraints . That is, there are I sets of prices p̃ , P̃
relevant to obstacle-to-trade constraints. These obstacle-to-trade constraints could be in the
form of collateral constraints, retrading in exogenous incomplete-market constraints, incentive compatibility constraints under moral hazard with retrading, incentive compatibility
constraints under hidden information with retrading, liquidity constraints, and no-default
constraints.
 h A
for an agent of type h consists
Each set of obstacle-to-trade constraints Cih ≡ Ci,a,a
0
a,a0 =1


2
i
i
of A obstacle-to-trade constraints, each of which depends on the same set of prices p̃ , P̃ .
These put restriction on securities, spot trades, and output and are defined as follows:


h
h h
h
h
i
i
Ci,a,a
c
,
θ
,
τ
,
y
,
p̃
,
P̃
≥ 0, for i = 1, . . . , I; a ∈ A; a0 ∈ A.
0

(27)

The total number of obstacle-to-trade constraints is M = IA2 . Note that an action as in a
moral hazard model, or privately observed state indexes the commodities, and therefore is
included in ch .
The dependency on market-clearing prices of these obstacle-to-trade constraints is the
source of price externalities in this paper. Most of the literature focuses only on the dependency on the restricted/spot prices. This paper explicitly puts security prices into the
constraints in order to emphasize that price externalities could arise even when we shut
down the spot markets. In other words, the spot markets/prices are not fundamental to the
externality problem. It is an obstacle to trade itself, which can not be removed, that is key to
the problem. As shown in the collateral economy below, one can get rid of the spot markets
there since they are redundant. The collateral constraints (the need to back promises by
collateral) then depend on security prices only, but the price externality still occurs.
4

There is no loss of generality in setting the dimensionality of the obstacle-to-trade constraints identical

for all agent’s types. Consider a model where different types face different numbers of obstacle-to-trade
constraints. Let I h be the number of obstacle-to-trade constraints faced by an agent of type h. Set I =
maxh I h . For an agent of type h̃ whose I h̃ < I, we then define Cih̃ = ∅ for I h̃ < i ≤ I.

18

2.3.1

Trade Frictions for the Collateral Economy

As in Kilenthong and Townsend (2014b), the collateral constraints or obstacle-to-trade conh
must weakly exceed value of promises to pay
straints state that the value of collateral y2s

h
h
θ1s
, θ2s
:



h
h
h
p̃s y2s
≥ p̃s −θ2s
+ −θ1s
, for s = 1, . . . , S,

(28)

which can be rewritten as follow:

h
h
h
p̃s y2s
+ θ2s
+ θ1s
≥ 0, for s = 1, . . . , S,

(29)

where again p̃s is the spot price of good 2 in units of good 1 in state s.
But as mentioned earlier, these collateral constraints can be rewritten in terms of security
prices as following:



h
h
h
Csh θh , yh , P̃s = P2s y2s
+ θ2s
+ P1s θ1s
≥ 0, for s = 1, . . . , S,

(30)

which results from the fact that, with complete state contingent contracts at t = 0 and
the possibility of retrading, the spot price ratio p̃s equals to the ratio of security prices

P2s
.
P1s

This formulation emphasizes that we can shut down the spot markets, but the collateral
constraints still depend on security prices, which still generate externalities. In other words,
the spot markets/prices are not fundamental to the externality problem. It is an obstacle to
trade itself, which can not be removed, that is key to the problem.
Each agent of type h faces I = S sets of obstacle-to-trade constraints, each of which
contains only one constraint, i.e., technically A = 1. Therefore, there are M = S obstacleto-trade constraints in total.
2.3.2

Trade Frictions for the Exogenous Incomplete Markets Economy

The obstacle-to-trade or spot-budget constraint for an agent of type h in each state s is
simply the budget constraint in that state:

h
h
+ p̃s τ2s
= 0, for s = 1, . . . , S,
Csh τsh , p̃s = τ1s

(31)

Note that the spot price p̃s is determined by pre-trade position of endowments and securities
where endowments are exogenous but securities are endogenous.
19

Each agent of type h faces I = S sets of obstacle-to-trade constraints, each of which
contains only one constraint, i.e., A = 1. Therefore, there are M = S obstacle-to-trade
constraints in total.
2.3.3

Trade Frictions for the Moral Hazard with Retrading Economy

The possibility of retrade in ex post spot markets creates obstacle to trade in this model.
With the possibility of retrade, the ex-post utility maximization problem of an agent who
was recommended action a receiving compensation (c1 (q, a), c2 (q, a)), but took action a0
when the spot market price is p̃ is as follows:
v (c1 (q, a), c2 (q, a), a0 , p̃) = max u (c1 (q, a) + τ1 , c2 (q, a) + τ2 , a0 )
τ1 ,τ2

(32)

subject to the budget constraint:
τ1 + p̃τ2 = 0,

(33)

taking spot-market-clearing price p̃ as given.
As in Kilenthong and Townsend (2011), the possibility of retrade in ex post spot markets
and the moral hazard problem imply that the incentive compatibility constraints (IC) are
as following: ∀a, a0 ,
C1,a,a0 (c, p̃) =

X

u (c1 (q, a), c2 (q, a), a) f (q|a)

(34)

v (c1 (q, a), c2 (q, a), a0 , p̃) f (q|a0 ) ≥ 0,

(35)

q

−

X
q

Here the agent takes the recommended action a and so a = a0 . There is only one set of
obstacle-to-trade constraints, I = 1, and there are A2 constraints for this one i. Therefore,
there are M = A2 incentive compatibility constraints in total.
2.3.4

Trade Frictions for the Liquidity Constrained Economy

The obstacle-to-trade or spot market constraints for an agent type h = b, d in period t are
as follows:
C1h τfh1 , τbh , p̃b



= τfh1 + p̃b τbh = 0, ∀h = b, d,

(36)

C2h τfh2 , τdh , p̃d



= τfh2 + p̃d τdh = 0, ∀h = b, d,

(37)

20

where p̃b and p̃d are the spot-market-clearing prices of building and doctor services in period
P
t = 1 and t = 2, respectively; that is, p̃b is such that h=b,d αh τbh = 0, and vice versa. Note
that the spot price p̃b and p̃d are determined by storage positions of all agents which are
endogenous. Each agent of type h faces I = 2 sets of obstacle-to-trade constraints, each of
which contains only one constraint, i.e., A = 1. Therefore, there are M = 2 obstacle-to-trade
constraints in total.

3

Price Externalities

There is an externality because the consumption feasibility set of an agent type h depends on
other agents’ choices through prices. To reiterate, this dependency results from the obstacleto-trade constraints. If there were no obstacle-to-trade constraints, then each agent’s consumption feasibility set would be independent of other agents’ choices (and therefore there
would be no externality). Intuitively, an infinitesimal agent has no influence on aggregate resource allocation, which determines prices. On the other hand, a constrained planner knows
she can influence prices through agents’ choices collectively. The asymmetry between the
influence of the planner versus agents generates an inefficiency when any one of obstacle-totrade constraints, which contain prices, is binding for any agent type. We now present the
formal statement below. For simplicity, we focus on identical allocations for each type.

3.1

Competitive Equilibrium with Obstacles to Trade

An agent of type h maximizes his utility:
Program 1.
max

ch ,θh ,τ h ,yh

U h ch

21



(38)

subject to the budget, consumption-relationship, technology, and the obstacle-to-trade constraints, respectively:
J
X

Pj θjh ≤ 0,

(39)

j=1
Ls
X

h
(ω) ≤ 0, ∀s, ω,
p̃`s τ`s

`=1
h h

gnh ch , e , θ , τ h , yh



= 0, ∀n,


Foh yh = 0, ∀o,


h
h h
h
h
i
i
Ci,a,a
c
,
θ
,
τ
,
y
,
p̃
,
P̃
≥ 0, ∀i, a, a0 ,
0

(40)
(41)
(42)
(43)

taking prices p̃i , P̃i , and P as given.
In order to deal with ex post diversity in private information problems, we define some
participation mechanism. Let ξjh , called eligibility weight, denote the mass of agents of type
P
h who are eligible to trade security j, and hence ξj = h αh ξjh be the total mass of agents
of all types who are eligible to trade security j, adding up over ex-ante types. Note that ξjh
can depend on observable actions or unobserved states in A.
In addition, we also need to introduce financial intermediaries below in order to generally
represent economies with collateral requirements, incomplete markets, private information,
liquidity constraints, and fire sales in the same general framework. It is worthy of emphasis
that the existence of financial intermediaries is not the cause of price externalities in this
model. Intermediaries simply bundle commodities and facilitate trade.
The representative financial intermediary supplies securities ψ = (ψj )j , j = 1, 2, . . . , J
(per unit of eligible agents) to maximize its profit taking prices as given. The profit maximization problem of the representative financial intermediary is as follows:
max
ψ

J
X

Pj ξj ψj

(44)

j=1

subject to feasibility constraints (potentially multi-dimensional)
J
X

Ψmj ξj ψj = 0, for m = 1, . . . , M,

j=1

22

(45)

taking prices P as given, where Ψ = [Ψmj ]m,j is the matrix of security weights for the j th
security in the mth feasibility constraint. Note there are constant returns to scale so we act
as if there will be one price-taking intermediary.
The market clearing conditions for securities are as follows:
X

αh θjh = ψj , ∀j

(46)

h

These conditions simply state that the net demand for securities equates that supplied by
the intermediary sector. Note that combining the feasibility constraints (45) and the market
clearing constraints for securities (46) gives the resource constraints (49), written below.
The market clearing conditions for every spot market Ls are as follows:
XX
h

h
αh ζ h (ω) τ`s
(ω) = 0, ∀` ∈ Ls ; s ∈ S.

(47)

ω

The market clearing constraints for restricted/spot trades (47) ensure that spot prices p̃i are
consistent. That is, spot prices p̃i are such that (47) is satisfied and so each restricted/spot
market clears.
Definition 1. A competitive equilibrium with obstacles to trade is a specification of allo


h h
h
h
i
i
cation c , θ , τ , y for households and ψ for intermediaries, and prices p̃ , P̃ , P such
that



(i) for each type h, ch , θh , τ h , yh solves (38) subject to (39)-(43), taking prices p̃i , P̃i , P
as given;
(ii) for the financial intermediary, ψ solves (44) subject to (45), taking prices P as given;
(iii) markets for securities and for spot trades clear; (46) and (47) hold.
For expositional simplicity and without loss of generality, we consider only equal-treatment
(for each type) and interior solutions, and assume that all functions are differentiable. A
necessary optimal condition for a competitive equilibrium allocation with respect to y`h is
N
X
n=1

O

γghn

I

A

A

h
∂Ci,a,a
0
∂gnh X h ∂Foh X X X h
+
γ
+
γ
= 0, ∀h, `
Fo
Ci,a,a0
h
h
h
∂y`
∂y
∂y
`
`
0
o=1
i=1 a=1 a =1

23

(48)

where γghn , γFho and γCh i,a,a0 are the Lagrange multipliers with respect to the nth consumptionrelationship constraint, (41); the oth technology constraint of agent h, (42); and obstacle-totrade constraint (i, a, a0 ) of an agent of type h, (43), respectively.

3.2

Constrained Optimality

Attainable allocations are those that can be achieved by exchanges of commodities and
by production subject to both resource constraints and obstacle-to-trade constraints. In
addition, it also requires that the allocation of relevant commodities (under the ith obstacleto-trade constraints) must lead to market-clearing prices p̃i and P̃i . More formally, this
consistency condition can be written as follows p̃i = p̃i (c, θ, y, e) and P̃i = P̃i (c, θ, y, e)

where (c, θ, y, e) ≡ ch , θh , yh , eh h .
Definition 2. An allocation (c, θ, τ, y) is attainable if
(i) it satisfies the resource constraints:
J
X

(49)

h
αh ζ h (ω) τ`s
(ω) = 0, ∀s = 1, . . . , S; ` = 1, . . . Ls ,

(50)

j=1

XX
h

X

αh θjh = 0, ∀m = 1, . . . , M,

Ψmj ξj

h

ω


(ii) for each h, it satisfies the consumption-relationship function, gnh ch , eh , θh , τ h , yh =
0, ∀n ;

(iii) for each h, yh follows the production function, Foh yh = 0, ∀o;
(iv) for each h, it satisfies the obstacle-to-trade constraints:
h
Ci,a,a
0



h

h

h

h

i

i

c , θ , τ , y , p̃ , P̃



≥ 0, ∀i, a, a0 ;

(51)

(v) all consistency conditions are satisfied, i.e., p̃i = p̃i (c, θ, y, e) and P̃i = P̃i (c, θ, y, e)
for all i, i.e., prices are such that (46) and (47) are satisfied.
The nonlinearity of obstacle-to-trade constraints could cause the attainable set to be
non-convex. This non-convexity implies that randomization, a lottery, could be potentially
24

useful. However, for expositional reasons, this section will not use lotteries now. Note that
the existence of an externality shown is still true with and without lotteries (Kilenthong and
Townsend, 2011). We do generalize and formalize with lotteries in Section 4.1 below.
A constrained optimal allocation (identical within types but this is without loss of generality) is characterized using the following planner’s problem, which maximizes the utility
of type 1 subject to fixed utility of other types, as follows:
Program 2.
max U 1 c1



(52)

c,θ,τ,y

subject to


≥ U , for h = 2, . . . , H,

(53)

gnh ch , eh , θh , τ h , yh



= 0, ∀n, h,

(54)

J
X

Ψmj ξj

j=1

XX
h

h

U h ch

X

αh θjh = 0, ∀m,

h
h h

h
(ω) = 0, ∀l, s,
α ζ (ω) τ`s

h

(56)

ω


Foh yh = 0, ∀o, h,


h
Ci,a,a
ch , θh , τ h , yh , p̃i , P̃i ≥ 0, ∀i, a, a0 , h,
0

where U

(55)

(57)
(58)

p̃i = p̃i (c, θ, y, e) , ∀i,

(59)

P̃i = P̃i (c, θ, y, e) , ∀i,

(60)

is a promised utility level for an agent of type h.

A necessary optimal condition for a Pareto optimal allocation with respect to y`h is5
N
X
n=1

µhgn

O
I XX
h
h
X
X
∂Ci,a,a
0
∂gnh
h ∂Fo
h
µ
µ
+
+
Fo
Ci,a,a0
h
h
h
∂y`
∂y`
∂y`
0
o=1
i=1 a
a

i
i
H
I
L
J
h̄
h̄
i
i
XXXX
X ∂Ci,a,a0 ∂ p̃
X ∂Ci,a,a0 ∂ P̃j
l
 = 0, ∀h, `(61)
µh̄Ci,a,a0 
+
+
i
h
i ∂y h
∂
p̃
∂y
∂
P̃
l
`
`
0
j
i=1 a
j=1
l=1
a
h̄=1

where µhgn , µhFo , and µhCi,a,a0 are the Lagrange multipliers with respect to the nth consumptionrelationship, (54), the oth technology constraint, (57), and (i, a, a0 ) obstacle-to-trade constraint of agent of type h, (58), respectively.
5

A similar conclusion can be drawn from a necessary optimal condition with respect to ch` and θjh .

25

Of special interest, the last term depends not only on the bindingness of obstacle-to-trade
constraints for h as we vary ylh but also the bindingness of other agents’ h̄ obstacle-to-trade
constraints. This implies that if any type of agent’s obstacle-to-trade constraint is binding,
it will impact everyone through prices. This is the source of the price externalities.
Note that an infinitesimal agent takes prices p and P, including p̃i and P̃i , as invariant.
But to the contrary, the constrained planner can influence subsets of prices p̃i and P̃i through
aggregate allocation, (c, θ, y, e). This key influence is the term in

∂ p̃il
∂y`h

and

∂ P̃ji
∂y`h

in the planner

problem. The difference between the impact of the planner and that of the agents creates
price externalities and causes an inefficiency.
Technically, if the last term in (61) were zero, then condition (48) would have been exactly
the same as (61). The last term in (61) could always be zero if either µh̄Ci = 0 for all h̄ and
all i, or

∂ p̃il
∂y`h

= 0 and

∂ P̃ji
∂y`h

= 0, for all `, all i, all l, all j, and all h. Generically, those prices

vary with the market fundamental which is determined by (c, θ, y, e). As a result, the last
term in (61) will not be zero as long as an obstacle-to-trade constraint of an agent of type
h̄ binds. With this non-zero term, a competitive equilibrium with obstacles to trade will
be constrained inefficient. It is the interaction between the bindingness of obstacle-to-trade
constraints and equilibrium prices that is the key to the existence of price externalities.

4

Market-Based Solution: Endogenous Security Exchanges

This section proposes a market-based solution to price externality problems. The solution
is to create markets for the rights to trade in a particular security exchange, indexed by




p̃, P̃ 6 . The p̃, P̃ are to be the equilibrium prices for commodities and securities within
the specified security exchange, but from the agent stand point all possible price pairs across
exchanges are available. Agents pay a market participation fee, or receive a compensation,
as fixed fee depending on the exchange, the price pair and rights indexed by i. An agent


who chooses to trade in a security exchange p̃, P̃ can act as if she can trade commodities
6

Recall that a subset of these prices enters into the obstacle-to-trade constraint i, i = 1, 2, . . . , I.

26

and securities with the specific prices indicated. Importantly, those agents are not allowed


to trade with agents in other exchanges p̃0 , P̃0 . Formally, this solution concept requires a
registration/identification system and an exclusivity assumption; that is, an agent type h in


an exchange p̃, P̃ can trade exclusively within his exchange but not with agents in other


exchanges p̃0 , P̃0 . Put differently, agents will be sorted into segregated exchanges. For
all but the exogenous incomplete market set up, it is sufficient to have exchanges in which
securities are actually traded only. For the incomplete market economy, we do not expand
the set of securities but simply add segregated exchanges. More generally, we keep track of
both security and spot market prices.


Formally, let ∆hi p̃i , P̃i denote the amount of the rights to trade in a particular se

i
i
curity exchange with specified prices p̃ , P̃ associated with obstacle-to-trade constraint i
i

 h
for an agent of type h. Let p̃, P̃ ≡ p̃i , P̃i denote a collection of price vectors relevant
i

to each obstacle-to-trade constraint. As there can be multiple constraints, notationally, let
 
∆h ≡ ∆hi i be the associated vector. This object is the externality-correcting commodity
vector that, as in standard Walrasian equilibrium, will have its own unit of account market




i
i
∆
prices, Πi p̃ , P̃ , i = 1, 2, . . . , I. In order to be eligible to trade in this exchange p̃, P̃ ,




an agent of type h must hold the rights to trade ∆hi p̃i , P̃i = dhi eh , θh , yh , p̃i , P̃i for
all i = 1, 2, . . . , I. This depends on agent’s type, agent’s endowment, agent’s choices, and
prices. Otherwise, he will not be able to trade in the exchange. For example, in a collateral equilibrium model in Kilenthong and Townsend (2014b), this object is called the “type
h discrepancy from the fundamental” in spot markets, which depends on his endowments,
his choice of collateral allocation, and the specific price. An alternative example is in Kilenthong and Townsend (2011), in which the rights to trade is implicitly embedded in the
incentive comparability constraints. More generally, an agent’s required rights to trade can
be defined by excess demand functions for relevant commodities, which are again functions
of his endowments, his choice of collateral allocation, and the specific price. The right to
trade in this paper could be a tax or subsidy in the public finance literature, as discussed in
Kilenthong and Townsend (2014b). This paper offers a market-based solution, however. So
these are additional market clearing, market formation prices not government instruments.
Regulators need only allow proper configuration of exchanges with market participation fees
27

competitively determined.


An agent of type h faces a two-step problem. Let Pj p̃, P̃ be the price of security j




that can be traded in an exchange p̃, P̃ . First, conditional on being in exchanges p̃, P̃ ,

the agent chooses the usual allocation θh , τ h , yh , taking all prices P, p̃, P̃, Π∆ as given:



(62)
V h p̃, P̃ = max U h ch
θh ,τ h ,yh ,∆h

subject to the budget constraints, the consumption-relationship constraints, the technology
constraints, and the obstacle-to-trade constraints, and the requirement on the rights to trade,


respectively, taking as given the choice of exchanges p̃, P̃ for the moment:





X 
X
h
∆
i
i
h
i
i
Pj p̃, P̃ θj +
Πi p̃ , P̃ ∆i p̃ , P̃
≤ 0
(63)
j

i
s

L
X

gnh

h

h
p̃`s τ`s
(ω) ≤ 0, ∀s, ω,

`=1
h h

c , e , θ , τ h , yh
Foh y



(64)



= 0, ∀n,

(65)


h

= 0, ∀o,

(66)



h
Ci,a,a
ch , θh , τ h , yh , p̃i , P̃i ≥ 0, ∀i, a, a0
0




∆hi p̃i , P̃i − dhi eh , θh , yh , p̃i , P̃i = 0, ∀i,

(67)
(68)

where the last constraints ensure that each agent must hold the correct amount of the rights
to trade in order to be eligible to trade in each exchange.



Second, the agent then chooses a collection of exchanges p̃, P̃ that gives the largest
utility taking all prices as given:
max V
(p̃,P̃)

h




p̃, P̃

(69)

We will now write this problem as a one step problem. This representation is a step


toward the lottery representation presented below. Let δ h p̃, P̃ ∈ {0, 1} be an indicator


function indicating agent h’s choice of a collection of exchanges; that is, δ h p̃, P̃ = 1 is the






agent chooses to be in exchanges p̃, P̃ , and zero otherwise. Let θh p̃, P̃ , τ h ω, p̃, P̃ ,


h
and y p̃, P̃ be choices of securities, spot trades, and net outputs of agent h conditional


on being in exchanges p̃, P̃ . This notation emphasizes that a feasible allocation depends
on where the agent is.
28

The utility maximization problem for an agent of type h is as following:
max
δ h (p̃,P̃),θh (p̃,P̃),τ h (ω,p̃,P̃),yh (p̃,P̃),∆h (p̃,P̃)

X



 

δ h p̃, P̃ U h ch p̃, P̃

(70)

(p̃,P̃)

subject to budget, technology, and obstacle-to-trade constraints:
"
#
 X 
 
 X




X 
h
h
∆
i
i
h
i
i
δ p̃, P̃
Pj p̃, P̃ θj p̃, P̃ +
Πi p̃ , P̃ ∆i p̃ , P̃
≤ 0,
j

p̃,P̃

i

X

Ls

X


h
h
δ p̃, P̃
p̃`s τ`s ω, p̃, P̃ ≤ 0, ∀s, ω,
`=1

p̃,P̃

X




= 0, ∀n,
δ h p̃, P̃ gnh ch p̃, P̃ , eh , θh p̃, P̃ , τ h ω, p̃, P̃ , yh p̃, P̃
















p̃,P̃

X



 

δ h p̃, P̃ Foh yh p̃, P̃
= 0, ∀o,

p̃,P̃

X



 








h
δ h p̃, P̃ Ci,a,a
ch p̃, P̃ , θh p̃, P̃ , τ h ω, p̃, P̃ , yh p̃, P̃ , p̃i , P̃i ≥ 0, ∀i, a, a0 ,
0

p̃,P̃

X


h 






i
δ h p̃, P̃ ∆hi p̃i , P̃i − dhi eh , θh p̃i , P̃i , yh p̃i , P̃i , p̃i , P̃i
= 0, ∀i.

p̃,P̃

Our market-based solution requires that we create segregated security exchanges only
for securities and commodities whose prices generate price externalities through obstacle-totrade constraints. Some securities are commonly available to trade for all agents regardless
h
of where they are in. For example, spot trades θk0
in the collateral economy in section

?? are commonly traded securities. More formally, let J i denote the set of all securities
corresponding to the ith set of obstacle-to-trade constraint, and therefore will be exclusively
available to agents in a particular exchange only. Accordingly, J˜ = J \ ∪i J i is the set of all
commonly traded securities.
The representative financial intermediary, taking prices Pj




p̃, P̃ as given, maximizes

its profit
max

XX

ψj

p̃,P̃





Pj p̃, P̃ ξj ψj p̃, P̃

j

29

(71)

subject to feasibility constraints
X

Ψmj ξj

j∈J˜

X



p̃, P̃





ψj p̃, P̃ = 0, ∀m = 1, . . . , M,

(72)



ψj p̃, P̃ = 0, ∀m = 1, . . . , M ; i = 1, . . . , I; p̃i , P̃i ,

(73)

p̃,P̃

X

Ψmj ξj

j∈J i

where

X

p̃−i ,P̃−i

=




p̃i , P̃i , p̃−i , P̃−i . Note that conditions (72) are for securities that are

commonly available to trade for all agents and while conditions (73) are for securities that


are exclusively available to agents within an exchange p̃i , P̃i only.
˜ and for securities
The market clearing constraints for commonly traded securities j ∈ J,


j ∈ J i exclusively traded within an exchange p̃i , P̃i are as follows:
XX

δ

h



δ

h



p̃, P̃



αh θjh



p̃, P̃



αh θjh



p̃, P̃



p̃, P̃



≤

h

p̃,P̃

X X





˜
ψj p̃, P̃ , ∀j ∈ J,

(74)

p̃,P̃

≤

h

p̃−i ,P̃−i

X

X





ψj p̃, P̃ , ∀j ∈ J i ; i; p̃i , P̃i .

(75)

p̃−i ,P̃−i



Similarly, the market clearing constraints for every spot markets Ls in an exchange p̃i , P̃i
are as follows:
X XX
p̃−i ,P̃−i

h





h
δ h p̃, P̃ αh ζ h (ω) τ`s
ω, p̃, P̃ ≤ 0, ∀s ∈ S; ` ∈ Ls ; p̃i , P̃i ,

(76)

ω

In addition, we require that the markets for the rights to trade clear; that is, for each


exchange p̃i , P̃i ,
X X
p̃−i ,P̃−i





δ h p̃, P̃ αh ∆hi p̃i , P̃i ≤ 0, ∀i, p̃i , P̃i .

(77)

h

These constraints are called consistency constraints, which ensure that equilibrium prices of


relevant commodities and securities in each exchange are p̃i , P̃i as specified.

4.1

The Lottery Representation

We will now proceed with more formality. Because the obstacle-to-trade constraints can
potentially generate non-convexity problems, lotteries will be applied.
30





Let xh c, θ, τ, y, p̃, P̃, ∆ be the probability measure on c, θ, τ, y, p̃, P̃, ∆ for an agent


of type h. In other words, xh c, θ, τ, y, p̃, P̃, ∆ is the probability of receiving allocation


(c, θ, τ, y), and being in exchanges p̃, P̃ with the rights to trade ∆. It is worthy of emphasis
that price externalities cannot simply be overcome using lotteries to convexify the problem,
as shown in Kilenthong and Townsend (2011) where price externalities exist even in a setting
with lotteries.
As a probability measure, a lottery of an agent of type h, xh , satisfies the following
probability constraint:


xh c, θ, τ, y, p̃, P̃, ∆ = 1.

X

(78)

c,θ,τ,y,p̃,P̃,∆



With a continuum of agents, xh c, θ, τ, y, p̃, P̃, ∆ can be interpreted as the fraction of


agents of type h assigned to a bundle c, θ, τ, y, p̃, P̃, ∆ . More formally, with all choice
object gridded up as an approximation, the commodity space is assumed to be a finite
h 
i
dimensional linear space7 . Let xh ≡ xh c, θ, τ, y, p̃, P̃, ∆
be a typical lottery
(c,θ,τ,y,p̃,P̃,∆)
for an agent of type h.


We now consider a bundle c, θ, τ, y, p̃, P̃, ∆ as a typical commodity. Each bundle
will be feasible for an agent of type h with endowment e only if it satisfies the spot-market
budget constraints, the consumption-relationship constraints, the technology constraints, the
obstacle-to-trade constraints, and the right-to-trade requirements8 as following:
s

L
X

gnh

h

h
p̃`s τ`s
(ω) ≤ 0, ∀s, ω,

`=1
h h

c , e , θ , τ h , yh
Foh y





= 0, ∀n,

(80)


h

= 0, ∀o,

(81)



h
Ci,a,a
ch , θh , τ h , yh , p̃i , P̃i ≥ 0, ∀i, a, a0
0




∆hi p̃i , P̃i − dhi eh , θh , yh , p̃i , P̃i = 0, ∀i,
7

(79)

(82)
(83)

The limiting arguments under weak-topology used in Prescott and Townsend (1984a) can be applied to

establish the results if the commodity space is not finite.
8
In some cases, as in a moral hazard with retrading and a hidden information with retrading, the rightto-trade requirements may be embedded implicitly in the obstacle-to-trade constraints. As a result, they
may not be explicitly written out as separate constraints as in Kilenthong and Townsend (2011).

31

Accordingly, we impose the following condition on the probability measure as follows:


xh c, θ, τ, y, p̃, P̃, ∆ ≥ 0 if conditions (79) to (83) hold,

(84)

= 0 if otherwise.
In words, a positive measure can be defined only on feasible bundles, which satisfy the
spot-market budget constraints, the consumption-relationship constraints, the technology
constraints, the obstacle-to-trade constraints, have the required amount of the rights to
trade.
In addition, in order to incorporate the moral hazard economy into the general framework
with lotteries, we need to impose additional conditions, called mother-nature constraints, to
ensure that the lottery is consistent with the production technology9 , as in Prescott and
Townsend (1984b). There are W mother-nature constraints. The mother-nature constraints
can be written as linear constraints as follows:
X


 

Γw c, θ, τ, y, p̃, P̃, ∆ xh c, θ, τ, y, p̃, P̃, ∆ = 0,

(85)

c,θ,τ,y,p̃,P̃,∆




where Γw c, θ, τ, y, p̃, P̃, ∆ ∈ R is the coefficient for wth constraint corresponding for


c, θ, τ, y, p̃, P̃, ∆ .
More formally, the consumption possibility set of an agent of type h is defined as follows:
n


o
h
h
X = x : x c, θ, τ, y, p̃, P̃, ∆ satisfies (78), (84), and (85)
h

(86)

Let xh be a typical element of X h . Note that X h is compact and convex.

4.2

Competitive Equilibrium with Segregated Security Exchanges





Let P c, θ, τ, y, p̃, P̃, ∆ be the price of a bundle or contract c, θ, τ, y, p̃, P̃, ∆ . Each
agent is infinitesimally small relative to the entire economy and will take all prices as given.
The intermediaries also act competitively. Note as well that the rights to trade ∆ is also
priced.
9

That is, the technology constraints will be replaced by the mother-nature constraints for the moral

hazard with retrading economy.

32



Consumers: Each agent of type h, taking prices P c, θ, τ, y, p̃, P̃, ∆ as given, chooses
xh to maximize its expected utility:
X

max

xh ∈X h



x c, θ, τ, y, p̃, P̃, ∆ U h (c)
h

(87)

c,θ,τ,y,p̃,P̃,∆

subject to the budget constraint


 

h
P c, θ, τ, y, p̃, P̃, ∆ x c, θ, τ, y, p̃, P̃, ∆ ≤ 0

X

(88)

c,θ,τ,y,p̃,P̃,∆

Financial Intermediaries: As in section 2, there is no loss of generality to assume that


there is a representative financial intermediary who issues (sells) b c, θ, τ, y, p̃, P̃, ∆ ∈ R+


units of each bundle at the unit price P c, θ, τ, y, p̃, P̃, ∆ . Note that the intermediary can
issue any non-negative number of a bundle; that is, the number of bundles issued does not
have to be between zero and one and is not a lottery. Let b be the vector of the number


of bundles issued as one move across bundles, arguments in b c, θ, τ, y, p̃, P̃, ∆ . With
constant returns to scale, the profit of a market-maker must be zero and the number of
market-makers becomes irrelevant. Therefore, without loss of generality, we assume there is
one representative market-maker, which takes prices as given.
The intermediary’s profit maximization problem is as follows:
X

max
b



 

P c, θ, τ, y, p̃, P̃, ∆ b c, θ, τ, y, p̃, P̃, ∆

(89)




b c, θ, τ, y, p̃, P̃, ∆ Ψmj ξj θj ≤ 0, ∀m,

(90)



b c, θ, τ, y, p̃, P̃, ∆ Ψmj ξj θj ≤ 0, ∀m; i; p̃i , P̃i .

(91)

c,θ,τ,y,p̃,P̃,∆

subject to
X

X

j∈J\J˜ (c,θ,τ,y,p̃,P̃,∆)

X

X

j∈J˜i (c,θ,τ,y,p̃−i ,P̃−i ,∆)

These constraints state that the financial intermediary must put together deals that execute
all securities properly.
Market Clearing: The market-clearing conditions for contracts/lotteries are as follows:
X







αh xh c, θ, τ, y, p̃, P̃, ∆ = b c, θ, τ, y, p̃, P̃, ∆ , ∀ c, θ, τ, y, p̃, P̃, ∆ .

h

33

(92)

In order to define the market-clearing conditions for spot trades consistently, we need to
define indicator functions ρsi whose value will be one if restricted markets s are relevant to
obstacle-to-trade constraints i, and zero otherwise. More formally, ρsi = 1 if p̃s = p̃i , and
ρsi = 0 otherwise. The market-clearing conditions for spot trades are as follows:
X

X

(c,θ,τ−`−s ,y,p̃−i ,P̃−i ,∆)

h



α x c, θ, τ, y, p̃, P̃, ∆ τ`s ρsi = 0, ∀s; `; i; p̃i , P̃i ,
h h

(93)

where τ = (τ`s , τ−`−s ). Note that the ex-post diversity is already captured implicitly in the
lottery xh , and therefore there is no need for ζ h (ω) in the lottery representation. For example,
as in the moral hazard case, ζ h (q, a) = δ (a) f (q|a) represents a fraction of population who
took action a and received outputs q. Under the lottery representation, the mother nature
constraints ensure that these fractions are consistent with the production technology. That
is, the ex-post diversity is already part of the lottery.
In addition, we again require that the markets for the rights to trade clear; that is, for


each exchange p̃i , P̃i ,
X

X

(c,θ,τ,y,p̃−i ,P̃−i ,∆)

h



αh xh c, θ, τ, y, p̃, P̃, ∆ ∆hi = 0, ∀i; p̃i , P̃i .

(94)

Definition 3. A competitive equilibrium with segregated exchanges is a specification of


allocation (x, b), and prices P c, θ, τ, y, p̃, P̃, ∆ such that


(i) for each agent of type h, xh ∈ X h solves (87) subject to (88), taking prices P c, θ, τ, y, p̃, P̃, ∆
as given;


(ii) for the financial intermediary, b solves (89) subject to (90), (91), taking prices P c, θ, τ, y, p̃, P̃, ∆
as given;
(iii) markets for contracts/lotteries, spot trades, and rights to trade clear; that is, (92), (93)
and (94) hold.

4.3

Constrained Optimal Allocations

An allocation x ≡ xh


h

is attainable if xh ∈ X h for all h, and it satisfies the following

resource constraints for common securities, for securities corresponding to the ith obstacle34





to-trade constraint in exchange p̃i , P̃i , for spot trades τ`s in exchange p̃i , P̃i , and the
consistency constraints, respectively:
X

X

j∈J\J˜ (c,θ,τ,y,p̃,P̃,∆)

X

X

j∈J˜i (c,θ,τ,y,p̃−i ,P̃−i ,∆)

X



α x c, θ, τ, y, p̃, P̃, ∆ Ψmj ξj θj ≤ 0, ∀m,
h h

(95)

h

X

h h

α x




c, θ, τ, y, p̃, P̃, ∆ Ψmj ξj θj ≤ 0, ∀m; i; p̃i , P̃i ,

(96)

h

X

X

(c,θ,τ−`−s ,y,p̃−i ,P̃−i ,∆)
X

h

(c,θ,τ,y,p̃−i ,P̃−i ,∆)



αh xh c, θ, τ, y, p̃, P̃, ∆ τ`s ρsi = 0, ∀s; `; i; p̃i , P̃i ,

X



αh xh c, θ, τ, y, p̃, P̃, ∆ ∆hi = 0, ∀i; p̃i , P̃i .

(97)
(98)

h

The key idea of our market-based solution is to formulate the consistency constraints
as linear feasibility constraints. This formulation in fact makes the price externalities depletable, and therefore makes it possible to reach a constrained optimal allocation using
a non-personalized price system as in a standard Walrasian equilibrium in contrast to a
Lindahl equilibrium where prices are personalized. Technically, the linear consistency constraints correspond to market clearing conditions for the rights to trade in the competitive
equilibrium.
Definition 4. An allocation x ≡ xh

H
h=1

∈ X 1 ×. . .×X H is said to be attainable if xh ∈ X h

for every agent of type h, and it satisfies (95)-(98).
Let X denote the set of all attainable allocations. With finite linear weak-inequality
constraints, the attainable set X is compact and convex. In addition, the assumption that
the endowment is on the grids also ensures that X is nonempty.
A constrained optimal allocation is an attainable allocation such that there is no other
attainable allocation that can make at least one agent type strictly better off without making
any other agent type worse off. We characterize constrained optimality using the following
Pareto program. Let λh ≥ 0 be the Pareto weight of agent type h. There is no loss of
P
generality to normalize the weights such that h λh = 1. A constrained Pareto optimal
allocation x solves the following Pareto program.

35

Program 3. The Pareto Program with Lotteries:


X
X
xh c, θ, τ, y, p̃, P̃, ∆ U h (c)
max
λh α h
x∈X

h

(99)

c,θ,τ,y,p̃,P̃,∆

subject to (95)-(98).
It is clear that the objective function now is linear in x. Thus, it is continuous and
weakly concave. As discussed earlier, the feasible set X is non-empty, compact, and convex.
Therefore, a solution to the Pareto program for given positive Pareto weights exists and is
a global maximum. The proof of the equivalence between Pareto optimal allocations and
the solutions to the program is omitted for brevity (see Prescott and Townsend, 1984b, for
a similar proof).

4.4

Welfare Theorems and Existence Theorem

As in the classical general equilibrium model, the economy is a well-defined convex economy, i.e., the commodity space is Euclidean, the consumption set is compact and convex,
the utility function is linear. As a result, the first and second welfare theorems hold, and a
competitive equilibrium exists. In particular, this section proves that the competitive equilibrium is constrained optimal and any constrained optimal allocation can be supported by
a competitive equilibrium with transfers. Then, we will use Negishi’s method to prove the
existence of a competitive equilibrium. Because all the proofs in this section are standard,
we omitted them.
The standard contradiction argument will be used to prove the following first welfare
theorem. We also assume that there is no local satiation point in the consumption set.
Assumption 1. For any xh ∈ X h , there exists x̃h ∈ X h such that




X
X
h
h
h
x̃ c, θ, τ, y, p̃, P̃, ∆ U (c) >
x c, θ, τ, y, p̃, P̃, ∆ U h (c) . (100)
c,θ,τ,y,p̃,P̃,∆

c,θ,τ,y,p̃,P̃,∆

Based on this no local satiation assumption, we can prove the following first welfare
theorem.
Theorem 1. With local nonsatiation of preferences (Assumption 1), a competitive equilibrium with segregated exchanges allocation is (constrained) Pareto optimal.
36

The Second Welfare theorem states that any Pareto optimal allocation, corresponding to
strictly positive Pareto weights, can be supported as a competitive equilibrium with transfers. The standard approach applies here. In particular, we first prove that any constrained
optimal allocation can be decentralized as a compensated equilibrium. Then, we use a standard cheaper-point argument (see Debreu, 1954) to show that any compensated equilibrium
is a competitive equilibrium with transfers.
Theorem 2. Any Pareto optimal allocation corresponding with strictly positive Pareto weights
λh > 0, ∀h can be supported as a competitive equilibrium with segregated exchanges with transfers.
We use Negishi’s mapping method (Negishi, 1960) to prove the existence of competitive
equilibrium. The proof benefits from the second welfare theorem. Specifically, a part of the
mapping applies the theorem in that the solution to the Pareto program is a competitive
equilibrium with transfers. We then show that a fixed-point of the mapping exists and it
represents a competitive equilibrium without transfers.
Theorem 3. For any positive endowments, a competitive equilibrium with segregated exchanges exists.

5

Conclusion

We offer a general approach to the problem of pecuniary externalities that encompasses six
leading example economies in the literature. Namely, we expand the underlying commodity
space of the environment of a generalized equilibrium model, allow bundling and exclusivity,
and devise a general method that entirely internalizes these externalities. The two principal
welfare theorems apply to the generalize environment and hence of the six example economies
individually: competitive equilibria are constrained efficient, and any constrained Pareto
optimal allocation can be achieved in competitive markets with suitable lump sum transfers
and taxes.
Putting the result this way may make it seem that our paper is a lesson in abstract
general equilibrium theory and limited to the interest of theorists. Yet to the contrary, we
37

are motivated by recent policy discussions on fire sales and balance sheet amplifiers and the
forms of consequent regulation. Our goal is to use theory to contribute to those discussions.
We show simply if not radically that there is an alternative to the current and recommended
regulations. That is, there is way to structure financial markets, with competitively priced
rights to trade, so that pecuniary externalities are internalized and equilibria are constrained
efficient. Further, the platforms with registration, tracking, and exclusivity that are required
for implementation of our proposal are no more demanding than the technology already used
in the routine operation of contemporary financial markets and indeed used or promoted in
recent regulation. We only require that ownership of securities be transferred electronically
on platforms and that traders and trades be registered and recorded (see a detailed discussion
in Kilenthong and Townsend, 2014a). The optimal form of ex ante market structure using
these technologies is the punchline recommendation of the paper.

References
Acemoglu, D. and A. Simsek (2012). Moral Hazard and Efficiency in General Equilibrium
with Anonymous Trading. Working Paper .
Allen, F. and D. Gale (2004). Financial Intermediaries and Markets. Econometrica, 1023–
1061.
Araujo, A., F. Kubler, and S. Schommer (2012). Regulating collateral-requirements when
markets are incomplete. Journal of Economic Theory 147 (2), 450–476.
Arrow, K. (1969). The Organization of Economic Activity: Issues Pertinent to the Choice of
Market versus Nonmarket Allocation. The Analysis and Evaluation of Public Expenditure:
The PPB System 1, 59–73.
Begalle, B., A. Martin, J. McAndrews, and S. McLaughlin (2013). The risk of fire sales in
the tri-party repo market. Technical report, Federal Reserve Bank of New York.
Bianchi, J. and E. Mendoza (2012). Overborrowing, financial crises and macro-prudential
policy. Working Papers.
38

Bisin, A. and P. Gottardi (2006). Efficient Competitive Equilibria with Adverse Selection.
Journal of Political Economy 114 (3), 485–516.
Caballero, R. and A. Krishnamurthy (2001). International and Domestic Collateral Constraints in a Model of Emerging Market Crises. Journal of Monetary Economics 48 (3),
513–548.
Debreu, G. (1954). Valuation Equilibrium and Pareto Optimum. Proceedings of the National
Academy of Sciences of the United States of America 40 (7), 588.
Diamond, D. and P. Dybvig (1983). Bank Runs, Deposit Insurance, and Liquidity. The
Journal of Political Economy 91 (3), 401.
Farhi, E., M. Golosov, and A. Tsyvinski (2009, 07). A Theory of Liquidity and Regulation
of Financial Intermediation. Review of Economic Studies 76 (3), 973–992.
Farhi, E. and I. Werning (2013). On the Inefficiency of Financial Market Equilibria in
Macroeconomics Models with Nominal Rigidities. Technical report, Harvard Working
paper.
Geanakoplos, J. (2009). The Leaverage Cycles. Working Paper .
Geanakoplos, J. and H. Polemarchakis (1986). Existence, Regularity and Constrained Suboptimality of Competitive Allocations when the Asset Market is Incomplete. Uncertainty,
Information and Communication: Essays in Honor of KJ Arrow 3, 65–96.
Geanakoplos, J. and H. Polemarchakis (2008). Pareto improving taxes. Journal of Mathematical Economics 44 (7), 682–696.
Gorton, G. and A. Metrick (2012). Securitized banking and the run on repo. Journal of
Financial Economics 104 (3), 425–451.
Greenwald, B. and J. Stiglitz (1986). Externalities in Economies with Imperfect Information
and Incomplete Markets. Quarterly Journal of Economics 101 (2), 229–264.
Guerrieri, V., R. Shimer, and R. Wright (2010). Adverse selection in competitive search
equilibrium. Econometrica 78 (6), 1823–1862.
39

Hart, O. D. and L. Zingales (2113). Inefficient Provision of Liquidity. Technical report,
Working Paper.
Herings, P. J.-J. and H. Polemarchakis (2005). Pareto improving price regulation when the
asset market is incomplete. Economic Theory 25 (1), 135–154.
Hornstein, A. and E. C. Prescott (1993). The firm and the plant in general equilibrium
theory. General equilibrium, growth, and trade 2, 393–410.
Jacklin, C. (1987). Demand Deposits, Trading Restrictions, and Risk Sharing. Contractual
Arrangements for Intertemporal Trade, 26–47.
Jeanne, O. and A. Korinek (2010). Managing credit booms and busts: A pigouvian taxation
approach. Technical report, National Bureau of Economic Research.
Kilenthong, W. T. and R. M. Townsend (2011). Information-Constrained Optima with
Retrading: An Externality and its Market-Based Solution. Journal of economic theory 146 (3), 1042–1077.
Kilenthong, W. T. and R. M. Townsend (2014a). A Market Based Solution to Price Externalities: A Generalized Framework. Working Paper .
Kilenthong, W. T. and R. M. Townsend (2014b). Segregated Security Exchanges with Ex
Ante Rights to Trade. Working Paper .
Koopmans, T. C. and M. Beckmann (1957). Assignment problems and the location of
economic activities. Econometrica, 53–76.
Korinek, A. (2010). Regulating capital flows to emerging markets: An externality view.
Working Paper .
Krishnamurthy, A., S. Nagel, and D. Orlov (2012). Sizing up repo. Technical report, National
Bureau of Economic Research.
Lorenzoni, G. (2008). Inefficient Credit Booms. Review of Economic Studies 75 (3), 809–833.

40

McKenzie, L. W. (1959). On the existence of general equilibrium for a competitive market.
Econometrica: journal of the Econometric Society, 54–71.
McKenzie, L. W. (1981). The classical theorem on existence of competitive equilibrium.
Econometrica, 819–841.
Meade, J. E. (1952). External Economies and Diseconomies in a Competitive Situation. The
economic journal , 54–67.
Mortensen, D. T. and R. Wright (2002). Competitive pricing and efficiency in search equilibrium*. International Economic Review 43 (1), 1–20.
Negishi, T. (1960). Welfare Economics and Existence of an Equilibrium for a Competitive
Economy. Metroeconomica 12 (2-3), 92–97.
Prescott, E. C. and R. M. Townsend (1984a). General Competitive Analysis in an Economy
with Private Information. International Economic Review 25 (1), 1–20.
Prescott, E. C. and R. M. Townsend (1984b). Pareto Optima and Competitive Equilibria
with Adverse Selection and Moral Hazard. Econometrica 52 (1), 21–45.
Prescott, E. S. and R. M. Townsend (2006). Firms as Clubs in Walrasian Markets with
Private Information. Journal of Political Economy 114 (4), 644–671.
Sattinger, M. (1993). Assignment models of the distribution of earnings. Journal of economic
literature, 831–880.

A

Competitive Competitive Equilibrium and Constrained
Optimality for Prototypical Economies

A.1

Competitive Equilibrium and Constrained Optimality for the
Collateral Economy

We can now write an agent of type h’s utility maximization problem as follows:
41

Program 4.
h

max

h ,θ h ,θ h ,θ h ,θ h
y20
10 20 1s 2s

u

ch10 , ch20



+β

S
X

πs uh ch1s , ch2s



(101)

s=1

subject to the budget constraint:
2
X
k=1

h
Pk0 θk0

+

2 X
S
X

h
Pks θks
≤ 0,

(102)

k=1 s=1

the production constraints (3), the consumption-relationship constraints (18), and the collateral constraints at t = 0 (30), taking prices (Pk0 , Pks ) as given.
There is no need to explicitly write down the profit maximization for the representative
financial intermediary in this economy because there is no bundling in this economy, and
therefore net supply of each security must be zero, i.e., ψj = 0. As a result, the market
clearing constraints for securities are as follows:
X

h
αh θk0
= 0, for k = 1, 2,

(103)

h
αh θks
= 0, for k = 1, 2; s = 1, . . . , S.

(104)

h

X
h

Definition 5. A competitive collateral equilibrium is a specification of allocation ch , θh , yh



and prices (Pk0 , Pks ) such that

(i) for each h, ch , θh , yh solves the utility maximization problem, Program (4), taking
prices (Pk0 , Pks ) as given;
(ii) markets for securities clear; (103) and (104) hold.
To be more specific, we further assume that preferences are identically homothetic as in
Kilenthong and Townsend (2014b). The identically homothetic assumption gives us a strong,
special version of (59); namely it implies that if there were the spot price p̃s in this economy,
it would be a function of the aggregate (pre-trade but post storage/collateral decisions) ratio
of good 1 to good 2 in state s as follows:


P h h
α
e
1s
p̃s = p P αh heh −R
, ∀s
h
( 2s s y20
)
h
42

(105)

That is, the market fundamental in this case is the pretrade aggregate ratio of good 1 to
good 2. This functional relationship of the spot price plays a crucial role in generating
externalities in this economy, and it translates in the obvious way to security prices P, a
special version of (60), since trades of one good for the other in securities must clear, i.e.,


P h h
P2s
h α e1s
P1s , ∀s
(106)
= p̃s ⇒ P2s = p P αh eh −R yh
( 2s s 20 )
h
P1s
Crucially, these spot prices depend on agents’ choices of collateral collectively. If aggregate collateral were not endogenous (see, e.g., Araujo et al., 2012), there would have been no
price externalities in this model. This is because we have complete contracts in this model
in contrast to the exogenous incomplete markets structure as in, e.g., Geanakoplos (2009);
Greenwald and Stiglitz (1986).
The social planner’s problem in this economy is as follows:
Program 5.
max
h ,θ h ,θ h ,θ h ,θ h
(y20
10 20 1s 2s )h

X


u1 c110 , c120 + β
πs u1 c11s , c12s

(107)

s

subject to the participation constraints:
S
X


h
uh ch10 , ch20 + β
πs uh ch1s , ch2s ≥ U , for h = 2, . . . , H,

(108)

s=1

the production constraints (3), the consumption-relationship constraints (18), the collateral
constraints at t = 0 (30), the resource constraints (103)-(104), and the consistency constraints
(106).

A.2

Competitive Equilibrium and Constrained Optimality for the
Exogenous Incomplete Markets Economy

An individual maximization problem is as the following program:
Program 6.
max

h ,θ h ,θ h ,τ h ,τ h
θ10
20 j 1s 2s

X


πs uh ch1s , ch2s
uh ch10 , ch20 + β
s

43

(109)

subject to the budget constraints in the first period,
h
θ10

+

h
p0 θ20

+

J
X

Pj θjh ≤ 0,

(110)

j=1

the consumption-relationship constraints (19)-(21), and the obstacle-to-trade constraints
(31), taking prices (P20 , Pj , p̃s ) as given.
Similarly to the collateral economy, there is no need to explicitly write down the profit
maximization for the representative financial intermediary in this economy because there is
no bundling in this economy, and therefore net supply of each security must be zero, i.e.,
ψj = 0. As a result, the market clearing constraints for securities are as follows:
X

h
αh θk0
= 0, for k = 1, 2,

(111)

h

X

αh θjh = 0, for j = 1, . . . , J,

(112)

h
αh τ`s
= 0, for ` = 1, 2; s = 1, . . . , S.

(113)

h

X
h

Definition 6. A competitive equilibrium with exogenous security markets is a specification

of allocation ch , θh , τ h , yh and prices (P20 , Pj , p̃s ) such that

(i) for each h, ch , θh , τ h , yh solves the utility maximization problem, Program (6), taking
prices (P20 , Pj , p̃s ) as given;
(ii) markets for securities and for spot trades clear; (111)-(113) hold.
As in the general model, the social planner’s problem takes into account the fact that the
spot-market-clearing price in state s, p̃s , is a function of agents’ choices of ex-ante securities,
i.e.,
p̃s = p̃s (θ, e) , for s = 1, . . . , S,

(114)


where θ = θ1 , . . . , θH . These constitute the consistency constraints in this model. The
social planner’s problem in this economy is as follows:
Program 7.
max
h ,θ h ,θ h ,τ h ,τ h
(θ10
20 j 1s 2s )h

X


u1 c110 , c120 + β
πs u1 c11s , c12s
s

44

(115)

subject to the participation constraints,
X


h
uh ch10 , ch20 + β
πs uh ch1s , ch2s ≥ U , for h = 2, . . . , H,

(116)

s

the consumption-relationship constraints(19)-(21), and the obstacle-to-trade constraints (31),
the resource constraints (111)-(113), and the consistency constraints (114).
The obstacle-to-trade or spot-budget constraints (31) can cause an inefficiency in this
economy when the spot-market-clearing price in each state s is a function of agents’ choices
of ex-ante securities, i.e., p̃s = p̃s (θ, e), and the security markets are incomplete. As in
Geanakoplos and Polemarchakis (1986), the dependency generates an indirect price effect
from security reallocations because the spot-market-clearing price is a function of agents’
choices of securities. This indirect effect then produces an externality when the security
markets are incomplete. On the other hand, when the security markets are complete, these
indirect price effects are canceling each other out, and as a result, the competitive equilibrium
with exogenous security markets is (constrained) efficient as expected. This statement is
formally proved in the proposition below.
Proposition 1. The competitive equilibrium with exogenous security markets is (constrained)

efficient if and only if the equilibrium allocation ch , θh , τ h , yh is first-best optimal or the
spot price is independent of security positions, i.e.,

∂ p̃s
∂θjh

= 0 for every state s, every security

j and every agent of type h.
Proof. We begin the proof by deriving the necessary and sufficient conditions for the firstbest optimality. The social planner’s problem for the first-best optimality is as follows:
Program 8.
X


1
1
1
1
+β
πs u1 e11s + θ1s
, e12s + θ2s
max u1 e110 + θ10
, e120 + θ20
h ,θ h
(θi0
is )i,s,h
s

(117)

subject to the participation constraints and the resource constraints, respectively,
X


h
h
h
h
h
uh eh10 + θ10
, eh20 + θ20
+β
πs uh eh1s + θ1s
, eh2s + θ2s
≥ U , for h = 2, ..., H,
s

X
h

45

h
αh θis
= 0, for i = 1, 2; s = 0, 1, ..., S

Lemma 1. The necessary and sufficient conditions for the first-best optimality are as follows:
γuh uhi0
γuh̃ uh̃i0
=
, ∀h, h̃ = 1, ..., H; i = 1, 2
(118)
αh
αh̃
γuh βπs uhis
γuh̃ βπs uh̃is
, ∀h, h̃ = 1, ..., H; i = 1, 2, s = 1, ..., S,
(119)
=
αh
αh̃
where γuh is the Lagrange multipliers for the participation constraints for h (normalize by
setting γu1 = 1) and uhis =

∂uh
∂ch
is

is the marginal utility of an agent of type h with respect to cis .

We now consider the following social planner’s problem for the economy with exogenous
security markets.
Program 9.
max
h ,θ h ,θ h ,τ h ,τ h
(θ10
20 j 1s 2s )h

X


1
1
1
1
u1 e110 + θ10
, e120 + θ20
+β
πs u1 e11s + θs1 + τ1s
, e12s + τ2s

(120)

s

subject to the participation constraints, the resource constraints, and the obstacle-to-trade
constraints, respectively,
!
h
h
uh eh10 + θ10
, eh20 + θ20
+β



X
s

πs uh eh1s +

X

h
h
Djs θjh + τ1s
, eh2s + τ2s

h

(121)
H,
≥ U , for h = 2, ...,

j

X

h
αh θi0
= 0, for i = 1, 2, (122)

h

X

αh θjh = 0, for j = 1, ..., J,
(123)

h

X
h
τ1s

+ p̃s

h
αh τ1s
= 0, for s = 1, ..., S,
(124)

h
 h
1
θs , ..., θsH τ2s

= 0, for s, h.

(125)

h
Note that the resource (market-clearing) constraints for τ2s
are omitted due to Walras law.

A solution to this social planner’s problem is called a constrained optimal allocation.
h
h
h
h
The first order conditions for θ10
, θ20
, τ1s
, τ2s
, θjh are as follows:

γuh βπs uh10 + αh µθ10 = 0,

(126)

γuh βπs uh20 + αh µθ20 = 0,

(127)

γuh βπs uh1s + αh µτ1s + γsh = 0, ∀s = 1, ..., S,

(128)

γuh βπs uh2s + p̃s γsh = 0, ∀s = 1, ..., S,
X
X ∂ p̃s X
h̃
γuh β
πs uh1s Djs + αh µθj +
γsh̃ τ2s
= 0, ∀j = 1, ..., J,
h
∂θj
s
s

(129)

h̃

46

(130)

where γsh , γsh , µτs , µθj are the Lagrange multipliers for the obstacle to trade or spot-market
constraints in state s, for the participation constraints for h (normalize by setting γu1 = 1), for
h
, and for the resource constraints for θjh . Note that uhis =
the resource constraints for τ1s

∂uh
.
∂ch
is

The proof is divided into two parts as follows:
(i) (⇐) We now show that an allocation that satisfies the necessary and sufficient conditions for the first-best optimality (118)-(119) must satisfies the first order conditions
(126)-(130). It is not difficult to see that this will be the case if the externality term,
the last term of (130), is vanished, i.e.,
X ∂ p̃s X
h̃
γsh̃ τ2s
=0
h
∂θ
j
s

(131)

h̃

It is obvious that if the spot price is independent of security positions, i.e.,

∂ p̃s
∂θjh

= 0 for

every state s, every security j and every agent of type h, then condition (131) holds.
We now need to show that if the constrained optimal allocation is first-best optimal,
then the no-externality condition (131) must hold. Since the allocation is first- best
 h̃ 
optimal, it must satisfies conditions (118) and (119), which imply that αγsh̃ must be
constant across agents, i..e, for each s
γsh̃
γsh
=
= Γs , ∀h, h̃.
αh
αh̃

(132)

Using these conditions, we can then show that
!
X ∂ p̃s X
X ∂ p̃s X γ h̃
s
h̃
h̃
=
γsh̃ τ2s
αh̃ τ2s
h
h
h̃
∂θ
∂θ
α
j
j
s
s
h̃
h̃
X ∂ p̃s X
X ∂ p̃s X
h̃ h̃
h̃
=
Γ
Γ
α
τ
=
αh̃ τ2s
= 0,
s
2s
h
h s
∂θj
∂θj
s
s
h̃

(133)
(134)

h̃

h
where the last equation results from the resource constraints for τ2s
. This proves

that the no-externality condition (131) holds. To sum up, we prove that there is no
externality if the constrained optimal allocation is first-best optimal or the spot price
is independent of security positions, i.e.,

∂ p̃s
∂θjh

every agent of type h.

47

= 0 for every state s, every security j and

(ii) (⇒) Unfortunately, we cannot generally prove the reversed statement but, as shown
in Geanakoplos and Polemarchakis (1986), it is true generically (it is true except for
some unlikely cases). The key idea is that the indirect price effects could be canceling
each other out only if the equilibrium allocation is first-best optimal in most cases.
But this does not happen generally.

A.3

Competitive Equilibrium and Constrained Optimality for the
Moral Hazard with Retrading Economy

An individual problem can be written as a two-step problem. The first step is to maximizing
utility subject to budget, consumption relationship, and production constraints, conditional
on taken action a and incentive compatibility constraints which make that the actual action
coincides with the recommended action, a0 = a, as follow:
Program 10.
X

max
a,θk (q,a)

π(q|a)u (c1 (q, a), c2 (q, a), a)

(135)

q

subject to the budget constraints
XX
q

Pk (q, a)θk (q, a) ≤ 0, ∀a,

(136)

k

the production constraints (7), the consumption-relationship constraints (22), and the incentive compatibility constraints (34), taking as given the security prices Pk (q, a) and the
spot price p̃ along the equilibrium path a = a0 .
There is a representative financial intermediary who chooses net supply of securities
ψ = [ψk (q, a)]q,k,a to maximize profit
max

XXX

ψ

q

k

Pk (q, a)f (q|a) ψk (q, a)

(137)

a

subject to feasibility constraints
X

f (q|a) ψk (q, a) = 0, ∀a; k = 1, 2.

q

48

(138)

That is, there are M = 2A conditions in (138) and the security weight matrix is a 2 × 2QAdimensional matrix Ψ = I2A ⊗ 1Q , where I2A is the identity matrix with dimension 2A, 1Q is
the row of ones with dimension Q, and ⊗ is the Kronecker product operator. Similarly, the
eligibility weights ξj = ξk (q, a) = f (q|a). Note that j is indexed by (q, k, a)10
The existence of a maximum to the problem requires that
Pk (q, a) = µk (a), ∀q; a; k = 1, 2,

(139)

where µk (a) is the Lagrange multiplier with respect to the feasibility constraint (138) for a
bundle (k, a). This clearly implies zero profit for each financial intermediary, and therefore
there is no loss of generality to assume there is one representative financial intermediary for
each a.
The market clearing conditions for securities are as follows:
θk (q, a) = ψk (q, a), ∀q, a; k = 1, 2.

(140)

Substituting the market clearing conditions (140) into the (binding) feasibility constraints
10

A typical vector of securities is
ψ = (ψ1 (q1 , a1 ) , . . . , ψ1 (qQ , a1 ) , . . . , ψ1 (qQ , aA ) , ψ2 (q1 , a1 ) , . . . , ψ2 (qQ , aA )) .

For example, with A = {a1 , a2 } and Q = (q1 , q2 ), the dimension of the vector of securities is J = 2QA = 8;
that is,
ψ = (ψ1 (q1 , a1 ) , ψ1 (q2 , a1 ) , ψ1 (q1 , a2 ) , ψ1 (q2 , a2 ) , ψ2 (q1 , a1 ) , ψ2 (q2 , a1 ) , ψ2 (q1 , a2 ) , ψ2 (q2 , a2 )) .
Accordingly, the eligibility weights are
ξ = (f (q1 |a1 ) , f (q2 |a1 ) , f (q1 |a2 ) , f (q2 |a2 ) , f (q1 |a1 ) , f (q2 |a1 ) , f (q1 |a2 ) , f (q2 |a2 )) .
The security weight matrix in this case is as follows:

1 1


 0 0
Ψ4×8 = I4 ⊗ 12 = 

 0 0

0 0

0

0

0

0

0

1

1

0

0

0

0

0

1

1

0

0

0

0

0

1

49

0





0 
.

0 

1

(138) gives the following resource constraints.
X

f (q|a)θk (q, a) = 0, ∀a; k = 1, 2.

(141)

q

Definition 7. A competitive equilibrium with moral hazard and retrading is a specification
of allocation (c, θ, a) for households and ψ for intermediaries, and prices (p̃, P) such that
(i) for each household, (c, θ, a) solves the utility maximization problem, Program (10),
taking prices (p̃, P) as given;
(ii) for the financial intermediary a, ψ solves (137) subject to (138), taking prices P as
given;
(iii) markets for securities clear; (140) hold.
As in the general model, the social planner’s problem takes into account the fact that the
spot-market-clearing price p̃ depends on the choice of contracts θa = [θk (q, a)]k,q and actual
action a; that is, p̃ = p̃ (θa , a). Recall that the spot price p̃ clears the spot markets; that is,
X

δ (a) f (q|a) τk (q, a) = 0,

(142)

q,a

where τk (q, a) be equilibrium spot trade of an agent of ex-post type (q, a), which is the
solution to problem when a is both the recommended and taken action. We do not include
these conditions as resource constraints since they are redundant as discussed earlier in
Section 2.2.3.
The resource constraints are as follows:
X

f (q|a)θk (q, a) ≤ 0, ∀a; k = 1, 2.

(143)

q

Note that the planner also takes into account that the choice of contracts must be consistent with actual action on the equilibrium path; that is, θk (q, a) depends on recommended
and actual action a. To sum up, the consistency constraint is as follows:
p̃ = p̃ (θa , a) .

(144)

The social planner’s problem is to choose contracts that solves the following program.
50

Program 11.
max

X

a,θk (q,a)

π(q|a)u (c1 (q), c2 (q), a)

(145)

q

subject to the production constraints (7), the consumption-relationship constraints (22), the
incentive compatibility constraints (34), the resource constraints (143), and the consistency
constraints (144).

A.4

Competitive Equilibrium and Constrained Optimality for the
Liquidity Constrained Economy

An individual maximization problem for an agent type h = b, d is as the following program:
Program 12.
max
(f0h ,lh ,τbh ,τdh ,τfht )

w3h

+

δbh bh

+ 1−

δdh



2
lh
d −
2
h

(146)

subject to the production constraints (12)-(15), the consumption-relationship constraints
(23)-(26), and the obstacle-to-trade constraints (36)-(37), taking prices (pb , pd ) as given.
Similarly to the collateral economy, there is no need to explicitly write down the profit
maximization for the representative financial intermediary in this economy because there is
no bundling in this economy.
The market clearing constraints for spot trades are as follows:
X

αh τ`h = 0, for ` = f 1, f 2, b, d.

(147)

h

Definition 8. A competitive equilibrium with liquidity constraints is a specification of al
location f0h , lh , τbh , τdh , τfht , bh , dh , w3h , y and prices (p̃b , p̃d ) such that

(i) for each h, f0h , lh , τbh , τdh , τfht solves the utility maximization problem, Program (12),
taking prices (p̃b , p̃d ) as given;
(ii) markets for spot trades clear; (147) hold.

51

As in the general model, the social planner’s problem takes into account the fact that
the spot-market-clearing prices p̃b and p̃d are functions of agents’ choices of storage in period


t = 0 and t = 1, respectively, i.e., p̃b = pb f0b , f0d and p̃d = pd f1b , f1d . For example, in Hart
1

3

and Zingales (2113), p̃b = f 2 and p̃d = f 4 , where f0b = 0 and f0d = f . These constitute the
consistency constraints in this model as follows:
p̃b = pb f0b , f0d



(148)


d

(149)

p̃d = pd f1b , f1

The social planner’s problem in this economy is as follows:
Program 13.

b 2
l
max
w3b + db −
h
h
h
h
h
2
(f0 ,l ,τb ,τd ,τf t )h

(150)

subject to the production constraints (12)-(15), the consumption-relationship constraints
(23)-(26), and the obstacle-to-trade constraints (36)-(37), and the consistency constraints
(148)-(149).

B

More Prototypical Economies

B.1

Fire Sales Economy (Lorenzoni, 2008)

B.1.1

Basic Ingredients for the Fire Sales Economy

Consider an economy with three periods, t = 0, 1, 2. There are two states, s = 1, 2, realized
in period t = 1, with probability π1 and π2 , respectively. We use histories of these states
to define states in period t = 2; that is, if the state s = 1 is realized in period t = 1,
then the state in period t = 2 will automatically be s = 1. Therefore, there are two states
s = 1, 2 in the last period t = 2. There are two types of agents, called “consumers” and
“entrepreneurs”, each of which consists of equal mass. A consumer receives an endowment
of e units of consumption goods in each period while an entrepreneur is endowed with n
units of consumption goods in the first period t = 0 only.
52

There are L = 8 commodities in this model, i.e., two physical goods, namely consumption
and capital goods, in period t = 0, two physical goods, namely consumption and capital
goods, at each state s = 1, 2 in period t = 1, and one physical good, namely consumption
good, at each state s = 1, 2 in period t = 2.
The preferences of a consumer is represented by
U c (c) = E [cc0 + cc1 + cc2 ] = cc0 +

X

πs (cc1s + cc2s ) ,

(151)

s=1,2

where superscript “c” stands for consumer, cc0 is the consumer’s consumption in period 0,
and ccts is the consumer’s consumption at state s = 1, 2 in period t = 1, 2. The preferences
of an entrepreneur is represented by
U e (c) = E [ce2 ] =

X

πs ce2s ,

(152)

s=1,2

where superscript “e” stands for entrepreneur, ce2s is the entrepreneur’s consumption at state
s = 1, 2 in period t = 2.
h
The following production functions, and inputs/outputs are generally written as F`ts
,
h
and y`ts
, where h = c, e denotes an agent type, ` = c, i, k, n, o, p, r denotes an input/output

type of commodities (“c” stands for consumption goods, “i” stands for input for new capital
production, “k” stands for capital input, “n” stands for new capital, “o” stands for old
capital, “r” stands for repairing input for capital maintenance) or a constraint type (“p”
stands for weakly positive constraints), t = 0, 1, 2 denotes a period, and s = 0, 1, 2 denotes
a state with state s = 0 for period t = 0.
Each entrepreneur can turn a unit of consumption good into a unit of (new) capital good
at any period and any state of nature. This constitutes the first set of production functions:
e
e
e
e
e
, yi00
) = yn00
+ yi00
= 0,
Fn00
(yn00

(153)

e
e
e
e
e
Fn1s
(yn1s
, yi1s
) = yn1s
+ yi1s
= 0, ∀s = 1, 2,

(154)

e
e
e
e
where yn00
∈ R+ (yi00
∈ R− ) and yn1s
∈ R+ (yi1s
∈ R− ) are the outputs in unit of capital

goods (inputs in unit of consumption goods) in period t = 0, and at state s in period t = 1,
respectively. These specifications with profit maximization limit the price of capital not
to be larger than 1 at any point in time. On the other hand, the capital investment is
53

irreversible; that is, it is not feasible to directly turn a capital good into consumption goods.
This irreversibility leads to fire sales, which can cause the price of capital to be significantly
below one.
In addition, each entrepreneur has access to an entrepreneurial production technology,
e
e
which transforms yn00
units of the capital goods in period t = 0 into as yn00
units of the

consumption goods in period t = 1, where s = 1, 2 is the aggregate state. This technology
can be represented by the following production function:
e
e
e
e
e
Fc1s
(yc1s
, yn00
) = yc1s
− as yn00
= 0, ∀s = 1, 2,

(155)

e
is the output in unit of consumption goods at state s = 1, 2 in period t = 1.
where yc1s

The capital must be repaired at the cost γ > 0 units of consumption goods at state
s = 1, 2 in period t = 1 per unit of capital chosen to be repaired. Non-repaired part
will be fully depreciated. This maintenance technology can be represented by the following
production function:
e
e
e
e
e
Fr1s
(yo1s
, yr1s
) = γyo1s
+ yr1s
= 0, ∀s = 1, 2,

(156)

e
∈ R+ is the output in unit of (old) capital goods at state s in period t = 1
where yo1s
e
∈ R− is the input in unit of consumption goods for
from this maintenance process, and yr1s

the maintenance process. The production technology also requires that old repaired capital
cannot be larger (in absolute value) than the original capital from period t = 0, i.e.,
e
e
e
e
e
Fp1s
(yo1s
, yr1s
) = yo1s
+ yr1s
≥ 0, ∀s = 1, 2.

(157)

e
Further, an entrepreneur can use all capital available in period t = 1, yk1s
, to produce
e
Ayk1s
units of consumption goods in period t = 2, with A > 1. This technology can be

represented by the following production function:
e
e
e
e
e
, yk1s
) = yc2s
− Ayk1s
= 0, ∀s = 1, 2,
Fc2s
(yc2s

(158)

e
where yc2s
is the output in unit of consumption goods at state s = 1, 2 in period t = 1.

Each consumer owns a traditional production technology, which produces consumption
c
goods in period t = 2 using capital goods in period t = 1, yk1s
, as the input. The tradic
tional technology is represented by the production function f (yk1s
), which is assumed to

54

be increasing, strictly concave, twice differentiable, and satisfies the following properties
c
) ≥ q̄. Strict concavity and f 0 (0) = 1 assumptions imply that
f (0) = 0, f 0 (0) = 1, f 0 (y1s

consumers would not produced (new) capital using technology (153)-(154) even if they were
be able to do so. They will own capital only when there is fire sales, under which the price
of capital wold be below one. The capital good is fully depreciated at the end of the last
period t = 2. This traditional technology can be represented by the following production
function:
c
c
c
c
c
Fc2s
(yc2s
, yk1s
) = yc2s
− f (yk1s
) = 0, ∀s = 1, 2,

(159)

c
is the output in unit of consumption goods in period t = 2.
where yc2s

To sum up, there are O = 13 production functions in this model.
B.1.2

Market Structure the Fire Sales Economy

h
Let θ0h and θts
denote securities paying in unit of consumption goods in period t = 0, and

securities paying in consumption goods at state s = 1, 2 in period t = 1, 2 acquired by an
agent type h = c, e, respectively. There are J = 5 securities. Let Pts denote the security
price of a security paying in consumption goods at state s = 1, 2 in period t = 1, 2, and
P0 = 1 the price of the security paying in unit of consumption goods in period t = 0, which
is the numeraire good.
There are also spot markets at each state s = 1, 2 in period t = 1. There are Ls = 2
commodities in each spot markets. We set the spot-market-clearing price of good 1 equal to
one (the numeraire good), and let ps denote the spot-market-clearing price of good 2. As in
Lorenzoni (2008), the market clearing conditions for the spot markets in each state s (for
h
h
τks
and τcs
) imply that the spot price p̃s is determined by capital input for the traditional
c
c
technology yk1s
, i.e., p̃s = f 0 (yk1s
).

55

The consumption-relationship functions for consumers and entrepreneurs are given by
c
gc0
(e, θ0c , cc0 ) = e + θ0c − cc0 = 0,

(160)

c
c
c
c
c
gc1s
(e, θ1s
, τcs
, cc1s ) = e + θ1s
+ τcs
− cc1s = 0, ∀s = 1, 2,

(161)

c
c
c
c
c
gc2s
(e, θ2s
, yc2s
, cc2s ) = e + θ2s
+ yc2s
− cc2s = 0, ∀s = 1, 2,

(162)

c
c
c
c
c
gks
(τks
, yk1s
) = τks
− yk1s
= 0, ∀s = 1, 2,
e
e
e
gc0
(n, θ0c , yi00
) = n + θ0c − yi00
= 0,
e
e
e
e
e
e
e
e
e
e
e
gc1s
(θ1s
, τcs
, yc1s
, yr1s
, yi1s
) = θ1s
+ τcs
+ yc1s
+ yr1s
+ yi1s
= 0, ∀s = 1, 2,
e
e
e
e
e
e
e
e
e
= 0, ∀s = 1, 2,
− yk1s
+ τks
+ yo1s
) = yn1s
, yk1s
, τks
, yo1s
(yn1s
gks
e
e
e
e
e
gc2s
(yc2s
, θ2s
, ce2s ) = yc2s
+ θ2s
− ce2s = 0, ∀s = 1, 2,

(163)
(164)
(165)
(166)
(167)

where a function with superscript “c” (“e”) is a consumption-relationship function for consumers (for entrepreneurs). There are N = 14 consumption-relationship conditions.
B.1.3

Trade Frictions for the Fire Sales Economy

Each consumer faces the following sets of obstacle-to-trade constraints. First, the participation constraint for a consumer is given by
c
c
c
Cpc
(θ0c , θ1s
, θ2s
) = θ0c +

X

c
c
πs (θ1s
+ θ2s
) ≥ 0.

(168)

s

This constraint states that a consumer would not enter the contract at period t = 0 and
would be at autarky unless the contract offers a non-negative expected return from t = 0 to
t = 2. Second, the no-default conditions for a consumer are as follows:
c
c
c
c
c
Ccd1
(θ1s
, θ2s
) = θ1s
+ θ2s
≥ 0, ∀s = 1, 2,
c
c
c
) = θ2s
≥ 0, ∀s = 1, 2.
Ccd2
(θ2s

(169)
(170)

c
These constraints imply that a consumer would default (not pay when θts
< 0) at state

s = 1, 2 in period t = 1, 2 unless the return from that period on is non-negative.
Each entrepreneur faces the following obstacle-to-trade constraints or no-default conditions:
e
e
e
e
e
e
e
Ced1
(yn00
, θ1s
, θ2s
, p̃s ) = (ηas + max {p̃s − γ, 0}) yn00
+ θ1s
+ θ2s
≥ 0, ∀s = 1, 2, (171)
e
e
e
e
e
+ θ2s
≥ 0, ∀s = 1, 2,
Ced2
(yk1s
, θ2s
) = ηAyk1s

56

(172)

where 1 − η ∈ (0, 1) is the fraction of the firm’s current profit that the entrepreneur could
keep if he decided to default. Constraints (171) imply that the entrepreneur is better off not
e
if he
defaulting at state s = 1, 2 in period t = 1. In particular, he would get (1 − η) as yn00
e
e
e
defaulted. On the other hand, his net income would be (as + max {p̃s − γ, 0}) yn00
+ θ1s
+ θ2s

in case of no default. Similarly, constraints (172) imply that net income of the entrepreneur
e
e
, is larger than his net
+ θ2s
at state s = 1, 2 in period t = 2 in case of no default, Ayk1s
e
.
income in case of default, (1 − η) Ayk1s

In addition, both agent types also face the following spot market budget constraints:
h
h
h
Cspot
τcs
, τks
, p̃s



h
h
= τcs
+ p̃s τks
= 0, ∀h = c, e; s = 1, 2,

(173)

To be consistent with the general model, there are I = 11 sets of obstacle-to-trade
constraints, each of which contains only one constraint, i.e., A = 1. Therefore, there are
M = 11 obstacle-to-trade constraints in total.
It is worthy of emphasis that the spot market budget constraints (173) are not the
sources of the externality here because this model has a complete contingent contracting
structure. See a similar result in Proposition 1. On the other hand, the key obstacleto-trade constraints that cause an inefficiency in this model is the first set of no-default
conditions for an entrepreneur (171), which again depends on equilibrium prices which in
turn are determined by collective ex-ante choices of the agents.
B.1.4

Competitive Equilibrium and Constrained Optimality for the Fire Sales
Economy

A consumer’s maximization problem is as follows:
Program 14.
max
c
c

c
θ0c ,θts ,τcs ,τks

cc0 +

X

πs (cc1s + cc2s )

(174)

s=1,2

subject to the budget constraints
θ0c +

X

c
Pts θts
≤ 0,

s,t

57

(175)

the production constraints (159), the consumption-relationship constraints (160)-(163), and
the obstacle-to-trade constraints (168)-(170), (173), taking prices (Pts , p̃s ) as given.
Similarly, the entrepreneur’s maximization problem is given by
Program 15.
X

max
e
n

e ,τ e ,τ ,y ,y n ,y o
θ0e ,θts
cs ks i0 i1s i1s

πs ce2s

(176)

s=1,2

subject to the budget constraints
θ0e +

X

e
Pts θts
≤ 0,

(177)

s,t

the production constraints (153)-(158), the consumption-relationship constraints (164)-(167),
and the obstacle-to-trade constraints (171)-(172), (173), taking prices (Pts , p̃s ) as given.
Similarly to the collateral economy, there is no need to explicitly write down the profit
maximization for the representative financial intermediary in this economy because there is
no bundling in this economy.
The market clearing constraints for securities, and spot trades are as follows:
θ0c + θ0e = 0,

(178)

c
e
θts
+ θts
= 0, ∀t = 1, 2; s = 1, 2,

(179)

c
e
τcs
+ τcs
= 0, ∀s = 1, 2,

(180)

c
e
τks
+ τks
= 0, ∀s = 1, 2.

(181)

Definition 9. A competitive equilibrium with fire sales is a specification of allocation

ch , θh , τ h , yh h=c,e and prices (Pts , p̃s ) such that
(i) for each consumer c, (cc , θc , τ c , yc ) solves the utility maximization problem, Program
(14), taking prices (Pts , p̃s ) as given;
(ii) for each entrepreneur e, (ce , θe , τ e , ye ) solves the utility maximization problem, Program (15), taking prices (Pts , p̃s ) as given;
(iii) markets for securities and spot trades clear; (178)-(181) hold.
58

As in the general model, the social planner’s problem takes into account the fact that
c
,
the spot-market-clearing prices p̃s = f 0 (ysc ) is a function of agents’ choices of capital y1s
e
. We can
which in turn depends on entrepreneur’s choices in period 0 including y0e and θ1s

now write
e
p̃s = ps (y0e , θ1s
) , ∀s = 1, 2.

(182)

These constitute the consistency constraints in this model.
The social planner’s problem in this economy is as follows:
Program 16.
max
c
c

c
θ0c ,θts ,τcs ,τks

cc0 +

X

πs (cc1s + cc2s )

(183)

s=1,2

subject to the production constraints (153)-(159), the consumption-relationship constraints
(160)-(167), and the obstacle-to-trade constraints (168)-(173), and the consistency constraints (182).

B.2

Hidden Information with Retrading (Diamond and Dybvig,
1983; Jacklin, 1987)

B.2.1

Basic Ingredients for the Hidden Information with Retrading Economy

This is an economy with unobserved states or preference/liquidity shocks and retrading possibilities (e.g., Allen and Gale, 2004; Diamond and Dybvig, 1983; Farhi et al., 2009; Jacklin,
1987). Similar to the moral hazard problem, if there were no retrading possibility, then
the Prescott-Townsend equilibria would have been equivalent to Pareto optima. However,
this liquidity problem features externalities when agents can trade in spot/private markets
ex-post creating the interaction of binding incentive constraints and the spot prices. As in
Prescott and Townsend (1984b) and Farhi et al. (2009), we focus only on incentive compatible
allocations (rather than sequential service constraints and no bank runs).
There is a continuum of ex-ante identical agents with total mass 1, i.e., no diversity
in types so trivially α1 = 1. There are three periods, t = 0, 1, 2. There is one physical

59

commodity in each period t = 1, 2. Each agent is endowed with e units of the good in the
contracting period, t = 0, and this will be an input into production functions.
Let η be a ex-post preference/liquidity shock which defines a (idiosyncratic) state in this
model. There is no loss of generality to assume that there are a finite Q states, η ∈ Q. The
shock/state is drawn at t = 1 with π (η) as the probability that an agent will receive η shock
such that
Q
X

π (η) = 1.

(184)

η=1

In this sense there is ex-post diversity. Henceforth, we represent an ex-post type of an agent
by his shock η. The fraction of agents of ex-post type ω = η is ζ 1 (ω) = π (η). With a
continuum of agents, we also interpret π (η) as the fraction of agents receiving η shock.
To sum up, each state η has two dated commodities; that is, the physical good in period
t = 1 or good 1, and the physical good in period t = 2 or good 2. In addition, an investment
decision at t = 0, ρ, is also a commodity. Therefore, there are L = 2Q + 1 commodities in
this model.
The utility function conditional on a shock η is given by u (c1 , c2 , η), where (c1 , c2 ) is the
vector of consumption allocations in period t = 1 and t = 2, respectively. For example, in
the Diamond-Dybvig model, the shock will dictate if an agent would like to consume now or
later. The utility function is assumed to be differentiable, concave, increasing in c1 and c2 ,
and satisfies the usual Inada conditions with respect to c1 and c2 . The discounted expected
utility of an agent is define by:
U (c) =

X

π (η) u (c1 (η) , c2 (η) , η) .

(185)

η

Following the literature, there are two technologies or assets. First, the short-term asset
is a storage technology, whose return from t to t + 1 is R1 , i.e., saving one unit of the good
today at t will return R1 units of the good in the next period at t + 1, t = 0, 1. The second
asset is the long-term asset. The long-term investment must be taken at t = 0, and its return
R2 will be realized at t = 2. We assume that the long-term asset is more productive than
the short-term asset, i..e, R2 > R1 . For simplicity, returns here are deterministic, i.e., no
aggregate shocks.
60

There is no loss of generality to assume that an agent must decide how much to invest
in the short-term and the long-term assets at the beginning t = 0. Let ρ be the fraction of
initial endowment invested in the short-term asset; that is, ρe is the total amount invested
in the short-term asset, and (1 − ρ) e is the total amount invested in the long-term asset. In
addition, we assume that there is no option to liquidate at t = 1, and there is no short term
investment between t = 1 and t = 2 without loss of generality11 . The production functions
of short-term asset, F1 (between t = 0 and t = 1), and long-term asset F2 (between t = 0
and t = 2) are as follows:
F1 (ρe, y1 ) = y1 − R1 ρe = 0,

(186)

F2 ((1 − ρ) e, y2 ) = y2 − R2 (1 − ρ) e = 0,

(187)

where yt is an output in unit of the physical good in period t = 1, 2 regardless of the state of
nature. Note however that outputs do not really vary with the preference/liquidity shocks
since the shocks η are liquidity, not productivity shocks and the distribution of shocks in the
population is constant. To sum up, there are O = 2 production functions.
B.2.2

Market Structure the Hidden Information with Retrading Economy

To be consistent with the general model, one can imagine that there are state-contingent
securities θt (η 0 ) paying the single good at t = 1, 2 conditional on reported shock/state η 0 ∈ Q.
That is, security j is indexed by t and η 0 . There are J = 2Q (the number of states times the
number of dates) securities available.
There is the possibility of retrade in ex post spot markets as in the moral hazard with
retrading economy above. Without aggregate uncertainty, there is only one set of spot
markets (S = 1) for good 1 and good 2 (Ls = 2), in which everyone participates. Let
τt (η) be spot trade of an agent of ex-post type η when η is both truthfully reported and
realized shock. We set the spot-market-clearing price of good 1 equal to one (the numeraire
good), and let p̃ denote the spot-market-clearing price of good 2, which depends on securities
11

This economy is equivalent to the one in Diamond and Dybvig (1983) where banks invest in the long-term

asset only, and then liquidate a fraction of the projects at t = 1. In Allen and Gale (2004) with stochastic
returns, some short term investment may be necessary at t = 1.

61

θ = [θt (η)]t,η and investment decision ρ; that is, p̃ = p̃ (θ, ρ).
As in the moral hazard with retrading economy, the spot markets are redundant (with
complete contracts), however. Anything that can be done with spot markets can be done
without them with altered security holdings. Therefore, we can omit spot trades, henceforth,
though there is still an implicit shadow spot price. The consumption-relationship in this case
is defined as follows:
gtη0 = yt + θt (η 0 ) − ct (η 0 ) = 0, ∀η 0 ; t = 1, 2.

(188)

There are N = 2Q consumption-relationship constraints.
B.2.3

Trade Frictions for the Hidden Information with Retrading Economy

With abuse of notation, we refer to (c1 (η 0 ), c2 (η 0 )) as pre-trade compensation condition on
reported state/shock. Thus, the ex-post utility maximization problem at t = 1 of an agent
who reported state η 0 , realized state η, and received compensation (c1 (η 0 ), c2 (η 0 )) is as follows:
v (c1 (η 0 ) , c2 (η 0 ) , η, p̃) = max u (c1 (η 0 ) + τ1 , c2 (η 0 ) + τ2 , η)
τ1 ,τ2

(189)

subject to the budget constraint:
τ1 + p̃τ2 = 0,

(190)

taking spot price (interest rate) p̃ as given.
In addition, the possibility of retrade in ex post spot markets and the hidden information
problem imply that an incentive compatibility (IC) or obstacle-to-trade constraint:
C1,η,η0 (c, p̃) = u (c1 (η) , c2 (η) , η) − v (c1 (η 0 ) , c2 (η 0 ) , η, p̃) ≥ 0, ∀η, η 0 .

(191)

There are I = Q2 constraints for each i, and therefore with only one i, there are M = Q2
obstacle-to-trade constraints in total. This will be imposed so actual and reported states
will be the same.
B.2.4

Competitive Equilibrium and Constrained Optimality for the Hidden Information with Retrading Economy

An individual problem is as follows:
62

Program 17.
X

max
ρ,θt (η)

π (η) u (c1 (η) , c2 (η) , η)

(192)

η

subject to the budget constraints
XX
η

Pt (η)θt (η) ≤ 0,

(193)

t

the production constraints (186)-(187), consumption-relationship constraints (188), and the
incentive compatibility constraints (191), taking as given the spot price p̃ along the equilibrium path η 0 = η.
The representative financial intermediary, dealing with all those reported states/shocks
η, chooses net supply of securities ψ = (ψt (η))t,η to maximize profit as follows:

ψ

XX

Pt (η)π(η)ψt (η)

(194)

π(η)ψt (η) = 0, ∀t = 1, 2.

(195)

max

η

t

subject to feasibility constraints
X
η

That is, there are M = 2 conditions for the financial intermediary, and the security weight is
a 2 × 2Q-dimensional matrix Ψ = I2 ⊗ 1Q , where I2 is the identity matrix with dimension 2,
1Q is the row of ones with dimension Q, and ⊗ is the Kronecker product operator. Similarly,
the eligibility weights ξj = ξtη = π (η) , ∀η; t = 1, 2, where again j is indexed by (t, η)12 .
The existence of a maximum to the problem requires that
Pt (η) = µt , ∀η; t = 1, 2,
12

(196)

A typical vector of securities is ψ = (ψ1 (η1 ) , . . . , ψ1 (ηQ ) , ψ2 (η1 ) , . . . , ψ2 (ηQ )).

For example,

with Q = (η1 , η2 ), the dimension of the vector of securities is J = 2Q = 4; that is, ψ =
(ψ1 (η1 ) , ψ1 (η2 ) , ψ2 (η1 ) , ψ2 (η2 )). Accordingly, the eligibility weights are ξ = (π (η1 ) , π (η2 ) , π (η1 ) , π (η2 )).
The security weight matrix in this case is as follows:

Ψ2×4 = I2 ⊗ 12 = 

1

1

0

0

0

0

1

1

63


.

where µt is the Lagrange multiplier with respect to the tth feasibility constraint (195). This
clearly implies zero profit for the financial intermediary, and therefore there is no loss of
generality as earlier to assume there is one representative financial intermediary.
The market clearing conditions are as follows:
θt (η) = ψt (η), ∀η; t = 1, 2.

(197)

Substituting the market clearing conditions (197) into the (binding) feasibility constraints
(195) gives the following resource constraints.
X

π (η) θt (η) = 0, ∀t = 1, 2.

(198)

η

Definition 10. A competitive equilibrium with moral hazard and retrading is a specification
of allocation (c, θ, ρ) for households and ψ for intermediaries, and prices (p̃, P) such that
(i) for each household, (c, θ, ρ) solves the utility maximization problem, Program (17),
taking prices (p̃, P) as given;
(ii) for the financial intermediary, ψ solves (194) subject to (195), taking prices P as given;
(iii) markets for securities clear; (197) hold.
As in the general model, the social planner’s problem takes into account the fact that
the spot-market price p̃ depends on the choice of contracts θ = [θt (η)]t,η and the choice of
investment ρ; that is, p̃ = p̃ (θ, ρ). Recall that the spot price p̃ clears the spot markets; that
is,
X

π (η) τt (η) = 0, ∀t = 1, 2,

(199)

η

where τt (η) be equilibrium spot trade of an agent of ex-post type η, which is the solution
to the utility maximization problem (189) when η is both truthfully reported and realized
shock. We do not include these conditions as resource constraints since they are redundant
as discussed earlier in Section B.2.2.
The resource constraints are as follows:
X

π (η) θt (η) = 0, ∀t = 1, 2.

η

64

(200)

Note that the planner also takes into account that the choice of contracts must be consistent with actual state on the equilibrium path; that is, θt (η) depends on (truthfully reported
and realized) state. To sum up, the consistency constraint is as the following:
p̃ = p̃ (θ, ρ) .

(201)

The social planner’s problem is to choose contracts that solves the following program.
Program 18.
max
ρ,θt (η)

X

π (η) u (c1 (η) , c2 (η) , η)

(202)

η

subject to the production constraints (186)-(187), consumption-relationship constraints (188),
the incentive compatibility constraints (191), the resource constraints (200), and the consistency constraints (201).

65

