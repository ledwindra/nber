NBER WORKING PAPER SERIES

FOUNDATIONS OF WELFARE ECONOMICS AND PRODUCT MARKET APPLICATIONS
Daniel McFadden
Working Paper 23535
http://www.nber.org/papers/w23535

NATIONAL BUREAU OF ECONOMIC RESEARCH
1050 Massachusetts Avenue
Cambridge, MA 02138
June 2017

I am indebted to Kenneth Train, Professor of Economics, University of California, Berkeley, who
made major contributions to the contents of this paper, including the welfare calculus formulas
given in Sections 5 and 7, the application given in Section 8, and Appendix C. I also thank Moshe
Ben-Akiva, Andrew Daly, Mogens Fosgerau, Garrett Glasgow, Stephane Hess, Armando Levy,
Douglas MacNair, Charles Manski, Rosa Matzkin, Kevin Murphy, Frank Pinter, Joan Walker,
and Ken Wise for useful suggestions and comments. The views expressed herein are those of the
author and do not necessarily reflect the views of the National Bureau of Economic Research.
The author has disclosed a financial relationship of potential relevance for this research. Further
information is available online at http://www.nber.org/papers/w23535.ack
NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.
Â© 2017 by Daniel McFadden. All rights reserved. Short sections of text, not to exceed two
paragraphs, may be quoted without explicit permission provided that full credit, including Â©
notice, is given to the source.

Foundations of Welfare Economics and Product Market Applications
Daniel McFadden
NBER Working Paper No. 23535
June 2017
JEL No. D11,D12,D60,D61,K13,L51
ABSTRACT
A common problem in applied economics is to determine the impact on consumers of changes in
prices and attributes of marketed products as a consequence of policy changes. Examples are
prospective regulation of product safety and reliability, or retrospective compensation for harm
from defective products or misrepresentation of product features. This paper reexamines the
foundations of welfare analysis for these applications. We consider discrete product choice, and
develop practical formulas that apply when discrete product demands are characterized by mixed
multinomial logit models and policy changes affect hedonic attributes of products in addition to
price. We show that for applications that are retrospective, or are prospective but compensating
transfers are hypothetical rather than fulfilled, a Market Compensating Equivalent measure that
updates Marshallian consumer surplus is more appropriate than Hicksian compensating or
equivalent variations. We identify the welfare questions that can be answered in the presence of
partial observability on the preferences of individual consumers. We examine the welfare
calculus when the experienced-utility of consumers differs from the decision-utility that
determines market demands, as the result of resolution of contingencies regarding attributes of
products and interactions with consumer needs, or as the result of inconsistencies in tastes and
incomplete optimizing behavior. We conclude with an illustrative application that calculates the
welfare impacts of unauthorized sharing of consumer information by video streaming services.

Daniel McFadden
University of California, Berkeley
Department of Economics
508-1 Evans Hall #3880
Berkeley, CA 94720-3880
and NBER
mcfadden@econ.berkeley.edu

1. INTRODUCTION
A common problem in applied economics is assessment of the welfare consequences for consumers of
policies/scenarios that regulate markets for products, or correct for past product defects or misrepresentations.
Examples are (1) prospective regulation of information provided on coverage and costs in insurance contracts and
other financial instruments such as mortgages, and retrospective redress of harm from failures to properly disclose
information; (2) harm from environmental damage to recreation facilities such as ocean beaches; (3) safety
regulation of consumer products such as automobile air bags, mobile phones, and privacy protection in video
streaming services, or redress of harm from safety defects; and (4) evaluation of overall market performance; e.g.,
the prospective benefit of blocking a merger of dominant suppliers, or retrospective harm from collusion or
restraints on entry. This paper reexamines the foundations of welfare analysis for these applications, and provides
a practical framework for analysis that rests on these foundations.

Toll per Crossing

Figure 1. Dupuitâ€™s Calculation of Relative Utility
Demand for trips adjusts to equate
value in exchange and value in use
= Marginal utility per monetary unit

a

Scenarios

"Relative
utility" or
"consumer
surplus"

b

Bridge Crossings per Year
Measuring changes in consumer well-being from policies that affect the availability, prices, and/or attributes
of goods and services has been a central concern of economics from its earliest days. Adam Smith (1776) observed
that â€œhaggling and bargaining in the marketâ€ would achieve â€œrough equalityâ€ between value in use and value in
exchange. Working at the fringes of mainstream economics, Jules Dupuit (1844) was remarkably prescient,
recognizing that if the marginal utility of income (MUI) is constant, then the demand curve for a commodity
(illustrated in Figure 1) is a marginal utility curve, so that the area to the left of this demand curve between the
prices established by scenarios labeled a and b gives a money-metric measure of â€œrelative utilityâ€. Dupuitâ€™s
measure later became known as Marshallian Consumer Surplus (MCS); see Alfred Marshall (1890, III.IV.2-8).

2

Hermann Gossen (1854) deduced further that consumers exhibiting diminishing marginal utility would achieve
maximum utility when the marginal utilities per unit of expenditure on each good are equal, and equal the MUI.
To rephrase these propositions in current microeconomic terms, suppose the consumer maximizes a utility
function U(q0,q1) of two goods subject to a budget constraint I = p0q0 + p1q1, where I is income and p0 and p1 are
the goods prices. Let q0 = D0(I,p0,p1) and q1 = D1(I,p0,p1) â‰¡ (I â€“ p0D0(I,p0,p1))/p1 denote the demands that come out
of this maximization, and let V(I,p0,p1) â‰¡ U(D0(I,p0,p1),D1(I,p0,p1)) â‰¡ max U(q0,(I â€“ p0q0)/p1) denote the resulting
q0

indirect (or maximized) utility. The first-order condition for maximization is FOC â‰¡ âˆ‚U/âˆ‚q0 â€“ (p0/p1)âˆ‚U/âˆ‚q1 = 0.

The derivatives of V are âˆ‚V/âˆ‚I = (1/p1)âˆ‚U/âˆ‚q1 + FOCâˆ™(âˆ‚D0/âˆ‚I) â‰¡ (1/p1)âˆ‚U/âˆ‚q1 and âˆ‚V/âˆ‚p1 = â€“ (D1(I,p0,p1)/p1)âˆ‚U/âˆ‚q1

+ FOCâˆ™(âˆ‚D0/âˆ‚ p1) â‰¡ â€“ D1(I,p0,p1)âˆ™ (âˆ‚V/âˆ‚I ), illustrating the envelope theorem. Rearranging the MUI âˆ‚V/âˆ‚I gives

Smithâ€™s proposition: â€œvalue in exchangeâ€ â‰¡ p1 = (âˆ‚U/âˆ‚q1)/(âˆ‚V/âˆ‚I) â‰¡ â€œvalue in useâ€ (or marginal utility per unit of

good 1 measured in money units), which combined with a rearrangement (1/p1) âˆ‚U/âˆ‚q1 = (1/p0)âˆ‚U/âˆ‚q0 of the FOC
gives Gossenâ€™s result. The ratio

ğœ•ğœ•V/ âˆ‚p1
ï¿½âˆ‚V/ âˆ‚ğ¼ğ¼ â‰¡ â€“ D1(I,p0,p1) gives Royâ€™s (1947) identity. Substituting this ratio

in the Dupuitâ€™s relative utility or Marshallian consumer surplus (MCS) integral,
(1)

p

p

ğœ•ğœ•V/âˆ‚p1
âˆ‚V/âˆ‚ğ¼ğ¼
1a

MCS = âˆ«p 1a D1(I,p0,p1)dp1 â‰¡ âˆ«p 1b
1b

dp1 â‰¡ [V(I,p0,p1b) â€“ V(I,p0,p1a)]/MUI*,

where the last equality is obtained by integration after applying the first mean value theorem to move outside
the integral an intermediate value MUI* of the denominator âˆ‚V/âˆ‚I. In this paper, we define a measure of the
consumerâ€™s change in well-being that we term the Market Compensating Equivalent (MCE),
(2)

MCE = [V(I,p0,p1b) â€“ V(I,p0,p1a)]/MUIa,

the difference in indirect utilities, scaled to money-metric units by dividing by the MUI at the â€œdefaultâ€ or â€œas isâ€
scenario a. Obviously, MCS and MCE differ only in the MUI scaling factor, and are identical when MUI is constant,
confirming Dupuitâ€™s original insight. The advantage of MCE is that it is easily calculated when the indirect utility
function and its derivatives are known, allows the introduction of policy change dimensions other than price,
avoids the generally path-dependent definition of MCE, and usefully for retrospective analysis, expresses the
change in well-being in units of the consumerâ€™s income in the â€œas isâ€ scenario. The indirect utility function V has
MUI constant, given p0, if and only if it has an additively separable form V(I,p0,p1) = Î¼I/p0 â€“ G(p1/p0) for some
function G and constant Î¼, in which case Royâ€™s identity establishes that the demand for good 1, D1(I,p0,p1) =

Gâ€™(p1/p0)/Î¼, is independent of income.

3

Dupuitâ€™s idea of solving the inverse problem, recovering utility from demand, was brought into mainstream
economics at the end of the 19th century by William Stanley Jevons (1871), Francis Edgeworth (1881), Alfred
Marshall (1890), Vilfredo Pareto (1906), and Eugen Slutsky (1915). MCS became the accepted measure of the
change in consumer well-being. However, John Hicks (1939) observed that when the MUI = âˆ‚V(I,p0,p1)/âˆ‚I is not

constant, reducing income in scenario b by a transfer MCS will not necessarily leave the consumer indifferent

between the scenarios. Hicks considered this a defect, and introduced two closely related alternative measures
that correct it: Hicksian Contingent Valuation (HCV), the net decrease in scenario b income that equates utility in
the two scenarios, and Hicksian Equivalent Variation (HEV), the net increase in scenario a income that equates
utility in the two scenarios.
Importantly, the MCE, HCV, and HEV measures correspond to different consumer choice environments: The
HCV measure assumes that the transfer is fulfilled in scenario b before the consumer makes a choice in that
scenario, and the HEV measure assumes the transfer is fulfilled in scenario a before the scenario a choice. The
MCE measure assumes that choices are made under actual market and income conditions in each scenario,
without compensation, and that the post-choice transfer is determined after this as a remedy for the utility gain
or loss from the change in scenario. Then, HCV is appropriate for prospective welfare analysis when the transfer
is fulfilled before choice in scenario b, and HEV when the transfer is fulfilled before choice in scenario a. However,
for retrospective welfare analysis where the objective is to redress past harm, or for prospective analysis where
the transfers are hypothetical and not fulfilled, MCE is a more appropriate measure of what it takes to â€œmake the
consumer wholeâ€ following the choices the consumer did make or would have made in the uncompensated â€œas
isâ€ and â€œbut forâ€ scenarios. MCE is also appropriate for assessment of residual gains and losses subsequent to
prospective analysis where an inexact compensation scheme is fulfilled.
HCV and HEV are often defined as areas to the left of income-compensated demand curves (i.e., demands with
income adjusted as price changes to keep utility fixed at the scenario a or scenario b levels, respectively).
However, their definition in terms of the indirect utility function, solutions to V(I â€“ HCV,p0,p1b) = V(I,p0,p1a) and
V(I,p0,p1b) = V(I+HEV,p0,p1a), are more revealing. Applying the mean value theorem, they satisfy

(3)

HCV = [V(ğ¼ğ¼, p0 , p1b ) â€“ V(ğ¼ğ¼, p0 , p1a )]/MUIâ€²
HEV = [V(ğ¼ğ¼, p0 , p1b ) â€“ V(ğ¼ğ¼, p0 , p1a )]/MUI"

,

where MUIâ€™ and MUIâ€ are some intermediate values. Then, these two measures, the MCE measure from (2), and

MCS are all proportional to the difference in utilities of the two scenarios, and differ only in scaling by the MUI
valued at different points. Obviously, if the MUI is constant, then MCE, HCV, HEV, and MCS are identical, and in
4

applications where the marginal utility of income varies little, they will be close approximations. MCE has a closed
form when the indirect utility function is known, a computational advantage over HCV and HEV.
Samuelson (1947) and Hurwicz and Uzawa (1971) updated the Hicksian analysis using modern consumer
theory, and their approach has been adapted to consumers making discrete choices by Diamond and McFadden
(1974), Small and Rosen (1981), McFadden (1981, 1994, 1999, 2004, 2012, 2014), Yatchew (1985), and Zhou et al
(2012). For the most part, this literature assumes that consumers are strictly neoclassical utility maximizers, with
self-interest defined narrowly to include only personally purchased and consumed goods. Mostly, social motives
are ignored and no allowance is made for ambiguities and uncertainties regarding tastes, budgets, hedonic
attributes of goods and services, the reliability of transactions, or the consistency and completeness of preference
maximization, and there is no distinction between the decision-utility postulated to determine market behavior
and the experienced-utility of outcomes. Public and environmental goods are incorporated only if they have active
margins that allow them to be valued from market behavior. The market demand functions of individual
consumers are assumed to be completely observed, and consumers fully informed about policy regimes, so that
utility can be recovered from the demand behavior it produces and the compensating transfers can be calculated
and fulfilled exactly each consumer. The primary focus of welfare theory has been prospective, assuming that
compensating transfers are fulfilled before consumer choices are made. The analysis has been fundamentally
static, with the consumer pictured as making a once-and-for-all utility-maximizing choice for contingent deliveries
of market goods, even if resolution of uncertainties and fulfillment of contracts extend over time; as in Debreu
(1959). Analysis typically starts from prespecified scenarios, although in retrospective applications there are often
substantive questions regarding the nature of the â€œbut forâ€ scenario, particularly when the â€œas isâ€ scenario leads
to experienced utility different from decision utility. Two further assumptions are tacit in most practical welfare
calculations: First, policy scenario differences are limited in scope and magnitude, so that after accounting for a
few major margins, general equilibrium effects can be neglected. Second, if compensating transfers are
incomplete within a class of consumers, conducted say using a simple formula such as uniform transfers rather
than an exact consumer-by-consumer calculation, the loss in social welfare from this imperfect redistribution can
be neglected relative to the aggregate welfare change for the class.
We review these assumptions. Section 2 gives a foundation in consumer theory for the welfare calculus, with
explicit treatment of discrete alternatives and their hedonic attributes. Section 3 restates the welfare measures
in Section 1 for general applications, using the consumer theory of Section 2. Section 4 distinguishes retrospective
and prospective policy applications of the welfare calculus. Section 5 discusses partial observability of individual
consumer preferences, and its implications for welfare measurement and aggregation. Section 6 distinguishes
5

decision-utility and experienced-utility foundations for calculation of well-being. Section 7 gives computational
formulas for common policy problems. Section 8 contains an illustrative empirical application. Appendices collect
relevant mathematical results on approximation, give properties of extreme-value distributed random variables,
and give R-code for discrete welfare calculations.

2. CONSUMER FOUNDATIONS
A common starting assumption for welfare analysis is that consumers have â€œniceâ€ demand functions that allow
recovery of indirect utility. For example, Hurwicz and Uzawa (1971) give local and global sufficient conditions for
recovery of money-metric indirect utility 2 when the market demand function is single-valued and smooth; see
also Katzner (1970) and Border (2014). Another approach, originating in the revealed preference analysis of
Samuelson (1948), Houthakker (1950), and Richter (1966), gives necessary and sufficient conditions for recovery
of a preference order whose maximization yields the market demand function; Afriat (1967) and Varian (2006)
provide constructive methods for recovery of utility under some conditions. Technical difficulties arise because
quite strong smoothness and curvature conditions on utility are needed to assure smoothness properties on
market demand, while preferences recovered from upper hemicontinuous demand functions are not necessarily
continuous; see Peleg (1970), Rader (1973), Conniffe (2007). This section gives a restatement of the consumer
theory behind welfare measurement, with extensions that include a â€œno local cliffsâ€ Lipschitz continuity axiom on
the preference map that avoids the Peleg-Rader problem and guarantees representation of preferences by utility,
expenditure, indirect utility, and demand functions that satisfy (bi-)Lipschitz 3 conditions in economic variables.
These results facilitate practical welfare measurement, and are of independent interest. Readers may find it useful
to refer to Table 1 for notation, and consult as needed the technical material in the remainder of this section.

2

Indirect utility is money-metric if the marginal utility of (real) income in a baseline scenario remains one as income changes.

3

An increasing function is bi-Lipschitz if its left and right derivatives are bounded away from 0 and +âˆ.

6

Table 1. Notation
m = a,b

â€œAs-Isâ€/baseline policy/scenario a and â€œBut-Forâ€/counterfactual policy/scenario b

sâˆˆS

Finite-dimensional vector in a compact set S describing observed demographics and
history of the decision-maker

j âˆˆ Jm âŠ† J = {0,â€¦,J}

Mutually exclusive discrete choices (e.g., â€œproductsâ€), including â€œbenchmarkâ€ or â€œnopurchaseâ€ alternatives that are not affected by policy change

Im âˆˆ [IL,IU]

Consumer real income, in an interval [IL,IU], with 0 < IL < IU < +âˆ, in scenario m

zjm âˆˆ Z

Vector zm of observed hedonic attributes zjm for alternatives j âˆˆ Jm in scenario m, in a
compact finite-dimensional set Z

q âˆˆ Qâ€™ âŠ† Q
wjm = (q,zjm) âˆˆ W

Vector of the goods and services that are supplied in continuous quantities, in a finite
rectangle Q â‰¡ [0,qU] in n-dimensional Euclidean space, or in a subrectangle Qâ€™ = [0,qA],
where qA is an upper bound on vectors that are affordable, 0 â‰ª qA â‰ª qU
Consumption vector given discrete choice j in scenario m, in W = QÃ—Z or in Wâ€™ = Qâ€™Ã—Z

pjm Ïµ P

Real price, in a compact interval P = [0,pU] with pU > 0, of discrete product j in scenario
m; pm is the vector with components ğ‘ğ‘jm for j âˆˆ Jm

rmâˆ™qm + pjm â‰¤ Im

Budget constraint given discrete alternative j in scenario m

rm âˆˆ R

Finite-dimensional vector in a rectangle R = [rL,rU], with 0 â‰ª rL â‰ª rU,â‰ª +âˆ, of real
prices of the goods and services that are available in continuous quantities;
benchmark ra

â‰½âˆˆH

A field H of complete transitive reflexive preference preorders â‰½ on QÃ—Z,
represented by sets G(â‰½) âŠ† WÃ—W with (wâ€™,wâ€) âˆˆ G(â‰½) âŸº wâ€™ â‰½ wâ€

M(u,r,z,â‰½)

An expenditure function, the minimum over q âˆˆ Q of râ‹…q such that U(q,z,â‰½) â‰¥ u

U(q,z,â‰½)

ï¿½(I,r,z,â‰½)
V

ğ’±ğ’±(Im ,pm,rm,zm,â‰½)
ï¿½
Pk(I,pm,rm,zm,s)

xjm = X(I â€“ pjm,rm,zjm)

A direct utility function conditioned on choice j in scenario m, defined on Qâ€™Ã—ZÃ—H as
the minimum over qâ€™ âˆˆ QU of raâ‹…qâ€™ such that (qâ€™,z0a) â‰½ (q,zjm) â‰¡ wjm
ï¿½ â‰¡ ğ¼ğ¼ + vï¿½ (ğ¼ğ¼, ğ«ğ«, ğ‘§ğ‘§, â‰½), a money-metric indirect utility function, the maximum of
V
U(q,z,â‰½) subject to the budget constraint râˆ™q â‰¤ I
ï¿½(Im â€“ pjm,rm,zjm,â‰½) unconditional maximum utility in scenario m
ğ’±ğ’± = maxjâˆˆğ‰ğ‰m V
The probability that choice k in scenario m attains maximum utility ğ’±ğ’±
A finite-dimensional vector of predetermined functions

vï¿½ğ¼ğ¼m âˆ’ ğ‘ğ‘jm , ğ«ğ«, ğ‘§ğ‘§jm , â‰½ï¿½

V(Im â€“ pjm,r,zjm,â‰½)

v = xjmÎ² with I = Im, parameters Î² = Î²(â‰½), an approximation to vï¿½ ï¿½ğ¼ğ¼m âˆ’ ğ‘ğ‘jm , ğ«ğ«, ğ‘§ğ‘§jm , â‰½ï¿½

Pk(I,pm,r,zm,s)

Pkm = EÎ²|s exp(

ï¿½ with additive EV1 â€œnoiseâ€, Ïƒ = Ïƒ(â‰½)
V = ğ¼ğ¼m âˆ’ ğ‘ğ‘jm + xjm Î² + ÏƒÎµj approximation to V
xjm Î²âˆ’ğ‘ğ‘jm
xkm Î²âˆ’ğ‘ğ‘km
Jm
)/âˆ‘j=0
exp( Ïƒ
)
ğœğœ

7

MMNL approximation to ï¿½
Pk(I,pm,r,zm,s)

Suppose consumers face scenarios m = a,b, and a universe of possible discrete alternatives indexed by a finite
set J â‰¡ {0,â€¦,J}. Let Jm âŠ† J denote the set of alternatives available in the market under policy m, with |Jm| elements,

and characterize then by real prices pjm in a compact interval P = [0,pU] with pU > 0, and observed hedonic attributes

zjm in a compact finite-dimensional set Z. Let pm and zm denote the vectors of pjm and zjm for j âˆˆ Jm. Assume that
there are alternatives that are always available and are unaffected by policy, including ordinarily â€œno purchaseâ€
alternatives that by convention are assigned zero price and attributes. Market goods supplied in continuous
quantities are described by commodity vectors q âŠ† Q = [0,qU] with 0 â‰ª qU, a bounded rectangle in n-dimensional

space, with real market prices r âˆˆ R = [rL,rU], a commensurate bounded rectangle with 0 â‰ª rL â‰ª rU. We assume
that Z is a finite union of disjoint rectangles; this avoids technical complications and covers applications where
measured attributes either vary continuously in some interval or take on a finite number of discrete levels.
Assume that consumers are characterized by a vector s of observed demographics and history, and by real

income Im in a bounded interval [IL,IU]. In many applications, Ia = Ib, but if changing from scenario a to scenario b
entails an allocated net production cost or fulfilled transfer assessed as a lump sum net tax, then Ia and Ib will differ
by the net amount. A consumerâ€™s market opportunities under policy m are summarized in prices rm âˆˆ R, and for j

âˆˆ Jm, attributes zjm âˆˆ Z and prices pjm âˆˆ P, giving the budget constraint rmâˆ™q â‰¤ Im â€“ pjm for vectors q âˆˆ Q when a

product j from Jm is chosen. Let qA âˆˆ Q denote a vector that bounds all affordable vectors (i.e., rLâˆ™q â‰¤ IU implies q

â‰ª qA) and define Qâ€™ = [0,qA]. Let z denote the vector of attributes and p the vector of prices for the discrete

alternatives in J, and let zm and pm denote their subvectors for the available alternatives in Jm.We adopt a

description of consumers that is sufficiently flexible to encompass neoclassical preference maximization and some
behavioral deviations, and can be made empirically tractable. Assume that consumers have complete transitive
reflexive preference preorders â‰½ over vectors (q,z) âˆˆ QÃ—Z â‰¡ W, that these preorders are predetermined and
invariant with respect to current market opportunities, and that consumers are preference maximizers. Later, we
consider the implications for identification of preferences and the welfare calculus when these neoclassical
assumptions are relaxed. A preference preorder â‰½ is described by the non-empty set of pairs ((qâ€™,zâ€™),(qâ€,zâ€)) âˆˆ

WÃ—W that satisfy (qâ€™,zâ€™) â‰½ (qâ€,zâ€). Let H âŠ† 2WÃ—W denote the field of preference preorders of consumers in the

population. We will assume that preferences for continuous goods are monotonic (i.e., qâ€™ â‰¥ qâ€ âŸ¹ qâ€™ â‰½ qâ€), and
that qU is sufficiently large and continuous goods are sufficiently desirable so that they can substitute for any

affordable (q,z); i.e., (qU,z0a) â‰½ (qA,z) for all z âˆˆ Z and â‰½ âˆˆ H.. We use the notation â€œâ‰»â€ for strict preference and the
notation â€œâˆ¼â€ for indifference. We use the Euclidean norm on Q, R, and Z; e.g., â€–ğªğªâ€– = ï¿½ğªğª âˆ™ ğªğª for q âˆˆ Q.

For non-empty subsets A,B of the metric space WÃ—W, define the Hausdorff distance h(A,B) to be the greatest

lower bound of positive scalars Î· such that each set is contained in an Î·-neighborhood of the other; i.e., if NÎ·(A)
8

denotes the union of the open balls of radius Î· centered at the points in A, then h(A,B) is the greatest lower bound
of Î· satisfying B âŠ† NÎ·(A) and A âŠ† NÎ·(B). The set WÃ—W is compact, so h is bounded, and if A,B âˆˆ WÃ—W are closed,
then h(A,B) = 0 if and only if A = B. If the sets in H are all closed, then h is a metric on H termed the Hausdorff set

metric, and H is precompact in its metric topology. We make a series of assumptions on preferences and budgets,
beginning with a basic assumption on continuity of preferences:
A1. If a sequence of preorders â‰½i âˆˆ H+ and sequences of consumption vectors (wâ€™i,wâ€i) âˆˆ G(â‰½i) satisfy

h(G(â‰½i),G(â‰½0)) â†’ 0, wâ€™i â†’ wâ€™0, and wâ€i â†’ wâ€0, then G(â‰½0) âˆˆ H and (wâ€™0,wâ€0) âˆˆ G(â‰½0).

Since our attention is primarily on discrete choice, we will make strong and simple assumptions on continuous

good preferences. Fix baseline values (ra,za) âˆˆ RÃ—Z. For (q,z) âˆˆ QÃ—Z and â‰½ âˆˆ H, define A(q,z,â‰½) = {qâ€™âˆˆQ|(qâ€™,za) â‰½
(q,z)}, the set of continuous commodity vectors qâ€™ âˆˆ Q that combined with â€œbenchmarkâ€ attributes za are at least

as good as (q,z). We will assume for q âˆˆ Qâ€™ that qU âˆˆ A(q,z,â‰½), so this set is non-empty. Assumption A1 implies

that A(q,z,â‰½) is compact, and if qâ€™,qâ€ âˆˆ Qâ€™, zâ€™,zâ€ âˆˆ Z, and (qâ€™,zâ€™) â‰» (qâ€,zâ€), then A(qâ€™,zâ€™,â‰½) is contained in the interior

of A(qâ€,zâ€,â‰½). Assumption A2 strengthens our monotonicity requirement for continuous goods and imposes
Lipschitz continuity conditions on preferences. Let hQ(Aâ€™,Aâ€) denote the Hausdorff distance between non-empty

subsets Aâ€™,Aâ€ âŠ† Q. If Aâ€™ âŠ† Aâ€, then hQ(Aâ€™,Aâ€) â‰¡ inf{Î· > 0|A" âŠ† NÎ· (Aâ€²)}. Assumptions A1 and A2 do not impose
any convexity condition on preferences, but do require that the open quadrant to the northeast of any point in
A(q,z,â‰½) is contained in the interior of this set.
A2. For qâ€™,qâ€ âˆˆ Q, zâ€™,zâ€ âˆˆ Z, and â‰½â€™,â‰½â€ âˆˆ H, qâ€ â‰ª qâ€™ implies (qâ€™,zâ€™) â‰»â€™ (qâ€,zâ€™). If q âˆˆ Qâ€™, then (qU,za) â‰½â€™ (q,zâ€™).

There exist scalars Î±, Î´ > 0 such that (i) (qâ€™,zâ€™) ~â€™ (qâ€,zâ€) implies hQ(A(qâ€™,zâ€™,â‰½â€™),A(qâ€,zâ€,â‰½â€)) â‰¤ Î±âˆ™h(â‰½â€™,â‰½â€), (ii)

hQ(A(qâ€™,zâ€™,â‰½â€™),A(qâ€,zâ€,â‰½â€)) â‰¤ Î±âˆ™(|qâ€™ â€“ qâ€| + |zâ€™ â€“ zâ€| + h(â‰½â€™,â‰½â€)), and (iii) (qâ€™,zâ€™) â‰»â€™ (qâ€,zâ€) implies
inf

ğªğªâˆˆA(ğªğªâ€²,ğ‘§ğ‘§â€²,â‰½â€²)

sup{Î· > 0 | NÎ· (q) âŠ† A(ğªğªâ€, ğ‘§ğ‘§", â‰½ â€²)} â‰¥ Î´hQ(A(qâ€™,zâ€™,â‰½â€™),A(qâ€,zâ€,â‰½â€™)).

For each â‰½, the A(q,z,â‰½) are â€œat least as good asâ€ sets whose boundaries define contours in Q, as illustrated

in Figure 2. The Lipschitz continuity conditions (i) and (ii) rule out precipitous changes in A(q,z,â‰½) when (q,z,â‰½)

changes. Let âˆ† denote the difference in elevation of the contours on some (arbitrary) scale. The line between
boundary points in the upper contour sets Aâ€™ = A(qâ€™,zâ€™,â‰½) and Aâ€ = A(qâ€,zâ€,â‰½) that achieves their Hausdorff distance
gives the lowest slope between them, âˆ†/hQ(Aâ€™,Aâ€), while the highest slope is bounded by âˆ†/Î´hQ(Aâ€™,Aâ€), where Î´ is

the lower bound given by (iii). Then condition (iii) rules out â€œlocal cliffsâ€ by bounding the ratio of the highest
slope to the lowest slope as two contours converge. Preferences on a compact set that are representable by

absolutely continuous utility functions with gradients that are bounded positive and finite satisfy the Lipschitz

9

continuity condition. The utility function in â„2 satisfying u = q1 â€“ ï¿½1 âˆ’ q 2 for 0 â‰¤ q2 â‰¤ 1 and u = q1 + ï¿½q2 âˆ’ 1 for

q2 > 1 is an example that has a local cliff and fails to satisfy the condition at q2 = 1.

Figure 2. Lowest and Highest Slopes between Contours

â€œlowest slopeâ€
= âˆ†/hQ(Aâ€™,Aâ€)

â€œhighest slopeâ€
â‰¤ âˆ†/Î´hQ(Aâ€™,Aâ€)
Aâ€™
Aâ€

difference âˆ†
in elevation

A last assumption confirms that income is in a range where consumer budgets are limiting but nevertheless
allow choice of any available discrete alternative, and all affordable q are in Qâ€™:
A3. The consumption vector (0,z) is affordable for each z âˆˆ Z (i.e., IL > pU), and q âˆˆ Q and rLâˆ™q â‰¤ IU âŸ¹ q âˆˆ Qâ€™.

We next establish that A1-A3 are sufficient to guarantee well-behaved representations of preferences by utility,
expenditure, and indirect utility functions.
Lemma 2.1. If A1, then each G(â‰½) âˆˆ H is a compact set, and H is a compact metric space with metric h.

Proof: For fixed â‰½, A1 establishes that G(â‰½) is a non-empty closed subset of the compact space WÃ—W. The
properties of h and H are given in Aliprantis and Border (2006, Sections 3.16-3.18), particularly Definition 3.70,
Theorem 3.85, and Corollary 3.95. âˆ

Lemma 2.2. Suppose A1 and A2, (qâ€™,zâ€™), (qâ€,zâ€) âˆˆ Qâ€™Ã—Z, â‰½ âˆˆ H, and (qâ€™,zâ€™) â‰» (qâ€,zâ€). Let Î´ denote the bound

from A2, 1 denote a vector of ones, and Î³ = hQ(A(qâ€™, zâ€™,â‰½),A(qâ€, zâ€,â‰½)). If qâ€™* is in the boundary of A(qâ€™,zâ€™,â‰½), qâ€*
is in the boundary of A(qâ€,zâ€,â‰½), and r âˆˆ R, then qâ€™* â€“ Î³Î´r/â€–ğ«ğ«â€– âˆˆ A(qâ€,zâ€,â‰½) and qâ€* + Î³1 âˆˆ A(qâ€™,zâ€™,â‰½).

10

Proof: By A2, all points in a neighborhood of qâ€™* with radius Î³Î´ are contained in A(qâ€,zâ€,â‰½), giving the first result.

If qâ€* + Î³1 âˆ‰ A(qâ€™,zâ€™,â‰½), then no point within radius Î³ of qâ€* is in A(qâ€™,zâ€™,â‰½), contradicting the definition of Î³ as the
Hausdorff distance. âˆ

The next result uses the expenditure at baseline continuous good prices needed to achieve the level of

satisfaction of a given vector of goods to define a well-behaved (i.e., bi-Lipschitz) utility function.

(5)

Theorem 2.3. Suppose A1 and A2. For each (q,z) âˆˆ Qâ€™Ã—Z and â‰½ âˆˆ H, define
U(q,z,â‰½) = min{raâˆ™qâ€™ | qâ€™ âˆˆ A(q,z,â‰½)}.

Then, U is a continuous direct utility function on Qâ€™Ã—ZÃ—H; i.e., U is continuous in its arguments and U(qâ€™,zâ€™,â‰½) â‰¥

U(qâ€,zâ€,â‰½) âŸº (qâ€™,zâ€™) â‰½ (qâ€,zâ€). Further, U is locally non-satiated with a range U(Qâ€™,z,â‰½) contained in the bounded

interval [0,raâˆ™qU], is Lipschitz in (q,z,â‰½), and is bi-Lipschitz in A = A(q,z, â‰½); i.e., there exist scalars Î±U, Î»U > 0 such
that qâ€™,qâ€ âˆˆ Qâ€™ and zâ€™,zâ€ âˆˆ Z imply

(6)

â„Q (A(ğªğªâ€™, ğ‘§ğ‘§â€™, â‰½), A(ğªğªâ€, ğ‘§ğ‘§â€, â‰½)) âˆ™ Î»U â‰¥ |U(ğªğªâ€™, ğ‘§ğ‘§â€™, â‰½) â€“ U(ğªğªâ€, ğ‘§ğ‘§â€, â‰½)| â‰¥ â„Q (A(ğªğªâ€™, ğ‘§ğ‘§â€™, â‰½), A(ğªğªâ€, ğ‘§ğ‘§â€, â‰½))/Î»U
|U(ğªğªâ€™, ğ‘§ğ‘§â€™, â‰½ â€²) â€“ U(ğªğªâ€, ğ‘§ğ‘§â€, â‰½ ")| â‰¤ ğ›¼ğ›¼ğ‘ˆğ‘ˆ âˆ™ (|ğªğªâ€™ â€“ ğªğªâ€| + | ğ‘§ğ‘§â€™ â€“ ğ‘§ğ‘§â€| + â„(â‰½â€² , â‰½ "))

.

Proof: A1 and A2 imply that A(q,z,â‰½) is non-empty and closed, hence compact, so (5) is well-defined. Suppose
(qâ€™,zâ€™) â‰½ (qâ€,zâ€). If (q,za) âˆˆ A(qâ€™,zâ€™,â‰½), then (q,za) â‰½ (qâ€™,zâ€™) and transitivity implies (q,za) â‰½ (qâ€,zâ€), and hence (q,za)

âˆˆ A(qâ€,zâ€,â‰½). Therefore, raâ‹…q â‰¥ U(qâ€,zâ€,â‰½), and hence U(qâ€™,zâ€™,â‰½) â‰¥ U(qâ€,zâ€,â‰½). A1 implies that U is continuous in

its arguments. In particular, U is sequentially continuous in â‰½ in the Hausdorff metric topology on H, or
equivalently the topology of closed convergence.

If q*â€™ âˆˆ argmin{raâˆ™q | q âˆˆ A(qâ€™,zâ€™,â‰½)} and q*â€ âˆˆ argmin{raâˆ™q | q âˆˆ A(qâ€, zâ€,â‰½)}, then U(qâ€™, zâ€™,â‰½) â€“ U(qâ€, zâ€,â‰½) =

raâ‹…(q*â€™ â€“ q*â€).

ï¿½" = ğªğªâˆ— â€™ âˆ’ Î´Î³ğ«ğ«a /â€–ğ«ğ«a â€– âˆˆ
Let Î³ â‰¡ hQ(A(qâ€™,zâ€™,â‰½),A(qâ€,zâ€,â‰½)). Lemma 2.2 with r = ra implies ğªğª

ï¿½") = ğ›¿ğ›¿ğ›¿ğ›¿â€–ğ«ğ«a â€– â‰¤ raâ‹…(q*â€™ â€“ q*â€) and raâ‹…(ğªğª
ï¿½â€² âˆ’ q*â€)
ï¿½â€² = ğªğªâˆ— " + Î³ğŸğŸ âˆˆ A(ğªğªâ€², ğ‘§ğ‘§â€™, â‰½). Then raâ‹…(q*â€™ â€“ ğªğª
A(ğªğªâ€, ğ‘§ğ‘§â€, â‰½) and ğªğª

= Î³raâˆ™1 â‰¥ raâ‹…(q*â€™ â€“ q*â€). Defining Î»U = max(raâˆ™1,1/Î´â€–ğ«ğ«a â€–), this gives the first row of (6). Then, the first Lipschitz

condition in A2 gives the second inequality in (6),

|U(ğªğªâ€™, ğ‘§ğ‘§â€™, â‰½) â€“ U(ğªğªâ€, ğ‘§ğ‘§â€, â‰½)| â‰¤ Î»UhQ(A(qâ€™,zâ€™,â‰½),A(qâ€,zâ€,â‰½)) â‰¤ Î»UÎ±âˆ™(|qâ€™ â€“ qâ€| + | zâ€™ â€“ zâ€| + h(â‰½â€™,â‰½â€)). âˆ

11

Theorem 2.4. Suppose A1 and A2, and U:Qâ€™Ã—ZÃ—H â†’ [0,raâˆ™qU] from (5). For each (r,z) âˆˆ RÃ—Z, â‰½ âˆˆ H, and u âˆˆ

U(Qâ€™,z,â‰½), define

M(u,r,z,â‰½) = minqâ€™âˆˆQâ€™{râˆ™qâ€™ | U(qâ€™,z,â‰½) â‰¥ u}.

(7)

Then M is an expenditure function that is continuous in its arguments, and concave, linear homogeneous, and
non-decreasing in r. Further, M satisfies M(u,ra,za,â‰½) â‰¡ u, is Lipschitz in (r,z,â‰½), and is bi-Lipschitz and increasing

in u; i.e., there exists scalars Î±M, Î»M > 0 such that (râ€™,zâ€™,â‰½â€™), (râ€,zâ€ ,â‰½â€) âˆˆ RÃ—ZÃ—H and uâ€™,uâ€ âˆˆ U(Qâ€™,z,â‰½) with uâ€™ â‰¥ uâ€

imply

(uâ€™ â€“ uâ€)Î»M â‰¥ M(uâ€², ğ«ğ«â€², ğ‘§ğ‘§â€², â‰½ â€²) â€“ M(uâ€, ğ«ğ«â€², ğ‘§ğ‘§â€², â‰½ â€²) â‰¥ (uâ€™ â€“ uâ€)/Î»M

(8)
Proof:

.
|M(uâ€², ğ«ğ« â€² , ğ‘§ğ‘§â€², â‰½ â€²) â€“ M(uâ€², ğ«ğ«", ğ‘§ğ‘§", â‰½ ")| â‰¤ Î±M âˆ™ (|rÊ¹ âˆ’ r"| + |ğ‘§ğ‘§â€² âˆ’ z"| + â„(â‰½â€² , â‰½ "))

Mas-Colell, Whinston, and Green (1995, Proposition 3E2) demonstrate that M is concave, linear

homogeneous, and non-decreasing in r. The continuity of M in its arguments follows from the Berge Maximum
Theorem (Aliprantis and Border, 2006, Theorem 17.31). Suppose (râ€™,zâ€™,â‰½â€™), (râ€,zâ€,â‰½â€) âˆˆ RÃ—ZÃ—H, and uâ€™ â‰¥ uâ€.
Consider q*â€™ âˆˆ argmin {râ€™â‹…q | U(q,zâ€™,â‰½â€™) â‰¥ uâ€™} and q*â€ âˆˆ argmin {râ€™â‹…q | U(q,zâ€™,â‰½â€™) â‰¥ uâ€}.

Let Î³ =

ï¿½" = ğªğªâˆ— â€™ âˆ’ Î´Î³ğ«ğ«/â€–ğ«ğ«â€– âˆˆ A(ğªğªâˆ— â€, ğ‘§ğ‘§â€², â‰½ â€²) and qï¿½â€² = ğªğªâˆ— " + Î³ğŸğŸ âˆˆ
hQ(A(ğªğªâˆ— â€²,zâ€™,â‰½),A(ğªğªâˆ— â€,zâ€™,â‰½)). From Lemma 2.2, ğªğª

ï¿½") = ğ›¿ğ›¿ğ›¿ğ›¿â€–ğ«ğ«â€– â‰¤ râ‹…(q*â€™ â€“ q*â€) = M(uâ€², râ€², ğ‘§ğ‘§â€², â‰½ â€²) â€“ M(uâ€, râ€², ğ‘§ğ‘§â€², â‰½ â€²) â‰¤ râ‹…(ğªğª
ï¿½â€² âˆ’ q*â€)
A(ğªğªâˆ— â€², ğ‘§ğ‘§â€², â‰½ â€²), so that râ‹…(q*â€™ â€“ ğªğª

= Î³râˆ™1. This establishes the first row inequality in (8) with Î»M = Î»U max(rUâˆ™1 , 1/ğ›¿ğ›¿ï¿½ğ«ğ« L ï¿½).

Next consider q*â€™ âˆˆ argmin ğ«ğ«â€² âˆ™ ğªğª and q*â€ âˆˆ argmin ğ«ğ«" âˆ™ ğªğª, and define Î³ = hQ(A(ğªğªâˆ— ",zâ€,â‰½â€),A(ğªğªâˆ— â€,zâ€™,â‰½â€™))
U(ğªğª,zâ€²â‰½â€²)â‰¥uâ€²

U(ğªğª,ğ‘§ğ‘§",â‰½")â‰¥ğ‘¢ğ‘¢â€²

â‰¤ Î±(|zâ€™ â€“ zâ€| + h(â‰½â€™,â‰½â€)). Then, A(q*â€™,zâ€™,â‰½â€™) = A(q*â€,râ€,â‰½â€™). If M(uâ€² , ğ«ğ« â€² , ğ‘§ğ‘§ â€² , â‰½â€² ) > M(uâ€², ğ«ğ«", ğ‘§ğ‘§", â‰½ â€²), then q*â€ + Î³1

âˆˆ A(ğªğªâˆ— â€,zâ€™,â‰½â€™), implying M(uâ€² , ğ«ğ« â€² , ğ‘§ğ‘§ â€² , â‰½â€² ) âˆ’ M(uâ€², ğ«ğ«", ğ‘§ğ‘§", â‰½ â€²) â‰¤ Î³râ€™âˆ™1 + |(râ€ â€“ râ€™)âˆ™q*â€| â‰¤ ï¿½ğ«ğ« U ï¿½Î±(|zâ€™ â€“ zâ€| + h(â‰½â€™,â‰½â€))
â‰¤ |râ€ â€“ râ€™|âˆ™ï¿½ğªğªU ï¿½ + ï¿½ğ«ğ« U ï¿½Î±(|zâ€™ â€“ zâ€| + h(â‰½â€™,â‰½â€)), proving the second row in (8) with Î±M = max(ï¿½ğªğªU ï¿½, ï¿½ğ«ğ« U ï¿½Î±). âˆ

Theorem 2.5. Suppose A1-A3 and U:Qâ€™Ã—ZÃ—H â†’ [0,raâˆ™qU] from (5). For I âˆˆ [ILâ€“pU,IU], r âˆˆ R, z âˆˆ Z, and â‰½ âˆˆ H,

define a money-metric indirect utility function
(9)

V(I,r,z,â‰½) â‰¡ maxqâˆˆQâ€™{U(q,z,â‰½) | râˆ™q â‰¤ I}

satisfying V(I,ra,za,â‰½) â‰¡ I that is continuous in its arguments with a range contained in the bounded interval
[0,raâˆ™qU], is quasi-convex and homogeneous of degree zero in (I,r), is non-increasing in r, is Lipschitz in (r,z,â‰½), and
12

is bi-Lipschitz increasing in I; i.e., there exist scalars Î±V â‰¥ raâˆ™qU and Î»V > 0 such that Iâ€™ > Iâ€, râ€™,râ€ âˆˆ R, zâ€™,zâ€ âˆˆZ, and
â‰½â€™,â‰½â€ âˆˆ H imply

(10)

Î»V (ğ¼ğ¼â€™ â€“ ğ¼ğ¼â€) â‰¥ V(ğ¼ğ¼â€™, ğ«ğ«â€², ğ‘§ğ‘§â€², â‰½ â€²) â€“ V(ğ¼ğ¼â€, ğ«ğ«â€², ğ‘§ğ‘§â€², â‰½ â€²) â‰¥ (ğ¼ğ¼â€™ â€“ ğ¼ğ¼â€)/Î»V

|V(ğ¼ğ¼â€™, ğ«ğ«â€², ğ‘§ğ‘§â€², â‰½ â€²) â€“ V(ğ¼ğ¼â€, ğ«ğ«", ğ‘§ğ‘§", â‰½ ")| â‰¤ Î±V (|ğ¼ğ¼â€™ â€“ ğ¼ğ¼â€| + |ğ«ğ« â€² âˆ’ ğ«ğ«|+|z'-z| + â„(â‰½â€² , â‰½ "))

.

Further, V(I,r,z,â‰½) is twice continuously differentiable in (I,r) except on a set of measure zero, and continuous good
demands are almost everywhere in (I,r) single-valued and continuously differentiable, and satisfy Royâ€™s identity,
q = D(ğ¼ğ¼ , ğ«ğ«, ğ‘§ğ‘§, â‰½) â‰¡ â€“

âˆ‚V(ğ¼ğ¼ ,ğ«ğ«,ğ‘§ğ‘§,â‰½)/âˆ‚ğ«ğ«
.
âˆ‚V(ğ¼ğ¼ ,ğ«ğ«,z,â‰½)/âˆ‚ğ¼ğ¼

Proof: Theorem 2.3 implies that U is continuous in its arguments, and A3 assures that the budget set for q is a

non-empty subset of Qâ€™ for all discrete choices. Then, (9) is well-defined. Local non-satiation from A2 implies that
V is the inverse with respect to u of I = M(u,r,z,â‰½); see Mas-Colell, Whinston, and Green (1995, Propositions 3D3
and 3E1). Result (8) then implies the first row of (10) with Î»V = Î»U. The continuity of M in its arguments from
Lemma 2 and the bi-Lipschitz condition (8) imply V is continuous in its arguments and Lipschitz-continuous in
(r,z,â‰½). It is immediate from the properties of M that V is homogeneous of degree zero in (I,r), and non-increasing
in r. Consider budgets (Ii,ri) for i = 0,1 and (Iğœƒğœƒ,rğ›‰ğ›‰) = Î¸(I0,r0) + (1-Î¸)(I1,r1) for Î¸ âˆˆ (0,1), and let q* denote a maximand

of (5) subject to the budget (Iğœƒğœƒ,rğ›‰ğ›‰). Then V(Iğœƒğœƒ,rğ›‰ğ›‰,z,â‰½) = U(q*,z,â‰½). But rğ›‰ğ›‰â‹…q* â‰¤ Iğœƒğœƒ implies either or both r0â‹…q* â‰¤ I0 or
r1â‹…q* â‰¤ I1, and therefore either V(I0,r0,z,â‰½) = U(q*,z,â‰½) or V(I1,r1,z,â‰½) = U(q*,z,â‰½), so that V is quasi-convex:

V(Iğœƒğœƒ,rğ›‰ğ›‰,z,â‰½) â‰¤ max{ V(I0,r0,z,â‰½), V(I1,r1,z,â‰½)}. From the definition of quasi-convexity, there exists an increasing

transformation Ïˆ such that such that Î½(I,r,z,â‰½) = Ïˆ(V(I,r,z,â‰½)) is a convex function of (I,r). Results of Rademacher

(1919) and Alexandrov (1939) establish that since Î½(I,ra,za,â‰½) â‰¡ Ïˆ(I) is convex in I, Ïˆ is bi-Lipschitz on (ILâ€“pU,IU),
continuously differentiable in I except possibly on a countable set, and almost everywhere twice continuously
differentiable in I. Then, Ïˆ-1(v) is also bi-Lipschitz and increasing, and hence continuously differentiable except on
a countable set. This implies that V(I,r,z,â‰½) = Ïˆ-1(Î½(I,r,z,â‰½)) is increasing and bi-Lipschitz in I, and hence
continuously differentiable in I except for a countable set, and almost everywhere twice continuously
differentiable in (I,r). Then the Roy (1947) identity applied to Î½(I,ra,z,â‰½), or equivalently to V(I,r,z,â‰½), establishes
that continuous good demands are almost surely single-valued and continuously differentiable in (I,r). âˆ

13

Lemma 2.6. Suppose A1-A3, the direct utility function U(q,z,â‰½) from (5), and its associated money metric
indirect utility function V(I,r,z,â‰½) from (9). For q âˆˆ Qâ€™, define U*(q,z,â‰½) = min V(ğ«ğ« â‹… ğªğª, ğ«ğ«, ğ‘§ğ‘§, â‰½). Then U*(q,z,â‰½) is
ğ«ğ«âˆˆR

quasi-concave and R-monotone , U*(q,z,â‰½) â‰¥ U(q,z,â‰½), with equality if for some r âˆˆ R, the conditions qâ€™ âˆˆ Qâ€™ and
4

râˆ™qâ€™ â‰¤ râˆ™q imply U(qâ€™,z,â‰½) â‰¤ U(q,z,â‰½).

Then, U and U* are observationally equivalent; i.e., V(I,r,z,â‰½) â‰¡

maxqâˆˆQâ€™{U*(q,z,â‰½) | râˆ™q â‰¤ I} and the continuous good demands from maximization of U and U* subject to the

budget constraint râˆ™q â‰¤ I coincide except on a set of (I,r) of measure zero.

Proof: V(ğ«ğ« â‹… ğªğª, ğ«ğ«, ğ‘§ğ‘§, â‰½) = max{U(qâ€™,z,â‰½) | râˆ™qâ€™ â‰¤ râˆ™q} â‰¥ U(q,z,â‰½)} implies U*(q,z,â‰½) â‰¥ U(q,z,â‰½). Suppose for some r

âˆˆ R, the conditions qâ€™ âˆˆ Qâ€™ and râˆ™qâ€™ â‰¤ râˆ™q imply U(qâ€™,z,â‰½) â‰¤ U(q,z,â‰½), so that qâ€™ is a maximand of U subject to this
budget constraint. Then U*(q,z,â‰½) â‰¤ V(râˆ™q,r,z,â‰½) â‰¤ U(q,z,â‰½). Hence, U and U* are observationally equivalent.

Suppose q0,q1 âˆˆ Qâ€™ and qÎ¸ = Î¸q0 + (1-Î¸)q1 for Î¸ âˆˆ (0,1), and let rÎ¸ âˆˆ R be such that U*(qÎ¸,z,â‰½) = V(rÎ¸âˆ™qÎ¸,rÎ¸,z,â‰½). Since
rÎ¸âˆ™qÎ¸ â‰¥ min{rÎ¸âˆ™q0,rÎ¸âˆ™q1}, U*(qÎ¸,z,â‰½) = V(rÎ¸âˆ™qÎ¸,rÎ¸,z,â‰½) â‰¥ min{V(rÎ¸âˆ™q0,rÎ¸,z,â‰½), V(rÎ¸âˆ™q1,rÎ¸,z,â‰½)} â‰¥ min{U*(q0,z,â‰½),

U*(q1,z,â‰½)}, so U* is quasi-concave in q. Suppose râˆ™qâ€ > râˆ™qâ€™ for all r âˆˆ R. Then there exists râ€ satisfying U*(qâ€,z,â‰½)
= V(râ€âˆ™qâ€,râ€,z,â‰½) > V(râ€âˆ™qâ€™,râ€,z,â‰½) â‰¥ U*(qâ€™,z,â‰½), so U* is R-monotone. âˆ

Let V(I â€“ pjm,rm,zjm,â‰½) denote the indirect utility function from (9) for discrete alternative j with attributes zjm,

price pjm, and income I â€“ pjm remaining for purchase of continuous goods. The consumer who chooses j âˆˆ Jm and

q âˆˆ Q to maximize utility subject to the budget constraint rmâˆ™q + pjm â‰¤ I then achieves unconditional indirect utility
(11)

u = ğ’±ğ’±(ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m , â‰½) â‰¡ max V(ğ¼ğ¼ â€“ ğ‘ğ‘jm , ğ«ğ«m , ğ‘§ğ‘§jm , â‰½) .
jâˆˆğ‰ğ‰m

Associated with (11) is an unconditional expenditure function I = â„³(u,pm,rm,zm,â‰½) obtained as an implicit solution

of (11), or equivalently as
(12)

I = â„³(u,pm,rm,zm,â‰½) â‰¡ min[Mï¿½u, ğ«ğ«m , ğ‘§ğ‘§jm , â‰½ï¿½ + ğ‘ğ‘jm ] .
jâˆˆJm

Theorems 2.4 and 2.5 imply that â„³ is bi-Lipschitz increasing in u and ğ’±ğ’± is bi-Lipschitz increasing in I.

Next characterize the choices and demands that achieve (11). For k âˆˆ Jm, and I âˆˆ [IL,IU], pm âˆˆ P|Jm | , zm âˆˆ Z|ğ‰ğ‰m | ,

and rm âˆˆ R, define the set of preferences that make alternative k uniquely optimal,

(13)

Hk(I,pm,rm,zm) = {â‰½âˆˆH | V(I â€“ pkm,rm,zkm,â‰½) > V(I â€“ pjm,rm,zjm,â‰½) for j âˆˆ Jm\{k}}

A function u(q) is quasi-concave if 0 < Î¸ < 1 implies u(Î¸qâ€™+(1-Î¸)qâ€) â‰¥ min(u(qâ€™),u(qâ€)), and is R-monotone if râˆ™qâ€™ â‰¥ râˆ™qâ€ for
all r âˆˆ R implies u(qâ€™) â‰¥ u(qâ€).
4

14

and let H#(I,pm,rm,zm) = â‹ƒkâˆˆğ‰ğ‰m Hk (ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m ) denote the set of all preferences that result in a unique utility-

maximizing choice. For â‰½ âˆˆ H#(I,pm,rm,zm), choice is indicated by
(14)

Î´k(ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m , â‰½) = ğŸğŸHk(ğ¼ğ¼,ğ©ğ©m ,ğ«ğ«,ğ³ğ³m) (â‰½) â‰¡ ï¿½ 1
0

(15)

D(I,pm,rm,zm,â‰½) = â€“ âˆ‘kâˆˆğ‰ğ‰m Î´k (ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m , â‰½) âˆ™

if â‰½ âˆˆ H k (ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m ) ,
otherwise

and using Theorem 2.5 and Royâ€™s identity, continuous good demands are given for almost all (I,r) by
âˆ‚V(ğ¼ğ¼ â€“ ğ‘ğ‘km ,ğ«ğ«m ,ğ‘§ğ‘§km ,â‰½)/âˆ‚ğ«ğ«
âˆ‚V(ğ¼ğ¼ â€“ ğ‘ğ‘km ,ğ«ğ«m ,ğ‘§ğ‘§km ,â‰½)/âˆ‚ğ¼ğ¼

.

In applications, the preferences â‰½ in (9) are unobserved and are heterogeneous across consumers. Limited

observations on the market choices of a single consumer allow only partial identification of preferences,
insufficient to estimate (9) with precision. Therefore we treat preferences as a â€œrandom effectâ€ in (9), with a
probability FH(âˆ™|s) on the field of preferences H whose salient features we can hope to identify from market data.
Our final preference assumption is that preference heterogeneity is almost surely sufficient to break ties:
A4. FH(H#(I,pm,rm,zm)|s) â‰¡ 1 for (I,pm,rm,zm) âˆˆ [IL,IU]Ã—P Jm +1Ã—RÃ—ZJm +1 and s âˆˆ S.

This assumption can be restated as a probabilistic transversality condition that the distribution of the vector of
indirect utilities for the various alternatives is of full dimension and absolutely continuous; see Shannon (2006).
Given Assumption A4, the discrete alternatives k âˆˆ Jm, are chosen with probabilities

(16)

Pk(I,pm,rm,zm,s) = FH(Hk(I,pm,rm,zm)|s) â‰¡ âˆ‚ğ„ğ„â‰½|ğ‘ ğ‘  ğ’±ğ’±(ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m , â‰½)/ âˆ‚vjm ,

with the last form of (16) coming from the interpretation of Eâ‰½|sğ’±ğ’±(I,pm,rm,zm,â‰½) as a Choice-Probability-Generating-

Function (CPGF) with vjm â‰¡ V(I â€“ pjm,rm,zjm,â‰½) for j âˆˆ Jm as arguments; see Fosgerau, McFadden, and Bierlaire

(2013). 5 The conditional probability of continuous good demand in a measurable set B âŠ† Q, given choice k, is

FH({â‰½ âˆˆ Hk(I,pm,rm,zm) | s,D(I,pm,rm,zm,â‰½) âˆˆ B})/Pk(I,pm,rm,zm,s), and the conditional probability of â‰½ given choice k
satisfies FH(A|s,k) = FH(Aâˆ©Hk(I,pm,rm,zm)|s)/Pk(I,pm,rm,zm,s) for measurable A âŠ† H.

For welfare applications, the representation in (9) and (11) of a population preference field satisfying

Assumptions A1-A4 has to be translated into a system that is practical for estimation and calculation. One
approach is direct non-parametric estimation of ğ„ğ„â‰½|ğ‘ ğ‘  ğ’±ğ’±(ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m , â‰½) using the property (16) that its gradient
When Eâ‰½|s(I,pm,rm,zm,â‰½) is additively linear in income, the CPGF coincides with the social surplus function introduced by
McFadden (1981). The greater generality of the CPGF comes from recognizing that treating the vjm as linear perturbations
of utility gives the gradient property even when real income is not linear and additive in the indirect utility function.
5

15

equals the vector of choice probabilities; see Bhattacharya (2015, 2017). This approach can be sharpened by using
the Lipschitz properties of (11) and adapting the Hall and Yachew (2007) method for nonparametric estimation of
a function and its derivatives. A limitation of a fully nonparametric approach is that its regularities are local, so
that it has difficulty predicting consumer outcomes when policies require non-local extrapolation. A second
approach to practical analysis is the method of sieves, utilizing a net of finite-parameter approximations to the
consumer preference field. Advantages of this approach are that it requires at an entry level only the finiteparameter methods and software employed in traditional applied economics, and that it is relatively easy to
impose structural restrictions that support plausible policy extrapolation. In this paper, we provide a foundation
for this second approach by showing that the field of indirect utility functions (9) with the properties given by
Assumptions A1-A4 can be approximated uniformly by a practical finitely-parameterized family, with random
parameters in the population that have a finitely parameterized distribution. Then, this family can be estimated
from observed choices in sufficiently rich arrays of market environments faced by samples of consumers, and the
estimated family can be used to carry out welfare calculations with no essential loss of generality.
ï¿½(I,rm,zjm,â‰½) for (I,rm,zjm,â‰½) âˆˆ [ILâ€“pU,IU]Ã—RÃ—ZÃ—H denote the true indirect
Theorem 2.7. Suppose A1-A4. Let V

ï¿½(I â€“ pjm,rm,zjm,â‰½) â€“ I on [IL,IU]Ã—[0,pU]Ã—RÃ—ZÃ—H.
utility function from Theorem 2.5, and define vï¿½ ï¿½ğ¼ğ¼, ğ‘ğ‘jm , ğ«ğ«m , ğ‘§ğ‘§jm , â‰½ï¿½ â‰¡ V

Given a small scalar Î³ âˆˆ (0,1), there exists a bound Î· = - ln(Î³/4|Jm|); a vector of predetermined twice continuously

differentiable functions X:[ILâ€“pU,IU]Ã—RÃ—Z âŸ¶ â„N drawn from a Schauder basis 6 for the space â„­([ILâ€“pU,IU]Ã—RÃ—Z); a

commensurate vector of Lipschitz-continuous real functions Î² from a compact subset â„¬ âŠ† â„­(H,â„N), and a

Lipschitz-continuous real function Ïƒ:H âŸ¶ [ÏƒL,ÏƒU] from a compact subset ğ’®ğ’® âŠ† â„­(H,[ÏƒL,ÏƒU]) with ÏƒL > 0 and ÏƒU <

Î³/2Î·; and independent standard type I extreme value (EV1) distributed random variables Îµj such that:
(i) There is an approximate indirect utility function 7
(17)

V(I â€“ pjm,rm,zjm,Î²,Ïƒ,Îµj) = I + v(I,pjm,rm,zjm,Î²) + ÏƒÎµj

A Schauder basis may be polynomials, Fourier series, or other series of functions that span the space of continuous
functions on a compact finite-dimensional space. The basis may be tailored to reduce the number of terms required to
achieve a given tolerance.

6

ï¿½, but at each point where V
ï¿½ is
The approximation V is not guaranteed to satisfy the slope and curvature properties of V
twice continuously differentiable with non-zero slopes and a non-singular (bordered) hessian, the approximation V for a
sufficiently small tolerance Î³ will also have these properties and preserve signs, and hence locally have the same slope and
ï¿½.
curvature properties as V
7

16

on [ILâ€“pU,IU]Ã—RÃ—ZÃ—â„¬Ã—ğ’®ğ’®Ã—â„ with v(I,pjm,rm,zjm,Î²) â‰¡ Xï¿½ğ¼ğ¼ â€“ ğ‘ğ‘jm , ğ«ğ«m , ğ‘§ğ‘§jm ï¿½ â‹… Î² âˆ’ ğ‘ğ‘jm such that |vï¿½ (I,pjm,rm,zjm,â‰½) â€“
v(I,pjm,rm,zjm,Î²(â‰½))| < Î³ uniformly. Further, in the event C = {Îµ | |Îµj| â‰¤ Î· for j âˆˆ J} that has Prob(C) > 1 â€“ Î³/2,
ï¿½(I,rm,zjm,â‰½) â€“ V(I,rm,zjm,Î²(â‰½),Ïƒ(â‰½),Îµj)| < Î³ uniformly.
|V

ï¿½, and let Î´km (ğ¼ğ¼, Î², Ïƒ) â‰¡
(ii) Suppose Î´ï¿½km (ğ¼ğ¼, â‰½) â‰¡ Î´ï¿½k(ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m , â‰½) is the choice indicator given by (14) for V
Î´k(ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m , Î², Ïƒ, ğ›†ğ›†) be an indicator for the discrete alternative that maximizes V(I â€“ pjm,rm,zjm,Î²,Ïƒ,Îµj) on Jm.
Then except for â‰½ and Îµ each in sets that have probability at most Î³/3, Î´k(ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m , Î²(â‰½), Ïƒ(â‰½), ğ›†ğ›†) =
Î´ï¿½k(ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m , â‰½). Letting ï¿½
Pk (I,pm,rm,zm,s) denote the true discrete choice probability, from (16), and
exp(vkm (ğ¼ğ¼,Î²)/ğœğœ )
jâˆˆğ‰ğ‰m exp(vjm (ğ¼ğ¼,Î²)/ğœğœ)

Pk(Im,pm,rm,zm,s) = ğ„ğ„Î´k (ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m , Î², Ïƒ, ğ›†ğ›†) â‰¡ EÎ²,Ïƒ|s âˆ‘

exp(vkm (ğ¼ğ¼,Î²)/ğœğœ )
jâˆˆğ‰ğ‰m exp(vjm (ğ¼ğ¼,Î²)/ğœğœ)

â‰¡ âˆ«â„¬Ã—ğ’®ğ’® âˆ‘

F(dÎ², dÏƒ|ğ‘ ğ‘ ),

ï¿½k(I,pm,r,zm,s) â€“ Pk(I,pm,r,zm,s)| < Î³.
where vkm(I,Î²) â‰¡ X(ğ¼ğ¼, ğ«ğ«m , ğ‘§ğ‘§km ) âˆ™ Î² â€“ ğ‘ğ‘km , one then has, uniformly, |P

(iii) Let F(A|s) â‰¡ FH({â‰½âˆˆH|(Î²(â‰½),Ïƒ(â‰½)) âˆˆ A}|s) for Borel sets A âŠ† â„¬Ã—ğ’®ğ’® and s âˆˆ S, and let FT(A|s) denote the
empirical probability obtained from T independent draws from F. Let â„±1 denote the family of functions of the
form (17) for j âˆˆ Jm, â„±2 denote the family of functions formed as differences of the functions in â„±1, and â„±
denote the family of functions of the form min(f1,â€¦,fK) for fk âˆˆ â„±2 and 1 â‰¤ K â‰¤ |J|, plus the function f â‰¡ 1. Let
ğ’¦ğ’¦ denote the family of functions exp(v(I,pjm,rm,zjm,Î²)/Ïƒ)/âˆ‘iâˆˆJm exp(v(ğ¼ğ¼, pim , ğ«ğ«m , zim , Î²)/Ïƒ) for v given in (17).
Let â„ denote the family of indicator functions i = 1(f>0) for f âˆˆ â„±, and ğ’¢ğ’¢ denote the family of functions of the
form iâˆ™f for i âˆˆ ğ’¥ğ’¥ and f âˆˆ â„±. Letting Eğ›ƒğ›ƒ,Ïƒ and Eğ›ƒğ›ƒ,ğ›”ğ›”,T denote expectation operators with respect to F and FT
respectively, there exists T such that Prob( sup
sup |(ğ„ğ„Tâ€² âˆ’ ğ„ğ„)f| > ğ›¾ğ›¾/3) < Î³/3.
Tâ€² â‰¥ T fâˆˆâ„±âˆªğ’¦ğ’¦âˆªâ„âˆªğ’¢ğ’¢

ï¿½ (I,pm,rm,zm,â‰½) and D(I,pm,rm,zm,Î²,Ïƒ,Îµ) denote the continuous good demands given by (15) for the
(iv) Let D
ï¿½ and V respectively. If on a closed subset A of [ILâ€“pU,IU]Ã—RÃ—Z, V is continuously
indirect utility functions V
differentiable in (I,r), then X can be selected with a sufficient number of terms so that on the set A and except
ï¿½ (I,pm,rm,zm,â‰½) â€“ D(I,pm,rm,zm,Î²(â‰½),Ïƒ(â‰½),Îµj)| < Î³
for sets of â‰½ and Îµ that each have probability at most Î³/3, |ğ·ğ·
uniformly.

ï¿½ï¿½ğ¼ğ¼ â€“ ğ‘ğ‘jm , ğ«ğ«m , ğ‘§ğ‘§jm , â‰½ï¿½ + Î´ for j âˆˆ ğ‰ğ‰ & j â‰  k} for
ï¿½(ğ¼ğ¼ â€“ ğ‘ğ‘km , ğ«ğ«m , ğ‘§ğ‘§km , â‰½) > V
Proof: Let HÎ´# (I,pm,rm,zm) = â‹ƒkâˆˆğ‰ğ‰m{â‰½âˆˆ H |V
m

0 < Î´ â‰¤ Î³. Then HÎ´# (I,pm,rm,zm) â†˜ H # (I,pm,rm,zm), and A4 implies that there exists Î´(I,pm,rm,zm) > 0 such that

#
ï¿½ on [ILâ€“pU,IU]Ã—RÃ—ZÃ—H implies there exists an open
(I,pm,rm,zm)|s) â‰¥ 1 â€“ Î³/2. Further, the continuity of V
F(HÎ´(ğ¼ğ¼,ğ©ğ©
m ,ğ«ğ«,ğ³ğ³m )
#
ï¿½ m,ğ’“ğ’“ï¿½,ğ’›ğ’›ï¿½m) âˆˆ
neighborhood N(I,pm,rm,zm) in [ğ¼ğ¼ L , ğ¼ğ¼ U ] Ã— P|ğ‰ğ‰m | Ã— R Ã— Z|ğ‰ğ‰m | such that â‰½ âˆˆ HÎ´(ğ¼ğ¼,ğ©ğ©
(I,pm,rm,zm) and (ğ¼ğ¼Ìƒ,ğ’‘ğ’‘
m ,ğ«ğ«,ğ³ğ³m )

ï¿½ï¿½ğ¼ğ¼Ìƒ â€“ ğ‘ğ‘ï¿½ , ğ«ğ«ï¿½, ğ‘§ğ‘§ï¿½km , â‰½ï¿½ âˆ’ max V
ï¿½(ğ¼ğ¼Ìƒ â€“ ğ‘ğ‘ï¿½ , ğ«ğ«ï¿½, ğ‘§ğ‘§ï¿½ jm , â‰½)} > Î´(ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m )/2 .
N(I,pm,rm,zm) imply max{V
km
jm
kâˆˆğ‰ğ‰m

jâ‰ k

One can then

extract a finite family of these open neighborhoods that cover [ğ¼ğ¼ L , ğ¼ğ¼ U ] Ã— P|ğ‰ğ‰m | Ã— R Ã— Z |ğ‰ğ‰m | . Let Î´0 > 0 denote the
Î´

0
. Recall that Z is a finite
minimum of the Î´(I,pm,rm,zm) for this finite family and define a constant Ïƒ = Ïƒ(â‰½) â‰¡ 12Î·

union of disjoint rectangles. Combine each of these rectangles with the rectangular domains of income and prices,
shift and scale these rectangles so they form a unit cube, and apply Appendix Theorem A.1 to establish the
existence of a vector of multivariate polynomials v(I,rm,zjm,â‰½) â‰¡ X(ğ¼ğ¼, ğ«ğ«m , ğ‘§ğ‘§jm ) â‹… Î²(â‰½) that satisfy |vï¿½ (I,rm,zjm,â‰½) â€“
17

v(I,rm,zjm,â‰½)| <

Î´0
â‰¤
12

Î³. From the properties of EV1 variates, the event C has Prob(C) > 1 â€“ Î³/2, and if C, then |ÏƒÎµj |

< Î´0/12. In the event C, V(I,rm,zjm,â‰½) given by (17), (i) is established by

ï¿½(I,rm,zjm,â‰½) â€“ V(I,rm,zjm,â‰½)| â‰¤ ï¿½vï¿½ğ¼ğ¼, ğ«ğ«m , ğ‘§ğ‘§jm , â‰½ï¿½ âˆ’ vï¿½ ï¿½ğ¼ğ¼, ğ«ğ«m , ğ‘§ğ‘§jm , â‰½ï¿½ï¿½ + |ÏƒÎµj | < Î´0/6.
|V

ï¿½ m,ğ’“ğ’“ï¿½,ğ’›ğ’›ï¿½m) âˆˆ [ğ¼ğ¼ L , ğ¼ğ¼ U ] Ã— PJm +1 Ã— R Ã— Z Jm +1 , let (I,pm,rm,zm) be the center of a neighborhood in
For any point (ğ¼ğ¼Ìƒ,ğ’‘ğ’‘

#
ï¿½ m,ğ’“ğ’“ï¿½,ğ’›ğ’›ï¿½m). The probability of the event Câˆ©HÎ±(ğ¼ğ¼,ğ©ğ©
the open cover that includes (ğ¼ğ¼Ìƒ,ğ’‘ğ’‘
(I,pm,rm,zm) is at least 1 â€“ Î³.
m ,ğ«ğ«,ğ³ğ³m )

In

this

case,

Î´ï¿½ğ¼ğ¼,ğ©ğ©m ,ğ«ğ«ğ¦ğ¦ ,ğ³ğ³m ï¿½
V(ğ¼ğ¼Ìƒ â€“ ğ‘ğ‘ï¿½km , ğ«ğ«ï¿½, ğ‘§ğ‘§Ìƒkm , â‰½) âˆ’ max Vï¿½ğ¼ğ¼Ìƒ â€“ ğ‘ğ‘ï¿½jm , ğ«ğ«ï¿½, ğ‘§ğ‘§Ìƒjm , â‰½ï¿½ >
> Î´0 /2
2

jâ‰ k

for

some

k

implies

ï¿½(ğ¼ğ¼Ìƒ â€“ ğ‘ğ‘ï¿½km , ğ«ğ«ï¿½, ğ‘§ğ‘§Ìƒkm , â‰½) âˆ’ max ğ•ğ•
ï¿½(ğ¼ğ¼Ìƒ â€“ ğ‘ğ‘ï¿½jm , ğ«ğ«ï¿½, ğ‘§ğ‘§Ìƒjm , â‰½) > Î´0 /6. Then (ii) holds with probability at least 1 â€“ Î³. The
V
jâ‰ k

bound on the difference between the exact and approximate choice probabilities then follows.

The proof of (iii) utilizes results on convergence of empirical processes given in Appendix A. The functions in
the family â„±1, and hence in â„±2, are linear in (Î²,Î³,Îµ0,â€¦,Îµ|J|). Then these families are contained in a finite-

dimensional subspace defined by their intercepts and slope coefficients. The functions in â„±2 are Lipschitz in

these intercepts and slope coefficients, implying that â„± is Lipschitz in these parameters. By construction, the
domain [ILâ€“pU,IU]Ã—RÃ—ZÃ—â„¬Ã—ğ’®ğ’® and the domain â„¬Ã—[ÏƒL,ÏƒU] of (Î²,Ïƒ) are compact, so that v(I,pjm,rm,zjm,Î²) is bounded

on its domain by a constant M. Therefore, f* = M + ÏƒU|Îµ| is an envelope function for â„±1 and 2f* is an envelope
function for â„±2 , and hence for â„±, that from Appendix B(a) satisfies EFf* â‰¤ M + 1.219384 ÏƒU. The family ğ’¦ğ’¦ is

Lipschitz in (Î²,Ïƒ) âˆˆ â„¬Ã—[ÏƒL,ÏƒU] since ÏƒL > 0, with envelope function f* â‰¡ 1. Apply Theorem A.3 to establish the
result for â„± and ğ’¦ğ’¦, and Theorem A.4 to establish the result for â„ and ğ’¢ğ’¢.

ï¿½ is almost everywhere continuously differentiable in (I,r), and where it is, continuous good
From Theorem 2.5, V

demands are unique and are given by (15). Let A be a closed set on which this continuous differentiability holds.
Then, Lemma 6 establishes that the derivatives of V approximate uniformly on A the corresponding derivatives of
ï¿½. Combined with the bi-Lipschitz property of V
ï¿½ in I, this establishes (v). âˆ
V

The additive EV1-distributed disturbances Îµj in (17) are introduced as a mathematical convenience,

perturbations that for small positive Ïƒ(â‰½) smooth expected utility and give choice probabilities that are wellbehaved mixed multinomial logits, while approximating closely the choices and continuous good demands from
the underlying true utility. Under Assumptions A1-A4, the approximation properties (i), (iii), and (iv) of Theorem
2.7 continue to hold even in the limit Ïƒ(â‰½) â‰¡ 0. The EV1 and independence assumptions on the Îµj are not essential
for smoothing the choice probabilities; any absolutely continuous distribution with well-behaved tails
accomplishes this. The Îµj in (17) can be treated as predetermined at the time of consumer choice, and thus
18

independent of income transfers or market scenario, so that (17) is consistent with fully neoclassical consumer

behavior. In the literature on discrete choice, the Îµj are often characterized as random perturbations or tremble

in individual utility, and attributed to the limits of psychophysical discrimination, as in Thurstone (1927). This
relaxation of neoclassical assumptions can be made more general by allowing the individual consumerâ€™s
preference preorder â‰½ to be a random draw from H in each choice situation, perhaps representable as tremble
centered on a core preference preorder. In this case, FH is a convolution of population heterogeneity in core

preferences and individual preference tremble. The implications of true preference tremble for demand analysis
and the welfare calculus are deferred to the section on decision versus experienced utility.
Result (iii) in this theorem shows that utility and the distribution of tastes can be approximated using the
empirical distribution of the finite-dimensional taste parameters (Î²,Ïƒ). This can be interpreted as a member of
the finite-parameter family that places probability at each support point. Obviously, it is then possible to achieve
an approximation of the same precision using other finite-parameter families of distributions with the same
number of parameters. The proof of this theorem assumes a constant for the scaling factor Ïƒ, and this is sufficient

for the approximation results, but allowing heterogeneity in Ïƒ may allow more parsimonious approximations with
respect to the specification of Î².

The direct utility function (5) given by Lemma 2 can be interpreted as a continuous mapping from the compact

space of preferences H onto a compact subset ğ’°ğ’° of the normed linear space â„­(Qâ€™Ã—Z) of continuous real-valued

functions u:Qâ€™Ã—Z âŸ¶ â„.

The probability FH on H induces a probability FU on ğ’°ğ’° that satisfies FU(A|s) =

FH({â‰½âˆˆH|U(â‹…,â‹…,â‰½)âˆˆA} | s) for measurable subsets A of ğ’°ğ’°. Then, given A1-A4, the field of preferences can be

characterized by (ğ’°ğ’°,FU) rather than (H,FH). With this characterization, the money-metric utility function (9) in
Lemma 4 is written V:[ILâ€“pU,IU]Ã—RÃ—ZÃ—ğ’°ğ’° âŸ¶ â„, and correspondingly the choice indicator Î´k(ğ¼ğ¼, ğ©ğ©m , ğ«ğ«ğ¦ğ¦ , ğ³ğ³m , U) from

(14) and continuous good demand D(I,pm,rm,zm,U) from (15) are written as functions of U âˆˆ ğ’°ğ’°.

Consider the family (17) of the indirect utility functions V(Im â€“ pjm,rm,zjm,Î²,Ïƒ,Îµj) â‰¡ Im + v(Im,pjm,rm,zjm,Î²) + ÏƒÎµj,

where v(Im,pjm,rm,zjm,Î²) â‰¡ X(Im â€“ pjm,rm,zjm)âˆ™Î² â€“ pjm. A major simplification of the welfare calculus occurs when

v(I,pjm,rm,zjm,Î²) is independent of income. Make explicit the price index Ï€ = Ï€(rm) used to deflate income and

prices to real terms, where Ï€(ra) = Ï€(rb) by assumption, and rewrite V as

(18)

V(Im â€“ pjm,rm,zjm,Î²,Ïƒ,Îµj) = Im/Ï€(rm) + v(pjm/Ï€(rm),rm/Ï€(rm),zjm,Î²) + ÏƒÎµj.

But this is a Gorman Polar Form, with the properties that choice among the products j âˆˆ Jm is independent of
income, and continuous good demands have the form

19

(19)

D(I,pm,rm,zm,Î²,Ïƒ,Îµm) = â€“âˆ‚v(pjm/Ï€(rm),rm/Ï€(rm),zjm,Î²)/âˆ‚rm + [Im + v(pjm/Ï€(rm),rm/Ï€(rm),zjm,Î²)]âˆ‚ln Ï€(rm)/âˆ‚rm ,

so that the only goods showing income effects are those whose prices influence the index Ï€, and the Engle curves
for these goods are affine linear. The Gorman polar preference field has been studied extensively in welfare
economics, and has important aggregation properties for both continuous and discrete choice; see Chipman and
Moore (1980,1990), Small and Rosen (1981), and McFadden (2004,2014). The Gorman form (19) defines a hedonic
preference field in which product attributes influence tastes only through an effective price, ğ‘ğ‘ï¿½jm = pjm â€“ X(rm,zjm)âˆ™Î².
The approximation (17) is consistent with the approach to welfare analysis taken by Jorgenson (1997) using

translog utility function families with parameterized observed heterogeneity. Other empirical demand analysis
systems, such as generalized Gorman (Blackorby et al, 1978) or Deaton-Muellbauer (1980), can also be interpreted
as specializations of (17). The money-metric property imposed on (17) will in general put side restrictions on the
parameters of these functional families. These are most easily handled in applications by specifying (17) without
the money-metric restriction, and then obtaining the marginal utility of income from these forms that can later
be used to convert utility differences to (approximate) money-metric terms.

3. WELFARE ANALYSIS
We restate for product markets the neoclassical welfare calculus outlined in Section 1, utilizing the treatment
of consumer theory given in Section 2. 8 There is a baseline, â€œas is,â€ or â€œdefaultâ€ policy/scenario m = a and a
counterfactual, â€œbut for,â€ or â€œreplacementâ€ policy/scenario m = b. 9 Consumers face menus of mutually exclusive
products j âˆˆ Jm âŠ† J with at least one â€œbenchmarkâ€ or â€œno purchaseâ€ alternative whose attributes are unaffected

by scenario changes. 10 Our analysis will be carried out for a population of consumers who are neoclassical

maximizers of preferences that satisfy Assumptions A1-A4 and that are predetermined and unaffected by income

The basics of this theory can be found in Varian (1992, Chap. 7, 10), Mas-Colell, Whinston, and Green (1995, Chap. 3), and
other graduate-level textbooks. See also McFadden and Winter (1966) and Border (2014).

8

For convenience we will use the â€œbaseline/as is/defaultâ€ and â€œcounterfactual/but for/replacementâ€ labels for both
retrospective analysis of past policy and prospective analysis of policies not yet implemented, noting that these labels are
arbitrary and interchangeable in many prospective applications. In retrospective applications, associating a with the
historical scenario and b with the counterfactual leads to measures of welfare change often termed â€œWillingness to Payâ€
(WTP), while reversing these labels and making b the baseline leads to â€œWillingness to Acceptâ€ (WTA) welfare measures.
9

If the products in an application are not mutually exclusive, or the consumer can buy more than one unit of a product,
then J indexes the mutually exclusive possible portfolios of product purchases. In general, J may index locations or
â€œaddressesâ€ in physical or hedonic space, and with added technical machinery is not restricted to be finite.
10

20

transfers or scenario changes that alter market opportunities. 11 These consumers have indirect decision-utility
functions that from Theorem 2.7 are uniformly approximated by
(20)

V(I â€“ pjm,rm,zjm,Î²,Ïƒ,Îµj) â‰¡ I + vjm(I,Î²) + ÏƒÎµj,

where vjm(I,Î²) is shorthand for v(I,pjm,rm,zjm,Î²) â‰¡ X(I â€“ pjm,rm,zjm)Î² â€“ pjm. The vector Î² and positive scalar Ïƒ are

randomly distributed in the population with a probability F(Î²,Ïƒ|s,ğ›¼ğ›¼) that is in a parametric family with parameter
Î±, given observed socioeconomic history s, and the Îµj are independent standard Extreme Value type I random
variables. As discussed earlier, the Îµj are introduced as a mathematical convenience, but will often be interpreted

as contributions of unobserved perceptions and attributes to the utility of product j. By construction, V is moneyk
metric for a â€œno purchaseâ€ or â€œbenchmarkâ€ alternative in scenario a (e.g., v(I,p0a,ra,z0a,Î²) â‰¡ 0). In the event Hm
=

{Îµ | V(I â€“ pkm,rm,zkm,Î²,Ïƒ,Îµk) > V(I â€“ pjm,rm,zjm,Î²,Ïƒ,Îµj) for j âˆˆ Jm\{k}}, the consumer maximizes (20) at alternative k âˆˆ
Jm, an event indicated by Î´km(I,Î²,Ïƒ,Îµ) = 1, with a probability that is uniformly approximated by a mixed multinomial

logit (MMNL),
(21)

Pkm = Pk(I,pm,rm,zm,,s,ğ›¼ğ›¼) â‰¡ EÎ²,Ïƒ|s ğ¿ğ¿km (ğ¼ğ¼, Î², Ïƒ) ,

where ğ¿ğ¿km (ğ¼ğ¼, Î², Ïƒ) = âˆ‘

exp(vkm (ğ¼ğ¼,Î²)/ğœğœ )

jâˆˆğ‰ğ‰m exp(vjm (ğ¼ğ¼,Î²)/ğœğœ)

is the â€œflatâ€ multinomial logit probability of Î´km(I,Î²,Ïƒ,Îµ) = 1 given (Î²,Ïƒ).

The components of the vector of taste parameters Î² are termed â€œpart-worthâ€ or Willingness-to-Pay (WTP)
coefficients for unit changes in the corresponding components of X. Unconditional maximum indirect utility in
scenario m when income is I , our policy-independent yardstick for welfare analysis, then satisfies
(22)

um = ğ’±ğ’±(ğ¼ğ¼, ğ©ğ©m , ğ«ğ«m , ğ³ğ³m , Î², Ïƒ, ğ›†ğ›†) â‰¡ max [I + v(I,pjm,rm,zjm,Î²) + ÏƒÎµj].
jâˆˆğ‰ğ‰m

There are three substantive questions whose resolution affects the form of the welfare calculus: (1) Is the

analysis prospective, comparing policies not yet put into place, or retrospective, comparing â€œas isâ€ and â€œbut forâ€
past policies? (2) Is information on the tastes of individual consumers complete or partial, and if partial what
welfare measures are relevant to transfers that can actually be fulfilled? (3) Should well-being be assessed in
terms of the decision-utility postulated to determine economic demand behavior, or in terms of experiencedutility after taste ambiguities and uncertainties are resolved? These questions are discussed in Sections 4, 5, and

Our analysis lumps unobserved perceptions and attributes of alternatives together with unobserved preferences. To
maintain taste invariance when these unobserved factors are influenced by policy, we would need to make these sources of
randomness explicit and consider how to detect their presence and identify their influence on welfare.
11

21

6 below. In the remainder of this section, we restate for our general model of discrete product choice and
neoclassical assumptions the welfare measures introduced in Section 1.
A standard welfare measure for the net gain in well-being from scenario b relative to scenario a is Hicksian
Compensating Variation (HCV), the net decrease in scenario b income that makes the two scenarios indifferent.
Let HCV(s,k,Î²,Ïƒ,Îµ) denote this measure for an observed history s and scenario a choice k, and a vector (Î²,Ïƒ,Îµ) of
unobservables. 12 In terms of the conditional indirect utility function (21), HCV(s,k,Î²,Ïƒ,Îµ) satisfies
(23)

max [ğ¼ğ¼b âˆ’ HCV + v(ğ¼ğ¼b âˆ’ HCV, ğ‘ğ‘jb , ğ«ğ«b , ğ‘§ğ‘§jb , Î²) + ÏƒÎµj ] = ğ¼ğ¼a + v(ğ¼ğ¼a , ğ‘ğ‘ka , ğ«ğ«a , ğ‘§ğ‘§ka , Î²) + ÏƒÎµk .
jâˆˆğ‰ğ‰b

Removing the conditioning on k when it is not observed gives the measure HCV(s,Î²,Ïƒ,Îµ) = min HCV(ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†).
kâˆˆğ‰ğ‰a

Another standard welfare measure, Hicksian Equivalent Variation (HEV), denoted HEV(s,Î²,Ïƒ,Îµ), is the net increase

in scenario a income that makes the two scenarios indifferent. Because the scenario a choice may change with
the income transfer, HEV does not depend explicitly on the uncompensated scenario a choice k; from (23),
HEV(s,Î²,Ïƒ,Îµ) satisfies
(24)

max [ğ¼ğ¼b + v(ğ¼ğ¼b , ğ‘ğ‘jb , ğ«ğ«b , ğ‘§ğ‘§jb , Î²) + ÏƒÎµj ] = max [ğ¼ğ¼a + HEV + v(ğ¼ğ¼a + HEV, ğ‘ğ‘ja , ğ«ğ«a , ğ‘§ğ‘§ja , Î²) + ÏƒÎµj ].
jâˆˆğ‰ğ‰b

jâˆˆğ‰ğ‰a

Sometimes, HCV is termed Willingness-to-Pay (WTP), and HEV is termed Willingness-to-Accept (WTA); this
terminology is related to the description of Î² as a vector of WTP coefficients, but only in special cases is there a
simple mapping between Î² and HCV or HEV.

The definition of Market Compensating Equivalent (MCE) that generalizes (2) is the difference in the utilities

(23) that the consumer would attain in scenarios a and b in the absence of compensation, scaled by a MUI in
scenario a scaling the utility difference in monetary units. The conditional indirect utility V(I â€“ pjm,rm,zjm,Î²,Ïƒ,Îµj) â‰¡

I + v(I,pkm,rm,zkm,Î²) + ÏƒÎµkm is denominated in monetary units and is money-metric for a â€œno purchaseâ€ alternative.

However, if there are neoclassical income effects for other alternatives k, one has âˆ‚V(I â€“ pkm,rm,zkm,Î²,Ïƒ,Îµk)/âˆ‚I â‰¡ 1

+ âˆ‚v(I,pkm,rm,zkm,Î²)/âˆ‚I â‰¢ 1. If alternative k is chosen in scenario a, then
(25) MCE(s,k,Î²,Ïƒ,Îµ) =

Where the MUI,

12

max ï¿½ğ¼ğ¼b + vï¿½ğ¼ğ¼b ,ğ‘ğ‘jb ,ğ«ğ«b ,ğ‘§ğ‘§jb ,Î²ï¿½+ ÏƒÎµj ï¿½âˆ’ max ï¿½ğ¼ğ¼a + vï¿½ğ¼ğ¼a ,ğ‘ğ‘ja ,ğ«ğ«a ,ğ‘§ğ‘§ja ,Î²ï¿½+ ÏƒÎµj ï¿½
jâˆˆğ‰ğ‰
jâˆˆğ‰ğ‰
b

Âµk (ğ¼ğ¼a ,Î²)

a

.

Note that when k is observed in scenario a, the distribution of Îµ is conditioned on the event {Îµ|Î´ka(I,Î²,Ïƒ,Îµ) = 1}.

22

(26)

Î¼k(Ia,Î²) = âˆ‚v(Ia â€“ pka,ra,zka,Î²)/âˆ‚Ia â‰¡ 1 + [âˆ‚X(Ia â€“ pka,ra,zka)/âˆ‚Ia]Î²,

gives a definition of MCE(s,k,Î²,Ïƒ,Îµ) that at least locally has the money-metric property in scenario a. 13 Later, when
we consider cases where choice k in scenario a is not observed, or one observes or uses only the information that
â€œas isâ€ choice is from a set D âŠ† Jm, Î¼k(Ia,Î²) will be replaced by a scale factor Î¼D(Ia,Î²). Note that Î¼k(Ia,Î²) defined

by (26) is independent of Ïƒ and Îµ, and if X does not depend on income, then Î¼k(Ia,Î²) â‰¡ 1.

The measure (25) can be interpreted as a generalization to multiple products with varying attributes of the

Marshallian consumer surplus (MCS) introduced in Section 1; this generalization is more convenient for
applications than multivariate extensions, path-dependent when there are income effects, of the integral form
(2) for MCS. First-order Taylorâ€™s expansions of (24) imply
(27) HCV(ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†) âˆ™ Âµâ€² = HEV(ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†) âˆ™ Âµâ€²â€² = MCE(ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†) âˆ™ Âµk (ğ¼ğ¼a , Î²) ,

where Âµâ€² = 1 + âˆ‚v(Iâ€™ â€“ pjb,rb,zjb,Î²)/âˆ‚I and Âµâ€²â€² = 1 + âˆ‚v(Iâ€ â€“ pka,ra,zkb,Î²)/âˆ‚I are MUI at the chosen alternatives j in

scenario b and k in scenario a, respectively, when there is no compensation, evaluated at incomes Iâ€™ and Iâ€

intermediate between uncompensated and compensated levels. The measures HCV, HEV, and MCE all agree on
sign, but in general can differ in magnitude. However, if the marginal utility of income is constant, then HCV =
HEV = MCE. In general, (24) can be solved quickly for HCV or HEV by iteration starting from MCE.
It is common in applied welfare analysis to aggregate money-metric measures of individual benefits from a
policy change, net of allocated costs and fulfilled transfers, and judge the change desirable if this aggregate
welfare measure exceeds unallocated costs. Ideally, the cost allocation and fulfilled transfers exhaust the feasible
opportunities for socially desirable income redistribution, so that the feasibility-constrained social marginal
utilities of income for consumers are the same and equal weighting of consumers in the aggregate welfare
criterion is appropriate. Restrictions on the nature of the preference field, the set of policies under consideration,
and/or the measure of individual welfare are required for the aggregate welfare criterion to order policies and
identify a best policy; otherwise, it may fail to satisfy the irreflexivity or transitivity conditions required of an order.

The scale factor Î¼k(Ia,Î²) in the definition of MCE is natural for retrospective analysis where the consumer has experienced
scenario a, or for prospective analysis when scenario a is a default that will occur unless there is a policy intervention, and
is unambiguous when indirect utility has been transformed so that the marginal utility of income in scenario a remains
constant when income changes. However, more generally, MCE will be affected by transformations of utility and the
evaluation point for the marginal utility of income, and additional criteria may be needed to select among alternative
versions of MCE.

13

23

When the aggregate criterion does order policies, it has the properties of a Bergson (1938) social welfare function,
and is then subject to the challenges of social choice theory; see Arrow (1950), Harsanyi (1955), Sen (2017, p. 385).
If the set of policies under consideration along with their accompanying fulfilled transfers are Pareto-ordered,
then the aggregate welfare criterion with any of the transfers HCV, HEV, or MCE will follow the same order.
Alternately, when marginal utilities of income are constant over the domain of consumption induced by the policy
set, and equal across individuals, the aggregate welfare criterion with MCE and any pattern of transfers orders
policies; this case corresponds to a preference field of Gorman polar form with parallel income-expansion paths;
see Chipman and Moore (1980,1990), McFadden (2004). Kaldor (1936) and Scitovsky (1942) give an argument
that suggests the aggregate welfare criterion using HCV, termed the Kaldor-Hicks criterion, orders policies, and
that this is a basis for preferring HCV over MCS. On closer examination, this argument holds only in cases such as
constant, equal marginal utilities of income, or policies incorporating transfers that are Pareto-ordered, in which
case, either HCV or MCE can be used. Otherwise, the aggregate welfare criterion with either HCV or MCE may fail
to order the policy alternatives.
With the apparatus above, practical welfare analysis of product markets can be carried out in three steps.
First, observations on the market choices of surveyed consumers, augmented by extra-market data on stated
preferences if necessary to identify tastes for relevant attributes, can be used to estimate the mixed MNL model
(22) and recover the probability F(Î²,Ïƒ|s,ğ›¼ğ›¼). An obvious caution is that the vector of predetermined functions X in
(21) has to be comprehensive enough to achieve the approximation accuracy promised by Theorem 2.7, so that
estimation of (22) needs to include a careful econometric specification analysis. A â€œmethod of sievesâ€ approach
to the specification of X provides practical guidelines for this specification search. With this caveat, this setup is
both practical and sufficiently general to handle welfare analysis of policy changes that affect discrete choice
without making unwarranted assumptions on preferences.
Second, construct a large synthetic population. Start from a random sample from the target population. For
each sampled person, assign a history s, incomes Ia and Ib, choice sets Ja and Jb, and market environments (pa,ra,za)
and (pb,rb,zb), using available data for the sampled individual wherever possible in order to preserve ecological
correlations in the target population. Make multiple draws of (Î²,Ïƒ) from the estimated probability F(Î²,Ïƒ|s,ğ›¼ğ›¼) and
of Îµ from the standard Extreme Value Type I distribution. Assign utility-maximizing choices k in scenario a and j in
scenario b. Each draw defines a synthetic consumer.

Third, calculate the measures HCV(ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†), HEV(ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†), and MCE(ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†) from (24) and (25) for

each consumer in the synthetic population. These measures can be aggregated over this synthetic population or
24

subpopulations to estimate hypothetical compensating transfers for relevant consumer classes. However,
transfers that are actually fulfilled in the target population can depend only on observable history s and (if
observed) the scenario a choice k. Define uniform transfers UMCE(s,k) = ğ„ğ„Î²,Ïƒ,ğ›†ğ›†|s,k MCE(ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†) and UMCE(s)

= ğ„ğ„k,Î²,Ïƒ,ğ›†ğ›†|s MCE(ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†). Fulfillment of these transfers in the real population in retrospective welfare analysis
will not in general make individual consumers â€œwholeâ€, but will balance individual gains and losses in the sense

that a MCE welfare measure taken subsequent to these uniform transfers aggregates to zero. In the same way,
one can solve for uniform transfers tk = UHCV(s,k) and t = UHCV(s) that if fulfilled in scenario b balance the gains
and losses from the remaining unfulfilled Hicksian transfers, so that a subsequent MCE aggregates to zero:

(28)

0=

ï¿½ğ¼ğ¼b âˆ’ t k + vï¿½ğ¼ğ¼b âˆ’ t k , ğ‘ğ‘jb , ğ«ğ«b , ğ‘§ğ‘§jb , Î²ï¿½ + ÏƒÎµj ï¿½ âˆ’ [ğ¼ğ¼a + v(ğ¼ğ¼a , ğ‘ğ‘ka , ğ«ğ«a , ğ‘§ğ‘§ka , Î²) + ÏƒÎµk ]ï¿½
â§ ğ„ğ„Î²,Ïƒ,ğ›†ğ›†|s,k ï¿½max
jâˆˆğ‰ğ‰
b

â¨ğ„ğ„
ï¿½max ï¿½ğ¼ğ¼ âˆ’ t + vï¿½ğ¼ğ¼b âˆ’ t, ğ‘ğ‘jb , ğ«ğ«b , ğ‘§ğ‘§jb , Î²ï¿½ + ÏƒÎµj ï¿½ âˆ’ [ğ¼ğ¼a + v(ğ¼ğ¼a , ğ‘ğ‘ka , ğ«ğ«a , ğ‘§ğ‘§ka , Î²) + ÏƒÎµk ]ï¿½
â© k,Î²,Ïƒ,ğ›†ğ›†|s jâˆˆğ‰ğ‰b b

.

Analogous definitions can be given for UHEV(s,k) and UHEV(s). 14 Note that the measures considered in this
paragraph are all based on predetermined decision-utility, with no adjustment for possible tremble in decision
utility or differences in decision and experienced utility.

4. PROSPECTIVE VERSUS RETROSPECTIVE WELFARE ANALYSIS
Traditional welfare theory considers a prospective policy change in a static â€œwhat ifâ€ environment. An
â€œincumbentâ€ or â€œdefaultâ€ policy/scenario a is compared with a â€œreplacementâ€ policy/scenario b in a situation
where neither has been implemented and both are on the table. The theory assumes that the policymaker has
the information and authority to carry out net lump sum transfers in the event that policy b is adopted, adjusted
for direct policy-induced effects on incomes, that make each consumer indifferent between the policies, and
assumes that if policy b is adopted, these transfers are fulfilled before consumers maximize utility. Under these
conditions, the Hicksian Contingent Variation (HCV) defined in (24) is the precise measure of each lump sum
transfer required. If instead, a and b are reversed, so that transfers are fulfilled if a is adopted, then the Hicksian
Equivalent Variation (HEV) is the precise measure of each lump sum transfer required. So long as population

Another approach to defining UHCV(s,k) and UHEV(s,k) is to consider â€representativeâ€ utility for the class of consumers
with history s, perhaps the expectation of (21) with respect to the unobservables, and then define UHCV(s,k), or UHEV(s,k)
as analogs of HCV or HEV for â€œrepresentativeâ€ utility. However, these definitions will not in general have the property that
UHCV(s,k) = ğ„ğ„Î²,Ïƒ,ğ›†ğ›†|ğ‘ ğ‘ ,k HCV(Î²,Ïƒ,Îµ) or UHEV(s,k) = ğ„ğ„Î²,Ïƒ,ğ›†ğ›†|ğ‘ ğ‘ ,k HEV(Î², Ïƒ, ğ›†ğ›†).

14

25

aggregate HCV or HEV, adjusted for policy-induced income changes, exceeds zero, a shift from policy a to policy b
with the exact individual transfers fulfilled, plus any distribution of the residual surplus, is a Pareto improvement.
In practice many welfare calculations are retrospective rather than prospective. The welfare question is what
transfers after the fact redress harm from a past â€œas isâ€ or â€œbaselineâ€ scenario a in which some products were
defective or improperly marketed, using as a benchmark a â€œbut forâ€ or â€œcounterfactualâ€ scenario b in which these
flaws would have been absent. 15 A key feature of these applications is that the transfer occurs after the decisionutility-maximizing choice would have been made in the â€œbut forâ€ scenario, and hence these transfers could not be
a factor in â€œbut forâ€ choice. Put another way, the â€œbut forâ€ utility maximization that would have occurred at the
consumerâ€™s original income will not in general coincide with that assumed in the Hicksian compensating variation
calculation in which the transfer would have been made prior to consumer choice and would have influenced that
choice. Since at the time the corrective transfer is being considered, the consumer is in the â€œas isâ€ situation, this
transfer is denominated in â€œas isâ€ monetary units. Then, the transfer that â€œmakes whole the consumer with choice
k in the baseline scenarioâ€ equals the difference in the utilities (21) that would have been attained in the â€œbut forâ€
and â€œas isâ€ scenarios, scaled to â€œas isâ€ monetary units, the MCE (25).
Suppose the purpose of a prospective policy analysis is not to actually fulfill the HCV or HEV transfers associated
with a move from scenario a to scenario b, but simply to determine whether it is possible in principle to
compensate consumers so that the move from scenario a to scenario b would be a Pareto improvement. Then,
arguably, aggregate MCE rather than aggregate HCV or HEV is the appropriate welfare criterion. Further, MCE is
easier to compute and aggregate than HCV or HEV, since it is obtained as an explicit solution (25) from the indirect
utility functions (21) of individual consumers, and the distribution of these solutions in the target population.
Equation (27) shows that HCV, HEV, and MCE differ only due to differences in the marginal utility of income at
different arguments. Later, we show in examples that these differences are often but not always modest. Then,
the distinction between prospective and retrospective welfare measures often will be empirically unimportant,
but occasionally will be of practical as well as theoretical significance.
The distinction we have made between prospective and retrospective welfare analysis does not require explicit
consumer dynamics, but a MCE transfer to redress past harm obviously occurs at some time later than the period

Retrospective policy analysis is often conducted in conjunction with litigation, and statues and legal rulings often control
the definition of harm and the scope and magnitude of remedies. These legal standards are often rooted in economic
arguments, but may nevertheless deviate from a purely economic analysis of harm and remedy. In this paper, we consider
only the economic foundation of retrospective analysis, and do not take up legal considerations.
15

26

of the harm, introducing issues such as discounting and pre-judgement interest, but more fundamentally the
longer-run impacts of injury on consumer assets and opportunities. We leave this as a topic for future research,
but note that in a fully dynamic model, the impact of policy on state variables justifies scaling MCE in monetary
units that make the consumer whole in terms of lifetime well-being. 16

5. PARTIAL OBSERVABILITY AND WELFARE AGGREGATES
Traditional welfare analysis assumes that the individual utility functions required to calculate measures of
well-being can be recovered fully (with money-metric scaling) from observations on this consumerâ€™s market
choices. This is unrealistic, first because the analyst typically has observations on a consumerâ€™s choices in only a
small number of market environments, often only one, and because markets are observed only over a limited
range of conditions. For example, variations in historical product prices are limited by production costs and
competition between products, and the dimensionality of possible product attributes is high, with only a limited
range of bundles of attributes appearing in historically available products. However, different consumers
generally face somewhat different observed market environments, and if one can maintain the consumer
sovereignty assumption that consumer tastes are predetermined at the time of market choice, and assume
plausibly that given s there is no ecological correlation of market environments and tastes, then observations
across consumers can be used to estimate the distribution of tastes in the population. Further, in many
applications it is reasonable to assume that consumers value products using hedonic effective prices that adjust
market price for the attributes of the product; then the analysis can recover distributions of hedonic weights. This
will often be sufficient to infer the distribution of consumer utilities for new or modified products even if their
specific configurations of attributes are novel.
A more challenging recovery problem arises when markets are incomplete, due to transaction costs,
asymmetric information that causes market failure through adverse selection and moral hazard, or failure to

Technically, retrospective welfare analysis should be conducted with a multi-period consumer model, with redress in
the second period from harm in the first period. If the consumer has intertemporarly separable utility, then the ideal MCE
measure satisfies V1b(I1) + V2(I2 â€“ MCE) = V1a(I1) + V2(I2), where V1 and V2 are indirect utilities for the respective periods, and
non-income arguments in indirect utility are suppressed. Applying the first mean value theorem for integrals, MCE = [V1b(I2)
â€“ V1a(I1)]/Î¼2, where Î¼2 is a marginal utility of income in the second period. But the consumer will allocate income between
periods to equate marginal utilities of income (without accounting for MCE), so that Î¼2 will to a first approximation equal
Î¼(Ia,Î²,Ïƒ). Consequently, the MCE defined in (25) approximates the two-period ideal. Further analysis of intertemporal utility
to sharpen the definition of MCE is left to the reader.
16

27

establish ownership and control of the distribution of some goods and services. For example, consumers cannot
insure against some kinds of events, cannot directly purchase environmental amenities such as clean air and
unpolluted beaches, and lack market opportunities that show their tastes for â€œexistence goodsâ€ such as protecting
endangered species or reducing global warming. If there is sufficient market redundancy, or if there are active
margins where unmarketed and marketed goods are complements or substitutes, then it may be possible to
recover indirectly preferences for unmarketed goods. For example, consumer preferences for environmental
amenities are reflected in their willingness to travel to unpolluted beaches or move to neighborhoods with cleaner
air. However, when preferences for unmarketed goods and services leave no market trace, they obviously cannot
be recovered from market data. Experimental methods for directly eliciting stated preferences for these goods in
hypothetical markets are successful in some marketing contexts, but sensitivity to context and framing can make
experimental data unreliable; see Ben Akiva et al (2016), McFadden (2017), Miller et al. (2011). For the remainder
of this section, we assume that there is sufficient market information to recover distributions of preferences in
the population, and study the construction of aggregate measures of welfare. These aggregates may be sufficient
for policy decisions, or sufficient to determine transfers that are judged appropriate to remedy harm to a class of
consumers even if the compensation is not exact for each individual.
When a welfare analysis seeks to fulfill the transfers HCV, HEV, or MCE that in retrospective or prospective
applications leave a class of consumers indifferent to the policy change, an obvious limitation is that an actual
transfer to a consumer can be a function only of observed characteristics. It is common in applied welfare analysis
to estimate welfare effects by postulating a representative consumer whose demands are close to the per capita
market demands of a consumer class, calculating the transfer that keeps â€œrepresentativeâ€ utility constant, and
assuming that this per capita transfer could in principle be redistributed to keep the utility of each consumer in
the class constant. A necessary and sufficient condition for the existence of a representative consumer meeting
these conditions exactly is that the utilities of individuals in the class be representable in Gorman Polar Form with
possibly heterogeneous committed expenditures but a common price deflator; see Chipman and Moore (1990),
McFadden (2004). In (21), this requires that the X functions be independent of income, so that discrete choices
will exhibit no neoclassical income effect and HCV, HEV, and MCE coincide. In practical fulfillment of compensating
transfers, the policymaker faces a decision-theory problem in which there will be social losses from under or overcompensation of individuals, and some (Bayesian) criterion must be applied to determine a loss-minimizing
transfer rule. For example, if the policymaker has a quadratic social loss function, and a diffuse Bayesian prior,
the optimal transfer to an individual equals the expected compensating transfer given observed characteristics.
This suggests two rules in the case of partial observability. First, if transfers are fulfilled, prospectively or
28

retrospectively, then they should equal the expected value of the exact compensating transfer given available
information on the individual. Second, the impact of a policy change on a class of consumers in either prospective
or retrospective applications should equal the expected value of the exact aggregate compensating transfers, with
the appropriate compensating transfers determined by whether or not the transfers are hypothetical or fulfilled,
and if the latter, whether this occurs before or after preference-maximizing choices in each scenario.
Relevant aggregates defined in Section 3 are the expected values UMCE(s,k) = ğ„ğ„Î²,Ïƒ,ğ›†ğ›†|s,k MCE(ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†) and

UMCE(s) = ğ„ğ„k,Î²,Ïƒ,ğ›†ğ›†|s MCE(ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†), or uniform Hicksian measures such as UHCV(ğ‘ ğ‘ , k) and UHCV(ğ‘ ğ‘ ). Section 3

describes a computational approach to forming the relevant aggregates using a synthetic population; this
approach can accommodate any assumptions the analyst chooses on the properties of Îµ and the observed

histories on which the welfare measures are conditioned. However, in selected cases, it is possible to reduce

computation by forming analytic expectations with respect to Îµ. In the remainder of this section, we do this for
the case where the scenario a choice is not observed, and three cases where this choice is observed: (A) all

products, even â€œbrandsâ€ whose prices and attributes do not change between scenarios, have distinct indices in
the two scenarios; (B) â€œbrandsâ€ with changing attributes and prices across scenarios have distinct indices, but
benchmark â€œbrandsâ€ whose attributes and prices do not change have the same indices; and (C) all â€œbrandsâ€ are
present in both scenarios a and b, and have the same indices, even though some have measured attributes or
prices that change. In terms of choice sets, these cases are (A) Jaâˆ©Jb = âˆ…, (B) âˆ… â‰  Jaâˆ©Jb a â‰  JaâˆªJb, and (C) Ja = Jb.

Since the Îµj are approximation elements added for convenience, rather than utility components with deeper
justification from consumer behavior, one should be able to pick from the cases (A)-(C) to get the most convenient

computational formulas. However, if this makes a substantial difference in the overall level or distribution of
compensating transfers, then (20) needs to be respecified to reduce the relative contribution of the Îµj elements.

Case (A) is plausible if the consumer has a fixed idiosyncratic contribution Îµj to utility for each good j, but perceives

of all goods in a new choice situation as if they were entirely new products. This stretches the neoclassical

assumption of predetermined and fixed preferences, as it is equivalent to allowing a special preference tremble
that can vary with choice situation. Cases (B) and (C) more easily fit the neoclassical interpretation of the Îµj as

contributions from persistent unobserved attributes of branded products.

Consider the unconditional indirect utility function (22). Appendix B(b) shows that its expectation with respect
to (Î²,Ïƒ,Îµ), given history s, income I, and scenario m is
(29)

EÎ²,Ïƒ|s EÎµ max [I + v(I,pjm,rm,zjm,Î²) + ÏƒÎµj] = I + EÎ²,Ïƒ|s {Ïƒ âˆ™ ln âˆ‘jâˆˆJm expï¿½vjm (ğ¼ğ¼, Î²)â„Ïƒï¿½ + ğœğœ âˆ™ Î³0 },
jâˆˆğ‰ğ‰m

29

where Î³0 denotes Eulerâ€™s constant and vjm (ğ¼ğ¼, Î²) â‰¡ vï¿½ğ¼ğ¼, ğ‘ğ‘jm , ğ«ğ«m , ğ‘§ğ‘§jm , Î²ï¿½. Scaling and differencing for m = b,a,
(30)

âˆ‘jâˆˆJ expï¿½vjb (ğ¼ğ¼b ,Î²)â„Ïƒï¿½
b

UMCE(s) â‰¡ ğ„ğ„k,Î²,Ïƒ,ğ›†ğ›†|s MCE(ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†) = ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  [Ib â€“ Ia + Ïƒ âˆ™ ln âˆ‘

jâˆˆJa expï¿½vja (ğ¼ğ¼a ,Î²)â„Ïƒï¿½

]/Î¼(Ia,Î²,Ïƒ) ,

where the mean scaling factor Î¼(Ia,Î²,Ïƒ) is a weighted harmonic mean of the marginal utilities of income (26), with
the MNL choice probabilities from (22) as weights, that depends on Ïƒ through these weights,

(31)

1
Âµ(ğ¼ğ¼a ,Î²,Ïƒ)

â‰¡ ğ„ğ„k|,Î²,Ïƒ

1
Âµk (ğ¼ğ¼a ,Î²)

= âˆ‘kâˆˆJa

ğ¿ğ¿km (ğ¼ğ¼a ,Î²,Ïƒ)
Âµk (ğ¼ğ¼a ,Î²)

.

A Hicksian analogue of (30) is obtained by forming the expectation of (24) and solving
(32)

0 = ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  [ğ¼ğ¼b âˆ’ UHCV(ğ‘ ğ‘ ) âˆ’ ğ¼ğ¼a + Ïƒ âˆ™ ln

âˆ‘jâˆˆJ expï¿½vjb (ğ¼ğ¼b âˆ’UHCV(ğ‘ ğ‘ ),Î²)â„Ïƒï¿½
b

âˆ‘jâˆˆJ expï¿½vja (ğ¼ğ¼a ,Î²)â„Ïƒï¿½
a

].

A formula for UHEV(s) is more complicated. If scenario a optimal choices before and after the income transfer
change due to income effects, then (29) is replaced by a complex expression from Appendix B(e). However, if the
marginal utility of income Î¼k(Ia,Î²) from (26) is independent of Ia and k remains the optimal choice after the transfer,
then from (27), UHEV(s) = UMCE(s). Of course, if discrete choice exhibits no income effects, then the definitions
above satisfy UMCE(s) = UHCV(s) = UHEV(s).
Next consider situations (A), (B), and (C) defined above in which choice of alternative k in scenario a is observed,
Î´k (ğ¼ğ¼a ) = 1.

(A) From Appendix B(b), expected utility given the utility-maximizing choice k is the same as (29) when m = a

and I = Ia. Further, independence implies that (29) will also apply when m = b and I = Ib.

Then, (32) with

conditioning on k added continues to hold in case (A), with a solution defining a uniform transfer UHCV(s,k) for
each k. Further, (30) is altered only by substituting the choice-k specific scale factor (26), giving
(33)

âˆ‘jâˆˆJ expï¿½vjb (ğ¼ğ¼b ,Î²)â„Ïƒï¿½

UMCE(s,k) = ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘ ,k [Ib â€“ Ia + Ïƒ âˆ™ ln âˆ‘

b

jâˆˆJa expï¿½vja (ğ¼ğ¼a ,Î²)â„Ïƒï¿½

]/Î¼k(Ia,Î²) .

Note that (30) is the expectation of (33) with respect to the MNL probability ğ¿ğ¿km (ğ¼ğ¼a , Î², Ïƒ). While the formula (33)

depends on k only due to the scale factor, its expectation conditioned on choice k in a population with

heterogeneous observed environments will in general vary substantially with k due to selection on the
environments that yield this choice.
30

(B) Suppose the alternatives in JaâˆªJb can be partitioned into a set A of alternatives with indices that appear

only in Ja; a set B of alternatives that appear only in Jb; and a set C of â€œbenchmarkâ€ alternatives appearing in both
scenarios that satisfy vja(Ia,Î²) = vjb(Ib,Î²) for j âˆˆ C; this requires that their attributes and prices not change, and if

these vjm depend on income, that Ia = Ib. As a result of this assumption, the vjm(I,Î²) â‰¡ vj(I,Î²) for j âˆˆ AâˆªBâˆªC do not

depend on the scenario m.

Utilizing the conditional expectation formulas in Appendix B(c),
(34)

UMCE(s,k) = ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘ ,k ï¿½ğ¼ğ¼b âˆ’ ğ¼ğ¼a + max ï¿½vj (ğ¼ğ¼b , Î²) + ÏƒÎµj ï¿½ âˆ’ (vk (ğ¼ğ¼a , Î²) + ÏƒÎµk )ï¿½ /Âµk (ğ¼ğ¼a , Î²)
jâˆˆBâˆªC

ğ¿ğ¿(C|A,C) ğœğœâˆ™ln(1âˆ’ğ¿ğ¿(A|A,B,C))

ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘ ,k
Âµk (ğ¼ğ¼a ,Î²)
ğ¿ğ¿(A|A,C)
âˆ‘jâˆˆBâˆªC expï¿½vj (ğ¼ğ¼b ,Î²)/ğœğœï¿½
1
= ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘ ,k
âˆ’ ğ¼ğ¼a + ğœğœ âˆ™ ln ï¿½ âˆ‘
ï¿½ï¿½
+
ï¿½ğ¼ğ¼
ï¿½
b
Âµk (ğ¼ğ¼a ,Î²)
ğœğœâˆ™ln(1âˆ’ğ¿ğ¿(A|A,B,C))
jâˆˆAâˆªC expï¿½vj (ğ¼ğ¼a ,Î²)/ğœğœï¿½
âˆ’ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘ ,k
Âµ (ğ¼ğ¼ ,Î²)
k a

where L(A|A,B,C) =

v ï¿½ğ¼ğ¼ ,Î²ï¿½/ğœğœ
âˆ‘jâˆˆA ğ‘’ğ‘’ j b

v (ğ¼ğ¼ ,Î²)/ğœğœ
âˆ‘jâˆˆAâˆªBâˆªC ğ‘’ğ‘’ j a

and L(C|A,C) =

v ï¿½ğ¼ğ¼ ,Î²ï¿½/ğœğœ
âˆ‘jâˆˆC ğ‘’ğ‘’ j b

v (ğ¼ğ¼ ,Î²)/ğœğœ
âˆ‘jâˆˆAâˆªC ğ‘’ğ‘’ j a

if k âˆˆ A
if k âˆˆ C

,

.

The left-hand expectation term in the last line of (34) coincides with the expression (33) for UMCE(s,k)
obtained when the idiosyncratic noise in scenario b is independent of the idiosyncratic noise in scenario a. The
right-hand expectation term is an adjustment for the effect of the conditioning event on the expected maximum
utility from BâˆªC, downward if k âˆˆ A and upward if k âˆˆ C. This expectation incorporates the effects of selection,

which can be powerful if Ïƒ is large: Many choices from A will come from favorable draws of idiosyncratic noise

even when observed attributes make these alternatives unattractive. Then, regression to the mean in draws of
idiosyncratic noise will tend to make alternatives in B less desirable than their analogues in A even if they are

objectively better. In contrast, when the analogues in B of alternatives in A objectively improve, choices from C
that result from a favorable draw will lead to an even better expected outcome in scenario b since alternatives
with this draw remain available. If the scale factors Î¼k(Ia,Î²) vary with k, then the interaction of selection and

income effects no longer gives the result that (30) with scale factor (31) equals the expectation of (34) with respect
to k. For example, if alternatives in A have Î¼k(Ia,Î²) > 1, and alternatives in C have Î¼k(Ia,Î²) = 1, then the expectation

of (34) with respect to k exceeds MCE(s) from (30). Equation (34) can also be adapted to calculate UHCV(s,k) for
this case: Reduce income Ib in scenario b by UHCV(s,k), with this quantity adjusted so that (34) equals zero.

(C) Suppose Ja = Jb = J = {0,â€¦,J}, Î´k (ğ¼ğ¼a ) = 1, and Îµa = Îµb = Îµ, so that all alternatives are indexed the same and

have the same idiosyncratic noise in both scenarios. It is possible to obtain analytic formulas for MCE(s,k) under
31

quite general conditions in which the differences vjb(ğ¼ğ¼bâˆ— , Î²) â€“ vja(ğ¼ğ¼aâˆ— , Î²), evaluated at income levels that may differ

from Ia or Ib respectively due to transfers, vary across multiple alternatives. Appendix B(e) provides formulas that
can be assembled to program this calculation, but these are too complex to be useful for comparison to the
previous cases. We instead consider the special circumstance in which Ia = Ib = I and the scenario affects only
product J, so vjm(I,Î²) is independent of m for j < J. For this case, Appendix A(d) implies the following results:
If k = J, then

(35)

UMCE(s,J) = ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘ ,J

1
ï¿½
ÂµJ (ğ¼ğ¼,Î²) Ïƒ

ğ¿ğ¿Ja

if vJb (ğ¼ğ¼, Î²) > vJa (ğ¼ğ¼, Î²)

vJb (ğ¼ğ¼, Î²) âˆ’ vJa (ğ¼ğ¼, Î²)
âˆ™ ln

v (ğ¼ğ¼,Î²)/ğœğœ
âˆ‘jâˆˆJ e jb

if vJb (ğ¼ğ¼, Î²) < vJa (ğ¼ğ¼, Î²)

v (ğ¼ğ¼,Î²)/ğœğœ
âˆ‘jâˆˆJ e ja

,

while If k < J,
ğ¿ğ¿

Ïƒ

âˆ‘

v (ğ¼ğ¼,Î²)/ğœğœ
e jb

âˆ’ ğ¿ğ¿ Ja (vJb (ğ¼ğ¼, Î²) âˆ’ vJa (ğ¼ğ¼, Î²)) + ğ¿ğ¿ âˆ™ ln jâˆˆJ vja(ğ¼ğ¼,Î²)/ğœğœ
1
âˆ‘jâˆˆJ e
ka
(36) UMCE(s,k) = ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘ ,k (ğ¼ğ¼,Î²) ï¿½ ka
Âµk
0

if vJb (ğ¼ğ¼, Î²) > vJa (ğ¼ğ¼, Î²)

,

if vJb (ğ¼ğ¼, Î²) < vJa (ğ¼ğ¼, Î²)

where Lka = evka(ğ¼ğ¼,Î²)/ğœğœ ï¿½âˆ‘jâˆˆJ evja(ğ¼ğ¼,Î²)/ğœğœ . As in case (B), this formula can be adapted to solve for the transfer

UHCV(s,k) that when fulfilled makes a subsequent UMCE zero, while computation of UHEV(s,k) is in general more
complicated.
We consider an example where due to a fixing agreement the price of a single product, say a tablet computer,

is higher in scenario a than in scenario b. For the alternative configurations of Ja, Jb, and Îµ, we estimate in Table

2 the measures ğ„ğ„Î²,Ïƒ,ğ›†ğ›†|ğ‘ ğ‘ ,k MCE(s,k,Î²,Ïƒ,Îµ), ğ„ğ„Î²,Ïƒ,ğ›†ğ›†|ğ‘ ğ‘ ,k HCV(s,k,Î²,Ïƒ,Îµ), and ğ„ğ„Î²,Ïƒ,ğ›†ğ›†|ğ‘ ğ‘ ,k HEV(s,k,Î²,Ïƒ,Îµ) in a synthetic

population, and the measure UMCE(s,k). Suppose the product J = 1 has price p1m in scenario m. Suppose the â€œno
purchaseâ€ alternative has p0m = 0. Suppose consumers have utilities of the form (21) with v1m(I, Î²) = Î²1I + Î²2 â€“ p1m

for alternatives where the product is purchased, and v0m(I, Î²) = 0 for the â€œno purchaseâ€ alternative, for scenarios
m = a,b. Then Î¼0(Ia,Î²) = 1 and Î¼1(Ia,Î²) = 1 + Î²1. The idiosyncratic noise cases we consider are (A) independent
noise across scenarios, represented by Ja = (0,1} and Jb = {2,3}, with j = 0,2 corresponding to â€œno purchaseâ€ and j

= 1,3 corresponding to â€œpurchaseâ€; (B) Ja = {0,1} and Jb = {0,3}, with j = 0 corresponding to a common â€œno
purchaseâ€ and j = 1,3 corresponding to â€œpurchaseâ€; and (C) Ja = Jb = {0,1}, with j = 0 corresponding to a common
â€œno purchaseâ€ and j = 1 to a common purchase. Suppose that Î²1 = 0.002 and Ïƒ = 9 are fixed parameters, and that
Î²2 is normal with mean zero and standard deviation 60. The choice probabilities are then mixed logit, with P0m(I)

= ğ„ğ„Î²

1
1+exp(vjm (ğ¼ğ¼,Î²)/Ïƒ)

for non-purchase of the product j in scenario m. Suppose the consumer faces p1a = $110
32

and p1b = $90, and the base income is I = $50,000. The probabilities of buying the product in a synthetic
population of 10,000 are P1a(50000) = 0.430, P1b(50000) = 0.555, and P1a(56000) = 0.505. These probabilities
imply an arc income elasticity of 1.45 and an arc price elasticity of -1.59 for the given market changes. The table
shows first that for this example, ğ„ğ„Î²,Ïƒ,ğ›†ğ›†|ğ‘ ğ‘ ,ğ‘ ğ‘ ,k, MCE(s,k,Î²,Ïƒ,Îµ), ğ„ğ„Î²,Ïƒ,ğ›†ğ›†|ğ‘ ğ‘ ,ğ‘ ğ‘ ,k, HCV(s,k,Î²,Ïƒ,Îµ), and ğ„ğ„Î²,Ïƒ,ğ›†ğ›†|ğ‘ ğ‘ ,k HEV(s,k,Î²,Ïƒ,Îµ)
estimated in the synthetic population are almost the same. This result is consistent with the conclusion of Willig
(1976) that income effects are typically small. The value of UMCE using an analytic expectation with respect to
Îµ differs modestly from the synthetic population estimate of ğ„ğ„Î²,Ïƒ,ğ›†ğ›†|ğ‘ ğ‘ ,ğ‘ ğ‘ ,k,MCE(s,k,Î²,Ïƒ,Îµ), but the difference is well

within sampling error. The Marshallian consumer surplus, estimated here using the trapezoid rule, is nearly
identical to UMCE.

Table 2. Comparisons of Welfare Measures ($pp)
Total Population
Marshallian consumer surplus
UMCE (analytic Eğ›†ğ›†)
MCE (synthetic population)
HCV (synthetic population)
HEV (synthetic population)
Class of Product Purchasers
UMCE (analytic Eğ›†ğ›†)
MCE (synthetic population)
HCV (synthetic population)
HEV (synthetic population)
Class of Non-Purchasers
UMCE (analytic Eğ›†ğ›†)
MCE (synthetic population)
HCV (synthetic population)
HEV (synthetic population)

Case A

Case B

Case C

ğ›”ğ›” = 0

9.819
9.848
9.886
9.883
9.886

9.799
9.858
9.806
9.803
9.806

9.781
9.802
9.755
9.753
NC

9.854
9.840
9.840
9.837
9.840

18.568
18.609
18.610
18.609

18.283
18.368
18.368
18.368

19.960
19.960
19.960
NC

19.960
19.960
19.960
19.960

3.305
3.340
3.335
3.340

3.535
3.382
3.375
3.382

2.180
2.097
2.093
NC

2.240
2.240
2.235
2.240

The example suggests that UMCE will be an adequate approximation when ğ„ğ„Î²,Ïƒ,ğ›†ğ›†|ğ‘ ğ‘ ,ka HCV(s,k,Î²,Ïƒ,Îµ) is the

ideal measure. However, the closeness of UMCE and expected HCV is sensitive to the magnitude of the change

in price in the two scenarios, and larger changes can lead to a gap between these measures. In short, when
UMCE is used as an approximation to expected HCV, it is desirable to use synthetic population methods with
large samples to check the quality of the approximation.
There is variation in the welfare measures when one moves from Case A with independent disturbances to
Case C with common disturbances. In particular, Cases A and B attribute less welfare gain to purchasers and
33

more welfare gain to non-purchasers than does Case C and a Ïƒ = 0 case with no idiosyncratic noise. Then, the
assumptions made on the persistence of idiosyncratic errors across scenarios makes a difference.

Table 3. Effect of Idiosyncratic Noise on Distribution of Welfare Changes ($pp)
UMCE
at
Ïƒ=0
Ïƒ=9
Ïƒ = 36
Ïƒ = 64

Buyers
19.960
18.568
13.641
11.687

Case A
Nonbuyers
2.240
3.305
6.943
8.463

Total

Buyers

9.840
9.848
9.895
9.927

19.960
18.283
5.046
-9.086

Case B
Nonbuyers
2.240
3.535
14.057
25.560

Total

Buyers

9.840
9.858
10.086
10.370

19.960
19.960
19.960
19.960

Case C
Nonbuyers
2.240
2.180
1.683
1.224

Total
9.840
9.802
9.737
9.734

Table 3 continues the example with different scale factors Ïƒ, and shows that at high levels of Ïƒ relative to the

observed changes in the scenarios, the effects of selection on idiosyncratic noise can drastically alter the
distribution of welfare gains between purchasers and non-purchasers. We infer from this table that unless there

is compelling evidence to support the case (B) assumptions, they should be rejected in favor of case (A) or case
(C) assumptions that more closely approximate a model in which neoclassical tastes, heterogeneous across
consumers but durable within each consumer, describe choice behavior without significant added idiosyncratic
noise. Finally, there is a substantial advantage in simplicity for the analytic expectations coming out of the case
(A) compared to case (C), suggesting that case (C) be used only if there is persuasive evidence for durable
idiosyncratic noise.

6. DECISION-UTILITY VERSUS EXPERIENCED-UTILITY
Decision-utility is defined as the objective function that the neoclassical consumer optimizes in making her
market choices, the function that can be recovered (with money-metric scaling) from sufficiently rich observations
on these market choices. The foundations of welfare theory restated in Section 3 assume that decision-utility is
a direct and complete measure of well-being. In reality, anticipated decision-utility and realized experiencedutility can differ. The most straightforward case, covered by neoclassical theory, is decision-making under
uncertainty where the decision utility function equals the expectation over objective probabilities of a utility
function of outcomes, and the experienced utility function equals this utility function evaluated at the realized
outcome. For example, consumers may be uncertain about attributes of alternatives such as product durability,
so that buying a product is equivalent to buying a lottery ticket on its attributes. Under von Neumann34

Morgenstern assumptions on utility, sufficiently rich market observations on choice among risky prospects will
suffice to recover the utility function of outcomes.
Beyond neoclassical decision-making under uncertainty, there are a number of factors that can cause gaps
between decision-utility and experienced-utility: (1) misperceptions of shrouded, ambiguous, or misleadingly
promoted product attributes, (2) unrealistic personal probability judgements on uncertain events, (3) whims and
psychometric noise that induce tremble in tastes, as in Thurstone (1927), (4) factors that influence the sensation
of well-being but do not influence market choices, such as provision of pure public goods and services, (5)
inconsistencies in preferences, such as time-inconsistent discounting and unanticipated habit-formation or
addiction, and (6) flaws in the process of utility maximization, such as reference point bias and hypersensitivity to
recent experience.
When there are gaps between decision-utility and experienced-utility, which should be used to measure
well-being? Roughly, welfare measures based on decision-utility focus on equity in opportunity, while those based
on experienced-utility focus on equity in outcomes. It may seem evident that consumer perceptions and decisionmaking in markets are simply instruments to achieve final outcomes, so experienced utility should be at the core
of welfare assessment. However, there are complicating factors. First, while decision-utility is arguably linked to
and recoverable from observed market behavior of consumers, there will often be no clear link between decisionutility and experienced-utility, and no reliable method of recovering experienced-utility from economic or
psychological experiments. Then, it may be impossible to use experienced utility as a basis for evaluating transfers
or other policies designed to address inequitable outcomes. Second, when consumers are fully and accurately
informed about the prospects and contingencies they face, and there are sufficient contingent markets so that
they can insure against risks if they choose, then they have it in their own hands to make informed choices and
live with the consequences of these choices. Further, interventions based on experienced utility can introduce
â€œmoral hazardâ€ in which the anticipation of ex post remedies for bad outcomes leads consumers to take excess
risks and be less diligent in their decisions, particularly by failing to take steps to avoid or mitigate harm. Then,
for fully informed consumers facing complete contingent markets, policies should arguably be evaluated in terms
of decision-utilities. However, when consumers are poorly informed or lack opportunities to manage risks, ex
post equity is a social concern, and/or consumers are unable to look after their own interests, interventions by a
benevolently paternalistic regulator may be appropriate, with or without a basis in experienced utility.
In general, it will be important to know how perceptions, decision utility, and experienced utility are linked.
Misperceptions of attributes and biased personal probabilities, listed above as sources (1) and (2) of gaps between
35

decisions and experience, do not substantially alter the neoclassical preference structure, and can in principle be
accounted for starting from decision utility and correcting these factors. For example, it should be straightforward
in principle to correct consumer misperceptions arising from supplier misrepresentation of product attributes. In
practice, identification and recovery of personal perceptions and probabilities may overburden market data and
require extra-market experimental observations.
Instabilities in tastes arising from psychometric noise, source (3) above, also leaves many neoclassical elements
of choice in place. However, preference tremble creates a fundamental difficulty with welfare analysis: How to
measure welfare changes when preferences are not fixed. One tack is to simply take the preferences revealed in
â€œas isâ€ decisions as yardsticks for welfare comparisons, and ignore shifts in â€œbut forâ€ tastes caused by tremble. An
issue here is that incorporating whims into the welfare calculus can make the results sensitive to selection effects,
as in the previous section. Another tack is to try to recover stable â€œcoreâ€ preferences stripped of the tremble
introduced by transient whims and misperceptions. However, a measured distribution of preferences that is a
convolution of population heterogeneity and individual tremble will confound recovery of either component of
the convolution, making recovery of core preferences problematic unless one observes multiple choices for each
individual.
Other elements entering experienced utility such as sources (4)-(6) of gaps between perceptions and
experience, particularly factors that leave no trace in market choices, can confound choice behavior so that there
may be no identifiable decision-utility or linked experienced utility that capture consumer well-being. Then
recovery of experienced-utility will be beyond the capacity of economists using customary market-based data.
Ben-Akiva, McFadden, and Train (2016) discuss experimental methods for direct elicitation of preference that
might be used in principle to address these identification and recovery tasks. Stated preference methods are
widely used in market research to forecast demand for new products and the value of extra-market resources,
with varying degrees of reliability; see McFadden (2017). An open question about measurement of well-being of
consumers who have behavioral elements in their decision-making and a gap between decision-utility and
experienced-utility is whether experienced utility could be elicited directly in conjoint analysis experiments, either
through experiments used to uncover the components of experienced utility, or through conjoint elicitation
methods such as elicitation of stated personal probabilities. Established experimental designs for such elicitations
are not available now, and there are major scientific challenges to their development, particularly known biases
in personal probability judgements and the problem of verification, but there will be high payoffs to future
scientific breakthroughs in these areas. Since the focus of this paper is welfare analysis using market observations,

36

this paper will not explore experimental, cognitive, or neurological approaches to direct measurement of wellbeing.
To facilitate analysis of the consequences of gaps between anticipation and experience, let superscript â€œdâ€
denote decision utility and superscript â€œeâ€ denote experienced utility. From (20), choice in scenario m at income
d
I then maximizes vjm
ï¿½ğ¼ğ¼, Î²d ï¿½ + ÏƒÎµj ; let Î´jm(I, Î²d , Ïƒ, ğ›†ğ›†) denote an indicator for this choice, and Pjm(I, Î²d , Ïƒ) the

e
probability of this choice given Î²d,Ïƒ. Let vjm
ï¿½ğ¼ğ¼, Î²d ï¿½ + ÏƒÎµj denote the experienced utility obtained from choice j.

e
d
(ğ¼ğ¼, Î²e ) and its linkage to vjm
The application will determine the structure of vjm
ï¿½ğ¼ğ¼, Î²d ï¿½, and the mapping from Î²d

to Î²e. 17 The decision utility and experienced utility from a choice situation with income I are, in this notation,
(37)

and

d
udm ï¿½ğ¼ğ¼, Î²d , Ïƒï¿½ = ğ¼ğ¼ + max ï¿½vjm
ï¿½ğ¼ğ¼, Î²d ï¿½ + ÏƒÎµj ï¿½
j=0,â€¦,Jm

Jm
e
(ğ¼ğ¼, Î²e ) + ÏƒÎµj ï¿½
Î´jm (ğ¼ğ¼, Î²d , Ïƒ, ğ›†ğ›†)ï¿½vjm
(38) uem ï¿½ğ¼ğ¼, Î²e , Î²d , Ïƒï¿½ = ğ¼ğ¼ + âˆ‘j=0

Jm
e
d
(ğ¼ğ¼, Î²e ) âˆ’ vjm
Î´jm ï¿½ğ¼ğ¼, Î²d , Ïƒ, ğ›†ğ›†ï¿½ï¿½vjm
â‰¡ udm ï¿½ğ¼ğ¼, Î²d , Ïƒï¿½ + âˆ‘j=0
ï¿½ğ¼ğ¼, Î²d ï¿½ï¿½,

where experienced utility in the last expression equals anticipated utility plus a correction that comes from
differences in anticipated and realized attributes and tastes. Combined with (25) defining MCEd for decisionutility, (38) implies the experienced-utility welfare measure, given (Î²d,Î²e,Ïƒ), and Î´ka(ğ¼ğ¼, Î²d , Ïƒ, ğ›†ğ›†) = 1 = Î´jb(ğ¼ğ¼, Î²d , Ïƒ, ğ›†ğ›†),
(39)

Âµek (ğ¼ğ¼a , Î²) âˆ™ MCE e (ğ‘ ğ‘ , k, Î²e , Ïƒe , ğ›†ğ›†ğğğšğš , ğ›†ğ›†ğğğ›ğ› , Î²d , Ïƒd , ğ›†ğ›†dğšğš , ğ›†ğ›†db ) = Âµdk (ğ¼ğ¼a , Î²) âˆ™ MCE d (ğ‘ ğ‘ , k, Î²d , Ïƒd , ğ›†ğ›†dğšğš , ğ›†ğ›†db )
e
d
e
d
(ğ¼ğ¼b , Î²e ) âˆ’ vjb
(ğ¼ğ¼a , Î²e ) + vka
+ vjb
ï¿½ğ¼ğ¼b , Î²d ï¿½ âˆ’ vka
ï¿½ğ¼ğ¼a , Î²d ï¿½ ,

where Âµek (ğ¼ğ¼a , Î²) is the marginal experienced utility of income.

Economists should be very cautious in applying the traditional welfare calculus when decision-utility requires

behavioral factors to explain behavior; as transfers to maintain decision utility can have unreliable and unintended
effects on experienced well-being. If anticipated tastes are an unreliable guide to realized tastes, this is a challenge
to the foundations of welfare economics; see Lowenstein and Ubel (2008), Thaler and Sunstein (2003,2008),

d
e
(ğ¼ğ¼) and vjm
(ğ¼ğ¼) differ only because of differences in observed
One case which is straightforward occurs when vjm
d
e
anticipated and experienced product attributes, ğ‘§ğ‘§jm and ğ‘§ğ‘§jm , due to say false advertising of attributes, and Î²d = Î²e. Cases
that are more challenging for economic analysis occur when either anticipated or experienced attributes are unobserved, or
ve and vd differ due to optimization errors and volatility in tastes. In such cases, the analyst will often have no recourse other
than using extra-market observations such as experimental elicitation of stated preferences, with attendant questions of
reliability.

17

37

McFadden (2014), Train (2015), Bernheim (2016). There is currently no accepted general welfare theory for nonneoclassical consumers who have shifts between anticipated and realized tastes, even though the random
decision-utility setup itself can accommodate many non-neoclassical elements. However, there may be some
special circumstances and assumptions that overcome this limitation. For example, differences in â€œas isâ€ or â€œbut
d
d
e
e
forâ€ (ğ‘§ğ‘§jm
, ğ‘ğ‘jm
) and (ğ‘§ğ‘§jm
, ğ‘ğ‘jm
) may be limited to identifiable misperceptions such as misinformation about product

attributes, and the joint distribution of anticipated and realized tastes may by assumption be generated through

limited differences such as personal misjudgments on the probabilities of contingent events or biases in risk
preferences and time discounts used in making decisions. If it is plausible that such limited shifts in tastes can be
fully described and modeled using specific external evidence, then welfare analysis based on (39) may be justified.
An example of consumer behavior that appears to be distorted by unrealistic personal probability
judgements is consumer choice of health insurance policies. An argument, simplified from Heiss, McFadden, and
Winter (2013) and McFadden and Zhou (2015), shows that misperceptions can be identified and corrected in some
cases. Suppose consumers face stochastic medical expenses c, and have the subjective perception that these have
a distribution Kd(c) with a mean Î¼d and variance sd2. Suppose they have a menu of insurance alternatives j = 0,â€¦,J

with plan j characterized by a premium pj and a copayment rate rj, with p0 = 0 and r0 = 1. Suppose their decision-

utility is a money-metric transformation of a constant-absolute-risk-aversion (CARA) expected utility function,
(40)

uj =

+âˆ
âˆ’1
ln âˆ«c=0 exp ï¿½âˆ’Î²ï¿½ğ¼ğ¼
Î²

âˆ’ ğ‘ğ‘j âˆ’ rj ğ‘ğ‘ï¿½ï¿½ K d (dğ‘ğ‘) + ğœğœÎµj â‰¡ I â€“ pj â€“ Îºd (Î²rj )/Î² + ğœğœÎµj ,

where I is income, Îºd is the cumulant generating function of Kd, Î² is a risk-aversion parameter with a probability

distribution in the population, and the parameter Ïƒ scales psychometric noise Îµj. Replacing the cumulant

generating function Îºd in (40) with a quadratic approximation gives a utility uj = I â€“ pj â€“ Î¼drj â€“ Â½sd2 Î²rj2 + ğœğœÎµj of the

form (21). Suppose (ln Î²,ln Ïƒ) is distributed bivariate normal, and the Îµj is i.i.d. EV1. Then observations on

consumer insurance choices in real or experimental markets allows estimation of the parameters of the bivariate
normal distribution, and Î¼d, and sd2.

Observations on objective probabilities Ke(c) for health expenses allow

estimation of Î¼e and se2. Then specialization of (40) using (41) and the quadratic approximations to the cumulant

generating functions Îºd and Îºe allow estimation of the money-metric loss in consumer utility arising from poor

choices due to misperception of medical expense risk.

38

7. WELFARE CALCULUS FOR COMMON POLICY PROBLEMS
Suppose mixed MNL choice probabilities of the form (22), along with the associated parameter Î± of a

population distribution of taste parameters F(Î²,Ïƒ|Î±) and a money-metric utility of the form (21), have been
estimated from choice data collected in real or hypothetical markets. Using these estimates, prospective benefitcost analysis using decision utility can be carried out by solving (24) or evaluating (25) for each consumer in a
synthetic population defined by draws of s , parameters (Î²,Ïƒ) from F(Î²,Ïƒ|s,Î±), and idiosyncratic noise Îµ. Measures
such as HCV, HEV, or MCE can then be averaged over the synthetic consumers falling into classes defined by

restrictions on s, with the law of large numbers operating to ensure reliable estimates of the net transfer to the
class that when optimally distributed leaves its members indifferent to the policy change. Alternately, one can
concentrate on estimating a UMCE measure (30) for this class. To simplify notation, suppress the â€œdâ€ superscript
for decision utility. Let C denote the set of alternatives whose attributes are unchanged by a shift from policy a
to policy b. By construction, C is a proper subset of Ja and Jb which contain alternatives whose attributes do not
change, and C always contains at least j = 0. Then (30) can be rewritten as
(41)

UMCE(s) â‰¡ ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  ï¿½ğ¼ğ¼b âˆ’ ğ¼ğ¼a + Ïƒ âˆ™ ln

ğ¿ğ¿ğ‚ğ‚a (ğ¼ğ¼a ,Î²,Ïƒ)
ï¿½ /Âµ(ğ¼ğ¼a , Î², Ïƒ)
ğ¿ğ¿ğ‚ğ‚b (ğ¼ğ¼b ,Î²,Ïƒ)

where LCm is the logit probability at random parameters (Î²,Ïƒ) of choice from C in scenario m. For example,
introducing a set B of new products with attributes included in (xb,pb), keeping unchanged the attributes of existing
products in C, is UMCEb(s) = ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  [ğ¼ğ¼b âˆ’ ğ¼ğ¼a â€“ Ïƒâˆ™ln ğ¿ğ¿ğ‚ğ‚b (ğ¼ğ¼b , Î², Ïƒ)]/Âµ(ğ¼ğ¼a , Î², Ïƒ).

For small policy changes and Ja = Jb = J, a Taylorâ€™s expansion of the first form of (41) in variations âˆ†vj â‰¡

vjb (ğ¼ğ¼b , Î²) âˆ’ vja (ğ¼ğ¼a , Î²) â‰¡ Î”X j Î² âˆ’ Î”pj , where Î”Xj â‰¡ X(Ib â€“ pjb,rb,zjb) â€“ X(Ia â€“ pja,ra,zja) and Î”pj â‰¡ pjb â€“ pja, gives the

approximation,
(42)

2

UMCE(s) = ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  [ğ¼ğ¼b âˆ’ ğ¼ğ¼a + âˆ‘jâˆˆğ‰ğ‰[ğ¿ğ¿ja (ğ¼ğ¼ğ‘ğ‘ , Î², Ïƒ)Î”vj + ğ‘‚ğ‘‚(ï¿½Î”vj ï¿½ /ğœğœ)]]/Âµ(ğ¼ğ¼a , Î², Ïƒ) .

Another useful approximation, due to Doug MacNair, applies the expansion ln(1 â€“ y) = â€“ y + O(y2) to (41) with LBb
= 1 â€“ LCb and LAa = 1 â€“ LCa the probabilities of choosing products whose attributes change, to obtain
(43)

UMCEb(s) = ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  [ğ¼ğ¼b âˆ’ ğ¼ğ¼a + Ïƒ âˆ™ [ğ¿ğ¿ğğb (ğ¼ğ¼b , Î², Ïƒ) âˆ’ ğ¿ğ¿ğ€ğ€a (ğ¼ğ¼a , Î², Ïƒ) + ğ‘‚ğ‘‚((1 âˆ’ ğ¿ğ¿ğ‚ğ‚m )2 ]]/Âµ(ğ¼ğ¼a , Î², Ïƒ).

When Ïƒ and Î¼ = Âµ(ğ¼ğ¼a , Î², Ïƒ) are homogeneous in the population, (43) has a particularly simple form,
(44)

ğ¼ğ¼ âˆ’ğ¼ğ¼

UMCEb(s) â‰ˆ [ bğœ‡ğœ‡ a +

ğœğœ
ğ„ğ„ [ğ¿ğ¿ (ğ¼ğ¼ , Î², Ïƒ)
Âµ Î²|ğ‘ ğ‘  ğğb b

âˆ’ ğ¿ğ¿ğ€ğ€a (ğ¼ğ¼a , Î², Ïƒ)]],
39

the income difference scaled by Î¼ plus the difference in the (Ïƒ/Î¼)-scaled full population market share of

consumers choosing the products affected by the policy change. For example, if a set A of products is â€œnewâ€ in
scenario b, and income and the attributes of the remaining products in C are unchanged, then UMCEb(s) â‰ˆ
ğœğœ
âˆ™ğ„ğ„ ğ¿ğ¿ (ğ¼ğ¼ , Î², Ïƒ)],
Âµ Î²|ğ‘ ğ‘  ğ€ğ€b b

a scaled market share of the new products.

Consider a policy that affects attributes and price of products, and let XjÎ» = Xja + Î»Î”Xj, pjÎ» = pja + Î»Î”pj, and IÎ» =

Ia + Î»(Ib â€“ Ia) for Î» âˆˆ [0,1] and j = 1,â€¦,J denote a linear path that achieves this change. Let UMCEÎ» denote (41)

evaluated at point Î» on this path. Let vjÎ» â‰¡ X jÎ» Î² âˆ’ ğ‘ğ‘jÎ» and ğ¿ğ¿jÎ» = evjÎ»/ğœğœ / âˆ‘ğ¢ğ¢âˆˆğ‰ğ‰ eviÎ» /ğœğœ . Then âˆ‚vjÎ»/âˆ‚Î» = Î”XjÎ² â€“ Î”pj,
and since the numerator of LCÎ» does not vary with Î»,
d UMCEÎ» (ğ‘ ğ‘ )
dÎ»

(45)

J
= ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  [ğ¼ğ¼b âˆ’ ğ¼ğ¼a + âˆ‘j=1 ğ¿ğ¿jÎ» ï¿½Î”Xj Î² âˆ’ Î”ğ‘ğ‘j ï¿½]/Âµ(ğ¼ğ¼a , Î², Ïƒ).

Then the incremental change in UMCE is a demand-weighted average of the changes Î”X j Î² âˆ’ Î”ğ‘ğ‘j in the systematic

components of utility. First, consider the common circumstance where Î”X j and Î”ğ‘ğ‘j do not depend on s; this will

be the case for example for a product offered in a national market where interactions of product attributes and
individual characteristics are not needed to explain choice behavior. Then, (45) reduces to
(46)

d UMCEÎ» (ğ‘ ğ‘ )
dÎ»

ï¿½ jÎ» =
where Î²

J

ï¿½ jÎ» âˆ’ Î”ğ‘ğ‘j ï¿½ğ¿ğ¿jÎ» (ğ¼ğ¼ğœ†ğœ† , Î², Ïƒ)/Âµ(ğ¼ğ¼a , Î², Ïƒ),
= ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  [ğ¼ğ¼b âˆ’ ğ¼ğ¼a + âˆ‘j=1ï¿½Î”X j Î²

ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘ ,Î± Î²ğ¿ğ¿jÎ» (ğ¼ğ¼ğœ†ğœ† ,Î²,Ïƒ)
ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘ ,Î± Pj ï¿½ğ¿ğ¿jÎ» ,Î²,Ïƒï¿½

denotes the mean of Î² among consumers who choose j when the alternatives are

ï¿½ jÎ» gives WTP for attribute changes that translate directly into incremental
characterized by (ğ—ğ— Î» , ğ©ğ©Î» ). In this case, Î²

ï¿½ jÎ» is
compensating variation. In the special sub-case of changes that are uniform in j, Î”ğ‘¥ğ‘¥j = Î”ğ‘¥ğ‘¥1 for j â‰  0, Î²

independent of j and is the mean of Î² among all buyers. In the special case that the relevant components of Î² are

ï¿½ jÎ» = Î² in the corresponding components, and these coefficients are unequivocal measures
homogeneous, then Î²

of â€œpart-worthsâ€. More generally, obtaining Î²ï¿½jÎ» is a calculation that requires estimates of both F(Î²,Ïƒ|s,Î±) and
ğ¿ğ¿jÎ» (ğ¼ğ¼ğœ†ğœ† , Î², Ïƒ).

Second, when the relevant components of Î² are homogeneous, but Î”ğ‘¥ğ‘¥j and Î”ğ‘ğ‘j are heterogeneous over s, (45)

reduces to
(47)

d UMCEÎ» (ğ‘ ğ‘ )
dÎ»

ï¿½ï¿½ï¿½ï¿½ï¿½È· ï¿½ âˆ™ Î² âˆ’ ï¿½Î”ğ‘ğ‘
ï¿½ï¿½ï¿½ï¿½È· ï¿½ ï¿½ /Âµ(ğ¼ğ¼a , Î², Ïƒ),
= ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  ï¿½ğ¼ğ¼b âˆ’ ğ¼ğ¼a + ï¿½Î”X
Î»

Î»

so the relevant components of Î² give WTP for mean attribute changes among consumers choosing j when product
features are described by (ğ—ğ— Î» , ğ©ğ©Î» ). Third, when Î² is heterogeneous and the Î”Xj are heterogeneous over the
40

population (i.e., vary with s), the relationship between values of Î² and ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘ ,Î± UMCEb (Î², Ïƒ) is more complex; (42)

requires a calculation that handles selection driven by both consumer history and taste heterogeneity.

The scaling parameter Ïƒ appears in (41) and (43) to have a prominent direct role in determining the level of

UMCE(s), but (42) indicates that this is offset elsewhere, so that the final impact of Ïƒ is only indirect, through its

influence on the choice probabilities. To see this more generally, write (41) as
1

(48) UMCE(s) â‰¡ âˆ«Î»=0

dUMCEÎ» (ğ‘ ğ‘ )
dÎ»

1

dÎ» = ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  [ğ¼ğ¼b âˆ’ ğ¼ğ¼a + âˆ‘jâˆˆğ‰ğ‰ âˆ«Î»=0 ğ¿ğ¿jÎ» ï¿½Î”Xj Î² âˆ’ Î”ğ‘ğ‘j ï¿½dÎ»]/Âµ(ğ¼ğ¼a , Î², Ïƒ).

This is a line integral over the rectifiable path of the area behind the demand functions for the products in A
between the old and new vectors of quality-adjusted net values, which is the Mashallian consumer surplus
associated with the change from policies a to b; (48) depends on Ïƒ only through its influence on the acuity of

consumer response to price changes. These price effects are usually bounded even when there is a positive
probability of very small Ïƒ. Recall that the own price elasticity of a MNL probability LjÎ» =
âˆ’ğ‘ğ‘jÎ» (1âˆ’ğ¿ğ¿jÎ» )

exp(

vjÎ»
Ïƒ

)

v
âˆ‘iâˆˆğ‰ğ‰ exp( iÎ» )
Ïƒ

equals

. Use the inequality e-c/Ïƒ â‰¤ Ïƒ/c for c > 0. If ck = max (vjÎ» âˆ’ vkÎ» ) > 0, then LkÎ» is bounded above by Ïƒ/ck,

Ïƒ

j=0,â€¦,J

and if c-k â‰¡ min ci > 0, then 1 â€“ LkÎ» is bounded by JÏƒ/c-k. Then the price elasticity is bounded in magnitude by
iâ‰ k

max{pkÎ»/ck,JpkÎ»/c-k} no matter how small Ïƒ. The limited sensitivity of (48) to Ïƒ is also seen by considering limiting

cases. For constant Ïƒ âŸ¶ 0, UMCE(s) âŸ¶ ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  {min vjÎ» âˆ’ min vja }/Âµ(ğ¼ğ¼a , Î², Ïƒ), and for Ïƒ âŸ¶ +âˆ, UMCE(s) âŸ¶

ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘ 

1
|ğ‰ğ‰|

jâˆˆğ‰ğ‰

jâˆˆğ‰ğ‰

âˆ‘jâˆˆğ‰ğ‰{vjÎ» âˆ’ vja }/Âµ(ğ¼ğ¼a , Î², Ïƒ). The difference in these expressions comes only from the difference between

least and average quality-adjusted net values, reflecting two extremes in the acuity of consumers in gravitating to

alternatives with the greatest quality-adjusted net values.
Next consider retrospective welfare analysis that quantifies the harm to consumers from a past â€œas isâ€ scenario
a compared to a â€œbut-forâ€ scenario b in which product attributes are changed by altering attributes or seller
conduct judged defective or improper. By its nature, retrospective analysis deals with loss of experienced utility,
and with compensating transfers to make consumers whole after their â€œas isâ€ choices have been made, so that
experienced-utility MCE rather than HCV or HEV is the target of the analysis, even if choices are influenced by
neoclassical income effects. The analysis in these applications is focused on objective changes in product
attributes rather than shifts in consumer tastes, so it is reasonable to assume that the decision-utility and
experienced-utility tastes are the same, and that in most cases Ia = Ib, so that any gap between decision utility and
d
e
and zjm
. Then experienced utility MCE is given by (39), with
experienced utility comes from differences in zjm

41

d
(ğ¼ğ¼, Î², Ïƒ) and
MCEd given by (25). The circumstances of the application will determine the configurations of vjm

e
(ğ¼ğ¼, Î², Ïƒ) that prevail. A critical question is whether consumers are fully and accurately informed about the
vjm

attributes of products in both the â€œas isâ€ and â€œbut forâ€ scenarios, or whether the issue is misinformation or
deception on product attributes in the â€œas isâ€ scenario.
The first case we consider is one in which consumers have full information on the available products under
both â€œas isâ€ and â€œbut forâ€ conditions. One example is anti-trust litigation in which the question is the harm to
consumers caused by improper supplier conduct such as price collusion, market allocation, bundling, or artificial
barriers to entry. Other examples are environmental litigation in which the question is the harm caused by
improper disposal of hazardous wastes, and patent litigation in which the question is the value to consumers of
d
e
(ğ¼ğ¼, Î²) = vjm
(ğ¼ğ¼, Î²) for m = a,b. In
infringing features. With full information, anticipations are realized, so that vjm

many applications, the class of consumers of interest is not the general population, but individuals meeting
specific conditions, such as residence in a specified region. If the class is defined by consumer characteristics s in

a set T, and either the â€œas isâ€ choice is unobserved, or it is observed but Jaâˆ©Jb = âˆ…, then the per capita transfer
prescribed for this class is
(49)

UMCE(ğ“ğ“) = ğ„ğ„s|ğ“ğ“ ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  Ïƒ âˆ™ ln

ğ¿ğ¿ğ‚ğ‚a (ğ¼ğ¼a ,Î²,Ïƒ)
/Âµ(ğ¼ğ¼a , Î², Ïƒ).
ğ¿ğ¿ğ‚ğ‚b (ğ¼ğ¼b ,Î²,Ïƒ)

Next consider cases where consumers are misinformed about products in the â€œas isâ€ scenario 1, due to failure

to deliver goods as promised, or to deceptive advertising, resulting in experienced utility that deviates from
anticipated utility, an application studied by Chorus and Timmermans (2009), Alcott (2013), Schmeiser (2014), and
d d
e
e
, ğ‘ğ‘ja ) and (ğ‘§ğ‘§ja
, ğ‘ğ‘ja
)
Train (2015). In these cases, consumers are fully informed in scenario b. Then, J = Ja = Jb, (ğ‘§ğ‘§ja

d d
e
e
are different for j in a set of products D where the misinformation occurs in scenario a, but (ğ‘§ğ‘§ja
, ğ‘ğ‘ja ) and (ğ‘§ğ‘§ja
, ğ‘ğ‘ja
)

d
d
e
e
agree for j âˆ‰ D and (ğ‘§ğ‘§jb
, ğ‘ğ‘jb
) and (ğ‘§ğ‘§jb
, ğ‘ğ‘jb
) agree for all j. Continue to assume that anticipated and experienced

taste parameters are the same. There are two leading possibilities for defining the â€œbut forâ€ scenario: the

benchmark â€œbut forâ€ net values can match either the anticipated decision-utility net values when the anticipation
is accurate, or match the realized utility net values when these net values are correctly anticipated in the â€œas isâ€
scenario. The former benchmark applies to contract violations, where the violator is obligated to provide the
promised product or equivalent compensation. The latter benchmark arguably applies to false advertising cases
where the â€œbut forâ€ scenario correctly informs consumers of the actual product attributes, so that anticipations
are realistic.

42

In the contract violation case, the â€œbut forâ€ net values are defined to match what consumers anticipated in the
e
d
d
e
d
(ğ¼ğ¼, Î²) = vjb
(ğ¼ğ¼, Î²) = vja
(ğ¼ğ¼, Î²) for all j, but vja
(ğ¼ğ¼, Î²) â‰  vja
(ğ¼ğ¼, Î²) for j âˆˆ D. The appropriate
â€œas isâ€ situation. Then vjb

metric for comparing consumer welfare under the â€œas isâ€ and the â€œbut forâ€ scenarios for consumers with the
observed â€œas isâ€ choice k is the experienced MCE, which becomes
(50)

d
e
(ğ¼ğ¼b , Î²) + ÏƒÎµjb ï¿½ âˆ’ [vka
(ğ¼ğ¼a , Î²) + ÏƒÎµka ]ï¿½ /Âµk (ğ¼ğ¼a , Î²)
MCE e (ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†) = ï¿½maxï¿½vjb
jâˆˆğ‰ğ‰

d
d
e
d
= {maxï¿½vjb
(ğ¼ğ¼b , Î²) + ÏƒÎµkb ï¿½ âˆ’ maxï¿½vja
(ğ¼ğ¼a , Î²) + ÏƒÎµja ï¿½ + vka
(ğ¼ğ¼a , Î²) âˆ’ vka
(ğ¼ğ¼a , Î²)}/Âµk (ğ¼ğ¼a , Î²).
jâˆˆğ‰ğ‰

jâˆˆğ‰ğ‰

d
e
(ğ¼ğ¼a , Î²) âˆ’ vka
(ğ¼ğ¼a , Î²)}/Âµk (ğ¼ğ¼a , Î²), the scaled difference
If Îµa = Îµb, this expression reduces to MCE e (ğ‘ ğ‘ , k, Î², Ïƒ, ğ›†ğ›†) = {vka

in the anticipated and realized net value for the chosen alternative. Even without the last assumption,
(51)

d
e
(ğ¼ğ¼a , Î²) âˆ’ vka
(ğ¼ğ¼a , Î²))/Âµk (ğ¼ğ¼a , Î²).
UMCEe (ğ‘ ğ‘ , k) = ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘ ,k (vka

Selection again enters the calculation of UMCE for a class of consumers. For consumers with s âˆˆ T and observed
â€œas isâ€ choices in a set D,
(52)

UMCE e (ğ‘ ğ‘ , k) =

e
ğ„ğ„s|T ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  âˆ‘kâˆˆğƒğƒ ğ¿ğ¿ka (ğ¼ğ¼a ,Î²,Ïƒ)âˆ™[vd
ka (ğ¼ğ¼a ,Î²) âˆ’ vka (ğ¼ğ¼a ,Î²)]/Âµk (ğ¼ğ¼a ,Î²)

ğ„ğ„s|ğ“ğ“ ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘  ğ¿ğ¿ğƒğƒğƒğƒ (ğ¼ğ¼a ,Î²,Ïƒ)

.

These per capita transfers can be applied separately to disjoint D sets, or combined into a weighted average of
the form (52) to give a uniform transfer for all consumers in C whose scenario a purchases are from D. Since only
consumers who choose an alternative in subset D experience any difference between anticipated and realized net
values, the numerator of (52) is the expected compensating variation per capita for all consumers with
characteristics in T, while the denominator is the share of the population with characteristics in T and scenario a
d
e
(ğ¼ğ¼a , Î², Ïƒ) â‰¥ vka
(ğ¼ğ¼a , Î², Ïƒ) for all tastes. However, it is possible that there are
choices in D. In (56), commonly vka

tastes appearing in reality, or in the utility model approximation to it, that lead to some â€œas isâ€ winners with
d
e
(ğ¼ğ¼a , Î², Ïƒ) < vka
(ğ¼ğ¼a , Î², Ïƒ). This raises two issues, first whether the transfers should be calculated including or
vka

excluding winners in the calculation of the aggregate needed to make losers whole. The argument hinges on
whether the distribution fulfilling the aggregate transfer can in principle claw back gains from winners to
compensate losers; if not, the calculation should exclude winners. A related issue is that it may be impossible to

distinguish winners and losers in the class of consumers in C and D, in which case the per capita calculation
excluding winners but applied to both losers and winners gives an unwarranted transfer to winners.

43

In the second case, with false advertising or other misinformation about alternativesâ€™ actual attributes, the
MCE is the difference between the realized utility obtained from (i) the alternative the person chose when
misinformed and (ii) the alternative the person would have chosen if fully informed. If the chosen alternative is
the same in the â€œbut forâ€ and â€œas isâ€ scenarios, then MCE e (ğ‘ ğ‘ , k, Î², Ïƒ, Îµ) = 0; i.e., there is no loss for consumers
whose choice was unaffected by the misinformation. Since the â€œbut forâ€ anticipated net values are defined to

e
d
(ğ¼ğ¼a , Î², Ïƒ) = vkb
(ğ¼ğ¼a , Î², Ïƒ) =
match the net values that consumers realized in the â€œas isâ€ situation, one has vkb

e
(ğ¼ğ¼a , Î², Ïƒ) for all k. Given Îµa = Îµb, the experienced-utility MCE has the form (51) specialized to this relation among
vka

the net values:
(53)

UMCE e (ğ‘ ğ‘ , k)
=

Ïƒ
ğ„ğ„Î²,Ïƒ|ğ‘ ğ‘ ,k ï¿½max ï¿½ (ğ¼ğ¼ ,Î²,Ïƒ) âˆ™
ğ¿ğ¿ja a

ln

J

b expï¿½ve (ğ¼ğ¼ ,Î²,Ïƒ)â„Ïƒï¿½
âˆ‘k=0
ka a
J

a expï¿½vd (ğ¼ğ¼ ,Î²,Ïƒ)â„Ïƒï¿½
âˆ‘k=0
ka a

d
e
(ğ¼ğ¼a , Î², Ïƒ) âˆ’ vja
(ğ¼ğ¼a , Î², Ïƒ)ï¿½ /Âµ(ğ¼ğ¼a , Î², Ïƒ).
, 0ï¿½ + vja

Again, it is normal in false advertising situations (but not necessarily for all forms of misinformation) that
e
d
(ğ¼ğ¼a , Î², Ïƒ) â‰¤ vka
(ğ¼ğ¼a , Î², Ïƒ). Then (53) is less than (51); i.e., the transfer is lower when the â€œbut forâ€ scenario
vka

consists of providing the correct information that leads anticipated and realized utilities to agree than when the
â€œbut forâ€ scenario consists of providing consumers with their anticipated utilities. When there are tastes such

e
d
(ğ¼ğ¼a ) > vka
(ğ¼ğ¼a ), so that these consumers win from the misrepresentation, there is again a question of
that vka

whether they should be included or excluded in the calculation of the per capita transfer.

Analogously to (52), in the class of consumers with characteristics in T who chose alternative J in scenario a,
(54)

ğ„ğ„Îµ|Î²,Ïƒ,,ğ›¿ğ›¿Ja(ğ¼ğ¼a)=1 MCE e (Î², Ïƒ, Îµ)
=

J2

e

âˆ‘
expï¿½vka (ğ¼ğ¼a ,Î²)â„Ïƒï¿½
ğ„ğ„s|ğ“ğ“ ğ„ğ„Î¶|ğ‘ ğ‘  PJa (ğ¼ğ¼a ,Î²,Ïƒ)âˆ™ï¿½ vaj1 (ğ¼ğ¼a ,Î²)âˆ’ vrj1 (ğ¼ğ¼a ,Î²)ï¿½+ğ„ğ„Îµ|Î²,Ïƒ,,ğ›¿ğ›¿Ja (ğ¼ğ¼a )=1 maxï¿½Ïƒâˆ™ln Jk=0
,0ï¿½/Âµ(ğ¼ğ¼a ,Î²,Ïƒ)
d

ğ„ğ„Îµ|Î²,Ïƒ,,ğ›¿ğ›¿Ja (ğ¼ğ¼a )=1 Pğ‰ğ‰ğ‰ğ‰ (ğ¼ğ¼a ,Î²,Ïƒ)

âˆ‘ 1 expï¿½vka (ğ¼ğ¼a ,Î²)ï¿½Ïƒï¿½
k=0

.

Retrospective welfare analysis for consumer durables whose attributes are affected by contract violations or
deceptions can require a combination of the preceding calculations. For example, consider homeowners whose
properties lose value due to groundwater contamination from an industrial site, or automobile owners whose
vehicles fail to deliver promised performance after correction of defective emission controls, and lose resale value
as a result. Then members of the class of owners of the affected durables at the time the defect is announced are
harmed in the amount given by (51) if they are legally entitled to a non-defective product, as in the case of
44

environmental injury, or given by (53) if they are legally entitled only to the opportunity to make a product choice
with the correct information, as in the case of false advertising. Further, as long as there is no further contract
violation or deception following the announcement, the harm is fully capitalized in the resale value of the durables
and these calculations conclude the calculation of harm. Pre-announcement owners who choose to continue to
hold their durables have willingly declined the opportunity to mitigate their losses by selling, and postannouncement buyers who find that the lower price offsets the reduced performance are not harmed.

8. AN ILLUSTRATIVE APPLICATION
An empirical example of applied welfare analysis using the methods of this paper, due to Kenneth Train (2015),
examines the impact on consumers of video streaming services that share customersâ€™ personal and usage
information without their prior knowledge. This analysis is based on choice models estimated using data from a
conjoint experiment designed and described by Butler and Glasgow (2015). Each choice experiment included four
alternative video steaming services with specified price and the attributes listed in Table 4 plus a fifth alternative
of not subscribing to any video streaming service.
Each of 260 respondents was presented with 11 choice experiments. The choice model was of the form (9)
for money-metric utility, with (Î²,ln Ïƒ) having a multivariate normal distribution. Estimates obtained using

maximum simulated likelihood are given in Table 5. The results indicate that people are willing to pay $1.56 per
month on average to avoid commercials. Fast availability is valued highly, with an average WTP of $3.95 per
month in order to see TV shows and movies soon after their original showing. On average, people prefer having a
mix with more TV shows and fewer movies, but the mean is not significantly different from zero. Average
willingness to pay for more content of both kinds is $2.96 per month. Interestingly, people who want fast
availability tend to be those who prefer more TV shows and fewer movies: the correlation between these two
WTPâ€™s is 0.51, while the correlation between WTP for fast availability and more content of both kinds is only 0.04.
Apparently, the desire for fast availability mainly applies to TV shows. 18

The model was also estimated using an Allenby-Train hierarchical Bayes method, with similar results; the details of both
estimation methods are given in Bhat (2001); Train (2000, 2009, 2015), and Ben Akiva, McFadden, and Train (2016).

18

45

Table 4. Non-Price Attributes
Attribute
Commercials shown
between content
Speed of content
availability
Catalogue
Data-sharing policies

Levels
Yes (â€œcommercialsâ€™)
No (baseline category)
TV episodes next day, movies in 3 months (â€œfast contentâ€)
TV episodes in 3 months, movies in 6 months (baseline category)
10,000 movies and 5,000 TV episodes (â€œmore contentâ€)
2,000 movies and 13,000 TV episodes (â€œmore TV/fewer moviesâ€)
5,000 movies and 2,500 TV episodes (the baseline category)
Information is collected but not shared (baseline category)
Usage information is share with third parties (â€œshare usageâ€) 19
Usage and personal information are shared with third parties (â€œshare
usage and personalâ€)

Table 5A. MSL Estimates of WTPs for Video Streaming Services

Ln(1/Ïƒ)
WTP for:
Commercials
Fast Availability
More TV, fewer movies
More content
Share usage only
Share personal and usage
No service

Commercials
Ln(1/Ïƒ)
Commercials
Fast
Availability
Mostly TV
Mostly movies
Share usage
Share personal
and usage
No service

-0.5813*
1.0000

Population Mean
Estimate
Std Error
-2.002
0.0.945
-1.562
3.945
-0.6988
2.963
-0.6224
-2.705
-27.26

0.4214
0.4767
0.4783
0.4708
0.4040
0.5844
2.662

Std Dev in Population
Estimate
Std Error
1.0637
0.0755
3.940
3.631
4.857
2.524
2.494
6.751
19.42

Table 5B. Correlation Point Estimates
(* denotes significance at 5% level)

Fast
Availability
-0.1371
0.1172
1.0000

Mostly
TV

Mostly
movies

Share
usage

0.0358
-0.3473*
0.8042*

0.0256
0.0109
-0.4019*

0.0022
-0.2562
-0.3542*

1.0000

-0.5890*
1.0000

-0.1695
0.5141*
1.0000

0.5302
0.4138
0.5541
0.4434
0.4164
0.7166
2.333

Share
personal
and usage
-0.1287
-0.0079
-0.4206*

No
service
0.2801*
-0.4108*
0.2391*

-0.3328*
0.5181*
0.9370*
1.0000

0.4616*
-0.0147
-0.0563
-0.0975
1.0000

Butler and Glasgow use the terms â€œnon-personally identifiable information (NPPI)â€ and â€œpersonally identifiable
information (PII)â€ for what we are labelling â€œshare usageâ€ and â€œshare usage and personalâ€.
19

46

Consider how a video streaming service might share its subscribersâ€™ personal and usage information with third
parties who then use that information for targeted marketing to the subscribers. The Table 5 estimates imply that
consumers have an average WTP of 62 cents per month to avoid having their usage data shared in aggregate form;
however, the hypothesis of zero average WTP cannot be rejected. Consumers are much more concerned about
their personal information being shared along with their usage information: The average WTP to avoid such
sharing is $2.71 per month. The correlation between WTP to avoid the two forms of sharing is a substantial 0.937.
However, some people like having their data shared, because they value the targeted marketing that they receive
as a result of the sharing. In the demand model, the WTP is normally distributed with a mean of -2.71 and standard
deviation of 6.751, which implies that 34.4% of the population like to have their information shared.
For the welfare analysis, there are three providers, Netflix, Amazon Prime, and Hulu, and that customers can
subscribe to any one of these services, any combination of them, or to no service. Table 6 gives the â€œas isâ€
alternatives available to customers, and the shares of customers in the sample who chose each alternative. At
the time of the survey, Hulu had about 6 million subscribers, which, given the market shares above, imply that
total market size is 31 million potential subscribers. This is less than the number of households in the US because
the survey screened for people who either already subscribe, or were likely to subscribe, to a video-screening
service if they did not currently have one. The market is then the US households who are open to the possibility
of subscribing to a video streaming service.
Table 6: Market Shares of Video Steaming Service Portfolios
Alternative
Netflix
Amazon Prime
Hulu
Netflix + Amazon Prime
Netflix + Hulu
Amazon Prime + Hulu
Netflix + Amazon Prime + Hulu
No video streaming service

Share
0.2867
0.0467
0.0400
0.1167
0.0700
0.0100
0.0733
0.3567

In the â€œas isâ€ scenario, customers think that none of the service providers shares their usage and personal
information, but in fact one of them does. The analysis chooses Hulu as the one who shares, but the selection is
arbitrary. How much are consumers hurt by the fact that Hulu shared its subscribers information without their
knowing beforehand, and how much would Hulu be liable for under different theories of damages?

47

Assume for the welfare analysis that when people were choosing among services, they anticipated that these
services would have the attributes given in Table 7. Note that none of the providers were thought to share their
subscribersâ€™ information.
Table 7: Anticipated Attributes for Decision Utility
Netflix
Price per month
Commercials
Fast Availability
More TV, fewer movies
More content
Share usage only
Share personal and usage

7.99
0
0
0
1
0
0

Amazon
Prime
6.58
0
0
1
0
0
0

Hulu
7.99
0
1
0
0
0
0

The attributes of the alternatives that represent multiple services are the sum of the attributes of the services
within the packages. For example, the price of Netflix+Amazon Prime is $14.67 per month and provides the â€œMore
contentâ€ of Netflix and the â€œMoreTV, fewer moviesâ€ of Amazon Prime. Alternative specific constants were
calibrated such that the predicted shares for the alternatives equal the observed shares in Table 7.
Now suppose that, in reality, Hulu shared its subscribersâ€™ personal and usage information, and that this fact
was revealed months after people began subscribing. The experienced utility is based on the attributes in Table 7
except that â€œShare personal and usageâ€ receives a 1 for Hulu. What is the difference between the welfare that
people expected to obtain when they made their choices compared to the welfare they actually obtained? Only
Hulu subscribers obtained experienced utility that differed from decision utility. The aggregate difference is $22.9
million per month, or $3.81 on average for Hulu subscribers. Note that, for the population as a whole, the average
WTP to avoid sharing is $2.71, as stated above. The average WTP conditional on having subscribed to Hulu is $3.81.
That is, the average Hulu subscriber dislikes sharing their information more than the average person in the
population does. How does this arise? Note in Table 5B that the correlation between the WTPs for between â€œFast
Availabilityâ€ and Share personal and usageâ€ is -0.42. Hulu is the only service that offered Fast Availability, and so
people who valued this attributed tended to choose Hulu. However, the people who place a high value on Fast
Availablity also tend to dislike sharing their information more than other people. The difference between the
conditional mean of $3.80 and the unconditional mean of $2.71 arises because of this correlation.
The damages that Hulu would need to pay in compensation for its sharing of its subscribersâ€™ information
depends critically on what was illegal: was it illegal for Hulu to share its customersâ€™ information, or was it illegal
48

for Hulu not to disclose that it was doing so. If it was illegal for Hulu to share its subscribersâ€™ information, then
the aggregate damage that Hulu is responsible for is $22.9 million for each month that the sharing had been
undisclosed. However, some customers like having their data shared, and this aggregate nets their gains from the
losses that people who dislike sharing incurred. To obtain Pareto neutral compensation on a person-by-person
basis, the $22.80 would not be enough to compensate the people who were hurt by the sharing: the people who
liked the sharing would need to contribute their gains too. We can calculate the welfare impact separately for
people who like sharing and people who dislike sharing. Among the Hulu subscribers who have a negative WTP
for sharing, the aggregate loss in welfare is $30.4 million. Hulu subscribers who have a positive WTP for sharing
obtained an aggregate gain of $7.50 million. For Hulu to be able to compensate the people who were hurt from
its sharing, Hulu would need to pay $30.4, since it does not have the ability to claw back compensation from the
people who gained.
Next suppose information sharing is legal, but nondisclosure is Illegal. If Hulu is liable for nondisclosure, then
the relevant comparison is between
(i)
(ii)

the utility that consumers obtained in the â€œas isâ€ situation, where they choose among the
alternative under the concept that Hulu did not share but it in fact did; this is the realized
utility for the alternative that the person chose based on decision utilities, and
the utility that consumers would have obtained Hulu had disclosed its sharing practice
before customers choose among the services; this is the realized utility that the customer
would choose based on realized utilities.

Every Hulu subscriber who likes sharing would have chosen Hulu if they had known in advance that it shared
information. And some of the Hulu subscribers who dislike sharing would still have chosen Hulu if they had known
that Hulu shared their information. None of these subscribers were hurt by the nondisclosure. The only Hulu
subscribers who were hurt by the nondisclosure are those who dislike sharing sufficiently that they would not
have chosen Hulu if they had known the sharing practice. However, the welfare losses from non-disclosure are
not borne only by Hulu subscribers. People who like sharing but didnâ€™t know that Hulu shares and chose a different
provider were potentially hurt because they were not able to take advantage of this undisclosed attribute of Hulu
service. People who would have chosen Hulu if they had known that Hulu shares but didnâ€™t obtained less welfare
than they would have obtained under full disclosure. Table 8 gives the losses for each group of consumers from
the non-disclosure of Huluâ€™s sharing practice.

49

Average loss per
person in the
market

Average loss for
Hulu
subscribers

16.5
13.0
3.5

0.53
0.64
0.33

2.16
3.05
0.00

All people
People who dislike sharing
People who like sharing

Average loss for
people who did
not subscribe
to Hulu

Aggregate loss,
in million $ per
month

Table 8: Damages Arising from Non-Disclosure

0.14
0.00
0.39

The total loss is $16.5 million per month, which consists of $13.0 million loss to people who dislike sharing and
3.55 loss to people who like sharing. The $13.0 million loss was incurred by Hulu subscribers who dislike sharing
sufficiently to not choose Hulu if they had known its sharing practices. The $3.5 million loss was incurred by people
who did not subscribe to Hulu but like sharing sufficiently to have chosen Hulu if they had known its sharing
practices. The average loss per person in the population is simply the aggregate loss divided by market size (31
million). The average loss for Hulu subscribers can best be explained by starting in the bottom row of Table 10.
Hulu subscribers who like sharing their information incurred zero harm from the nondisclosure: they subscribed
to Hulu and so obtained the benefits of the sharing even though they didn't realize beforehand that they would.
Importantly, they also did not gain from the nondisclosure. They obtained greater welfare from Hulu than they
had expected when they chose Hulu. But they obtained the benefits of sharing even without prior disclosure,
which would not have changed anything for them. Hulu subscribers who dislike sharing were hurt by $3.05 on
average. Not all Hulu subscribers who dislike sharing were hurt by the non-disclosure. Only those who would not
have chosen Hulu if they had known of its sharing practices were hurt, and these people were hurt by more than
$3.05 on average (since the $3.05 average include Hulu subscribers who dislike sharing but were not hurt from
the nondisclosure since they still would have chosen Hulu.) The top row in Table 10 gives a loss per Hulu subscriber
of $2.16: it is the average of the $3.05 in the second row and $0.00 in the third row, weighted by the share of Hulu
subscribers who dislike and like sharing. The losses for people who did not subscribe the Hulu are analogous.
People who dislike sharing and did not subscribe to Hulu incurred no loss, since they would not have chosen Hulu
if its sharing practices had been disclosed. Some people who did not subscribe to Hulu but like sharing would
have chosen Hulu if they had known that Hulu shared their information. These people obtained less utility that
they could have obtained under full disclosure.
In the â€œas isâ€ situation, 19.3 percent of people in the market subscribed to Hulu. If everyone had been
informed about Huluâ€™s sharing practice, then this share would have dropped to 16.0 percent, which is a 17 percent
50

reduction in subscribers. However, as explained above, this change includes two different movements: the share
drops because some Hulu subscribers would not have chosen Hulu if they had known that Hulu would share their
information, and the share rises because some people who did not subscribe to Hulu would have subscribed if
they had known. Table 9 gives the share of people in each group. 12.5% of people subscribed to Hulu and would
still have also done so if the sharing practice had been disclosed. 6.8% subscribed to Hulu but would not have if
they had known about its sharing practice. That is, about a third of Huluâ€™s subscribers would have not subscribed
if they had been informed. 3.5% of people did not subscribe to Hulu but would have done so if they had known
that Hulu shares their information.
Table 9: Choice Shares without and with Disclosure
Would have subscribed to
Hulu if its sharing practices
had been disclosed
Subscribed to Hulu
Did not subscribe to Hulu
Total

0.125
0.035
0.160

Would not have subscribed
to Hulu if its sharing
practices
had
been
disclosed
0.068
0.772
0.840

Total

0.193
0.807

The share of people who subscribed to Hulu was 19.3%. If its sharing practices had been disclosed, then the share
of subscribers would have been 0.193-0.068+0.035 = 0.16, i.e., 16 % as stated above.

9. CONCLUSIONS
This paper provides a foundation for applied welfare analysis of product regulation or compensation for
product defects. It gives a practical setup for money-metric indirect utility functions whose features can be
estimated using data on choice in real or hypothetical markets, and shows that there is essentially no loss of
generality in restricting analysis to this setup. It draws a distinction between prospective and retrospective policy
applications, and between cases where compensating transfers are hypothetical or are actually fulfilled. It
introduces a Market Compensating Equivalent (MCE) welfare measure, an updated version of Marshallian
consumer surplus, and shows that when compensating transfers are not actually fulfilled, it is preferred to
commonly prescribed Hicksian compensating or equivalent variations. Further, MCE is shown to have desirable
computational and aggregation properties. The problem of carrying out welfare calculations when tastes of
individual consumers are only partially observed is addressed, and computational formulas are given for
calculation of expected compensating transfers. Decision-utility and experienced-utility are distinguished, and
51

the issues of conducting welfare calculus in experienced utility are discussed. A number of common welfare
calculus problems are treated, and formulas are given for their resolution. Finally, an application illustrates the
use of these methods and the importance of the distinctions introduced in this paper.

REFERENCES
Afriat, S. (1967) â€œThe construction of utility functions from expenditure data,â€ International Economic Review, 8, 67-77.
Alexandrov, A. (1939) â€œAlmost everywhere existence of the second differential of a convex function and surfaces connected
with it,â€ Lenningrad State University Annals, Mathematics Series 6;3-35.
Aliprantis, C.; K. Border (2006) Infinite dimensional Analysis, Springer: Berlin.
Allcott, H., (2013) â€œThe welfare effects of misperceived product costs: data and calibrations from the automobile market.â€
Am. Econ. J.: Econ. Policy 5 (3), 30â€“66.
Anas, A. and C. Feng (1988) â€œInvariance of Expected Utilities in Logit Models,â€ Economic Letters 27:1, 41-45.
Arrow, K. (1950) â€œA difficulty in the concept of social welfare,â€ Journal of Political Economy, 58.4, 328-346.
Ben-Akiva, M.; D. McFadden: K. Train (2016) â€œFoundations of Stated Preference Elicitation: Consumer Behavior and ChoiceBased Conjoint Analysis,â€ University of California, Berkeley, working paper.
Bentham, J. (1789) An introduction to the principles of morals and legislation, Oxford: The Clarendon Press, 1876.
Bergson, A. (1938) â€œA reformulation of certain aspects of welfare economics,â€ Quarterly Journal of Economics, 52.2, 310-334.
Bernheim, D. (2016) â€œThe Good, the Bad, and the Ugly: A Unified Approach to Behavioral Welfare Economics,â€ Journal of
Benefit Cost Analysis,, 7.1, 12-68.
Bhattacharya, D. (2015) â€œNonparametric Welfare Analysis for Discrete Choice,â€ Econometrica, 83.2, 617-649.
Bhattacharya, D. (2017) â€œEmpirical Welfare Analysis for Discrete Choice: Some General Results,â€ Cambridge University
working paper.
Blackorby, C.; R. Boyce; R. Russell (1978) â€œEstimation of demand systems generated by the Gorman Polar Form,â€
Econometrica, 46, 345-364.
Border, K. (2014) â€œMonetary Welfare Measurement,â€ Cal Tech lecture notes.
Chipman, J.; J. Moore (1980) "Compensating Variation, Consumer's Surplus, and Welfare," American Economic Review. 70:
933-49
Chipman, J.; J. Moore (1990) "Acceptable Indicators of Welfare Change, Consumer's Surplus Analysis, and the Gorman Polar
Form," in D. McFadden, M. Richter (eds) Preferences, uncertainty, and optimality: Essays in honor of Leonid Hurwicz.
Boulder and Oxford: Westview Press; 68-120.
Chorus, C.G., H. Timmermans (2009) â€œMeasuring user benefits of changes in the transport system when traveler awareness
is limited,â€ Transportation Research Part A , 43(5), 536-547.
Conniffe, D. (2007) â€œA Note on Generating Globally Regular Indirect Utility Functions,â€ Journal of Theoretical Economics, 7.1,
1-11.
Dagsvik, J.; A. Karlstrom (2005) â€œCompensating Variation and Hicksian Choice Probabilities in Random Utility Models that are
Nonlinear in Income,â€ Review of Economic Studies, 72.1, 57-76.
Deaton, A.; J. Muellbauer (1980) â€œAn almost ideal demand system,â€ American Economic Review, 70, 312-326.
Debreu, G. (1959) Theory of Value, New Haven : Yale University Press.
Diamond, P. and D. McFadden (1974), â€œSome uses of the expenditure function in public finance,â€ Journal of Public Economics
3.1 3-21.
Doha, E. H.; A. H. Bhrawy; M. A. Saker (2011) â€œOn the Derivatives of Bernstein Polynomials,â€ Boundary Value Problems,
doi:10.1155/2011/829543 p. 1-16.
Dubin, J. (1985) Consumer Durable Choice and the Demand for Electricity, Elsivier: New York.
Dubin, J., D. McFadden (1984) "An Econometric Analysis of Residential Electric Appliance Holdings and Consumption,"
Econometrica, 52, 345-62
Dudley, R. (2002) Real Analysis and Probability, Cambridge University Press, New York.
Dunford, N.; J. Schwartz (1964) Linear Operators, Interscience, New York.
Dupuit, J. (1844) "On the Measurement of the Utility of Public Works", Annales des ponts et chaussÃ©es. (English translation,
International Economic Review, 1952).

52

Edgeworth, F. Y. (1881) Mathematical Psychics; an essay on the application of mathematics to the moral sciences,, London,
C. K. Paul & Co.
Fosgerau, M.; D. McFadden; M. Bierlaire (2013) â€œChoice Probability Generating Functions,â€ Journal of Choice Modelling, 8, 118.
Fosgerau, M.; D. McFadden (2012) â€œA theory of the perturbed consumer with general budgets,â€ working paper.
Gorman, W. (1953) â€œCommunity Preference Fields,â€ Econometrica, 21, 63-80.
Gorman, W. (1961) â€œOn a Class of Preference Fields,â€ Metroeconomica, 13, 53-56.
Gossen, H. (1854) Die Entwicktlung, English translation: The Laws of Human Relations, Cambridge: MIT Press, 1983.
Hall, P.; A. Yatchew (2007) â€œNonparametric Estimation when Data on Derivatives are Available,â€ The Annals of Statistics, 35.1,
300-323.
Hammond, P. (1994) "Money Metric Measures of Individual and Social Welfare Allowing for Environmental Externalities," in
W. Eichhorn (ed) Models and Measurement of Welfare and Inequality, Springer-Verlag, 694-724.
Heiss, F.; D. McFadden; J. Winter (2013) â€œPlan Selection in Medicare Part D: Evidence from Administrative Data,â€ Journal of
Health Economics 32.6, 1325-1344.
Hicks, J. (1939) Value and Capital, Oxford, Clarendon press.
Houthakker, H. (1950) â€œRevealed preference and the utility function,â€ Economica, N.S. 17, 159-174.
Hurwicz, L.; H. Uzawa (1971) "On the Integrability of Demand Functions," in J. Chipman, L. Hurwicz, M. Richter, and H.
Sonnenschein (eds) Preferences, Utility, and Demand, New York: Harcourt, 114-148.
Jevons, W. (1871) Theory of Political Economy, reprinted by London, Macmillan, 1931.
Jorgenson, D. (1997) Welfare, MIT Press: Cambridge, Vol. 1 and 2.
Johnson, N. and S. Kotz (1970, Ch. 21) Continuous Univariate Distributions-1, Houghton-Mifflin: New York.
Kadison, R. and Z. Liu (2016) Bernstein Polynomial and Approximation, lecture notes.
Kaldor, N. (1939) "Welfare Propositions of Economics and Interpersonal Comparisons of Utility," Econ. Jour., XLIX, 549-52.
Katzner, Donald (1970) Static Demand Theory, New York: Macmillan.
Kosorok, M. (2008) Introduction to Empirical Processes and Semiparametric Inference, Springer: New York.
Lorentz, G. (1937) â€œZur theorie der polynome von S. Bernstein,â€ Matematiceskij Sbornik 2, 543â€“556.
Lowenstein, G.; Ubel (2008) â€œHedonic adaptation and the role of decision and experience utility in public policy,â€ Journal of
Public Economics, 92, 1795-1810.
Marshall, A. (1890) Principles of Economics, London: Macmillan.
Mas-Colell, A.; M. Whinston, and J. Green (1995) Microeconomic Theory, Oxford: Oxford University Press.
Matzkin, R. and D. McFadden (2011) â€œTrembling Payoff Market Games,â€ working paper.
McFadden, D. (1974) â€œThe Measurement of Urban Travel Demand,â€ Journal of Public Economics, 3, 303-328.
McFadden, D. (1981) â€œStructural Discrete Probability Models Derived from Theories of Choice,â€ in C. Manski and D. McFadden
(eds) Structural Analysis of Discrete Data and Econometric Applications, MIT Press: Cambridge, 198-272.
McFadden, D. (1986) â€œThe Choice Theory Approach to Market Research,â€ Marketing Science, 275-297.
McFadden, D. (1994) "Contingent valuation and social choice," American Journal of Agricultural Economics 76, 689-708.
McFadden, D. (1999) "Computing Willingness-to-Pay in Random Utility Models," in J. Moore, R. Riezman, and J. Melvin (eds.),
Trade, Theory, and Econometrics: Essays in Honour of John S. Chipman, Routledge: London.
McFadden, D. (2004) â€œWelfare Economics at the Extensive Margin: Giving Gorman Polar Consumers Some Latitude,â€
University of California, Berkeley, working paper.
McFadden, D. (2008) â€œEnvironmental Valuation of Environmental Projects,â€ Univ. of California working paper.
McFadden, D. (2012) â€œEconomic Juries and Public Project Provision,â€ Journal of Econometrics, 166, 116-126.
McFadden, D. (2014) â€œThe New Science of Pleasure: Consumer Behavior and the Measurement of Well-Being,â€ in S. Hess and
A. Daly, eds, Handbook of Choice Modelling, Elgar: Cheltenham, 7-48.
McFadden, D. (2017) â€œStated Preference Methods and their Applicability to Environmental Use and Non-Use Valuations,â€ in
D. McFadden and K. Train (eds) Contingent Valuation of Environmental Goods: A Comprehensive Critique, Elgar:
Cheltingham, Chap. 6.
McFadden, D., K. Train (2000) "Mixed MNL Models for Discrete Response," Journal of Applied Econometrics, 15, 447-470.
McFadden, D.; B. Zhou (2015) â€œMeasuring Lost Welfare from Poor Health Insurance Choices,â€ Schaeffer Center, USC.
Miller, K.; et al. (2011) â€œHow Should Consumersâ€™ Willingness to Pay Be Measured? An Empirical Comparison of State-of-theArt Approaches,â€ Journal of Marketing Research, 48.1, 172-184.
Pareto, Vilfredo (1906) Manual of Political Economy, English Translation, Augustus M. Kelley, NY, 1971.

53

Peleg, B. (1970) â€œUtility functions for partially ordered topological spaces,â€ Econometrica, 38, 93-96.
Pollard, D. (1984) Convergence of Stochastic Processes, Springer, New York.
Rademacher, H. (1919) â€œUbeÌˆ r partielle und totale Differenzierbarkeit von Funktionen mehrerer Variabeln und ubeÌˆ r die
Transformation der Doppelintegrale,â€ Math. Ann. 79, 340-359.
Rader, T. (1973) â€œNice demand functions,â€ Econometrica, 41, 913-935.
Resnic, S.; R. Roy (1990) â€œLeader and Maximum Independence for a Class of Discrete Choice Models,â€ Economic Letters, 33.3,
259-263.
Richter, M. (1966) â€œRevealed Preference Theory,â€ Econometrica, 34, 635-645.
Roy, R. (1947) "La Distribution du Revenu Entre Les Divers Biens". Econometrica, 15.3, 205â€“225.
Samuelson, P. (1947) Foundations of economic analysis, Cambridge: Harvard University Press, 1983.
Samuelson, P. (1948) â€œConsumption theory in terms of revealed preference,â€ Economica, 15, 243-253.
Schmeiser, S. (2014) â€œConsumer inference and the regulation of consumer information,â€ Int. J. Ind. Organ. 37, 192â€“200.
Scitovsky, T. (1951) â€œThe State of Welfare Economics,â€ American Economic Review, 41-3, 303-315.
Sen, A. (2017) Collective Choice and Social Welfare, Harvard University Press: Cambridge.
Shannon, C. (2006) â€œA Prevalent Transversality Theorem for Lipschitz Functions,â€ Proceedings of the American Mathematical
Society, 134.9, 2755-2755.
Slutsky, E. (1915) "Sulla teoria del bilancio del consummatore", Giornale degli Economisti. English translation, "On the Theory
of the Budget of the Consumer," in G. Stigler and K. Boulding, eds, Readings in Price Theory, Homewood: Irving.
Small, K.; S. Rosen (1981), â€œApplied Welfare Economics with Discrete Choice Models,â€ Econometrica, 49.1, 105-130.
Smith, A. (1776) An inquiry into the nature and causes of the wealth of nations. London, W. Strahan and T. Cadell.
Thaler, R.; C. Sunstein (2003) â€œLibritarian Paternalism,â€ American Economic Review, 93.2, 175-179.
Thaler, R.; C. Sunstein (2008) Nudge: Improving Decisions about Health, Wealth, and Happiness, Yale University Press: New
Haven.
Thurstone, L. (1927) â€œA Law of Comparative Judgment,â€ Psychological Review, 34: 273-286.
Train, K. (2015) â€œWelfare calculations in discrete choice models when anticipated and experienced attributes differ: A guide
with examples,â€ Journal of Choice Modelling, 16, 15-22.
Van der Vaart, A.; J. Wellner (1996) Weak Convergence and Empirical Processes, Springer, New York.
Varian, H. (1982) "The Nonparametric Approach to Demand Analysis," Econometrica, 50: 945-73.
Varian, H. (2006) Revealed Preference. New York: Oxford University Press.
Willig, Robert (1976) "Consumer's Surplus without Apology," American-Economic-Review. 66: 589-97.
Yatchew, A. (1985) â€œApplied Welfare Analysis with Discrete Choice Models: Comment,â€ Economic Letters, 18.1, 13-16.
Zhao, Y.; K. Kockelman; A. Karlstrom (2012) â€œWelfare Calculations in Discrete Choice Settings: The Role of Error Term
Correlation,â€ Transport Policy 19.1, 76-84.

54

Appendix A: Approximation Theory for Functions and Probabilities
This appendix provides the mathematical basis for uniform parametric approximations to utility functions and
probabilities. The first theorem adapts Bernstein-Weierstrauss approximation theory to the class of functions
considered in this paper, and the second theorem utilizes Pollardâ€™s methods for establishing uniform weak
convergence of empirical probabilities; see Lorentz (1937), Kadison-Liu (2016), Pollard (1984).
K
Let bjK(p) = ï¿½ ï¿½ pj (1 âˆ’ p)Kâˆ’j denote the binomial probability of j successes in K draws, each with probability
j

p âˆˆ [0,1]; and define bj,K(p) â‰¡ 0 for j < 0 or j > K. Differentiating,

d
b (p)
dp jK

= K[bj-1,K-1(p) â€“ bj,K-1(p)]. Higher order

K
derivatives can be defined recursively; see Doha et al (2011). Note that âˆ‘K
j=0 bjK (p) â‰¡ 1 and âˆ‘j=0

d
b (p)
dp jK

â‰¡ 0.

The following result is a straightforward multivariate restatement of the Bernstein-Weierstrauss theorem on
approximation of continuous functions by polynomials.
Theorem A.1. Let H denote a compact metric space with metric h. Consider f âˆˆ â„­([0,1]nÃ—H). Let K = (K1,â€¦,Kn)
denote a vector of positive integers, j = (j1,â€¦,jn) a vector of integers satisfying 0 â‰¤ ji â‰¤ Ki for i = 1,â€¦,n, p = (p1,â€¦,pn)
âˆˆ [0,1]n , jâŠ˜K = (j1/K1,â€¦,jn/Kn). Define the multivariate binomial probability bj,K(p) = âˆni=1 bjiKi (pi ), the vector Î²âˆ™K(h)
of functions Î²j,K(h) â‰¡ f(jâŠ˜K,h) on H for 0 â‰¤ j â‰¤ K, and the multivariate polynomial BK(p,Î²âˆ™K(h)) = âˆ‘0â‰¤ğ£ğ£â‰¤ğŠğŠ bğ£ğ£,ğŠğŠ (ğ©ğ©)Î²ğ£ğ£,ğŠğŠ (h).

Let C denote the compact range of f. Then, Î²j,K âˆˆ â„­(H,C)), and BK(p,Î²âˆ™K(h)) has the following approximation
|BğŠğŠ (ğ©ğ©, Î²âˆ™ğŠğŠ (h)) âˆ’ f(ğ©ğ©, h)| = 0, and (ii) if âˆ‚f(p,h)/âˆ‚pi exists and is continuous on a closed
properties: (i) lim max
n
ğŠğŠâ†’âˆ [0,1] Ã—H

set A âŠ† [0,1] Ã—H, then lim max ï¿½
n

ğŠğŠâ†’âˆ

Lipschitz on H.

A

âˆ‚BK (ğ©ğ©,Î²ğŠğŠ (h))
âˆ‚f(ğ©ğ©,h)
âˆ’
ï¿½=
âˆ‚pi
âˆ‚pi

0. If in addition, f is Lipschitz in its arguments, then Î²âˆ™K is

Proof: The continuous function f is uniformly continuous on [0,1]nÃ—H and bounded by a constant M, so that
given Îµ > 0, there exists Î´ âˆˆ (0,1) such that |pâ€™ â€“ p| â‰¤ Î´ and h(h,hâ€™) â‰¤ Î´ imply |f(pâ€™,hâ€™) â€“ f(p,h)| < Îµ/6. Define the
set JÎ´ = {j|0 â‰¤ j â‰¤ K and |jâŠ˜K â€“ p| â‰¤ Î´/2}. By Hoeffdingâ€™s inequality, Prob(ğ‰ğ‰Î´ğ‘ğ‘ ) â‰¤ 2âˆ‘ni=1 exp(â€“ Î´2 K i /2). Select K â‰¥
192nM/ÎµÎ´3 and K > 2/Î´. In the inequality |BğŠğŠ (ğ©ğ©, Î²âˆ™ğŠğŠ (h)) âˆ’ f(ğ©ğ©, h)| â‰¤ ï¿½âˆ‘ğ‰ğ‰Î´ + âˆ‘ğ‰ğ‰Î´ğ‘ğ‘ ï¿½ bğ£ğ£,ğŠğŠ (ğ©ğ©)|f(jâŠ˜K,h) â€“ f(p,h)|, the

first sum is bounded by Îµ/6, while the second sum is bounded by 2Mâˆ™Prob(ğ‰ğ‰Î´ğ‘ğ‘ ) â‰¤ 4Mâˆ™âˆ‘ni=1 exp(â€“ Î´2 K i /2) â‰¤
4Mâˆ™âˆ‘ni=1

2
Î´2 Ki

â‰¤ ÎµÎ´/24 â‰¤ Îµ/24. This establishes |BğŠğŠ (ğ©ğ©, Î²âˆ™ğŠğŠ (h)) âˆ’ f(ğ©ğ©, h)| < ğœ€ğœ€/3 for each (p,h) âˆˆ [0,1]nÃ—H.

Next suppose that on a compact set A, âˆ‚f(p,h)/âˆ‚p1 exists and is continuous. Then it is uniformly continuous

and bounded on A; let M be a bound. The Î´ above can be chosen so that ï¿½

fï¿½ğ©ğ©+Î´â€² âˆ†1 ,hï¿½ âˆ’ f(ğ©ğ©,h)
Î´â€²

âˆ’

âˆ‚f(ğ©ğ©,h)
â‰¡
âˆ‚p1

Îµ
6

âˆ‚f(ğ©ğ©â€²,hâ€²)
âˆ‚f(ğ©ğ©,h)
âˆ’
ï¿½
âˆ‚p1
âˆ‚p1

â‰¤

Îµ
6

and

Î¶(Î´â€™,p,h) with |Î¶(Î´â€™,p,h)| â‰¤ for |Î´â€™| â‰¤ Î´ and |Î¶(Î´â€™,p,h)| â‰¤ M(1+2/Î´) for |Î´â€™| > Î´, where

âˆ†1 is a vector with a one in component 1, zeros elsewhere. Define p2+ = (p2,â€¦,pn), j2+ = (j2,â€¦,jn), K2+ = (K2,â€¦,Kn), and
bğ£ğ£ğŸğŸ+,ğŠğŠ ğŸğŸ+ (ğ©ğ©ğŸğŸ+ ) = âˆni=2 bjiKi (pi ) on [0,1]n-1. Then

55

âˆ‚BK (ğ©ğ©,Î²ğŠğŠ (h))
âˆ‚pi

= K1 ï¿½âˆ‘ğ‰ğ‰Î´ + âˆ‘ğ‰ğ‰Î´ğ‘ğ‘ ï¿½ bğ£ğ£2+,ğŠğŠ2+ (ğ©ğ©2+ ) ï¿½bğ£ğ£ğŸğŸâˆ’ğŸğŸ,ğŠğŠ ğŸğŸâˆ’ğŸğŸ (p1 ) âˆ’ bğ£ğ£ğŸğŸ,ğŠğŠ ğŸğŸâˆ’ğŸğŸ (p1 )ï¿½ f(j1 â„K1 , ğ£ğ£2+ âŠ˜ ğŠğŠ 2+ , h)

= ï¿½âˆ‘ğ‰ğ‰Î´ + âˆ‘ğ‰ğ‰Î´ğ‘ğ‘ ï¿½ bğ£ğ£2+ ,ğŠğŠ2+ (ğ©ğ©2+ )bğ£ğ£ğŸğŸ,ğŠğŠ ğŸğŸâˆ’ğŸğŸ (p1 ) ï¿½
= ï¿½âˆ‘ğ‰ğ‰Î´ + âˆ‘ğ‰ğ‰Î´ğ‘ğ‘ ï¿½ bğ£ğ£2+ ,ğŠğŠ2+ (ğ©ğ©2+ )bğ£ğ£ğŸğŸ,ğŠğŠ ğŸğŸâˆ’ğŸğŸ (p1 ) ï¿½
=

âˆ‚f(ğ©ğ©,h)
+
âˆ‚p1

f((j1 +1)â„K1 ,ğ£ğ£2+ âŠ˜ğŠğŠ 2+ ,h) âˆ’ f(j1 â„K1,ğ£ğ£2+ âŠ˜ğŠğŠ 2+ ,h)
ï¿½
1/K1
âˆ‚f(j1 â„K1 ,ğ£ğ£2+ âŠ˜ğŠğŠ 2+ ,h)
+
âˆ‚p1

ï¿½âˆ‘ğ‰ğ‰Î´ + âˆ‘ğ‰ğ‰Î´ğ‘ğ‘ ï¿½ bğ£ğ£2+ ,ğŠğŠ2+ (ğ©ğ©2+ )bğ£ğ£ğŸğŸ,ğŠğŠ ğŸğŸâˆ’ğŸğŸ (p1 ) ï¿½
Îµ
6

Î¶(Î´â€™, ğ©ğ©, h)ï¿½

âˆ‚f(j1 â„K1 ,ğ£ğ£2+ âŠ˜ğŠğŠ 2+ ,h)
âˆ‚f(ğ©ğ©,h)
âˆ’
+
âˆ‚p1
âˆ‚p1

Î¶(Î´â€™, ğ©ğ©, h)ï¿½.

On JÎ´, the term above in square brackets is bounded by , which then also bounds the first sum, and on ğ‰ğ‰Î´ğ‘ğ‘ this

term is bounded by 5M/Î´. The probability of ğ‰ğ‰Î´ğ‘ğ‘ is bounded by 2âˆ‘ni=1 exp(â€“ Î´2 K i /2), so the second sum is bounded

by

10M
âˆ™
ğ›¿ğ›¿

âˆ‘ni=1 exp(â€“ Î´2 K i /2) â‰¤

10M
âˆ™
ğ›¿ğ›¿

âˆ‘ni=1

1
.
Î´2 Ki /2

Then K â‰¥ 192nM/ÎµÎ´3 implies that the second sum is bounded by

20Îµ/192 < Îµ/6. This establishes the approximation property ï¿½

âˆ‚BK (ğ©ğ©,Î²ğŠğŠ (h))
âˆ‚f(ğ©ğ©,h)
âˆ’ âˆ‚p
âˆ‚pi
i

< ğœ€ğœ€/3ï¿½ at each (p,h) in A.

A final step to establish (i) and (ii) uniformly considers the open cover of neighborhoods where the results
hold (with tolerance Îµ/2 rather than Îµ/3), extracts finite sub-coverings for the compact domains, and uses the
minimum value of Î´ from these finite sub-coverings. By construction, Î²âˆ™K retains the properties of f with respect
to h; hence, in particular, if f is Lipschitz in H, then so is Î²âˆ™K. âˆ

The next results will establish uniform convergence of empirical expectations for a family of functions that
encompasses the applications in this paper. These results are obtained as specializations of the general theory of
stochastic convergence treated in Dudley (2014), Kosorak (2008), Pollard (1984), and van der Vaart and Wellner
(1996), referred to hereafter as VW. Let Y denote a closed subset of â„n, ğ’´ğ’´ denote the Borel Ïƒ-field of subsets of
Y, and F denote a probability on ğ’´ğ’´. Define a family â„± of functions f:Y âŸ¶ â„ that is contained in the Banach space
â„’1(Y,ğ’´ğ’´,F) and includes the constant function f(y) â‰¡ 1. We assume that the functions in â„± are bounded by an
envelope function f* âˆˆ â„’1(Y,,F); i.e., f* â‰¥ |f| for f âˆˆ â„±. Let Î˜ denote a compact subset of â„d, with a bound Î± >
max(1,maxâ€–Î¸â€–). Assume that the functions in â„± are indexed by Î¸ âˆˆ Î˜ and are Lipschitz with respect to this index;
Î¸âˆˆÎ˜

specifically, |fÎ¸â€™(y) â€“ fÎ¸â€(y)| â‰¤ â€–Î¸â€² âˆ’ Î¸"â€– â‹… f âˆ— (y) â‰¤ Î± âˆ™ f âˆ— (y). We will call â„± with the properties above a Lipschitzparametric family.

Let FT denote the empirical probability defined by T independent draws {y1,â€¦,yT} from F; i.e., for A âˆˆ ğ’´ğ’´, FT(A) =

1 T
âˆ‘ ğŸğŸ(yt
T t=1

1
T

âˆˆ A). For f âˆˆ â„’1(Y,,F) and a probability Q on ğ’´ğ’´, define EQf â‰¡âˆ«Y f(y)Q(dy) and ETf â‰¡ âˆ‘Tt=1 f(yt ). Define

â€–fâ€–Q = EQ|f|, and note that â€–fâ€–F is the norm of â„’1(Y,,F). A strong law of large numbers establishes that ETf âŸ¶ ğ„ğ„ğ…ğ… f

pointwise for each f âˆˆ â„± and for f*. We give conditions under which this convergence is uniform on â„±.

ğ‘ğ‘ğ‘ğ‘

A measure of the â€œdensityâ€ or â€œcomplexityâ€ of â„± is its bracketing number N[](Î³,â„±,Q), defined for Î³ > 0 and a
probability Q on ğ’´ğ’´, the minimum cardinality of a family â„±Î³ âŠ† â„’1(Y,ğ’´ğ’´,F), not necessarily a subset of â„±, such that
for each f âˆˆ â„±, there are fâ€™,fâ€ âˆˆ â„± satisfying fâ€™ â‰¥ f â‰¥ fâ€ and EQ(fâ€™ â€“ fâ€) < Î³. A related measure of the complexity of â„±
is its covering number N(Î³,â„±,Q), defined for Î³ > 0 and a probability Q on ğ’´ğ’´ as the minimum cardinality of a family
â„±Î³ âŠ† â„’1(Y,ğ’´ğ’´,F), not necessarily a subset of â„±, such that for each f âˆˆ â„±, â€²inf ğ„ğ„Q |fâ€™ â€“ f| < Î³. Obviously, N(Î³,â„±,Q) â‰¤
f âˆˆâ„±Î³

56

N[](Î³,â„±,Q). We will be interested in families of functions for which the bracketing or covering number is finite.
The following result specializes VW Theorem 2.7.11:
Lemma A.2. Consider a Lipschitz-parametric family â„± and a positive constant M > 1. For each probability Q
on ğ’´ğ’´ such that EQf* â‰¤ M and each Î³ > 0, N[](Î³,â„±,Q) â‰¤ 2 + 2(8Î±M/Î³)d.

Proof: Let J be the largest integer no greater than 8Î±M/Î³, and j = (j1,â€¦,jd) a vector of indices with 1 â‰¤ ji â‰¤ J for
each i. Consider the family of open balls of radius Î³/2M centered at bj = (-Î± + j1Î³/4M,â€¦,-Î±+jdÎ³/4M). This family
covers Î˜ âŠ† [-Î±,Î±]d and contains Jd elements. Discard the balls that do not intersect Î˜. From each of the remainder,
ğ›¾ğ›¾fâˆ—

ğ›¾ğ›¾fâˆ—

select a point Î¸j âˆˆ Î˜ and let â„±Î³ denote the family of functions min(fÎ¸ğ£ğ£ + 2M , f âˆ— ) and max(fÎ¸ğ£ğ£ âˆ’ 2M , âˆ’f âˆ— ) plus f*

and â€“f*. Then, â„±Î³ contains at most 2(1+Jd) functions. For Î¸ in the ball containing Î¸j, the Lipschitz condition gives
ğ›¾ğ›¾

ğ›¾ğ›¾

ğ›¾ğ›¾

ï¿½fÎ¸i (y) âˆ’ fÎ¸ (y)ï¿½ â‰¤ 2M f âˆ— (y), implying fÎ¸ğ£ğ£ (ğ‘¦ğ‘¦) + 2M f âˆ— (ğ‘¦ğ‘¦) âˆ’ f(y) â‰¥ 0 â‰¥ fÎ¸ğ£ğ£ (ğ‘¦ğ‘¦) âˆ’ 2M f âˆ— (ğ‘¦ğ‘¦) âˆ’ f(y). Then â„±Î³ brackets â„±,
and N[](Î³,â„±,Q) â‰¤ 2 + 2(8Î±M/Î³) d. âˆ

Augment the Lipschitz-parametric family â„± with the countable family â„±0 â‰¡ â‹ƒâˆ
ğ‘˜ğ‘˜=1 â„±1/k of the approximating
functions in Lemma A.2 at tolerances Î³ = 1/k for k = 1,2,â€¦ ; i.e., consider the family â„±* â‰¡ â„±âˆªâ„±0. Then the bound
on bracketing numbers that the lemma establishes for â„± also holds for â„±*, and â„±0 is dense in â„±*. Then, â„±* is said
to be Q-measurable for any probability Q on ğ’´ğ’´ such that EQf* â‰¤ M; see VW, 2.2.3 and 2.2.4.

Theorem A.3. Consider a Lipschitz-parametric family â„± âŠ† â„’1(Y,,F) that has an envelope f* âˆˆ â„’1(Y,ğ’´ğ’´,F). For
each tolerance Î³ âˆˆ (0,1), lim Prob(sup sup |(ğ„ğ„Tâ€² âˆ’ ğ„ğ„)f | > ğ›¾ğ›¾) = 0 .
Tâ†’âˆ

Tâ€² â‰¥T fâˆˆâ„±

Proof: From the discussion following Lemma A.2, consider the augmented family â„±* that contains â„± and also
contains the countable dense subfamily â„±0. Given Î³ âˆˆ (0,1), the condition EFf* < âˆ implies there exists a constant
M > EFf* such that EFf*âˆ™1(f*>M) < Î³/4. Define â„±M = {min(M,max(f,-M)) | f âˆˆ â„±*}. From Lemma A.2, the bracketing
number bound established on â„± by the functions in â„±Î³ also holds for â„±M and the corresponding finite family â„±Î³M
âˆ—
= {min(M,max(f,-M)) | f âˆˆ â„±Î³} for all probabilities Q on ğ’´ğ’´, since fM
= min(M,max(f*,-M)) is an envelope function
âˆ—
M
for â„±M and EQfM â‰¤ M. Then from Lemma A.2, N(Î³, â„± , FT ) â‰¤ 2+2(8Î±M/Î³) d. This bound is independent of T. Then,
the result follows for â„±*, and hence for â„±, from VW Theorem 2.4.3. âˆ
The following result is stated in a form sufficient for our needs; for more general results, see VW, 2.6.17.

Theorem A.4. Consider a finite-dimensional linear subspace ğ’¦ğ’¦ of â„’1(Y,,F). Without loss of generality, assume
that ğ’¦ğ’¦ includes the function f(y) â‰¡ 1. For a fixed integer J, define â„± to be a subset of the family of functions of
the form min(f1,â€¦,fj) for fj âˆˆ ğ’¦ğ’¦,1 â‰¤ j â‰¤ J. Let â„ denote the family of indicator functions i(y) = 1(f(y)>0) for f âˆˆ â„±,
and ğ’¢ğ’¢ denote the family of functions g = fâˆ™i for f âˆˆ â„± and i âˆˆ â„. Suppose â„± has an envelope function f* âˆˆ â„’1(Y,,F).
Then, for each tolerance Î³ âˆˆ (0,1),
lim Prob(sup sup |(ğ„ğ„Tâ€² âˆ’ ğ„ğ„)i| > ğ›¾ğ›¾) = 0 and lim Prob(sup sup |(ğ„ğ„Tâ€² âˆ’ ğ„ğ„)g| > ğ›¾ğ›¾) = 0.

Tâ†’âˆ

Tâ†’âˆ

Tâ€² â‰¥T iâˆˆâ„

Tâ€² â‰¥T gâˆˆğ’¢ğ’¢

Proof: The proof utilizes a geometric measure of the complexity of a family of functions â„± or a family of sets
ğ’ğ’, the Vapnik-ğ¶ğ¶Ì† ervonenkis (VC) index, denoted V(â„±) or V(ğ’ğ’); see VW 2.6.1, Dudley (2014, 2.6.1). Classes of
functions or sets with a finite VC index are termed VC-classes. VW Lemma 2.6.15 establishes that ğ’¦ğ’¦ is a VC57

class. Then VW, Lemma 2.6.18(ii) establishes that â„± is a VC-class with index V(â„±), and the truncated class â„±M
= {min(M,max(f,-M)) | f âˆˆ â„± } for M > 0 is a VC-class with index at most V(â„±)+2; see Dudley (2014, Theorem
4.41). Pollard (1984, Lemma 2.4.18) establishes that the family ğ’ğ’ of sets C = {yâˆˆY | f(y) > 0} for f âˆˆ â„± is a VCclass, implying that â„ is a VC-class (see VW, p. 151, #9). VW Theorem 2.6.7 applied to â„±M with envelope f* â‰¡ M
or to â„ with envelope i* â‰¡ 1 implies bounds N(Î³, â„±M,Q) â‰¤ K(M/Î³)V(â„±)+2 and N(Î³, â„,Q) â‰¤ K(1/Î³) V(â„±)+2 for Î³ âˆˆ
M
(0,1) and any probability Q on ğ’´ğ’´, where K is a constant that does not depend on Î³ or M. Let â„±Î³/2
and â„Î³/2M

denote the sets of centers of open balls of radius Î³/2 and Î³/2M that cover â„±M and â„ respectively, and satisfy
M
) â‰¤ 2K(2M/Î³)V(â„±)+2 and card(â„Î³/2M) â‰¤ 2K(2M/Î³) V(â„±)+2. Let ğ’¢ğ’¢M = {iâˆ™f | i âˆˆ â„ and f âˆˆ â„±M}. For i âˆˆâ„ and
card(â„±Î³/2

f âˆˆ â„±M, one has

min

min ğ„ğ„|i âˆ™ f âˆ’ iâ€² âˆ™ f â€² | â‰¤ max

iâ€² âˆˆâ„Î³/2M fâ€² âˆˆâ„±Î³/2

min ğ„ğ„|(i âˆ’ iâ€² ) âˆ™ f| + â€² max

fâˆˆâ„±M iâ€² âˆˆâ„Î³/2M

min ğ„ğ„|(f âˆ’ f â€² ) âˆ™ iâ€² | < Î³.

i âˆˆâ„Î³/2M fâ€² âˆˆâ„±Î³/2

Then the covering number N(Î³, ğ’¢ğ’¢M ,Q) for any probability Q on ğ’´ğ’´ is bounded by the number of functions in
ğ’¢ğ’¢Î³ ={iâˆ™f | i âˆˆ â„Î³/2M and f âˆˆ â„±Î³/2}, which is in turn bounded by 4K2(2M/Î³)2V(â„±)+4. The countable families
M
âˆ
M
â‹ƒâˆ
ğ‘˜ğ‘˜=1 â„±1/2K and â‹ƒğ‘˜ğ‘˜=1 â„1/2kM are dense in â„± and â„ respectively, so that these families are F-measurable. Then
VW Theorem 2.4.3 applies to give the result. âˆ

Appendix B: Properties of Extreme Value Type 1 Random Variables
a. A standard Extreme Value Type 1 (EV1) random variable has CDF F(Îµ) â‰¡ exp(-e-Îµ), density e-Îµ âˆ™ exp(-e-Îµ), and
for t < 1 the moment generating function Î“(1-t). Johnson and Kotz (1970, Ch. 21) show the linear transformation
Î¾ = v + ÏƒÎµ with Ïƒ > 0 has CDF exp(âˆ’eâˆ’(Î¾âˆ’v)â„Ïƒ ), mean v + ÏƒÎ³0, where Î³0 = 0.5772156649â‹¯ is Eulerâ€™s constant,
median v â€“ Ïƒ ln ln 2, mode v, and variance Ïƒ2Ï€2/6. For 0 < Ï < 0.08, the tails of F(Îµ) satisfy F(2âˆ™ln Ï) + 1 â€“ F(â€“2âˆ™ln Ï)
âˆ

< Ï and âˆ«|Îµ|>âˆ’2âˆ™ln Ï|Îµ|F(dÎµ) < Ï. Also, E|Îµ| â‰¤ 1.219384 (i.e., integrating by parts, E|Îµ| = âˆ«0 exp(âˆ’eÎµ ) dÎµ +
âˆ

âˆ eâˆ’y

âˆ

âˆ«0 [1 âˆ’ exp(âˆ’eâˆ’Îµ )]dÎµ â‰¤ E1 (1) + âˆ«0 exp(âˆ’Îµ) dÎµ , where E1(c) â‰¡ âˆ«c

y

dy is the exponential integral with values

given in Abramovitz and Stegum, 1964, Table 5.1). Finally, EÎµ2 = Î³02+ Ï€2/6 = 1.978112âˆ™âˆ™âˆ™.

b. Consider J = {0,â€¦,J}, constants aj and independent standard EV1 random variates Îµj for j âˆˆ J, and a nonempty subset C of J. Define qğ‚ğ‚ = ln âˆ‘jâˆˆğ‚ğ‚ eaj and Î¾C = max(aj + Îµj ) âˆ’ qC . Then Î¾C is again a standard EV1 random
jâˆˆğ‚ğ‚

variable; i.e., Prob(Î¾C < c) = Prob(Îµj < c + qğ‚ğ‚ âˆ’ aj for j âˆˆ ğ‚ğ‚) = âˆjâˆˆğ‚ğ‚ exp(âˆ’eâˆ’câˆ’qğ‚ğ‚ +aj ) â‰¡ exp(âˆ’eâˆ’c). Given k âˆˆ C,
the probability of the event YC(k) = {Îµ| ak + Îµk â‰¥ aj + Îµj for j âˆˆ C} is multinomial logit,
+âˆ
f(Îµk ) âˆjâˆˆğ‚ğ‚\{k} Fï¿½Îµk
k =âˆ’âˆ

LC(k) = âˆ«Îµ

and for A âŠ† C, LC(A) =

a
âˆ‘jâˆˆğ€ğ€ e j

a .
âˆ‘jâˆˆğ‚ğ‚ e j

Prob(Îµk < c| YC(k)) =
=

+âˆ
eâˆ’Îµk exp(âˆ’eâˆ’Îµk
k =âˆ’âˆ

+ ak âˆ’ aj ï¿½dÎµk = âˆ«Îµ

âˆ‘jâˆˆğ‚ğ‚ eaj âˆ’ak )dÎµk =

The conditional CDF of Îµk, given k âˆˆ C and YC(k), is

c
1
f(Îµk ) âˆjâˆˆğ‚ğ‚\{k} Fï¿½Îµk
âˆ«
ğ¿ğ¿ğ‚ğ‚ (k) Îµk =âˆ’âˆ

c
1
eâˆ’Îµk exp(âˆ’eâˆ’Îµk
âˆ«
ğ¿ğ¿ğ‚ğ‚ (k) Îµk =âˆ’âˆ

+ ak âˆ’ aj ï¿½dÎµk

âˆ‘jâˆˆğ‚ğ‚ eaj âˆ’ak )dÎµk = exp(âˆ’eâˆ’(c+akâˆ’qğœğœ ) ) â‰¡ F(c + ak â€“ qC).
58

eak

a
âˆ‘jâˆˆğ‚ğ‚ e j

,

Then the payoff ak + Îµk, conditioned on the event YC(k), has the same CDF as Î¾C + qC , and is therefore the same for
all k. Term this the Optimizer Invariance Property (OIP). An immediate implication of OIP is
Î³0 + qğ‚ğ‚ = E(Î¾C + qğ‚ğ‚ ) â‰¡ E maxjâˆˆC(aj + Îµj) â‰¡ E{ ak + Îµk | YC(k)}.

so these unconditional and conditional means are the same. This result is obtained in Dubin and McFadden (1984),
Anas and Feng (1988), Resnick and Roy (1990), and Dubin (1985). A consequence is that if B and C are disjoint
non-empty subsets of J, then the conditional (on YC(k) for some k âˆˆ C) and unconditional expectations of utility
differences are given by the same log sum difference:
ğ„ğ„ ï¿½max(aj + Îµj ) âˆ’ max(aj + Îµj ) | YC (k)ï¿½ â‰¡ ğ„ğ„{max(aj + Îµj ) âˆ’ max(aj + Îµj )} â‰¡ ln
jâˆˆğğ

jâˆˆğ‚ğ‚

jâˆˆğğ

If k âˆ‰ C, then the conditional CDF of Î¾C, given ak + Îµk > Î¾C + qC, is
Prob(Î¾C < c|ak + Îµk > Î¾C + qC) =
=

c

c
1
f(Î¾ğ‚ğ‚ )[1 âˆ’
âˆ«
ğ¿ğ¿ğ‚ğ‚âˆª{k} (k) Î¾ğ‚ğ‚ =âˆ’âˆ

jâˆˆğ‚ğ‚

a
âˆ‘jâˆˆğğ e j
a
âˆ‘jâˆˆğ‚ğ‚ e j

.

F(Î¾C + qğ‚ğ‚ âˆ’ ak )]dÎ¾ğ‚ğ‚

âˆ«Î¾ =âˆ’âˆ eâˆ’Î¾C exp(âˆ’eâˆ’Î¾ğ‚ğ‚ [1+eakâˆ’qğ‚ğ‚ ])dÎ¾C
F(c)
âˆ’ ğ‚ğ‚
ğ¿ğ¿ğ‚ğ‚âˆª{k} (k)
ğ¿ğ¿ğ‚ğ‚âˆª{k} (k)

=

F(c) âˆ’ ğ¿ğ¿ğ‚ğ‚âˆª{k} (ğ‚ğ‚)F(c + qğ‚ğ‚ âˆ’ ln[eqğ‚ğ‚ +eak ])
ğ¿ğ¿ğ‚ğ‚âˆª{k} (k)

.

Using the OIP, this result is unchanged if instead of a single alternative k âˆ‰ C, there is a set of alternatives A with
Aâˆ©C = âˆ… and either k maximizes aj + Îµj for j âˆˆ A, with conditioning on the event YA(k), or qğ€ğ€ = ln âˆ‘jâˆˆğ€ğ€ eaj replaces
ak, a standard EV1 variate Î¾A replaces Îµk, and A replaces {k}.
Next, given k âˆ‰ C, the conditional CDF of Î¾C, given ak + Îµk < Î¾C + qC, is

Prob(Î¾C < c|ak + Îµk < Î¾C + qC) =
=

1

ğ¿ğ¿ğ‚ğ‚âˆª{k}

c

âˆ«
(ğ‚ğ‚) Î¾

ğ‚ğ‚ =âˆ’âˆ

c
1
f(Î¾C )F(Î¾ğ‚ğ‚
âˆ«
ğ¿ğ¿ğ‚ğ‚âˆª{k} (ğ‚ğ‚) Î¾C =âˆ’âˆ

+ qğ‚ğ‚ âˆ’ ak )dÎ¾ğ‚ğ‚

eâˆ’Î¾ğ‚ğ‚ exp(âˆ’eâˆ’Î¾ğ‚ğ‚ [1 + eakâˆ’qğ‚ğ‚ ])dÎ¾ğ‚ğ‚ = F(c + qğ‚ğ‚ âˆ’ ln[eqğ‚ğ‚ + eak ]).

Again by the OIP, this result is unchanged if k âˆˆ B with Bâˆ©C = âˆ…, q ğğ = ln âˆ‘jâˆˆğğ eaj replaces ak, a standard EV1
variate Î¾B replaces Îµk, and A replaces {k}.
c. Let A, B, C denote disjoint non-empty subsets of J. Define qA = ln âˆ‘jâˆˆğ€ğ€ eaj , and define qB and qC analogously.

Define Î¾A = maxï¿½aj + Îµj ï¿½ âˆ’ qğ€ğ€, with analogous definitions for Î¾B and Î¾C, and let â€œABCâ€ denote the event Î¾A + qA >
jâˆˆğ€ğ€

Î¾B + qB > Î¾C + qC, and so on. The possible events and outcomes are given below:

Choice at a
Choice at b
Type

ABC
A
B
difference

ACB
A
C
difference

BAC
A
B
compound
59

BCA
C
B
compound

CAB
C
C
compound

CBA
C
C
compound

The probability of the event ABC is
+âˆ
ğ‘“ğ‘“(Î¾B )F(Î¾ğğ
ğğ =âˆ’âˆ

P(ABC) = âˆ«Î¾

+âˆ
eâˆ’Î¾ğğ
ğğ =âˆ’âˆ

= âˆ«Î¾

+ qğğ âˆ’ qğ‚ğ‚ )[1 âˆ’ F(Î¾B + qğğ âˆ’ qğ€ğ€ )]dÎ¾ğğ
+âˆ
eâˆ’Î¾ğğ
ğğ =âˆ’âˆ

expï¿½âˆ’eâˆ’Î¾ğğ [1 + eqğ‚ğ‚ âˆ’qB ]ï¿½ dÎ¾ğğ âˆ’ âˆ«Î¾

= P(B|B,C) â€“ P(B|A,B,C) â‰¡ P(B|B,C)âˆ™P(A|A,B,C),

expï¿½âˆ’eâˆ’Î¾ğğ [1 + eqğ€ğ€ âˆ’qğğ + eqğ‚ğ‚ âˆ’qB ]ï¿½ dÎ¾ğğ

where P(A|A,B,C) = eqğ€ğ€ /(eqğ€ğ€ + eqğğ + eqğ‚ğ‚ ) and P(B|B,C) = eqğğ /(eqB + eqğ‚ğ‚ ). This formula gives the probability of
any other of the events by substituting the corresponding permutation of A, B, C. Next,
+âˆ
(Î¾ğğ
ğğ =âˆ’âˆ

E{(Î¾ğğ + qğğ )âˆ™1(ABC)} = âˆ«Î¾
+âˆ
(Î¾ğğ
ğğ =âˆ’âˆ

= âˆ«Î¾

+ qğğ )ğ‘“ğ‘“(Î¾ğğ )F(Î¾ğğ + qğğ âˆ’ qğ‚ğ‚ )[1 âˆ’ F(Î¾ğğ + qğğ âˆ’ qğ€ğ€ )]dÎ¾ğğ

+ qğğ )eâˆ’Î¾ğğ ï¿½expï¿½âˆ’eâˆ’Î¾ğğ [1 + eqğ‚ğ‚ âˆ’qğğ ]ï¿½ âˆ’ expï¿½âˆ’eâˆ’Î¾ğğ [1 + eqğ€ğ€ âˆ’qğğ + eqğ‚ğ‚ âˆ’qğğ ]ï¿½ï¿½dÎ¾ğğ

= {P(ğğ|ğğ, ğ‚ğ‚)[Î³0 + ln(eqğğ + eqğ‚ğ‚ )] âˆ’ P(ğğ|ğ€ğ€, ğğ, ğ‚ğ‚)[Î³0 + ln(eqğ€ğ€ + eqğğ + eqğ‚ğ‚ )]},

The event ACB also has an expectation satisfying this â€œdifference typeâ€ formula with B and C interchanged.
The event BAC has
+âˆ
(Î¾ğğ
ğğ =âˆ’âˆ

E{(Î¾ğğ + qğğ ) âˆ™1(BAC)} = âˆ«Î¾
+âˆ
(Î¾ğğ
ğğ =âˆ’âˆ

= âˆ«Î¾

+âˆ
(Î¾ğğ
ğğ =âˆ’âˆ

= P(A|A,C) âˆ«Î¾

Î¾ +q âˆ’qğ€ğ€ âˆ’Î¾
ğ€ğ€

ğğ
+ qğğ )f(Î¾ğğ ) âˆ«Î¾ ğğ=âˆ’âˆ

+âˆ
(Î¾B
ğğ =âˆ’âˆ

= P(A|A,C) âˆ«Î¾

Î¾ +q âˆ’qğ€ğ€

ğğ
+ qğğ )f(Î¾ğğ ) âˆ«Î¾ ğğ=âˆ’âˆ

A

e

ğ€ğ€

f(Î¾ğ€ğ€ )F(Î¾ğ€ğ€ + qğ€ğ€ âˆ’ qğ‚ğ‚ )dÎ¾ğ€ğ€ dÎ¾ğğ

exp(âˆ’eâˆ’Î¾ğ€ğ€ [1 + eqğ‚ğ‚ âˆ’qğ€ğ€ ])dÎ¾ğ€ğ€ dÎ¾ğğ

+ qğğ )eâˆ’Î¾ğğ expï¿½âˆ’eâˆ’Î¾ğğ ï¿½ expï¿½âˆ’eâˆ’Î¾ğğ +qğ€ğ€âˆ’qğğ [1 + eqğ‚ğ‚ âˆ’qğ€ğ€ ]ï¿½dÎ¾ğğ

+ qğğ )eâˆ’Î¾ğğ expï¿½âˆ’eâˆ’Î¾ğğ [1 + eqA âˆ’qğğ + eqğ‚ğ‚ âˆ’qğğ ]ï¿½dÎ¾ğğ

= P(A|A,C)P(B|A,B,C){ Î³0 + ln(eqğ€ğ€ + eqğğ + eqğ‚ğ‚ )} .

The events BCA, CAB, and CBA also have expectations satisfying this â€œcompound typeâ€ formula with the
corresponding permutations of A, B, and C.
Consider the event AC. From (b), E max(Î¾ğ€ğ€ + qğ€ğ€ , Î¾ğ‚ğ‚ + qğ‚ğ‚ )]âˆ™1(AC) = [Î³0 + ln(eqğ€ğ€ + eqC )]âˆ™P(A|A,C). Then,

E{[max(Î¾ğğ + qğğ , Î¾ğ‚ğ‚ + qğ‚ğ‚ ) â€“ max(Î¾ğ€ğ€ + qğ€ğ€ , Î¾ğ‚ğ‚ + qğ‚ğ‚ )]}âˆ™1(AC)
= E{[Î¾ğğ +

qğğ
Ïƒ

â€“ (Î¾ğ€ğ€ + qğ€ğ€)]âˆ™1(ABC) + E{[Î¾ğ‚ğ‚ + qğ‚ğ‚ â€“ (Î¾ğ€ğ€ + qğ€ğ€ )]âˆ™1(ACB) + E{[Î¾ğğ + qğğ â€“ (Î¾ğ€ğ€ + qğ€ğ€ )]}âˆ™1(BAC)

= {P(ğğ|ğğ, ğ‚ğ‚)[Î³0 + ln(eqğğ + eqğ‚ğ‚ )] âˆ’ P(ğğ|ğ€ğ€, ğğ, ğ‚ğ‚)[Î³0 + ln(eqğ€ğ€ + eqğğ + eqğ‚ğ‚ )]}

+ {P(ğ‚ğ‚|ğğ, ğ‚ğ‚)[Î³0 + ln(eqğğ + eqğ‚ğ‚ )] âˆ’ P(ğ‚ğ‚|ğ€ğ€, ğğ, ğ‚ğ‚)[Î³0 + ln(eqğ€ğ€ + eqğğ + eqğ‚ğ‚ )]}
60

+ P(A|A,C)P(B|A,B,C){ Î³0 + ln(eqğ€ğ€ + eqğğ + eqğ‚ğ‚ )} â€“ [Î³0 + ln(eqğ€ğ€ + eqğ‚ğ‚ )]âˆ™P(A|A,C)

= â€“ P(C|A,C)âˆ™ ln(eqğ€ğ€ + eqğğ + eqğ‚ğ‚ ) + ln(eqğğ + eqğ‚ğ‚ ) â€“ P(A|A,C)âˆ™ln(eqğ€ğ€ + eqC )

= P(A|A,C)âˆ™ln

Hence,

eqğğ +eqğ‚ğ‚
eqğ€ğ€ +eqğ‚ğ‚

+ P(C|A,C)âˆ™ln

eqğğ +eqğ‚ğ‚

eqğ€ğ€ +eqğğ +eqğ‚ğ‚

.

eqğğ +eqğ‚ğ‚

E{[max(Î¾ğğ + qğğ , Î¾ğ‚ğ‚ + qğ‚ğ‚ ) â€“ max(Î¾ğ€ğ€ + qğ€ğ€ , Î¾ğ‚ğ‚ + qğ‚ğ‚ )] | AC} = ln eqğ€ğ€ +eqğ‚ğ‚ +

P(ğ‚ğ‚|ğ€ğ€,ğ‚ğ‚)
eqğğ +eqğ‚ğ‚
âˆ™ln eqğ€ğ€ +eqğğ +eqğ‚ğ‚
P(ğ€ğ€|ğ€ğ€,ğ‚ğ‚)âˆ™

.

The first term in the last expression coincides with the unconditional expectation of the maximum, and the
final term adjusts for the conditioning event. The adjustment is negative so that the information that the best in
A is better than the best in C decreases the expected maximum utility over B and C. By application of the OIC as
described at the end of (b), this result is the same no matter which event YA(k) occurs. Next,
E{[max(Î¾ğğ + qğğ , Î¾ğ‚ğ‚ + qğ‚ğ‚ ) â€“ max(Î¾ğ€ğ€ + qğ€ğ€ , Î¾C + qğ‚ğ‚ )]}âˆ™1(CA)

= E{[Î¾B + qğğ â€“ (Î¾ğ‚ğ‚ + qğ‚ğ‚ )]âˆ™1(BCA) = P(C|A,C)P(B|A,B,C)[Î³0 + ln(eqğ€ğ€ + eqğğ + eqğ‚ğ‚ )]

â€“ P(C|A,C)âˆ™ [Î³0 + ln(eqğ€ğ€ + eqğ‚ğ‚ )] + P(C|A,B,C)âˆ™[Î³0 + ln(eqğ€ğ€ + eqB + eqğ‚ğ‚ )]

= P(C|A,C)âˆ™{ ln

eqğğ +eqğ‚ğ‚
eqğ€ğ€ +eqğ‚ğ‚

âˆ’ ln

eqB +eqğ‚ğ‚
},
eqğ€ğ€ +eqğğ +eqğ‚ğ‚

and hence E{max(Î¾ğğ + qğğ , Î¾ğ‚ğ‚ + qğ‚ğ‚ ) â€“ max(Î¾ğ€ğ€ + qğ€ğ€ , Î¾ğ‚ğ‚ + qğ‚ğ‚) | CA} = ln

eqğğ +eqğ‚ğ‚
eqğ€ğ€ +eqğ‚ğ‚

âˆ’ ln

eqğğ +eqğ‚ğ‚

eqğ€ğ€ +eqğğ +eqğ‚ğ‚

.

As before, the first term in the last expression coincides with the unconditional expectation of the maximum, and
the final term is a positive adjustment for the conditioning event, so that the information that the best in C is
better than the best in A increases the expected maximum utility over B and C. Again, by application of the OIC,
this result is the same no matter which event YA(k) occurs.
d. Now consider J = {0,â€¦,J} and C = {0,â€¦,J-1}. Assume that in a scenario change from m = a to m = b, constants
ajm â‰¡ aj for j âˆˆ C do not change, but aJa â‰  aJb. Assume Îµj for j âˆˆ J is the same in both scenarios. Define qğ‚ğ‚ =
ln âˆ‘jâˆˆğ‚ğ‚ eaj and Î¾C = max(aj + Îµj ) âˆ’ qğ‚ğ‚. There is an alternative k that maximizes aj + Îµj over j âˆˆ C, and from (b),
jâˆˆğ‚ğ‚

the CDF of ak + Îµk given that k maximizes the payoff in C is the same as the CDF of Î¾C + qğ‚ğ‚ . Define Ï‰ = Î¾C â€“ ÎµJ and
L(w) â‰¡ Prob(Ï‰ â‰¤ w) = 1/(1+e-w). The possible events are then:
Event
Case
Condition
Probability
Payoff
Ybak
aJa < aJb
Î¾C+qC < aJa+ÎµJ < aJb+ÎµJ
L(aJa â€“ qC)
aJb â€“ aJa
Ybka
aJa < aJb
aJa+ÎµJ < Î¾C+qC < aJb+ÎµJ
L(aJb â€“ qC) â€“ L(aJa â€“ qC)
aJb â€“ qC â€“ Ï‰
Ykba
aJa < aJb
aJa+ÎµJ < aJb+ÎµJ < Î¾C+qC
L(qC â€“ aJb)
0
Yabk
aJa > aJb
Î¾C+qC < aJb+ÎµJ < aJa+ÎµJ
L(aJb â€“ qC)
aJb â€“ aJa
Yakb
aJa > aJb
aJb+ÎµJ < Î¾C+qC < aJa+ÎµJ
L(aJa â€“ qC) â€“ L(aJb â€“ qC)
qC â€“ aJa + Ï‰
Ykab
aJa > aJb
aJb+ÎµJ < aJa+ÎµJ < Î¾C+qC
L(qC â€“ aJa)
0
61

t eÏ‰

t

1+et

Note that âˆ«s Ï‰dğ¿ğ¿(Ï‰) = Ï‰ğ¿ğ¿(Ï‰)]ts âˆ’ âˆ«s 1+eÏ‰ dÏ‰ = tğ¿ğ¿(t) âˆ’ sğ¿ğ¿(s) âˆ’ ln 1+es . Then the expected payoff in the

event Ybka is

a âˆ’q

E{(aJb â€“ qC â€“ Ï‰)âˆ™1(Ï‰âˆˆYbka)} = (aJb â€“ qC)[L(aJb â€“ qC) â€“ L(aJa â€“ qC)] â€“ âˆ«a Jbâˆ’q ğ‚ğ‚ Ï‰dğ¿ğ¿(Ï‰)
Ja

ğ‚ğ‚

a âˆ’q
1+e Jb ğ‚ğ‚

= (aJb â€“ qC)[L(aJb â€“ qC) â€“ L(aJa â€“ qC)] â€“ (aJb â€“ qC)L(aJb â€“ qC) + (aJa â€“ qC)[L(aJa â€“ qC) + ln 1+eaJaâˆ’qğ‚ğ‚
a
eqğ‚ğ‚ +e Jb

= (aJa â€“ aJb) L(aJa â€“ qC) + ln eqğ‚ğ‚ +eaJa ,

and the expected payoff in the event Yakb is
a âˆ’q

E{(qC â€“ aJa + Ï‰)âˆ™1(Ï‰âˆˆYbka)} = (qC â€“ aJa)[ L(aJa â€“ qC) â€“ L(aJb â€“ qC)] + âˆ«a Jaâˆ’q ğ‚ğ‚ Ï‰dğ¿ğ¿(Ï‰)
Jb

ğ‚ğ‚

= (qC â€“ aJa)[L(aJa â€“ qC) â€“ L(aJb â€“ qC)] + (aJa â€“ qC)L(aJa â€“ qC) â€“ (aJb â€“ qC)L(aJb â€“ qC) â€“ ln
a
eqğ‚ğ‚ +e Jb

= (aJa â€“ aJb) L(aJb â€“ qC) + ln eqğ‚ğ‚ +eaJa .

a âˆ’q
1+e Ja ğ‚ğ‚

a âˆ’q
1+e Jb ğ‚ğ‚

Combining these results with other payoffs in the table gives
Scenario
a Choice
J

Case

Expected Payoff Given Choice

aJa < aJb

J

aJa > aJb

k

aJa < aJb

k

aJa > aJb

aJb âˆ’ aJa
1
eqğ‚ğ‚ + eaJb
ln q
ğ¿ğ¿(aJa âˆ’ qğ‚ğ‚ )
e ğ‚ğ‚ + eaJa
ğ¿ğ¿(aJa âˆ’ qğ‚ğ‚ )
1
eqğ‚ğ‚ + eaJb
âˆ’
(aJb â€“ aJa ) +
ln q
ğ¿ğ¿(qğ‚ğ‚ âˆ’ aJa )
ğ¿ğ¿(qğ‚ğ‚ âˆ’ aJa ) e ğ‚ğ‚ + eaJa
0

e. Assume scenarios m = a, b, a set of alternatives Ja = Jb = J = {0,â€¦,J}, and noise Îµ that is the same in both
scenarios. Let ajm denote constants. Order the alternatives so that Î”i â‰¡ aib â€“ aia is non-decreasing in i. Define nondecreasing constants ci = Î”i + aka â€“ arb ; then ck = akb â€“ arb, and cr = aka â€“ ara. Let Ajm denote the event that alternative
j is optimal in scenario m. Consider the event
Bkr = Akaâˆ©Arb = {Îµ | Îµk +aka â‰¥ Îµi + aia for i â‰  k & Îµr +arb â‰¥ Îµi + aib for i â‰  r},
including both cases k = r and k â‰  r. The Bkr are disjoint for different k or for different r except for sets of probability
J

J

zero, and satisfy Aka = â‹ƒr=0 ğğkr and Arb = â‹ƒk=0 ğğkr . The event Bkr implies (arb â€“ akb) â‰¥ Îµk â€“ Îµr â‰¥ (ara â€“ aka). Hence,
Bkr is non-empty if and only if arb â€“ ara â‰¥ akb â€“ aka, or equivalently ck â‰¤ cr, implying r â‰¥ k.
62

Consider the case r = k. Then for i â‰  k, Îµi â‰¤ Îµk + aka â€“ max(aia, aib + aka â€“ akb). Then
+âˆ
eâˆ’Îµk
k =âˆ’âˆ

P(Bkk) = âˆ«Îµ

J

expï¿½âˆ’eâˆ’Îµk âˆ‘i=0 eâˆ’aka+max(aia,aib+akaâ€“ akb ) ï¿½dÎµk =

eaka
J
max(a
ia ,aib +aka â€“ akb )
âˆ‘i=0 e

.

Then, the conditional probability Pkb|ka that the optimal choice in scenario b is k, given that the optimal choice in
scenario a is k, satisfies
Pkb|ka â‰¡ P(Bkk)/P(Aka) =

âˆ‘Ji=0 eaia
J
max
(a
ia ,aib +aka â€“ akb )
âˆ‘i=0 e

.

If r < k, Bkr is empty and Prb|ka = 0. Finally, consider the case r > k. Then Îµ âˆˆ Bkr requires Îµr + (ara â€“ aka) â‰¡ Îµr â€“ cr
â‰¤ Îµk â‰¤ Îµr + (arb â€“ akb) â‰¡ Îµr â€“ ck. Let Bkri = {Îµ âˆˆ Bkr | Îµr â€“ ci+1 â‰¤ Îµk â‰¤ Îµr â€“ ci} for i = k,â€¦,r-1 and consider the inequalities Îµn
â‰¤ min(Îµk + (aka â€“ ana), Îµr + (arb â€“ anb)) = (aka â€“ ana) + min(Îµk, Îµr â€“ cn). If n > i, then Îµr â€“ cn â‰¤ Îµk, implying Îµn â‰¤ (aka â€“ ana â€“
cn) + Îµr; otherwise, Îµn â‰¤ (aka â€“ ana) + Îµk. The probability of Bkri is then
+âˆ
eâˆ’Îµr exp(âˆ’eâˆ’Îµr
r =âˆ’âˆ

Pkri = âˆ«Îµ

=

eaka

âˆ‘in=0 e ana

ï¿½ï¿½

Îµ â€“c

âˆ‘Jn=i+1 e(ana â€“ aka + cn ) ) âˆ«Îµ r=Îµ iâ€“ c

+âˆ

k

Îµr =âˆ’âˆ

J

eâˆ’Îµr exp(âˆ’eâˆ’Îµr ï¿½ï¿½

âˆ’ ï¿½

+âˆ

Îµr =âˆ’âˆ

=

eaka
i
âˆ‘n=0 e ana
eaka
ana
n=0 e

= âˆ‘i

ï¿½

r

n=i+1

i+1

eâˆ’Îµk expï¿½âˆ’eâˆ’Îµk âˆ‘in=0 e(ana â€“ aka ) ï¿½ dÎµk dÎµr
i

e(ana â€“ arb+ Î”n) + ï¿½

eana â€“ arb+ Î”i ï¿½)dÎµr

n=0

J

eâˆ’Îµr exp(âˆ’eâˆ’Îµr ï¿½ï¿½

n=i+1

i

eana â€“ arb+ Î”n + ï¿½

n=0

eana â€“ arb+ Î”i+1 ï¿½)dÎµr ï¿½

+âˆ
J
eâˆ’Îµr expï¿½âˆ’eâˆ’Îµr ï¿½âˆ‘n=0 e(ana â€“ arb +max(Î”i ,Î”n) ï¿½ï¿½ dÎµr
r =âˆ’âˆ
+âˆ
J
âˆ’ âˆ«Îµ =âˆ’âˆ eâˆ’Îµr exp(âˆ’eâˆ’Îµr ï¿½âˆ‘n=0 e(ana â€“ arb +max(Î”i+1 ,Î”n ) ï¿½)dÎµr
r

âˆ«Îµ

ï¿½

earb
J
âˆ‘n=0 eana +max(Î”i ,Î”n )

âˆ’

earb
J
a
âˆ‘n=0 e na +max(Î”i+1 ,Î”n )

ï¿½ =

eaka earb

eana +max(Î”i ,Î”n )

âˆ™

ï¿½
ï¿½eÎ”i+1 âˆ’eÎ”i ï¿½

âˆ‘Jn=0 eana +max(Î”i+1 ,Î”n )

.

Then, the probability that the optimal choice in scenario b is r > k, given that the optimal choice in scenario a is k,
râˆ’1
satisfies Prb|ka â‰¡ âˆ‘râˆ’1
i=k Pkri /Pka = âˆ‘i=k

J
earb âˆ‘n=0 e ana

âˆ‘Jn=0 eana +max(Î”i ,Î”n )

âˆ™

ï¿½eÎ”i+1 âˆ’eÎ”i ï¿½

âˆ‘Jn=0 eana +max(Î”i+1 ,Î”n )

.

Next, consider the expectations of (akb + Îµk ) âˆ™ ğŸğŸ(ğ›†ğ›† âˆˆ Bkk ) for r = k and (arb + Îµr ) âˆ™ ğŸğŸ(ğ›†ğ›† âˆˆ Bkri ) for k â‰¤ i <
r, given Îµ âˆˆ Aka. First,
ğ„ğ„ğ›†ğ›†|ğ€ğ€ğ¤ğ¤ğ¤ğ¤ (akb + Îµk ) âˆ™ ğŸğŸ(ğ›†ğ›† âˆˆ Bkk ) =

Second, for k â‰¤ i < r,

+âˆ
1
(a +Îµk )eâˆ’Îµk
âˆ«
Pka Îµk =âˆ’âˆ kb

J

expï¿½âˆ’eâˆ’Îµk âˆ‘i=0 eâˆ’aka +max(aia ,aib +aka â€“ akb ) ï¿½dÎµk

= Pkb|ka ï¿½akb âˆ’ aka + lnï¿½âˆ‘Ji=0 emax(aia,aib+akaâ€“ akb ) ï¿½ + ğ›¾ğ›¾0 ï¿½.

63

ğ„ğ„ğ›†ğ›†|ğ€ğ€ğ¤ğ¤ğ¤ğ¤ (arb + Îµr ) âˆ™ ğŸğŸ(ğ›†ğ›† âˆˆ Bkri ) =
+
Pkri
ğ›¾ğ›¾
Pka 0

=

+
+

=

Pkri
[ğ›¾ğ›¾0
Pka

ğ½ğ½

âˆ‘ğ‘›ğ‘›=0 eana

âˆ‘in=0 e ana

âˆ‘ğ½ğ½ğ‘›ğ‘›=0 eana earb

ï¿½

âˆ‘in=0 e ana

âˆ‘ğ½ğ½ğ‘›ğ‘›=0 eana earb
âˆ‘in=0 e ana
J

âˆ™

Pkri
a
Pka rb
+âˆ

J

âˆ«Îµ =âˆ’âˆ Îµr eâˆ’Îµr exp ï¿½âˆ’eâˆ’Îµr ï¿½âˆ‘n=0 eana â€“ arb+max(Î”i ,Î”n) ï¿½ï¿½ dÎµr
ï¿½ r +âˆ
ï¿½
âˆ’ âˆ«Îµ =âˆ’âˆ Îµr eâˆ’Îµr exp(âˆ’eâˆ’Îµr ï¿½âˆ‘Jn=0 e(ana â€“ arb+maxï¿½Î”i+1,Î”nï¿½) ï¿½)dÎµr
1

r

âˆ‘Jn=0 eana +max(Î”i ,Î”n )
1

âˆ‘Jn=0 eana +maxï¿½Î”i+1

âˆ’

1

âˆ‘Jn=0 e(ana +maxï¿½Î”i+1 ,Î”n ï¿½)

âˆ™ ln
,Î”n ï¿½

earb
ana
n=0 e

+ ln âˆ‘n=0 eana+max(Î”i ,Î”n ) ] + âˆ‘i

âˆ™

J

ï¿½ âˆ™ ln âˆ‘n=0 eana+max(Î”i ,Î”n)

âˆ‘Jn=0 eana +max(Î”i ,Î”n )

âˆ‘Jn=0 eana +maxï¿½Î”i+1 ,Î”n ï¿½

âˆ‘Jn=0 eana
J
âˆ‘n=0 eana +maxï¿½Î”i+1 ,Î”n ï¿½

Hence, the conditional expectation of (arb + Îµr)âˆ™1(ÎµâˆˆBkr) given Îµ âˆˆ Aka is
P

âˆ™ ln

âˆ‘Jn=0 eana +max(Î”i ,Î”n )
J
âˆ‘n=0 eana +maxï¿½Î”i+1 ,Î”n ï¿½

earb âˆ™âˆ‘Jn=0 e ana
1
âˆ™
J
a
na âˆ‘
eana +maxï¿½Î”i+1 ,Î”n ï¿½
n=0 e
n=0

J
kri
Prb|ka ğ›¾ğ›¾0 + âˆ‘râˆ’1
âˆ™ ln âˆ‘n=0 eana+max(Î”i ,Î”n) + âˆ‘râˆ’1
i=k P
i=k âˆ‘i
ka

Summing this expression over r > k gives
P

âˆ™ ln

J

âˆ‘n=0 eana +maxï¿½Î”i ,Î”n ï¿½

J
âˆ‘
eana +maxï¿½Î”i+1 ,Î”n ï¿½
n=0

J

kri
(1 âˆ’ Pkb|ka )ğ›¾ğ›¾0 + âˆ‘r>k âˆ‘râˆ’1
âˆ™ ln âˆ‘n=0 eana+max(Î”i ,Î”n)
i=k P

+ âˆ‘r>k âˆ‘râˆ’1
i=k

1

âˆ‘in=0 e ana

âˆ™

ka

ğ‘’ğ‘’arb âˆ™âˆ‘Jn=0 e ana
J
âˆ‘
eana +maxï¿½Î”i+1 ,Î”nï¿½
n=0

Jâˆ’1

J

= (1 âˆ’ Pkb|ka )ğ›¾ğ›¾0 + âˆ‘i=k âˆ‘r=i+1
Jâˆ’1

+ âˆ‘i=k

Pkri
Pka

âˆ™ ln

J

âˆ‘n=0 eana+maxï¿½Î”i ,Î”n ï¿½

J
âˆ‘
eana +maxï¿½Î”i+1 ,Î”n ï¿½
n=0

âˆ™ ln âˆ‘Jn=0 eana+max(Î”i,Î”n)

J
J
âˆ‘r=i+1 ğ‘’ğ‘’arb âˆ™âˆ‘n=0 e ana
1
âˆ™
ï¿½Î”i+1 ,Î”n ï¿½
a
+max
na
âˆ‘in=0 e ana âˆ‘J
e
n=0

âˆ™ ln

J

âˆ‘n=0 eana +maxï¿½Î”i ,Î”n ï¿½

J
âˆ‘
eana +maxï¿½Î”i+1 ,Î”n ï¿½
n=0

.

Combining this expression with the earlier conditional expectation for r = k,
ğ„ğ„Îµ|Aka max(arb + Îµr ) = ğ›¾ğ›¾0 +
râ‰¥k

Jâˆ’1
+ âˆ‘i=k

âˆ‘Ji=0 eaia

âˆ‘Ji=0 emax(aia ,aib +aka â€“ akb )

J
J
âˆ‘r=i+1 ğ‘’ğ‘’arb âˆ‘n=0 e ana
J
ï¿½Î”i ,Î”n ï¿½)â„ğœğœ
(a
+max
âˆ‘
e na
n=0

1
ana
n=0 e

Jâˆ’1
+ âˆ‘i=k
âˆ‘i

A consequence of this formula is

âˆ™

âˆ™

ï¿½akb âˆ’ aka + lnï¿½âˆ‘Ji=0 emax(aia ,aib+akaâ€“ akb ) ï¿½ï¿½

ï¿½eÎ”i+1 âˆ’eÎ”i ï¿½

J
âˆ‘
e(ana +maxï¿½Î”i+1 ,Î”n ï¿½)â„ğœğœ
n=0

âˆ‘Jr=i+1 ğ‘’ğ‘’ arb âˆ™âˆ‘Jn=0 e ana

âˆ‘Jn=0 e(ana +maxï¿½Î”i+1

âˆ™ ln
,Î”n ï¿½)

ğ„ğ„ maxï¿½ajb + Îµj ï¿½|Aka ) âˆ’ ğ„ğ„ maxï¿½aja + Îµj ï¿½|Aka )
jâˆˆğ‰ğ‰

jâˆˆğ‰ğ‰

64

âˆ™ ln âˆ‘Jn=0 eana+max(Î”i ,Î”n)

âˆ‘Jn=0 eana +max(Î”i ,Î”n )

âˆ‘Jn=0 eana +maxï¿½Î”i+1 ,Î”n ï¿½

.

.

= âˆ‘J

âˆ‘Ji=0 eaia
max(aia ,aib +aka â€“ akb )

i=0 e

Jâˆ’1
+ âˆ‘i=k

J

J

âˆ‘r=i+1 ğ‘’ğ‘’arb âˆ‘n=0 e ana
J
âˆ‘
eana +maxï¿½Î”i,Î”n ï¿½
n=0

1
ana
n=0 e

+ âˆ‘Jâˆ’1
i=k âˆ‘i

âˆ™

J

ï¿½akb âˆ’ aka + Ïƒ âˆ™ lnï¿½âˆ‘Ji=0 emax(aia,aib+akaâ€“ akb ) ï¿½ï¿½ âˆ’ ln âˆ‘n=0 eana
âˆ™

ï¿½eÎ”i+1 âˆ’eÎ”i ï¿½

J
âˆ‘
eana +maxï¿½Î”i+1 ,Î”nï¿½
n=0

âˆ‘Jr=i+1 ğ‘’ğ‘’ arb âˆ™âˆ‘Jn=0 e ana

âˆ‘Jn=0 eana +maxï¿½Î”i+1,Î”n ï¿½

âˆ™ ln âˆ‘Jn=0 eana+max(Î”i ,Î”n)

âˆ™ Ïƒ âˆ™ ln

âˆ‘Jn=0 eana +max(Î”i ,Î”n )
J
âˆ‘n=0 eana +maxï¿½Î”i+1,Î”n ï¿½

.

Appendix C. R-Code for the Discrete Welfare Calculus using a Synthetic Population
#Code to estimate losses from consumers not knowing their data were shared
sink('P:\\USER\\Kenneth.Train\\misperceptions\\simulation of privacy
results\\SimulationsForDan.txt')
#Attributes
# 1 price
# 2 Commercials shown between shows
# 3 Fast content availability
# 4 More TV shows
# 5 More movies
# 6 share usage data
# 7 share usage and personal data
# 8 No service
#Estimated parameters of distribution of WTP and scale
#alpha is scale parameter; 1/alpha is distributed log-normal
#WTPs are dsitributed normal
#Estimates are in Table 9 and 10 of Foundations
#Mean, stdev, and correlation matrix of underlying normals:
#Order: log(1/alpha), commercials, fast, mostly TV, mostly movies, share usage,
share personal and usage
normmn <- c(-2.0002, -1.562, 3.945, -0.6988, 2.963, -0.6224, -2.705, -27.26)
normstd <- c(1.0637, 3.940, 3.631, 4.857, 2.524, 2.494, 6.751, 19.42)
r1 <- c(1, -0.5813, -0.1371, 0.0358, 0.0256, 0.0022, -0.1287, 0.2801)
r2 <- c(0, 1.0000, 0.1172, -0.3473, 0.0109, -0.2562, -0.0079, -0.4108)
r3 <- c(0, 0,
1.0000, 0.8042, -0.4019, -0.3542, -0.4206, 0.2391)
r4 <- c(0, 0,
0,
1.0000, -0.5890, -0.1695, -0.3328, 0.4616)
r5 <- c(0, 0,
0,
0,
1.0000, 0.5141, 0.5181, -0.0147)
r6 <- c(0, 0,
0,
0,
0,
1.0000, 0.9370, -0.0563)
r7 <- c(0, 0,
0,
0,
0,
0,
1.0000, -0.0975)
r8 <- c(0, 0,
0,
0,
0,
0,
0,
1.0000)
corrMat=rbind(r1,r2,r3,r4,r5,r6,r7,r8)
corrMat=corrMat+t(corrMat) - diag(1,8);

#Specification of services available and combinations of services.
# Look like netflix (N), Amazon Prime (A), huluplus (H), and combos eg NA
N <- c(7.99, 0, 0, 0, 1, 0, 0, 0)

65

A <- c(6.58, 0, 0, 1, 0, 0, 0, 0)
H <- c(7.99, 0, 1, 0, 0, 0, 0, 0)
nos <- c(0,0,0,0,0,0,0,1) #No service
#Create matrix of attributes of the 8 alternatives:
xmat <- rbind(N,A,H,N+A,N+H,A+H,N+A+H,nos) #8 alts x 8 attributes
#Indicator of which alternatives have Hulu:
hasH <- c(0,0,1,0,1,1,1,0)
ndraws <- 1000000
samplen <- c(86, 14, 12, 35, 21, 3, 22, 107) #Number of people in survey who chose
each of the 8 alternatives
mktshares <- samplen/sum(samplen)
market <- sum(samplen)*(6/58) #in million. We know Hulu has 6m customers and 58
people in the survey have Hulu
#Create draws of coefficients
set.seed(1234)
coef <- matrix(rnorm(8*ndraws),8,ndraws)
coef <- matrix(rep(normmn,times=ndraws),8,ndraws) + diag(normstd) %*%
(t(chol(corrMat)) %*% coef)
print("Check mean, std, and correlation matrix of draws against true")
print("Means: simulated and true")
print(cbind(rowMeans(coef),normmn)) #Check against normmn
print("Stds: simulated and true")
print(cbind( sqrt(diag(cov(t(coef)))), normstd)) #Check against normstd
print("Correlation matrix, simulated first, then true")
print(cor(t(coef))) #Check against corrMat
print(corrMat)
wtpsharing <- coef[7,]
pcoef <- exp(coef[1,]); #For lognormally distributed price
coef[1,]<- -pcoef; #First coef is for price
coef[2:8,] <- matrix(rep(pcoef, each=7),7,ndraws) * coef[2:8,] #Attribute coefs are
wtp times price coef
#Calculate representative decision utility and choice probabilities
u <- xmat %*% coef
eu <- exp(u)
eu[is.infinite(eu)] <- 10^300
p <- eu / matrix(rep(colSums(eu),each=8),8,ndraws)
s <- rowMeans(p)
# Adjust constants to equal market shares
alpha <- matrix(0,8,1)
oldu <- u
for(count in 1:20){
alpha <- alpha+log(mktshares / s)
u <- oldu+matrix(rep(alpha,times=ndraws),8,ndraws)
eu <- exp(u)
eu[is.infinite(eu)] <- 10^300
p <- eu / matrix(rep(colSums(eu),each=8),8,ndraws)
s <- rowMeans(p)
}

66

print("ASCs")
print(alpha)
print("Predicted and actual market shares at ASCs")
print(cbind(s,mktshares))

#Calculate welfare impact of lack of knowlegde of sharing by hulu-like service
#Actual attributes; which includes sharing of usage and personal data by hulu
#Same as above but now 1 in column 7 for Hulu, to indicate that Hulu shares
personal and usage info:
H[7] <- 1
xmatnew <- rbind(N,A,H,N+A,N+H,A+H,N+A+H, nos) #8 alts x 8 attributes
unew <- xmatnew %*% coef
unew <- unew + matrix(rep(alpha,times=ndraws),8,ndraws)
eunew <- exp(unew);
eunew[is.infinite(eunew)] <- 10^300
pnew <- eunew / matrix(rep(colSums(eunew),each=8),8,ndraws)
newshares <- rowMeans(pnew)
diffu <- unew-u
hold <- log(colSums(eu)) / pcoef
lsdecision <- mean(hold) #expected log sum based on decision utility
hold <- log(colSums(eunew)) / pcoef
lsrealized <- mean(hold) #expected log sum based on realized utility
hold <- colSums(p * diffu) / pcoef
squareloss<- mean(hold) #expected difference between perceived and actual utility
in money metric
hulusubscribers= t(mktshares) %*% hasH
print("Difference between peoples realized utility and decision utility for chosen
alternative")
print("in money metric.")
print("Aggregate, and per-person who subscribed to Hulu")
print(cbind((squareloss * market), (squareloss / hulusubscribers)))
print("Note: Conditional mean WTP (second number above) differs from unconditional
mean of 2.70.")
print("Difference between peoples realized utility and the utility they would have
obtained if informed");
print("in money metric.");
print("Aggregate, and per-person who subscribed Hulu")
print(cbind(((lsdecision-lsrealized+squareloss) *market),((lsdecisionlsrealized+squareloss) / hulusubscribers)))
print("Hulu share")
print("Actual choices, informed choices, percent difference")
print(cbind(hulusubscribers,(t(newshares) %*% hasH),((t(mktshares-newshares) %*%
hasH) / hulusubscribers)))

#Break down analysis further by conditioning on choice and whether person likes or
dislikes sharing info.

67

poswtp <- coef[7,]>=0 #These people like sharing their information; others dislike
it.
everrors <- matrix(runif(8*ndraws),8,ndraws)
everrors <- -log(-log(everrors))
util <- u+everrors
util <- util / matrix(rep(pcoef,each=8),8,ndraws) #So utils are back in money
metric
utilnew <- unew+everrors
utilnew <- utilnew / matrix(rep(pcoef,each=8),8,ndraws)
i=max.col(t(util))
inew=max.col(t(utilnew))
c=matrix(0,1,ndraws)
exper_util=matrix(0,1,ndraws)
cnew=matrix(0,1,ndraws)
for(n in 1:ndraws) {
chosenalt <- i[n]
c[1,n] <- util[chosenalt,n]
exper_util[1,n] <- utilnew[chosenalt,n]
newchosenalt <- inew[n]
cnew[1,n] <- utilnew[newchosenalt,n]
}
Huluer <- i == 3 | i == 5 | i== 6 | i==7
NumHuluer <- sum(Huluer)
NumHuluerPosWTP <- sum(Huluer * poswtp)
NumHuluerNegWTP <- sum(Huluer *(1-poswtp))
print("Dollar difference in welfare relative what expected")
print("Aggregate, per person, per Hulu subscriber")
print("Everyone:")
xx <- exper_util-c
print(cbind(market * mean(xx), mean(xx), sum(xx)/NumHuluer))
print ("People whose dislike sharing:")
xx <-(exper_util-c) * (1-poswtp)
print(cbind(market * mean(xx), mean(xx), sum(xx)/NumHuluerNegWTP))
print("People whose like sharing:")
xx <-(exper_util-c) * poswtp
print(cbind(market * mean(xx), mean(xx), sum(xx)/NumHuluerPosWTP))
NumOther <- sum(1-Huluer)
NumOtherPosWTP <- sum(Huluer*poswtp)
NumOtherNegWTP <- sum(Huluer*(1-poswtp))
print("Dollar difference in welfare relative to being informed")
print("Aggregate, per person, average for Hulu subscribers, average for nonsubscribers")
print("Everyone:")
xx <- exper_util-cnew
print(cbind(market*mean(xx), mean(xx), mean(xx[Huluer==1]), mean(xx[Huluer==0]) ))
print("People whose dislike sharing:")
print(cbind(mean(1-poswtp)*market*mean(xx[poswtp==0]), mean(xx[poswtp==0]),
mean(xx[Huluer==1 & poswtp==0]), mean(xx[Huluer==0 & poswtp==0]) ))
print("People whose like sharing:")
print(cbind(mean(poswtp)*market*mean(xx[poswtp==1]), mean(xx[poswtp==1]),
mean(xx[Huluer==1 & poswtp==1]), mean(xx[Huluer==0 & poswtp==1]) ))

68

choicemat <- array(0,dim=c(8,8,2)) #Rows for actual choice, cols for choice if
informed, depth for wtp<>0
exper_diff <- array(0,dim=c(8,8,2))
welfare_diff <- array(0,dim=c(8,8,2))
for(rr in 1:8) {
for(cc in 1:8) {
k <- (i == rr) & (inew == cc) & (poswtp==0)
choicemat[rr,cc,1] <- sum(k==1)
exper_diff[rr,cc,1] <- sum(c[k==1]-exper_util[k==1])
welfare_diff[rr,cc,1] <- sum(exper_util[k==1]-cnew[k==1])
k <- (i == rr) & (inew == cc) & (poswtp==1)
choicemat[rr,cc,2] <- sum(k==1)
exper_diff[rr,cc,2] <- sum(c[k==1]-exper_util[k==1])
welfare_diff[rr,cc,2] <- sum(exper_util[k==1]-cnew[k==1])
}
}

print("Hulu subscriber or not")
matH <- matrix(c( hasH,(1-hasH)),8,2)
subscribe1 <- t(matH) %*% choicemat[,,1] %*% matH
subscribe2 <- t(matH) %*% choicemat[,,2] %*% matH
print("Share of population who chose row and would have chosen col")
print((subscribe1+subscribe2)/ndraws )
print("Of people who dislike sharing, share who chose row and would have chosen
col")
print( subscribe1/sum(subscribe1) )
print("Of people who like sharing, share who chose row and would have chosen col")
print( subscribe2/sum(subscribe2) )
sink()

69

