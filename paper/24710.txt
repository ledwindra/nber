                             NBER WORKING PAPER SERIES




         INEQUALITY, BUSINESS CYCLES, AND MONETARY-FISCAL POLICY

                                       Anmol Bhandari
                                        David Evans
                                      Mikhail Golosov
                                      Thomas J. Sargent

                                     Working Paper 24710
                             http://www.nber.org/papers/w24710


                    NATIONAL BUREAU OF ECONOMIC RESEARCH
                             1050 Massachusetts Avenue
                               Cambridge, MA 02138
                                    June 2018




We thank Adrien Auclert, Benjamin Moll, and seminar participants at numerous seminars and
conferences for helpful comments The views expressed herein are those of the authors and do not
necessarily reflect the views of the National Bureau of Economic Research.

NBER working papers are circulated for discussion and comment purposes. They have not been
peer-reviewed or been subject to the review by the NBER Board of Directors that accompanies
official NBER publications.

¬© 2018 by Anmol Bhandari, David Evans, Mikhail Golosov, and Thomas J. Sargent. All rights
reserved. Short sections of text, not to exceed two paragraphs, may be quoted without explicit
permission provided that full credit, including ¬© notice, is given to the source.
Inequality, Business Cycles, and Monetary-Fiscal Policy
Anmol Bhandari, David Evans, Mikhail Golosov, and Thomas J. Sargent
NBER Working Paper No. 24710
June 2018
JEL No. C63,E52,E63

                                        ABSTRACT

We study optimal monetary and fiscal policy in a model with heterogeneous agents, incomplete
markets, and nominal rigidities. We develop numerical techniques to approximate Ramsey plans
and apply them to a calibrated economy to compute optimal responses of nominal interest rates
and labor tax rates to aggregate shocks. Responses differ qualitatively from those in a
representative agent economy and are an order of magnitude larger. Taylor rules poorly
approximate the Ramsey optimal nominal interest rate. Conventional price stabilization motives
are swamped by an across person insurance motive that arises from heterogeneity and incomplete
markets.

Anmol Bhandari                                Mikhail Golosov
Department of Economics                       Department of Economics
University of Minnesota                       University of Chicago
1925 Fourth Street South                      1126 E. 59th Street
Minneapolis, MN 55455                         Chicago, IL 60637
and NBER                                      and NBER
bhandari@umn.edu                              golosov@uchicago.edu

David Evans                                   Thomas J. Sargent
Economics Department                          Department of Economics
University of Oregon                          New York University
devans@uoregon.edu                            19 W. 4th Street, 6th Floor
                                              New York, NY 10012
                                              and NBER
                                              thomas.sargent@nyu.edu
1 Introduction
We study monetary and scal policy in a New Keynesian economy populated by

agents who face aggregate and idiosyncratic risks. Agents dier in wages, exposures to

aggregate shocks, holdings of nancial assets, and abilities to trade assets. Incomplete

nancial markets prevent agents from fully insuring risks. Firms are monopolistically

competitive. Price adjustments are costly. We examine how the Ramsey planner's

choices of nominal interest rates, transfers, and proportional labor tax rates respond

to aggregate shocks.

   Analysis of Ramsey policies in settings like ours faces substantial computational

challenges. The aggregate state in a recursive formulation of the Ramsey problem in-

cludes the joint distribution of individual asset holdings and auxiliary promise-keeping

variables that had been chosen by the planner earlier. The law of motion for that

high-dimensional object must be jointly determined with the optimal policies. This

feature renders inapplicable existing numerical techniques that rely on approximating

around a known invariant distribution associated with xed government policies.

   To overcome this challenge, we develop a new computational approach that can

be applied to economies with substantial heterogeneity and does not require knowing

their long-run properties in advance. Our approach builds on a perturbation theory

that uses small-noise expansions with respect to a one-dimensional parameterization

of uncertainty. Each period along a sample path, we apply a perturbation algorithm

evaluated at the current cross-sectional distribution to approximate policy functions.

We use approximate decision rules for the current period to determine outcomes

including the cross-sectional distribution next period. Then we obtain approximations

of next period's decision rules by perturbing around that new distribution. In this

way we update points around which policy functions are approximated along the

equilibrium path.

   Our perturbation approach requires computing derivatives of policy functions

with respect to all state variables. One state variable is a distribution over a multi-

dimensional space of agents' characteristics. Except for very simple models of hetero-

geneity, it is impractical to compute the derivative with respect to this distribution

(i.e., the Frechet derivative). We make progress by showing that our expansion re-

quires only the value of that derivative at a point that corresponds to the optimal

Ramsey response. We derive an expression for this value and show that it is a linear




                                           2
function of variables that are easy to compute. That mathematical structure allows

us to compute approximations to each agent's policy function by solving low dimen-

sional linear systems of equations that are independent across agents. This feature

enables us to solve our model quickly even though it has ample sources of hetero-

geneity. Furthermore, we proceed to show that the same computationally convenient

linear structure is preserved for second- and higher-order expansions. That allows us

to capture precautionary and hedging motives.

   We apply our approach to a textbook New Keynesian sticky price model (see, e.g.,

Gal√≠ (2015)) augmented with heterogeneous agents in the spirit of Bewley-Aiyagari.

Agents' wages are subject to idiosyncratic and aggregate shocks that we calibrate to

match empirical facts about labor earnings documented by Storesletten et al. (2004)

and Guvenen et al. (2014).    We make the initial joint distribution of assets and

wages match cross-sectional moments in the Survey of Consumer Finances. We posit

two types of aggregate shocks: a productivity shock and a shock to the elasticity

of substitution between dierentiated intermediate goods that aects rms' optimal

markups.   Financial markets are incomplete and agents can trade only non-state-

contingent nominal debt. We study two types of Ramsey policies. First, a purely

monetary policy planner is required to keep the labor tax rate xed, an assumption

commonly used with New Keynesian models. In this case, the planner can adjust only

nominal interest rates and a uniform lump-sum transfer.     Second, a more powerful

monetary-scal Ramsey planner can adjust tax rates in addition to interest rates

and transfers.

   Two motives inherited from the Ramsey planner's objective function shape optimal

policies. One is the usual New Keynesian motive to use government policies to oset

ineciencies caused by sticky prices.   A second is a desire to provide insurance.

Without a complete set of Arrow securities, agents cannot hedge risk, so aggregate

shocks aect dierent agents dierentially.   A planner can use monetary and scal

tools to even out the impact of those shocks and provide insurance. In our calibrated

economy, we nd that the insurance motive quantitatively swamps price stability

considerations. That makes optimal policy responses dier signicantly from those in

a representative agent economy where they are primarily driven by the price stability

motive.

   Consider rst the optimal monetary response to a positive markup shock. One

eect of a markup shock is that rms want to increase their prices. Nominal rigidities




                                          3
make that costly. When price stability is its only motive, the planner increases the

nominal interest rate in response to a positive markup shock. That lowers aggregate

demand and marginal costs and thereby reduces rms' incentives to raise prices. Gal√≠

(2015) dubs this optimal response in representative agent New Keynesian economies

as leaning against the wind.   With heterogeneous agents, a markup shock redis-

tributes resources among households. Higher markups shift factor income from wages

to dividends, beneting rm owners and hurting wage recipients. To provide insur-

ance, the planner can decrease interest rates in order to boost aggregate demand and

real wages. The planner does that to oset the negative eect of the markup shock

on wage-earners. The net eect of the markup shock on optimal policy depends on

the relative strengths of the planner's price stability and insurance motives. When

we calibrate the distribution of equity ownership to U.S. data, we nd that a one

standard deviation positive markup shock, which implies a 0.5 percentage point in-

crease in rms' optimal markups, calls for a 0.3 percentage point decrease in the

nominal interest rate versus a 0.05 percentage point increase with a representative

agent calibration.

   Price stability and insurance motives also bring dierent prescriptions for the

optimal scal response.   To ensure price stability in response to a positive markup

shock, the planner wants to lower the marginal tax rate one for one with the shock.

This requires lowering transfers to satisfy the government's budget constraint, making

the average taxes more regressive. To provide insurance, the planner needs to raise

taxes and transfers to increase progressivity and oset the distributionary impact of

the shock. In the calibrated economy, the insurance channel dominates: in response

to a one standard deviation positive markup shock, a planner increases tax rates by

2 percentage points. This scal response comes on top of a cut in nominal interest

rates by about 0.25 percentage points and a 1 percentage point spike in ination.

The tax increase is short-lived, which contrasts with the very persistent eects of

aggregate shocks on optimal tax rates in non-monetary economies, such as Barro

(1979) and Aiyagari et al. (2002).    The reason for this is that deadweight losses

from temporary tax changes in New Keynesian models are lower than those from

permanent tax changes:     rms choose not to adjust nominal prices to temporary

shocks, and consequently a transitory tax change mostly aects tax incidence but not

the labor wedge.

   The insurance motive also substantially aects Ramsey responses to TFP shocks.




                                          4
With heterogeneous agents, eects of productivity shocks are not shared equally: bor-

rowers in state-non-contingent nominal debt are hurt more than lenders. This eect

is further amplied when, as in the data, nancial and wage income are positively

correlated and because labor incomes of low earners are especially adversely aected

by recessions (see Guvenen et al. (2014)). To even out adverse eects of the shock,

the planner cuts nominal interest rates, thereby generating ination and lowering

realized returns on debt holdings. This contrasts with a typical New Keynesian re-

sponse that would maintain stable prices by adjusting nominal rates one-for-one with

the natural rate of interest.
                                  1 In our calibrated economy, we nd that in response

to a productivity shock that lowers output by 3 percentage point, nominal rates are

lowered by 0.6 percentage point.

    In our heterogeneous agent economy, Taylor rules perform substantially worse

than in a representative agent counterpart. Without heterogeneity, the main purpose

of optimal policy is to stabilize ination; Taylor rules meet this objective well. But

they do poorly in the presence of heterogeneity for two reasons. First, in response

to markup shocks it is optimal to move interest rates in the opposite direction from

that prescribed by standard Taylor rules. Second, while Taylor rules make nominal

interest rates and ination as persistent as exogenous shocks, the Ramsey planner

prefers more transient nominal interest rates and ination to provide insurance.

    We also investigate the eects of trading frictions on optimal policy.                 Typical

Bewley-Aiyagari models poorly match observed cross-section distributions of MPCs.

We alter our economy to include a set of agents who can hold assets and consume

their returns but cannot trade them. We choose the distribution of such agents to

match MPC heterogeneity estimated by Jappelli and Pistaferri (2014). We nd that

in such an economy the optimal response of nominal interest rates is smaller than in

our benchmark calibration to markup shocks, but not to productivity shocks. This

outcome emerges because in response to a markup shock the Ramsey planner would

like to alter aggregate demand and real wages. These quantities are determined by

average   actions across agents. Changes in interest rates have a direct eect only on

agents who can trade their assets. By reducing the number of such agents, trading

frictions make monetary policy less eective, an outcome emphasized by Auclert

(2017) and Kaplan et al. (2018). But in response to a TFP shock the planner wants

   1 The natural interest rate is dened as the real interest rates that would prevail in an economy
without nominal rigidities.




                                                 5
to aect returns on nancial assets that are determined by a                marginal   investor and

do not depend on the number of such investors.                 We also nd that the presence

of trading frictions increases the importance of scal instruments like transfers that

directly aect the consumption of high MPC agents.



1.1 Earlier works
A number of contributions characterized and approximated competitive equilibria

with exogenously xed government policies.               These employ one of two broad ap-

proaches that either (i) compute non-linear policies after summarizing the distribu-

tional state variable with a low dimensional vector of its moments, for instance Krusell

and Smith (1998), or (ii) apply a rst-order Taylor expansion of policy functions with

respect to the aggregate shocks around an invariant distribution for an economy with-

out aggregate shocks, for instance Reiter (2009).
                                                            2 Neither approach is suitable for

our problem. First, for us an invariant distribution depends on a key object that we

want to compute, namely, the Ramsey policy. Furthermore, the invariant distribution

under a Ramsey plan for an incomplete markets without aggregate shocks looks very

dierent from the invariant distribution of the same economy with small aggregate

shocks.   In addition, the speed of convergence to this invariant distribution is slow

and the behavior of optimal policies around the invariant distribution diers signi-

cantly from the behavior of policies away from the invariant distribution.
                                                                                       3 Finally, the

state space in an economy under the Ramsey plan is much larger because it includes

promise-keeping variables for the planner in addition to all of states that appear in a

corresponding economy with an arbitrary exogenous government policy.

    Our computational approach uses a one dimensional scaling of uncertainty and a

sequence of small-noise expansions along an equilibrium path. Our approach is most

closely related to Fleming (1971), Fleming and Souganidis (1986), and Anderson et al.

(2012). State variables in the models studied by Anderson et al. are low dimensional,

for example just an aggregate capital stock. In contrast, our state variable is a joint

   2 See Algan et al. (2014) for variants of the Krusell and Smith method and Ahn et al. (2017);
Winberry (2016); Childers et al. (2018) for the variants of the Reiter method.
   3 Such outcomes are evident in Barro (1979), Aiyagari et al. (2002), and Farhi (2010). In Bhandari
et al. (2017a), we consider a simplied version of the economy studied in this paper and show that
while the invariant distribution in a Ramsey problem without aggregate shocks is pinned down by
initial conditions (such as the initial distribution of wealth), the invariant distribution in a corre-
sponding problem with aggregate shocks is determined by motives to hedge such shocks. Therefore,
the invariant distribution is discontinuous in the degree of aggregate risk around zero risk.




                                                  6
distribution over a multi-dimensional domain. That renders direct application of the

Anderson et al. technique computationally infeasible. We overcome this problem by

proving and applying a factorization theorem (see section 3) that allows us to break

one big problem into a manageable collection of much smaller ones. We show how

these ideas can be used to construct second- and higher-order approximations. Our

approach builds on Evans (2015).

      Most studies of optimal policy have been restricted to economies with very lim-

ited or no heterogeneity.         Schmitt-Grohe and Uribe (2004) and Siu (2004) are two

notable quantitative studies of Ramsey policies in representative agent New Keyne-

sian models. Our parameterization follows theirs. So as might be expected, when all

heterogeneity is shut down, we obtain quantitative results similar to theirs. Bilbiie

and Ragot (2017), Nuno and Thomas (2016), Challe (2017), and Debortoli and Gali

(2017) study optimal monetary policy in economies with very limited heterogeneity.

In those settings, the aggregate distribution disappears from the formulation of the

Ramsey problem and the analysis can be done using traditional techniques. Like us,

they emphasize that uninsurable risk creates reasons for a planner to depart from

price stability. A recent paper by Legrand and Ragot (2017) develops a method dif-

ferent from ours to approximate Ramsey allocations in incomplete market economies

with heterogeneity. They apply their method to a neoclassical economy.




2 Environment
Our economy is populated by a continuum of innitely lived households. Individual

i's   preferences over nal consumption good                      {ci,t }t    and hours      {ni,t }t   are ordered by


                                           ‚àû
                                                             c1‚àíŒΩ   n1+Œ≥
                                           X                                    
                                                     t
                                      E0         Œ≤                ‚àí                  ,                                 (1)
                                           t=0
                                                             1‚àíŒΩ 1+Œ≥

where    Et   is an expectations operator conditioned on time                            t information and Œ≤ ‚àà (0, 1)
is a time discount factor.

      Agent    i   who works   ni,t   hours supplies              i,t ni,t   units of eective labor, where           i,t
is an exogenous productivity process.                        Eective labor receives nominal wage                   Pt W t ,
where    Pt   is the nominal price of the nal consumption good at time                                 t.   Labor income

is taxed at a proportional labor tax rate                     Œ•t .   All agents receive a uniform lump sum




                                                              7
transfer   Tt Pt .   Agents trade a one-period risk-free nominal bond with price                                                  Qt   in units

of the nal consumption good. We use                                    Pt bi,t , Pt Bt        to denote bond holdings of agent

i   and the debt position of the government respectively.                                                       Œ†t   denotes the net ination

rate. Finally,       di,t   denotes dividends from intermediate goods producers measured in

units of the nal good. Agent                   i's      budget constraint at                               t   is


                                                                                                                      bi,t‚àí1
                        ci,t + Qt bi,t = (1 ‚àí Œ•t )Wt i,t ni,t + Tt + di,t +                                                 .             (2)
                                                                                                                     1 + Œ†t

The government's budget constraint at time                                       t   is

                                                                                         Z
                                         1
                            GÃÑ + Tt +        Bt‚àí1 = Œ•t Wt                                     i,t ni,t di + Qt Bt ,
                                      1 + Œ†t                                              i


where   GÃÑ   is the level of non-transfer expenditures.

     A nal good        Yt is produced by competitive rms                                           that use a continuum of inter-

mediate goods         {yt (j)}j‚àà[0,1] in a production function

                                                         Z     1                             Œ¶Œ¶‚àí1
                                                                                                 t
                                                                              Œ¶t ‚àí1             t
                                               Yt =                 yt (j)     Œ¶t     dj                    ,
                                                            0


where the elasticity of substitution                       Œ¶t       is stochastic. Final good producers take nal

good prices     Pt    and intermediate goods prices                               {pt (j)}j             as given and solve


                                               Z    1                            Œ¶Œ¶‚àí1
                                                                                     t              Z       1
                                                                    Œ¶t ‚àí1            t
                             max          Pt             yt (j)      Œ¶t     dj                ‚àí                 pt (j)yt (j)dj.            (3)
                        {yt (j)}j‚àà[0,1]          0                                                      0


Outcomes of optimization problem (3) are a demand function for intermediate goods

                                                                                 ‚àíŒ¶t
                                                                         pt (j)
                                                yt (j) =                                      Yt ,
                                                                          Pt

and a nominal price satisfying

                                                                                              1
                                                         Z         1                      1‚àíŒ¶
                                                                                                    t
                                                                                 1‚àíŒ¶t
                                               Pt =                     pt (j)                          .
                                                                0




                                                                          8
Intermediate goods             yt (j)   are produced by monopolists with production function

                                                                    Œ±
                                                    yt (j) = nD
                                                            
                                                              t (j)    ,

where       nD                                   Œ± ‚àà (0, 1]. These intermediate goods
             t (j) is eective labor hired by rm j                    and
                                                              ‚àíŒ¶t
                                                        pt (j)
monopolists face downward sloping demand curves
                                                         Pt
                                                                    Yt and choose prices
                                                                                        2
                                                                              pt (j)
pt (j) while bearing quadratic Rotemberg (1982) price adjustment costs œà2 pt‚àí1    (j)
                                                                                      ‚àí 1
measured in units of the nal consumption good. Firm j chooses prices {pt (j)}t that

solve
                                            Ô£±
                                        ‚àíŒΩ Ô£≤              ‚àíŒ¶t
                                                                       Ô£Æ
                                                                                                  ‚àíŒ¶t        ! 1‚àíŒ± Ô£π
                                                                                                              Œ±
                     X             Ct          pt (j)             pt (j) Wt              pt (j)
         max E0           Œ≤t                                 Yt Ô£∞       ‚àí                                Yt         Ô£ª
        {pt (j)}t
                      t
                                   C0        Ô£≥ Pt                  Pt      Œ±              Pt
                                                                      2 )
                                                      œà   pt (j)
                                                    ‚àí             ‚àí1        ,                                           (4)
                                                      2 pt‚àí1 (j)

where we have imposed that each rm values prot streams with a stochastic discount

                                                                     Ct = ci,t di.4
                                                                          R
factor that is driven by aggregate consumption

    In a symmetric equilibrium,                     pt (j) = Pt , yt (j) = Yt for all j .            Market clearing

conditions in labor, goods, and bond markets are:

                                        Z
                                                                                         œà 2
                               Nt =         i,t ni,t di,       Dt = Yt ‚àí Wt Nt ‚àí         Œ†,                            (5)
                                                                                         2 t

                                                     yt (j) = Yt = NtŒ± ,                                                (6)

                                                                   œà
                                                  Ct + GÃÑ = Yt ‚àí Œ†2t ,                                                  (7)
                                                                   2
                                                     Z
                                                        bi,t di = Bt .                                                  (8)
                                                            i

    There are aggregate and idiosyncratic shocks. Aggregate shocks are a markup

shock
        5    Œ¶t   and an aggregate productivity                    Œòt .    The markup shock follows an AR(1)

   4 In economies with heterogeneous agents and incomplete markets one has to take a stand on
how rms are valued.           Using stochastic discount factor induced by aggregate consumption makes
our exposition most transparent. We have experimented with other alternatives such as weighted
means of individual intertemporal marginal rates of substitutions and found them to have negligible
eects on the main results.
   5 The New Keynesian literature has utilized markup or cost-push shocks to account for patterns
observed during business cycles (see, e.g., Smets and Wouters (2007)). The literature has proceeded
to study implications of those shocks for optimal monetary policy in a representative agent framework




                                                                   9
stochastic process



                                  ln Œ¶t = œÅŒ¶ ln Œ¶t‚àí1 + (1 ‚àí œÅŒ¶ ) ln Œ¶ÃÑ + EŒ¶,t ,

where   EŒ¶,t     is mean-zero and i.i.d. over time. We consider two alternative specication

for productivity shocks. In the rst specication, we simply assume that                           ln Œòt    follows

an AR(1) process described by



                                 ln Œòt = œÅŒò ln Œòt‚àí1 + (1 ‚àí œÅŒò ) ln ŒòÃÑ + EŒò,t ,                                   (9a)



where    EŒò,t is mean zero and i.i.d. over time. In                the second specication we assume

that   ln Œòt follows a growth rate shock process

                                               ln Œòt = ln Œòt‚àí1 + EŒò,t ,                                          (9b)



where again       EŒò,t is mean zero and i.i.d.        over time. Under the growth rate specication,

we scale government expenditures at time                    t to equal Gt = GÃÑŒòt where GÃÑ is a non-
negative constant and menu cost so that                  œàt = œàÃÑŒòt for some non-negative constant œàÃÑ
to achieve stationarity.
                                  6

    Individual productivity             i,t   follows a stochastic process described by



                                         ln i,t = ln Œòt + ln Œ∏i,t + Œµ,i,t ,                                    (10)



                                 ln Œ∏i,t = œÅŒ∏ ln Œ∏i,t‚àí1 + f (Œ∏i,t‚àí1 ) EŒò,t + ŒµŒ∏,i,t ,                            (11)


where   Œµ,i,t   and   ŒµŒ∏,i,t   are mean-zero, uncorrelated with each other and i.i.d. over time.

This specication of idiosyncratic shocks builds on formulations of wage dynamics

used by Storesletten et al. (2001) and Low et al. (2010)) in which                      Œµ,i,t   and   ŒµŒ∏,i,t   corre-

spond to transitory and persistent shocks to individual productivities. We augment

this specication with a function               f (Œ∏i,t‚àí1 ) that makes an aggregate productivity shock
have dierent loadings for agents with dierent earning histories. Doing that allows

(see, e.g., Clarida et al. (2001), Gal√≠ (2015), Woodford (2003)). As in Gal√≠ (2015), we interpret these
shocks as changes in desired markups arising from uctuations in the elasticity of substitution
parameter   Œ¶.    We leave for future work the study of other shocks such as wage markups.
   6 General insights are similar from these two alternative specications, but the i.i.d growth speci-
cation provides a convenient benchmark to study monetary policy because without market incom-
pleteness and nominal frictions, the real interest rate is constant.




                                                         10
us to capture some of the facts documented by Guvenen et al. (2014).

    We normalize the initial price level                       P‚àí1 = 1.       Agent    i   in period 0 is characterized

by a triple         (Œ∏i,‚àí1 , bi,‚àí1 , si ),   where   Œ∏i   is   agent i's      persistent productivity component,

bi,‚àí1   the initial holding of debt, and                  si    the ownership of equity. Agent                 i's   dividends

in period       t   are given by        di,t = si Dt .      This imposes that agents do not trade equity

and that       si   is a permanent characteristic. We refer to the collection                              {Œ∏i,‚àí1 , bi,‚àí1 , si }i
as an initial condition.


Denition 1.             Given an initial condition and a monetary-scal policy                               {Qt , Œ•t , Tt }t , a
                                                            
competitive equilibrium is a sequence                           {ci,t , ni,t , bi,t }i , Ct , Nt , Bt , Wt , Pt , Yt , Dt t such
that:      {ci,t , ni,t , bi,t }i,t maximize (1) subject to (2) and natural debt limits; (ii)
         (i)

nal goods rms choose {yt (j)}j to maximize (3); (iii) intermediate goods producers'

prices solve (4) and satisfy pt (j) = Pt ; and (iv) market clearing conditions (5)-(8) are

satised.


A utilitarian Ramsey planner orders allocations by


                                                ‚àû
                                                            "               #
                                                                c1‚àíŒΩ   n1+Œ≥
                                              Z X
                                                                 i,t    i,t
                                         E0            Œ≤t            ‚àí        di.                                           (12)
                                                 t=0
                                                                1‚àíŒΩ 1+Œ≥

Denition 2. Given an initial condition and a constant tax sequence {Œ•t }t satisfying
Œ•t = Œ•ÃÑ for some Œ•ÃÑ, an optimal monetary policy                            is a sequence      {Qt , Tt } t that supports a
competitive equilibrium allocation that maximizes (12). Given an initial condition,                                           an
optimal monetary-scal policy                  is a sequence           {Qt , Œ•t , Tt }t    that supports a competitive

equilibrium allocation that maximizes (12).                              A maximizing monetary or monetary-

scal policy is called the              Ramsey plan ; an associated allocation is called the Ramsey
allocation.
    A few remarks about our baseline formulation.                                   We begin by assuming natural

debt limits. This provides us with a useful benchmark and also avoids issues about

normative implications in economies with ad hoc debt limits being sensitive to as-

sumptions one makes on a government's ability to enforce debt and tax repayments.
                                                                                                                                7

   7 In Bhandari et al. (2017b) we provide a comprehensive treatment of a Ramsey problem with ad
hoc debt limits. In the economy with ad hoc debt limits the planner can simply choose the timing
of transfers to undo such ad hoc debt limits. If the planner enforces debt and tax liabilities equally
then welfare in the economies with ad hoc and natural debt limits coincides. Welfare can sometimes
be improved in the economy with ad hoc debt limits if the planner commits not to enforce private
debt contracts (see also Yared (2013) for a related result).




                                                                  11
After presenting results with natural debt limits, we introduce credit market frictions

in section 6. We discipline these frictions by matching observed heterogeneity in the

marginal propensities to consume and study how these frictions aect the Ramsey

plans. Assuming that equity ownership is xed provides us with a simple way to cal-

ibrate portfolio shares.
                                   8 We have distinguished between purely monetary and mixed

monetary-scal policies because doing so allows us to respect a common argument

that institutional constraints make it dicult to adjust tax rates in response to typical

business cycle shocks, leaving nominal interest rates as the government's only tool for

ameliorating such shocks. We capture that argument by studying optimal monetary

policy when tax rates              {Œ•t }t   are xed at some level            Œ•ÃÑ.   The monetary-scal Ramsey

plan evaluates the optimal policies when this restriction is dropped.




3 Solution method
Following steps used by Lucas and Stokey (1983), Schmitt-Grohe and Uribe (2004),

and others it is straightforward to establish that a monetary-scal policy                              {Qt , Œ•t , Tt }t
      
and       {ci,t , ni,t , bi,t }i , Ct , Nt , Wt , Pt , Yt , Dt   t
                                                                     are a competitive equilibrium if and only

if they satisfy (2), (5)-(7) and


                                                                       Œ≥
                                              (1 ‚àí Œ•t )Wt i,t c‚àíŒΩ
                                                                i,t = ni,t ,                                       (13)


                             ‚àíŒΩ                         ‚àí1
                       Qt‚àí1 ci,t‚àí1 = Et‚àí1 c‚àíŒΩ
                                           i,t (1 + Œ†t )   ,                                                       (14)

                                                    ‚àíŒΩ
 1                Wt                               Ct+1
   Yt 1 ‚àí Œ¶t 1 ‚àí           ‚àí Œ†t (1 + Œ†t ) + Œ≤Et              Œ†t+1 (1 + Œ†t+1 ) = 0.                                 (15)
 œà               Œ±NtŒ±‚àí1                             Ct
To formulate the Ramsey problem, it is convenient to rewrite some of these con-

straints.       After dening          ai,t ‚â° bi,t Qt c‚àíŒΩ
                                                       i,t ,         substituting for   Qt   and   (1 ‚àí Œ•t )Wt ,   and

solving the budget constraint forward, equations (2) can be expressed as a sequence

of measurability constraints inherited from the risk-free nature of one-period debt:

                                     "‚àû                                                    #
      ai,t‚àí1 c‚àíŒΩ
              i,t (1 + Œ†t )
                             ‚àí1       X
                                                        ‚àíŒΩ                         1+Œ≥
                                          Œ≤ s c1‚àíŒΩ
                                                                                         
                                = Et           i,t+s ‚àí ci,t+s (Tt+s + si Dt+s ) ‚àí ni,t+s                           (16)
      Œ≤Et‚àí1 c‚àíŒΩi,t (1 + Œ† t )‚àí1
                                      s=0

   8 More generally, one needs some adjustment costs to reconcile agents' portfolio choices with those
observed in data. Exploring normative implications of alternative cost specications is interesting
but outside the scope of the paper.




                                                                 12
fort ‚â• 1 as well as a similar constraint at t = 0 in which the left hand side is replaced
            ‚àíŒΩ
with bi,‚àí1 ci,0 . Dene
                                         1/ŒΩ   ci,t
                                       mi,t ‚â°                                        (17)
                                               Ct
and rewrite Euler equation (14) as


                                 ‚àíŒΩ
                                Ct‚àí1 Qt‚àí1 = Œ≤mi,t‚àí1 Et‚àí1 c‚àíŒΩ           ‚àí1
                                                          i,t (1 + Œ†t ) .                                   (18)



Variable   mi,t    can be interpreted as a time-t Pareto-Negishi weight of agent                     i.   It will

serve as a state variable in a recursive formulation of the Ramsey problem.

      We formulate the Ramsey problem using ideas of Marcet and Marimon (2011). Let

Œ≤ t Œõt , Œ≤ t Œæi,t be Lagrange multipliers    on (15) and (16), respectively. Dene                ¬µi,0 ‚â° Œæi,0 ,
¬µi,t = ¬µi,t‚àí1 + Œæi,t . Given an initial      condition    {Œ∏i,‚àí1 , bi,‚àí1 , si }i ,   and   Œõ‚àí1   = ai,‚àí1 = 0,
the Ramsey monetary-scal problem solves:


                   ‚àû
                              (Z "                  !
                   X                 c1‚àíŒΩ
                                      i,t   n1+Œ≥
                                             i,t                                       1+Œ≥
                         Œ≤t                                1‚àíŒΩ
                                                               ‚àí c‚àíŒΩ
                                                                                           
      inf sup E0                          ‚àí             + ci,t    i,t (Tt + si Dt ) ‚àí ni,t   ¬µi,t
                   t=0
                                     1‚àíŒΩ 1+Œ≥
                 ai,t‚àí1 c‚àíŒΩ   (1 + Œ†t )‚àí1 Œæi,t
              ‚àí          i,t ‚àíŒΩ              + (1 ‚àí Œ≤)c‚àíŒΩ
                                                         i,0 bi,‚àí1 ¬µi,0 di                                  (19)
                Œ≤Et‚àí1 ci,t (1 + Œ†t )‚àí1
                                                                                   
                     ‚àíŒΩ                         Wt                         ‚àíŒΩ
              + Œõt Ct Yt 1 ‚àí Œ¶t 1 ‚àí                      + (Œõt‚àí1 ‚àí Œõt )Ct œàŒ†t (1 + Œ†t ) ,
                                               Œ±NtŒ±‚àí1

subject to (5), (6), (7), (13), (17), (18) and               ¬µi,t = ¬µi,t‚àí1 + Œæi,t , where the sup is
                     
with respect to {ci,t , ni,t , bi,t }i , Ct , Nt , Bt , Wt , Pt , Yt , Dt , and inf is with respect to
                                                                          t
the multipliers {¬µi,t , Œõt }t . The Ramsey monetary problem is the same except the

sequence {Œ•t }t is exogenously xed.

     We call the subsequence of the Ramsey plan for t ‚â• 1 a continuation Ramsey plan.

It is recursive in aggregate states (Œòt‚àí1 , Œ¶t‚àí1 ), the Lagrange multiplier on the Phillips

curve equation Œõt‚àí1 , and the joint distribution over zi,t‚àí1 ‚â° (mi,t‚àí1 , ¬µi,t‚àí1 , Œ∏i,t‚àí1 , si )

that we denote by ‚Ñ¶t‚àí1 . Time t policy functions for aggregate variables depend on

(Œòt‚àí1 , Œ¶t‚àí1 , ‚Ñ¶t‚àí1 , Œõt‚àí1 , EŒò,t , EŒ¶,t ) while time t policy functions for individual variables
also depend on (zi,t‚àí1 , Œµ,i,t , ŒµŒ∏,i,t ). The Ramsey plan includes choices at time 0 and

solves time t = 0 rst-order conditions subject to the restriction that future variables

conform to the continuation Ramsey plan.

      Dependence of policy functions on the history-dependent endogenous distribu-




                                                   13
tion   ‚Ñ¶   makes computing the Ramsey plan challenging.                The law of motion of the

high-dimensional state variable         ‚Ñ¶ depends on optimal monetary-scal policies.               As we

discussed in the introduction, a key diculty is that before optimal policies are com-

puted little can be said about properties of the stochastic process              ‚Ñ¶t   and its invariant

distribution. This structure renders inapplicable computational techniques for solv-

ing heterogeneous agent economies that approximate around a stationary distribution

associated a xed set of government policies.

    To overcome this diculty we develop a new computational method that builds

on the perturbation theory of Fleming (1971), Fleming and Souganidis (1986), and

Anderson et al. (2012) as well as on Evans (2015). The method constructs a sequence

of small-noise expansions of policy functions around pertinent time                   t   state variables.

Using this approach, we rst approximate optimal policy functions at time                       t   around

the time-t state including         ‚Ñ¶t‚àí1 ,   then use those to compute    ‚Ñ¶t ,   and nally construct

approximations of optimal policy functions at time             t+1    around the time-t         +1   state

including   ‚Ñ¶t .   To begin, we illustrate our approach in a simple setting. We next extend

things to the more general setting of section 2. Detailed derivations, proofs, and other

details are relegated to the online appendix where we also show how our method can

be used to solve for a competitive equilibrium with xed government policies and

we use that economy to test the accuracy of our approximations by comparing our

solution to one obtained with standard numerical methods.



3.1 Approximations in the simple economy
We focus here on a special case designed to show the main steps and insights trans-

parently. We assume that all shocks are i.i.d. and that there is a single non-trivial

aggregate shock       E   and a single non-trivial idiosyncratic shock      Œµ   (say,   EŒò,t and ŒµŒ∏,i,t ).
Furthermore, we assume that agents have identical equity holdings                     si = 1, in which
case one can show that   Œõt = 0 for all t. These assumptions make ‚Ñ¶ the only aggregate
state variable for the t ‚â• 1 continuation Ramsey plan; ‚Ñ¶ becomes a distribution over

the two-dimensional space of z = (m, ¬µ). This is the minimal structure needed to

illustrate our method.
                             9

   9 The distribution of states   ‚Ñ¶ is dened over a two-dimensional space because the Ramsey planner
needs to keep track of two variables for each agent: a variable capturing agent's current assets and
a variable capturing past implicit promises of the planner which comes from the need to search for
optimal policies. In the recursive formulation of competitive equilibrium with xed policies,        ‚Ñ¶   is a
distribution over a one dimensional space of agents' Pareto-Negishi weights (or, equivalently, their




                                                    14
     We use tildes to denote policy functions in the                                 t‚â•1       continuation Ramsey plan.

The aggregate policy functions consist of all upper-case choice variables in problem

(19) as well as Lagrange multipliers on aggregate resource constraints (5)-(7).                                                      We

denote the vector of these functions by                               XÃÉ .   Individual policy functions consist of

all lower-case choice variables in problem (19) as well as Lagrange multipliers on

individual constraints (13), (17), (18); we denote the vector of these variables by                                              xÃÉ.
Policy functions for individual states                      zÃÉ   are included in the vector                  xÃÉ   and we    dene p

to be the selection matrix that returns                          zÃÉ   from   xÃÉ,   i.e.,   zÃÉ = pxÃÉ.
     Consider the full set of rst-order optimality conditions to problem (19). These

conditions can be split into two groups.                              The rst group consists of the optimality

conditions for individual policy functions. They show the relationship between current

period individual and aggregate policy functions                               xÃÉ, XÃÉ ,     current period realizations of

shocks
  h     Œµ, E, and expectations of currenti and next period policy functions E [xÃÉ|z, ‚Ñ¶],
E xÃÉ(¬∑, ¬∑, zÃÉ(z, ‚Ñ¶, Œµ, E), ‚Ñ¶ÃÉ(‚Ñ¶, E))|Œµ, E, z, ‚Ñ¶ . To keep the notation short, we denote the
two expectations terms by E‚àí xÃÉ and E+ xÃÉ respectively.
                                                               10 These conditions can be

written as
                                                                                     
                                         F E‚àí xÃÉ, xÃÉ, E+ xÃÉ, XÃÉ, Œµ, E, z = 0                                                     (20)


for some mapping            F.         The remaining optimality conditions are various aggregate

feasibility constraints and rst-order conditions with respect to                                            XÃÉ    that show the

relationship between aggregate policy functions and integrals of individual policy

functions. They can be written as

                                                      Z                      
                                                  R        xÃÉd‚Ñ¶, XÃÉ, E             =0                                            (21)



for some mapping            R.       The law of motion for the distribution                        ‚Ñ¶   is

                                            Z
                   ‚Ñ¶
                   e (E, ‚Ñ¶) (z) =                 Œπ (zÃÉ (Œµ, E, y, ‚Ñ¶) ‚â§ z) d Pr (Œµ) d‚Ñ¶ (y)                     ‚àÄz,                (22)



where     Œπ (zÃÉ ‚â§ z)   is   1    if all elements of              zÃÉ    are less than all elements of                   z,   and zero

otherwise. Equations (20)-(22) jointly determine the Ramsey allocation.

asset holdings).
  10 Strictly speaking, if      xÃÉ   consists of all lower-case choice variables and multipliers in problem (19),
then the relevant object is           E‚àí f (xÃÉ)   and   E+ g(xÃÉ)      for some transformations         f    and   g.   Our exposition
is without loss of generality once we expand the denition of                          xÃÉ   to also include variables       f (xÃÉ)   and
g (xÃÉ).



                                                                      15
   To approximate policy functions, we consider a family of economies parameter-

ized by a positive scalar          œÉ               Œµ, E . We construct rst-, second-,
                                       that scales all shocks

and higher-order approximations with respect to œÉ evaluated at œÉ = 0. Since, the

parameter œÉ aects policy functions directly in addition to scaled shocks (œÉŒµ, œÉE), we

record it as an extra argument. The rst-order expansion of XÃÉ reads

                                                                     
         XÃÉ(œÉE, ‚Ñ¶; œÉ) = XÃÉ(0, ‚Ñ¶; 0) + œÉ XÃÉE (0, ‚Ñ¶; 0)E + XÃÉœÉ (0, ‚Ñ¶; 0) + O(œÉ 2 )

                      ‚â° XÃÑ + œÉ XÃÑE E + XÃÑœÉ + O(œÉ 2 ),
                                           
                                                                                                     (23)



where   XÃÉE   and   XÃÉœÉ   are derivatives with respect to the rst and third arguments, and

bars indicate that functions are evaluated at                (0, ‚Ñ¶; 0).   The same convention applies

to the law of motion        ‚Ñ¶
                            e (œÉE, ‚Ñ¶; œÉ),      e.g.   ‚Ñ¶ÃÑ = ‚Ñ¶
                                                           e (0, ‚Ñ¶; 0).   Individual policy functions   xÃÉ
are expanded analogously as



          xÃÉ(œÉŒµ, œÉE, z, ‚Ñ¶; œÉ) = xÃÑ(z) + œÉ (xÃÑŒµ (z)Œµ + xÃÑE (z)E + xÃÑœÉ (z)) + O(œÉ 2 ).                 (24)



We describe next how to obtain the coecients that appear in these expansions by

using the implicit function theorem.



3.1.1 Points of expansion and zeroth-order terms
Our point of expansion         œÉ=0        is a deterministic economy. It is easy to see that the

law of motion for distribution            ‚Ñ¶t   is particularly simple in this case: if the economy

starts with any given       ‚Ñ¶0 ,   it remains with that distribution forever. Formally,


Lemma 1. For any ‚Ñ¶, policy functions satisfy zÃÑ(z) = z for any z and therefore
‚Ñ¶ÃÑ(‚Ñ¶) = ‚Ñ¶.

   The fact that the distribution remains stationary at                   œÉ=0   simplies our analysis.

Although at rst sight this result appears to be sensitive to the simplifying assump-

tions made in this section, we show later that by a careful choice of the individual

state variables one can obtain an analogue of lemma 1 even if the                      œÉ = 0   economy

features non-trivial deterministic dynamics.

   Lemma 1 implies that the expectation of next period's functions is simply equal

to their current period value at the point of expansion. Therefore, we can nd                  XÃÑ   and




                                                        16
xÃÑ(z)   as a solution to a non-linear system of equations

                                                               Z                    
                                              
         F xÃÑ(z), xÃÑ(z), xÃÑ(z), XÃÑ, 0, 0, z = 0,           R        xÃÑ(z)d‚Ñ¶(z), XÃÑ, 0 = 0.

This system can be solved eciently using standard root nding algorithms.

    Using the zeroth-order terms       XÃÑxÃÑ(z), we construct several objects that will be
                                             and

used to nd higher-order terms. Let Rx and RX be the derivatives of the R mapping

with respect to its rst two arguments, and let RE be the derivative with respect to the

scaled shock œÉE , all evaluated œÉ = 0. Similarly, let subscripts x‚àí, x, x+, X , Œµ, E and

z denote the analogous derivatives of F with respect to each of its arguments. From
                                                                              ‚àí1
the implicit function theorem we have xÃÑz (z) = [Fx‚àí (z) + Fx (z) + Fx+ (z)]     Fz (z).

3.1.2 First-order terms
That aggregate shocks in period          t   aect the distributional state      ‚Ñ¶   in period   t+1
makes calculating mathematical expectations of next period variables in equation

(20) hard. A principal contribution of our approach is to simplify calculation of these

expectations. The rst step towards this goal is to use lemma 1 to show that

  h                                             i                                       
 E xÃÉ(¬∑, ¬∑, zÃÉ(z, ‚Ñ¶, Œµ, E), ‚Ñ¶ÃÉ(‚Ñ¶, E))|Œµ, E, z, ‚Ñ¶ =xÃÑ(z) + xÃÑz (z)pxÃÑE (z) + ‚àÇ xÃÑ(z) ¬∑ ‚Ñ¶ÃÑE œÉE

                                                        + [xÃÑz (z)pxÃÑŒµ (z)] œÉŒµ + xÃÑœÉ (z)œÉ + O(œÉ 2 ),
                                  E [xÃÉ(¬∑, ¬∑, z, ‚Ñ¶)] =xÃÑ(z) + xÃÑœÉ (z)œÉ + O(œÉ 2 ),

where   ‚àÇ xÃÑ is the Frechet derivative of xÃÑ with respect to the distribution ‚Ñ¶.11 The
term ‚àÇ xÃÑ(z) ¬∑ ‚Ñ¶ÃÑE tells how current period's shock E inuences the expectation of next

period's policy function through its eect on next period's distribution ‚Ñ¶. Formally,

‚Ñ¶ÃÑE is the derivative of the law of motion (22) with respect to œÉE evaluated at œÉ = 0
and ‚àÇ xÃÑ(z) ¬∑ ‚Ñ¶ÃÑE is the Frechet derivative ‚àÇ xÃÑ(z) evaluated at the point ‚Ñ¶ÃÑE .

    The derivative ‚àÇ xÃÑ(¬∑) is high dimensional. Calculating it explicitly would be infea-

sible when the state space is large. Luckily, we need to know the derivative only at

  11 A Frechet derivative‚àÇ xÃÑ(z) is a linear operator from the space of distributions ‚Ñ¶ to R with a
                       kxÃÑ(z,‚Ñ¶+‚àÜ)‚àíxÃÑ(z,‚Ñ¶)‚àí‚àÇ xÃÑ(z)¬∑‚àÜk
property that limk‚àÜk‚Üí0                               = 0. It can be found by xing a feasible direction
                                    k‚àÜk
‚àÜ and calculating a directional (Gateaux) derivative since ‚àÇ xÃÑ(z) ¬∑ ‚àÜ = limŒ±‚Üí0 xÃÑ(z,‚Ñ¶+Œ±‚àÜ)‚àíxÃÑ(z,‚Ñ¶)
                                                                                             Œ±         .
See Chapter 7 of Luenberger (1997). Throughout, we assume that ‚àÜ vanishes on the boundaries of
its domain,   R+ √ó R.



                                                   17
the point     ‚Ñ¶ÃÑE . The next theorem shows that there exists                a simple linear relationship

between      ‚àÇ xÃÑ ¬∑ ‚Ñ¶ÃÑE and xÃÑE that can be solved explicitly.

Theorem 1. (Factorization) From the zeroth-order expansion one can construct
matrices A(z) and C(z) such that

                                             ‚àÇ xÃÑ(z) = C(z)‚àÇ XÃÑ,                                        (25a)
                                                           Z
                      ‚àÇ xÃÑ(z) ¬∑ ‚Ñ¶ÃÑE = C(z)‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑE = C(z) A(y)xÃÑE (y)d‚Ñ¶ (y) .                         (25b)
                                          | {z }
                                               XÃÑE0


Proof.   Evaluate the Frechet derivatives of (20) and (21) at an arbitrary point                       ‚àÜ    and

use the fact that       ‚àÇ ‚Ñ¶ÃÑ = 1    from lemma 1 to show that



                  (Fx‚àí (z) + Fx (z) + Fx+ (z)) ‚àÇ xÃÑ(z) ¬∑ ‚àÜ + FX (z)‚àÇ XÃÑ ¬∑ ‚àÜ = 0,                        (26a)
                                      Z                
                                 Rx ‚àÇ    xÃÑ (y) d‚Ñ¶ (y) ¬∑ ‚àÜ + RX ‚àÇ XÃÑ ¬∑ ‚àÜ = 0.                           (26b)



The rst equation yields (25a) with            C(z) = ‚àí (Fx‚àí (z) + Fx (z) + Fx+ (z))‚àí1 FX (z).
   By calculating directional            derivatives in direction ‚àÜ we can show that

                 Z                     Z                       Z
             ‚àÇ        xÃÑ (y) d‚Ñ¶ (y) ¬∑ ‚àÜ = (‚àÇ xÃÑ (y) ¬∑ ‚àÜ) d‚Ñ¶ (y) + xÃÑ (y) d‚àÜ (y) .                           (27)



We want to evaluate the integral on the right side at                   ‚àÜ = ‚Ñ¶ÃÑE .   Dierentiating (22) at

any   z = (m, ¬µ)       and applying lemma 1, we show that

                           Z                                        Z
      ‚Ñ¶ÃÑE (m, ¬µ) = ‚àí                mÃÑE (m, y2 ) œâ (m, y2 ) dy2 ‚àí           ¬µÃÑE (y1 , ¬µ) œâ (y1 , ¬µ) dy1 ,
                            y2 ‚â§¬µ                                   y1 ‚â§m


where    œâ   is the density of      ‚Ñ¶.   The density of    ‚Ñ¶ÃÑE (m, ¬µ)    is then


                                   d                          d
                 œâÃÑE (m, ¬µ) = ‚àí      [mÃÑE (m, ¬µ) œâ (m, ¬µ)] ‚àí    [¬µÃÑE (m, ¬µ) œâ (m, ¬µ)] .
                                  dm                         d¬µ




                                                      18
Substitute this equation and (25a) into (27) to get

     Z                         Z                         Z
                                                                  d
 ‚àÇ          xÃÑ (y) d‚Ñ¶ (y) ¬∑ ‚Ñ¶ÃÑE = C(y)‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑE d‚Ñ¶ (y) ‚àí xÃÑ (y)     [mÃÑE (y) œâ (y)] dy
                                                                 dm
                                   Z
                                           d
                                 ‚àí xÃÑ (y)     [¬µÃÑE (y) œâ (y)] dy
                                          d¬µ
                                 Z                         Z
                                = C(y)‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑE d‚Ñ¶ (y) + xÃÑz (y) pxÃÑE (y) d‚Ñ¶ (y) ,

where the second equality is obtained using integration by parts.                        Substitute this

expression into (26b) and solve for         ‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑE    to obtain

                                                    Z
                            XÃÑE0   ‚â° ‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑE =        A(y)xÃÑE (y)d‚Ñ¶ (y) ,                        (28)


                        R                        ‚àí1
where     A(z) = ‚àí Rx       C(y)d‚Ñ¶ (y) + RX              Rx xÃÑz (z)p.   Together with (25a) this proves

(25b).


     The factorization theorem makes our approach computationally tractable when

state space   ‚Ñ¶ is large. To see its signicance, suppose that we approximate ‚Ñ¶ on a
grid with K points. In that case, the Frechet derivative of individual policy func-
                         2
tions ‚àÇ xÃÑ(¬∑) contains K unknown elements. Since the number of the unknowns grows

exponentially with the number K of grid points, calculating this derivative directly

would be infeasible for large K . Theorem 1 circumvents this problem by providing an

explicit formula for the value of the derivative ‚àÇ xÃÑ(¬∑) at the point ‚Ñ¶ÃÑE as a linear func-

tion of (yet unknown) xÃÑE (z) weighted with coecients given by matrices A(z), C(z).

Matrices A(z), C(z) can be calculated quickly from the zeroth-order terms since the

only non-linear operation required is inversion of matrices of dimension no greater

than     max {dim x, dim X}.       Because   A(z), C(z)      can be calculated for dierent values

of   z   independently, the algorithm is easy to parallelize, a good thing when               K   is very

large.

     An economic intuition underlies derivations in the proof of theorem 1. In com-

petitive equilibrium agents care about the distribution                 ‚Ñ¶   only to the extent it aects

aggregate prices and income. Thus, the eect from any perturbation of distribution

‚Ñ¶    on individual variables,   ‚àÇ xÃÑ, can   be factorized into the eect of that perturbation

on aggregate variables,      ‚àÇ XÃÑ , and a    known loading matrix            C   that captures how indi-

vidual variables respond to changes in the aggregates. Equation (25a) captures this




                                                    19
relationship. Feasibility and market clearing constraints impose a tight relationship

between individual policy function responses to aggregate shocks in the current pe-

riod,   xÃÑE (z),    and expected future changes in the aggregates,                       XÃÑE0 .    Conceptually, this

relationship is the a xed point problem and we derive an explicit solution in equation

(28). Together with (25a), this allows us to nd                   ‚àÇ xÃÑ¬∑ ‚Ñ¶ÃÑE   in terms of         xÃÑE   without having

to compute         ‚àÇ xÃÑ(¬∑).
     We can now take the rst-order expansion of (20) and (21), apply the factorization

theorem, and use the method of undetermined coecients to nd                                     XÃÑE , XÃÑœÉ , xÃÑE , xÃÑŒµ , xÃÑœÉ .
We illustrate how this is done for               XÃÑE , xÃÑE .   Consider the rst-order expansion of the

left hand side of equations (20) and (21). Because this expansion should be equal to

0   for all values of         E,   the matrices of coecients that multiply                  E     should equal         0   as

well. Solving for these matrices explicitly, we obtain a system of equations



    (Fx (z) + Fx+ (z)xÃÑz (z)p) xÃÑE (z) + Fx+ (z)C(z)XÃÑE0 + FX (z)XÃÑ E + FE (z) = 0,                                    (29a)
      Z
    Rx xÃÑE (y)d‚Ñ¶ (y) + RX XÃÑ E + RE = 0.                                                                              (29b)



This is a linear system with unknowns                 XÃÑE , xÃÑE   after we substitute the denition of                   XÃÑE0
from (28). Solving the discretized version directly would require inverting a square

matrix of dimension                K dim x,   which is impractical when the dimension of the grid

(K ) is large. A more computationally ecient approach is to split this system into

K   independent systems of dimensions                  dim x      that can be solved in parallel. To this

end, use equation (29a) to calculate matrices                     D0 (z)   and   D1 (z)      that dene the linear

relationship
                                                                   h                iT
                                   xÃÑE (z) = D0 (z) + D1 (z) ¬∑         XÃÑ E XÃÑE0         .

Then use this relationship to substitute into equations (29b) and (28) to nd                                           XÃÑ E .
Values of    xÃÑE (z)    can be found either by substituting back into the previous equation

or from (25a).

     The remaining unknown rst-order coecients                       XÃÑœÉ , xÃÑŒµ , xÃÑœÉ   can be found using sim-

ilar steps. The steps for computing them are much simpler since they do not depend

on the Frechet derivative             ‚àÇ xÃÑ.




                                                          20
3.1.3 Second- and higher-order expansions
Our approach extends to second- and higher-order expansions while preserving the

computationally convenient linear structure. The key insight is that the factorization

theorem generalizes to higher order expansions. The analogue of equation (25a) holds

for any order of perturbations of          ‚Ñ¶.    This allows us to solve for higher order analogues

of   ‚àÇ xÃÑ ¬∑ ‚Ñ¶ÃÑE   explicitly as weighted sums of higher-order coecients               xÃÑEE , xÃÑEœÉ , xÃÑœÉœÉ . . .,
with weights known from lower-order expansions.                        We then can form higher order

analogues of the system of equations (29). As before, the mathematical structure of

these equations allows us to split one large system of equations into a large number of

low dimensional linear problems that can be solved fast and simultaneously. Formal

proofs and constructions are notation-intensive but the steps mirror those in section

3.1.2 and we conne them to the online appendix.



3.2 Approximations in the general case
We now turn to the economy described in section 2. For concreteness we focus on the

case when         ln Œòt follows an AR(1) process (9a).           This economy has two dierences from

the section 3.1 simpler economy. First, since shocks are persistent, policies also depend

on previous period values            Œò = (Œò, Œ¶)      and    Œ∏.    Second, the Philips curve constraint

(15) generally binds and its Lagrange multiplier                Œõ becomes a state variable. Thus, in
the general economy           z = (m, ¬µ, s, Œ∏)     is the   individual state, ‚Ñ¶ is a distribution over

this four-dimensional state space, and the aggregate and individual policy functions

are mappings           XÃÉ (E, ‚Ñ¶, Œò, Œõ)   and   xÃÉ (E, Œµ, z, ‚Ñ¶, Œò, Œõ)   respectively.

      To make progress, we assume that persistence of idiosyncratic shocks                    œÅŒ∏   is close to

1 so that we can represent it as           œÅŒ∏ = 1 ‚àí œÉœÅ      for some    œÅ ‚â• 0.   We follow the approach

of the previous section by considering a sequence of economies with scaled shocks                          œÉE
and    œÉŒµ   and persistence        1 ‚àí œÉœÅ. We take their rst- and second-order expansion with
respect to        œÉ   evaluated   at œÉ = 0 around any given distribution ‚Ñ¶. Let XÃÑ (Œò, Œõ) and

xÃÑ (z, Œò, Œõ)      be their zeroth-order values.

      Our general economy can have non-trivial dynamics even when                      œÉ = 0.   This would

present a diculty if the complicated part of the state space  the distribution                          ‚Ñ¶   

also changed over time. A judicious choice of state variables allows us to avoid this

complication.




                                                       21
Lemma 2. For any ‚Ñ¶, policy functions satisfy zÃÑ (z, Œò, Œõ) = z for any (z, Œò, Œõ) and
therefore ‚Ñ¶ÃÑ (Œò, Œõ) = ‚Ñ¶ for any Œò, Œõ.

     The intuition is as follows.       There are multiple mathematically equivalent ways

to choose individual state variables.         We chose them to be Pareto-Negishi weights

m    and multipliers on implementability constraints       ¬µ.   In the deterministic economy

(or, more generally, in a complete market economy as in Lucas and Stokey (1983)

or Werning (2007)) these weights are constant over time, even when other choices of

state variables, such as agents' debt levels, would not be.

     Lemma 2 paves a way for the natural extension of our algorithm from section

3.1.   Start with any      (Œò0 , Œõ0 )   and compute the deterministic transition dynamics

as {Œòt , Œõt }t   converge to the steady state.       The steady state value of    Œò    is simply
            
ŒòÃÑ = ŒòÃÑ, Œ¶ÃÑ ,    while the steady state value ofŒõ, that we denote by ŒõÃÑ, is pinned down
                                                  
by a single non-linear equation ŒõÃÉ 0, ‚Ñ¶, ŒòÃÑ, ŒõÃÑ; 0 = ŒõÃÑ. Theorem 1 and its higher-order

generalizations continue to hold along the transition path of {Œòt , Œõt }t , allowing one to

solve for the coecients in expansions of policy functions using backward induction,

as in Anderson et al. (2012).           This procedure can be further simplied by simply

expanding    xÃÉ (E, Œµ, z, ‚Ñ¶, Œò, Œõ)    XÃÉ (E, ‚Ñ¶, Œò, Œõ) around Œò = ŒòÃÑ and Œõ = ŒõÃÑ rather
                                     and

than solving for the full transition dynamics {Œòt , Œõt }t . The online appendix describes

how implement both approaches.




4 Calibration and computations
We choose three sets of parameters: (i) parameters governing preferences, technol-

ogy and aggregate shocks; (ii) initial conditions; and (iii) stochastic processes for

idiosyncratic shocks.



Preferences, technology, aggregate shocks
Our settings of aggregate parameters align with standard representative agent cal-

ibrations such as Schmitt-Grohe and Uribe (2004) and Siu (2004).                 We set utility

function parameters at       ŒΩ = 1 , Œ≥ = 2,   and the discount factor   Œ≤   at 0.96. We assume

that rms operate a constant returns to scale technology and set Œ± = 1. To a rst
                                          ‚àí1
approximation, average markups are Œ¶ÃÑ ‚àí 1      and the slope of the Phillips curve is
       
 Œ¶ÃÑ ‚àí 1 /œà .     We set   Œ¶ÃÑ = 6   to attain average markups of   20%   and   œà = 20   to match




                                                22
the slope of the Phillips curve as estimated by Sbordone (2002).
                                                                            12 We set government

non-transfer expenditures      GÃÑ at 0.09 in order to match the average federal government
current expenditures net of transfer payments to annual GDP from the NIPA for the

period 1947-2016.

   The stochastic process for the markup shocks is calibrated to be consistent with

that estimated in Smets and Wouters (2007) with the AR coecient of                   0.65   and the

volatility of the innovation to     ln Œ¶   such that a one standard deviation negative shock

EŒ¶ raises rms' optimal markups by about 0.5 percentage points. We set the standard
deviation of EŒò at 3% to approximate the process for output per worker in the U.S.

In the AR(1) specication of TFP shocks we set œÅŒò = 0.8 and ŒòÃÑ = 1.



Initial conditions
We use the 2007 wave of the Survey of Consumer Finances (SCF) to calibrate the

initial distribution of wages, debt, and equity holdings.              We restrict our sample to

married households who work at least 100 hours.                   To measure bond holdings, we

sum direct and indirect holdings of government bonds through mutual funds (taxable

and nontaxable), saving bonds, liquid assets (net of unsecured credit), money market

accounts, and components of retirement accounts that are invested in government

bonds. To measure equity holdings we sum direct holdings of equities and indirect

holdings through mutual funds and retirement accounts.
                                                                     13

   To t initial states     {Œ∏i,‚àí1 , bi,‚àí1 , si }   to data, we sample directly from the SCF

log wages, debt and shares of equity using 2007 wave sampling weights.                   The SCF

provides population weights for each observation.                Given these weights, we set the

initial condition by drawing with replacement a random sample of 100000 agents from

a discrete distribution. In our SCF sample,              30% of households hold zero equities;   the

distribution of equities among the remaining households is right skewed with the top

10% of agents holding about 60% of total equities. Debt holdings, equity holdings,

and wages are positively correlated. Table I reports summary statistics of the data

and our t.
  12 Using quarterly data, Sbordone (2002) estimates the slope of the U.S. Phillips curve to be about
0.06. Since our calibration uses annual frequency, we multiply her number by 4.
  13 We drop observations where equity or bond holdings are more than 100 times average yearly
wage. These turned out to be about 0.5% of the total sample.




                                                    23
                        TABLE I: FIT OF THE INITIAL DISTRIBUTION



                                                                                 Data          Model
  fraction of pop. with zero equities                                            30%                30%
  std. share of equities                                                         2.62               2.61
  std. bond                                                                      4.90               5.23
  std. ln wages                                                                  0.81               0.82
  corr(share of equities,ln wages)                                               0.40               0.39
  corr(share of equities,bond holdings)                                          0.59               0.55
  corr(bond,ln wages)                                                            0.32               0.30


Notes: The moments in the data column corresponds to SCF 2007 wave with sample restrictions

explained in the text and after scaling wages, equity holdings, and debt holdings by the average

yearly wage in our sample. The share of equities refers to the ratio of individual equity holdings to

the total in our sample such that the weighted sum of shares equals one.




Stochastic process for idiosyncratic shocks
We set the stochastic process for idiosyncratic shocks to match some facts about

labor earnings reported by Storesletten et al. (2004) and Guvenen et al. (2014). In

the model, labor earnings depend both on the stochastic process for skill                    i,t   and on

monetary-scal policy. We calibrate them to t a competitive equilibrium in which

interest rates and tax rates are set to match stylized features of U.S. policies, namely,


                                            1
                                Q‚àí1
                                 t ‚àí1 =       + 1.5Œ†t ,     Œ•t = 0.25.                                 (30)
                                            Œ≤

This Taylor rule parameterization for nominal rates is common in the literature, while

the calibrated tax rate matches estimates of the federal average marginal income tax

rate reported by Barro and Redlick (2011), who also show that it is largely acyclical

at business cycle frequencies.

    To calibrate parameters governing stochastic processes (10) and (11), we simulate

log earnings for 100000 agents using a competitive equilibrium with the initial con-

dition and government policies as described above. Shocks               Œµ,i,t , ŒµŒ∏,i,t   are Gaussian.

Storesletten et al. (2004) estimates a transitory/persistent component model of log

earnings using the PSID. We targeted their estimates by setting the parameter                         œÅŒ∏   to

match the autocorrelation of the persistent component of log earnings, parameters

std(Œµ,i,t ), std(ŒµŒ∏,i,t )   to match the standard deviation of the transitory and persistent




                                                  24
         TABLE II: PARAMETERS FOR IDIOSYNCRATIC SHOCKS PROCESSES



    Parameters                Values            Targeted moment                          Values    Source


    s.d of   Œµ                   0.17          s.d. of transitory                       0.25      Storesletten
                                                component in log earnings                          et al. (2004)
    s.d. of    ŒµŒ∏                 0.12          s.d. of persistent                       0.12
                                                component in log earnings
    œÅŒ∏                            0.99          autocorr of persistent                   0.99
                                                component in log earnings
    f2 , f1 , f0         0.28,‚àí0.52,            relative (to median)                     see       Guvenen
                                                                 th   th
                             0.00               earnings losses 5 , 50         &         text      et al. (2014),
                                                95th percentiles                                   see gure I

Notes: The parameters in this table characterize the stochastic processes in equations (10) and (11).




components of log earnings.
                                               14

    Guvenen et al. (2014) report earnings losses in the four recessions between 1978-

2010 by percentiles of 5 year averages of pre-recession earnings.                                 These provide us

with moments that we use to construct the loading function                                    f (Œ∏). We assume a
                                                           2
quadratic form           f (Œ∏) = f0 + f1 Œ∏ + f2 Œ∏              and calibrate   {f0 , f1 , f2 } as follows. We rst
normalize Guvenen et al. (2014) reported earning losses for each percentile by the

median earnings losses and average across all four recessions to obtain a prole of

relative (to median) earnings losses.                          This is the dashed line in gure I.          We next

simulate the competitive equilibrium for 50 periods with a recession that is ignited

by one standard deviation negative TFP shock. Following the empirical procedure

in Guvenen et al. (2014), we rank workers by percentiles of their average log labor

earnings   5   years prior to the shock and compute the percent earnings loss for each

percentile relative to the median. The parameters                         f0 , f1 , f2   are set to match earnings
                    th         th          th
losses of the      5     ,   50     and   95        percentiles. Our model's counterpart to Guvenen et al.

(2014) is the solid line in gure I. Parameters governing the process for idiosyncratic

shocks are summarized in table II.
  14 In the model, we compute these cross-sectional moments by simulating a panel of log earnings
from the competitive equilibrium with 100000 agents after turning o aggregate shocks for a sample
of length 50 periods.




                                                                 25
                   Earnings losses (relative to median) in a recession

2.5
                                                                               data
                                                                              model


  2


1.5


  1


0.5
      0    0.1    0.2     0.3     0.4    0.5        0.6   0.7    0.8    0.9      1
                                        percentiles


Figure I: Relative (to median) earnings losses by percentiles of 5 year average pre-recession
log earnings. The data line is constructed using moments from Guvenen et al. (2014) who
report the prole of earnings losses in the last 4 recessions (1978-2010). In the model line,
we use simulated earnings before and after a one standard deviation TFP shock.




                                               26
Computations
We use our second-order expansion formulas to approximate Ramsey policies. To com-

pute the optimal monetary policy, we set              Œ•ÃÑ to the optimal level in the non-stochastic
environment with the same the initial condition. At every history we discretize the

distribution across agents with           K = 2000     grid points that we choose each period us-

ing a k-means clustering algorithm. We apply our algorithm to approximate optimal

policies, use Monte Carlo simulation to draw idiosyncratic shocks and nally compute

the aggregate distribution next period for a given history of aggregate shocks. The al-

gorithm is then repeated with the new distribution. The details of how to implement

the simulation steps are in the online appendix.

    We focus on optimal policy responses to aggregate shocks                       EŒ¶,t , EŒò,t .   These re-

sponses depend on the underlying state. To compute them we draw 100 histories of

shocks   {EŒ¶,t , EŒò,t }25
                       t=0 . To calculate an impulse response, say, to productivity shock
EŒò,k , of size Œ¥ in period k , we create two replicas of these draws. In one replica we
replace EŒò,k from 0 and in the other with Œ¥ . We then integrate over all histories to ob-

tain expected paths conditional on EŒò,k = 0 and on EŒò,k = Œ¥ . Our impulse responses

are the dierences in the two paths. Since those paths are the same by construction

for all   t < k,   we draw all the graphs starting with            t = k.   For concreteness we report

all responses for     k = 5.15


5 Results
We study optimal monetary and monetary-scal responses to one standard deviation

negative shocks to      EŒ¶,t   and   EŒò,t .   These responses are primarily shaped by two goals.

The rst is price stability, which is also present in representative agent New Keynesian

models.       Price changes are costly and by pursuing stable prices the planner can

mitigate these costs.      The second is provision of insurance, a goal that arises from

heterogeneity and market incompleteness because aggregate shocks aect dierent

agents dierently.       If agents could trade a complete set of Arrow securities, they

would insure these shocks away and maintain constant consumption shares.                                Our

  15 As often occurs (for example, see Lucas and Stokey (1983), Schmitt-Grohe and Uribe (2004))
Ramsey policy at time    t=0     diers from continuation Ramsey policies for          t > 1, being functions
of dierent arguments. In our economy, by          t = 5,   transient eects of time   0 actions have mostly
dissipated.




                                                      27
assumptions rule out those trades. The planner uses monetary and scal policies to

make the distribution of gains and losses more equal.

   In what follows we compare optimal responses in our economy to those in a rep-

resentative agent version that shuts down all idiosyncratic shocks and heterogeneity

across agents. The RANK economy provides a useful benchmark because it isolates

the role of price stability concerns. We refer to our baseline setting with heteroge-

neous agents as HANK and the representative agent counterpart as RANK. When we

study Ramsey monetary policy, for each economy we x      Œ•ÃÑ   at the associated optimal

level in the non-stochastic environment. In the RANK economy it is         Œ•ÃÑ = ‚àí1/Œ¶ÃÑ.


5.1 Optimal Responses to Markup Shocks
We start by considering the optimal response to a negative innovation in     EŒ¶,t .   As this

shock increases the desired markup   1/(Œ¶t ‚àí 1),   we refer to it as a positive markup

shock.   Figure II shows (solid line) that the planner responds to a 0.5 percentage

points increase in markups by cutting the nominal interest rate by 0.3 percentage

points. This response boosts output, ination and real wages. The optimal policy

response to a markup shock diers signicantly from that in the representative agent

model (dashed line).

   To understand economic forces behind these results, consider implications of the

shock for price stability and insurance. A negative innovation to   EŒ¶,t   increases rms'

desired markups over marginal costs which,     ceteris paribus,   makes rms want to

increase nominal prices.   To reduce the cost of price changes the planner can aim

to lower marginal costs by increasing the nominal interest rate, thereby depressing

aggregate demand and real wages, which reduces marginal costs.         Dubbed leaning

against the wind by Gal√≠ (2015), this response is optimal in representative agent

New Keynesian economies. The interest rate increase that maintains stable prices is

modest (see the dashed line).

   Now turn to the insurance considerations. Higher markups increase dividends and

lower the real wage. This benets agents who own a lot of equities and hurts agents

who mainly rely on labor income. To provide insurance that osets the dierential

impact of the markup shock, the planner can aim to increase the real wage by cutting

the nominal interest rate and boosting aggregate demand.

   Thus, the Ramsey planner's concerns about price stability and insurance have




                                         28
                    Nominal rate                        Ination                           Tax rate

                                                                              2
           0
                                         0.5
 %pts




                              RANK
                                           0                                  0
                              HANK
        ‚àí0.5                                                               ‚àí1
                0   2     4   6   8 10         0    2     4    6    8 10          0    2    4   6     8 10
                    Log output                     Pre-tax wage                       Markup shock


          0.5                              1
    pts




                                                                              0
    %




           0                               0
                                                                           ‚àí1
                0   2     4   6   8 10         0    2     4    6    8 10          0    2    4   6     8 10
                          years                           years                             years


                        Figure II: Optimal monetary response to a markup shock



opposite implications for an optimal monetary response. Figure II shows that quanti-

tatively the planner's intention to provide insurance swamps the intention to stabilize

prices. To understand why the insurance motive is so strong, think about how the

distribution of gains and losses from the shock depends on asset inequality. The in-

surance motive is least active when rm ownership is widely dispersed among agents

and most active when ownership is very skewed.                      Data portray the distribution of

stock market wealth as highly unequal, much more than the distribution of labor

earnings. That makes the insurance motive relatively strong.

    Figure III shows optimal monetary-scal responses to a markup shock. The plan-

ner temporarily increases tax rates and lowers nominal interest rates. This combina-

tion of policies increases the pre-tax wage             W     and ination.

    Labor taxes allow the planner to completely oset the inationary consequences

of the markup shock. If taxes are decreased to make the path of                       1‚àíœÑ   mirror the path

of the shock, then the after-tax wage              (1 ‚àí œÑ ) W      and ination are both unchanged.

Since this tax response osets the eect of the shock on ination, the planner need not

change the nominal interest rate. In representative agent New Keynesian economies

(dashed line) this policy achieves the rst best.

    In our economy, this scal response to an aggregate shock damages insurance pro-



                                                     29
                     Nominal rate                     Ination                        Tax rate

                                                                          2
            0
                                        0.5
   pts
   %



                             RANK
                                         0                                0
                             HANK
         ‚àí0.5                                                            ‚àí1
                 0   2   4   6   8 10         0   2     4   6    8 10         0   2    4    6    8 10
                     Log output                   Pre-tax wage                    Markup shock

                                         3
           0.5
                                         2
     pts




                                         1                                0
     %




            0                            0
                                                                         ‚àí1
                 0   2   4   6   8 10         0   2     4   6    8 10         0   2    4    6    8 10
                         years                          years                          years


                 Figure III: Optimal monetary-scal response to a markup shock



vision. When tax rates are lowered, the planner has to decrease transfers in order to

satisfy the government's budget constraint. That makes average taxes more regres-

sive and amplies the adverse eect of the markup shock on low-wage households.

To provide insurance, the planner wants to make the tax system more progressive by

increasing transfers funded by higher marginal tax rates.                 It is optimal to combine

this scal policy with loose monetary policy because that osets the negative eect of

tax rate increases on output. Quantitatively, the insurance considerations dominate

the optimal scal response.

   In contrast to tax-smoothing prescriptions of Barro (1979) and Aiyagari et al.

(2002), the optimal tax rate increase is short-lived.             This is because transitory tax

changes are less distortionary than permanent changes when price are sticky.                            A

permanent increase in tax rates has no eect on real pre-tax wages                    W    as in the long

run rms set their prices as a constant markup over wages. As a result, a permanent

tax rate change increases the labor distortion              (1 ‚àí œÑ ) W   one for one.       In contrast,

rms nd it suboptimal to adjust prices fully to a transient tax rate increase. Thus, a

transitory tax rate increase raises the pre-tax wage and has little (zero, in a continuous

time limit) eect on the labor distortion.




                                                   30
5.2 Optimal Responses to Productivity Shocks
Price stability and insurance provision also shape Ramsey responses to productivity

shocks. A well-known prescription for price stability is to move nominal interest rates

one for one with changes in the natural rate of interest  the real interest rate that

would prevail without nominal frictions. Consumers' Euler equations then ensure that

ination remains unchanged in response to the shock. The growth rate specication

for productivity shocks in (9b) keeps the natural rate constant providing us with a

clean way to isolate the insurance motive.

    Figure IV shows the optimal monetary response to a negative innovation in                EŒò,t .
This response is driven purely by insurance concerns: in the RANK economy where

these concerns are absent, the planner optimally keeps interest rates and ination

unchanged. Several economic forces explain why lower aggregate productivity gener-

ates insurance motives in our model. One is heterogeneity in bond holdings. Incomes

of agents who hold a lot of non-state-contingent bonds suer less from an adverse

productivity shock than incomes of agents who are in debt.               This eect is present

even if wages of all agents are the same.         Two features in the data that we target

amplify this dierential eect: (i) low wage workers typically have fewer assets, and

(ii) the direct exposures of labor earnings to aggregate productivity shocks are large

for low wage workers, captured by the shape of our loading function             f.
    To provide insurance, the planner wants to transfer resources from high income to

low income agents. Since debt is nominal, that can be done by lowering ex-post real

returns on debt after a negative       EŒò,t   shock. A lower return makes the distribution

of losses between savers and borrowers more equal. The planner lowers realized real

returns on the nominal asset by cutting nominal interest rates, thereby increasing

ination. The policy response is sizable but short lived.
                                                                 16

    Figure V shows an optimal monetary-scal response to an aggregate productivity

shock. When the planner has access to scal policy, increasing transfers funded by

higher labor tax rates provides insurance against the adverse productivity shock.

First, more progressive average taxes redistribute labor income towards low-wage,

low-asset agents.     This by itself would mandate a persistent increase in tax rates

  16 Recall that we follow the usual convention in the New Keynesian literature and assume that
debt matures in one period. With longer debt maturity, the decreases in nominal interest rates and
increases in ination are smaller but more persistent which allows the planner to lower the cost of
nominal price adjustments.




                                                31
                   Nominal rate                         Ination                       Tax rate

                                                                           2
           0
                                          0.5
 %pts




                            RANK                                           0
        ‚àí0.5                HANK           0                              ‚àí1
               0    2   4   6   8 10            0   2    4   6     8 10        0   2    4     6   8 10
                   Output growth                Ex-post real returns               TFP growth

           0                               0                               0
    pts
    %




          ‚àí2                          ‚àí0.5                                ‚àí2

               0    2   4   6   8 10            0   2    4   6     8 10        0   2    4     6   8 10
                        years                            years                          years


          Figure IV: Optimal monetary response to a productivity growth rate shock



because the increase in inequality is long lived.                But a second force works through

changes in the pre-tax wage.         With costly price adjustments, a temporary spike in

marginal taxes rates raises real wages. Together these two eects explain the responses

of optimal tax rates in gure V. Although nominal interest rates move little, that

behavior masks a substantial departure from natural interest rate targeting.                         The

response of optimal tax rates increases the natural rate in the rst period, putting

the nominal rate substantially below it. The dierence between nominal and natural

interest rates follows a path that is similar to that in gure IV. This explains the spike

in ination that provides insurance through lower realized returns on bond holdings.

    Now consider the alternative AR(1) specication of productivity shocks in equa-

tion (9a). A negative shock        EŒò,t   predicts a higher growth rate of         Œòt+k     in the future.

This raises the natural rate, so in order to attain price stability the planner would

want to raise the nominal interest rate as well. This is the main dierence from the

growth rate specication of productivity shocks. In particular, once we look at the

dierence between nominal and natural rates instead of the nominal interest rate it-

self, counterparts of gures IV and V are very similar in both cases. We report them

in the online appendix where we also explain how to extend the notion of the natural

rate to our HANK economy.



                                                    32
                     Nominal rate                      Ination                       Tax rate
          0.5                            0.5                              2
  pts




             0
  %




                              RANK                                        0
                              HANK         0
        ‚àí0.5                                                             ‚àí1
                 0    2   4   6   8 10         0   2    4   6     8 10        0   2    4   6     8 10
                     Output growth             Ex-post real returns               TFP growth


             0                                                            0
                                           0
    pts




          ‚àí2                                                             ‚àí2
    %




                                      ‚àí0.5
                 0    2   4   6   8 10     0       2    4   6     8 10        0   2    4   6     8 10
                          years                         years                          years


        Figure V: Optimal monetary-scal response to a productivity growth rate shock



5.3 Taylor Rules
We explore how well a Taylor rule approximates the Ramsey plan. To this end we

x tax rates as in sections 5.1 and 5.2 but assume that monetary policy follows the

interest rule specied in equation (30).

    Figure VI compares responses of interest rates and ination under the Ramsey

plan and the Taylor rule.           The left panel (black lines) in gure VI shows that the

responses implied by the Taylor rules are too small, too persistent, and, in the case of

markup shocks, are in the opposite direction of the optimal responses. We could have

anticipated that a Taylor rule does a poor job of approximating the Ramsey responses.

In sections 5.1 and 5.2, we emphasized that the main economic force driving optimal

policy is the need to provide insurance; Taylor rules are designed to achieve price

stability.       In the right panel (red lines) in gure VI we plot responses to markup

and TFP shocks in the representative agent economy and nd that qualitatively, the

interest rate and ination both behave similarly under Ramsey and Taylor policies.
                                                                                                    17

  17 In the RANK economy it easy to improve the t further by small changes in the coecients in
the Taylor rule. For example, if we set the coecient on ination to 5, the two responses lie almost
perfectly on top of each other. This is not surprising and previous studies, for instance Woodford
(2003) and Gal√≠ (2015), also nd that Taylor rules approximate the optimal Ramsey policies well in




                                                   33
                                                  HANK                                                                     RANK

                              Nominal rate                      Ination                 Nominal rate                      Ination
 Markup shocks




                          0                           0.5            Taylor                                                     Taylor
                                                                    Optimal                                                    Optimal
                 pts




                                                                                0.05                          0.05
                 %




                                                       0
                                                                                     0                            0
                       ‚àí0.5
                              0   2    4      6   8         0   2    4      6   8        0   2    4      6   8         0   2    4      6   8


                                                                                     1                            1
                          0
 TFP shock




                                                      0.5
                 pts




                                                                                     0                            0
                 %




                       ‚àí0.5                            0                            ‚àí1                           ‚àí1
                              0   2    4      6   8         0   2    4      6   8        0   2    4      6   8         0   2    4      6   8
                                      years                         years                        years                         years


Figure VI: Comparing optimal monetary responses to Taylor rule in HANK (black, left
panel) and RANK (red, right panel) models. The solid line is the optimal response and the
dashed line is the response in a competitive equilibrium with it                                      = iÃÑ + 1.5œÄt .   For TFP shocks
we use the growth rate specication (9b).



                 The diculty with a Taylor rule lies not only in its conventional parameterization

but in a restriction that it implicitly imposes on the persistence of interest rates and

ination. Under a Taylor rule, persistence of nominal interest rates is inherited from

the persistence of exogenous aggregate shocks. Thus, a long-lived markup shock im-

plies long-lived changes in nominal rates and ination. A motive to provide insurance

in the HANK economy often requires transient and short-lived changes in interest

rate and ination. These are dicult to implement with standard Taylor rules.




6 Extensions and robustness
We consider several extensions to the section 2 environment.

a class of representative agent settings.




                                                                         34
6.1 Heterogeneity in the marginal propensity to consume
Our baseline specication combines a New Keynesian framework with a standard

Bewley-Aiyagari model of idiosyncratic shocks and imperfect insurance. A well known

limitation of Bewley-Aiyagari models is that they fail to generate sucient hetero-

geneity in marginal propensities to consume (MPCs).
                                                                   18 That prediction is at odds

with the data. For example, Jappelli and Pistaferri (2014) document large dierences

in MPCs across agents and show that MPCs systematically co-vary with wealth.

Recent studies (Auclert (2017), Kaplan et al. (2018)) stress the role of MPC hetero-

geneity in transmitting changes in interest rates. We are interested in implications of

MPC heterogeneity for         optimal      monetary policy.

      We follow Jappelli and Pistaferri (2014) and augment our model with hand-to-

mouth agents. These agents can own equities and consume dividends (in addition

to labor income) but cannot trade nancial assets over time. Thus, we modify our

baseline set up to allow two dimensions of permanent heterogeneity, equity holding

si   and a new variable     hi ,   where   hi ‚àà {0, 1}   indicates whether or not individual    i   is a

hand-to-mouth type. We assume that the probability of being hand-to-mouth is



                             Pr(hi = 1|si ) = a0 + a1 √óPercentile (si ),

and re-calibrate our model by choosing parameters                  a0   and   a1   to match the MPC

gradient with respect to wealth reported in Jappelli and Pistaferri (2014) in addition

to our calibration targets in section 4. Table III shows Jappelli and Pistaferri (2014)

numbers and the goodness of t of our calibration.

      This approach is in line with Kaplan et al. (2018) who model MPC heterogeneity

using a Bewley-Aiyagari model with costly adjustment between liquid and illiquid

assets. Their baseline calibration makes MPC higher for agents with low liquid wealth,

and about two thirds of agents with zero liquid wealth have positive illiquid wealth.

Our specication captures both features, with high-s hand-to-mouth agents behaving

like wealthy hand-to-mouth agents in Kaplan et al. (2018).

      Frictions in trading nancial assets segment agents into those who are uncon-

strained and are on their Euler equation and those who are constrained and at strict

     18 In our baseline model agents trade subject to the natural borrowing limit. The same conclusion
also holds for economies when agents face ad-hoc borrowing limits, except for a small mass of agents
near that limit.    Krusell and Smith (1998) refer to this property in such models as approximate
aggregation.




                                                    35
                    TABLE III: MODEL FIT FOR MPC HETEROGENEITY



      Parameters         Values       Moment                                              Data      Model


      a0                  -0.35       MPC for 10 percentile of Cash on Hand                0.62      0.63


      a1                   0.75       MPC for 90 percentile of Cash on Hand                0.35      0.33

Notes: The data column is obtained from gure 2 of Jappelli and Pistaferri (2014) who report average MPC out
of transitory income shock by percentiles of cash on hand (CoH) where CoH is dened as the sum of household
disposable income and nancial wealth, net of consumer debt. In the model we compute CoH as the sum post - tax
wage earnings, holdings of debt and equities.


Euler inequalities. Ramsey plans are still determined by price stability and insurance

concerns but now they take the dierent policy responses of these two groups into

account. In a setting with trading frictions, the eectiveness of monetary policy de-

pends on the mechanism through which nominal rates provide insurance. To see this

we compare the responses to markup and TFP shocks.

    In the top row of gure VII we see that in response to a positive markup shock

the planner still decreases the nominal interest rate, but not by as much as in the

baseline model. Recall from section 5.1 that, by stimulating aggregate demand, cuts

in interest rates provide insurance after a markup shock. Changes in interest rates

directly aect only agents who are on their Euler equation, and so trading frictions

diminish the ability of monetary policy to inuence aggregate demand. In contrast,

the bottom row of gure VII shows that the response of interest rates to a TFP

shock is virtually unaected by trading frictions. In this case, the planner provides

insurance by lowering real returns on nominal debt. Asset prices are determined only

by a marginal investor. Thus, in spite of trading frictions, monetary policy behaves

similarly to the benchmark case.

    Figure VII also shows the importance of transfers in providing insurance when

agents face frictions in trading assets. In our baseline economy agents borrow subject

to natural debt limits, so Ricardian equivalence holds and the timing of transfers

is irrelevant. When some agents are constrained in their abilities to trade nancial

assets, transfers become an eective tool for aecting aggregate demand and real

wages. For example, in response to a markup shock the planner increases transfers

to stimulate aggregate demand. This leads to a spike in ination of about the same

magnitude as in the baseline economy despite a much smaller cut in nominal interest




                                                     36
                                   Nominal rate                            Ination                Transfers/Output

                           0
Markup shock


                                                        0.4
                                                                                          0.15
                        ‚àí0.1
                  pts

                                                        0.2                                0.1
                        ‚àí0.2
                 %


                                                         0                                0.05
                        ‚àí0.3                                                                 0
                                                    ‚àí0.2
                               0   2   4   6     8 10    0             2    4   6     8 10     0     2    4   6    8 10


                           0                            0.6                                  0
TFP shock


                  pts




                        ‚àí0.2                            0.4
                                                                                          ‚àí0.2
                 %




                        ‚àí0.4               HTM          0.2
                                       Benchmark
                                                         0                               ‚àí0.4
                               0   2   4   6     8 10         0        2    4   6     8 10    0      2    4   6    8 10
                                       years                                years                         years


                        Figure VII: Optimal monetary responses with hand-to-mouth agents.



rates. Transfers are cut in response to a TFP shock because lower tax revenues make

it harder for the government to nance its outstanding liabilities.



6.2 Alternative assumptions about welfare criterion and scal
    instruments
We consider other extensions of our baseline specication where we alter the welfare

criteria; turn o heterogeneous exposures of TFP shocks by setting                                   f = 0;   and turn

o nominal rigidities by setting                   œà = 0.          We summarize main insights from these

extensions here and more details are in the online appendix.

               In our baseline specication we assumed that the Ramsey planner is utilitarian

meaning that he puts equal Pareto weights on all agents.                                   This assumption is not

essential for our results. The focus of our analysis has been on the role of monetary

policy in providing insurance against aggregate shocks, and the need for this insurance

is driven by market incompleteness not Pareto weights. To conrm this insight we

tried a range of alternative Pareto weights, for example weights that rationalize the

observed average marginal tax rates or alternative weights that prefer more redistri-

bution. Dierent choices of Pareto weights have a big inuence on the                                    average   levels



                                                                  37
of optimal tax rates and transfers but have little eect on how tax rates, transfers,

and nominal interest rates respond to aggregate shocks.

      We explored how assumptions about the menu of available scal instruments af-

fect conclusions. Some of heterogeneous impacts of recessions in the data are driven

by unemployment. Targeted instruments such as unemployment insurance (UI) can

be more eective than nominal interest rates in helping agents to smooth their con-

sumption.    But even the best designed programs are likely to provide only partial

insurance, due, for example, to moral hazard.      Modeling these eects realistically

would take us too far from the focus of this paper.     One way to estimate a rough

upper bound on the eectiveness of UI programs is to assume that they fully elimi-

nate all heterogeneous wage impacts by setting    f = 0.   In this case, we nd that the

optimal response to a markup shock is essentially unaected and that the response

to a productivity shock is cut by about 50 percent. Unemployment insurance is not

eective at providing insurance against shocks that aect wage earners and nancial

asset holders dierently.

      We also study the sensitivity of our ndings to the size of nominal rigidities.

Monetary policy remains eective even if prices are completely exible because it still

can inuence the nominal price level and real returns on nominal debt.        When we

set   œà=0   we nd that ination responds by 0.5% to markup shocks and by 2.5% to

productivity shocks. These eects are larger than the baseline case where      œà = 20.
The insight that nominal rigidities lower the optimal response of ination is consistent

with RANK studies (Schmitt-Grohe and Uribe (2004)), but unlike those papers the

volatility of nominal interest rates and ination remains sizable under conventional

calibrations of nominal rigidities.




7 Concluding Remarks
James Tobin described macroeconomics as a eld that explains aggregate quantities

and prices while ignoring distribution eects. Tobin's characterization describes much

work about real business cycles, asset pricing, Ramsey tax and debt, and New Key-

nesian models. In each of these lines of research, an assumption of complete markets

and/or of a representative consumer allows the analyst to compute aggregate quan-

tities and prices without also determining distributions across agents.     This paper

departs from Tobin's aggregative economics by assuming heterogeneous agents and




                                          38
incomplete markets.

   Our paper makes two contributions. It develops a way to approximate optimal

plans in economies with heterogeneous agents. Our method can be more broadly ap-

plied to settings that feature incomplete markets, idiosyncratic and aggregate shocks.

Our quantitative application reevaluates lessons for monetary and scal policy drawn

from New Keynesian economies.      Relative to price stability motives that typically

drive policy prescriptions, heterogeneity adds a quantitatively important insurance

motive.   Our ndings complement a message in Kaplan and Violante (2018 forth-

coming) that monetary policy is inextricably connected with scal policy and about

distributional eects.




                                         39
References
Ahn, SeHyoun, Greg Kaplan, Benjamin Moll, Thomas Winberry, and
 Christian Wolf. 2017. When Inequality Matters for Macro and Macro Matters
  for Inequality. In   NBER Macroeconomics Annual 2017, volume 32.:     University of

  Chicago Press.


Aiyagari, S. Rao, Albert Marcet, Thomas J. Sargent, and Juha Seppala.
  2002.  Optimal Taxation without State-Contingent Debt.        Journal of Political
  Economy, 110(6):      12201254.


Algan, Yann, Olivier Allais, Wouter J. Den Haan, and Pontus Rendahl.
  2014. Chapter 6 - Solving and Simulating Models with Heterogeneous Agents and

  Aggregate Uncertainty. In    Handbook of Computational Economics Vol. 3.     eds. by

  Karl Schmedders, and Kenneth L. Judd, 3 of Handbook of Computational Eco-

  nomics: Elsevier, 277  324.


Anderson, Evan W, Lars Peter Hansen, and Thomas J Sargent. 2012. Small
  noise methods for risk-sensitive/robust economies.   Journal of Economic Dynamics
  and Control, 36(4):    468500.


Auclert, Adrien. 2017. Monetary Policy and the Redistribution Channel. Working
  Paper 23451, National Bureau of Economic Research.


Barro, Robert J.        1979.  On the Determination of the Public Debt.    Journal of
  Political Economy, 87(5):    940971.


Barro, Robert J., and Charles J. Redlick. 2011. Macroeconomic Eects From
  Government Purchases and Taxes.        Quarterly Journal of Economics,   126(1): 51

  102.


Bhandari, Anmol, David Evans, Mikhail Golosov, and Thomas Sargent.
  2017a. Fiscal Policy and Debt Management with Incomplete Markets.        Quarterly
  Journal of Economics, 132(2):      617663.


Bhandari, Anmol, David Evans, Mikhail Golosov, and Thomas J. Sargent.
  2017b.  Public debt in economies with heterogeneous agents.   Journal of Monetary
  Economics, 91 3951.


                                            40
Bilbiie, Florin Ovidiu, and Xavier Ragot.           2017.  Optimal Monetary Policy

  and Liquidity with Heterogeneous Households. CEPR Discussion Papers 11814,

  C.E.P.R. Discussion Papers.


Challe, Edouard.      2017.  Uninsured Unemployment Risk and Optimal Monetary

  Policy. Working Papers 2017-54, Center for Research in Economics and Statistics.


Childers, David et al. 2018. On the Solution and Application of Rational Expec-
  tations Models with Function-Valued States.    Unpublished manuscript.

Clarida, Richard, Jordi Gali, and Mark Gertler.             2001. Optimal Monetary

  Policy in Open versus Closed Economies:       An Integrated Approach.        American
  Economic Review, 91(2):     248252.


Debortoli, Davide, and Jordi Gali. 2017.  Monetary Policy with Heterogeneous
  Agents: Insights from TANK models. working papers, Department of Economics

  and Business, Universitat Pompeu Fabra.


Evans, David. 2015. Perturbation Theory with Heterogeneous Agents:            Theory and

  Applications. Ph.D. dissertation, New York University.


Farhi, Emmanuel.       2010.  Capital Taxation and Ownership When Markets Are

  Incomplete.   Journal of Political Economy, 118(5):   908948.


Fleming, Wendell H. 1971. Stochastic Control for Small Noise Intensities. SIAM
  Journal on Control, 9(3):   473517.


Fleming, Wendell H, and PE Souganidis.             1986. Asymptotic series and the

  method of vanishing viscosity.    Indiana University Mathematics Journal,       35(2):

  425447.


Gal√≠, Jordi. 2015. Monetary policy, ination, and the business cycle: an introduction
  to the new Keynesian framework and its applications.:    Princeton University Press.


Guvenen, Fatih, Serdar Ozkan, and Jae Song. 2014. The Nature of Counter-
  cyclical Income Risk.   Journal of Political Economy, 122(3):    621660.


Huggett, Mark.       1993. The risk-free rate in heterogeneous-agent incomplete-

  insurance economies.    Journal of Economic Dynamics and Control, 17(5):      953969.




                                          41
Jappelli, Tullio, and Luigi Pistaferri. 2014. Fiscal Policy and MPC Heterogene-
  ity.   American Economic Journal: Macroeconomics, 6(4):      10736.


Kaplan, Greg, Benjamin Moll, and Giovanni L. Violante.                  2018. Monetary

  Policy According to HANK.       American Economic Review, 108(3):      697743.


Kaplan, Greg, and Giovanni L. Violante.              2018 forthcoming. Microeconomic

  Heterogeneity and Macroeconomic Shocks.        Journal of Economic Perspectives.

Krusell, Per, and Anthony A Smith, Jr. 1998. Income and wealth heterogeneity
  in the macroeconomy.    Journal of Political Economy, 106(5):    867896.


Legrand, Francois, and Xavier Ragot.              2017. Optimal policy with heteroge-

  neous agents and aggregate shocks : An application to optimal public debt dynam-

  ics.Technical report.


Low, Hamish, Costas Meghir, and Luigi Pistaferri.                 2010. Wage risk and

  employment risk over the life cycle.   American Economic Review,       100(4): 1432

  1467.


Lucas, Robert E, and Nancy L Stokey.               1983.  Optimal scal and monetary

  policy in an economy without capital.        Journal of Monetary Economics,       12(1):

  5593.


Luenberger, David G.       1997.   Optimization by Vector Space Methods.       New York,

  NY, USA: John Wiley & Sons, Inc., , 1st edition.


Marcet, Albert, and Ramon Marimon. 2011. Recursive contracts.
Nuno, Galo, and Carlos Thomas. 2016.  Optimal monetary policy with hetero-
  geneous agents. Working Papers 1624.


Reiter, Michael. 2009. Solving heterogeneous-agent models by projection and per-
  turbation.   Journal of Economic Dynamics and Control, 33(3):      649665.


Rotemberg, Julio J. 1982. Monopolistic Price Adjustment and Aggregate Output.
  Review of Economic Studies, 49(4):    517531.


Sbordone, Argia M. 2002.  Prices and unit labor costs:        a new test of price sticki-

  ness.   Journal of Monetary Economics, 49(2):    265292.



                                           42
Schmitt-Grohe, Stephanie, and Martin Uribe. 2004. Optimal scal and mon-
  etary policy under sticky prices.   Journal of Economic Theory, 114(2):   198230.


Siu, Henry E.     2004. Optimal Fiscal and Monetary Policy with Sticky Prices.

  Journal of Monetary Economics, 51(3):      575607.


Smets, Frank, and Rafael Wouters. 2007. Shocks and frictions in US business
  cycles: A Bayesian DSGE approach.      American Economic Review, 97(3):    586606.


Storesletten, Kjetil, Chris I Telmer, and Amir Yaron. 2001. How important
  are idiosyncratic shocks? Evidence from labor supply.   American Economic Review,
  91(2): 413417.


Storesletten, Kjetil, Christopher I Telmer, and Amir Yaron.               2004. Con-

  sumption and risk sharing over the life cycle.    Journal of Monetary Economics,
  51(3): 609633.


Werning, Ivan. 2007.  Optimal Fiscal Policy with Redistribution,. Quarterly Jour-
  nal of Economics, 122(August):   925967.


Winberry, Thomas.      2016. A Toolbox for Solving and Estimating Heterogeneous

  Agent Macro Models.    Forthcoming Quantitative Economics.

Woodford, Michael. 2003. Interest and prices.:      Princeton University Press.


Yared, Pierre.   2013.  Public Debt Under Limited Private Credit.    Journal of the
  European Economic Association, 11(2):      229245.




                                           43
                                Online Appendix

A Recursive Representation of Ramsey Plan
For completeness and ease of readability, we repeat the planning problem with a full set of

implementability constraints below.         Given an initial condition    {bi,‚àí1 , Œ∏i,‚àí1 , si }, Œõ‚àí1 = 0,
ai,‚àí1 = 0   and the multipliers, the Ramsey allocation solves:


                ‚àû
                            (Z "                     !
                X                  c1‚àíŒΩ
                                    i,t   n1+Œ≥
                                           i,t                                          1+Œ≥
                       Œ≤t                                   1‚àíŒΩ
                                                                ‚àí c‚àíŒΩ
                                                                                            
   inf sup E0                           ‚àí                + ci,t    i,t (Tt + si Dt ) ‚àí ni,t   ¬µi,t
                 t=0
                                   1‚àíŒΩ 1+Œ≥
                 ai,t‚àí1 c‚àíŒΩ           ‚àí1
                         i,t (1 + Œ†t ) Œæi,t
              ‚àí            ‚àíŒΩ
                                            + (1 ‚àí Œ≤)c‚àíŒΩ
                                                       i,0 bi,‚àí1 ¬µi,0 di                           (31)
                Œ≤Et‚àí1 ci,t (1 + Œ†t )    ‚àí1
                                                                                 
                     ‚àíŒΩ                       Wt                         ‚àíŒΩ
              + Œõt Ct Yt 1 ‚àí Œ¶t 1 ‚àí                    + (Œõt‚àí1 ‚àí Œõt )Ct œàŒ†t (1 + Œ†t ) ,
                                            Œ±NtŒ±‚àí1

subject to


                                                       Œ≥
                              c‚àíŒΩ
                               i,0 (1 ‚àí Œ•0 )W0 i,0 = ni,0
                                          ‚àí1/ŒΩ
                                        mi,0 ci,0 = C0
                                         Z
                                            ci,0 di = C0
                                                              œà 2
                                          C0 + GÃÑ = N0Œ± ‚àí      Œ†
                                                              2 0
                                                                   œà
                                                 D0 = N0Œ± ‚àí W0 N0 ‚àí Œ†20
                                                      Z            2
                                                 N0 = i,0 ni,0 di




                                                    1
and


                                                         Œ≥
                                c‚àíŒΩ
                                 i,t Wt (1 ‚àí Œ•t )i,t = ni,t                                                                     (32)
                                                                           h                    i
                                                    Qt‚àí1     = Œ≤mi,t‚àí1 Et‚àí1 c‚àíŒΩ
                                                                             i,t (1 + Œ† t+1 )‚àí1
                                                                                                                                 (33)

                                                 ‚àí1/ŒΩ
                                             mi,t       ci,t = Ct                                                                (34)
                                              Z
                                                    ci,t di = Ct                                                                 (35)

                                                                             œà 2
                                                 Ct + GÃÑ = NtŒ± ‚àí              Œ†                                                  (36)
                                                                             2 t
                                                                          œà
                                                        Dt = NtŒ± ‚àí Wt Nt ‚àí Œ†2t                                                   (37)
                                                             Z            2
                                                        Nt = i,t ni,t di                                                        (38)


                                                       ¬µi,t = ¬µi,t‚àí1 + Œæi,t .

                                   ‚àíŒΩ
for    t ‚â• 1,   where      Qt‚àí1 ‚â° Ct‚àí1 Qt‚àí1 ,            with



                                         ln i,t = ln Œòt + ln Œ∏i,t + Œµ,i,t
                                        ln Œ∏i,t = œÅŒ∏ ln Œ∏i,t‚àí1 + f (Œ∏i,t‚àí1 )EŒò,t + ŒµŒ∏,i,t
                                         ln Œòt = œÅŒò ln Œòt‚àí1 + (1 ‚àí œÅŒò ) ln ŒòÃÑ + EŒò,t
                                         ln Œ¶t = œÅŒ¶ ln Œ¶t‚àí1 + (1 ‚àí œÅŒ¶ ) ln Œ¶ÃÑ + EŒ¶,t ,
                                                                                   
where the inf is over multipliers                 {¬µi,t , Œõt }t and the sup is over {ci,t , ni,t , bi,t }i , Ct , Nt , Bt , Wt , Pt , Yt , Dt   .

       The state for the         t ‚â• 1 continuation problem is the joint distribution of (mi,0 , ¬µi,0 , Œ∏i,0 , si ),
Œõ0 ,   and aggregate shocks                (Œò0 , Œ¶0 ).     For the remainder of this appendix we'll focus on the

rst-order conditions for the continuation problem and how to approximate solutions to

those rst-order conditions recursive in the distribution over                                 (mi , ¬µi , Œ∏i , si )   and   (Œõ, Œò, Œ¶).
Once that approximation has been obtained, the solution to the time 0 problem can be

found by solving the time 0 rst-order conditions with the knowledge that some variables

will be given by the continuation policy rules.                                    We omit those rst-order conditions for

brevity.

       Let   Œ≤ t œÜi,t , Œ≤ t œÅi,t‚àí1 , Œ≤ t œïi,t , Œ≤ t œát , Œ≤ t Œût , Œ≤ t Œ∂t ,Œ≤ t Œ∫t   be the Lagrange multipliers on (32)-(38)

respectively. After taking derivatives, the rst-order condition with respect to                                        ai,t‚àí1   com-

bined with        ¬µi,t = ¬µi,t‚àí1 + Œæi,t          imply

                                                              h                          i
                                                          Et‚àí1 c‚àíŒΩ
                                                                i,t  (1 + Œ† t )‚àí1 ¬µ
                                                                                     i,t
                                              ¬µi,t‚àí1    =       h                     i ,
                                                           Et‚àí1 c‚àíŒΩi,t (1 + Œ†  t ) ‚àí1




                                                                         2
and the rst-order conditions with respect to                          mi,t   and   Qt‚àí1   give

                                                                Z
                                                                    œÜi,t = 0.

Due to the timing of the planner's problem (at time                                 t   but before shocks have been real-
ized) policy functions will be a functions of both the previous log of the shocks,               Œòt‚àí1 =
(ln Œòt‚àí1 , ln Œ¶t‚àí1 ); the innovations, E t = (EŒò,t , EŒ¶,t ) and Œµ = (Œµ , ŒµŒ∏ ); as well as the individual
states, zt‚àí1 = (mt‚àí1 , ¬µt‚àí1 , Œ∏t‚àí1 , s), and the distribution over those states, ‚Ñ¶t‚àí1 . The rst
order conditions of the planner's problem can then be written recursively as


                                                                                                                    pÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)
0 =nÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)1+Œ≥ + cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)‚àíŒΩ (TÃÉ (E, Œò, ‚Ñ¶, Œõ) + sDÃÉ(E, Œò, ‚Ñ¶, Œõ)) + aÃÉ(Œò, z, ‚Ñ¶, Œõ)
                                                                                                                   Œ≤E [pÃÉ(¬∑, ¬∑, Œò, z, ‚Ñ¶, Œõ)]
    ‚àí c(Œµ, E, Œò, z, ‚Ñ¶, Œõ)1‚àíŒΩ ‚àí aÃÉ(œÅŒò Œò + (1 ‚àí œÅŒò )ŒòÃÑ + E, zÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ), ‚Ñ¶ÃÉ(E, Œò, ‚Ñ¶, Œõ), ŒõÃÉ(E, Œò, ‚Ñ¶, Œõ))                        (39)
0 =cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)   ‚àíŒΩ
                               WÃÉ (E, Œò, ‚Ñ¶, Œõ)(1 ‚àí Œ•ÃÉ(E, Œò, ‚Ñ¶, Œõ))Àú
                                                                  (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí nÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)   Œ≥
                                                                                                                                       (40)
0 =mÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)   ‚àí1/ŒΩ
                          cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí CÃÉ(E, Œò, ‚Ñ¶, Œõ)                                                                        (41)
      h                                                                                    i
0 =Œ≤E %ÃÉ(¬∑, ¬∑œÅŒò Œò + (1 ‚àí œÅŒò )ŒòÃÑ + E, zÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ), ‚Ñ¶ÃÉ(E, Œò, ‚Ñ¶, Œõ), ŒõÃÉ(E, Œò, ‚Ñ¶, Œõ))
        1
    +     mÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)‚àí1/ŒΩ‚àí1 cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)œïÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)                                                          (42)
        ŒΩ
                                                                                                               %ÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)
0 =cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)‚àíŒΩ + (1 ‚àí ŒΩ)cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)‚àíŒΩ ¬µÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí Œ≤ŒΩ mÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)
                                                                                                               cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)
                                                                   
    ‚àí ŒΩcÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)‚àíŒΩ‚àí1 TÃÉ (E, Œò, ‚Ñ¶, Œõ) + s(z)DÃÉ(E, Œò, ‚Ñ¶, Œõ) ¬µÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)
        ŒΩaÃÉ(Œò, z, ‚Ñ¶, Œõ)rÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)
    +                                       (¬µÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí ¬µ)
               cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)
    + ŒΩcÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)‚àíŒΩ‚àí1 WÃÉ (E, Œò, ‚Ñ¶, Œõ)(1 ‚àí Œ•ÃÉ(E, Œò, ‚Ñ¶, Œõ))Àú
                                                                   (Œµ, E, Œò, z, ‚Ñ¶, Œõ)œÜÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)
    + mÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)‚àí1/ŒΩ œïÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí œáÃÉ(E, Œò, ‚Ñ¶, Œõ)                                                                   (43)
                          Œ≥                                 Œ≥
0 =nÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí (1 + Œ≥)nÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ¬µÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)
    + Œ≥ nÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)Œ≥‚àí1 œÜÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) + Àú(Œµ, E, Œò, z, ‚Ñ¶, Œõ)Œ∫ÃÉ(E, Œò, ‚Ñ¶, Œõ)                                              (44)
0 =%ÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)‚àíŒΩ (1 + Œ†ÃÉ(E, Œò, ‚Ñ¶, Œõ))‚àí1 œÅÃÉ(z, ‚Ñ¶, Œõ)                                                    (45)
0 =pÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)   ‚àíŒΩ
                                                      (1 + Œ†ÃÉ(E, Œò, ‚Ñ¶, Œõ))   ‚àí1
                                                                                                                                       (46)
                          pÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)¬µÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)
0 =rÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí                                                                                                              (47)
                                   Œ≤E [pÃÉ(¬∑, ¬∑, Œò, z, ‚Ñ¶, Œõ)]
0 =¬µ ‚àí Œ≤E [rÃÉ(¬∑, ¬∑, Œò, z, ‚Ñ¶, Œõ)]                                                                                                       (48)
0 =QÃÉ(Œò, ‚Ñ¶, Œõ) ‚àí Œ≤mE pÃÉ(¬∑, ¬∑, Œò, z, ‚Ñ¶, Œõ))‚àí1                                                                                           (49)
                                            

0 = ln Àú(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí ln Œ∏ÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí Œµ ‚àí œÅŒò ln Œò ‚àí (1 ‚àí œÅŒ∏ ) ln ŒòÃÑ ‚àí EŒò                                            (50)
0 = ln Œ∏ÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí œÅŒò ln Œ∏ ‚àí f (Œ∏) ‚àí ŒµŒ∏
0 =sÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí s                                                                                                            (51)




                                                                      3
while the aggregate constraints are

          Z Z
     0=       cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)‚àíŒΩ ¬µÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)dPr(Œµ)d‚Ñ¶(z)                                                    (52)
                           Z Z
     0 =CÃÉ(E, Œò, ‚Ñ¶, Œõ) ‚àí         cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)dPr(Œµ)d‚Ñ¶(z)                                                        (53)
                            œà
     0 =YÃÉ (E, Œò, ‚Ñ¶, Œõ) ‚àí Œ†ÃÉ(E, Œò, ‚Ñ¶, Œõ)2 ‚àí CÃÉ(E, Œò, ‚Ñ¶, Œõ) ‚àí GÃÑ                                                         (54)
         Z Z                2
     0=        Àú(Œµ, E, Œò, z, ‚Ñ¶, Œõ)nÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)dPr(Œµ)d‚Ñ¶(z) ‚àí YÃÉ (E, Œò, ‚Ñ¶, Œõ)                                    (55)
                                                            œà
     0 =YÃÉ (E, Œò, ‚Ñ¶, Œõ) ‚àí WÃÉ (E, Œò, ‚Ñ¶, Œõ)NÃÉ (E, Œò, ‚Ñ¶, Œõ) ‚àí Œ†ÃÉ(E, Œò, ‚Ñ¶, Œõ)2 ‚àí DÃÉ(E, Œò, ‚Ñ¶, Œõ)                             (56)
                                                            2
                                                                                                     
                       ‚àíŒΩ                                          1
     0 =CÃÉ(E, Œò, ‚Ñ¶, Œõ) YÃÉ (E, Œò, ‚Ñ¶, Œõ)       1 ‚àí Œ¶ÃÉ(E, Œò, ‚Ñ¶, Œõ)(1 ‚àí WÃÉ (E, Œò, ‚Ñ¶, Œõ)NÃÉ (E, Œò, ‚Ñ¶, Œõ)1‚àíŒ± )
                                                                   Œ±
                                h                                                            i
         ‚àí ‚ÑµÃÉ(E, Œò, ‚Ñ¶, Œõ) + Œ≤E ‚ÑµÃÉ(¬∑, œÅŒò Œò + (1 ‚àí œÅŒò )ŒòÃÑ + E, ‚Ñ¶ÃÉ(E, Œò, ‚Ñ¶, Œõ), ŒõÃÉ(E, Œò, ‚Ñ¶, Œõ))                            (57)
                                                 ‚ÑµÃÉ(E, Œò, ‚Ñ¶, Œõ)
     0 =œáÃÉ(E, Œò, ‚Ñ¶, Œõ) ‚àí ŒûÃÉ(E, Œò, ‚Ñ¶, Œõ) + ŒΩ                (ŒõÃÉ(E, Œò, ‚Ñ¶, Œõ) ‚àí Œõ)
                                           CÃÉ(E, Œò, ‚Ñ¶, Œõ)
                                               h                                           i
         ‚àí ŒΩ CÃÉ(E, Œò, ‚Ñ¶, Œõ)‚àíŒΩ‚àí1 YÃÉ (E, Œò, ‚Ñ¶, Œõ) 1 ‚àí Œ¶ÃÉ(E, Œò, ‚Ñ¶, Œõ)(1 ‚àí WÃÉ (E, Œò, ‚Ñ¶, Œõ)) ŒõÃÉ(E, Œò, ‚Ñ¶, Œõ)                  (58)
                               Z Z
     0 =(1 + Œ†ÃÉ(E, Œò, ‚Ñ¶, Œõ))‚àí1      aÃÉ(Œò, z, ‚Ñ¶, Œõ)rÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)(¬µÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí ¬µ)

          ‚àí Œ≤ %ÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)dPr(Œµ)d‚Ñ¶(z) ‚àí œà Œ†ÃÉ(E, Œò, ‚Ñ¶, Œõ)ŒûÃÉ(E, Œò, ‚Ñ¶, Œõ)                                          (59)
                                                                  ‚àíŒΩ
        ‚àí œà Œ†ÃÉ(E, Œò, ‚Ñ¶, Œõ)Œ∂ÃÉ(E, Œò, ‚Ñ¶, Œõ) ‚àí œà CÃÉ(E, Œò, ‚Ñ¶, Œõ) (1 + 2Œ†ÃÉ(E, Œò, ‚Ñ¶, Œõ))(ŒõÃÉ(E, Œò, ‚Ñ¶, Œõ) ‚àí Œõ)                   (60)
        Z Z
     0=       cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)‚àíŒΩ Àú(Œµ, E, Œò, z, ‚Ñ¶, Œõ)œÜÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)dPr(Œµ)d‚Ñ¶(z)                                (61)
        Z
     0 = cÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)‚àíŒΩ s¬µÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ)dPr(Œµ)d‚Ñ¶ ‚àí Œ∂ÃÉ(E, Œò, ‚Ñ¶, Œõ)                                          (62)
         1
     0 = ŒõÃÉ(E, Œò, ‚Ñ¶, Œõ)CÃÉ(E, Œò, ‚Ñ¶, Œõ)‚àíŒΩ Œ¶ÃÉ(E, Œò, ‚Ñ¶, Œõ) ‚àí Œ∂ÃÉ(E, Œò, ‚Ñ¶, Œõ)                                                 (63)
        Œ±
                                                                                                                
                                                                                 1
     0 =ŒõÃÉ(E, Œò, ‚Ñ¶, Œõ)CÃÉ(E, Œò, ‚Ñ¶, Œõ) Œ±NÃÉ (E, Œò, ‚Ñ¶, Œõ)Œ±‚àí1 (1 ‚àí Œ¶ÃÉ(E, Œò, ‚Ñ¶, Œõ)) + Œ¶ÃÉ(E, Œò, ‚Ñ¶, Œõ)WÃÉ (E, Œò, ‚Ñ¶, Œõ)           (64)
                                                                                 Œ±
                                                               
         + Œ±NÃÉ (E, Œò, ‚Ñ¶, Œõ) Œ±‚àí1
                                 ŒûÃÉ(E, Œò, ‚Ñ¶, Œõ) + Œ∂ÃÉ(E, Œò, ‚Ñ¶, Œõ) ‚àí WÃÉ (E, Œò, ‚Ñ¶, Œõ)Œ∂ÃÉ(E, Œò, ‚Ñ¶, Œõ) ‚àí Œ∫ÃÉ(E, Œò, ‚Ñ¶, Œõ)       (65)
     0 =‚ÑµÃÉ(E, Œò, ‚Ñ¶, Œõ) ‚àí CÃÉ(E, Œò, ‚Ñ¶, Œõ) ‚àíŒΩ
                                                œà Œ†ÃÉ(E, Œò, ‚Ñ¶, Œõ)(1 + Œ†ÃÉ(E, Œò, ‚Ñ¶, Œõ))                                    (66)
     0 =YÃÉ (E, Œò, ‚Ñ¶, Œõ) ‚àí NÃÉ (E, Œò, ‚Ñ¶, Œõ)   Œ±
                                                                                                                        (67)
     0 =Œ¶ÃÉ(E, Œò, ‚Ñ¶, Œõ) ‚àí exp(œÅŒ¶ ln Œ¶ + (1 ‚àí œÅŒ¶ ) ln Œ¶ÃÑ + EŒ¶ )                                                           (68)
        Z
     0 = œÅÃÉ(Œò, z, ‚Ñ¶, Œõ)d‚Ñ¶                                                                                               (69)
          h               i
     0 =E TÃÉ (¬∑, Œò, ‚Ñ¶, Œõ)                                                                                               (70)


These are in addition to the implicit restrictions that                         QÃÉ, aÃÉ   and   œÅÃÉ   do not depend on period

t   shocks.     The additional constraint (70) is required because of Ricardian equivalence as

without it there would be multiple solutions to the FOC corresponding to dierent paths of

government debt.




A.1 Slack Phillips Curve When si = 1
Here we demonstrate the result that when all agents have the same equity ownership,                                  si = 1



                                                                   4
for all i, the Phillips curve, equation (15), does not bind at the optimal allocation and hence

Œõt = 0           for all     t.    Let    {ci,t , ni,t }    and     {Ct , Œ†t , Wt , Tt , Œ•t , Dt , Qt , Yt }     be the allocation that

maximizes a relaxed planner's problem without the Phillip's curve constraint.                                                     Dene   WÃÇt
                                                                                  œà 2
such that (15) is satised;                     DÃÇt = (1 ‚àí WÃÇt )Yt ‚àí              2 Œ†t ;   Œ•ÃÇt   such that   (1 ‚àí Œ•ÃÇt )WÃÇt = (1 ‚àí Œ•t )Wt ;
and    TÃÇt   such that            TÃÇt + si DÃÇt = Tt + si Dt .               It is clear from this denition that all equilib-

rium conditions will then be satised with                                  {Ct , Œ†t , WÃÇt , TÃÇt , Œ•ÃÇt , DÃÇt , Qt , Yt }   for the allocation

{ci,t , ni,t },    and therefore this allocation maximizes the full planner's problem which implies

that the Phillip's curve is slack.




B Additional Details for Section 3
This section contains the omitted steps and proofs from section 3 in the main text.                                                       In

section B.1 we dene the                      F   and      R   functions used in the expansion provided in section B.2.

We prove lemma 1 and lemma 2 of the main text in section B.3. In sections B.4-B.7, we

derive equations (74)-(79) which extend the factorization theorem, theorem 1, to the more

general Ramsey problem, and then exploit this factorization to derive equations (76)-(96)

which give all the derivatives needed for the second-order Taylor expansions of the Ramsey

policies using matrices known from the lower-order expansions and requiring only small

dimensional matrix inversions.




B.1 Deriving functions F and R
                                                                            |
Let    xÃÉ =            mÃÉ, ¬µÃÉ, Œ∏ÃÉ, sÃÉ, cÃÉ, nÃÉ, aÃÉ, %ÃÉ, œÜÃÉ, œïÃÉ, œÅÃÉ, rÃÉ, pÃÉ, Àú     denote the household specic variables and
                                                                                   |
let   XÃÉ =            ŒõÃÉ, CÃÉ, YÃÉ , Œ†ÃÉ, WÃÉ , DÃÉ, NÃÉ , ‚ÑµÃÉ, œáÃÉ, ŒûÃÉ, Œ¶ÃÉ, Œ∂ÃÉ, Œ∫ÃÉ, TÃÉ , Œ•ÃÉ             denote the aggregate variables.          By

assumption,             ŒõÃÉ   is contained in          XÃÉ   and     zÃÉ   is contained in          xÃÉ   so there exist projection matrices

P   and      p   that satisfy          ŒõÃÉ = PXÃÉ         and     zÃÉ = pxÃÉ.             Equations (39)-(51) represent the individual

constraints of the problem and can be summarized by the following function which extends

(20) of section 3




      0 = F z, ExÃÉ(¬∑, ¬∑, Œò, z, ‚Ñ¶, Œõ), xÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ),
       h                                                                                     i
      E xÃÉ(¬∑, ¬∑, œÅŒò Œò + (1 ‚àí œÅŒò )ŒòÃÑ + E, zÃÉ(Œµ, E, Œò, z, ‚Ñ¶, Œõ), ‚Ñ¶ÃÉ(Œò, z, ‚Ñ¶, Œõ), ŒõÃÉ(Œò, z, ‚Ñ¶, Œõ) ,                                         (71)
                           !
      XÃÉ(Œò, ‚Ñ¶, Œõ), Œµ, E, Œò


and must hold for all                     z   in the support of              ‚Ñ¶.        Equations (52)-(70) capture the aggregate




                                                                                  5
constraints which must hold across all agents and can be dened by the following function

which extends (21) of section 3
                                             19

          Z
     0=        R z, xÃÉ(Œµ, Œò, z, ‚Ñ¶, Œõ), XÃÉ(Œò, ‚Ñ¶, Œõ),
                                                                                                             !
                       E[XÃÉ(¬∑, œÅŒò Œò + (1 ‚àí œÅŒò )ŒòÃÑ + E, ‚Ñ¶ÃÉ(Œò, ‚Ñ¶, Œõ), ŒõÃÉ(Œò, ‚Ñ¶, Œõ))], Œµ, Œò, Œõ dPr(Œµ)d‚Ñ¶.

                                                                                                                         (72)



The law of motion for            ‚Ñ¶ÃÉ   is given by

                                                  Z
                       ‚Ñ¶
                       e (E, Œò, ‚Ñ¶, Œõ) (y) =            Œπ (zÃÉ (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y) d Pr (Œµ) d‚Ñ¶ ‚àÄy,                     (73)



where     Œπ (zÃÉ (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y)           is    1   i all elements of       zÃÉ (Œµ, E, Œò, z, ‚Ñ¶)    are less than all

elements of        y   and zero otherwise.




B.2 Setting up the expansions
Section 3 presented two approaches to approximating                              xÃÉ   and    XÃÉ :    expanding around the

deterministic transition dynamics                 {Œòt , Œõt } and expanding around the non-stochastic steady
state    (ŒòÃÑ, ŒõÃÑ).     We rst present how to expand around the non-stochastic steady state                            (ŒòÃÑ, ŒõÃÑ)
in sections B.2-B.6. In section B.7 we describe the full expansion along the transition path.

To expand around             (ŒòÃÑ, ŒõÃÑ),   we consider a positive scalar           œÉ    that scales all shocks, deviations

of   Œò   and   Œõ     from their respective steady states              ŒòÃÑ   and   ŒõÃÑ(‚Ñ¶),     and     œÅŒ∏ (œÉ) = 1 ‚àí œÉœÅ.   We let

xÃÉ(œÉŒµ, œÉE, œÉ(Œò ‚àí ŒòÃÑ) + ŒòÃÑ, z, ‚Ñ¶, œÉ(Œõ ‚àí ŒõÃÑ(‚Ñ¶)) + ŒõÃÑ; œÉ)                     and   XÃÉ(œÉE, œÉ(Œò ‚àí ŒòÃÑ) + ŒòÃÑ, z, ‚Ñ¶, œÉ(Œõ ‚àí
ŒõÃÑ(‚Ñ¶)); œÉ)     denote the policy rules with scaling parameters                       œÉ,   and approximate these policies

with a Taylor expansion with respect to                      œÉ. For example, a rst-order Taylor expansion would
be of the form

                                                                                        
           xÃÉ(Œµ, Œò, z, ‚Ñ¶, Œõ) = xÃÑ(z, ‚Ñ¶) + xÃÑŒµ (z, ‚Ñ¶)Œµ + xÃÑE (z, ‚Ñ¶)E + xÃÑŒò (z, ‚Ñ¶)(Œò ‚àí ŒòÃÑ) œÉ
                             + xÃÑŒõ (z, ‚Ñ¶)(Œõ ‚àí ŒõÃÑ(‚Ñ¶)) + xÃÑœÉ œÉ + O(œÉ 2 )
                                                           

     19 The   R   presented here nests that of section 3 with two main dierences.                               The rst is
the inclusion of expectations of future aggregate variables. The second is that we choose to
integrate over          R   rather than over           x.   Both choices are without loss of generality but they
allow for equations (39)- (51) and (52)-(70) representing the Ramsey plan to be expressed
in a more condensed form.




                                                                  6
and



XÃÉ(Œò, ‚Ñ¶, Œõ) = XÃÑ(‚Ñ¶) + XÃÑE (‚Ñ¶)E + XÃÑŒò (‚Ñ¶)(Œò ‚àí ŒòÃÑ) + XÃÑŒõ (‚Ñ¶)(Œõ ‚àí ŒõÃÑ(‚Ñ¶)) + XÃÑœÉ œÉ + O(œÉ 2 ),
                                                                           


while second-order expansions can be dened analogously.




B.3 Proof of Lemma 1 and Lemma 2
We begin by showing that when            œÉ = 0, zÃÉ(0, 0, ŒòÃÑ, z, ‚Ñ¶, ŒõÃÑ; 0) = z and hence that ‚Ñ¶ÃÉ(0, ŒòÃÑ, ‚Ñ¶, ŒõÃÑ; 0) = ‚Ñ¶.
                                                                ¬µ
From (47) it is clear that        rÃÉ(0, 0, ŒòÃÑ, z, ‚Ñ¶, ŒõÃÑ; 0) =   Œ≤ and thus equation (48) implies


                                           ¬µÃÉ(0, 0, ŒòÃÑ, z, ‚Ñ¶, ŒõÃÑ; 0) = ¬µ.

In absence of shocks, we conclude from equations (41) and (49) that



                     cÃÉ(0, 0, ŒòÃÑ, z, ‚Ñ¶, ŒõÃÑ; 0) = mÃÉ(0, 0, ŒòÃÑ, z, ‚Ñ¶, ŒõÃÑ; 0)1/ŒΩ CÃÉ(0, ŒòÃÑ, ‚Ñ¶, ŒõÃÑ; 0)

and
                                                                                   1/ŒΩ
                                              1/ŒΩ              Œ≤
          cÃÉ(0, 0, ŒòÃÑ, z, ‚Ñ¶, ŒõÃÑ; 0) = m
                                         QÃÉ(ŒòÃÑ, ‚Ñ¶, ŒõÃÑ; 0)(1 + Œ†(0, ŒòÃÑ, ‚Ñ¶, ŒõÃÑ; 0))
   R 1                                                          1/ŒΩ
                                               Œ≤
As  m ŒΩ d‚Ñ¶(z) = 1, this implies QÃÉ(ŒòÃÑ,‚Ñ¶,ŒõÃÑ;0)(1+Œ†(0, ŒòÃÑ,‚Ñ¶,ŒõÃÑ;0))
                                                                      = CÃÉ(0, ŒòÃÑ, ‚Ñ¶, ŒõÃÑ; 0) and hence

                                                                1
                                 cÃÉ(0, 0, ŒòÃÑ, z, ‚Ñ¶, ŒõÃÑ; 0) = m ŒΩ CÃÉ(0, ŒòÃÑ, ‚Ñ¶, ŒõÃÑ; 0).

We, therefore, conclude that          mÃÉ(0, 0, ŒòÃÑ, z, ‚Ñ¶, ŒõÃÑ; 0) = m.
      By assumption      sÃÉ(0, 0, ŒòÃÑ, z, ‚Ñ¶, ŒõÃÑ; 0) = s and, as œÅŒ∏ ‚Üí 1 as œÉ ‚Üí 0, Œ∏ÃÉ(0, 0, 0, z, ‚Ñ¶, ŒõÃÑ; 0) = Œ∏.
All combined, we obtain           zÃÉ(0, 0, ŒòÃÑ, z, ‚Ñ¶, ŒõÃÑ; 0) = z     and therefore   ‚Ñ¶ÃÉ(0, ŒòÃÑ, ‚Ñ¶, ŒõÃÑ; 0) = ‚Ñ¶.    Note

that we obtained       ‚Ñ¶ÃÉ(0, ŒòÃÑ, ‚Ñ¶, ŒõÃÑ; 0) = ‚Ñ¶ by exploiting that, in absence of risk, the expectations
in (41) and (49) drop out. This would hold apply along any deterministic transition path

for   (Œõ, Œò)   and thus    zÃÉ(0, 0, Œò, z, ‚Ñ¶, Œõ; 0) = z      and     ‚Ñ¶ÃÉ(0, Œò, ‚Ñ¶, Œõ; 0) = ‚Ñ¶   for any   (Œõ, Œò).   This

proves the statement of lemma 2 and, therefore, also of lemma 1 as it is a special case of

lemma 2.




B.4 Frechet Derivatives: ‚àÇ xÃÑ(z), ‚àÇ XÃÑ
Dierentiate     F   and   R   with respect to      z   to obtain



                               (Fx‚àí (z) + Fx (z) + Fx+ (z))xÃÑz (z) + Fz (z) = 0,


                                                            7
where we exploited         zÃÑz = I.   This yields   xÃÑz (z) = (Fx‚àí (z) + Fx (z) + Fx+ (z))‚àí1 Fz (z).
      We begin by solving for the derivatives w.r.t           Œõ.   Exploiting   zÃÉ(0, 0, 0, z, ‚Ñ¶, Œõ; 0) = z   and

‚Ñ¶ÃÉ(0, 0, ‚Ñ¶, Œõ; 0) = ‚Ñ¶      and hence    zÃÑŒõ = 0   and   ‚Ñ¶ÃÑŒõ = 0,
                                                                  
               Fx‚àí (z)xÃÑŒõ (z) + Fx (z)xÃÑŒõ (z) + Fx+ (z) xÃÑŒõ (z)ŒõÃÑŒõ + FX (z)XÃÑŒõ = 0

and             Z
                     Rx (z)xÃÑŒõ (z) + RX (z)XÃÑŒõ + RX+ (z)XÃÑŒõ ŒõÃÑŒõ + RŒõ (z)d‚Ñ¶(z) = 0.

In order to proceed, we need to nd the derivative                 ŒõÃÑŒõ .   This requires solving a nonlinear

equation but still involves only operations involving small matrices. First note that



                          xÃÑŒõ (z) = ‚àí(Fx‚àí (z) + Fx (z) + ŒõÃÑŒõ Fx+ (z))‚àí1 FX (z)XÃÑŒõ

Let   C(z) = ‚àí(Fx‚àí (z) + Fx (z) + ŒõÃÑŒõ Fx+ (z))‚àí1 FX (z),             then

                    Z                                                        ‚àí1 Z              
                                                           
        XÃÑŒõ = ‚àí            Rx (z)C(z) + RX (z) + ŒõÃÑŒõ RX+ (z) d‚Ñ¶(z)                     RŒõ (z)d‚Ñ¶(z) .


Therefore,   ŒõÃÑŒõ    must solve

                     Z                                                       ‚àí1 Z                   
                                                            
        ŒõÃÑŒõ = ‚àíP            Rx (z)C(z) + RX (z) + ŒõÃÑŒõ RX+ (z) d‚Ñ¶(z)                     RŒõ (z)d‚Ñ¶(z) .

This can be found easily with a 1-dimensional root solver as all the inversions involve small

matrices.

      The Frechet derivative w.r.t        ‚Ñ¶   is computed as follows:



            (Fx‚àí (z) + Fx (z) + Fx+ (z)) ‚àÇ xÃÑ(z) + Fx+ (z)xÃÑŒõ (z)P‚àÇ XÃÑ + FX (z)‚àÇ XÃÑ = 0

which gives



  ‚àÇ xÃÑ(z) = ‚àí(Fx‚àí (z) + Fx (z) + Fx+ (z))‚àí1 (Fx+ (z)xÃÑŒõ (z)P + FX (z)) ‚àÇ XÃÑ ‚â° C(z)‚àÇ XÃÑ.                       (74)



      To solve for   ‚àÇ XÃÑ ,   we dierentiate   R   in the direction   ‚àÜ,   with density   Œ¥,   to obtain

          Z                                                        Z             
        1
0 = lim      R(z, xÃÑ(z, ‚Ñ¶ + Œ±‚àÜ), XÃÑ(‚Ñ¶ + Œ±‚àÜ))(œâ(z) + Œ±Œ¥(z))dz ‚àí R(z)œâ(z)dz
    Œ±‚Üí0 Œ±
    Z               Z
                                                                                                
  = R(z)Œ¥(z)dz +        Rx (z)‚àÇ xÃÑ(z) ¬∑ ‚àÜ + RX+ (z) (‚àÇ XÃÑ ¬∑ ‚àÜ) + XÃÑŒõ P(‚àÇ XÃÑ ¬∑ ‚àÜ) + RX (z)‚àÇ XÃÑ ¬∑ ‚àÜ œâ(z)dz




                                                          8
where         R(z)   is dened by       R(z) = R(z, xÃÑ(z), XÃÑ, XÃÑ, 0, ŒõÃÑ, ŒòÃÑ).              Substituting for     ‚àÇ xÃÑ(z) =
C(z)‚àÇ XÃÑ,       we get

                        Z                                                                       ‚àí1 Z
                                                                                        
     ‚àÇ XÃÑ ¬∑ ‚àÜ = ‚àí               Rx (z)C(z) + RX+ (z)(I + XÃÑŒõ P) + RX (z) d‚Ñ¶(z)                              R(z)d‚àÜ(z)
                            Z
                 ‚â° D‚àí1          R(z)d‚àÜ(z).                                                                              (75)




B.5 First-Order Terms
Next we dierentiate both             F   and    R    with respect to     œÉ    and use the method of undetermined

coecients to group the terms that multiply                       Œµ, E   and   Œò   and set each equal to zero. For        Œµ,
this yields

                                 Fx (z)xÃÑŒµ (z) + Fx+ (z)xÃÑz (z)pxÃÑŒµ (z) + FŒµ (z) = 0

or

                        xÃÑŒµ (z) = ‚àí (Fx (z) + Fx+ (z)xÃÑz (z)p)‚àí1 FŒµ (z) ‚â° E(z)‚àí1 G(z).                                  (76)


For      Œò,   we nd that (after noting imposing               ‚Ñ¶ÃÑŒò = 0    and   zÃÑŒò = 0)
                                                                
Fx‚àí (z)xÃÑŒò (z) + Fx (z)xÃÑŒò (z) + Fx+ (z) xÃÑŒò (z)œÅŒò + xÃÑŒõ (z)PXÃÑŒò + FX (z)XÃÑŒò + FŒò (z) = 0.

This yields a linear equation in                xÃÑŒò   and   XÃÑŒò   which we can solve for        xÃÑŒò .20    Plugging in for

the linear relationship between             xÃÑŒò       and   XÃÑŒò   in

     Z
          Rx (z)xÃÑŒò (z) + RX (z)XÃÑŒò + RX+ (z)XÃÑŒò œÅŒò + RX+ (z)XÃÑŒõ PXÃÑŒò + RŒò (z)d‚Ñ¶(z) = 0.


yields a linear equation for            XÃÑŒò .
         Finally, for   E   we nd

                                                                             
Fx (z)xÃÑE (z)+Fx+ (z) xÃÑŒò (z) + xÃÑz (z)pxÃÑE (z) + ‚àÇ xÃÑ(z) ¬∑ ‚Ñ¶ÃÑE + xÃÑŒõ (z)PXÃÑE +FX (z)XÃÑE +FE (z) = 0

and

     Z
                                                                         
          Rx (z)xÃÑE (z) + RX (z)XÃÑE + RX+ (z) XÃÑŒò + ‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑE + XÃÑŒõ PXÃÑE + RE (z)d‚Ñ¶(z) = 0.
                                                       
  20 Easiest to exploit                     œÅŒò 0
                                 œÅŒò =                        and solve for each column of         xÃÑŒò     separately.
                                             0 œÅŒ¶




                                                                  9
Substituting for      ‚àÇ xÃÑ,   we obtain and dening                     XÃÑE0 = ‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑE

Fx (z)xÃÑE (z)+Fx+ (z) xÃÑŒò (z) + xÃÑz (z)pxÃÑE (z) + C(z)XÃÑE0 + xÃÑŒõ PXÃÑE +FX (z)XÃÑE +FE (z) = 0,
                                                                     


or
                                                                          h                            i|
                                          H(z)xÃÑE (z) = I(z)                  I XÃÑE        XÃÑE0                                               (77)


     Solving for these derivatives rst requires determining    ‚Ñ¶ÃÑE . Dierentiating equation (73)
with respect to   E                  i
                        and letting z represent the i
                                                     th element of z yields

                                     Z X                                                        Y
                                                 Œ¥(zÃÉ i (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y i )                     Œπ zÃÉ j (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y j
                                                                                                                                               
 ‚Ñ¶ÃÉE (E, Œò, ‚Ñ¶, Œõ)(y) = ‚àí
                                            i                                                   j6=i

                                          √ó zÃÉEi (Œµ, E, Œò, z, ‚Ñ¶) dPr(Œµ)d‚Ñ¶(z)

which evaluated at        œÉ=0            gives

              Z X                         Y                                                 XZ                             Y
                              i      i                 j        j
‚Ñ¶ÃÑE (y) = ‚àí            Œ¥(z ‚àíy )                  Œπ(z ‚â§ y            )zÃÑEi (z)d‚Ñ¶(z)     =‚àí                   Œ¥(z i ‚àíy i )          Œπ(z j ‚â§ y j )zÃÑEi (z)d‚Ñ¶(z).
                  i                       j6=i                                                   i                         j6=i

                                                                       ‚àÇ nz
The density of    ‚Ñ¶ÃÑE    is given by             œâÃÑE (y) =       ‚àÇy 1 ‚àÇy 2 ¬∑¬∑¬∑‚àÇy nz
                                                                                      ‚Ñ¶ÃÑE (y)   so


                     X ‚àÇ Z Y                               X ‚àÇ
                                 j     j i
                                                                 zÃÑEi (y)œâ(y) .
                                                                             
         œâÃÑE (y) = ‚àí     i
                             Œ¥(z   ‚àí y  ) zÃÑE (z)d‚Ñ¶(z) = ‚àí     i
                      ‚àÇy                                    ‚àÇy
                              i                   j                                                     i


Plugging in for the denition of                      XÃÑE0     we nd


                                                  X ‚àÇ  Z
                              XÃÑE0               ‚àí1
                                                             zÃÑEi (z)œâ(z) dz
                                                                         
                                     = ‚àíD                 i
                                                             R(z)
                                                       ‚àÇz
                                                    i
                                           Z X            
                                        ‚àí1        ‚àÇ
                                     =D               R(z) zÃÑEi (z)œâ(z)dz
                                                 ‚àÇz i
                                             i
                                           Z X
                                     = D‚àí1     (Rzi (z) + Rx (z)xÃÑzi (z)) zÃÑEi d‚Ñ¶(z)
                                                           i
                                                  Z
                                     = D‚àí1 (Rz (z) + Rx (z)xÃÑz (z)) pxÃÑE (z)d‚Ñ¶(z)
                                       Z
                                     ‚â° A(z)xÃÑE (z)d‚Ñ¶(z)                                                                                       (78)



where we arrive at the second equality through integration by parts. This implies

                                                                         Z
                                         ‚àÇ xÃÑ(z) ¬∑ ‚Ñ¶ÃÑE = C(z)                 A(z)xÃÑE (z)d‚Ñ¶(z).                                               (79)




                                                                        10
Substituting for          xÃÑE (z)   using equation (77) in (78) plus

           Z
               Rx (z)xÃÑE (z) + RX (z)XÃÑE + RX+ XÃÑŒò + XÃÑE0 + XÃÑŒõ PXÃÑE + RE (z)d‚Ñ¶(z) = 0
                                                                    


yields a linear system
                                                        h                   i|
                                                   K¬∑       XÃÑE    XÃÑE0          =J                                          (80)


where      K   and   J   are matrices with dimensions given by the number of aggregate variables or

number of aggregate shocks, both of which are small relative to number of agents.

      Finally our last term, the derivative w.r.t                      œÉ.     Since we have the AR(1) parameter of

idiosyncratic shock           œÅŒ∏    scale with    œÉ , FœÉ    is non-zero.

                                                                                                                                  
 Fx‚àí (z)xÃÑœÉ (z) + Fx (z)xÃÑœÉ (z) + Fx+ (z) xÃÑœÉ (z) + xÃÑz (z)pxÃÑœÉ (z) + ‚àÇ xÃÑ(z) ¬∑ ‚Ñ¶ÃÑœÉ + xÃÑŒõ (z)PXÃÑœÉ
 + FX (z)XÃÑœÉ + FœÉ (z) = 0

and
      21

           Z
                                                                              
               Rx (z)xÃÑœÉ (z) + RX (z)XÃÑœÉ + RX+ (z) XÃÑœÉ + ‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑœÉ + XÃÑŒõ PXÃÑœÉ d‚Ñ¶(z) = 0.


Substituting for          ‚àÇ xÃÑ,   we obtain and dening           XÃÑœÉ0 = ‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑœÉ

     Fx‚àí (z)xÃÑœÉ (z) + Fx (z)xÃÑœÉ (z) + Fx+ (z) xÃÑœÉ (z) + xÃÑz (z)pxÃÑœÉ (z) + C(z)XÃÑœÉ0 + xÃÑŒõ (z)PXÃÑœÉ
                                                                                                                              

     + FX (z)XÃÑœÉ + FœÉ (z) = 0,

or
                                                                   h                        i|
                                        L(z)xÃÑœÉ (z) = M(z)             I XÃÑœÉ XÃÑœÉ0                 .                          (81)


Dierentiating with respect to                œÉ   yields

                                      Z X                                                Y
                                              Œ¥(zÃÉ i (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y i )                 Œπ zÃÉ j (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y j
                                                                                                                                  
 ‚Ñ¶ÃÉœÉ (E, Œò, ‚Ñ¶, Œõ)(y) = ‚àí
                                          i                                              j6=i

                                              zÃÉŒµi (Œµ, E, Œò, z, ‚Ñ¶) Œµ          zÃÉœÉi
                                                                                                    
                                        √ó                                 +          (Œµ, E, Œò, z, ‚Ñ¶) dPr(Œµ)d‚Ñ¶(z)

which evaluated at            œÉ=0      gives (as    Œµ   is mean 0)


                                              XZ                     Y
                            ‚Ñ¶ÃÑœÉ (y) = ‚àí              Œ¥(z i ‚àí y i )          Œπ(z j ‚â§ y j )zÃÑœÉi (z)d‚Ñ¶(z).
                                              i                      j6=i

  21 Note, we have dropped all the expectations as they are zero.




                                                                  11
and
                                                          X ‚àÇ
                                                                zÃÑœÉi (y)œâ(y) .
                                                                            
                                        œâÃÑE (y) = ‚àí           i
                                                           ‚àÇy
                                                            i

Plugging in for the denition of             XÃÑœÉ0    we nd

                                            Z
                              XÃÑœÉ0 = D‚àí1         (Rz (z) + Rx (z)xÃÑz (z)) pxÃÑœÉ (z)d‚Ñ¶(z)                                          (82)



Substituting for       xÃÑœÉ (z)   in (82) and

          Z
               Rx (z)xÃÑœÉ (z) + RX (z)XÃÑœÉ + RX+ XÃÑœÉ + XÃÑœÉ0 + XÃÑŒõ PXÃÑœÉ + RœÉ (z)d‚Ñ¶(z) = 0
                                                                    


yields a linear system
                                                      h                i|
                                                 N¬∑       XÃÑœÉ   XÃÑœÉ0        =O                                                   (83)


which is composed of small matrices.




B.6 Second-Order Terms
Here we describe how to compute all the second-order terms required for the Taylor expan-

sion. To save on space, when obvious we drop dependence on                                 z.


B.6.1 Derivatives w.r.t. states
We start by dierentiating with respect to the states                           z   and    ‚Ñ¶.   The term        ‚àÇ xÃÑz (z)   can be

computed by dierentiating              F   w.r.t.    z   and then taking the Frechet derivative with respect

to   ‚Ñ¶   to nd

                                                                                        
0 =Fx‚àí ‚àÇ xÃÑz + Fx ‚àÇ xÃÑz + Fx+ ‚àÇ xÃÑz + xÃÑzŒõ ‚àÇ ŒõÃÑ + Fx‚àíX ¬∑ xÃÑz , ‚àÇ XÃÑ + FxX ¬∑ xÃÑz , ‚àÇ XÃÑ
   + Fx+X ¬∑ xÃÑz , ‚àÇ XÃÑ + Fzx‚àí ¬∑ (I, ‚àÇ xÃÑ) + Fzx ¬∑ (I, ‚àÇ xÃÑ) + FzX ¬∑ I, ‚àÇ XÃÑ + Fzx+ ¬∑ I, ‚àÇ xÃÑ+
                                                                                            

   + Fx‚àíx‚àí ¬∑ (xÃÑz , ‚àÇ xÃÑ) + Fx‚àíx ¬∑ (xÃÑz , ‚àÇ xÃÑ) + Fx‚àíX ¬∑ xÃÑz , ‚àÇ XÃÑ + Fx‚àíx+ ¬∑ xÃÑz , ‚àÇ xÃÑ+
                                                                                         

   + Fxx‚àí ¬∑ (xÃÑz , ‚àÇ xÃÑ) + Fxx ¬∑ (xÃÑz , ‚àÇ xÃÑ) + FxX ¬∑ xÃÑz , ‚àÇ XÃÑ + Fxx+ ¬∑ xÃÑz , ‚àÇ xÃÑ+
                                                                                     

   + Fx+x‚àí ¬∑ (xÃÑz , ‚àÇ xÃÑ) + Fx+x ¬∑ (xÃÑz , ‚àÇ xÃÑ) + Fx+X ¬∑ xÃÑz , ‚àÇ XÃÑ + Fx+x+ ¬∑ xÃÑz , ‚àÇ xÃÑ+
                                                                                         


where     I   represents the identity matrix and we use                    a ¬∑ (b, c)    to denote a bilinear map
                                                                                                                            22   and

‚àÇ xÃÑ+ (z)     ‚â° ‚àÇ xÃÑ(z) + xÃÑŒõ (z)‚àÇ ŒõÃÑ   . This linear system is easily solved to give

                                                                                    
                                                ‚àÇ xÃÑz (z) = Q(z) ¬∑ I, ‚àÇ XÃÑ                                                       (84)

  22 Specically, if     a   is a   n1 √ó n2 √ó n3     tensor,    b   is a   n2 √ó n4      matrix and   c   is a   n3 √ó n5     matrix



                                                                12
where     Q(z) is nx √ó nz √ó nX . The derivatives of xÃÑzz (z), xÃÑzŒõ (z) and xÃÑzŒò (z) are equally easy
as they do not eect aggregates.

      Next, twice dierentiating with respect to                      Œõ   (again with the knowledge that        zÃÑŒõŒõ = 0
and    ‚Ñ¶ÃÑŒõŒõ = 0)   implies



0 =Fx‚àí xÃÑŒõŒõ + Fx xÃÑŒõŒõ + FX XÃÑŒõŒõ + Fx+ xÃÑŒõ PXÃÑŒõŒõ + xÃÑŒõŒõ ŒõÃÑ2Œõ
                                                                                     

      + Fx‚àíx‚àí ¬∑ (xÃÑŒõ, xÃÑŒõ ) + 2Fx‚àíx ¬∑ (xÃÑŒõ , xÃÑŒõ ) + 2Fx‚àíX (xÃÑŒõ , XÃÑŒõ ) + 2Fx‚àíx+ ¬∑ (xÃÑŒõ , xÃÑŒõ ŒõÃÑŒõ ) + 2Fx‚àíŒõ xÃÑŒõ
      + Fxx ¬∑ (xÃÑŒõ , xÃÑŒõ ) + 2FxX ¬∑ (xÃÑŒõ , XÃÑŒõ ) + 2Fxx+ ¬∑ (xÃÑŒõ , xÃÑŒõ ŒõÃÑŒõ ) + 2FxŒõ xÃÑŒõ + FXX ¬∑ (XÃÑŒõ , XÃÑŒõ )
      + 2FXx+ ¬∑ (XÃÑŒõ , xÃÑŒõ ŒõÃÑŒõ ) + 2FXŒõ XÃÑŒõ + Fx+x+ ¬∑ (xÃÑŒõ ŒõÃÑŒõ , xÃÑŒõ ŒõÃÑŒõ ) + 2Fx+Œõ xÃÑŒõ ŒõÃÑŒõ + FŒõŒõ

and

      Z
             Rx (z)xÃÑŒõŒõ (z) + RX (z)XÃÑŒõŒõ + RX+ (z) XÃÑŒõ PXÃÑŒõŒõ + XÃÑŒõŒõ ŒõÃÑ2Œõ + Rxx (z) ¬∑ (xÃÑŒõ (z), xÃÑŒõ (z))
                                                                        
0=
                                                                    
             + 2RxX (z) ¬∑ xÃÑŒõ (z), XÃÑŒõ + 2RxX+ (z) ¬∑ xÃÑŒõ (z), XÃÑŒõ ŒõÃÑŒõ + 2RxŒõ (z)xÃÑŒõ (z)
                                                              
             + RXX (z) ¬∑ XÃÑŒõ , XÃÑŒõ + 2RXX+ (z) ¬∑ XÃÑŒõ , XÃÑŒõ ŒõÃÑŒõ + 2RXŒõ (z)XÃÑŒõ
                                                                     !
                                        
             + RX+X+ ¬∑ XÃÑŒõ ŒõÃÑŒõ , XÃÑŒõ ŒõÃÑŒõ + 2RX+Œõ XÃÑŒõ ŒõÃÑŒõ + RŒõŒõ (z) d‚Ñ¶(z)


From the rst set of equations, we obtain

                                                                          h              i
                                     S(z)xÃÑŒõŒõ (z) = T(z)                      I XÃÑŒõŒõ                                     (85)



which we can then plug into the             R   equation to yield



                                                 U(z)XÃÑŒõŒõ = V(z).                                                        (86)



A identical approach can be used to obtain expressions for                          xÃÑŒòŒò (z), xÃÑŒòŒõ (z), XÃÑŒòŒò   and       XÃÑŒòŒõ
which take the same form.

      Next   ‚àÇ xÃÑŒõ (z) is computed by dierentiating F                    and   R w.r.t Œõ and then taking the Frechet

then   d = a ¬∑ (b, c)   is   n1 √ó n4 √ó n5   tensor dened by

                                                         X
                                                dilm =             aijk bjl ckm .
                                                             j,k

This denition generalizes to when              a, b,   or   c     is innite dimensional, such as with        ‚àÇ xÃÑz .




                                                                 13
derivative with respect to       ‚Ñ¶    to nd (exploiting   ‚àÇ ‚Ñ¶ÃÑŒõ = 0)
                                                                                                  
0 =Fx‚àí ‚àÇ xÃÑŒõ + Fx ‚àÇ xÃÑŒõ + FX ‚àÇ XÃÑŒõ + Fx+ xÃÑŒõ P‚àÇ XÃÑŒõ + ‚àÇ xÃÑŒõ ŒõÃÑŒõ + xÃÑŒõŒõ ¬∑ ŒõÃÑŒõ , ‚àÇ ŒõÃÑ
      + Fx‚àíx‚àí ¬∑ (xÃÑŒõ, ‚àÇ xÃÑ) + Fx‚àíx ¬∑ (xÃÑŒõ , ‚àÇ xÃÑ) + Fx‚àíX (xÃÑŒõ , ‚àÇ XÃÑ) + Fx‚àíx+ ¬∑ (xÃÑŒõ , ‚àÇ xÃÑ+ ) + Fxx‚àí ¬∑ (xÃÑŒõ , ‚àÇ xÃÑ)
      + Fxx ¬∑ (xÃÑŒõ , ‚àÇ xÃÑ) + FxX ¬∑ (xÃÑŒõ , ‚àÇ XÃÑ) + Fxx+ ¬∑ (xÃÑŒõ , ‚àÇ xÃÑ+ ) + FXx‚àí ¬∑ (XÃÑŒõ , ‚àÇ xÃÑ) + FXx ¬∑ (XÃÑŒõ , ‚àÇ xÃÑ)
      + FXx+ ¬∑ (XÃÑŒõ , ‚àÇ xÃÑ+ ) + Fx+x‚àí ¬∑ (xÃÑŒõ ŒõÃÑŒõ , ‚àÇ xÃÑ) + Fx+x ¬∑ (xÃÑŒõ ŒõÃÑŒõ , ‚àÇ xÃÑ) + Fx+X ¬∑ (xÃÑŒõ ŒõÃÑŒõ , ‚àÇ XÃÑ)
      + Fx+x+ ¬∑ (xÃÑŒõ ŒõÃÑŒõ , ‚àÇ xÃÑ+ )

and

      Z
                                                                 
0=            RŒõ (z) + Rx (z)xÃÑŒõ (z) + RX (z)XÃÑŒõ + RX+ (z)XÃÑŒõ ŒõÃÑŒõ Œ¥(z)dz
          Z
                                                                                                             
      +          Rx (z)‚àÇ xÃÑŒõ (z) ¬∑ ‚àÜ + RX+ (z) XÃÑŒõ P‚àÇ XÃÑŒõ ¬∑ ‚àÜ + ‚àÇ XÃÑŒõ ¬∑ ‚àÜŒõÃÑŒõ + XÃÑŒõŒõ ¬∑ ŒõÃÑŒõ , ‚àÇ ŒõÃÑ ¬∑ ‚àÜ

      + RX (z)‚àÇ XÃÑŒõ ¬∑ ‚àÜ + Rxx (z) ¬∑ (xÃÑŒõ (z), ‚àÇ xÃÑ(z) ¬∑ ‚àÜ) + RxX (z) ¬∑ (xÃÑŒõ (z), ‚àÇ XÃÑ ¬∑ ‚àÜ)
      + RxX+ (z) ¬∑ (xÃÑŒõ (z), ‚àÇ XÃÑ + ¬∑ ‚àÜ) + RXx (z) ¬∑ (XÃÑŒõ , ‚àÇ xÃÑ(z) ¬∑ ‚àÜ) + RXX (z) ¬∑ (XÃÑŒõ , ‚àÇ XÃÑ ¬∑ ‚àÜ)
      + RXX+ (z) ¬∑ (XÃÑŒõ , ‚àÇ XÃÑ + ¬∑ ‚àÜ) + RX+x (XÃÑŒõ ŒõÃÑŒõ , ‚àÇ xÃÑ(z) ¬∑ ‚àÜ) + RX+X ¬∑ (XÃÑŒõ ŒõÃÑŒõ , ‚àÇ XÃÑ ¬∑ ‚àÜ)
                                                                                                                   !
      + RX+X+ ¬∑ (XÃÑŒõ ŒõÃÑŒõ , ‚àÇ XÃÑ + ¬∑ ‚àÜ) + RŒõx (z)‚àÇ xÃÑ(z) ¬∑ ‚àÜ + RŒõX (z)‚àÇ XÃÑ ¬∑ ‚àÜ + RŒõX+ (z)‚àÇ XÃÑ + ¬∑ ‚àÜ d‚Ñ¶(z),


where     ‚àÇ XÃÑ + ‚â° ‚àÇ XÃÑ + XÃÑŒõ ‚àÇ ŒõÃÑ.   From   F   equations we immediately obtain

                                                           h                 i|
                                  W(z)‚àÇ xÃÑŒõ (z) = X(z)         ‚àÇ XÃÑŒõ ‚àÇ XÃÑ                                   (87)



which can be plugged into the equations from            R      to obtain

                                 Z
                                                                                          
 Y‚àÇ XÃÑŒõ ¬∑ ‚àÜ = Z‚àÇ XÃÑ ¬∑ ‚àÜ +              RŒõ (z) + Rx (z)xÃÑŒõ (z) + RX (z)XÃÑŒõ + RX+ (z)XÃÑŒõ ŒõÃÑŒõ Œ¥(z)dz.
                                                                                                            (88)

A similar approach can be used to obtain expressions for                ‚àÇ xÃÑŒò (z)   and   ‚àÇ XÃÑŒò   which take the

same form.




                                                      14
     Finally the second-order Frechet derivative of               F   in the directions of   ‚àÜ1    and   ‚àÜ2    yields



0 =Fx‚àí ‚àÇ 2 xÃÑ ¬∑ (‚àÜ1 , ‚àÜ2 ) + Fx ‚àÇ 2 xÃÑ ¬∑ (‚àÜ1 , ‚àÜ2 ) + Fx+ ‚àÇ 2 xÃÑ ¬∑ (‚àÜ1 , ‚àÜ2 ) + FX ‚àÇ 2 XÃÑ ¬∑ (‚àÜ1 , ‚àÜ2 )
   + Fx+ xÃÑŒõ P‚àÇ 2 XÃÑ ¬∑ (‚àÜ1 , ‚àÜ2 ) + xÃÑŒõŒõ ¬∑ ‚àÇ XÃÑ ¬∑ ‚àÜ1 , ‚àÇ XÃÑ ¬∑ ‚àÜ2 + (‚àÇ xÃÑŒõ ¬∑ ‚àÜ1 ) ‚àÇ ŒõÃÑ ¬∑ ‚àÜ2 + (‚àÇ xÃÑŒõ ¬∑ ‚àÜ2 ) ‚àÇ ŒõÃÑ ¬∑ ‚àÜ1
                                                                                                                   

   + Fx‚àíx‚àí ¬∑ (‚àÇ xÃÑ ¬∑ ‚àÜ1 , ‚àÇ xÃÑ ¬∑ ‚àÜ2 ) + Fx‚àíx ¬∑ (‚àÇ xÃÑ ¬∑ ‚àÜ1 , ‚àÇ xÃÑ ¬∑ ‚àÜ2 ) + Fx‚àíx+ ¬∑ ‚àÇ xÃÑ ¬∑ ‚àÜ1 , ‚àÇ xÃÑ+ ¬∑ ‚àÜ2
                                                                                                         
                                       
   + Fx‚àíX ¬∑ ‚àÇ xÃÑ ¬∑ ‚àÜ1 , ‚àÇ XÃÑ ¬∑ ‚àÜ2 + Fxx‚àí ¬∑ (‚àÇ xÃÑ ¬∑ ‚àÜ1 , ‚àÇ xÃÑ ¬∑ ‚àÜ2 ) + Fxx ¬∑ (‚àÇ xÃÑ ¬∑ ‚àÜ1 , ‚àÇ xÃÑ ¬∑ ‚àÜ2 )
   + Fxx+ ¬∑ ‚àÇ xÃÑ ¬∑ ‚àÜ1 , ‚àÇ xÃÑ+ ¬∑ ‚àÜ2 + FxX ¬∑ ‚àÇ xÃÑ ¬∑ ‚àÜ1 , ‚àÇ XÃÑ ¬∑ ‚àÜ2 + Fx+x‚àí ¬∑ ‚àÇ xÃÑ+ ¬∑ ‚àÜ1 , ‚àÇ xÃÑ ¬∑ ‚àÜ2
                                                                                                        

   + Fx+x ¬∑ ‚àÇ xÃÑ+ ¬∑ ‚àÜ1 , ‚àÇ xÃÑ ¬∑ ‚àÜ2 + Fx+x+ ¬∑ ‚àÇ xÃÑ+ ¬∑ ‚àÜ1 , ‚àÇ xÃÑ+ ¬∑ ‚àÜ2 + Fx+X ¬∑ ‚àÇ xÃÑ+ ¬∑ ‚àÜ1 , ‚àÇ XÃÑ ¬∑ ‚àÜ2
                                                                                                          

   + FXx‚àí ¬∑ ‚àÇ XÃÑ ¬∑ ‚àÜ1 , ‚àÇ xÃÑ ¬∑ ‚àÜ2 + FXx ¬∑ ‚àÇ XÃÑ ¬∑ ‚àÜ1 , ‚àÇ xÃÑ ¬∑ ‚àÜ2 + FXx+ ¬∑ ‚àÇ XÃÑ ¬∑ ‚àÜ1 , ‚àÇ xÃÑ+ ¬∑ ‚àÜ2
                                                                                                        
                                      
   + FXX ¬∑ ‚àÇ XÃÑ ¬∑ ‚àÜ1 , ‚àÇ XÃÑ ¬∑ ‚àÜ2

Substituting for         ‚àÇ xÃÑ(z) = C(z)‚àÇ XÃÑ   and   ‚àÇ xÃÑŒõ (z),   and then solving for   ‚àÇ 2 xÃÑ   gives



              ‚àÇ 2 xÃÑ(z) ¬∑ (‚àÜ1 , ‚àÜ2 ) =C(z)‚àÇ 2 XÃÑ ¬∑ (‚àÜ1 , ‚àÜ2 ) + AA1 (z) ¬∑ ‚àÇ XÃÑ ¬∑ ‚àÜ1 , ‚àÇ XÃÑ ¬∑ ‚àÜ2
                                                                                                
                                                                                              
                                      + AA2 (z) ‚àÇ XÃÑŒõ ¬∑ ‚àÜ1 ‚àÇ ŒõÃÑ ¬∑ ‚àÜ2 + ‚àÇ XÃÑŒõ ¬∑ ‚àÜ2 ‚àÇ ŒõÃÑ ¬∑ ‚àÜ1 .                     (89)



     To nd     ‚àÇ 2 XÃÑ   we dierentiate   R   w.r.t   ‚Ñ¶   in the direction   ‚àÜ1   and then      ‚àÜ2   to nd

     Z
0=           Rx (z)‚àÇ 2 xÃÑ(z) ¬∑ (‚àÜ1 , ‚àÜ2 ) + RX (z)‚àÇ 2 XÃÑ ¬∑ (‚àÜ1 , ‚àÜ2 ) + RX+ (z)‚àÇ 2 XÃÑ ¬∑ (‚àÜ1 , ‚àÜ2 )
                                                                                             
     + RX+ (z) XÃÑŒõŒõ (‚àÇ ŒõÃÑ ¬∑ ‚àÜ1 )(‚àÇ ŒõÃÑ ¬∑ ‚àÜ2 ) + ‚àÇ XÃÑŒõ ¬∑ ‚àÜ1 ‚àÇ ŒõÃÑ ¬∑ ‚àÜ2 + ‚àÇ XÃÑŒõ ¬∑ ‚àÜ2 ‚àÇ ŒõÃÑ ¬∑ ‚àÜ1
                                                                                     
     + Rxx (z) ¬∑ (‚àÇ xÃÑ(z) ¬∑ ‚àÜ1 , ‚àÇ xÃÑ(z) ¬∑ ‚àÜ2 ) + RxX (z) ¬∑ ‚àÇ xÃÑ(z) ¬∑ ‚àÜ1 , ‚àÇ XÃÑ ¬∑ ‚àÜ2
     + RxX+ (z) ¬∑ ‚àÇ xÃÑ(z) ¬∑ ‚àÜ1 , ‚àÇ XÃÑ + ¬∑ ‚àÜ2 + RXx (z) ¬∑ ‚àÇ XÃÑ ¬∑ ‚àÜ1 , ‚àÇ xÃÑ(z) ¬∑ ‚àÜ2 + RXX (z) ¬∑ ‚àÇ XÃÑ ¬∑ ‚àÜ1 , ‚àÇ XÃÑ ¬∑ ‚àÜ2
                                                                                                                  

     + RXX+ (z) ¬∑ ‚àÇ XÃÑ ¬∑ ‚àÜ1 , ‚àÇ XÃÑ + ¬∑ ‚àÜ2 + RX+x (z) ¬∑ ‚àÇ XÃÑ + ¬∑ ‚àÜ1 , ‚àÇ xÃÑ(z) ¬∑ ‚àÜ2
                                                                                        
                                                                                             !
     + RX+X (z) ¬∑ ‚àÇ XÃÑ + ¬∑ ‚àÜ1 , ‚àÇ XÃÑ ¬∑ ‚àÜ2 + RX+X+ (z) ¬∑ ‚àÇ XÃÑ + ¬∑ ‚àÜ1 , ‚àÇ XÃÑ + ¬∑ ‚àÜ2 d‚Ñ¶(z)
                                                                                          

         Z
              Rx (z)‚àÇ xÃÑ(z) ¬∑ ‚àÜ1 + RX (z)‚àÇ XÃÑ ¬∑ ‚àÜ1 + RX+ (z)‚àÇ XÃÑ + ¬∑ ‚àÜ1 d‚àÜ2 (z)
                                                                       
     +
         Z
              Rx (z)‚àÇ xÃÑ(z) ¬∑ ‚àÜ2 + RX (z)‚àÇ XÃÑ ¬∑ ‚àÜ2 + RX+ (z)‚àÇ XÃÑ + ¬∑ ‚àÜ2 d‚àÜ1 (z)
                                                                       
     +




                                                           15
A bit of rearranging and substituting for                    ‚àÇ 2 xÃÑ   yields

                            Z
    2
                                    Rx (z)‚àÇ xÃÑ(z) ¬∑ ‚àÜ1 + RX (z)‚àÇ XÃÑ ¬∑ ‚àÜ1 + RX+ (z)‚àÇ XÃÑ + ¬∑ ‚àÜ1 d‚àÜ2 (z)
                                                                                             
D‚àÇ XÃÑ ¬∑ (‚àÜ1 , ‚àÜ2 ) =
                                Z
                                 Rx (z)‚àÇ xÃÑ(z) ¬∑ ‚àÜ2 + RX (z)‚àÇ XÃÑ ¬∑ ‚àÜ2 + RX+ (z)‚àÇ XÃÑ + ¬∑ ‚àÜ2 d‚àÜ1 (z)
                                                                                          
                            +
                                                                                                
                            + BB ¬∑ ‚àÇ XÃÑ ¬∑ ‚àÜ1 , ‚àÇ XÃÑ ¬∑ ‚àÜ2 + CC ‚àÇ XÃÑŒõ ¬∑ ‚àÜ2 ‚àÇ ŒõÃÑ ¬∑ ‚àÜ1 + CC ‚àÇ XÃÑŒõ ¬∑ ‚àÜ1 ‚àÇ ŒõÃÑ ¬∑ ‚àÜ2 .
                                                                                                                (90)



B.6.2 Derivatives w.r.t. shocks
Next we proceed by taking derivatives w.r.t.                             œÉ   and then use the method of undeter-

mined coecients to nd the derivatives associated with each pair of shocks. Solving for

xÃÑŒµŒµ , xÃÑŒµŒò , xÃÑŒµŒõ , xÃÑŒµœÉ   and     xÃÑŒµE   are trivial as these interactions do not eect aggregates so we

omit those formulas them for brevity.

     For    xÃÑEŒõ   we see (after dening             xÃÑ+
                                                       E = xÃÑŒò + xÃÑz zÃÑE + ‚àÇ xÃÑ ¬∑ ‚Ñ¶ÃÑE + xÃÑŒõ ŒõÃÑE )

                                                                                                               
0 =Fx xÃÑEŒõ + FX XÃÑEŒõ + Fx+ xÃÑŒòŒõ ŒõÃÑŒõ + xÃÑzŒõ xÃÑE ŒõÃÑŒõ + ‚àÇ xÃÑŒõ ¬∑ ‚Ñ¶ÃÑE ŒõÃÑŒõ + xÃÑz pxÃÑEŒõ + ‚àÇ xÃÑ ¬∑ ‚Ñ¶ÃÑEŒõ
        + Fx+ xÃÑŒõ PXÃÑEŒõ + Fxx‚àí ¬∑ (xÃÑE , xÃÑŒõ ) + Fxx ¬∑ (xÃÑE , xÃÑŒõ ) + FxX ¬∑ (xÃÑE , XÃÑŒõ ) + Fxx+ ¬∑ (xÃÑE , xÃÑŒõ ŒõÃÑŒõ ) + FxŒõ xÃÑE
        + FXx‚àí ¬∑ (XÃÑE , xÃÑŒõ ) + FXx ¬∑ (XÃÑE , xÃÑŒõ ) + FXx+ ¬∑ (XÃÑE , xÃÑŒõ ŒõÃÑŒõ ) + FXŒõ XÃÑŒõ + Fx+x‚àí ¬∑ (xÃÑ+
                                                                                                    E , xÃÑŒõ )

        + Fx+x ¬∑ (xÃÑ+                     +                      +                       +
                    E , xÃÑŒõ ) + Fx+X ¬∑ (xÃÑE , XÃÑŒõ ) + Fx+x+ ¬∑ (xÃÑE , xÃÑŒõ ŒõÃÑŒõ ) + Fx+Œõ (xÃÑE )

        + FEx‚àí xÃÑŒõ + FEx xÃÑŒõ + FEX XÃÑŒõ + FEx+ xÃÑŒõ ŒõÃÑŒõ + FEŒõ

Most of these terms are already known, but there are a few that are new and need to be

computed:       ‚àÇ xÃÑ ¬∑ ‚Ñ¶ÃÑEŒõ   and    ‚àÇ xÃÑŒõ ¬∑ ‚Ñ¶ÃÑE .   For the rst,
                                                                                                              0 .
                                                                        ‚àÇ xÃÑ ¬∑ ‚Ñ¶ÃÑEŒõ = C(z)‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑEŒõ ‚â° C(z)XÃÑEŒõ    For

the second, we have



                        ‚àÇ xÃÑŒõ (z) ¬∑ ‚Ñ¶ÃÑE = Y(z)‚àí1 z1 (z)‚àÇ XÃÑŒõ ¬∑ ‚Ñ¶ÃÑE + Y(z)‚àí1 z2 (z)XE0

where

                                           Z
‚àÇ XÃÑŒõ ¬∑ ‚Ñ¶ÃÑE = Y‚àí1 ZXE0 + Y‚àí1
                                                                                                  
                                               RŒõ (z) + Rx (z)xÃÑŒõ (z) + RX (z)XÃÑŒõ + RX+ (z)XÃÑŒõ ŒõÃÑŒõ œâÃÑE (z)dz
                                           Z
                                              ‚àÇ           ‚àÇ
               = Y‚àí1 ZXE0 + Y‚àí1                 RŒõ (z) +    RŒõ (z)xÃÑŒò (z) + RŒõ (z)xÃÑŒòz (z)
                                             ‚àÇz          ‚àÇz
                                                                               !
                                       ‚àÇ               d
                                    +    RX (z)XÃÑŒõ +     RX+ (z)XÃÑŒõ ŒõÃÑŒõ zÃÑE (z) œâ(z)dz
                                      ‚àÇz              dz




                                                                 16
where the last term is easily computable from known terms.
                                                                                        23    Thus, we can show that the

derivative   xÃÑEŒõ   solves the following system of equations

                                                                    h                         i
                              DD(z)xÃÑEŒõ = EE(z)                                  0
                                                                        I XÃÑEŒõ XÃÑEŒõ               .                       (91)



   To determine
                                 0 , proceed in the same manner as the rst-order terms.
                      XÃÑEŒõ and XÃÑEŒõ                                                                                     Recall

we had,

                              Z X                                                    Y
                                              Œ¥(zÃÉ i (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y i )             Œπ zÃÉ j (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y j
                                                                                                                              
 ‚Ñ¶ÃÉE (E, Œò, ‚Ñ¶, Œõ)(y) = ‚àí
                                      i                                              j6=i

                                   √ó      zÃÉEi    (Œµ, E, Œò, z, ‚Ñ¶) dPr(Œµ)d‚Ñ¶(z),

and thus

                              Z X                                                    Y
                                              Œ¥(zÃÉ i (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y i )             Œπ zÃÉ j (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y j
                                                                                                                              
‚Ñ¶ÃÉEŒõ (E, Œò, ‚Ñ¶, Œõ)(y) = ‚àí
                                    i                                                j6=i
                                        i
                                  √ó   zÃÉEŒõ (Œµ, E, Œò, z, ‚Ñ¶, Œõ) dPr(Œµ)d‚Ñ¶(z)
                              Z         X                                                Y
                                                  Œ¥ 0 (zÃÉ i (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y i )          Œπ zÃÉ j (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y j
                                                                                                                                  
                          ‚àí
                                              i                                          j6=i
                                                                                                          !
                                              √ó   zÃÉEi   (Œµ, E, Œò, z, ‚Ñ¶, Œõ) zÃÉŒõi (Œµ, E, Œò, z, ‚Ñ¶, Œõ)           dPr (Œµ) d‚Ñ¶(z)

                              Z         XX
                          +                              Œ¥(zÃÉ i (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y i )Œ¥(zÃÉ j (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y j )
                                              i   j6=i
                                  Y                              
                                   Œπ zÃÉ k (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y k zÃÉEi (Œµ, E, Œò, z, ‚Ñ¶, Œõ)
                                  k6=i,j
                                                                                
                                              √ó   zÃÉŒõi (Œµ, E, Œò, z, ‚Ñ¶, Œõ)        dPr (Œµ) d‚Ñ¶(z)


Evaluating this term at       œÉ=0             and exploiting        zÃÑŒõ (z) = 0    we have


                                      XZ                            Y
                       ‚Ñ¶ÃÑEŒõ = ‚àí                     Œ¥(z i ‚àí y i )          Œπ(z j ‚â§ y j )zÃÑEŒõ
                                                                                          i
                                                                                             (z)d‚Ñ¶(z)
                                          i                         j6=i

  23 For compactness we have not expanded terms like ‚àÇ R (z), but this is easily accom-
                                                           ‚àÇz Œõ
                      ‚àÇ
plished. For example
                     ‚àÇz RŒõ (z) = R Œõz (z) + R Œòx (z) xÃÑŒõ (z) .




                                                                  17
and thus

                     X ‚àÇ Z Y                                X ‚àÇ
                                 j     j i                           i
                                                                               
        œâÃÑEŒõ (y) = ‚àí         Œ¥(z   ‚àí y  ) zÃÑEŒõ (z)d‚Ñ¶(z) = ‚àí       zÃÑ EŒõ (y)œâ(y)
                      ‚àÇy i                                   ‚àÇy i
                          i             j                                         i


and hence

                                            ZX ‚àÇ
                           0           ‚àí1                  i
                                                                     
                         XÃÑEŒõ   = ‚àíD             R(z)   zÃÑEŒõ (z)œâ(z)   dz
                                                  ‚àÇz i
                                               i
                                      Z X            
                                   ‚àí1        ‚àÇ             i
                                =D               R(z) zÃÑEŒõ   (z)œâ(z)dz
                                            ‚àÇz i
                                        i
                                      Z X
                                = D‚àí1                                  i
                                          (Rzi (z) + Rx (z)xÃÑzi (z)) zÃÑEŒõ d‚Ñ¶(z)
                                                i
                                        Z
                                = D‚àí1        (Rz (z) + Rx (z)xÃÑz (z)) qxÃÑEŒõ (z)d‚Ñ¶(z)


which combined with the second derivative of                  R   w.r.t.   EŒõ   (dening   XÃÑE+ = XÃÑŒò + XÃÑE0 +
XÃÑŒõ ŒõÃÑE )


Z
                                                                                     0
                                                                                                                   
     Rx (z)xÃÑEŒõ (z) + RX (z)XÃÑEŒõ + RX+ (z) XÃÑŒòŒõ ŒõÃÑŒõ + ‚àÇ XÃÑŒõ ¬∑ ‚Ñ¶ÃÑE + XÃÑŒõŒõ ŒõÃÑŒõ ŒõÃÑE + XÃÑEŒõ + XÃÑŒõ PXÃÑEŒõ
                                                                                      
      + Rxx (z) ¬∑ (xÃÑE (z), xÃÑŒõ (z)) + RxX (z) ¬∑ xÃÑE (z), XÃÑŒõ + RxX+ ¬∑ xÃÑE (z), XÃÑŒõ ŒõÃÑŒõ + RxŒõ (z)xÃÑE (z)
                                                                                   
      + RXx (z) ¬∑ XÃÑE , xÃÑŒõ (z) + RXX (z) ¬∑ XÃÑE , XÃÑŒõ + RXX+ (z) ¬∑ XÃÑE , XÃÑŒõ ŒõÃÑŒõ + RXŒõ (z)XÃÑE
      + RX+x (z) ¬∑ XÃÑE+ , xÃÑŒõ (z) + RX+X (z) ¬∑ XÃÑE+ , XÃÑŒõ + RX+X+ (z) ¬∑ XÃÑE+ , XÃÑŒõ ŒõÃÑŒõ + RX+Œõ (z)XÃÑE+
                                                                                       
                                                                   !
      + REx (z)xÃÑŒõ (z) + REX (z)XÃÑŒõ + REX+ (z)XÃÑŒõ ŒõÃÑŒõ + REŒõ (z) d‚Ñ¶(z) = 0


gives a linear relationship
                                                 h                i
                                            FF              0
                                                     XÃÑEŒõ XÃÑEŒõ        = GG                                 (92)


to solve for   XÃÑEŒõ .   A similar approach can be used to obtain expressions for                xÃÑEŒò (z), XÃÑEŒò ,
xÃÑœÉŒò (z), XÃÑœÉŒò , xÃÑœÉŒõ (z),    and   XÃÑœÉŒõ ,   which take the same form.




                                                         18
     For   xÃÑEE   we see


                                                                                                                    
0 =Fx xÃÑEE + FX XÃÑEE + Fx+ xÃÑz pxÃÑEE + ‚àÇ xÃÑ ¬∑ ‚Ñ¶ÃÑEE + xÃÑŒõ PXÃÑEE + xÃÑŒòŒò + xÃÑŒòz ¬∑ (I, zÃÑE ) + ‚àÇ xÃÑŒò ¬∑ I, ‚Ñ¶ÃÑE
                                                                                                                    
     + xÃÑŒòŒõ ¬∑ I, ŒõÃÑE + xÃÑzz ¬∑ (zÃÑE , zÃÑE ) + xÃÑzŒò ¬∑ (zÃÑE , I) + ‚àÇ xÃÑz ¬∑ zÃÑE , ‚Ñ¶ÃÑE + xÃÑzŒõ ¬∑ zÃÑE , ŒõÃÑE + ‚àÇ xÃÑŒò ¬∑ ‚Ñ¶ÃÑE , I
     + ‚àÇ xÃÑz ¬∑ ‚Ñ¶ÃÑE , zÃÑE + ‚àÇ xÃÑŒò ¬∑ ‚Ñ¶ÃÑE , I + ‚àÇ xÃÑz ¬∑ ‚Ñ¶ÃÑE , zÃÑE + ‚àÇ 2 xÃÑ ¬∑ (‚Ñ¶ÃÑE , ‚Ñ¶ÃÑE ) + ‚àÇ xÃÑŒõ ¬∑ ‚Ñ¶ÃÑE , ŒõÃÑE
                                                                                                        
                                                                                       !
                                                             
     + xÃÑŒõŒò ¬∑ ŒõÃÑE , I + xÃÑŒõz ¬∑ ŒõÃÑE , zÃÑE + ‚àÇ xÃÑŒõ ¬∑ ŒõE , ‚Ñ¶ÃÑE + xÃÑŒõŒõ ¬∑ (ŒõE , ŒõE ) + Fxx ¬∑ (xÃÑE , xÃÑE )

     + FxX ¬∑ xÃÑE , XÃÑE + Fxx+ ¬∑ xÃÑE , xÃÑ+
                                                                                              
                                         E + FxE ¬∑ (xÃÑE , I) + FXx ¬∑ XÃÑE , xÃÑE + FXX ¬∑ XÃÑE , XÃÑE

     + FXx+ ¬∑ XÃÑE , xÃÑ+                                +                     +                  +  +
                                                                                                 
                       E + FXE ¬∑ XÃÑE , I + Fx+x ¬∑ xÃÑE , xÃÑE + Fx+X ¬∑ xÃÑE , XÃÑE + Fx+x+ ¬∑ xÃÑE , xÃÑE

     + Fx+E ¬∑ xÃÑ+                                                     +
                                                                      
                E , I + FEx ¬∑ (I, xÃÑE ) + FEX ¬∑ I, XÃÑE + FEx+ ¬∑ I, xÃÑE + FEE


     Once again, almost all of these terms are already known with the exception of                      ‚àÇ 2 xÃÑ ¬∑
(‚Ñ¶ÃÑE , ‚Ñ¶ÃÑE )   which is computable from the expressions for          ‚àÇ 2 XÃÑ   above and   ‚àÇ xÃÑ ¬∑ ‚Ñ¶ÃÑEE   which

equals
                                                                      0
                             ‚àÇ xÃÑ(z) ¬∑ ‚Ñ¶ÃÑEE = C(z)‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑEE = C(z)XÃÑEE .

Thus, we have that
                                                        h                     i|
                             H(z)xÃÑEE (z) = HH(z)           I XÃÑEE     0
                                                                     XÃÑEE          ,                     (93)


where    H(z) is the same as in the rst-order expansion equation (80) and HH(z) is computable
from the rst-order terms.

     To solve for    XÃÑEE   and
                                    0
                                  XÃÑEE   we rst need   ‚Ñ¶ÃÑEE   which we nd by dierentiating the law




                                                    19
of motion for   ‚Ñ¶   to get

                                 Z X                                                         Y
                                            Œ¥(zÃÉ i (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y i )                       Œπ zÃÉ j (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y j
                                                                                                                                      
‚Ñ¶ÃÉEE (E, Œò, ‚Ñ¶, Œõ)(y) = ‚àí
                                        i                                                    j6=i
                                         i
                                     √ó zÃÉEE (Œµ, E, Œò, z, ‚Ñ¶, Œõ) dPr(Œµ)d‚Ñ¶(z)
                                 Z          X                                                     Y
                                                 Œ¥ 0 (zÃÉ i (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y i )                    Œπ zÃÉ j (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y j
                                                                                                                                           
                             ‚àí
                                            i                                                     j6=i
                                                                                                                   !
                                                √ó   zÃÉEi   (Œµ, E, Œò, z, ‚Ñ¶, Œõ) zÃÉEi         (Œµ, E, Œò, z, ‚Ñ¶, Œõ) dPr (Œµ) d‚Ñ¶(z)
                                 Z XX
                             +                             Œ¥(zÃÉ i (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y i )Œ¥(zÃÉ j (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y j )
                                            i       j6=i
                                                     Y                              
                                                √ó     Œπ zÃÉ k (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y k zÃÉEj (Œµ, E, Œò, z, ‚Ñ¶, Œõ)
                                                    k6=i,j
                                                                                                              !
                                                √ó zÃÉEi (Œµ, E, Œò, z, ‚Ñ¶, Œõ) dPr (Œµ) d‚Ñ¶(z) .


Evaluated at    œÉ = 0,   this becomes

                         Z X                               Y
       ‚Ñ¶ÃÑEE (y) = ‚àí                  Œ¥(z i ‚àí y i )                Œπ(z j ‚àí y j )zÃÑEE
                                                                                 i
                                                                                    (z)d‚Ñ¶(z)
                                 i                         j6=i
                         Z X                               Y                            2
                                     Œ¥ 0 (z i ‚àí y i )             Œπ(z j ‚àí y j ) zÃÑEi (z) d‚Ñ¶(z)
                                                                               
                     ‚àí
                                 i                         j6=i
                         Z X
                                                                                           Œπ(z k ‚àí y k )zÃÑEj (z)zÃÑEi (z)d‚Ñ¶(z)
                                                           X                      Y
                     +               Œ¥(z i ‚àí y i )                Œ¥(z j ‚àí y j )
                                 i                         j6=i                   k6=i,j


and


                  ‚àÇ nz                      X ‚àÇ                              Z Y
œâÃÑEE (y) =     1  2        n
                              ‚Ñ¶ÃÑ EE (y) = ‚àí                                           Œ¥(z j ‚àí y j )zÃÑEE
                                                                                                     i
                                                                                                        (z)d‚Ñ¶(z)
             ‚àÇy ‚àÇy ¬∑ ¬∑ ¬∑ ‚àÇy z                ‚àÇy i
                                                                  i               j
                                                             X ‚àÇ Z                    Y                           2
                                                                          0 i     i
                                                           ‚àí      i
                                                                        Œ¥  (z ‚àí y   )      Œ¥(z j ‚àí y j ) zÃÑEi (z) d‚Ñ¶(z)
                                                               ‚àÇy
                                                             i                        j6=i
                                                             X X ‚àÇ2 Z Y
                                                           +                          Œ¥(z j ‚àí y j )zÃÑEj (z)zÃÑEi d‚Ñ¶(z)
                                                                    ‚àÇy i ‚àÇy j
                                                                  i   j6=i                    j
                                                              X ‚àÇ
                                                                       i
                                                                                 X X ‚àÇ2  i               j
                                                                                                                    
                                                      =‚àí            zÃÑ   (y)œâ(y) +             zÃÑ   (y) zÃÑ   (y)œâ(y)  .
                                                               ‚àÇy i EE               ‚àÇy i ‚àÇy j    E       E
                                                                  i                                       i    j




                                                                       20
Thus,

                    Ô£´                                                           Ô£∂
          Z            X ‚àÇ                        ‚àÇ 2                        
                                                          zÃÑEi (z)zÃÑEj (z)œâ(z) Ô£∏ dz
                                            X X
  0                            i
                                         
XÃÑEE =         R(z) Ô£≠‚àí     i
                             zÃÑEE (z)œâ(z) +       i   j
                        ‚àÇz                      ‚àÇz ‚àÇz
                          i                                 i    j
          Z
      =     (Rz (z) + Rx (z)xÃÑz (z)) pxÃÑiEE (z)œâ(z)dz
            Z                                                                                           
          +      Rzz (z) + Rxz (z) ¬∑ (I, xÃÑz (z)) + Rzx (z) ¬∑ (xÃÑz (z), I) + Rxx (z) ¬∑ (xÃÑz (z), xÃÑz (z))

                 ¬∑ (pxÃÑE (z), pxÃÑE (z)) œâ(z)dz

which when combined with the second derivative of                     R    w.r.t    EE
     Z            
           RX+ (z) XÃÑŒòŒò + ‚àÇ XÃÑŒò ¬∑ I, ‚Ñ¶ÃÑE + XÃÑŒòŒõ ¬∑ I, ŒõÃÑE + ‚àÇ XÃÑŒò ¬∑ ‚Ñ¶ÃÑE , I + ‚àÇ 2 XÃÑ ¬∑ ‚Ñ¶ÃÑE , ‚Ñ¶ÃÑE
                                                                                             
0=
                                                                                                                           !
                                                                                    0
              + ‚àÇ XÃÑŒõ ¬∑ ‚Ñ¶ÃÑE , ŒõE + XÃÑŒõŒò ¬∑ ŒõÃÑE , I + ‚àÇ XÃÑŒõ ¬∑ ŒõÃÑE , I + XÃÑŒõŒõ ŒõÃÑ2E + XÃÑEE
                                                                                 
                                                                                       + XÃÑŒõ PXÃÑEE
                                                                                                                     
              + Rx (z)xÃÑEE (z) + RX (z)XÃÑEE + Rxx (z) ¬∑ (xÃÑE (z), xÃÑE (z)) + RxX (z) ¬∑ xÃÑE (z), XÃÑE
              + RxX+ (z) ¬∑ xÃÑE (z), XÃÑE+ + RxE (z) ¬∑ (xÃÑE (z), I) + RXx (z) ¬∑ XÃÑE , xÃÑE (z)
                                                                                          

              + RXX (z) ¬∑ XÃÑE , XÃÑE + RXX+ (z) ¬∑ XÃÑE , XÃÑE+ + RXE (z) ¬∑ XÃÑE , I
                                                                                   

              + RX+x (z) ¬∑ XÃÑE+ , xÃÑE (z) + RX+X (z) ¬∑ XÃÑE+ , XÃÑE + RX+X+ (z) ¬∑ XÃÑE+ , XÃÑE+
                                                                                              

              + RX+E (z) ¬∑ XÃÑE+ , I + REx (z) ¬∑ (I, xÃÑE (z)) + REX (z) ¬∑ I, XÃÑE
                                                                               
                                              !
              + REX+ (z) ¬∑ I, XÃÑE+ + REE (z) d‚Ñ¶(z)
                                    



gives a system of linear equations of the form

                                             h                       i|
                                        K¬∑       XÃÑEE         0
                                                            XÃÑEE          = II.                                     (94)



A similar approach can be used to obtain expressions for                          xÃÑEœÉ (z)   and   XÃÑEœÉ   which take the

same form.

     Finally, for the second-order expansion we need the eect of the presence of risk. Dier-




                                                            21
entiation of        F   gives, after dening   xÃÑ+
                                                 œÉ = xÃÑz zÃÑœÉ + ‚àÇ xÃÑ ¬∑ ‚Ñ¶ÃÑœÉ + xÃÑŒõ ŒõÃÑœÉ + xÃÑœÉ ,
                                                                                                                           !
0 =Fx xÃÑœÉœÉ + FX XÃÑœÉœÉ + Fx+ E [xÃÑŒµŒµ ¬∑ (Œµ, Œµ) + xÃÑEE ¬∑ (E, E)] + xÃÑz pxÃÑœÉœÉ + ‚àÇ xÃÑ ¬∑ ‚Ñ¶ÃÑœÉœÉ + xÃÑŒõ PXÃÑœÉœÉ


       + Fx+ xÃÑzz ¬∑ (zÃÑœÉ , zÃÑœÉ ) + 2‚àÇ xÃÑz ¬∑ (‚Ñ¶ÃÑœÉ , zÃÑœÉ ) + 2xÃÑzŒõ ¬∑ (zÃÑœÉ , ŒõÃÑœÉ ) + 2xÃÑzœÉ zÃÑœÉ + ‚àÇ 2 xÃÑ ¬∑ (‚Ñ¶ÃÑœÉ , ‚Ñ¶ÃÑœÉ )
                                                                                               !
       + 2‚àÇ xÃÑŒõ ¬∑ (‚Ñ¶ÃÑœÉ , ŒõÃÑœÉ ) + 2‚àÇ xÃÑœÉ ¬∑ ‚Ñ¶ÃÑœÉ + xÃÑŒõŒõ ¬∑ (ŒõÃÑœÉ , ŒõÃÑœÉ ) + 2xÃÑŒõœÉ ŒõÃÑœÉ + xÃÑœÉœÉ             + Fx‚àíx‚àí ¬∑ (xÃÑœÉ, xÃÑœÉ )

       + 2Fx‚àíx ¬∑ (xÃÑœÉ , xÃÑœÉ ) + 2Fx‚àíX (xÃÑœÉ , XÃÑœÉ ) + 2Fx‚àíx+ ¬∑ (xÃÑœÉ , xÃÑ+
                                                                       œÉ ) + 2Fx‚àíœÉ xÃÑœÉ

       + Fxx ¬∑ (xÃÑœÉ , xÃÑœÉ ) + 2FxX ¬∑ (xÃÑœÉ , XÃÑœÉ ) + 2Fxx+ ¬∑ (xÃÑœÉ , xÃÑ+
                                                                     œÉ ) + 2FxœÉ xÃÑœÉ + FXX ¬∑ (XÃÑœÉ , XÃÑœÉ )

       + 2FXx+ ¬∑ (XÃÑœÉ , xÃÑ+                           +     +             +
                          œÉ ) + 2FXœÉ XÃÑœÉ + Fx+x+ ¬∑ (xÃÑœÉ , xÃÑœÉ ) + 2Fx+œÉ xÃÑœÉ + FœÉœÉ

       + Fx‚àí E [xÃÑœÉœÉ + xÃÑŒµŒµ ¬∑ (Œµ, Œµ) + xÃÑEE ¬∑ (E, E)] = 0.

or
  24

                                                                                                                       !
0 =Fx xÃÑœÉœÉ + FX XÃÑœÉœÉ + Fx+ xÃÑŒµŒµ ¬∑ var(Œµ) + xÃÑEE ¬∑ var(E) + xÃÑz pxÃÑœÉœÉ + ‚àÇ xÃÑ ¬∑ ‚Ñ¶ÃÑœÉœÉ + xÃÑŒõ PXÃÑœÉœÉ


       + Fx+ xÃÑzz ¬∑ (zÃÑœÉ , zÃÑœÉ ) + 2‚àÇ xÃÑz ¬∑ (‚Ñ¶ÃÑœÉ , zÃÑœÉ ) + 2xÃÑzŒõ ¬∑ (zÃÑœÉ , ŒõÃÑœÉ ) + 2xÃÑzœÉ zÃÑœÉ + ‚àÇ 2 xÃÑ ¬∑ (‚Ñ¶ÃÑœÉ , ‚Ñ¶ÃÑœÉ )
                                                                                               !
       + 2‚àÇ xÃÑŒõ ¬∑ (‚Ñ¶ÃÑœÉ , ŒõÃÑœÉ ) + 2‚àÇ xÃÑœÉ ¬∑ ‚Ñ¶ÃÑœÉ + xÃÑŒõŒõ ¬∑ (ŒõÃÑœÉ , ŒõÃÑœÉ ) + 2xÃÑŒõœÉ ŒõÃÑœÉ + xÃÑœÉœÉ

       + Fx‚àíx‚àí ¬∑ (xÃÑœÉ, xÃÑœÉ ) + 2Fx‚àíx ¬∑ (xÃÑœÉ , xÃÑœÉ ) + 2Fx‚àíX (xÃÑœÉ , XÃÑœÉ ) + 2Fx‚àíx+ ¬∑ (xÃÑœÉ , xÃÑ+
                                                                                             œÉ ) + 2Fx‚àíœÉ xÃÑœÉ

       + Fxx ¬∑ (xÃÑœÉ , xÃÑœÉ ) + 2FxX ¬∑ (xÃÑœÉ , XÃÑœÉ ) + 2Fxx+ ¬∑ (xÃÑœÉ , xÃÑ+
                                                                     œÉ ) + 2FxœÉ xÃÑœÉ + FXX ¬∑ (XÃÑœÉ , XÃÑœÉ )

       + 2FXx+ ¬∑ (XÃÑœÉ , xÃÑ+                           +     +             +
                          œÉ ) + 2FXœÉ XÃÑœÉ + Fx+x+ ¬∑ (xÃÑœÉ , xÃÑœÉ ) + 2Fx+œÉ xÃÑœÉ + FœÉœÉ

       + Fx‚àí [xÃÑœÉœÉ + xÃÑŒµŒµ ¬∑ var(Œµ) + xÃÑEE ¬∑ var(E)]

       Dening
                                                              0 ,
                     ‚àÇ xÃÑ(z) ¬∑ ‚Ñ¶ÃÑœÉœÉ = C(z)‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑœÉœÉ ‚â° C(z)XÃÑœÉœÉ        we nd that           xÃÑœÉœÉ (z)   solves the linear

system
                                                             h                       i|
                                    JJ(z)xÃÑœÉœÉ (z) = KK(z)                 0
                                                                 I XÃÑœÉœÉ XÃÑœÉœÉ              .                          (95)


  24 Recall          xÃÑŒµŒµ is    a 3-dimensional tensor.      We dene       xÃÑŒµŒµ ¬∑   var(Œµ) by the contraction
P
     jk [xÃÑ ŒµŒµ ]ijk var (Œµ)jk




                                                          22
To solve for
                 0
               XÃÑœÉœÉ   we need to nd               ‚Ñ¶ÃÑœÉœÉ    by dierentiating the law of motion for                 ‚Ñ¶ 25
                                Z         X                                              Y
                                                  Œ¥(zÃÉ i (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y i )              Œπ zÃÉ j (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y j
                                                                                                                                     
‚Ñ¶ÃÉœÉœÉ (E, Œò, ‚Ñ¶, Œõ)(y) = ‚àí
                                           i                                             j6=i
                                                                                                                                 !
                                                           i                                  i
                                                                                                                             
                                                         zÃÉŒµŒµ (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ¬∑ (Œµ, Œµ) + zÃÉœÉœÉ (Œµ, E, Œò, z, ‚Ñ¶, Œõ)                  dPr(Œµ)d‚Ñ¶(z)

                                Z         X                                                 Y
                                                  Œ¥ 0 (zÃÉ i (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y i )             Œπ zÃÉ j (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y j
                                                                                                                                     
                           ‚àí
                                           i                                                j6=i


                                                 zÃÉŒµi (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ŒµzÃÉŒµi (Œµ, E, Œò, z, ‚Ñ¶, Œõ) Œµ
                                                                                                                  !!
                                                     + zÃÉœÉi (Œµ, E, Œò, z, ‚Ñ¶, Œõ) zÃÉœÉi (Œµ, E, Œò, z, ‚Ñ¶, Œõ)                dPr (Œµ) d‚Ñ¶(z)
                                Z XX
                           ‚àí                             Œ¥(zÃÉ i (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y i )Œ¥(zÃÉ j (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚àí y j )
                                           i      j6=i
                                        Y                             
                                             k                       k
                                         Œπ zÃÉ (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ‚â§ y     zÃÉŒµj (Œµ, E, Œò, z, ‚Ñ¶, Œõ) ŒµzÃÉŒµi (Œµ, E, Œò, z, ‚Ñ¶, Œõ) Œµ
                                    k6=i,j
                                                                                             !
                                             zÃÉœÉj (Œµ, E, Œò, z, ‚Ñ¶, Œõ) zÃÉœÉi (Œµ, E, Œò, z, ‚Ñ¶, Œõ)   dPr (Œµ) d‚Ñ¶(z)


Evaluating at   œÉ=0        we nd

               Z X                        Y
                       Œ¥(z i ‚àí y i )             Œπ(z j ‚àí y j ) zÃÑœÉœÉ
                                                                 i          i
                                                                                       
‚Ñ¶ÃÑœÉœÉ (y) = ‚àí                                                        (z) + zÃÑŒµŒµ ¬∑ var(Œµ) d‚Ñ¶(z)
                  i                       j6=i
               Z X                        Y                             2                  2
                       Œ¥ 0 (z i ‚àí y i )           Œπ(z j ‚àí y j ) zÃÑŒµi (z) ¬∑ var(Œµ) + zÃÑœÉi (z) d‚Ñ¶(z)
                                                                                  
          ‚àí
                  i                        j6=i
               Z X                        X                       Y
                       Œ¥(z i ‚àí y i )              Œ¥(z j ‚àí y j )            Œπ(z k ‚àí y k ) zÃÑŒµj (z)zÃÑŒµi (z) ¬∑ var(Œµ) + zÃÑœÉj (z)zÃÑœÉi (z)d‚Ñ¶(z)
                                                                                                         
          +
                  i                       j6=i                    k6=i,j


which gives

                           X ‚àÇ
                                                 i          i
                                                                               
         œâÃÑœÉœÉ (y) = ‚àí                          zÃÑœÉœÉ (y) + zÃÑŒµŒµ (y) ¬∑ var(Œµ) œâ(y)
                            ‚àÇy i
                            i
                           XX              ‚àÇ2
                                                             zÃÑŒµi (y)zÃÑŒµj (y) ¬∑ var(Œµ) + zÃÑœÉi (y)zÃÑœÉj (y) œâ(y) .
                                                                                                            
                       +
                                         ‚àÇy i ‚àÇy j
                            i       j

  25 For simplicity we drop the cross terms between                               œÉ   and    Œµ     which integrate to 0 when
evaluated at   œÉ = 0.



                                                                   23
Thus,

           Z                   X ‚àÇ
  0                                     i          i
                                                                    
XÃÑœÉœÉ   =       R(z)        ‚àí       i
                                     (zÃÑœÉœÉ (z) + zÃÑŒµŒµ (y)var(Œµ))œâ(z)
                                ‚àÇz
                                i
                                                                                              !
               XX            ‚àÇ2
                                       zÃÑŒµi (z)zÃÑŒµj (z)var(Œµ)        zÃÑœÉi (z)zÃÑœÉj (z)
                                                                                           
           +                                                    +                       œâ(z) dz
                           ‚àÇz i ‚àÇz j
                   i   j
           Z
                                          i          i
                                                                 
       =       (Rz (z) + Rx (z)xÃÑz (z)) zÃÑœÉœÉ (z) + zÃÑŒµŒµ (y)var(Œµ) œâ(z)dz
               Z                                                                                                         !
           +           Rzz (z) + Rxz (z) ¬∑ (I, xÃÑz (z)) + Rzx (z) ¬∑ (xÃÑz (z), I) + Rxx (z) ¬∑ (xÃÑz (z), xÃÑz (z))

                           ¬∑ (zÃÑŒµ (z), zÃÑŒµ (z)) ¬∑ var(Œµ)œâ(z)dz
               Z                                                                                                         !
           +           Rzz (z) + Rxz (z) ¬∑ (I, xÃÑz (z)) + Rzx (z) ¬∑ (xÃÑz (z), I) + Rxx (z) ¬∑ (xÃÑz (z), xÃÑz (z))

                           ¬∑ (zÃÑœÉ (z), zÃÑœÉ (z)) ¬∑ var(Œµ)œâ(z)dz

which combined with the second derivative of                          R    w.r.t   œÉœÉ   , after dening   XÃÑœÉ+ = XÃÑœÉ0 +
XÃÑŒõ ŒõÃÑœÉ + XÃÑœÉ
Z
                                                                      0
                                                                                                              
       Rx (z) (xÃÑœÉœÉ (z) + xÃÑŒµŒµ (z) ¬∑ var(Œµ)) + RX (z)XÃÑœÉœÉ + RX+ (z) XÃÑœÉœÉ + XÃÑŒõ PXÃÑœÉœÉ

       + RX+ (z) XÃÑŒõŒõ ŒõÃÑ2œÉ + 2‚àÇ XÃÑŒõ ¬∑ ‚Ñ¶ÃÑœÉ ŒõÃÑœÉ + 2XÃÑŒõœÉ ŒõÃÑœÉ + ‚àÇ 2 XÃÑ ¬∑ (‚Ñ¶ÃÑœÉ , ‚Ñ¶ÃÑœÉ ) + 2‚àÇ XÃÑœÉ ¬∑ ‚Ñ¶ÃÑœÉ + XÃÑ œÉœÉ
                                                                                                                         

       + Rxx (z) ¬∑ (xÃÑœÉ (z), xÃÑœÉ (z)) + 2RxX (z) ¬∑ (xÃÑœÉ (z), XÃÑœÉ ) + 2RxX+ (z) ¬∑ (xÃÑœÉ (z), XÃÑœÉ+ ) + RXX (z) ¬∑ (XÃÑœÉ , XÃÑœÉ )
       + 2RXX+ (z) ¬∑ (XÃÑœÉ , XÃÑœÉ+ ) + 2RX+X+ (z) ¬∑ (XÃÑœÉ+ , XÃÑœÉ+ ) + Rxx (z) ¬∑ (xÃÑŒµ (z), xÃÑŒµ (z)) ¬∑ var(Œµ)
                                                    !
       + 2 (RxŒµ (z)xÃÑŒµ (z)) ¬∑ var(Œµ) + RŒµŒµ (z) ¬∑ var(Œµ) d‚Ñ¶(z) = 0


gives a system of linear equations of the form

                                                   h                    i|
                                            LL ¬∑              0
                                                       XÃÑœÉœÉ XÃÑœÉœÉ             = MM.                                    (96)




B.7 Expansion Along Path
We now demonstrate how to compute the expansion along transition path when assuming

œÉ   scales only the shocks and              œÅŒ∏ .   Given the current             (Œò, Œõ),   we will assume knowledge

of the non-stochastic transition path                  {ŒòÃÑn , ŒõÃÑn }    with    (ŒòÃÑ0 , ŒõÃÑ0 ) = (Œò, Œõ)   and   (ŒòÃÑN , ŒõÃÑN ) =




                                                                24
(ŒòÃÑ, ŒõÃÑ)   as well as the associated paths                  {xÃÑn , XÃÑ n }.26   Sections B.4-B.6 give the derivatives
                              N    N
of the policy functions at (ŒòÃÑ , ŒõÃÑ )                    = (ŒòÃÑ, ŒõÃÑ).    We then proceed by backward induction,

assuming that all the derivatives of                xÃÉ and XÃÉ   are known at the point         (0, ŒòÃÑn+1 , ‚Ñ¶, ŒõÃÑn+1 ; 0) and
computing derivatives evaluated at                  (0, ŒòÃÑn , ‚Ñ¶, ŒõÃÑn ; 0). We will denote derivatives evaluated at
(0, ŒòÃÑn , ‚Ñ¶, ŒõÃÑn ; 0)   by superscript        n.
      Dierentiating with respect to                Œõ,

             Fnx‚àí (z)xÃÑnŒõ (z) + Fnx (z)xÃÑnŒõ (z) + Fnx+ (z) xÃÑn+1     n    n      n
                                                                       
                                                             Œõ (z)PXÃÑŒõ + FX (z)XÃÑŒõ = 0


and              Z
                      Rnx (z)xÃÑnŒõ (z) + RnX (z)XÃÑŒõn + RnX+ (z)XÃÑŒõn+1 PXÃÑŒõn + RnŒõ (z)d‚Ñ¶ = 0.

Solving for     xÃÑnŒõ (z)    gives

                                                             ‚àí1
                  xÃÑnŒõ (z) = ‚àí Fnx‚àí (z) + Fnx (z)                   Fnx+ (z)xÃÑn+1          n
                                                                                                  n
                                                                              Œõ   (z)P + F X (z)  XÃÑŒõ ,

and therefore        XÃÑŒõn   equals

   Z                                                                                 ‚àí1
      n       n         n
                               ‚àí1 n        n+1       n
                                                              n        n       n+1
                                                                                    
‚àí     ‚àíRx (z) Fx‚àí (z) + Fx (z)     Fx+ (z)xÃÑŒõ (z)P + FX (z) + RX (z) + RX+ (z)XÃÑŒõ P d‚Ñ¶
  Z            
      n
√ó    RŒõ (z)d‚Ñ¶(z) .

The Frechet derivative w.r.t              ‚Ñ¶   is computed as follows:



Fnx‚àí (z)‚àÇ xÃÑn (z) + Fnx (z)‚àÇ xÃÑn (z) + Fnx+ (z)‚àÇ xÃÑn+1 (z) + Fnx+ (z)xÃÑn+1       n   n        n
                                                                       Œõ (z)P‚àÇ XÃÑ + FX (z)‚àÇ XÃÑ = 0


which gives

                                              ‚àí1 
  ‚àÇ xÃÑn (z) = ‚àí Fnx‚àí (z) + Fnx (z)                    Fnx+ (z)xÃÑn+1          n           n     n          n+1
                                                                                                                 
                                                                Œõ   (z)P + F X (z)  ‚àÇ XÃÑ   + F x+ (z)‚àÇ xÃÑ     (z)
                N
                X ‚àín
            =           Cnj (z)‚àÇ XÃÑ n+j ,
                 j=0


where for the last expression we our knowledge that                            ‚àÇ XÃÑ N = ‚àÇ XÃÑ   and   ‚àÇ xÃÑN (z) = ‚àÇ xÃÑ(z) =
                                          PN ‚àín
C(z)‚àÇ XÃÑ    and then        ‚àÇ xÃÑn (z) =       j=0     Cnj (z)‚àÇ XÃÑ n+j   is derived from the recursion.


  26 The fact that          ‚Ñ¶ÃÉ(0, Œò, ‚Ñ¶, Œõ; 0) = ‚Ñ¶         for any   (Œò, ‚Ñ¶, Œõ)     makes computation of these terms
straightforward using a shooting algorithm.




                                                                 25
     To nd       ‚àÇ XÃÑ   we then take the Frechet derivative of                             R   to get

     Z
              Rnx (z)‚àÇ xÃÑn (z) ¬∑ ‚àÜ + RnX+ (z) (‚àÇ XÃÑ n+1 ¬∑ ‚àÜ) + XÃÑŒõn+1 P(‚àÇ XÃÑ n ¬∑ ‚àÜ) + RnX (z)‚àÇ XÃÑ n ¬∑ ‚àÜ œâ(z)dz
                                                                                                      
0=
          Z
     +         Rn (z)Œ¥(z)dz.


     Substituting for        ‚àÇ xÃÑn (z) = ‚àÇ XÃÑ n ,       we get

                    Z                                                                                    ‚àí1 Z
     n
                            Rnx (z)Cn0 (z)           RnX+ (z)XÃÑŒõn+1 P                 RnX (z)                   Rn (z)Œ¥(z) + Rnx (z)‚àÇ xÃÑn (z) ¬∑ ‚àÜdz
                                                                                                 
‚àÇ XÃÑ ¬∑ ‚àÜ = ‚àí                                     +                              +                    d‚Ñ¶(z)
                         Ô£´                                   Ô£∂
                          Z           N ‚àín
               ‚â° (Dn )‚àí1 Ô£≠ Rn (z)d‚àÜ +
                                      X
                                           Enj ‚àÇ XÃÑ n+j ¬∑ ‚àÜ Ô£∏
                                                           

                                                       j=1


     Finally we can compute the response to shock                                 E   (note we only need to do this for        n = 0)

               F0x xÃÑ0E + F0x+ œÅŒò xÃÑ1Œò + xÃÑ1z pxÃÑ0E + ‚àÇ xÃÑ1 ¬∑ ‚Ñ¶ÃÑ0E + xÃÑ1Œõ PXÃÑE0 + F0X XÃÑE0 + F0E = 0.
                                                                               


Substituting for         ‚àÇ xÃÑ1   we obtain, after dening                   XÃÑ j E = ‚àÇ XÃÑ j ¬∑ ‚Ñ¶ÃÑ0E
                                 Ô£´                                                                                         Ô£∂
                                                                                  N ‚àí1
                                                                                            C1j (z)XÃÑEj+1 + xÃÑ1Œõ (z)PXÃÑE0 Ô£∏+F0X (z)XÃÑE0 +F0E (z) = 0,
                                                                                  X
F0x (z)xÃÑE (z)+F0x+ (z) Ô£≠œÅŒò xÃÑ1Œò (z) + xÃÑ1z (z)pxÃÑnE (z) +
                                                                                      j=0

or
                                                                 h                                            i|
                             M0 (z)xÃÑ0E (z) = N0 (z)                  I XÃÑE0           XÃÑE1      ¬∑ ¬∑ ¬∑ XÃÑEN        .

We obtain the following expression for                        XÃÑ jE   for   j = 1, . . . , N

                                                                                 N ‚àíj
                                        Z                                                                              !
                                 j ‚àí1
                 XÃÑ jE = D                                                            Ejk XÃÑEj+k
                                                                                 X
                                              j        j      j
                                                                   0
                                             Rz (z) + Rx (z)xÃÑz (z) pxÃÑE (z)d‚Ñ¶ +
                                                                                                            k=1

which, when combined with



      Z
          R0x (z)xÃÑ0E (z) + R0X (z)XÃÑE0 + R0X+ (z) œÅŒò XÃÑŒò
                                                        1
                                                          + XÃÑE1 + XÃÑŒõ1 PXÃÑE0 + R0E (z)d‚Ñ¶ = 0,
                                                                             


yields the linear system

                                             h                                                  i|
                                        O¬∑       I     XÃÑE0      XÃÑE1       ¬∑¬∑¬∑       XÃÑEN           = P.




                                                                      26
C Simulation and Clustering
To simulate an optimal policy at each date with                             N   agents, we discretize the distribution

across agents with          K   grid points that we nd each period using a k-means clustering al-

gorithm. Let       {zi }N
                        i=1     represent the current distribution of agents. The k-means algorithm

generates     K   points    {zÃÑk }K
                                  k=1      with each agent           i   assigned to a cluster       k(i)   to minimize the

                                           k2 .
                    P
squared error         i kzi     ‚àí zÃÑk(i)           We let     ‚Ñ¶    represent the distribution of            N   agents and       ‚Ñ¶ÃÑ
represent our approximating distribution of                         clusters.
                                                                              27      At each history, we apply our al-

gorithm to approximate the optimal policies around                              ‚Ñ¶ÃÑ.    Moreover, by allowing            œÉ   to also

scale deviations of         ‚Ñ¶   from   ‚Ñ¶ÃÑ,   we can increase the accuracy of our approximate the policy

rules as follows. Let           xÃÉ(œÉŒµ, œÉE, œÉ(Œò ‚àí ŒòÃÑ) + ŒòÃÑ, z, ‚Ñ¶ÃÑ + œÉ(‚Ñ¶ ‚àí ‚Ñ¶ÃÑ), œÉ(Œõ ‚àí ŒõÃÑ(‚Ñ¶)) + ŒõÃÑ; œÉ)                            and

XÃÉ(œÉE, œÉ(Œò ‚àí ŒòÃÑ) + ŒòÃÑ, ‚Ñ¶ÃÑ + œÉ(‚Ñ¶ ‚àí ‚Ñ¶ÃÑ), œÉ(Œõ ‚àí ŒõÃÑ(‚Ñ¶)); œÉ)                            denote the policy rules with scaling

parameters      œÉ. We can them approximate these policies with a Taylor expansion with respect
to   œÉ.   For example, a rst-order Taylor expansion would be

                                                                                                 
     xÃÉ(Œµ, Œò, z, ‚Ñ¶, Œõ) ‚âà xÃÑ + xÃÑŒµ Œµ + xÃÑE E + xÃÑŒò (Œò ‚àí ŒòÃÑ) + ‚àÇ xÃÑ ¬∑ (‚Ñ¶ ‚àí ‚Ñ¶ÃÑ) + xÃÑŒõ (Œõ ‚àí ŒõÃÑ) + xÃÑœÉ œÉ

and

                                                                                       
      XÃÉ(Œò, ‚Ñ¶, Œõ) ‚âà XÃÑ + XÃÑE E + XÃÑŒò (Œò ‚àí ŒòÃÑ) + ‚àÇ XÃÑ ¬∑ (‚Ñ¶ ‚àí ‚Ñ¶ÃÑ) + XÃÑŒõ (Œõ ‚àí ŒõÃÑ(‚Ñ¶)) + XÃÑœÉ œÉ.

Both      ‚àÇ xÃÑ ¬∑ (‚Ñ¶ ‚àí ‚Ñ¶ÃÑ)   and    ‚àÇ XÃÑ ¬∑ (‚Ñ¶ ‚àí ‚Ñ¶ÃÑ)          are easily computed from terms already computed

during the expansion, so these extra corrections have no additional computational cost.
                                                                                                                                 28

Note that when       K=N          we exactly approximate around                     ‚Ñ¶,   but for   K<N      we can speed up
                                N
the computations by a factor of
                                K . We choose                           K   so that increasing      K   does not change the

impulse responses reported in section 5 which results in a                          K    of   2000 to 3000 and N = 100000
depending on the experiment.




D Competitive Equilibrium with xed government
  policies
We demonstrate the application of our method outlined in section 3.1 to a problem of nding

a competitive equilibrium for xed government policies. We have two goals in mind: First,

  27 Formally                        1                           1
                                P                                               P
                  d‚Ñ¶(z) =          i N Œ¥(z        ‚àí zi )       i N Œ¥(z ‚àí zÃÑk(i) ).
                                                           while   d‚Ñ¶ÃÑ(z) =
   28 Following the steps in section (B.5) it can readily be seen that ‚àÇ XÃÑ ¬∑(‚Ñ¶‚àí ‚Ñ¶ÃÑ)
                                                                                                                    R
                                                                                                                =       A(z)(z ‚àí
zÃÑ(z))d‚Ñ¶ÃÑ(z) = i N1 A(zÃÑk(i) )(zi ‚àí zÃÑk(i) ) and ‚àÇ xÃÑ(zÃÑk ) = C(zÃÑk )‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑœÉ .
                 P




                                                                   27
the problem with xed policies is simpler and explicit expressions for terms that arise in

many of the steps in section 3 as well as those in appendix B can be derived. Second, we use

this economy as a test case to analyze the accuracy of the our approximations by comparing

the second-order expansions to solutions obtained with global methods.

      To make our exposition most transparent, we assume that government has no expendi-

tures, sets taxes       Œ•t = Tt = 0     and implements ination     Œ†t = 0       in all periods. We assume all

agents have equal ownership of rms and that there is no permanent component of labor

productivity,        Œ∏i,t = 0.   Finally, we assume that the aggregate shock is i.i.d., which removes

Œò   as a state variable.          These assumptions deliver a version of Huggett (1993) economy

with natural borrowing limits extended to allow for endogenous labor supply and aggregate

shocks.

      Individual decisions are expressed recursively. The aggregate variables depend on the

realized aggregate shock          E   and the beginning of the period distribution of assets           ‚Ñ¶.   Since we

assumed that government has no revenues, it also cannot issue debt, and so the distribution
                 R
‚Ñ¶   satises         bd‚Ñ¶ = 0.     We denote the space of such distributions by                W.     We use tildes
                                                       h                iT
to denote policy functions, and let             XÃÉ =       QÃÉ WÃÉ   DÃÉ        be a vector of aggregate policy

functions capturing interest rates, wages and dividends. Individual policy functions depend

both on aggregate state            (E, ‚Ñ¶)   and on idiosyncratic state       (Œµ, b)   where   Œµ   is the realization

of the idiosyncratic shock that aects individual with asset beginning of period assets                           b.
             h              iT
Let   xÃÉ =
        bÃÉ cÃÉ nÃÉ                 be the triplet of the individual policy functions. Finally,              ‚Ñ¶
                                                                                                          e (E, ‚Ñ¶) :
R √ó W ‚Üí W be the             law of motion describing how the aggregate distribution of debt next

period is aected by the aggregate shock in the current period.

      Individual optimality conditions consist of the budget constraint (2) and the optimality

conditions (13)-(14). In our recursive notation, these conditions read



          cÃÉ (Œµ, E, b, ‚Ñ¶) + QÃÉ (E, ‚Ñ¶) bÃÉ (Œµ, E, b, ‚Ñ¶) = WÃÉ (E, ‚Ñ¶) exp (E + Œµ) nÃÉ (Œµ, E, b, ‚Ñ¶)                  (97a)

          + b + DÃÉ (E, ‚Ñ¶) ,
             n h                               i     o
          Œ≤E uc cÃÉ ¬∑, ¬∑, bÃÉ (E, b, ‚Ñ¶) , ‚Ñ¶
                                        e (E, ‚Ñ¶)   E, ‚Ñ¶ = QÃÉ (E, ‚Ñ¶) uc [cÃÉ (Œµ, E, b, ‚Ñ¶)] ,                    (97b)


          WÃÉ (E, ‚Ñ¶) exp (E + Œµ) uc [cÃÉ (Œµ, E, b, ‚Ñ¶)] = ‚àíun [nÃÉ (Œµ, E, b, ‚Ñ¶)] ,                                 (97c)



for all   Œµ, E, b, ‚Ñ¶.    These constraints construct the function            F   as in (20) of section 3.       The




                                                           28
aggregate constraints after imposing rm's optimality (15) can be written as

                 Z                                            Œ±       Z
                      exp(E + Œµ)nÃÉ (Œµ, E, b, ‚Ñ¶) d Pr (Œµ) d‚Ñ¶         =       cÃÉ (Œµ, E, b, ‚Ñ¶) d Pr (Œµ) d‚Ñ¶,    (98a)

                       Z                                       Œ±‚àí1
                 ‚àí1
                     Œ±    exp(E + Œµ)nÃÉ (Œµ, E, b, ‚Ñ¶) d Pr (Œµ) d‚Ñ¶      = WÃÉ (E, ‚Ñ¶) ,                          (98b)
                   
                            Z                                       Œ±
                      ‚àí1
                  1‚àí      Œ±      exp(E + Œµ)nÃÉ (Œµ, E, b, ‚Ñ¶) d Pr (Œµ) d‚Ñ¶ = DÃÉ (E, ‚Ñ¶) ,                        (98c)
                        

for all   E, ‚Ñ¶   which construct the function (21) of section 3. Finally, the law of motion for the

distribution of debts induced by the savings behavior of the agents is given by

                                           Z                       
                         ‚Ñ¶
                         e (E, ‚Ñ¶) (y) =        Œπ bÃÉ (Œµ, E, b, ‚Ñ¶) ‚â§ y d Pr (Œµ) d‚Ñ¶ ‚àÄy,                         (99)



where     Œπ   is the indicator variable.

    Equations (97), (98), and (99) fully describe the equilibrium behavior.




D.1 Points of expansion and zeroth-order terms
Consider the expansion around deterministic economy with a given distribution of assets                       ‚Ñ¶.
Observe that we have

                                           bÃÑ (b, ‚Ñ¶) = b   for all b,‚Ñ¶.                                     (100)


This counterpart of lemma (1) implies that equations for deterministic economy are



                           cÃÑ (b, ‚Ñ¶) + QÃÑ (‚Ñ¶) b = WÃÑ (‚Ñ¶) nÃÑ (b, ‚Ñ¶) + b + DÃÑ (‚Ñ¶) ,                          (101a)

                                               Œ≤ = QÃÑ (‚Ñ¶) ,                                                (101b)

                           WÃÑ (‚Ñ¶) uc [cÃÑ (b, ‚Ñ¶)] = ‚àíun [nÃÑ (b, ‚Ñ¶)] ,                                       (101c)



for all   (b, ‚Ñ¶)   and aggregate constraints

                                           Z                  Œ±       Z
                                                nÃÑ (b, ‚Ñ¶) d‚Ñ¶        =       cÃÑ (b, ‚Ñ¶) d‚Ñ¶,
                                     Z               Œ±‚àí1
                               ‚àí1
                                   Œ±    nÃÑ (b, ‚Ñ¶) d‚Ñ¶       = WÃÑ (‚Ñ¶) ,                                       (102)
                                
                                     Z               Œ±
                               ‚àí1
                            1‚àí     Œ±        nÃÑ (b, ‚Ñ¶) d‚Ñ¶ = DÃÑ (‚Ñ¶) ,
                                 

and the law of motion

                                                   ‚Ñ¶ÃÑ (‚Ñ¶) = ‚Ñ¶                                               (103)




                                                       29
that hold for all       ‚Ñ¶.For    a given       ‚Ñ¶,   we solve the system of equations above for                xÃÑ(b, ‚Ñ¶), XÃÑ(‚Ñ¶).
       To obtain the coecients of the rst-order expansion of the policy functions, we will

need to know how policy functions are aected by perturbations to the individual state                                        b.
Dierentiate (101a) and (101c) with respect to                          b   to get a linear system and then solving for

xÃÑb   yields


                           Ô£Æ              Ô£π       Ô£Æ                                             Ô£π‚àí1 Ô£Æ          Ô£π
                                bÃÑb (b)                  1                  0             0               1
                xÃÑb (b) ‚â° Ô£∞ cÃÑb (b) Ô£ª = Ô£∞ QÃÑ ‚àí 1                            1            WÃÑ            Ô£∞ DÃÑ Ô£ª ,         (104)
                          Ô£Ø         Ô£∫ Ô£Ø                                                         Ô£∫      Ô£Ø    Ô£∫
                                                                                                Ô£ª
                                nÃÑb (b)                  0       WÃÑ ucc [cÃÑ (b)] unn [nÃÑ (b)]             0
where all the terms on the right hand side are known from the zeroth-order expansion.




D.2 First-order terms and factorization theorem
Consider the rst order expansion with respect to                               œÉ   of equations (98) and (97) and use

method of undetermined coecients to nd the derivatives that multiply                                    œÉŒµ   and   œÉE .   The

derivatives     xÃÑŒµ (b) are easy to nd since they cancel out from the expansions of the feasibility
constraints and appear only in the individual optimality conditions



                                                  cÃÑŒµ (b) + QÃÑbÃÑŒµ (b) = WÃÑ (nÃÑ (b) + nÃÑŒµ (b)) ,                        (105a)

                                                    QÃÑucc [cÃÑ(b)]cÃÑŒµ (b) = Œ≤ucc [cÃÑ(b)]cÃÑb (b)bÃÑŒµ (b),                 (105b)

                         WÃÑ (uc [cÃÑ (b)] + ucc [cÃÑ (b)] cÃÑŒµ (b)) = ‚àíunn [nÃÑ (b)] nÃÑŒµ (b) .                             (105c)



for all    b.   All variables apart from                bÃÑŒµ (b) , cÃÑŒµ (b) , nÃÑŒµ (b),   are known from the zeroth-order

expansion. Thus we can nd                    bÃÑŒµ (b) , cÃÑŒµ (b) , nÃÑŒµ (b)   separately for each   b   by solving this       3√ó3
system of equations. In the direct analogy with (104) we can write this solution compactly

as

                                                       xÃÑŒµ (b) = E(b)‚àí1 G(b)                                            (106)


for matrices        K(b),L(b)    known from the zeroth-order expansion. Similarly it can be shown

that    XÃÑœÉ , xÃÑœÉ   are all zero vectors.

       Solving for the eect of the aggregate shocks is more complicated because they aect the

distribution of debts and the aggregate constraints. Dierentiating individual constraints

implies that



                               cÃÑE (b) + QÃÑbÃÑE (b) + QÃÑE bÃÑ (b) = WÃÑ (nÃÑ (b) + nÃÑE (b)) + WÃÑE nÃÑ (b) + DÃÑ E,
                                                                                                        (107a)
                                                              
                    Œ≤ucc [cÃÑ(b)] cÃÑb (b)bÃÑE (b) + ‚àÇcÃÑ(b) ¬∑ ‚Ñ¶ÃÑE = QÃÑucc [cÃÑ(b)]cÃÑE (b) + uc [cÃÑ(b)]QÃÑE , (107b)
      WÃÑ (uc [cÃÑ (b)] + ucc [cÃÑ (b)] cÃÑE (b)) + WÃÑE uc [cÃÑ (b)] = ‚àíunn [nÃÑ (b)] nÃÑE (b) .                              (107c)




                                                                   30
while dierentiating the aggregate constraints gives

                                                        Z                               Z
                                                  Œ±‚àí1
                                            Œ±NÃÑ             (nÃÑ (b) + nÃÑE (b)) d‚Ñ¶ =          cÃÑE (b) d‚Ñ¶,
                           ‚àí1
                                                        Z
                               Œ± (Œ± ‚àí 1) NÃÑ Œ±‚àí2 (nÃÑ (b) + nÃÑE (b)) d‚Ñ¶ = WÃÑE ,                                            (108)
                             
                                    
                               ‚àí1
                                               Z
                            1‚àí     Œ± Œ±NÃÑ Œ±‚àí1 (nÃÑ (b) + nÃÑE (b)) d‚Ñ¶ = DÃÑE ,
                                

where     NÃÑ   is the aggregate labor supply in the zeroth-order expansion.                                 Furthermore, by

dierentiating equation (99) with respect to                  E   and evaluating at         œÉ = 0 it can readily be seen
that
     29

                                           ‚Ñ¶ÃÑE (b) = ‚àíœâ(b)bÃÑE (b)        for all   b.                                    (109)


This leads to the main diculty of this problem:                              in order to solve for the response of

aggregates         XÃÑE   we must jointly solve equations (107a)-(108) for               xÃÑE (b) for all b.      Our resolution

is to apply the factorization theorem, theorem (1), to show that                                xÃÑE (b)   can be constructed
                         0
as loadings on XÃÑE and XÃÑE             = ‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑE (b)     which can be solved for independently.

     Begin by dierentiating the individual constraints with respect to                             ‚Ñ¶.    Exploiting   ‚àÇ ‚Ñ¶ÃÑ = 1
yields



                                   ‚àÇcÃÑ(b) + b‚àÇ QÃÑ + Œ≤‚àÇ bÃÑ(b) = nÃÑ(b)‚àÇ WÃÑ + WÃÑ ‚àÇ nÃÑ(b) + ‚àÇ DÃÑ
                                                             
                         Œ≤ucc [cÃÑ(b)] cÃÑb (b)‚àÇ bÃÑ(b) + ‚àÇcÃÑ(b) = uc [cÃÑ(b)]‚àÇ QÃÑ + Œ≤ucc [cÃÑ(b)]‚àÇcÃÑ(b)
                         WÃÑ ucc [cÃÑ(b)]‚àÇcÃÑ(b) + uc [cÃÑ(b)]‚àÇ WÃÑ = unn [nÃÑ(b)]‚àÇ nÃÑ(b).

This can be represented by the matrix expression

Ô£Æ                                                             Ô£πÔ£Æ               Ô£π   Ô£Æ                                     Ô£πÔ£Æ          Ô£π
               Œ≤                  1               ‚àíWÃÑ               ‚àÇ bÃÑ(b)               ‚àíb               nÃÑ(b)     1        ‚àÇ QÃÑ
Ô£∞ Œ≤ucc [cÃÑ(b)]cÃÑb (b)             0                0          Ô£ª Ô£∞ ‚àÇcÃÑ(b) Ô£ª = Ô£∞ uc [cÃÑ(b)]                   0        0 Ô£ª Ô£∞ ‚àÇ WÃÑ Ô£ª
Ô£Ø                                                             Ô£∫Ô£Ø         Ô£∫ Ô£Ø                                           Ô£∫Ô£Ø       Ô£∫

               0             WÃÑ ucc [cÃÑ(b)] ‚àíunn [nÃÑ(b)]            ‚àÇ nÃÑ(b)                 0         ‚àíuc [cÃÑ (b)] 0          ‚àÇ DÃÑ

which we can solve to yield the counterpart to the rst result of theorem (1):



                                                   ‚àÇ xÃÑ(b) = C(b)‚àÇ XÃÑ.

To obtain the second result we dierentiate equations (98a)-(98c) in an arbitrary direction

    29 For the derivation in detail see section B.5.




                                                               31
‚àÜ    evaluated at        œÉ=0     to nd

                                                         Z                               Z                
                                                   Œ±‚àí1
                                           Œ±NÃÑ    nÃÑ (b) d‚Ñ¶ ¬∑ ‚àÜ =                                   cÃÑ (b) d‚Ñ¶ ¬∑ ‚àÜ
                                                         Z
                          ‚àí1              Œ±‚àí2
                              Œ± (Œ± ‚àí 1) NÃÑ        nÃÑ (b) d‚Ñ¶ ¬∑ ‚àÜ = ‚àÇ WÃÑ ¬∑ ‚àÜ,                                                        (110)
                           
                                             Z          
                             ‚àí1           Œ±‚àí1
                          1‚àí      Œ± Œ±NÃÑ           nÃÑ (b) d‚Ñ¶ ¬∑ ‚àÜ = ‚àÇ DÃÑ ¬∑ ‚àÜ.
                               

As noted in section (3),

                                Z                           Z                                Z
                                      cÃÑ (b) d‚Ñ¶ ¬∑ ‚àÜ =             ‚àÇcÃÑ (b) ¬∑ ‚àÜd‚Ñ¶ +                   cÃÑ(b)d‚àÜ.


Evaluating this integral at            ‚àÜ(b) = ‚Ñ¶ÃÑE (b) = ‚àíœâ(b)bÃÑE (b)                    and exploiting integration by parts

we nd

Z                             Z                         Z                         Z                               Z
       cÃÑ (b) d‚Ñ¶ ¬∑ ‚Ñ¶ÃÑE =            ‚àÇcÃÑ (b) ¬∑ ‚Ñ¶ÃÑE d‚Ñ¶ +        cÃÑ(b)d‚Ñ¶ÃÑE =                C1 (b)d‚Ñ¶‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑE +           cÃÑb (b)bÃÑE (b)d‚Ñ¶


where     C1 (b) represents the rst row of C(b). As a similar relationship can be derived for
 R             
     nÃÑ (b) d‚Ñ¶ ¬∑ ‚Ñ¶ÃÑE , plugging these into equations (110) yields a system of equations of the
form                                                              Z
                                             D‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑE =             B(b)xÃÑE (b)d‚Ñ¶

where    D   and        B(b)   are both known from zeroth-order terms.                                  Solving for   ‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑE   gives
                    R
‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑE =            A(b)xÃÑE (b)d‚Ñ¶.     When combined with our expression for                                 ‚àÇ xÃÑ(b),   we get the

analogue of (75) of theorem 1

                                                                      Z
                                         ‚àÇ xÃÑ(b) ¬∑ ‚Ñ¶ÃÑE = C(b)              A(b)xÃÑE (b)d‚Ñ¶.


      Finally we can exploit this knowledge to solve for                            XÃÑE    and      xÃÑE (b)   by rst dening



                                       ‚àÇ xÃÑ(b) ¬∑ ‚Ñ¶ÃÑE = C(b)‚àÇ XÃÑ ¬∑ ‚Ñ¶ÃÑE ‚â° C(b)XÃÑE0 .

After substituting for           ‚àÇ xÃÑ(b) ¬∑ ‚Ñ¶ÃÑE ,   equation (107) now denes a linear relationship between
                                                                          h                    i
policy functions          xÃÑE (b)   and aggregate variables                   XÃÑE       XÃÑE0        which is independent of any

other   xÃÑE (bÃÇ).   Thus, we can write (107) for each                  b   as

                                                                       h                       iT
                                         M(b)xÃÑE (b) = N(b) ¬∑                 XÃÑE       XÃÑE0        ,                              (111)




                                                                  32
where     M(b)   is a    3√ó3    matrix, and all coecients of                        M(b)   and   N(b)   are known from the

zeroth-order expansion. Thus we can solve for each                               xÃÑE (b)   as a function of aggregate vari-

ables independently for each           b.   This simplies analysis by breaking one system of                            3K √ó 3K
equations into       K   system of   3√ó3      equations for each of                  K   levels of debt. We can substitute

the obtained expressions for          xÃÑE (¬∑)   into equations (108) and

                                                             Z
                                                XÃÑE0     =        A(b)xÃÑE (b)d‚Ñ¶                                               (112)



to generate a      6√ó6     system of equations of the form

                                                     h                     iT
                                                O¬∑       XÃÑE        XÃÑE0        = P.                                          (113)



Equation (113) can be easily solved numerically for                              XÃÑE , XÃÑE0 .   This completes the solution

for the rst-order responses to the aggregate shock                             E.


D.3 Second and higher order terms
To construct a second-order expansion of policy functions we need additional terms. These

are   xÃÑŒµŒµ (b), xÃÑŒµœÉ (b), xÃÑEE (b), xÃÑEœÉ (b), xÃÑœÉœÉ (b), XÃÑEE , XÃÑEœÉ , XÃÑœÉœÉ .             Calculations of   xÃÑŒµŒµ ,xÃÑEE ,XÃÑEE    then

proceeds analogously to their rst-order counterparts, while the cross-partials                                    xÃÑŒµœÉ , xÃÑEœÉ , XÃÑEœÉ
are all zeros. Unlike the rst-order expansion, the intercept terms                                  xÃÑœÉœÉ , XÃÑœÉœÉ   are no longer

zero.     They depend on var(Œµ), var(E) and capture such eects as precautionary savings.

Solution for     xÃÑœÉœÉ (b), XÃÑœÉœÉ   involves steps similar to those used to solve for                          xÃÑE (b), XÃÑE    in the

previous section. Details are provided in section B.6.




D.4 Numerical implementation and accuracy
To implement our algorithm numerically, we approximate                                      ‚Ñ¶   with a discrete distributions

with    K   points   {bk }k   with masses       {œâk }k .         All the integrals in our expressions collapse then

to sums. For example, our expression (112) for                          XE0     becomes

                                                         X
                                             XÃÑE0 =               A(bk )œâk bÃÑE (bk ).
                                                             k

All intermediate terms, such as              E(bk ),     can be computed independently for each                        k,   making

the algorithm highly parallelizable. Once we compute approximations of the policy functions

in the current period, we use Monte-Carlo methods described in section C to obtain the next

period distribution of assets         ‚Ñ¶ÃÉ,   for which we repeat this procedure.




                                                                   33
      We now discuss the numerical accuracy of our approximations. To compare our (second-

order) approximated policy rules with those solved via global methods we shut down the

aggregate shocks and compute the steady state distribution of assets the model presented

in section D.3.      Optimal policies of each agent are computed using the endogenous grid

method of Carol (2005). The steady-state distribution is approximated using a histogram

and computed using the transition matrix constructed from the policy rules following Young

(2010). We then compare the approximated policy rules using our method, around the same

stationary distribution, to those of the global solution.                As noted in section D.3, even in

absence of aggregate shocks our techniques are still necessary, for a second-order expansion,

to determine the eect of the presence idiosyncratic risk on policies through                        xÃÑœÉœÉ   and   XÃÑœÉœÉ .
      We calibrate the 6 parameters of this model,              ŒΩ ,Œ≥ ,Œ≤ , Œ± ,    and    œÉŒµ ,   as follows.   We set

ŒΩ=1      and   Œ≥=2   to match of calibration in section 4.           Œ≤   is set to target an interest rate of

2%.    =6      targets a markup of 20% and the decreasing returns to scale parameter,                            Œ±,   is

chosen to target a labor share of         0.66.   The standard deviation          œÉŒµ   is set at .25 to match our

calibration in section 4. We choose very loose ad-hoc borrowing constraints,                          b = ‚àí100         to

approximate a natural debt limit. To ensure an accurate approximation to the global policy

rules, we approximated the consumption and labor policy rules using cubic splines with 200

grid points and the steady-state distribution with a histogram with 1000 bins.

      Agents' policies and aggregate variables are then approximated using a second-order

approximation around the stationary distribution                ‚Ñ¶ÃÑ   with the expressions derived in this

section. The equilibrium policy rules and aggregates, around this distribution of 1000 points,

can be approximated using single processor in 0.8 seconds.                    The equilibrium interest rate

found by perturbation code was 2.0013%. The percent error in the aggregate labor supply

was 0.036%.       Finally, we can evaluate the policy errors for the individual agents.                       In the

rst panel of gure VIII we plot the percentage errors for consumption relative to the global

solution for a median shock to        œÇ   along with a   ¬±2.5   standard deviation shock.

      For almost all of the agents, the perturbation methods perform well with errors less

than    0.1%   which would correspond making an error in consumption of less than a dollar on

every   $1000   dollars spent. As expected, since the quadratic approximation assumes natural

borrowing limits, the accuracy deteriorates near the borrowing limit assumed by the global

solution. The range plotted in gure VIII contains 99.2% of the agents in the stationary

distribution. As a robustness check, we also observe how accuracy behaves as we change                              œÉŒµ .
For values of    œÉŒµ ‚àà [0.1, 0.5],   we compute the average absolute percentage error as


                               cglobal (œÉŒµ Œµ, b; œÉŒµ ) ‚àí cpertub (œÉŒµ Œµ, b; œÉŒµ )
                       Z Z
                                                                               dPr(Œµ)d‚Ñ¶
                                            cglobal (œÉŒµ Œµ, b; œÉŒµ )




                                                       34
         0.4                                                                                      œÇ = ‚àí0.6
                                                                                                   œÇ = 0.0
 error


                                                                                                   œÇ = 0.6
         0.2
%




           0
               ‚àí90          ‚àí50          ‚àí10        30              70          110        150              190
                                                           assets




         0.2
 error




         0.1
%




           0
                     0.15         0.2      0.25      0.3           0.35        0.4      0.45          0.5
                                                              œÉœÇ

Figure VIII: Percentage error of consumption policy functions relative to global solution in
top panel. Bottom panel plots average (with respect to the stationary distribution) absolute
consumption error relative to global solution as              œÉœÇ   varies.



and plot it in the bottom panel of gure VIII. We see that the average error remains very

low around the level of our calibration and increases moderately for higher                    œÉŒµ .



E Robustness
We provide details for several cases that are discussed in sections 5 and 6 but omitted

from the main text. These include stationary TFP shocks, alternative welfare criteria, no

inequality shocks           f = 0,   and no menu costs   œà = 0.
         Stationary TFP shocks are modeled as an AR(1) process (see equation 9a) in the text,

with autocorrelation           œÅŒò = 0.954   and std of   EŒò = 3%.        All other parameters and the initial

condition are kept as the same as the baseline calibration in section 4. The impulse responses

are computed to a one standard deviation negative shock. As mentioned in section 5.2, we

extend the denition of natural rate for our heterogeneous agent economy to be the real

interest rates in a competitive equilibrium with              œà=0     that implements exible prices, scal

policy set       Œ•t   at the non-stochastic optimum and initial conditions as in section 4.                  The

optimal response of the nominal rate in Figure IX is plotted as a deviation from this natural

rate and we see that it quite closely tracks the response in the baseline with the i.i.d growth

rate specication.




                                                         35
           Nominal rate-Natural rate                     Ination                           Tax rate
                                                                                1
             0                             0.6
                                                                             0.5
         ‚àí0.2
   pts



                                           0.4
                                                                                0
         ‚àí0.4
   %



                              AR(1)        0.2
                                                                         ‚àí0.5
         ‚àí0.6                  BM
                                             0
                 4   6    8   10 12              4   6     8   10 12                4   6     8   10 12
                         Output                  Ex-post real returns                        TFP

             0                             0.5                                  0
           ‚àí1                                                                ‚àí1
     pts




                                    pts




                                                                       pts
                                             0
           ‚àí2
     %




                                    %




                                                                       %
                                                                             ‚àí2
           ‚àí3                             ‚àí0.5
                                                                             ‚àí3
                 4   6    8   10 12              4   6     8   10 12                4   6     8   10 12
Figure IX:       Optimal monetary response to an AR(1) productivity shock. The solid line is
the baseline calibration with i.i.d growth rate shocks.



   To illustrate the role of alternative preferences for the planner, we modify the objective
                                                                       Œ±œâ
function (12) to introduce time-invariant Pareto weights         œâi ‚àù Œ∏‚àí1,i .   We calibrate the       Œ±œâ   such

that the optimal non-stochastic tax rate equals           24%.   Our estimate suggests an         Œ±œâ = 0.75
indicating higher Pareto weights to productive agents which rationalizes low marginal tax

rates. We keep all other parameters and the initial condition as in the baseline calibration

and compute optimal monetary responses to a TFP shock in gure X and the markup

shock in gure XI.        The fact that the responses are similar to the utilitarian case in the

baseline underlines that changes in Pareto wights primarily map into changes in the steady

state level of the tax rate while the response of policies to shocks is governed by insurance

motives arising mainly due to incomplete markets.

   Next we turn to the case where we study TFP shocks with                   f = 0,     implying that the

aggregate TFP shock results in the same proportional change labor productivity for all

agents.    As mentioned in the text, even in absence of changes in inequality, a permanent

drop in wages with agents heterogeneous in asset holdings creates needs for insurance. The

exercise in gure XII allows us decompose the eect into the part that comes because initial

wealth dierences and the part that comes because of heterogeneous exogenous exposure to

the shock.

   Finally we study the case without nominal rigidities by setting              œà ‚âà 0.      In response to a

TFP shock (gure XIII), the planner provides insurance through ination which generates




                                                     36
                     Nominal int. rate                  Ination                       Tax rate
                                                                          1
            0                             0.6
                                                                        0.5
                                          0.4
   pts




         ‚àí0.5                                                             0
                                          0.2
   %




                            Non util.
                                            0                          ‚àí0.5
                               BM
           ‚àí1
                                                                        ‚àí1
                 4     6   8   10 12            4   6     8   10 12           4    6     8   10 12
                      Output growth             Ex-post real returns              TFP growth


            0                               0                             0
                                                                        ‚àí1
     pts




           ‚àí1
                                         ‚àí0.5
     %




                                                                        ‚àí2
           ‚àí2
                                                                        ‚àí3
                 4     6   8   10 12            4   6     8   10 12           4    6     8   10 12
Figure X: Optimal monetary response to a productivity shock with non-utilitarian Pareto
weights. The solid line is the baseline calibration with utilitarian Pareto weights




                     Nominal int. rate                  Ination                       Tax rate
                                                                          1
            0                             0.4
         ‚àí0.1                                                           0.5
   pts




                                          0.2
         ‚àí0.2                                                             0
   %




                            Non util.       0
         ‚àí0.3                                                          ‚àí0.5
                               BM
                                         ‚àí0.2                           ‚àí1
                 4     6   8   10 12            4   6     8   10 12           4    6     8   10 12
                       Log Output           Log Wages (aftertax)                  Markup Shock

           0.4
                                            1                           0.4
     pts




           0.2                            0.5
                                                                        0.2
     %




            0                               0
                                         ‚àí0.5                             0
                 4     6   8   10 12            4   6     8   10 12           4    6     8   10 12
Figure XI: Optimal monetary response to a markup shock with non utilitarian Pareto
weights. The solid line is the baseline calibration with utilitarian Pareto weights




                                                    37
                    Nominal int. rate                     Ination                        Tax rate
                                                                            1
            0                               0.6
                                                                          0.5
   pts



         ‚àí0.2                               0.4
                                                                            0
   %



         ‚àí0.4                 f =0          0.2
                                                                         ‚àí0.5
                                  BM
                                              0
                                                                          ‚àí1
                4     6   8   10 12               4   6     8   10 12           4     6      8   10 12
                     Output growth                Ex-post real returns               TFP growth

            0                                 0                             0
                                          ‚àí0.2                            ‚àí1
     pts




           ‚àí1
                                          ‚àí0.4
     %




                                                                          ‚àí2
           ‚àí2
                                          ‚àí0.6
                                                                          ‚àí3
                4     6   8   10 12               4   6     8   10 12           4     6      8   10 12
Figure XII: Optimal monetary response to a productivity shock with                  f = 0.   The solid line
is the baseline case with     f   calibrated as in section 4.



state contingent returns. The size of response is about 3 to 4 times larger than the baseline

mainly driven by the fact that price changes are less costly and an eective way of insuring

against permanent TFP shocks. In response to a markup shock (gure XIV), we see that

real wages drop and then follow the path of the shock.               This is quite dierent from the

baseline where planner increased real wages to redistribute to towards the wage earners from

equity holders. The reason for this dierence is that absent nominal rigidities, the ability

of the planner to aect aggregate demand and wages through changes in nominal rates is

substantially diminished. The planner still induces some ination on impact because bonds

and equities are correlated and lowering returns partially redistributes towards low wage

agents.




                                                      38
                     Nominal int. rate                  Ination                        Tax rate
                                                                          1
            0
                                            2                           0.5
   pts




         ‚àí0.2                                                             0
                                            1
   %




         ‚àí0.4                  œà=0
                                                                       ‚àí0.5
                                BM
                                            0
                                                                        ‚àí1
                 4     6   8   10 12            4   6     8   10 12           4     6      8   10 12
                      Output growth             Ex-post real returns               TFP growth

            0                               0                             0
           ‚àí1                                                           ‚àí1
     pts




                                          ‚àí1
           ‚àí2
     %




                                                                        ‚àí2
                                          ‚àí2
           ‚àí3                                                           ‚àí3
                 4     6   8   10 12            4   6     8   10 12           4     6      8   10 12
Figure XIII: Optimal monetary response to a productivity shock with               œà = 0.   The solid line
is the baseline calibration with      œà = 20.



                     Nominal int. rate                  Ination                        Tax rate
                                                                          1
            0                             0.5
                                                                        0.5
   pts




                                            0
         ‚àí0.5                                                             0
   %




                               œà=0       ‚àí0.5
                                                                       ‚àí0.5
                                BM
                                          ‚àí1                            ‚àí1
                 4     6   8   10 12            4   6     8   10 12           4     6      8   10 12
                       Log Output           Log Wages (after tax)                 Markup Shock

           0.4                              1
                                                                        0.4
           0.2                            0.5
   pts




            0                               0                           0.2
   %




         ‚àí0.2                            ‚àí0.5
                                                                          0
                 4     6   8   10 12            4   6     8   10 12           4     6      8   10 12
Figure XIV: Optimal monetary response to a markup shock with              œà = 0.        The solid line is
the baseline calibration with     œà = 20.



                                                    39
